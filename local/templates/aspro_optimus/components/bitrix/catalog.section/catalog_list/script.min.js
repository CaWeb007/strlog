(function(a){if(!a.JCCatalogSectionOnlyElement){a.JCCatalogSectionOnlyElement=function(b){if(typeof b==="object"){this.params=b;this.obProduct=null;this.set_quantity=1;this.currentPriceMode="";this.currentPrices=[];this.currentPriceSelected=0;this.currentQuantityRanges=[];this.currentQuantityRangeSelected=0;if(this.params.MESS){this.mess=this.params.MESS}this.init()}};a.JCCatalogSectionOnlyElement.prototype={init:function(){var c=0,b=0,d=null;this.obProduct=BX(this.params.ID);if(!!this.obProduct){$(this.obProduct).find(".counter_wrapp .counter_block input").data("product","ob"+this.obProduct.id+"el");this.currentPriceMode=this.params.ITEM_PRICE_MODE;this.currentPrices=this.params.ITEM_PRICES;this.currentQuantityRanges=this.params.ITEM_QUANTITY_RANGES}},setPriceAction:function(){this.set_quantity=this.params.MIN_QUANTITY_BUY;if($(this.obProduct).find("input[name=quantity]").length){this.set_quantity=$(this.obProduct).find("input[name=quantity]").val()}this.checkPriceRange(this.set_quantity);$(this.obProduct).find(".not_matrix").hide();$(this.obProduct).find(".with_matrix .price_value_block").html(getCurrentPrice(this.currentPrices[this.currentPriceSelected].PRICE,this.currentPrices[this.currentPriceSelected].CURRENCY,this.currentPrices[this.currentPriceSelected].PRINT_PRICE));if($(this.obProduct).find(".with_matrix .discount")){$(this.obProduct).find(".with_matrix .discount").html(getCurrentPrice(this.currentPrices[this.currentPriceSelected].BASE_PRICE,this.currentPrices[this.currentPriceSelected].CURRENCY,this.currentPrices[this.currentPriceSelected].PRINT_BASE_PRICE))}$(this.obProduct).find(".with_matrix .sale_block .text .values_wrapper").html(getCurrentPrice(this.currentPrices[this.currentPriceSelected].DISCOUNT,this.currentPrices[this.currentPriceSelected].CURRENCY,this.currentPrices[this.currentPriceSelected].PRINT_DISCOUNT));$(this.obProduct).find(".with_matrix .sale_block .value span").html(this.currentPrices[this.currentPriceSelected].PERCENT);$(this.obProduct).find(".with_matrix").show();if(arOptimusOptions.THEME["SHOW_TOTAL_SUMM"]=="Y"){setPriceItem($(this.obProduct),this.set_quantity,this.currentPrices[this.currentPriceSelected].PRICE)}},checkPriceRange:function(f){if(typeof f==="undefined"||this.currentPriceMode!="Q"){return}var c,e=false;for(var d in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(d)){c=this.currentQuantityRanges[d];if(parseInt(f)>=parseInt(c.SORT_FROM)&&(c.SORT_TO=="INF"||parseInt(f)<=parseInt(c.SORT_TO))){e=true;this.currentQuantityRangeSelected=c.HASH;break}}}if(!e&&(c=this.getMinPriceRange())){this.currentQuantityRangeSelected=c.HASH}for(var b in this.currentPrices){if(this.currentPrices.hasOwnProperty(b)){if(this.currentPrices[b].QUANTITY_HASH==this.currentQuantityRangeSelected){this.currentPriceSelected=b;break}}}},getMinPriceRange:function(){var b;for(var c in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(c)){if(!b||parseInt(this.currentQuantityRanges[c].SORT_FROM)<parseInt(b.SORT_FROM)){b=this.currentQuantityRanges[c]}}}return b}}}if(!!a.JCCatalogSection){return}a.JCCatalogSection=function(b){this.skuVisualParams={SELECT:{TAG_BIND:"select",TAG:"option",ACTIVE_CLASS:"active",HIDE_CLASS:"hidden",EVENT:"change",},LI:{TAG_BIND:"li",TAG:"li",ACTIVE_CLASS:"active",HIDE_CLASS:"missing",EVENT:"click",}};this.productType=0;this.showQuantity=true;this.showAbsent=true;this.secondPict=false;this.showOldPrice=false;this.showPercent=false;this.showSkuProps=false;this.basketAction="ADD";this.basketLinkURL="";this.showClosePopup=false;this.useCompare=false;this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",STORE_QUANTITY:"",PRICE_ID:"",PRICE_OLD_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""};this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,isDblQuantity:false,canBuy:true,canSubscription:true,name:"",pict:{},id:0,addUrl:"",buyUrl:""};this.basketMode="";this.basketData={useProps:false,emptyProps:false,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""};this.compareData={compareUrl:"",comparePath:""};this.defaultPict={pict:null,secondPict:null};this.checkQuantity=false;this.maxQuantity=0;this.stepQuantity=1;this.defaultCount=1;this.isDblQuantity=false;this.canBuy=true;this.currentBasisPrice={};this.canSubscription=true;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.currentPriceMode="";this.currentPrices=[];this.currentPriceSelected=0;this.currentQuantityRanges=[];this.currentQuantityRangeSelected=0;this.offers=[];this.offerNum=0;this.treeProps=[];this.obTreeRows=[];this.showCount=[];this.showStart=[];this.selectedValues={};this.obProduct=null;this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obPict=null;this.obSecondPict=null;this.obPrice=null;this.obTree=null;this.obBuyBtn=null;this.obBasketBtn=null;this.obBasketActions=null;this.obNotAvail=null;this.obDscPerc=null;this.obSecondDscPerc=null;this.obSkuProps=null;this.obMeasure=null;this.obCompare=null;this.obPopupWin=null;this.basketUrl="";this.basketParams={};this.treeRowShowSize=5;this.treeEnableArrow={display:"",cursor:"pointer",opacity:1};this.treeDisableArrow={display:"",cursor:"default",opacity:0.2};this.lastElement=false;this.containerHeight=0;this.errorCode=0;if("object"===typeof b){this.productType=parseInt(b.PRODUCT_TYPE,10);this.showQuantity=b.SHOW_QUANTITY;this.showAbsent=b.SHOW_ABSENT;this.secondPict=!!b.SECOND_PICT;this.showOldPrice=!!b.SHOW_OLD_PRICE;this.showPercent=!!b.SHOW_DISCOUNT_PERCENT;this.showSkuProps=!!b.SHOW_SKU_PROPS;if(!!b.ADD_TO_BASKET_ACTION){this.basketAction=b.ADD_TO_BASKET_ACTION}this.showClosePopup=!!b.SHOW_CLOSE_POPUP;this.useCompare=!!b.DISPLAY_COMPARE;this.visual=b.VISUAL;this.defaultCount=b.DEFAULT_COUNT;this.basketLinkURL=b.BASKET_URL;switch(this.productType){case 1:case 2:if(!!b.PRODUCT&&"object"===typeof(b.PRODUCT)){if(this.showQuantity){this.product.checkQuantity=b.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=b.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=(this.product.isDblQuantity?parseFloat(b.PRODUCT.MAX_QUANTITY):parseInt(b.PRODUCT.MAX_QUANTITY,10))}this.product.stepQuantity=(this.product.isDblQuantity?parseFloat(b.PRODUCT.STEP_QUANTITY):parseInt(b.PRODUCT.STEP_QUANTITY,10));this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.maxQuantity=this.product.maxQuantity;this.stepQuantity=this.product.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor}}this.product.canBuy=b.PRODUCT.CAN_BUY;this.product.canSubscription=b.PRODUCT.SUBSCRIPTION;if(!!b.PRODUCT.BASIS_PRICE){this.currentBasisPrice=b.PRODUCT.BASIS_PRICE}this.canBuy=this.product.canBuy;this.canSubscription=this.product.canSubscription;this.product.name=b.PRODUCT.NAME;this.product.pict=b.PRODUCT.PICT;this.product.id=b.PRODUCT.ID;if(!!b.PRODUCT.ADD_URL){this.product.addUrl=b.PRODUCT.ADD_URL}if(!!b.PRODUCT.BUY_URL){this.product.buyUrl=b.PRODUCT.BUY_URL}if(!!b.BASKET&&"object"===typeof(b.BASKET)){this.basketData.useProps=!!b.BASKET.ADD_PROPS;this.basketData.emptyProps=!!b.BASKET.EMPTY_PROPS}}else{this.errorCode=-1}break;case 3:if(!!b.OFFERS&&BX.type.isArray(b.OFFERS)){if(!!b.PRODUCT&&"object"===typeof(b.PRODUCT)){this.product.name=b.PRODUCT.NAME;this.product.id=b.PRODUCT.ID}this.offers=b.OFFERS;this.offerNum=0;if(!!b.OFFER_SELECTED){this.offerNum=parseInt(b.OFFER_SELECTED,10)}if(isNaN(this.offerNum)){this.offerNum=0}if(!!b.TREE_PROPS){this.treeProps=b.TREE_PROPS}if(!!b.DEFAULT_PICTURE){this.defaultPict.pict=b.DEFAULT_PICTURE.PICTURE;this.defaultPict.secondPict=b.DEFAULT_PICTURE.PICTURE_SECOND}}else{this.errorCode=-1}break;default:this.errorCode=-1}if(!!b.BASKET&&"object"===typeof(b.BASKET)){if(!!b.BASKET.QUANTITY){this.basketData.quantity=b.BASKET.QUANTITY}if(!!b.BASKET.PROPS){this.basketData.props=b.BASKET.PROPS}if(!!b.BASKET.BASKET_URL){this.basketData.basketUrl=b.BASKET.BASKET_URL}if(3===this.productType){if(!!b.BASKET.SKU_PROPS){this.basketData.sku_props=b.BASKET.SKU_PROPS}}if(!!b.BASKET.ADD_URL_TEMPLATE){this.basketData.add_url=b.BASKET.ADD_URL_TEMPLATE}if(!!b.BASKET.BUY_URL_TEMPLATE){this.basketData.buy_url=b.BASKET.BUY_URL_TEMPLATE}if(this.basketData.add_url===""&&this.basketData.buy_url===""){this.errorCode=-1024}}if(this.useCompare){if(!!b.COMPARE&&typeof(b.COMPARE)==="object"){if(!!b.COMPARE.COMPARE_PATH){this.compareData.comparePath=b.COMPARE.COMPARE_PATH}if(!!b.COMPARE.COMPARE_URL_TEMPLATE_DEL){this.compareData.compareUrlDel=b.COMPARE.COMPARE_URL_TEMPLATE_DEL}if(!!b.COMPARE.COMPARE_URL_TEMPLATE){this.compareData.compareUrl=b.COMPARE.COMPARE_URL_TEMPLATE}else{this.useCompare=false}}else{this.useCompare=false}}this.lastElement=(!!b.LAST_ELEMENT&&"Y"===b.LAST_ELEMENT)}if(0===this.errorCode){BX.ready(BX.delegate(this.Init,this))}};a.JCCatalogSection.prototype.Init=function(){var c=0,e="",d=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1}this.obPict=BX(this.visual.PICT_ID);if(!this.obPict){this.errorCode=-2}if(this.secondPict&&!!this.visual.SECOND_PICT_ID){this.obSecondPict=BX(this.visual.SECOND_PICT_ID)}this.storeQuanity=BX(this.visual.STORE_QUANTITY);this.obPrice=BX(this.visual.PRICE_ID);this.obPriceOld=BX(this.visual.PRICE_OLD_ID);if(!this.obPrice){this.errorCode=-16}if(this.showQuantity&&!!this.visual.QUANTITY_ID){this.obQuantity=BX(this.visual.QUANTITY_ID);if(!!this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)}if(!!this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID)}}if(3===this.productType){if(!!this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256}e=this.visual.TREE_ITEM_ID;for(c=0;c<this.treeProps.length;c++){this.obTreeRows[c]={LIST:BX(e+this.treeProps[c].ID+"_list"),CONT:BX(e+this.treeProps[c].ID+"_cont")};if(!this.obTreeRows[c].LIST||!this.obTreeRows[c].CONT){this.errorCode=-512;break}}}if(!!this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE)}}this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID);if(!!this.obBasketActions){if(!!this.visual.BUY_ID){this.obBuyBtn=BX(this.visual.BUY_ID)}if(!!this.visual.BASKET_LINK){this.obBasketBtn=BX(this.visual.BASKET_LINK)}}this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS);if(this.showPercent){if(!!this.visual.DSC_PERC){this.obDscPerc=BX(this.visual.DSC_PERC)}if(this.secondPict&&!!this.visual.SECOND_DSC_PERC){this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC)}}if(this.showSkuProps){if(!!this.visual.DISPLAY_PROP_DIV){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)}}if(0===this.errorCode){if(this.showQuantity){if(!!this.obQuantityUp){BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this))}if(!!this.obQuantityDown){BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this))}if(!!this.obQuantity){BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))}}switch(this.productType){case 1:break;case 3:for(var b in this.skuVisualParams){var d=BX.findChildren(this.obTree,{tagName:this.skuVisualParams[b].TAG_BIND},true);if(!!d&&0<d.length){for(c=0;c<d.length;c++){$(d[c]).on(this.skuVisualParams[b].EVENT,BX.delegate(this.SelectOfferProp,this))}}}this.SetCurrent();break}$(this.obProduct).find(".read_more.to-cart").on("click",BX.delegate(this.Add2Basket,this));if(!!this.obBuyBtn){if(this.basketAction==="ADD"){}else{BX.bind(this.obBuyBtn,"click",BX.delegate(this.BuyBasket,this))}}if(this.useCompare){this.obCompare=BX(this.visual.COMPARE_LINK_ID)}}};a.JCCatalogSection.prototype.checkHeight=function(){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}};a.JCCatalogSection.prototype.setHeight=function(){if(0<this.containerHeight){BX.adjust(this.obProduct.parentNode,{style:{height:this.containerHeight+"px"}})}};a.JCCatalogSection.prototype.clearHeight=function(){BX.adjust(this.obProduct.parentNode,{style:{height:"auto"}})};a.JCCatalogSection.prototype.QuantityUp=function(){var d=0,b=true,c;if(0===this.errorCode&&this.showQuantity&&this.canBuy){d=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(d)){d+=this.stepQuantity;if(this.checkQuantity){if(d>this.maxQuantity){b=false}}if(b){if(this.isDblQuantity){d=Math.round(d*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=d}}}};a.JCCatalogSection.prototype.QuantityDown=function(){var d=0,b=true,c;if(0===this.errorCode&&this.showQuantity&&this.canBuy){d=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(d)){d-=this.stepQuantity;if(d<this.stepQuantity){b=false}if(b){if(this.isDblQuantity){d=Math.round(d*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=d}}}};a.JCCatalogSection.prototype.QuantityChange=function(){var e=0,d,b,c;if(0===this.errorCode&&this.showQuantity){if(this.canBuy){e=(this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10));if(!isNaN(e)){if(this.checkQuantity){if(e>this.maxQuantity){e=this.maxQuantity}}if(e<this.stepQuantity){e=this.stepQuantity}else{c=e/this.stepQuantity;b=parseInt(c,10);if(isNaN(b)){b=1;c=1.1}if(c>b){e=(b<=1?this.stepQuantity:b*this.stepQuantity);e=Math.round(e*this.precisionFactor)/this.precisionFactor}}this.obQuantity.value=e}else{this.obQuantity.value=this.stepQuantity}}else{this.obQuantity.value=this.stepQuantity}}};a.JCCatalogSection.prototype.QuantitySet=function(b){if(0===this.errorCode){this.canBuy=this.offers[b].CAN_BUY;this.currentPriceMode=this.offers[b].ITEM_PRICE_MODE;this.currentPrices=this.offers[b].ITEM_PRICES;this.currentPriceSelected=this.offers[b].ITEM_PRICE_SELECTED;this.currentQuantityRanges=this.offers[b].ITEM_QUANTITY_RANGES;this.currentQuantityRangeSelected=this.offers[b].ITEM_QUANTITY_RANGE_SELECTED;if(this.canBuy){if(!!this.obBasketActions){BX.style(this.obBasketActions,"display","")}if(!!this.obNotAvail){BX.style(this.obNotAvail,"display","none")}}else{if(!!this.obBasketActions){BX.style(this.obBasketActions,"opacity","0");BX.style(BX.findParent(BX(this.obQuantity),{"class":"counter_block"}),"display","none")}if(!!this.obNotAvail){BX.style(this.obNotAvail,"display","")}}if(this.showQuantity){this.isDblQuantity=this.offers[b].QUANTITY_FLOAT;this.checkQuantity=this.offers[b].CHECK_QUANTITY;if(this.isDblQuantity){this.maxQuantity=parseFloat(this.offers[b].MAX_QUANTITY);this.stepQuantity=Math.round(parseFloat(this.offers[b].STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor}else{this.maxQuantity=parseInt(this.offers[b].MAX_QUANTITY,10);this.stepQuantity=parseInt(this.offers[b].STEP_QUANTITY,10)}if(!!this.obQuantity){this.obQuantity.value=this.defaultCount;this.obQuantity.disabled=!this.canBuy}if(!!this.obMeasure){if(!!this.offers[b].MEASURE){BX.adjust(this.obMeasure,{html:this.offers[b].MEASURE})}else{BX.adjust(this.obMeasure,{html:""})}}}this.currentBasisPrice=this.offers[b].BASIS_PRICE}};a.JCCatalogSection.prototype.SelectOfferProp=function(){var b=0,d="",c="",f=[],g=null,e=BX.proxy_context;if(typeof e.options!=="undefined"&&typeof e.options[e.selectedIndex]!=="undefined"){e=e.options[e.selectedIndex]}if(!!e&&e.hasAttribute("data-treevalue")){c=e.getAttribute("data-treevalue");propModes=e.getAttribute("data-showtype");f=c.split("_");if(this.SearchOfferPropIndex(f[0],f[1])){g=BX.findChildren(e.parentNode,{tagName:this.skuVisualParams[propModes.toUpperCase()].TAG},false);if(!!g&&0<g.length){for(b=0;b<g.length;b++){d=g[b].getAttribute("data-onevalue");if(propModes=="TEXT"){if(d===f[1]){g[b].setAttribute("selected","selected")}else{g[b].removeAttribute("selected")}}else{if(d===f[1]){$(g[b]).addClass(this.skuVisualParams[propModes.toUpperCase()].ACTIVE_CLASS)}else{$(g[b]).removeClass(this.skuVisualParams[propModes.toUpperCase()].ACTIVE_CLASS)}}}}}}};a.JCCatalogSection.prototype.SearchOfferPropIndex=function(d,m){var h="",n=false,e,c,k=[],b=[],f=-1,g={},l=[];for(e=0;e<this.treeProps.length;e++){if(this.treeProps[e].ID===d){f=e;break}}if(-1<f){for(e=0;e<f;e++){h="PROP_"+this.treeProps[e].ID;g[h]=this.selectedValues[h]}h="PROP_"+this.treeProps[f].ID;n=this.GetRowValues(g,h);if(!n){return false}if(!BX.util.in_array(m,n)){return false}g[h]=m;for(e=f+1;e<this.treeProps.length;e++){h="PROP_"+this.treeProps[e].ID;n=this.GetRowValues(g,h);if(!n){break}b=[];if(this.showAbsent){k=[];l=[];l=BX.clone(g,true);for(c=0;c<n.length;c++){l[h]=n[c];b[b.length]=n[c];if(this.GetCanBuy(l)){k[k.length]=n[c]}}}else{k=n}if(this.selectedValues[h]&&BX.util.in_array(this.selectedValues[h],k)){g[h]=this.selectedValues[h]}else{if(this.showAbsent){g[h]=(k.length?k[0]:b[0])}else{g[h]=k[0]}}this.UpdateRow(e,g[h],n,k)}this.selectedValues=g;this.ChangeInfo("click")}return true};a.JCCatalogSection.prototype.UpdateRow=function(h,g,b,o){var q=0,r=0,n="",c=0,t="",e={},k=false,f=false,m=false,l=0,j=this.treeEnableArrow,s=this.treeEnableArrow,d=0,p=null;if(-1<h&&h<this.obTreeRows.length){propMode=this.treeProps[h].DISPLAY_TYPE;p=BX.findChildren(this.obTreeRows[h].LIST,{tagName:this.skuVisualParams[propMode].TAG},false);if(!!p&&0<p.length){selectMode=("SELECT"===this.treeProps[h].DISPLAY_TYPE);c=b.length;e={style:{},props:{disabled:"",selected:"",},};for(q=0;q<p.length;q++){n=p[q].getAttribute("data-onevalue");m=(n===g);if(BX.util.in_array(n,o)){e.props.className=(m?this.skuVisualParams[propMode].ACTIVE_CLASS:"")}else{e.props.className=(m?this.skuVisualParams[propMode].ACTIVE_CLASS+" "+this.skuVisualParams[propMode].HIDE_CLASS:this.skuVisualParams[propMode].HIDE_CLASS)}if(selectMode){e.props.disabled="disabled";e.props.selected=(m?"selected":"")}else{e.style.display="none"}if(BX.util.in_array(n,b)){if(selectMode){e.props.disabled=""}else{e.style.display=""}if(m){l=r}r++}BX.adjust(p[q],e)}if(selectMode){if($(this.obTreeRows[h].LIST).parent().hasClass("ik_select")){$(this.obTreeRows[h].LIST).ikSelect("reset")}}this.showCount[h]=c;this.showStart[h]=d}}};a.JCCatalogSection.prototype.GetRowValues=function(c,e){var f=0,d,b=[],g=false,h=true;if(0===c.length){for(f=0;f<this.offers.length;f++){if(!BX.util.in_array(this.offers[f].TREE[e],b)){b[b.length]=this.offers[f].TREE[e]}}g=true}else{for(f=0;f<this.offers.length;f++){h=true;for(d in c){if(c[d]!==this.offers[f].TREE[d]){h=false;break}}if(h){if(!BX.util.in_array(this.offers[f].TREE[e],b)){b[b.length]=this.offers[f].TREE[e]}g=true}}}return(g?b:false)};a.JCCatalogSection.prototype.GetCanBuy=function(b){var d=0,c,e=false,f=true;for(d=0;d<this.offers.length;d++){f=true;for(c in b){if(b[c]!==this.offers[d].TREE[c]){f=false;break}}if(f){if(this.offers[d].CAN_BUY){e=true;break}}}return e};a.JCCatalogSection.prototype.SetCurrent=function(){var g=0,f=0,b=[],h="",e=false,d={},c=[],k=this.offers[this.offerNum].TREE;for(g=0;g<this.treeProps.length;g++){h="PROP_"+this.treeProps[g].ID;e=this.GetRowValues(d,h);if(!e){break}if(BX.util.in_array(k[h],e)){d[h]=k[h]}else{d[h]=e[0];this.offerNum=0}if(this.showAbsent){b=[];c=[];c=BX.clone(d,true);for(f=0;f<e.length;f++){c[h]=e[f];if(this.GetCanBuy(c)){b[b.length]=e[f]}}}else{b=e}this.UpdateRow(g,d[h],e,b)}this.selectedValues=d;this.ChangeInfo()};a.JCCatalogSection.prototype.ChangeInfo=function(){var h=0,d,k=-1,e,g=true;for(h=0;h<this.offers.length;h++){g=true;for(d in this.selectedValues){if(this.selectedValues[d]!==this.offers[h].TREE[d]){g=false;break}}if(g){k=h;break}}if(-1<k){if(!!this.obPict){var c={attrs:{}};if(!!this.offers[k].PREVIEW_PICTURE){c.attrs.src=this.offers[k].PREVIEW_PICTURE.SRC}else{c.attrs.src=this.defaultPict.pict.SRC}BX.adjust(BX.findChild(this.obPict,{tag:"img"}),c)}if(this.secondPict&&!!this.obSecondPict){if(!!this.offers[k].PREVIEW_PICTURE_SECOND){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[k].PREVIEW_PICTURE_SECOND.SRC+")"}})}else{if(!!this.offers[k].PREVIEW_PICTURE.SRC){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[k].PREVIEW_PICTURE.SRC+")"}})}else{if(!!this.defaultPict.secondPict){BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.secondPict.SRC+")"}})}else{BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})}}}}if(this.showSkuProps&&!!this.obSkuProps){if(0===this.offers[k].DISPLAY_PROPERTIES.length){BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})}else{BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[k].DISPLAY_PROPERTIES})}}$(this.obBuyBtn).data("item",this.offers[k].ID);$(this.obBasketBtn).data("item",this.offers[k].ID);$(this.obBasketActions).closest(".counter_wrapp").css("opacity",0);this.setQuantityStore(this.visual.ID,this.offers[k].ID);this.offerNum=k;this.QuantitySet(this.offerNum);$(this.obProduct).find(".image_wrapper_block > a").attr("href",this.offers[this.offerNum].URL);if($(this.obProduct).find(".quantity_block .values").length){$(this.obProduct).find(".quantity_block .values .item span.value").text(this.offers[k].MAX_QUANTITY).css({opacity:"1"})}if(this.offers[k].SHOW_DISCOUNT_TIME_EACH_SKU=="Y"){initCountdownTime($(this.obProduct),this.offers[k].DISCOUNT_ACTIVE)}var f=this.offers[k],b=$(this.obProduct),l=this;this.setArticle(b.find(".article_block"),f);if(typeof arBasketAspro!=="undefined"){this.setActualDataBlock(b,f)}else{if(typeof a.frameCacheVars!=="undefined"){BX.addCustomEvent("onFrameDataReceived",function(){l.setActualDataBlock(b,f)})}}}};a.JCCatalogSection.prototype.setArticle=function(b,c){if(c.ARTICLE){b.html(c.ARTICLE)}else{if(c.SHOW_ARTICLE_SKU=="Y"&&c.ARTICLE_SKU){b.html(c.ARTICLE_SKU)}else{b.html("")}}};a.JCCatalogSection.prototype.setActualDataBlock=function(b,c){this.setLikeBlock(b,".like_icons .wish_item_button",c,"DELAY");this.setLikeBlock(b,".like_icons .compare_item_button",c,"COMPARE");this.setBuyBlock(b,c)};a.JCCatalogSection.prototype.setLikeBlock=function(d,c,e,b){var f=d;if(b=="DELAY"){if(e.CAN_BUY){f.find(c).css("display","inline-block")}else{f.find(c).hide()}}f.find(c).attr("data-item",e.ID);f.find(c).find("span").attr("data-item",e.ID);if(arBasketAspro[b]){f.find(c).find(".to").removeClass("added").css("display","block");f.find(c).find(".in").hide();if(arBasketAspro[b][e.ID]!==undefined){f.find(c).find(".to").hide();f.find(c).find(".in").addClass("added").css("display","block")}}};a.JCCatalogSection.prototype.setBuyBlock=function(b,g){var c=b.find(".offer_buy_block"),d=g.CONFIG.MIN_QUANTITY_BUY;if(c.find(".counter_wrapp .counter_block").length){c.find(".counter_wrapp .counter_block").attr("data-item",g.ID)}if(this.offers[this.offerNum].offer_set_quantity){d=this.offers[this.offerNum].offer_set_quantity}if((g.CONFIG.OPTIONS.USE_PRODUCT_QUANTITY_DETAIL&&g.CONFIG.ACTION=="ADD")&&g.CAN_BUY){var j=(g.CONFIG.MAX_QUANTITY_BUY>0?"data-max='"+g.CONFIG.MAX_QUANTITY_BUY+"'":""),h='<span class="minus">-</span><input type="text" class="text" name="'+g.PRODUCT_QUANTITY_VARIABLE+'" value="'+d+'" /><span class="plus" '+j+">+</span>";if(arBasketAspro.BASKET&&arBasketAspro.BASKET[g.ID]!==undefined){if(c.find(".counter_wrapp .counter_block").length){c.find(".counter_wrapp .counter_block").hide()}else{c.find(".counter_wrapp").prepend('<div class="counter_block" data-item="'+g.ID+'"></div>');c.find(".counter_wrapp .counter_block").html(h).hide()}}else{if(c.find(".counter_wrapp .counter_block").length){c.find(".counter_wrapp .counter_block").html(h).show()}else{c.find(".counter_wrapp").prepend('<div class="counter_block" data-item="'+g.ID+'"></div>');c.find(".counter_wrapp .counter_block").html(h)}}}else{if(c.find(".counter_wrapp .counter_block").length){c.find(".counter_wrapp .counter_block").hide()}}var i=((g.CONFIG.ACTION=="ORDER")||!g.CAN_BUY||!g.CONFIG.OPTIONS.USE_PRODUCT_QUANTITY_DETAIL||(g.CONFIG.ACTION=="SUBSCRIBE"&&g.CATALOG_SUBSCRIBE=="Y")?"wide":""),e=$('<div class="button_block"></div>');if(c.find(".counter_wrapp").find(".button_block").length){if(arBasketAspro.BASKET&&arBasketAspro.BASKET[g.ID]!==undefined){c.find(".counter_wrapp").find(".button_block").addClass("wide").html(g.HTML);markProductAddBasket(g.ID)}else{if(i){c.find(".counter_wrapp").find(".button_block").addClass("wide").html(g.HTML);if(arBasketAspro.SUBSCRIBE&&arBasketAspro.SUBSCRIBE[g.ID]!==undefined){markProductSubscribe(g.ID)}}else{c.find(".counter_wrapp").find(".button_block").removeClass("wide").html(g.HTML)}}}else{c.find(".counter_wrapp").append('<div class="button_block '+i+'">'+g.HTML+"</div>");if(arBasketAspro.BASKET&&arBasketAspro.BASKET[g.ID]!==undefined){markProductAddBasket(g.ID)}if(arBasketAspro.SUBSCRIBE&&arBasketAspro.SUBSCRIBE[g.ID]!==undefined){markProductSubscribe(g.ID)}}if(g.CONFIG.ACTION!=="NOTHING"){if(g.CONFIG.ACTION=="ADD"&&g.CAN_BUY&&g.SHOW_ONE_CLICK_BUY!="N"){var f='<span class="transparent big_btn type_block button one_click" data-offers="Y" data-item="'+g.ID+'" data-iblockID="'+g.IBLOCK_ID+'" data-quantity="'+g.CONFIG.MIN_QUANTITY_BUY+'" data-props="'+g.OFFER_PROPS+'" onclick="oneClickBuy('+g.ID+", "+g.IBLOCK_ID+', this)"><span>'+g.ONE_CLICK_BUY+"</span></span>";if(c.find(".wrapp_one_click").length){c.find(".wrapp_one_click").html(f)}else{c.append('<div class="wrapp_one_click">'+f+"</div>")}}else{if(c.find(".wrapp_one_click").length){c.find(".wrapp_one_click").remove()}}}else{if(c.find(".wrapp_one_click").length){c.find(".wrapp_one_click").remove()}}c.fadeIn();c.find(".counter_wrapp .counter_block input").data("product","ob"+this.obProduct.id);if(arOptimusOptions.THEME["CHANGE_TITLE_ITEM"]=="Y"){$(this.obProduct).find(".item-title a").text(g.NAME)}this.setPriceAction("","Y")};a.JCCatalogSection.prototype.CompareCountResult=function(b){if(b.COMPARE_COUNT){for(var c in b.ITEMS){if(b.ITEMS[c]==this.offers[this.offerNum].ID){this.offers[this.offerNum].COMPARE_ACTIVE=true;break}else{this.offers[this.offerNum].COMPARE_ACTIVE=false}}if(this.offers[this.offerNum].COMPARE_ACTIVE){$(this.obCompare).find(".compare_item.to").hide();$(this.obCompare).find(".compare_item.added").show()}else{$(this.obCompare).find(".compare_item.added").hide();$(this.obCompare).find(".compare_item.to").show()}}};a.JCCatalogSection.prototype.ItemInfoResult=function(b){if(b.HTML){$(this.obBasketActions).html(b.HTML);$(this.obBasketActions).show();this.obBuyBtn=BX(this.visual.BUY_ID);this.obBasketBtn=BX(this.visual.BASKET_LINK);this.obSubscribeBtn=BX(this.visual.SUBSCRIBE_ID);this.obSubscribedBtn=BX(this.visual.SUBSCRIBED_ID);BX.bind(this.obBuyBtn,"click",BX.delegate(this.Add2Basket,this));$(this.obBasketActions).removeClass("wide");this.ajax_type_item=b.BUYMISSINGGOODS;if(b.BUYMISSINGGOODS!="ADD"&&!this.canBuy){$(this.obBasketActions).addClass("wide")}else{$(this.obQuantity).css("display","")}}basketParams={ajax_action:"Y"};BX.ajax.loadJSON(arOptimusOptions.SITE_DIR+"ajax/get_basket_count.php",basketParams,BX.delegate(this.BasketCountResult,this))};a.JCCatalogSection.prototype.BasketCountResult=function(b){for(var c in b.ITEMS){if(b.ITEMS[c].PRODUCT_ID==this.offers[this.offerNum].ID){this.offers[this.offerNum].BASKET_ACTIVE=true;break}else{this.offers[this.offerNum].BASKET_ACTIVE=false}}for(var c in b.SUBSCRIBE_ITEMS){if(b.SUBSCRIBE_ITEMS[c].PRODUCT_ID==this.offers[this.offerNum].ID){this.offers[this.offerNum].SUBSCRIBE_ACTIVE=true;break}else{this.offers[this.offerNum].SUBSCRIBE_ACTIVE=false}}this.BasketStateRefresh()};a.JCCatalogSection.prototype.BasketStateRefresh=function(b){if(this.offers[this.offerNum].SUBSCRIBE_ACTIVE){$(this.obProduct).find(".hover_block .o_"+this.offers[this.offerNum].ID+" .to-subscribe").hide();$(this.obProduct).find(".hover_block .o_"+this.offers[this.offerNum].ID+" .in-subscribe").show()}else{$(this.obProduct).find(".hover_block .o_"+this.offers[this.offerNum].ID+" .to-subscribe").show();$(this.obProduct).find(".hover_block .o_"+this.offers[this.offerNum].ID+" .in-subscribe").hide()}if(this.offers[this.offerNum].BASKET_ACTIVE){$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID).addClass("wide");$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .button_block").addClass("wide");$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .to-cart").hide();$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .in-cart").show();$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .counter_block").hide()}else{$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID).removeClass("wide");$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .button_block").removeClass("wide");$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .to-cart").show();$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .in-cart").hide();$(this.obProduct).find(".information_wrapp .o_"+this.offers[this.offerNum].ID+" .counter_block").show()}BX.style(this.obBasketActions,"opacity","1");$(this.obBasketActions).closest(".counter_wrapp").css("opacity",1);if(b!=="undefined"&&b=="Y"){if($("#basket_line .basket_fly").length&&$(a).outerWidth()>768){basketFly("open")}else{if($("#basket_line .cart").length){if($("#basket_line .cart").is(".empty_cart")){$("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call");touchBasket(".cart:not(.empty_cart) .basket_block .link")}reloadTopBasket("add",$("#basket_line"),200,2000,"Y")}}animateBasketLine(200)}};a.JCCatalogSection.prototype.setPriceAction=function(g,f){var c=this.offers[this.offerNum].MEASURE&&this.offers[this.offerNum].SHOW_MEASURE=="Y"?this.offers[this.offerNum].MEASURE:"";var d=$(this.obProduct),e="",b=(typeof f!=="undefined"&&f=="Y");this.offers[this.offerNum].offer_set_quantity=this.offers[this.offerNum].CONFIG.MIN_QUANTITY_BUY;if($(d).find("input[name=quantity]").length){this.offers[this.offerNum].offer_set_quantity=$(d).find("input[name=quantity]").val()}if(this.offers[this.offerNum].USE_PRICE_COUNT&&this.offers[this.offerNum].PRICE_MATRIX){this.checkPriceRange(this.offers[this.offerNum].offer_set_quantity);this.setPriceMatrix(this.offers[this.offerNum].PRICE_MATRIX)}else{if("PRICES" in this.offers[this.offerNum]&&this.offers[this.offerNum].PRICES){this.setPrice(this.offers[this.offerNum].PRICES,c)}}if(arOptimusOptions.THEME["SHOW_TOTAL_SUMM"]=="Y"){if(this.offers[this.offerNum].check_quantity){e="Y"}else{var e=((typeof g!=="undefined"&&g=="Y")?g:"");if(e){this.offers[this.offerNum].check_quantity=true}}if(typeof this.currentPrices[this.currentPriceSelected]!=="undefined"){setPriceItem(d,this.offers[this.offerNum].offer_set_quantity,this.currentPrices[this.currentPriceSelected].PRICE,e,b)}}};a.JCCatalogSection.prototype.checkPriceRange=function(f){if(typeof f==="undefined"||this.currentPriceMode!="Q"){return}var c,e=false;for(var d in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(d)){c=this.currentQuantityRanges[d];if(parseInt(f)>=parseInt(c.SORT_FROM)&&(c.SORT_TO=="INF"||parseInt(f)<=parseInt(c.SORT_TO))){e=true;this.currentQuantityRangeSelected=c.HASH;break}}}if(!e&&(c=this.getMinPriceRange())){this.currentQuantityRangeSelected=c.HASH}for(var b in this.currentPrices){if(this.currentPrices.hasOwnProperty(b)){if(this.currentPrices[b].QUANTITY_HASH==this.currentQuantityRangeSelected){this.currentPriceSelected=b;break}}}};a.JCCatalogSection.prototype.getMinPriceRange=function(){var b;for(var c in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(c)){if(!b||parseInt(this.currentQuantityRanges[c].SORT_FROM)<parseInt(b.SORT_FROM)){b=this.currentQuantityRanges[c]}}}return b};a.JCCatalogSection.prototype.setPriceMatrix=function(f){var b="";if(!!this.obPrice){var c=this.offers[this.offerNum].MEASURE&&this.offers[this.offerNum].SHOW_MEASURE=="Y"?this.offers[this.offerNum].MEASURE:"",d="";d=getCurrentPrice(this.currentPrices[this.currentPriceSelected].PRICE,this.currentPrices[this.currentPriceSelected].CURRENCY,this.currentPrices[this.currentPriceSelected].PRINT_PRICE);if(c){d+='<span class="price_measure">/'+c+"</span>"}$(this.obProduct).find(".not_matrix").hide();$(this.obProduct).find(".with_matrix .price_value_block").html(d);if(this.showOldPrice){if(parseFloat(this.currentPrices[this.currentPriceSelected].BASE_PRICE)>parseFloat(this.currentPrices[this.currentPriceSelected].PRICE)){$(this.obProduct).find(".with_matrix .discount").html(getCurrentPrice(this.currentPrices[this.currentPriceSelected].BASE_PRICE,this.currentPrices[this.currentPriceSelected].CURRENCY,this.currentPrices[this.currentPriceSelected].PRINT_BASE_PRICE));$(this.obProduct).find(".with_matrix .discount").css("display","inline-block")}else{$(this.obProduct).find(".with_matrix .discount").html("");$(this.obProduct).find(".with_matrix .discount").css("display","none")}}else{$(this.obProduct).find(".with_matrix .discount").html("");$(this.obProduct).find(".with_matrix .discount").css("display","none")}if(this.currentPrices[this.currentPriceSelected].PERCENT>0){$(this.obProduct).find(".with_matrix .sale_block .text .values_wrapper").html(getCurrentPrice(this.currentPrices[this.currentPriceSelected].DISCOUNT,this.currentPrices[this.currentPriceSelected].CURRENCY,this.currentPrices[this.currentPriceSelected].PRINT_DISCOUNT));$(this.obProduct).find(".with_matrix .sale_block .value span").html(this.currentPrices[this.currentPriceSelected].PERCENT);$(this.obProduct).find(".with_matrix .sale_block").show()}else{$(this.obProduct).find(".with_matrix .sale_block").hide()}$(this.obProduct).find(".sale_block.normal").hide();$(this.obProduct).find(".with_matrix").show();BX.adjust(this.obPrice,{html:f});var e={product:$(this.obProduct),measure:c,config:this.config,offer:this.offers[this.offerNum],obPrice:this.currentPrices[this.currentPriceSelected]};BX.onCustomEvent("onAsproSkuSetPriceMatrix",[e])}};a.JCCatalogSection.prototype.setPrice=function(m,l,n,b,p,o){var h,e;if(!!this.obPrice){var b=this.offers[this.offerNum].MEASURE&&this.offers[this.offerNum].SHOW_MEASURE=="Y"?this.offers[this.offerNum].MEASURE:"",p=$(this.obProduct),n=this.offers[this.offerNum].PRICES,f="",c=(typeof l!=="undefined"&&l=="Y");if(typeof(n)=="object"){var h="",k=Object.keys(n).length,d=[];if(arOptimusOptions.THEME["DISCOUNT_PRICE"]){d=arOptimusOptions.THEME["DISCOUNT_PRICE"].split(",")}h='<div class="offers_price_wrapper">';$(this.obProduct).find(".with_matrix").hide();$(this.obProduct).find(".not_matrix").show();this.offers[this.offerNum].offer_set_quantity=this.offers[this.offerNum].CONFIG.MIN_QUANTITY_BUY;if($(p).find("input[name=quantity]").length){this.offers[this.offerNum].offer_set_quantity=$(p).find("input[name=quantity]").val()}for(var g in n){if(n[g].hasOwnProperty("MIN_PRICE")&&n[g].MIN_PRICE!=="Y"){continue}if(n[g]){if("GROUP_NAME" in n[g]){if(k>1){h+='<div class="offers_price_title">';h+=n[g].GROUP_NAME;h+="</div>"}}h+='<div class="offers_price'+(d?(BX.util.in_array(n[g].PRICE_ID,d)?" strike_block":""):"")+'">';h+='<span class="values_wrapper">'+getCurrentPrice(n[g].DISCOUNT_VALUE,n[g].CURRENCY,n[g].PRINT_DISCOUNT_VALUE)+"</span>";if(b){h+='<span class="price_measure">/'+b+"</span>"}h+="</div>";if(n[g].DISCOUNT_VALUE!==n[g].VALUE){if(this.showOldPrice){h+='<div class="offers_price_old">';h+='<span class="values_wrapper">'+getCurrentPrice(n[g].VALUE,n[g].CURRENCY,n[g].PRINT_VALUE)+"</span>";h+="</div>"}if(this.showPercent){h+='<div class="sale_block matrix"><div class="sale_wrapper">';if(n[g].DISCOUNT_DIFF_PERCENT>0&&n[g].DISCOUNT_DIFF_PERCENT<100){h+='<div class="value">-';h+="<span>"+n[g].DISCOUNT_DIFF_PERCENT+"</span>";h+="%</div>"}h+='<div class="text">';h+='<span class="title">'+BX.message("ITEM_ECONOMY")+"</span>";h+='<span class="values_wrapper">'+getCurrentPrice(n[g].DISCOUNT_DIFF,n[g].CURRENCY,n[g].PRINT_DISCOUNT_DIFF)+"</span>";h+="</div>";h+='<div class="clearfix"></div></div></div>'}}}}if(this.showPercent){$(this.obPrice).closest(".cost").find(".sale_block:not(.matrix)").hide();$(this.obPrice).closest(".cost").find(".sale_block:not(.matrix) .text span").html("")}if(this.showOldPrice){$(this.obPrice).closest(".cost").find(".price.discount").hide()}h+="</div>";BX.adjust(this.obPrice,{html:h});var i={product:p,measure:b,config:this.config,offer:this.offers[this.offerNum],obPrices:n};BX.onCustomEvent("onAsproSkuSetPrice",[i])}}};a.JCCatalogSection.prototype.setQuantityStore=function(c,b){$("#"+c).find('div[id^="offer_block_"]').hide();$("#offer_block_"+b).fadeIn()};a.JCCatalogSection.prototype.Compare=function(){var b,c;$(this.obProduct).find(".like_icons .o_"+this.offers[this.offerNum].ID).data("changed","Y");if($(this.obProduct).find(".like_icons .o_"+this.offers[this.offerNum].ID).find(".compare_item.added").is(":visible")){c=this.compareData.compareUrlDel;this.compareData.Added=false}else{c=this.compareData.compareUrl;this.compareData.Added=true}if(!!c){switch(this.productType){case 1:case 2:c=c.replace("#ID#",this.product.id.toString());break;case 3:c=c.replace("#ID#",this.offers[this.offerNum].ID);break}b={ajax_action:"Y"};BX.ajax.loadJSON(c,b,BX.proxy(this.CompareResult,this))}};a.JCCatalogSection.prototype.CompareResult=function(b){var d,e,c;if(typeof b!=="object"){return false}if(b.STATUS==="OK"){BX.onCustomEvent("OnCompareChange");if(!this.compareData.Added){$(this.obProduct).find(".like_icons .o_"+this.offers[this.offerNum].ID).find(".in").hide();$(this.obProduct).find(".like_icons .o_"+this.offers[this.offerNum].ID).find(".to").show()}else{$(this.obProduct).find(".like_icons .o_"+this.offers[this.offerNum].ID).find(".to").hide();$(this.obProduct).find(".like_icons .o_"+this.offers[this.offerNum].ID).find(".in").show()}jsAjaxUtil.InsertDataToNode(arOptimusOptions.SITE_DIR+"ajax/show_compare_preview_top.php","compare_line",false)}else{console.log(BX.message("ADD_ERROR_COMPARE"))}return false};a.JCCatalogSection.prototype.CompareRedirect=function(){if(!!this.compareData.comparePath){location.href=this.compareData.comparePath}else{this.obPopupWin.close()}};a.JCCatalogSection.prototype.InitBasketUrl=function(){this.basketUrl=(this.basketMode==="ADD"?this.basketData.add_url:this.basketData.buy_url);switch(this.productType){case 1:case 2:this.basketUrl=this.basketUrl.replace("#ID#",this.product.id.toString());break;case 3:this.basketUrl=this.basketUrl.replace("#ID#",this.offers[this.offerNum].ID);break}this.basketParams={ajax_basket:"Y"};if(this.showQuantity){this.basketParams[this.basketData.quantity]=$(this.obProduct).find(".counter_wrapp.o_"+this.offers[this.offerNum].ID).find(".counter_block .text").val()}if(!!this.basketData.sku_props){this.basketParams[this.basketData.sku_props_var]=this.basketData.sku_props}};a.JCCatalogSection.prototype.FillBasketProps=function(){if(!this.visual.BASKET_PROP_DIV){return}var b=0,e=null,d=false,c=null;if(this.basketData.useProps&&!this.basketData.emptyProps){if(!!this.obPopupWin&&!!this.obPopupWin.contentContainer){c=this.obPopupWin.contentContainer}}else{c=BX(this.visual.BASKET_PROP_DIV)}if(!!c){e=c.getElementsByTagName("select");if(!!e&&!!e.length){for(b=0;b<e.length;b++){if(!e[b].disabled){switch(e[b].type.toLowerCase()){case"select-one":this.basketParams[e[b].name]=e[b].value;d=true;break;default:break}}}}e=c.getElementsByTagName("input");if(!!e&&!!e.length){for(b=0;b<e.length;b++){if(!e[b].disabled){switch(e[b].type.toLowerCase()){case"hidden":this.basketParams[e[b].name]=e[b].value;d=true;break;case"radio":if(e[b].checked){this.basketParams[e[b].name]=e[b].value;d=true}break;default:break}}}}}if(!d){this.basketParams[this.basketData.props]=[];this.basketParams[this.basketData.props][0]=0}};a.JCCatalogSection.prototype.Add2Basket=function(){this.basketMode="ADD";this.Basket()};a.JCCatalogSection.prototype.BuyBasket=function(){this.basketMode="BUY";this.Basket()};a.JCCatalogSection.prototype.SendToBasket=function(){if(!this.canBuy){return}this.InitBasketUrl();this.FillBasketProps();BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this))};a.JCCatalogSection.prototype.Basket=function(){var b="";if(!this.canBuy){return}this.SendToBasket()};a.JCCatalogSection.prototype.BasketResult=function(d){var c="",e="",f,b=[];if(!!this.obPopupWin){this.obPopupWin.close()}if("object"!==typeof d){return false}f=(d.STATUS==="OK");if(f&&this.basketAction==="BUY"){this.BasketRedirect()}else{if(f){BX.onCustomEvent("OnBasketChange");this.offers[this.offerNum].BASKET_ACTIVE=true;this.BasketStateRefresh("Y");$(this.obProduct).find(".hover_block .o_"+this.offers[this.offerNum].ID).data("changed","Y")}else{console.log(BX.message("ADD_ERROR_BASKET"))}}};a.JCCatalogSection.prototype.BasketRedirect=function(){location.href=(!!this.basketData.basketUrl?this.basketData.basketUrl:BX.message("BASKET_URL"))}})(window);