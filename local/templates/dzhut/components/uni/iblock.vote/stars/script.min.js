window.JCIblockVoteStars||(JCIblockVoteStars=function(t){this.progressId=t.progressId,this.ratingId=t.ratingId,this.starsId=t.starsId,this.ajaxUrl=t.ajaxUrl,this.voteId=t.voteId,this.starsObj=null,this.votedValue=null,this.preVotedValue=null},JCIblockVoteStars.prototype.setValue=function(t){t=parseInt(t),isNaN(t)?t=0:100<t?t=100:t<0&&(t=0);var s=BX(this.progressId);s&&(s.style.width=parseInt(t)+"%",this.votedValue=t)},JCIblockVoteStars.prototype.setVotes=function(t){var s=BX(this.ratingId);s&&(s.innerHTML="( "+t+" )")},JCIblockVoteStars.prototype.getStarsObj=function(){return this.starsObj||(this.starsObj=BX(this.starsId)),this.starsObj},JCIblockVoteStars.prototype.onMouseMove=function(t){for(var s=BX.pos(this.getStarsObj()),o=(t.pageX-s.left)/s.width*5,e=1;e<=5;e++)if(o<e){o=e;break}this.setValue(20*o)},JCIblockVoteStars.prototype.onMouseOver=function(t){BX.bind(this.getStarsObj(),"click",BX.proxy(this.onVote,this)),this.preVotedValue=this.votedValue},JCIblockVoteStars.prototype.onMouseOut=function(t){BX.unbind(this.getStarsObj(),"click",BX.proxy(this.onVote,this)),this.votedValue=this.preVotedValue,this.setValue(this.votedValue)},JCIblockVoteStars.prototype.onVote=function(t){this.unBindEvents(),this.ajaxParams.rating=parseInt(this.votedValue/20)-1,this.ajaxParams.vote="Y",this.ajaxParams.vote_id=this.voteId,BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:this.ajaxParams,onsuccess:BX.delegate(this.SetResult,this)})},JCIblockVoteStars.prototype.SetResult=function(t){t&&!t.ERROR&&(this.setValue(20*(t.value+1)),this.setVotes(t.votes))},JCIblockVoteStars.prototype.bindEvents=function(){var t=this.getStarsObj();BX.bind(t,"mousemove",BX.proxy(this.onMouseMove,this)),BX.bind(t,"mouseover",BX.proxy(this.onMouseOver,this)),BX.bind(t,"mouseout",BX.proxy(this.onMouseOut,this))},JCIblockVoteStars.prototype.unBindEvents=function(){var t=this.getStarsObj();BX.unbind(t,"mousemove",BX.proxy(this.onMouseMove,this)),BX.unbind(t,"mouseover",BX.proxy(this.onMouseOver,this)),BX.unbind(t,"mouseout",BX.proxy(this.onMouseOut,this)),BX.unbind(this.getStarsObj(),"click",BX.proxy(this.onVote,this))});