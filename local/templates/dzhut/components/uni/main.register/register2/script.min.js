function validateTel(e){var o=/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{5,10}$/i.test(jQuery(e).val());return o?jQuery(e).removeClass("error"):jQuery(e).attr("placeholder","Введите ваш телефон").focus(function(){jQuery(this).attr("placeholder","Телефон").off("focus").removeClass("error")}).addClass("error"),o}function validateCode(e,o,n){var r=o||-1,t=n||100,a=jQuery(e).val().length>=r&&jQuery(e).val().length<=t;return a?jQuery(e).removeClass("error"):jQuery(e).attr("placeholder","Введите код").focus(function(){jQuery(this).attr("placeholder","Код").off("focus").removeClass("error")}).addClass("error"),a}function writeDate1(){for(var e=new Date,a=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],i={0:{name:"Январь",number:"01",countday:31,id:1},1:{name:"Февраль",number:"02",countday:28,id:2},2:{name:"Март",number:"03",countday:31,id:3},3:{name:"Апрель",number:"04",countday:30,id:4},4:{name:"Май",number:"05",countday:31,id:5},5:{name:"Июнь",number:"06",countday:30,id:6},6:{name:"Июль",number:"07",countday:31,id:7},7:{name:"Август",number:"08",countday:31,id:8},8:{name:"Сентябрь",number:"09",countday:30,id:9},9:{name:"Октябрь",number:"10",countday:31,id:10},10:{name:"Ноябрь",number:"11",countday:30,id:11},11:{name:"Декабрь",number:"12",countday:31,id:12}},o={min_year:1930,max_year:e.getFullYear()},n='<option value="no" selected="selected">-</option>',r=0;r<31;r++)n+='<option value="'+a[r]+'">'+a[r]+"</option>";var t='<option value="no" selected="selected">-</option>';for(var s in i)t+='<option value="'+i[s].number+'" data-monthid="'+i[s].id+'">'+i[s].name+"</option>";var c='<option value="no" selected="selected">-</option>';for(r=o.max_year;1930<=r;r--)c+='<option value="'+r+'">'+r+"</option>";$('form[name="regform"] select[name="REGISTER[PERSONAL_DAY]"]').append(n),$('form[name="regform"] select[name="REGISTER[PERSONAL_MONTH]"]').append(t),$('form[name="regform"] select[name="REGISTER[PERSONAL_YEAR]"]').append(c),$('form[name="regform"] select[name="REGISTER[PERSONAL_MONTH]"]').on("change",{month:i,days:a},function(e){if("no"==$(this).val())return!1;var o=$(this).children("option:selected").data("monthid");if(console.log(i[o-1].countday),"no"!=$(this).siblings('form[name="regform"] select[name="REGISTER[PERSONAL_DAY]"]').val())var n=$(this).siblings('form[name="regform"] select[name="REGISTER[PERSONAL_DAY]"]').val();$(this).siblings('form[name="regform"] select[name="REGISTER[PERSONAL_DAY]"]').empty();for(var r='<option value="no">-</option>',t=0;t<i[o-1].countday;t++)if(n){if(n==a[t]){r+='<option selected="selected" value="'+a[t]+'">'+a[t]+"</option>";continue}r+='<option value="'+a[t]+'">'+a[t]+"</option>"}else r+='<option value="'+a[t]+'">'+a[t]+"</option>";$(this).siblings('form[name="regform"] select[name="REGISTER[PERSONAL_DAY]"]').append(r)})}$(document).ready(function(){writeDate1(),$("#checkRegPhone").on("click",function(e){e.preventDefault(),validateTel($('form[name="regform"] input[name="REGISTER[PERSONAL_PHONE]"]'))&&(userPhone=$('form[name="regform"] input[name="REGISTER[PERSONAL_PHONE]"]').val(),$.ajax({url:"/local/templates/strlog/components/uni/main.register/register2/ajax.php",type:"post",dataType:"json",beforeSend:function(){BX.showWait()},data:{userPhone:userPhone},success:function(e){console.log(e),"N"==e.send_sms?$('form[name="regform"] input[name="REGISTER[PERSONAL_PHONE]"]').attr("placeholder","Некорректный телефон").val("").focus(function(){jQuery(this).attr("placeholder","Телефон").off("focus").removeClass("error")}).addClass("error"):"Y"==e.user?$(".topltip_error_top").show():($('input[name="CODE"]').show(),$("#sendCode").show(),$("#re-confirm-top").show(),$(".desc_confirm_top").show(),$("#checkRegPhone").hide())},complete:function(){BX.closeWait()}}))}),$("#sendCode").on("click",function(e){if(e.preventDefault(),!$(this).hasClass("success")){if(!validateCode($('form[name="regform"] input[name="CODE"]'),1,4))return!1;var o=$('form[name="regform"] input[name="CODE"]').val(),n=$('form[name="regform"] input[name="REGISTER[PERSONAL_PHONE]"]').val();$.ajax({url:"/local/templates/strlog/components/uni/main.register/register2/ajax.php",type:"post",dataType:"json",beforeSend:function(){BX.showWait()},data:{Code:o,userPhone:n},success:function(e){console.log(e),"Y"==e.code_confirm?($("#sendCode").addClass("success"),$('form[name="regform"] input[name="CODE"]').val(""),$('form[name="regform"] input[name="CODE"]').attr({disabled:"disabled"}),$("#re-confirm-top").hide(),$(".desc_confirm_top").hide(),$("#CHECKPHONE").val("Y")):"Y"==e.user?($(".topltip_error_top").show(),$(".desc_confirm_top").hide()):($(".desc_confirm_top").hide(),$(".re_desc_confirm_top_error").show(),$('form[name="regform"] input[name="CODE"]').addClass("error")),$('form[name="regform"] input[name="CODE"]').on("focus",function(){$(".re_desc_confirm_top_error").hide(),$(".desc_confirm_top").show(),$(this).removeClass("error")})},complete:function(){BX.closeWait()}})}}),$("#re-confirm-top").on("click",function(e){if(e.preventDefault(),validateTel($('form[name="regform"] input[name="REGISTER[PERSONAL_PHONE]"]'))){var o=$('form[name="regform"] input[name="REGISTER[PERSONAL_PHONE]"]').val();$.ajax({url:"/local/templates/strlog/components/uni/main.register/register2/ajax.php",type:"post",dataType:"json",beforeSend:function(){BX.showWait()},data:{Reconfirm:"Y",userPhone:o},success:function(e){"Y"==e.user&&($(".topltip_error_top").show(),$(".desc_confirm_top").hide()),$('form[name="regform"] input[name="CODE"]').on("focus",function(){$(".re_desc_confirm_top_error").hide(),$(".desc_confirm_top").show(),$(this).removeClass("error")})},error:function(e,o,n){console.log(e,o,n)},complete:function(){BX.closeWait()}})}}),$("#re-confirm-top").hover(function(e){$(".re-desc-confirm").addClass("active")},function(){$(".re-desc-confirm").removeClass("active")}),$("#re-confirm-top").hover(function(){$(".desc_confirm_top").hide(),$(".re_desc_confirm_top").show()},function(){$(".desc_confirm_top").show(),$(".re_desc_confirm_top").hide()}),$(".topltip_error_top .close").on("click",function(){$(this).parent().hide()}),$(".topltip_error_top .orange.login").on("click",function(e){e.preventDefault(),$("#auth").trigger("click")})});