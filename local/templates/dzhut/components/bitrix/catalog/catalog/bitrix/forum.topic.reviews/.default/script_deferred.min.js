function replyActionComment(n,s){if(!BX.util.in_array(s,["DEL","MODERATE"]))return!1;if("DEL"==s&&!confirm(oText.cdm))return!1;var l=n.getAttribute("href");l=l.replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),l+=(-1<l.indexOf("?")?"&":"?")+"AJAX_CALL=Y&sessid="+phpVars.bitrix_sessid,BX.hide(n.parentNode);var d=BX.create("a",{attrs:{className:"reply-action-note"}});d.innerHTML=oText.wait,n.parentNode.parentNode.appendChild(d);var c=function(){BX.remove(d),BX.show(n.parentNode)};return BX.ajax.loadJSON(l,function(e){var o=BX.findParent(n,{tag:"table"});if(e.status&&o){BX.onCustomEvent(window,"onForumCommentAJAXAction",[s]);var t=window.curpage||top.window.location.href;if("DEL"==s)BX.fx.hide(o,"scroll",{time:.15,callback_complete:function(){BX.remove(o);var e=BX.findChild(document,{class:"reviews-post-table"},!0,!0);(!e||e.length<1)&&"undefined"!=typeof oForum&&1<oForum.page_number&&BX.reload(t),c()}});else{var a=BX.hasClass(o,"reviews-post-hidden"),r=a?oText.hide:oText.show,i=BX.findChild(o,{className:"reviews-text"},!0);BX.fx.hide(i,"fade",{time:.1,callback_complete:function(){BX.toggleClass(o,"reviews-post-hidden"),n.innerHTML=r,l=l.replace(new RegExp("REVIEW_ACTION="+(a?"SHOW":"HIDE")),"REVIEW_ACTION="+(a?"HIDE":"SHOW")),n.setAttribute("href",l),BX.fx.show(i,"fade",{time:.1}),c(),BX.style(i,"background-color",a?"#FFFFFF":"#E5F8E3")}})}}else BX.addClass(d,"error"),d.innerHTML='<font class="errortext">'+e.message+"</font>"}),!1}function fTextToNode(e){var o=BX.create("div");return o.innerHTML=e,0<o.childNodes.length?o:null}function PostFormAjaxStatus(e){var o=BX.findChild(document,{className:"reviews-note-box"},!0,!0);if(o)for(i in o)BX.remove(o[i]);var t=BX.findChild(document,{className:"reviews-block-container"},!0);if(t&&!(e.length<1)){var a=fTextToNode(e);if(a)for(var r=["reviews-reply-form","reviews-collapse"],n=t;n=n.nextSibling;)if(1==n.nodeType){var s=!1;for(i in r)if(BX.hasClass(n,r[i])){s=!0;break}if(s){n.parentNode.insertBefore(a,n);break}}}}function PostFormAjaxNavigation(e,o,t){var a=fTextToNode(e);if(a){if(!(l=BX.findChildren(document,{className:"reviews-navigation-box"},!0))){var r=BX.findChild(document,{className:"reviews-block-container"},!0);if(!r)return!1;var n=r.parentNode;for(n.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),r);(r=r.nextSibling)&&1!=r.nodeType;);var s=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});r?r.parentNode.insertBefore(s,r):n.appendChild(s);var l=BX.findChildren(document,{className:"reviews-navigation-box"},!0)}for(i in l)l[i].innerHTML=a.innerHTML;oForum.page_number=o,oForum.page_count=t}}function SetReviewsAjaxPostTmp(e){window.forumAjaxPostTmp=e}function fReplaceOrInsertNode(e,o,t,a){var r=null;return!!BX.type.isDomNode(t)&&(!(!BX.type.isDomNode(e)&&!BX.type.isArray(e)&&0<e.length&&!(e=fTextToNode(e)))&&(BX.type.isDomNode(o)&&(t=o.parentNode,r=o.nextSibling,t.removeChild(o)),r||(r=BX.findChild(t,a,!0)),r?r.parentNode.insertBefore(e,r):t.appendChild(e),!0))}function fRunScripts(e){var o=BX.processHTML(e,!0);scripts=o.SCRIPT,BX.ajax.processScripts(scripts,!0)}function PostFormAjaxResponse(e,o,t){o.BXFormSubmit_save=null;var a=window.forumAjaxPostTmp,r={className:/reviews-reply-form|reviews-collapse/};BX.onCustomEvent(window,"onForumCommentAJAXPost",[a,o]);var i=window.curpage||top.window.location.href;if(void 0!==a){var n=BX.findChild(document,{className:"reviews-block-inner"},!0);if(!n)fReplaceOrInsertNode(BX.create("div",{props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]}),null,BX.findChild(document,r,!0).parentNode,r),n=BX.findChild(document,{className:"reviews-block-inner"},!0);if(a.reload&&BX.reload(i),a.status){if(a.allMessages){var s=fTextToNode(a.message);if(!s)return;fReplaceOrInsertNode(s,n,BX.findChild(document,r,!0).parentNode,r),a.navigation&&a.pageNumber&&PostFormAjaxNavigation(a.navigation,a.pageNumber,a.pageCount),ClearForumPostForm(o),fRunScripts(a.message)}else if(void 0!==a.message)(msgNode=fTextToNode(a.message))&&(t?n.appendChild(msgNode):n.insertBefore(msgNode,n.firstChild)),ClearForumPostForm(o),fRunScripts(a.message);else if(a.previewMessage){previewDIV=BX.findChild(document,{className:"reviews-preview"},!0),previewParent=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},!0).parentNode,fReplaceOrInsertNode(fTextToNode(a.previewMessage),previewDIV,previewParent,{className:/reviews-reply-form|reviews-collapse/}),PostFormAjaxStatus(""),fRunScripts(a.previewMessage)}a.messageID&&(message=BX("message"+a.messageID))&&BX.scrollToNode(message)}for(var l=o.getElementsByTagName("input"),d=0;d<l.length;d++){var c=l[d];"submit"==c.getAttribute("type")&&(c.disabled=!1)}(input_pageno=BX.findChild(o,{attr:{name:"pageNumber"}},!0))&&BX.remove(input_pageno),a.statusMessage&&PostFormAjaxStatus(a.statusMessage),BX.onCustomEvent(window,"onAfterForumCommentAJAXPost",[a,o])}else BX.reload(i)}function ClearForumPostForm(e){if("code"==window.oLHE.sEditorMode?window.oLHE.SetContent(""):window.oLHE.SetEditorContent(""),window.oLHE.fAutosave&&BX.bind(window.oLHE.pEditorDocument,"keydown",BX.proxy(window.oLHE.fAutosave.Init,window.oLHE.fAutosave)),BX.type.isDomNode(e)){(previewDIV=BX.findChild(document,{className:"reviews-preview"},!0))&&BX.remove(previewDIV);for(var o=0;fileDIV=BX("upload_files_"+o+++"_");)(fileINPUT=BX.findChild(fileDIV,{tag:"input"}))&&(fileINPUT.value=""),BX.hide(fileDIV);var t=BX.findChild(e,{className:"forum-upload-file-attach"},!0);t&&BX.show(t);var a=BX.findChild(e,{className:"reviews-upload-info"},!0);a&&BX.hide(a),captchaIMAGE=null,captchaHIDDEN=BX.findChild(e,{attr:{name:"captcha_code"}},!0),captchaINPUT=BX.findChild(e,{attr:{name:"captcha_word"}},!0),captchaDIV=BX.findChild(e,{className:"reviews-reply-field-captcha-image"},!0),captchaDIV&&(captchaIMAGE=BX.findChild(captchaDIV,{tag:"img"})),captchaHIDDEN&&captchaINPUT&&captchaIMAGE&&(captchaINPUT.value="",BX.ajax.getCaptcha(function(e){captchaHIDDEN.value=e.captcha_sid,captchaIMAGE.src="/bitrix/tools/captcha.php?captcha_code="+e.captcha_sid}))}}function ValidateForm(e,o,t,a){if(e.BXFormSubmit_save)return!0;if("object"!=typeof e||"object"!=typeof e.REVIEW_TEXT)return!1;"undefined"==typeof oForum&&(oForum={}),MessageMax=64e3;var r="",i=e.REVIEW_TEXT.value.length;if(e.TITLE&&e.TITLE.value.length<2&&(r+=oErrors.no_topic_name),i<2?r+=oErrors.no_message:0!=MessageMax&&i>MessageMax&&(r+=oErrors.max_len.replace(/\#MAX_LENGTH\#/gi,MessageMax).replace(/\#LENGTH\#/gi,i)),""!=r)return alert(r),!1;var n=BX.findChild(e,{attribute:{name:"send_button"}},!0);n&&(n.disabled=!0);var s=BX.findChild(e,{attribute:{name:"view_button"}},!0);if(s&&(s.disabled=!0),"Y"==o&&window.ForumPostMessage&&ForumPostMessage(e),"Y"==t){var l=e,d="Y"==a;if("undefined"!=typeof oForum&&void 0!==oForum.page_number){var c=BX.findChild(l,{attr:{name:"pageNumber"}});c?c.value=oForum.page_number:((c=BX.create("input",{props:{type:"hidden",name:"pageNumber"}})).value=oForum.page_number,l.appendChild(c))}if("undefined"!=typeof oForum&&void 0!==oForum.page_count){var p=BX.findChild(l,{attr:{name:"pageCount"}});p?p.value=oForum.page_count:((p=BX.create("input",{props:{type:"hidden",name:"pageCount"}})).value=oForum.page_count,l.appendChild(p))}return BX.onCustomEvent(window,"onBeforeForumCommentAJAXPost",[l]),setTimeout(function(){BX.ajax.submit(l,function(e){PostFormAjaxResponse(e,l,d)})},50),!1}return!0}function ShowLastEditReason(e,o){o&&(o.style.display=e?"block":"none")}function AttachFile(e,o,t,a){var r=null,i=!1;e=parseInt(e),o=parseInt(o),document.getElementById("upload_files_info_"+t).style.display="block";for(var n=e;n<e+o&&((r=document.getElementById("upload_files_"+n+"_"+t))&&null!=typeof r);n++)if("none"==r.style.display){i=!0,r.style.display="block";break}1==(!i||e+o-1<=n)&&(a.style.display="none")}var GetSelection=function(){var e="";if("function"==typeof window.getSelection)try{var o=window.getSelection().getRangeAt(0).cloneContents(),t=BX.create("div");t.appendChild(o),e=t.innerHTML}catch(t){}else document.selection&&document.selection.createRange&&(e=document.selection.createRange().htmlText);return e};function quoteMessageEx(e,o){replyForumFormOpen();var t="";if(t=GetSelection(),document.getSelection&&(t=(t=t.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ")).replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")),""==t&&o)if(0<parseInt(o.replace(/message_text_/gi,""))){var a=document.getElementById(o);"object"==typeof a&&a&&(t=a.innerHTML)}else 0<o.length&&(t=o);if(""!=t){t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/[\n|\r]*\<br(\s)*(\/)*\>/gi,"\n")).replace(/\<script[^\>]*>/gi,"").replace(/\<\/script[^\>]*>/gi,"")).replace(/\001([^\002]*)\002/gi,function(e,o,t,a){var r=" ";res=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi.exec(o),res&&(r="[VIDEO WIDTH="+res[2]+" HEIGHT="+res[3]+"]"+res[1]+"[/VIDEO]")," "==r&&(res=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi.exec(o),res&&(r="[VIDEO WIDTH="+res[3]+" HEIGHT="+res[2]+"]"+res[1]+"[/VIDEO]"));return r})).replace(/\<noscript[^\>]*>/gi,"").replace(/\<\/noscript[^\>]*>/gi,"")).replace(/\003([^\004]*)\004/gi," ")).replace(/\<table class\=[\"]*forum-quote[\"]*\>[^<]*\<thead\>[^<]*\<tr\>[^<]*\<th\>([^<]+)\<\/th\>\<\/tr\>\<\/thead\>[^<]*\<tbody\>[^<]*\<tr\>[^<]*\<td\>/gi,"")).replace(/\<table class\=[\"]*forum-code[\"]*\>[^<]*\<thead\>[^<]*\<tr\>[^<]*\<th\>([^<]+)\<\/th\>\<\/tr\>\<\/thead\>[^<]*\<tbody\>[^<]*\<tr\>[^<]*\<td\>/gi,"")).replace(/\<table class\=[\"]*data-table[\"]*\>[^<]*\<tbody\>/gi,"")).replace(/\<\/td\>[^<]*\<\/tr\>(\<\/tbody\>)*\<\/table\>/gi,"")).replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");for(var r=0;r++<50&&(0<=t.search(/\002([^\002\003]*)\003/gi)||0<=t.search(/\001([^\001\003]*)\003/gi));)t=t.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]");function i(e,o,t){for(var a=new RegExp("([^]*)("+o+")([^]*)","i"),r=new RegExp("((?:)(?:[^]*))("+o+")((?:[^]*)(?:))","i"),i=0;i++<300&&0<=e.search(a);)e=e.replace(r,"$1"+t+"$3");return e}for(r=0;r++<10&&0<=t.search(/\004([^\004\003]*)\003/gi);)t=(t=i(t=i(t=i(t=i(t,"<tr>","[TR]"),"</tr>","[/TR]"),"<td>","[TD]"),"</td>","[/TD]")).replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]");if(t=(t=(t=(t=(t=(t=(t=BX.browser.IsIE()?t.replace(/\<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s\>]*))*\>/gi,"$1"):t.replace(/\<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*\>/gi,"$1")).replace(/\<a[^>]+href=[\"]([^\"]+)\"[^>]+\>([^<]+)\<\/a\>/gi,"[URL=$1]$2[/URL]")).replace(/\<a[^>]+href=[\']([^\']+)\'[^>]+\>([^<]+)\<\/a\>/gi,"[URL=$1]$2[/URL]")).replace(/\<[^\>]+\>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')).replace(/(smile(?=[:;8]))/g,"")).replace(/\&shy;/gi,"")).replace(/\&nbsp;/gi," "),null!=e&&e&&(t=e+oText.author+t),window.oLHE&&t){if("code"==window.oLHE.sEditorMode&&window.oLHE.bBBCode)window.oLHE.WrapWith("[QUOTE]","[/QUOTE]",t);else if("html"==window.oLHE.sEditorMode){var n=window.oLHE.bBBCode?"":' id"='+window.oLHE.SetBxTag(!1,{tag:"quote"})+'"';window.oLHE.InsertHTML('<blockquote class="bx-quote"'+n+">"+window.oLHE.ParseContent(t,!0)+"</blockquote><br/>")}window.oLHE.SetFocus(),BX.defer(window.oLHE.SetFocus,window.oLHE)()}}return!1}BX(function(){if(BX.browser.IsIE()){var e=BX.findChildren(document,{className:"reviews-post-table"},!0);if(!e)return;for(t in e)for(var o=e[t].getElementsByTagName("*"),t=o.length;t--;)o[t].scrollWidth>o[t].offsetWidth&&(o[t].style.paddingBottom="20px",o[t].style.overflowY="hidden")}});