BX.saleOrderAjax={BXCallAllowed:!1,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(t){var e=this;this.options=t,window.submitFormProxy=BX.proxy(function(){e.submitFormProxy.apply(e,arguments)},this),BX(function(){e.initDeferredControl()}),BX(function(){e.BXCallAllowed=!0}),this.controls.scope=BX("order_form_div"),BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},function(){var t=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(t,BX("ORDER_FORM")),e.BXCallAllowed=!1,submitForm()})},cleanUp:function(){for(var t in this.properties)this.properties.hasOwnProperty(t)&&(void 0!==this.properties[t].input&&(BX.unbindAll(this.properties[t].input),this.properties[t].input=null),void 0!==this.properties[t].control&&BX.unbindAll(this.properties[t].control));this.properties={}},addPropertyDesc:function(t){this.properties[t.id]=t.attributes,this.properties[t.id].id=t.id},initDeferredControl:function(){var t,e,o,i,r,s,n,p,l,a=this;if(void 0!==window.BX.locationsDeferred)for(t in this.BXCallAllowed=!1,window.BX.locationsDeferred)window.BX.locationsDeferred[t].call(this),window.BX.locationsDeferred[t]=null,delete window.BX.locationsDeferred[t],this.properties[t].control=window.BX.locationSelectors[t],delete window.BX.locationSelectors[t];for(t in this.properties){if(this.properties[t].isZip&&(e=this.controls.scope.querySelector('[data-property-id-row="'+t+'"]'),BX.type.isElementNode(e)&&(o=e.querySelector('input[type="text"]'),BX.type.isElementNode(o)))){for(r in this.properties[t].input=o,i=!1,this.properties)if("LOCATION"==this.properties[r].type){i=r;break}!1!==i&&BX.bindDebouncedChange(o,function(t){e=o=null,BX.type.isNotEmptyString(t)&&/^\s*\d+\s*$/.test(t)&&3<t.length&&a.getLocationByZip(t,function(t){a.properties[i].control.setValueByLocationId(t)},function(){try{a.properties[i].control.clearSelected(locationId)}catch(t){}})})}"LOCATION"==this.properties[t].type&&void 0!==this.properties[t].control&&(n=(s=this.properties[t].control).getSysCode(),void 0!==this.properties[t].altLocationPropId&&("sls"==n&&s.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt),"slst"==n&&function(t,i){i.setOption("pseudoValues",["other"]),i.bindEvent("control-before-display-page",function(t){i=null;var e=t.getParentValue();if(e!=this.getOption("rootNodeValue")&&this.checkCanSelectItem(e)){var o=t.getControl();void 0===o.vars.cache.nodes.other&&o.fillCache([{CODE:"other",DISPLAY:a.options.messages.otherLocation,IS_PARENT:!1,VALUE:"other"}],{modifyOrigin:!0,modifyOriginPosition:"prepend"})}}),p=BX("LOCATION_ALT_PROP_DISPLAY_MANUAL["+parseInt(t)+"]"),i.bindEvent("after-select-real-value",function(){BX.type.isDomNode(p)&&(p.value="0")}),i.bindEvent("after-select-pseudo-value",function(){BX.type.isDomNode(p)&&(p.value="1")}),i.bindEvent("before-set-value",function(){BX.type.isDomNode(p)&&(p.value="0")}),BX.type.isDomNode(p)&&"1"==p.value&&null!=(l=i.getAdapterAtPosition(i.getStackSize()-1))&&l.setValuePair("other",a.options.messages.otherLocation)}(t,s)))}this.BXCallAllowed=!0},checkMode:function(t,e){if("altLocationChoosen"==e&&this.checkAbility(t,"canHaveAltLocation")){var o=this.getInputByPropId(this.properties[t].altLocationPropId),i=this.properties[t].altLocationPropId;if(!1!==o&&0<o.value.length&&!o.disabled&&"default"!=this.properties[i].valueSource)return!0}return!1},checkAbility:function(t,e){if(void 0===this.properties[t]&&(this.properties[t]={}),void 0===this.properties[t].abilities&&(this.properties[t].abilities={}),void 0!==this.properties[t].abilities&&this.properties[t].abilities[e])return!0;if("canHaveAltLocation"==e&&"LOCATION"==this.properties[t].type&&void 0!==this.properties[t].altLocationPropId&&(this.properties[this.properties[t].altLocationPropId],1)){var o=this.properties[t].altLocationPropId;if(void 0!==this.properties[t].control&&"slst"==this.properties[t].control.getSysCode()&&!1!==this.getInputByPropId(o))return this.properties[t].abilities[e]=!0}return!1},getInputByPropId:function(t){if(void 0!==this.properties[t].input)return this.properties[t].input;var e=this.getRowByPropId(t);if(BX.type.isElementNode(e)){var o=e.querySelector('input[type="text"]');if(BX.type.isElementNode(o))return this.properties[t].input=o}return!1},getRowByPropId:function(t){if(void 0!==this.properties[t].row)return this.properties[t].row;var e=this.controls.scope.querySelector('[data-property-id-row="'+t+'"]');return!!BX.type.isElementNode(e)&&(this.properties[t].row=e)},getAltLocPropByRealLocProp:function(t){return void 0!==this.properties[t].altLocationPropId&&this.properties[this.properties[t].altLocationPropId]},toggleProperty:function(t,e,o){var i=this.properties[t];void 0===i.row&&(i.row=this.getRowByPropId(t)),void 0===i.input&&(i.input=this.getInputByPropId(t)),e?(o||BX.show(i.row),i.input.disabled=!1):(o||BX.hide(i.row),i.input.disabled=!0)},submitFormProxy:function(t,e){for(var o in this.properties)if(void 0!==this.properties[o].control&&this.properties[o].control==e){o;break}"other"!=t&&this.BXCallAllowed&&(this.BXCallAllowed=!1,submitForm())},getPreviousAdapterSelectedNode:function(t,e){var o=e.getIndex(),i=t.getAdapterAtPosition(o-1);if(void 0!==i&&null!=i){var r=i.getControl().getValue();if(void 0!==r){var s=t.getNodeByValue(r);return void 0!==s&&s}}return!1},getLocationByZip:function(e,o,i){if(void 0===this.indexCache[e]){ShowWaitWindow();var r=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:!0,processData:!0,emulateOnload:!0,start:!0,data:{ACT:"GET_LOC_BY_ZIP",ZIP:e},onsuccess:function(t){CloseWaitWindow(),t.result?(r.indexCache[e]=t.data.ID,o.apply(r,[t.data.ID])):i.call(r)},onfailure:function(t,e){CloseWaitWindow()}})}else o.apply(this,[this.indexCache[e]])}};