function initDraggableOrderControl(t){var a=JSON.parse(t.data);a&&BX.loadScript("/bitrix/js/main/core/core_dragdrop.js",function(){!function r(){BX.DragDrop?window["dnd_parameter_"+t.propertyID]=new DragNDropOrderParameterControl(a,t):setTimeout(r,50)}()})}function DragNDropOrderParameterControl(r,t){var a=BX.util.getRandomString(5);this.params=t||{},this.items=this.getSortedItems(r),this.rootElementId="dnd_params_container_"+this.params.propertyID+"_"+a,this.dragItemClassName="dnd-order-draggable-item-"+this.params.propertyID+"-"+a,BX.loadCSS(this.getPath()+"/style.css?"+a),this.buildNodes(),this.initDragDrop()}DragNDropOrderParameterControl.prototype={getPath:function(){var r=this.params.propertyParams.JS_FILE.split("/");return r.pop(),r.join("/")},getSortedItems:function(r){if(!r)return[];var t,a=[],e=(this.params.oInput.value||this.params.propertyParams.DEFAULT||"").split(",");for(t in e)e.hasOwnProperty(t)&&(e[t]=BX.util.trim(e[t]),r[e[t]]&&a.push({value:e[t],message:r[e[t]]}));for(t in r)r.hasOwnProperty(t)&&!BX.util.in_array(t,e)&&a.push({value:t,message:r[t]});return a},buildNodes:function(){var r=BX.create("DIV",{props:{className:"dnd-order-draggable-control-container",id:this.rootElementId}});for(var t in this.items)this.items.hasOwnProperty(t)&&r.appendChild(BX.create("DIV",{attrs:{"data-value":this.items[t].value},props:{className:"dnd-order-draggable-control dnd-order-draggable-item "+this.dragItemClassName},text:this.items[t].message}));this.params.oCont.appendChild(r)},initDragDrop:function(){BX.isNodeInDom(this.params.oCont)?this.dragdrop=BX.DragDrop.create({dragItemClassName:this.dragItemClassName,dragItemControlClassName:"dnd-order-draggable-control",sortable:{rootElem:BX(this.rootElementId)},dragEnd:BX.delegate(function(r,t,a){this.saveData()},this)}):setTimeout(BX.delegate(this.initDragDrop,this),50)},saveData:function(){var r=this.params.oCont.querySelectorAll("."+this.dragItemClassName),t=[];for(var a in r)r.hasOwnProperty(a)&&t.push(r[a].getAttribute("data-value"));this.params.oInput.value=t.join(",")}};