(function(){function a(c){this.config=c;this.id=this.config.id;this.searchIndex=[];this._searchResult=[];this._searchResultSect=[];this._searchResultLabel=[];this.paramsCache={};this.Init()}a.prototype={Init:function(){var c=this;window.__bxResult=window.__bxResult||{};this.params={};BX.addCustomEvent(this,"OnComponentParamsDisplay",function(d){c.params=d;c.GetComponentParams(d)});BX.addCustomEvent(this,"OnComponentParamsResize",function(e,d){c.Resize(e,d)})},GetComponentParams:function(f){var m=this,h=this.GetCachedParams(f);if(!f.relPath&&this.config.relPath){f.relPath=this.config.relPath}if(h){o(h)}else{var n={},e,g,j;for(g in f.currentValues){if(f.currentValues.hasOwnProperty(g)){e=f.currentValues[g];if(typeof e=="string"&&e==="undefined"){n[g]=""}else{if(typeof e=="string"&&e.substr(0,8).toLowerCase()=="={array("){n[g]=this.GetArray(e.substr(2,e.length-3))}else{n[g]=f.currentValues[g]}}if(typeof n[g]=="object"){for(j=0;j<n[g].length;j++){if(n[g][j]==="undefined"||n[g][j]===undefined){n[g][j]=""}}}}}var c=this.config.requestUrl,l=Math.round(Math.random()*1000000),d={component_params_manager:l,sessid:BX.bitrix_sessid(),site_template:f.siteTemplate||"",site:f.siteId||BX.message("SITE_ID"),component_name:f.name,component_template:f.template,current_values:n};window.__bxResult[l]=null;BX.ajax.post(c,d,function(){setTimeout(function(){o(window.__bxResult[l]);m.SetCachedParams(f,window.__bxResult[l])},100)})}function o(k){var i=m.BuildComponentParams(k,f);BX.adminFormTools.modifyFormElements(i);if(f.callback&&typeof f.callback=="function"){f.callback({},i)}}},LoadComponentParams:function(g){var f=this.GetCachedParams(g);if(f){if(g.callback&&typeof g.callback=="function"){g.callback()}}else{var h=this,d=this.config.requestUrl,e=Math.round(Math.random()*1000000),c={component_params_manager:e,sessid:BX.bitrix_sessid(),site_template:g.siteTemplate||"",component_name:g.name,component_template:g.template,current_values:g.currentValues};window.__bxResult[e]=null;BX.ajax.post(d,c,function(){setTimeout(function(){h.SetCachedParams(g,window.__bxResult[e])},10)})}},GetCachedParams:function(c){if(this.IsEmpty(c.currentValues)&&this.paramsCache[c.name]&&this.paramsCache[c.name][this.GetCacheId(c)]){return this.paramsCache[c.name][this.GetCacheId(c)]}else{return false}},SetCachedParams:function(c,d){if(!this.paramsCache[c.name]){this.paramsCache[c.name]={}}if(this.IsEmpty(c.currentValues)){this.paramsCache[c.name][this.GetCacheId(c)]=d}},GetCacheId:function(c){return c.name+"|"+c.siteTemplate+"|"+c.template},IsEmpty:function(c){for(var d in c){if(c.hasOwnProperty(d)){return false}}return true},BuildComponentParams:function(y,w){var n=w.container,t=this,u,m,f,h,q;this.paramsIndex={};this.groupIndex={};if(!y.groupIndex){y.groupIndex={}}this.searchIndex=[];BX.cleanNode(n);BX.addClass(n,"bxcompprop-wrap");var v=BX.GetWindowScrollPos();this.pContainer=n;this.pLeftSide=n.appendChild(BX.create("DIV",{props:{className:"bxcompprop-left"}}));var g=this.pLeftSide.appendChild(BX.create("DIV",{props:{className:"bxcompprop-l-top"}}));this.pSearchInput=g.appendChild(BX.create("INPUT",{props:{type:"text",className:"bxcompprop-search",placeholder:BX.message("CompParManSearch")}}));BX.bind(this.pSearchInput,"keyup",BX.proxy(this.SearchCheck,this));this.pGroupsIndex=this.pLeftSide.appendChild(BX.create("DIV",{props:{className:"bxcompprop-items-block"}}));BX.bind(this.pGroupsIndex,"click",BX.proxy(this.GoToGroup,this));this.pParamsCont=n.appendChild(BX.create("DIV",{props:{className:"bxcompprop-right"}}));var o=this.pParamsCont.appendChild(BX.create("DIV",{props:{className:"bxcompprop-title"}}));var x=o.appendChild(BX.create("SPAN",{props:{className:"bxcompprop-title-text"}}));this.pTitle=x.appendChild(BX.create("SPAN",{props:{className:"bxcompprop-title-text-lbl"},text:y.description.NAME}));this.pHelpIcon=x.appendChild(BX.create("SPAN",{props:{className:"bxcompprop-title-info-btn"}}));this.pHelpIcon.title=y.description.DESCRIPTION;this.pName=x.appendChild(BX.create("SPAN",{props:{className:"bxcompprop-title-description"},text:w.name}));var z=this.pParamsCont.appendChild(BX.create("DIV",{props:{className:"bxcompprop-content"}}));z.appendChild(BX.create("DIV",{props:{className:"bxcompprop-nothing-found"},text:BX.message("NoSearchResults")}));this.pParamsTable=z.appendChild(BX.create("TABLE",{props:{className:"bxcompprop-content-table"}}));this.pParamsWrap=z;BX.bind(this.pParamsWrap,"scroll",BX.proxy(this.CheckActiveGroup,this));var l,j,c,d;if(!y.groupIndex.COMPONENT_TEMPLATE&&y.templates.length>0){y.groups=[{ID:"COMPONENT_TEMPLATE",NAME:BX.message("TemplateGroup"),SORT:0}].concat(y.groups)}for(u=0;u<y.groups.length;u++){m=y.groups[u];l=BX.create("DIV",{props:{className:"bxcompprop-item"},attrs:{"data-bx-comp-group-id":m.ID},html:'<span class="bxcompprop-item-alignment"></span><span class="bxcompprop-item-text">'+BX.util.htmlspecialchars(m.NAME)+"</span>"});this.pGroupsIndex.appendChild(l);d=document.createDocumentFragment();c=BX.adjust(d.appendChild(BX.create("TR")),{props:{className:"bxcompprop-prop-tr"}});j=BX.adjust(c.insertCell(-1),{props:{className:"bxcompprop-cont-table-title",colSpan:2},text:m.NAME});this.groupIndex[m.ID]=y.groupIndex[m.ID]={group:m,frag:d,leftIndex:l,titleCell:j,titleRow:c,empty:m.ID!="COMPONENT_TEMPLATE"};if(u===0){this.SetActiveGroup(m.ID)}}if(y.templates.length>0){this.DisplayTemplateSelector(y.templates,w.template)}var s,p,e,r;if(w.currentValues.SEF_URL_TEMPLATES){p=w.currentValues.SEF_URL_TEMPLATES;if(typeof p=="object"){e=p}else{e=this.GetArray((p.substr(0,8).toLowerCase()=="={array(")?p.substr(2,p.length-3):p)}for(s in e){if(e.hasOwnProperty(s)){w.currentValues["SEF_URL_TEMPLATES_"+s]=e[s]}}delete w.currentValues.SEF_URL_TEMPLATES}if(w.currentValues.VARIABLE_ALIASES&&w.currentValues.SEF_MODE=="N"){p=w.currentValues.VARIABLE_ALIASES;if(typeof p=="object"){r=p}else{r=this.GetArray((p.substr(0,8).toLowerCase()=="={array(")?p.substr(2,p.length-3):p)}for(s in r){if(r.hasOwnProperty(s)){w.currentValues["VARIABLE_ALIASES_"+s]=r[s]}}delete w.currentValues.VARIABLE_ALIASES}for(u=0;u<y.parameters.length;u++){h=y.parameters[u];q=w.currentValues[h.ID];this.paramsIndex[h.ID]={param:h,value:q}}for(u=0;u<y.parameters.length;u++){h=y.parameters[u];q=w.currentValues[h.ID];h.TOOLTIP=y.tooltips[h.ID+"_TIP"]||"";if(!this.groupIndex[h.PARENT]){if(this.groupIndex.ADDITIONAL_SETTINGS){h.PARENT="ADDITIONAL_SETTINGS"}else{if(this.groupIndex.BASE){h.PARENT="BASE"}}}if(h.ID=="SEF_FOLDER"&&!h.DEFAULT&&w.relPath){h.DEFAULT=(w.relPath!="/"?w.relPath:"")+"/"}if(this.BuildComponentParameter(h,q,this.groupIndex[h.PARENT].frag)){this.groupIndex[h.PARENT].empty=false}}for(u=0;u<y.groups.length;u++){m=y.groups[u];if(this.groupIndex[m.ID].empty){this.groupIndex[m.ID].leftIndex.style.display="none";this.groupIndex[m.ID].titleRow.style.display="none"}else{this.pParamsTable.appendChild(this.groupIndex[m.ID].frag);this.lastTitle=this.groupIndex[m.ID].titleCell}}this.lastCell=BX.adjust(this.pParamsTable.appendChild(BX.create("TR")).insertCell(-1),{props:{className:"bxcompprop-last-empty-cell"},attrs:{colSpan:2}});window.scrollTo(v.scrollLeft,v.scrollTop);setTimeout(function(){window.scrollTo(v.scrollLeft,v.scrollTop);if(t.savedScrollTop){t.pParamsWrap.scrollTop=t.savedScrollTop;t.savedScrollTop=0}},50);BX.onCustomEvent(this,"onComponentParamsBuilt");return n},GoToGroup:function(f){var d=f.target||f.srcElement,c=(d&&d.getAttribute)?d.getAttribute("data-bx-comp-group-id"):null;if(!c){d=BX.findParent(d,function(e){return e.getAttribute&&e.getAttribute("data-bx-comp-group-id")},this.pGroupsIndex);c=(d&&d.getAttribute)?d.getAttribute("data-bx-comp-group-id"):null}if(c){this.pParamsWrap.scrollTop=this.groupIndex[c].titleCell.offsetTop;this.CheckActiveGroup(c)}},CheckActiveGroup:function(d){if(d&&this.groupIndex.hasOwnProperty(d)){this.SetActiveGroup(d)}else{var c,f,e=this.pParamsWrap.scrollTop;for(f in this.groupIndex){if(this.groupIndex.hasOwnProperty(f)&&!this.groupIndex[f].empty){c=this.groupIndex[f].titleCell.offsetTop;if(e>=c-10){this.SetActiveGroup(f)}}}}},SetActiveGroup:function(e){if(this.activeGroupId&&this.groupIndex[this.activeGroupId]){BX.removeClass(this.groupIndex[this.activeGroupId].leftIndex,"bxcompprop-item-active")}this.activeGroupId=e;BX.addClass(this.groupIndex[e].leftIndex,"bxcompprop-item-active");var d=this.groupIndex[e].leftIndex.offsetHeight+10,g=this.pGroupsIndex.scrollTop,c=this.pGroupsIndex.offsetHeight,f=this.groupIndex[e].leftIndex.offsetTop;if(g+c<f+d){this.pGroupsIndex.scrollTop=f+d-c}else{if(f<g){this.pGroupsIndex.scrollTop=f}}},CheckLastCell:function(){if(this.lastCell&&this.lastTitle){var d=this.pParamsWrap.offsetHeight,c=this.lastCell.offsetTop-this.lastTitle.offsetTop+10;this.lastCell.style.height=Math.max((d-c),0)+"px"}},Resize:function(c,f){var e=this.pLeftSide.offsetWidth,d=c-e-40;this.pContainer.style.width=c+"px";this.pContainer.style.height=f+"px";this.pParamsCont.style.width=d+"px";this.pParamsCont.style.height=(f-12)+"px";this.pParamsWrap.style.height=(f-98)+"px";this.pGroupsIndex.style.height=(f-100)+"px";this.pLeftSide.style.height=(f-50)+"px";this.CheckLastCell()},BuildComponentParameter:function(i,f,j){if(!i.TYPE){i.TYPE="STRING"}if(i.ID=="SEF_MODE"){i.TYPE="CHECKBOX"}i.TYPE=i.TYPE.toUpperCase();if(!i.ROWS){i.ROWS=0}i.MULTIPLE=(i.MULTIPLE&&i.MULTIPLE.toUpperCase())=="Y"?"Y":"N";if(typeof f=="string"&&f==="undefined"){f=undefined}var d=f;if(typeof f=="string"){if(this.IsPHPBracket(f)){f=this.TrimPHPBracket(f)}if(f.substr(0,6).toLowerCase()=="array("){f=this.ConvertStringToArray(f,true)}else{if(i.TYPE=="LIST"){if(f!==d){f=[d]}else{f=[f]}}else{if(this.IsNum(f)){f=parseFloat(f)}else{f=d}}}}if(i.MULTIPLE=="Y"){i.CNT=parseInt(i.CNT,10);if(i.CNT<1){i.CNT=1}}var c=this.GetParamValueById("SEF_MODE");c=c&&c.toUpperCase()=="Y";if(c){if(i.ID.substr(0,16)=="VARIABLE_ALIASES"){return false}}else{if(i.ID.substr(0,17)=="SEF_URL_TEMPLATES"){return false}if(i.ID=="SEF_FOLDER"){return false}if(i.ID=="SEF_RULE"){return false}}i._propId=BX.util.htmlspecialchars(i.ID||Math.round(Math.random()*10000))+"_"+this.id;if(i.HIDDEN&&i.HIDDEN.toString().toUpperCase()=="Y"&&f!==undefined){return this.DisplayHiddenParam(i,f,j)}var e=BX.adjust(j.appendChild(BX.create("TR")),{props:{className:"bxcompprop-prop-tr"}}),h=BX.adjust(e.insertCell(-1),{props:{className:"bxcompprop-cont-table-l"},html:'<label class="bxcompprop-label" for="'+i._propId+'">'+BX.util.htmlspecialchars(i.NAME||"")+":</label>"}),g=BX.adjust(e.insertCell(-1),{props:{className:"bxcompprop-cont-table-r"}});switch(i.TYPE){case"LIST":this.DisplayParamList(i,f,g);break;case"CHECKBOX":this.DisplayParamCheckbox(i,f,g);break;case"COLORPICKER":this.DisplayParamColorpicker(i,f,g);break;case"FILE":this.DisplayParamFile(i,f,g);break;case"TEMPLATES":this.DisplayParamTemplates(i,f,g);break;case"CUSTOM":this.DisplayParamCustom(i,f,g);break;default:this.DisplayParamString(i,f,g);break}if(i.TOOLTIP){new BX.CHint({hint:i.TOOLTIP,parent:g.appendChild(BX.create("I",{props:{className:"bxcompprop-info-btn"}}))})}this.searchIndex.push({content:i.ID.toLowerCase()+" "+(i.NAME||"").toLowerCase(),elementWrap:e,label:h.firstChild,name:i.NAME||"",groupId:i.PARENT||""});return true},DisplayParamList:function(j,o,e){j.SIZE=parseInt(j.SIZE,10);if(!j.SIZE){j.SIZE=j.MULTIPLE=="Y"?3:1}j.COLS=parseInt(j.COLS,10)||20;j.CNT=Math.max(parseInt(j.CNT),1)||1;if(o==undefined||o==["undefined"]){o=j.DEFAULT}if(typeof o=="object"){for(k=0;k<o.length;k++){if(o[k]==="undefined"||o[k]===undefined){o[k]=""}}}if(!j.VALUES){j.VALUES=[]}j.ADDITIONAL_VALUES=(j.ADDITIONAL_VALUES&&j.ADDITIONAL_VALUES.toUpperCase())=="Y"?"Y":"N";var d=j._propId,m=this,q=false,s={},h,p,f,k,c=j.ID+(j.MULTIPLE=="Y"?"[]":""),n=BX.create("SELECT",{props:{size:j.SIZE,name:c,multiple:j.MULTIPLE=="Y",id:d},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}});n.onchange=BX.proxy(this.OnChageParams,this);if(j.VALUES["-"]){p="-";h=j.VALUES[p].toString();f=new Option(h,p,false,false);n.options.add(f)}for(p in j.VALUES){if(j.VALUES.hasOwnProperty(p)&&p!=="-"){h=j.VALUES[p].toString();f=new Option(h,p,false,false);n.options.add(f);if(j.ID=="COMPONENT_TEMPLATE"&&(p==o||p==".default"&&o==""||p==""&&o==".default")){this.SetOptionSelected(f,true);s[p]=true;q=true}else{if(typeof o=="object"&&BX.util.in_array(p,o)){this.SetOptionSelected(f,true);s[p]=true;q=true}else{if(typeof o=="string"&&p==o){this.SetOptionSelected(f,true);s[p]=true;q=true}}}}}e.appendChild(n);if(j.ADDITIONAL_VALUES=="Y"){f=new Option(j.MULTIPLE=="Y"?BX.message("CompParManNoValue"):BX.message("CompParManSelectOther"),"",!q,!q);n.options.add(f,0);if(!q){this.SetOptionSelected(f,true)}var g=typeof o=="object"?o:[o];if(j.MULTIPLE=="Y"){for(p in g){if(!g.hasOwnProperty(p)||s[g[p]]||g[p]==""||g[p]==undefined){continue}e.appendChild(BX.create("BR"));if(j.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:j.COLS,name:c,value:g[p]},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}else{e.appendChild(BX.create("INPUT",{props:{size:j.COLS,name:c,value:g[p],type:"text"},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}}for(k=0;k<j.CNT;k++){e.appendChild(BX.create("BR"));if(j.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:j.COLS,name:c,value:""},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}else{e.appendChild(BX.create("INPUT",{props:{size:j.COLS,name:c,value:"",type:"text"},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}}var l=e.appendChild(BX.create("INPUT",{props:{type:"button",value:"+"},attrs:{"data-bx-property-id":j.ID},events:{click:function(){if(j.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:j.COLS,name:c,value:""},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(m.OnChageParams,m)}else{e.appendChild(BX.create("INPUT",{props:{size:j.COLS,name:c,value:"",type:"text"},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(m.OnChageParams,m)}e.appendChild(l)}}}))}else{var r;for(p in g){if(!g.hasOwnProperty(p)){continue}if(g[p]===undefined||g[p]==="undefined"){g[p]=""}e.appendChild(BX.create("BR"));if(j.ROWS>1){r=e.appendChild(BX.create("TEXTAREA",{props:{name:c+"_alt",value:s[g[p]]?"":g[p],disabled:q,cols:j.COLS},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}}));r.onchange=BX.proxy(this.OnChageParams,this)}else{r=e.appendChild(BX.create("INPUT",{props:{name:c+"_alt",value:s[g[p]]?"":g[p],disabled:q,size:j.COLS,type:"text"},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}}));r.onchange=BX.proxy(this.OnChageParams,this)}}if(r){BX.bind(n,"change",function(){r.disabled=n.value!=""})}}if(j.REFRESH=="Y"){e.appendChild(BX.create("INPUT",{props:{type:"button",value:"ok",className:"bxcompprop-ok-btn"},events:{click:BX.proxy(this.DoRefreshParams,this)}}));BX.addClass(e,"bxcompprop-cont-table-r-refreshed")}}},DisplayParamCheckbox:function(h,f,c){if(f!=undefined){f=f&&f.toUpperCase()=="Y"?"Y":"N"}else{if(h.DEFAULT){f=h.DEFAULT.toUpperCase()=="Y"?"Y":"N"}else{f="N"}}var e=h._propId,d=h.ID+(h.MULTIPLE=="Y"?"[]":""),g=BX.create("INPUT",{props:{type:"checkbox",name:d,checked:f=="Y",id:e},attrs:{"data-bx-property-id":h.ID,"data-bx-comp-prop":true}});g.onchange=BX.proxy(this.OnChageParams,this);c.appendChild(g);if(h.ID=="SEF_MODE"){h.REFRESH="Y"}},DisplayParamColorpicker:function(h,f,c){h.COLS=parseInt(h.COLS,10)||20;if(f==undefined){f=h.DEFAULT||""}var d=h._propId,j=this,g=c.appendChild(BX.create("INPUT",{props:{size:h.COLS,name:h.ID,value:f,type:"text",id:d},attrs:{"data-bx-property-id":h.ID,"data-bx-comp-prop":true},style:{minWidth:"100px"}}));g.onchange=BX.proxy(this.OnChageParams,this);if(!this.Colorpicker){function e(k){e.superclass.constructor.apply(this,arguments)}BX.extend(e,BXColorPicker);e.prototype.BeforeCreate=function(){if(this.oPar.input){this.pWnd=this.oPar.input;BX.bind(this.oPar.input,"click",BX.proxy(this.OnClick,this))}};this.Colorpicker=e}var i=new this.Colorpicker({id:h.ID+"_colorpicker",input:g,zIndex:3100,OnSelect:function(k){g.value=k;j.OnChageParams(false,h.ID)}})},DisplayParamFile:function(g,j,e){g.COLS=parseInt(g.COLS,10)||20;if(j==undefined){j=g.DEFAULT||""}var d=g._propId,i=this,k=e.appendChild(BX.create("INPUT",{props:{size:g.COLS,name:g.ID,value:j,type:"text",id:d},attrs:{"data-bx-property-id":g.ID,"data-bx-comp-prop":true},style:{minWidth:"70%"}}));k.onchange=BX.proxy(this.OnChageParams,this);if(g.FD_USE_MEDIALIB){var h=window["_bxMlBrowseButton_"+g.ID.toLowerCase()];var c=e.appendChild(BX.create("DIV",{props:{className:"bxcompprop-file-dialog-wrap"},html:""}));function f(){h=window["_bxMlBrowseButton_"+g.ID.toLowerCase()];if(!h){return}var l=BX.processHTML(h);setTimeout(function(){if(l.SCRIPT&&l.SCRIPT.length>0){var p,n="";for(var o=0;o<l.SCRIPT.length;o++){p=l.SCRIPT[o];if(p.isInternal){n+=";"+p.JS}}BX.evalGlobal(n)}},100);c.innerHTML=l.HTML;var m=BX("bx_fd_input_"+g.ID.toLowerCase());if(m){m.onclick=window["BX_FD_"+g.ID]}}if(!h){setTimeout(f,100)}else{f()}}else{e.appendChild(BX.create("INPUT",{props:{type:"button",value:"..."},events:{click:window["BX_FD_"+g.ID]}}))}window["BX_FD_ONRESULT_"+g.ID]=function(l,m){if(typeof l=="object"){k.value=l.src}else{k.value=(m+"/"+l).replace(/\/\//ig,"/")}i.OnChageParams(false,g.ID)};if(g.REFRESH=="Y"){e.appendChild(BX.create("INPUT",{props:{type:"button",value:"ok",className:"bxcompprop-ok-btn"},events:{click:BX.proxy(this.DoRefreshParams,this)}}));BX.addClass(e,"bxcompprop-cont-table-r-refreshed")}},DisplayParamTemplates:function(j,i,c){j.COLS=parseInt(j.COLS,10)||20;j.CNT=1;j.MULTIPLE="N";var e=j._propId;if(i==undefined){i=j.DEFAULT||""}var d=c.appendChild(BX.create("INPUT",{props:{size:j.COLS,name:j.ID,value:i,type:"text",id:e},attrs:{"data-bx-property-id":j.ID,"data-bx-comp-prop":true}}));d.onchange=BX.proxy(this.OnChageParams,this);var h=[];for(var g in j.VALUES){if(j.VALUES.hasOwnProperty(g)){h[h.length]={text:j.VALUES[g].TEXT||"",title:j.VALUES[g].TITLE||"",onclick:function(l,k,n){function m(){if(n.PARAMETER_LINK&&n.PARAMETER_VALUE){l.SetParamValueById(n.PARAMETER_LINK,n.PARAMETER_VALUE)}var r=n.TEMPLATE;if(document.selection){k.focus();var s=document.selection.createRange();s.text=r}else{if(k.selectionStart||k.selectionStart=="0"){var q=k.selectionStart;var p=k.selectionEnd;var o=q+r.length;k.value=k.value.substring(0,q)+r+k.value.substring(p,k.value.length);k.setSelectionRange(o,o);k.focus()}else{k.value+=r;k.focus()}}BX.fireEvent(k,"change");k.focus()}return m}(this,d,j.VALUES[g])}}}if(h.length>0){var f=c.appendChild(BX.create("INPUT",{props:{type:"button",value:"..."}}));f.onclick=function(){BX.PopupMenu.show("mnu_"+e,f,h,{zIndex:5000})}}},DisplayParamString:function(f,k,e){f.COLS=parseInt(f.COLS,10)||20;f.CNT=Math.max(parseInt(f.CNT),1)||1;var l,g,j=this,c=f._propId,d=f.ID+(f.MULTIPLE=="Y"?"[]":"");if(k==undefined){k=f.DEFAULT||""}if(f.MULTIPLE!="Y"){if(f.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:f.COLS,name:d,value:k,id:c},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}else{e.appendChild(BX.create("INPUT",{props:{size:f.COLS,name:d,value:k,type:"text",id:c},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}}else{for(l in k){if(!k.hasOwnProperty(l)||k[l]==""){continue}e.appendChild(BX.create("BR"));if(f.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:f.COLS,name:d,value:k[l]},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}else{e.appendChild(BX.create("INPUT",{props:{size:f.COLS,name:d,value:k[l],type:"text"},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}}for(g=0;g<f.CNT;g++){e.appendChild(BX.create("BR"));if(f.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:f.COLS,name:d,value:""},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}else{e.appendChild(BX.create("INPUT",{props:{size:f.COLS,name:d,value:"",type:"text"},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(this.OnChageParams,this)}}var h=e.appendChild(BX.create("INPUT",{props:{type:"button",value:"+"},attrs:{"data-bx-property-id":f.ID},events:{click:function(){if(f.ROWS>1){e.appendChild(BX.create("TEXTAREA",{props:{cols:f.COLS,name:d,value:""},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(j.OnChageParams,j)}else{e.appendChild(BX.create("INPUT",{props:{size:f.COLS,name:d,value:"",type:"text"},attrs:{"data-bx-property-id":f.ID,"data-bx-comp-prop":true}})).onchange=BX.proxy(j.OnChageParams,j)}e.appendChild(h)}}}))}if(f.REFRESH=="Y"){e.appendChild(BX.create("INPUT",{props:{type:"button",value:"ok",className:"bxcompprop-ok-btn"},events:{click:BX.proxy(this.DoRefreshParams,this)}}));BX.addClass(e,"bxcompprop-cont-table-r-refreshed")}},DisplayParamCustom:function(h,f,c){if(!h.JS_FILE||!h.JS_EVENT){return}if(f==undefined){f=h.DEFAULT||""}var d=h.ID+(h.MULTIPLE=="Y"?"[]":""),g=c.appendChild(BX.create("INPUT",{props:{type:"hidden",name:d,value:f,id:h._propId},attrs:{"data-bx-property-id":h.ID,"data-bx-comp-prop":true}}));g.onchange=BX.proxy(this.OnChageParams,this);function e(j){return function(){if(window[j.propertyParams.JS_EVENT]&&typeof window[j.propertyParams.JS_EVENT]=="function"){window[j.propertyParams.JS_EVENT](j)}}}var i=e({propertyID:h.ID,propertyParams:h,getElements:BX.proxy(this.GetNamedControls,this),oInput:g,oCont:c,data:h.JS_DATA||"",fChange:BX.proxy(this.OnChageParams,this)});BX.load([h.JS_FILE],i)},DisplayHiddenParam:function(g,f,i){var e=BX.adjust(i.appendChild(BX.create("TR")),{props:{className:"bxcompprop-prop-tr-hidden"}}),h=BX.adjust(e.insertCell(-1),{props:{colSpan:2}}),d=g._propId,c=g.ID+(g.MULTIPLE=="Y"?"[]":"");h.appendChild(BX.create("INPUT",{props:{name:c,value:f,type:"hidden",id:d},attrs:{"data-bx-property-id":g.ID,"data-bx-comp-prop":true}}))},DisplayTemplateSelector:function(k,j){var f,h={};for(f=0;f<k.length;f++){h[k[f].NAME]=k[f].DISPLAY_NAME||k[f].NAME}var c="TEMPLATE_"+this.id,e={ID:"COMPONENT_TEMPLATE",_propId:c,NAME:BX.message("TemplateGroup"),VALUES:h,REFRESH:"Y"},m=this.groupIndex.COMPONENT_TEMPLATE.frag,g=BX.adjust(m.appendChild(BX.create("TR")),{props:{className:"bxcompprop-prop-tr"}}),l=BX.adjust(g.insertCell(-1),{props:{className:"bxcompprop-cont-table-l"},html:'<label class="bxcompprop-label" for="'+c+'">'+(e.NAME||"")+":</label>"}),d=BX.adjust(g.insertCell(-1),{props:{className:"bxcompprop-cont-table-r"}});this.paramsIndex[e.ID]={param:e,value:j};this.DisplayParamList(e,j,d);this.searchIndex.push({content:"template "+(e.NAME||"").toLowerCase(),elementWrap:g,label:l.firstChild,name:e.NAME||"",groupId:e.PARENT||""})},GetTemplateValue:function(){var c=BX("TEMPLATE_"+this.id);if(c){return c.value==".default"?"":c.value}return""},DoRefreshParams:function(){BX.onCustomEvent(this,"onComponentParamsBeforeRefresh");var c=this;setTimeout(function(){c.params.currentValues=c.GetParamsValues();c.params.template=c.GetTemplateValue();c.savedScrollTop=c.pParamsWrap.scrollTop;c.GetComponentParams(c.params)},1)},SetOptionSelected:function(c,d){setTimeout(function(){c.selected=d},1)},OnChageParams:function(f,g){if(f&&!g){var d=f.target||f.srcElement;g=d.getAttribute("data-bx-property-id")}if(g&&this.paramsIndex[g]){var c=this.paramsIndex[g];if(c.param.REFRESH=="Y"){this.DoRefreshParams()}}},GetParamsValues:function(){var m=this.params.currentValues||{},f,c,g,l,k={},d,e,h=this.GetControls();for(f=0;f<h.length;f++){c=h[f];g=c.getAttribute("data-bx-property-id");if(c.disabled||!this.paramsIndex[g]){continue}d=this.paramsIndex[g].param;if(d.MULTIPLE=="Y"){if(!k[d.ID]){k[d.ID]=[]}if(c.nodeName.toUpperCase()=="SELECT"&&c.multiple){for(e in c.options){if(c.options.hasOwnProperty(e)&&c.options[e].selected){k[d.ID].push(c.options[e].value)}}}else{k[d.ID].push(c.value)}}else{if(d.TYPE=="CHECKBOX"){k[d.ID]=c.checked?"Y":"N"}else{k[d.ID]=c.value}}}for(g in k){if(k.hasOwnProperty(g)){l=k[g];if(l==="undefined"||l===undefined){m[g]=""}else{m[g]=(typeof l=="object")?this.WrapPHPBrackets(this.ConvertArrayToString(l)):l}}}if(m.COMPONENT_TEMPLATE){delete (m.COMPONENT_TEMPLATE)}return m},GetControls:function(){if(this.params.container){return BX.findChildren(this.params.container,{attr:{"data-bx-comp-prop":true}},true)}return[]},GetNamedControls:function(){var e,f,d={},h,g,c=this.GetControls();for(e=0;e<c.length;e++){f=c[e];h=f.getAttribute("data-bx-property-id");if(h&&this.paramsIndex[h]){g=this.paramsIndex[h].param;d[g.ID]=f}}return d},GetParamValueById:function(d){var c="",e=this.paramsIndex[d];if(e&&e.value){c=e.value}else{if(e&&e.param&&e.param.DEFAULT!=undefined){c=e.param.DEFAULT}}return c},SetParamValueById:function(d,e){var f=this.paramsIndex[d];if(f){var c=BX(f.param._propId);if(c&&c.type.toLowerCase()=="text"){c.value=e;BX.fireEvent(c,"change")}}},IsPHPBracket:function(c){return c.substr(0,2)=="={"},TrimPHPBracket:function(c){return c.substr(2,c.length-3)},TrimQuotes:function(f,e){var c,d;f=f.trim();if(e==undefined){c=f.substr(0,1);d=f.substr(0,1);if((c=='"'&&d=='"')||(c=="'"&&d=="'")){f=f.substring(1,f.length-1)}}else{if(!e.length){return f}c=f.substr(0,1);d=f.substr(0,1);e=e.substr(0,1);if(c==e&&d==e){f=f.substring(1,f.length-1)}}return f},WrapPHPBrackets:function(e){e=e.trim();var c=e.substr(0,1),d=e.substr(0,1);if((c=='"'&&d=='"')||(c=="'"&&d=="'")){return e}return"={"+e+"}"},IsNum:function(c){var d=c;c=parseFloat(d);if(isNaN(c)){c=parseInt(d)}return !isNaN(c)?(d===c):false},ConvertArrayToString:function(d){var e=[];var f="array(";for(var c in d){if(d.hasOwnProperty(c)&&d[c]!=="undefined"&&d[c]!==undefined){if(isNaN(parseInt(c))||parseInt(c)!=c){e.push('"'+c+'" => "'+d[c]+'"')}else{e[c]='"'+d[c]+'"'}}}f+=e.join(", ");f+=")";return f},ConvertStringToArray:function(h,g){var d=this.GetArray(h),j=true,c=[],f={},e;for(e in d){if(d.hasOwnProperty(e)){if(e!==""&&typeof d[e]!="function"&&(d[e]!==""||!g)){if(e!=parseInt(e)){j=false}if(j){c.push(d[e])}f[e]=d[e]}}}return j?c:f},GetArray:function(i){var c={};if(i.substr(0,6).toLowerCase()!="array("){return i}i=i.substring(6,i.length-1);var e=this.GetParams(i),g,d;for(var h=0;h<e.length;h++){if(e[h].substr(0,6).toLowerCase()=="array("){c[h]=this.GetArray(e[h]);continue}var f=e[h].indexOf("=>");if(f==-1){if(e[h]==this.TrimQuotes(e[h])){c[h]=this.WrapPHPBrackets(e[h])}else{c[h]=this.TrimQuotes(e[h])}}else{g=this.TrimQuotes(e[h].substr(0,f));d=e[h].substr(f+2);if(d==this.TrimQuotes(d)){d=this.WrapPHPBrackets(d)}else{d=this.TrimQuotes(d)}if(d.substr(0,6).toLowerCase()=="array("){d=this.getArray(d)}c[g]=d}}return c},GetParams:function(e){var g,l=[],f=0,c,d,j=1,h=1,k="";for(g=0;g<e.length;g++){c=e.substr(g,1);if(c=='"'&&h==1&&!d){j*=-1}else{if(c=="'"&&j==1&&!d){h*=-1}else{if(c=="\\"&&!d){d=true;k+=c;continue}}}if(d){d=false}if(h==-1||j==-1){k+=c;continue}if(c=="("){f++}else{if(c==")"){f--}else{if(c==","&&f==0){l.push(k);k="";continue}}}if(f<0){break}k+=c}if(k!=""){l.push(k)}return l},SearchCheck:function(d){var c=this.pSearchInput.value;if(d.keyCode==27){this.pSearchInput.value="";BX.defer(this.ClearSearchResult,this)()}else{if(c.length<2){this.ClearSearchResult()}else{this.Search(c)}}},Search:function(k){this.ClearSearchResult();var j=false,h=this,c,d,m,g,f=this.searchIndex.length;k=BX.util.trim(k.toLowerCase());BX.addClass(this.pGroupsIndex,"bxcompprop-groups-search");BX.addClass(this.pParamsWrap,"bxcompprop-params-search");for(g=0;g<f;g++){d=this.searchIndex[g];if(d.content.indexOf(k)!==-1){j=true;BX.addClass(d.elementWrap,"bxcompprop-tr-search-res");this._searchResult.push(d.elementWrap);if(d.name&&d.name.toLowerCase().indexOf(k.toLowerCase())!==-1&&d.label&&d.label.parentNode&&d.label.parentNode.parentNode){this.HighlightLabel(d.label,k,d.name)}m=this.groupIndex[d.groupId];if(m){BX.addClass(m.leftIndex,"bxcompprop-item-search-res");this._searchResultSect.push(m.leftIndex);BX.addClass(m.titleRow,"bxcompprop-tr-search-res");this._searchResult.push(m.titleRow)}}}if(!j){BX.addClass(this.pContainer,"bxcompprop-no-search-results")}this.bSearchCleared=false;var e=BX.WindowManager.Get();if(e){e.unclosable=true}},ClearSearchResult:function(){BX.removeClass(this.pGroupsIndex,"bxcompprop-groups-search");BX.removeClass(this.pParamsWrap,"bxcompprop-params-search");BX.removeClass(this.pContainer,"bxcompprop-no-search-results");var c;if(this._searchResult){for(c=0;c<this._searchResult.length;c++){BX.removeClass(this._searchResult[c],"bxcompprop-tr-search-res")}this._searchResult=[]}if(this._searchResultSect){for(c=0;c<this._searchResultSect.length;c++){BX.removeClass(this._searchResultSect[c],"bxcompprop-item-search-res")}this._searchResultSect=[]}if(this._searchResultLabel){for(c=0;c<this._searchResultLabel.length;c++){this._searchResultLabel[c].node.innerHTML=BX.util.htmlspecialchars(this._searchResultLabel[c].name)+":"}this._searchResultSect=[]}this.bSearchCleared=true;var d=BX.WindowManager.Get();if(d){d.unclosable=false}},HighlightLabel:function(e,d,c){e.innerHTML=BX.util.htmlspecialchars(c).replace(new RegExp("("+d+")","ig"),"<i>$1</i>")+":";this._searchResultLabel.push({node:e,name:c})}};function b(){top.BXComponentParamsManager=window.BXComponentParamsManager=a}if(!top.BXComponentParamsManager){b()}})();