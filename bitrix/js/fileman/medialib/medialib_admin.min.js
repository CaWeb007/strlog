(function(b){var c=null,a=null;if(BX.UploaderTemplateThumbnails){return false}BX.UploaderTemplateThumbnails=function(g,f){this.id=g.id;this.dialogName="BX.UploaderTemplateThumbnails";this.vars={filesCountForUpload:0};g.phpMaxFileUploads=10;if(!!g.copies){var d=1;for(var e in g.copies){if(g.copies.hasOwnProperty(e)){d++}}g.phpMaxFileUploads=d*10}this.params=g;this.uploader=BX.Uploader.getInstance(g);this.init();return this};BX.UploaderTemplateThumbnails.prototype={init:function(){if(this.uploader.dialogName!="BX.Uploader"){BX.addClass(BX("bxuMain"+this.id),"bxu-thumbnails-simple")}this._onItemIsAdded=BX.delegate(this.onItemIsAdded,this);this._onFileIsAppended=BX.delegate(this.onFileIsAppended,this);BX.addCustomEvent(this.uploader,"onItemIsAdded",this._onItemIsAdded);BX.addCustomEvent(this.uploader,"onStart",BX.delegate(this.start,this));BX.addCustomEvent(this.uploader,"onDone",BX.delegate(this.done,this));BX.addCustomEvent(this.uploader,"onTerminate",BX.delegate(this.terminate,this));BX.addCustomEvent(this.uploader,"onFileIsAppended",this._onFileIsAppended);BX.addCustomEvent(this.uploader,"onQueueIsChanged",BX.delegate(this.onChange,this));this._onUploadStart=BX.delegate(this.onUploadStart,this);this._onUploadProgress=BX.delegate(this.onUploadProgress,this);this._onUploadDone=BX.delegate(this.onUploadDone,this);this._onUploadError=BX.delegate(this.onUploadError,this);this._onUploadRestore=BX.delegate(this.onUploadRestore,this);this._onFileHasPreview=BX.delegate(this.onFileHasPreview,this);BX.bind(BX("bxuStartUploading"+this.id),"click",BX.delegate(this.uploader.submit,this.uploader));BX.bind(BX("bxuCancel"+this.id),"click",BX.delegate(this.uploader.stop,this.uploader));this.uploader.init(BX("bxuUploaderStart"+this.id));this.uploader.init(BX("bxuUploaderStartField"+this.id));BX.bind(BX("bxuReduced"+this.id),"click",BX.delegate(function(){BX.userOptions.save("fileman","uploader_html5","template","reduced");BX.addClass(BX("bxuReduced"+this.id),"bxu-templates-btn-active");BX.removeClass(BX("bxuEnlarge"+this.id),"bxu-templates-btn-active");BX.addClass(BX("bxuMain"+this.id),"bxu-main-block-reduced-size")},this));BX.bind(BX("bxuEnlarge"+this.id),"click",BX.delegate(function(){BX.userOptions.save("fileman","uploader_html5","template","full");BX.removeClass(BX("bxuReduced"+this.id),"bxu-templates-btn-active");BX.addClass(BX("bxuEnlarge"+this.id),"bxu-templates-btn-active");BX.removeClass(BX("bxuMain"+this.id),"bxu-main-block-reduced-size")},this));this.uploader.fileFields=(!!this.uploader.fileFields?this.uploader.fileFields:{});this.uploader.fileFields.description=(!!this.uploader.fileFields.description?this.uploader.fileFields.description:{})},onUploadStart:function(f){f.__progressBarWidth=1;var g=f.getPH("Thumb"),h=f.id,d,e=f.progress;BX.addClass(g,"bxu-item-loading");if(BX("bxu"+h+"ProgressBar")){BX.adjust(BX("bxu"+h+"ProgressBar"),{style:{width:f.__progressBarWidth+"%"}})}},onUploadProgress:function(e,d){var f=e.id;if(BX("bxu"+f+"ProgressBar")){e.__progressBarWidth=Math.max(e.__progressBarWidth,Math.ceil(d));BX.adjust(BX("bxu"+f+"ProgressBar"),{style:{width:e.__progressBarWidth+"%"}})}},onUploadDone:function(f,e,d){BX.defer_proxy(f.deleteFile,f)();this.vars.uploadedFilesCount++;BX("bxuUploaded"+this.id).innerHTML=this.vars.uploadedFilesCount;BX("bxuUploadBar"+this.id).style.width=Math.ceil(this.vars.uploadedFilesCount/this.vars.filesCountForUpload*100)+"%"},onUploadError:function(f,e,d){var g=f.getPH("Thumb");BX.removeClass(g,"bxu-item-loading");BX.addClass(g,"bxu-item-error");g.innerHTML=this.params.errorThumb.replace("#error#",e.error)},onUploadRestore:function(d){var e=d.getPH("Thumb");BX.removeClass(e,"bxu-item-loading");BX.removeClass(e,"bxu-item-loading-with-error")},start:function(e,d){this.vars.uploadedFilesCount=this.uploader.queue.itUploaded.length;this.vars.filesCountForUpload+=d.filesCount;BX("bxuUploadBar"+this.id).style.width=Math.ceil(this.vars.uploadedFilesCount/this.vars.filesCountForUpload)+"%";BX("bxuUploaded"+this.id).innerHTML=this.vars.uploadedFilesCount;BX("bxuForUpload"+this.id).innerHTML=this.vars.filesCountForUpload;BX.addClass(BX("bxuMain"+this.id),"bxu-thumbnails-loading")},done:function(i,h,e,f){this.vars.filesCountForUpload-=e.filesCount;BX.removeClass(BX("bxuMain"+this.id),"bxu-thumbnails-loading");BX("bxuUploaded"+this.id).innerHTML=this.vars.uploadedFilesCount;if(!!f&&this.uploader.queue.itFailed.length<=0){var g=f.report.uploading[this.uploader.CID];if(!!g.redirectUrl){BX.reload(g.redirectUrl)}}},terminate:function(e,d){this.vars.filesCountForUpload-=d.filesCount;BX.removeClass(BX("bxuMain"+this.id),"bxu-thumbnails-loading");BX("bxuUploaded"+this.id).innerHTML=this.vars.uploadedFilesCount},onChange:function(d){if(!!BX("bxuImagesCount"+this.id)){this.vars.filesCount=d.items.length;BX("bxuImagesCount"+this.id).innerHTML=d.items.length}},onItemIsAdded:function(d,e){BX.removeCustomEvent(this.uploader,"onItemIsAdded",this._onItemIsAdded);BX.removeClass(BX("bxuMain"+this.id),"bxu-thumbnails-start")},onFileHasPreview:function(f,e,d){},onFileIsAppended:function(e,d){if(d.dialogName=="BX.UploaderFile"||!BX.CanvasEditor){if(BX(e+"Edit")){BX.remove(BX(e+"Edit"))}if(BX(e+"Turn")){BX.remove(BX(e+"Turn"))}if(BX(e+"Thumb")){BX.addClass(BX(e+"Thumb"),"bx-bxu-thumb-file")}if(BX(e+"Thumb")){BX.addClass(BX(e+"Thumb"),"bx-bxu-thumb-"+d.ext)}if(BX(e+"Canvas")&&!BX(e+"Canvas").hasChildNodes()){BX(e+"Canvas").innerHTML=['<span class="bx-bxu-thumb-file-icon bxu-item-',d.ext,'">','<span class="bxu-item-block-icon-holder"></span>',"</span>"].join("")}}else{if(BX(e+"Edit")){BX.bind(BX(e+"Edit"),"click",BX.delegate(d.clickFile,d))}if(BX(e+"Turn")){d.__onTurnCanvas=BX.delegate(function(h,f,g){if(a===null){a=new BX.Canvas()}if(a){g.drawImage(h,0,0);a.copy(f,{width:h.width,height:h.height});a.rotate(true);this.applyFile(a.cnv,true)}},d);BX.bind(BX(e+"Turn"),"click",BX.delegate(function(){if(c===null&&!!BX.UploaderFileCnvConstr){c=new BX.UploaderFileCnvConstr()}if(!!c){BX.adjust(c.getCanvas(),{props:{width:this.file.width,height:this.file.height}});c.push(this.file,this.__onTurnCanvas)}},d))}}BX.addCustomEvent(d,"onUploadStart",this._onUploadStart);BX.addCustomEvent(d,"onUploadProgress",this._onUploadProgress);BX.addCustomEvent(d,"onUploadDone",this._onUploadDone);BX.addCustomEvent(d,"onUploadError",this._onUploadError);BX.addCustomEvent(d,"onUploadRestore",this._onUploadRestore);BX.addCustomEvent(d,"onFileHasPreview",this._onFileHasPreview);if(BX(e+"Del")){BX.bind(BX(e+"Del"),"click",BX.delegate(function(){BX.removeCustomEvent(d,"onUploadStart",this._onUploadStart);BX.removeCustomEvent(d,"onUploadProgress",this._onUploadProgress);BX.removeCustomEvent(d,"onUploadDone",this._onUploadDone);BX.removeCustomEvent(d,"onUploadError",this._onUploadError);BX.removeCustomEvent(d,"onUploadRestore",this._onUploadRestore);BX.removeCustomEvent(d,"onFileHasPreview",this._onFileHasPreview);BX.unbindAll(BX(e+"Turn"));BX.unbindAll(BX(e+"Edit"));BX.unbindAll(BX(e+"Del"));d.deleteFile()},d))}}}}(window));