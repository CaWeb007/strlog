(function(){function a(){var V=window.BXHtmlEditor.Button,t=window.BXHtmlEditor.Dialog;function Y(aa,Z,ab){this.editor=aa;this.params=ab||{};this.className="bxhtmled-top-bar-btn bxhtmled-top-bar-color";this.activeClassName="bxhtmled-top-bar-btn-active";this.disabledClassName="bxhtmled-top-bar-btn-disabled";this.bCreated=false;this.zIndex=3009;this.disabledForTextarea=true;this.posOffset={top:6,left:0};this.id="color";this.title=BX.message("BXEdForeColor");this.actionColor="foreColor";this.actionBg="backgroundColor";this.showBgMode=!this.editor.bbCode;this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}Y.prototype={Create:function(){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title||""}});this.pContLetter=this.pCont.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-top-bar-btn-text"},html:"A"}));this.pContStrip=this.pCont.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-top-bar-color-strip"}}));this.currentAction=this.actionColor;BX.bind(this.pCont,"click",BX.delegate(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this));if(this.params.registerActions!==false){this.editor.RegisterCheckableAction(this.actionColor,{action:this.actionColor,control:this,value:this.value});this.editor.RegisterCheckableAction(this.actionBg,{action:this.actionBg,control:this,value:this.value})}},GetCont:function(){return this.pCont},Check:function(Z){if(Z!=this.checked&&!this.disabled){this.checked=Z;if(this.checked){BX.addClass(this.pCont,"bxhtmled-top-bar-btn-active")}else{BX.removeClass(this.pCont,"bxhtmled-top-bar-btn-active")}}},Disable:function(Z){if(Z!=this.disabled){this.disabled=!!Z;if(Z){BX.addClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}else{BX.removeClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}}},GetValue:function(){return !!this.checked},SetValue:function(ac,ab,aa){if(ab&&ab[0]){var Z=aa==this.actionColor?ab[0].style.color:ab[0].style.backgroundColor;this.SelectColor(Z,aa)}else{this.SelectColor(null,aa)}},OnClick:function(){if(this.disabled){return false}if(this.bOpened){return this.Close()}this.Open()},OnMouseUp:function(){this.editor.selection.RestoreBookmark();if(!this.checked){BX.removeClass(this.pCont,this.activeClassName)}BX.unbind(document,"mouseup",BX.proxy(this.OnMouseUp,this));BX.removeCustomEvent(this.editor,"OnIframeMouseUp",BX.proxy(this.OnMouseUp,this))},OnMouseDown:function(){if(!this.disabled){if(this.disabledForTextarea||!this.editor.synchro.IsFocusedOnTextarea()){this.editor.selection.SaveBookmark()}BX.addClass(this.pCont,this.activeClassName);BX.bind(document,"mouseup",BX.proxy(this.OnMouseUp,this));BX.addCustomEvent(this.editor,"OnIframeMouseUp",BX.proxy(this.OnMouseUp,this))}},Close:function(){var Z=this;this.popupShownTimeout=setTimeout(function(){Z.editor.popupShown=false},300);this.pValuesCont.style.display="none";BX.removeClass(this.pCont,this.activeClassName);this.editor.overlay.Hide();BX.unbind(window,"keydown",BX.proxy(this.OnKeyDown,this));BX.unbind(document,"mousedown",BX.proxy(this.CheckClose,this));this.bOpened=false},CheckClose:function(Z){if(!this.bOpened){return BX.unbind(document,"mousedown",BX.proxy(this.CheckClose,this))}var aa;if(Z.target){aa=Z.target}else{if(Z.srcElement){aa=Z.srcElement}}if(aa.nodeType==3){aa=aa.parentNode}if(aa!==this.custInp&&!BX.findParent(aa,{className:"lhe-colpick-cont"})){this.Close()}},Open:function(){this.editor.popupShown=true;if(this.popupShownTimeout){this.popupShownTimeout=clearTimeout(this.popupShownTimeout)}var ae=this;if(!this.bCreated){this.pValuesCont=document.body.appendChild(BX.create("DIV",{props:{className:"bxhtmled-popup  bxhtmled-color-cont"},style:{zIndex:this.zIndex},html:'<div class="bxhtmled-popup-corner"></div>'}));if(this.showBgMode){this.pTextColorLink=this.pValuesCont.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-color-link bxhtmled-color-link-active"},text:this.params.ForeColorMess||BX.message("BXEdForeColor")}));this.pTextColorLink.setAttribute("data-bx-type","changeColorAction");this.pTextColorLink.setAttribute("data-bx-value",this.actionColor);this.pBgColorLink=this.pValuesCont.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-color-link"},text:this.params.BgColorMess||BX.message("BXEdBackColor")}));this.pBgColorLink.setAttribute("data-bx-type","changeColorAction");this.pBgColorLink.setAttribute("data-bx-value",this.actionBg)}this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-color-wrap"}}));BX.bind(this.pValuesCont,"mousedown",function(ap){var ao=ap.target||ap.srcElement,an;if(ao!=ae.pValuesCont){an=(ao&&ao.getAttribute)?ao.getAttribute("data-bx-type"):null;if(!an){ao=BX.findParent(ao,function(ar){return ar==ae.pValuesCont||(ar.getAttribute&&ar.getAttribute("data-bx-type"))},ae.pValuesCont);an=(ao&&ao.getAttribute)?ao.getAttribute("data-bx-type"):null}if(an=="customColorAction"){var aq=ao.getAttribute("data-bx-value");if(aq=="link"){ae.ShowCustomColor(true,ae.colorCell.style.backgroundColor);BX.PreventDefault(ap)}if(aq=="button"){ae.SelectColor(ae.custInp.value);if(ae.params.checkAction!==false&&ae.editor.action.IsSupported(ae.currentAction)){ae.editor.action.Exec(ae.currentAction,ae.custInp.value)}}}else{if(an=="changeColorAction"){if(ae.showBgMode){ae.SetMode(ao.getAttribute("data-bx-value"));BX.PreventDefault(ap)}}else{if(ao&&an){ao.setAttribute("data-bx-action",ae.currentAction);if(ae.params.checkAction!==false){ae.editor.CheckCommand(ao)}ae.SelectColor(ao.getAttribute("data-bx-value"))}}}}});var ad=["#FF0000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF","#FFFFFF","#EBEBEB","#E1E1E1","#D7D7D7","#CCCCCC","#C2C2C2","#B7B7B7","#ACACAC","#A0A0A0","#959595","#EE1D24","#FFF100","#00A650","#00AEEF","#2F3192","#ED008C","#898989","#7D7D7D","#707070","#626262","#555555","#464646","#363636","#262626","#111111","#000000","#F7977A","#FBAD82","#FDC68C","#FFF799","#C6DF9C","#A4D49D","#81CA9D","#7BCDC9","#6CCFF7","#7CA6D8","#8293CA","#8881BE","#A286BD","#BC8CBF","#F49BC1","#F5999D","#F16C4D","#F68E54","#FBAF5A","#FFF467","#ACD372","#7DC473","#39B778","#16BCB4","#00BFF3","#438CCB","#5573B7","#5E5CA7","#855FA8","#A763A9","#EF6EA8","#F16D7E","#EE1D24","#F16522","#F7941D","#FFF100","#8FC63D","#37B44A","#00A650","#00A99E","#00AEEF","#0072BC","#0054A5","#2F3192","#652C91","#91278F","#ED008C","#EE105A","#9D0A0F","#A1410D","#A36209","#ABA000","#588528","#197B30","#007236","#00736A","#0076A4","#004A80","#003370","#1D1363","#450E61","#62055F","#9E005C","#9D0039","#790000","#7B3000","#7C4900","#827A00","#3E6617","#045F20","#005824","#005951","#005B7E","#003562","#002056","#0C004B","#30004A","#4B0048","#7A0045","#7A0026"];var am,aj,ah,ab=BX.create("TABLE",{props:{className:"bxhtmled-color-tbl"}}),ac,aa=ad.length;this.pDefValueRow=ab.insertRow(-1);aj=this.pDefValueRow.insertCell(-1);aj.colSpan=5;var ak=aj.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-color-def-but"}}));ak.innerHTML=BX.message("BXEdDefaultColor");ak.setAttribute("data-bx-type","action");ak.setAttribute("data-bx-action",this.action);ak.setAttribute("data-bx-value","");ah=this.pDefValueRow.insertCell(-1);ah.colSpan=5;ah.className="bxhtmled-color-inp-cell";ah.style.backgroundColor=ad[38];this.colorCell=ah;aj=this.pDefValueRow.insertCell(-1);aj.colSpan=6;this.custLink=aj.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-color-custom"},html:BX.message("BXEdColorOther")}));this.custLink.setAttribute("data-bx-type","customColorAction");this.custLink.setAttribute("data-bx-value","link");this.custInp=aj.appendChild(BX.create("INPUT",{props:{type:"text",className:"bxhtmled-color-custom-inp"},style:{display:"none"}}));this.custInp.setAttribute("data-bx-type","customColorAction");this.custInp.setAttribute("data-bx-value","input");this.custBut=aj.appendChild(BX.create("INPUT",{props:{type:"button",className:"bxhtmled-color-custom-but",value:"ok"},style:{display:"none"}}));this.custBut.setAttribute("data-bx-type","customColorAction");this.custBut.setAttribute("data-bx-value","button");for(ac=0;ac<aa;ac++){if(Math.round(ac/16)==ac/16){am=ab.insertRow(-1)}aj=am.insertCell(-1);aj.innerHTML="&nbsp;";aj.className="bxhtmled-color-col-cell";aj.style.backgroundColor=ad[ac];aj.id="bx_color_id__"+ac;aj.setAttribute("data-bx-type","action");aj.setAttribute("data-bx-action",this.action);aj.setAttribute("data-bx-value",ad[ac]);aj.onmouseover=function(an){this.className="bxhtmled-color-col-cell bxhtmled-color-col-cell-over";ah.style.backgroundColor=ad[this.id.substring("bx_color_id__".length)]};aj.onmouseout=function(an){this.className="bxhtmled-color-col-cell"};aj.onclick=function(an){ae.Select(ad[this.id.substring("bx_color_id__".length)])}}this.pValuesContWrap.appendChild(ab);this.bCreated=true}document.body.appendChild(this.pValuesCont);this.pDefValueRow.style.display=ae.editor.synchro.IsFocusedOnTextarea()?"none":"";this.pValuesCont.style.display="block";var al=this.editor.overlay.Show(),ag=BX.pos(this.pCont),Z=ag.left-this.pValuesCont.offsetWidth/2+this.pCont.offsetWidth/2+this.posOffset.left,af=ag.bottom+this.posOffset.top;if(Z<0){var ai=this.pValuesCont.getElementsByClassName("bxhtmled-popup-corner")[0];ai.style.transform="translateX("+Z+"px)";Z=0}BX.bind(window,"keydown",BX.proxy(this.OnKeyDown,this));BX.addClass(this.pCont,this.activeClassName);al.onclick=function(){ae.Close()};this.pValuesCont.style.left=Z+"px";this.pValuesCont.style.top=af+"px";this.bOpened=true;setTimeout(function(){BX.bind(document,"mousedown",BX.proxy(ae.CheckClose,ae))},100);this.ShowCustomColor(false,"")},SetMode:function(aa){this.currentAction=aa;var Z="bxhtmled-color-link-active";if(aa==this.actionColor){BX.addClass(this.pTextColorLink,Z);BX.removeClass(this.pBgColorLink,Z)}else{BX.addClass(this.pBgColorLink,Z);BX.removeClass(this.pTextColorLink,Z)}},SelectColor:function(Z,aa){if(!aa){aa=this.currentAction}if(this.params.callback&&typeof this.params.callback=="function"){this.params.callback(aa,this.editor.util.RgbToHex(Z))}if(aa==this.actionColor){this.pContLetter.style.color=Z||"#000";this.pContStrip.style.backgroundColor=Z||"#000"}else{this.pContLetter.style.backgroundColor=Z||"transparent"}},ShowCustomColor:function(Z,aa){if(Z!==false){this.custInp.style.display="";this.custBut.style.display="";this.custLink.style.display="none"}else{this.custInp.style.display="none";this.custBut.style.display="none";this.custLink.style.display=""}if(aa){aa=this.editor.util.RgbToHex(aa)}this.custInp.value=aa.toUpperCase()||""}};function v(aa,Z){v.superclass.constructor.apply(this,arguments);this.id="search";this.title=BX.message("ButtonSearch");this.className+=" bxhtmled-button-search";this.Create();this.bInited=false;if(Z){Z.appendChild(this.GetCont())}}BX.extend(v,V);v.prototype.OnClick=function(){if(this.disabled){return}if(!this.bInited){var Z=this;this.pSearchCont=BX("bx-html-editor-search-cnt-"+this.editor.id);this.pSearchWrap=this.pSearchCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-search-cnt-search"}}));this.pReplaceWrap=this.pSearchCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-search-cnt-replace"}}));this.pSearchInput=this.pSearchWrap.appendChild(BX.create("INPUT",{props:{className:"bxhtmled-top-search-inp",type:"text"}}));this.pShowReplace=this.pSearchWrap.appendChild(BX.create("INPUT",{props:{type:"checkbox",value:"Y"}}));this.pReplaceInput=this.pReplaceWrap.appendChild(BX.create("INPUT",{props:{type:"text"}}));BX.bind(this.pShowReplace,"click",function(){Z.ShowReplace(!!this.checked)});this.animation=null;this.animationStartHeight=0;this.animationEndHeight=0;this.height0=0;this.height1=37;this.height2=66;this.bInited=true;this.bReplaceOpened=false}if(!this.bOpened){this.OpenPanel()}else{this.ClosePanel()}};v.prototype.SetPanelHeight=function(Z,aa){this.pSearchCont.style.height=Z+"px";this.pSearchCont.style.opacity=aa/100;this.editor.SetAreaContSize(this.origAreaWidth,this.origAreaHeight-Z,{areaContTop:this.editor.toolbar.GetHeight()+Z})};v.prototype.OpenPanel=function(Z){this.pSearchCont.style.display="block";if(this.animation){this.animation.stop()}if(Z){this.animationStartHeight=this.height1;this.animationEndHeight=this.height2}else{this.origAreaHeight=parseInt(this.editor.dom.areaCont.style.height,10);this.origAreaWidth=parseInt(this.editor.dom.areaCont.style.width,10);this.pShowReplace.checked=false;this.pSearchCont.style.opacity=0;this.animationStartHeight=this.height0;this.animationEndHeight=this.height1}var aa=this;this.animation=new BX.easing({duration:300,start:{height:this.animationStartHeight,opacity:Z?100:0},finish:{height:this.animationEndHeight,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(ab){aa.SetPanelHeight(ab.height,ab.opacity)},complete:BX.proxy(function(){this.animation=null},this)});this.animation.animate();this.bOpened=true};v.prototype.ClosePanel=function(Z){if(this.animation){this.animation.stop()}this.pSearchCont.style.opacity=1;if(Z){this.animationStartHeight=this.height2;this.animationEndHeight=this.height1}else{this.animationStartHeight=this.bReplaceOpened?this.height2:this.height1;this.animationEndHeight=this.height0}var aa=this;this.animation=new BX.easing({duration:200,start:{height:this.animationStartHeight,opacity:Z?100:0},finish:{height:this.animationEndHeight,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(ab){aa.SetPanelHeight(ab.height,ab.opacity)},complete:BX.proxy(function(){if(!Z){this.pSearchCont.style.display="none"}this.animation=null},this)});this.animation.animate();if(!Z){this.bOpened=false}};v.prototype.ShowReplace=function(Z){if(Z){this.OpenPanel(true);this.bReplaceOpened=true}else{this.ClosePanel(true);this.bReplaceOpened=false}};function H(aa,Z){H.superclass.constructor.apply(this,arguments);this.id="change_view";this.title=BX.message("ButtonViewMode");this._className=this.className;this.activeClassName="bxhtmled-top-bar-btn-active bxhtmled-top-bar-dd-active";this.topClassName="bxhtmled-top-bar-dd";this.arValues=[{id:"view_wysiwyg",title:BX.message("ViewWysiwyg"),className:this.className+" bxhtmled-button-viewmode-wysiwyg",action:"changeView",value:"wysiwyg"},{id:"view_code",title:BX.message("ViewCode"),className:this.className+" bxhtmled-button-viewmode-code",action:"changeView",value:"code"}];if(!aa.bbCode){this.arValues.push({id:"view_split_hor",title:BX.message("ViewSplitHor"),className:this.className+" bxhtmled-button-viewmode-split-hor",action:"splitMode",value:"0"});this.arValues.push({id:"view_split_ver",title:BX.message("ViewSplitVer"),className:this.className+" bxhtmled-button-viewmode-split-ver",action:"splitMode",value:"1"})}this.className+=" bxhtmled-top-bar-dd";this.disabledForTextarea=false;this.Create();if(Z){Z.appendChild(this.GetCont())}var ab=this;BX.addCustomEvent(this.editor,"OnSetViewAfter",function(){var ac="view_"+ab.editor.currentViewName;if(ab.editor.currentViewName=="split"){ac+="_"+(ab.editor.GetSplitMode()?"ver":"hor")}if(ac!==ab.currentValueId){ab.SelectItem(ac)}})}BX.extend(H,window.BXHtmlEditor.DropDown);H.prototype.Open=function(){var Z=this.editor.IsExpanded();if(!Z){var aa=BX.pos(this.editor.dom.cont);if(aa.left<45){Z=true}}this.posOffset.left=Z?40:-4;H.superclass.Open.apply(this,arguments);this.pValuesCont.firstChild.style.left=Z?"20px":""};H.prototype.SelectItem=function(aa,Z){Z=H.superclass.SelectItem.apply(this,[aa,Z]);if(Z){this.pCont.className=this.topClassName+" "+Z.className}else{this.pCont.className=this.topClassName+" "+this.className}this.currentValueId=aa};function D(aa,Z){D.superclass.constructor.apply(this,arguments);this.id="bbcode";this.title=BX.message("BXEdBbCode");this.className+=" bxhtmled-button-bbcode";this.disabledForTextarea=false;this.Create();var ab=this;BX.addCustomEvent(this.editor,"OnSetViewAfter",function(){ab.Check(ab.editor.GetViewMode()=="code")});if(Z){Z.appendChild(this.GetCont())}}BX.extend(D,V);D.prototype.OnClick=function(){if(this.disabled){return}if(this.editor.GetViewMode()=="wysiwyg"){this.editor.SetView("code",true);this.Check(true)}else{this.editor.SetView("wysiwyg",true);this.Check(false)}};function C(aa,Z){C.superclass.constructor.apply(this,arguments);this.id="undo";this.title=BX.message("Undo");this.className+=" bxhtmled-button-undo";this.action="doUndo";this.Create();if(Z){Z.appendChild(this.GetCont())}var ab=this;this.Disable(true);this._disabled=true;BX.addCustomEvent(this.editor,"OnEnableUndo",function(ac){ab._disabled=!ac;ab.Disable(!ac)})}BX.extend(C,V);C.prototype.Disable=function(Z){Z=Z||this._disabled;if(Z!=this.disabled){this.disabled=!!Z;if(Z){BX.addClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}else{BX.removeClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}}};function b(aa,Z){b.superclass.constructor.apply(this,arguments);this.id="redo";this.title=BX.message("Redo");this.className+=" bxhtmled-button-redo";this.action="doRedo";this.Create();if(Z){Z.appendChild(this.GetCont())}var ab=this;this.Disable(true);this._disabled=true;BX.addCustomEvent(this.editor,"OnEnableRedo",function(ac){ab._disabled=!ac;ab.Disable(!ac)})}BX.extend(b,V);b.prototype.Disable=function(Z){Z=Z||this._disabled;if(Z!=this.disabled){this.disabled=!!Z;if(Z){BX.addClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}else{BX.removeClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}}};function l(aa,Z){l.superclass.constructor.apply(this,arguments);this.id="style_selector";this.title=BX.message("StyleSelectorTitle");this.className+=" ";this.action="formatStyle";this.itemClassNameGroup="bxhtmled-dd-list-item-gr";this.OPEN_DELAY=800;this.checkedClasses=[];this.checkedTags=this.editor.GetBlockTags();this.arValues=this.GetStyleListValues();this.Create();if(Z){Z.appendChild(this.GetCont())}BX.addCustomEvent(this.editor,"OnApplySiteTemplate",BX.proxy(this.OnTemplateChanged,this))}BX.extend(l,window.BXHtmlEditor.DropDownList);l.prototype.OnTemplateChanged=function(){if(this.bOpened){this.Close()}this.arValues=this.GetStyleListValues();this.Create()};l.prototype.GetStyleListValues=function(){this.arValues=[{id:"",name:BX.message("StyleNormal"),topName:BX.message("StyleSelectorName"),tagName:false,action:"formatStyle",value:"",defaultValue:true},{name:BX.message("StyleH2"),className:"bxhtmled-style-h2",tagName:"H2",action:"formatStyle",value:"H2"},{name:BX.message("StyleH3"),className:"bxhtmled-style-h3",tagName:"H3",action:"formatStyle",value:"H3"},{id:"headingsMore",name:BX.message("HeadingMore"),className:"bxhtmled-style-heading-more",items:[{name:BX.message("StyleH1"),className:"bxhtmled-style-h1",tagName:"H1",action:"formatStyle",value:"H1"},{name:BX.message("StyleH4"),className:"bxhtmled-style-h4",tagName:"H4",action:"formatStyle",value:"H4"},{name:BX.message("StyleH5"),className:"bxhtmled-style-h5",tagName:"H5",action:"formatStyle",value:"H5"},{name:BX.message("StyleH6"),className:"bxhtmled-style-h6",tagName:"H6",action:"formatStyle",value:"H6"}]}];var ag=this.editor.GetStylesDescription();this.metaClasses=this.GetMetaClassSections();var ac,ab,aa=[],Z={},af,ad,ae;for(ac in ag){if(ag.hasOwnProperty(ac)&&typeof ag[ac]=="object"){ab=ag[ac];if(ag[ac].section){if(typeof Z[ab.section]=="undefined"){Z[ab.section]=aa.length;aa.push({id:this.metaClasses[ab.section].id,name:this.metaClasses[ab.section].name,defaultValue:false,items:[]})}aa[Z[ab.section]].items.push({id:ac,name:ab.title||ac,action:"formatStyle",value:{className:ac,tag:ab.tag||false},html:ab.html||false,defaultValue:false})}else{aa.push({id:ac,name:ab.title||ac,action:"formatStyle",value:{className:ac,tag:ab.tag||false},html:ab.html||false,defaultValue:false})}this.checkedClasses.push(ac);if(ab.tag){af=ab.tag.indexOf(",")===-1?[ab.tag]:ab.tag.split(",");for(ae=0;ae<af.length;ae++){ad=BX.util.trim(af[ae]).toUpperCase();if(!BX.util.in_array(ad,this.checkedTags)){this.checkedTags.push(ad)}}}}}if(aa.length>0){this.arValues=this.arValues.concat(["separator"],aa)}this.arValues.push("separator");this.arValues.push({id:"P",name:BX.message("StyleParagraph"),action:"formatStyle",value:"P"});this.arValues.push({id:"DIV",name:BX.message("StyleDiv"),action:"formatStyle",value:"DIV"});this.editor.On("GetStyleList",[this.styleList]);return this.arValues};l.prototype.GetMetaClassSections=function(){var Z={quote:{id:"quote",name:BX.message("BXEdMetaClass_quote")},text:{id:"text",name:BX.message("BXEdMetaClass_text")},block:{id:"block",name:BX.message("BXEdMetaClass_block")},block_icon:{id:"block_icon",name:BX.message("BXEdMetaClass_block_icon")},list:{id:"list",name:BX.message("BXEdMetaClass_list"),activateNodes:["OL","UL"]}};return Z};l.prototype.SetValue=function(ac,ab){this.FilterMetaClasses();var aa=false,Z,ad;if(ac){if(ab&&ab.nodeName){this.FilterMetaClasses(ab.nodeName);if(ab.className&&ab.className!==""){ad=ab.className;if(ab.nodeName=="UL"){var af=this.editor.action.actions.insertUnorderedList.getCustomBullitClass(ab);if(af){ad=ab.className+"~~"+af}}for(Z in this.valueIndex){if(this.valueIndex.hasOwnProperty(Z)&&Z.indexOf(ad)!==-1){this.SelectItem(Z,false,false);aa=true;break}}}}if(!aa){var ae=ab.nodeName.toUpperCase();this.SelectItem(ae,false,false);aa=true}}if(!ac||!aa){this.SelectItem("",false,false)}};l.prototype.FilterMetaClasses=function(aa){for(var Z in this.metaClasses){if(this.metaClasses.hasOwnProperty(Z)&&this.metaClasses[Z].activateNodes&&this.metaClasses[Z].itemNode){if(!aa){this.metaClasses[Z].itemNode.style.display="none"}else{if(BX.util.in_array(aa.toUpperCase(),this.metaClasses[Z].activateNodes)){this.metaClasses[Z].itemNode.style.display=""}}}}};l.prototype.Create=function(){if(!this.pCont){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title},attrs:{unselectable:"on"},text:""});if(this.width){this.pCont.style.width=this.width+"px"}BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this))}if(!this.pValuesCont){this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-list-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dd-list-wrap"}}))}else{BX.cleanNode(this.pValuesContWrap)}this.valueIndex={};this.itemIndex={};if(this.zIndex){this.pValuesCont.style.zIndex=this.zIndex}var aa,Z;for(Z=0;Z<this.arValues.length;Z++){aa=this.arValues[Z];if(aa.items&&aa.items.length>0){this.CreateSubmenuItem(aa,this.pValuesContWrap,Z)}else{if(!aa.items){this.CreateItem(aa,this.pValuesContWrap,Z)}}}if(this.action&&this.checkableAction){this.editor.RegisterCheckableAction(this.action,{action:this.action,control:this})}};l.prototype.CreateItem=function(ac,ab,aa){if(ac=="separator"){ab.appendChild(BX.create("I",{props:{className:"bxhtmled-dd-list-sep"}}))}else{if(ac.tagName){ac.tagName=ac.tagName.toUpperCase();if(!ac.id){ac.id=ac.tagName}}var ae=this,ad=this.itemClassName+(ac.className?" "+ac.className:"");if(!ac.html){ac.html=ac.tagName?("<"+ac.tagName+">"+ac.name+"</"+ac.tagName+">"):ac.name}var Z=ab.appendChild(BX.create("SPAN",{props:{title:ac.title||ac.name,className:ad},html:ac.html,style:ac.style}));Z.setAttribute("data-bx-dropdown-value",ac.id);this.valueIndex[ac.id]=aa;this.itemIndex[ac.id]=ac;if(ac.defaultValue){this.SelectItem(null,ac)}BX.bind(Z,"mousedown",function(af){ae.SelectItem(this.getAttribute("data-bx-dropdown-value"));if(ac.action&&ae.editor.action.IsSupported(ac.action)){ae.editor.action.Exec(ac.action,ac.value||false)}});this.arValues[aa].listCont=Z}};l.prototype.CreateSubmenuItem=function(ai,aa,ae){var ac=this,ah=this.itemClassName+" "+this.itemClassNameGroup+(ai.className?" "+ai.className:""),af=aa.appendChild(BX.create("SPAN",{props:{title:ai.title||ai.name,className:ah},html:ai.name+'<i class="bxed-arrow"></i>',style:ai.style||""}));af.setAttribute("data-bx-dropdown-value",ai.id);this.valueIndex[ai.id]=ae;this.itemIndex[ai.id]=ai;this.arValues[ae].listCont=af;var ag,ad=false;var aj=this.valueIndex[ai.id];var ab,Z;for(ab=0;ab<ai.items.length;ab++){if(ai.items[ab].tagName){ai.items[ab].tagName=ai.items[ab].tagName.toUpperCase();if(!ai.items[ab].id){ai.items[ab].id=ai.items[ab].tagName}}Z=aj+"_"+ab;if(!this.arValues[Z]){this.arValues[Z]=ai.items[ab]}this.valueIndex[ai.items[ab].id]=Z;ai.items[ab].listSubmenuCont=af}BX.bind(af,"mouseover",function(ak){ad=true;if(ag){clearTimeout(ag)}ag=setTimeout(function(){if(ad){ac.OpenSubmenu(ai)}},ac.OPEN_DELAY)});BX.bind(af,"mouseout",function(ak){ad=false;if(ag){ag=clearTimeout(ag)}});if(this.metaClasses&&this.metaClasses[ai.id]){this.metaClasses[ai.id].itemNode=af}};l.prototype.OpenSubmenu=function(ab){if(ab.id=="list"){BX.loadCSS(["/bitrix/css/main/font-awesome.css"])}if(!this.pSubmenuCont){this.pSubmenuCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-popup-left bxhtmled-dropdown-list-cont bxhtmled-dropdown-list-cont-submenu"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pSubmenuContWrap=this.pSubmenuCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dd-list-wrap"}}))}else{BX.cleanNode(this.pSubmenuContWrap)}if(this.zIndex){this.pSubmenuCont.style.zIndex=this.zIndex}document.body.appendChild(this.pSubmenuCont);this.pSubmenuCont.style.display="block";if(this.curSubmenuItem){BX.removeClass(this.curSubmenuItem,"bxhtmled-dd-list-item-selected")}this.curSubmenuItem=ab.listCont;BX.addClass(this.curSubmenuItem,"bxhtmled-dd-list-item-selected");var ag=this,af=BX.pos(this.curSubmenuItem),ae=af.right+17,ad=af.top-9;this.pSubmenuCont.style.top=ad+"px";this.pSubmenuCont.style.left=ae+"px";var Z=this.valueIndex[ab.id];var aa,ac;for(aa=0;aa<ab.items.length;aa++){ac=Z+"_"+aa;if(!this.arValues[ac]){this.arValues[ac]=ab.items[aa]}this.CreateItem(ab.items[aa],this.pSubmenuContWrap,ac)}BX.onCustomEvent(this.curSubmenuItem,"OnStyleListSubmenuOpened",[])};l.prototype.CloseSubmenu=function(){if(this.pSubmenuCont&&this.pSubmenuContWrap){BX.cleanNode(this.pSubmenuContWrap);this.pSubmenuCont.style.display="none"}if(this.curSubmenuItem){BX.removeClass(this.curSubmenuItem,"bxhtmled-dd-list-item-selected")}};l.prototype.SelectItem=function(Z,ac,ab){var ad=this;ab=ab!==false;if(!ac){ac=this.arValues[this.valueIndex[Z]];if(!ac&&this.valueIndex[Z.toUpperCase()]){ac=this.arValues[this.valueIndex[Z.toUpperCase()]]}if(!ac&&this.valueIndex[Z.toLowerCase()]){ac=this.arValues[this.valueIndex[Z.toLowerCase()]]}}if(this.lastActiveSubmenuItem){BX.removeClass(this.lastActiveSubmenuItem,this.activeListClassName)}if(this.lastActiveItem){BX.removeClass(this.lastActiveItem,this.activeListClassName)}if(ac){this.pCont.innerHTML=BX.util.htmlspecialchars((ac.topName||ac.name||ac.id));this.pCont.title=this.title+": "+(ac.title||ac.name);if(ac.listSubmenuCont&&BX.isNodeInDom(ac.listSubmenuCont)){this.lastActiveSubmenuItem=ac.listSubmenuCont;BX.addClass(ac.listSubmenuCont,this.activeListClassName)}if(ac.listCont&&BX.isNodeInDom(ac.listCont)){this.lastActiveItem=ac.listCont;BX.addClass(ac.listCont,this.activeListClassName)}else{function aa(){if(ac.listCont&&BX.isNodeInDom(ac.listCont)){if(ad.lastActiveItem){BX.removeClass(ad.lastActiveItem,ad.activeListClassName)}ad.lastActiveItem=ac.listCont;BX.addClass(ac.listCont,ad.activeListClassName)}BX.removeCustomEvent(ac.listSubmenuCont,"OnStyleListSubmenuOpened",aa)}if(ac.listSubmenuCont){BX.addCustomEvent(ac.listSubmenuCont,"OnStyleListSubmenuOpened",aa)}}}if(this.bOpened&&ab){this.Close()}};l.prototype.Open=function(){l.superclass.Open.apply(this,arguments)};l.prototype.Close=function(){this.CloseSubmenu();l.superclass.Close.apply(this,arguments)};function w(ad,ac){w.superclass.constructor.apply(this,arguments);this.id="font_selector";this.title=BX.message("FontSelectorTitle");this.action="fontFamily";this.zIndex=3008;var af=this.editor.GetFontFamilyList();this.disabledForTextarea=!ad.bbCode;this.arValues=[{id:"",name:BX.message("NoFontTitle"),topName:BX.message("FontSelectorTitle"),title:BX.message("NoFontTitle"),className:"",style:"",action:"fontFamily",value:"",defaultValue:true}];var aa,Z,ae,ab;for(aa in af){if(af.hasOwnProperty(aa)){ae=af[aa].value;if(typeof ae!="object"){ae=[ae]}Z=af[aa].name;ab=af[aa].arStyle||{fontFamily:ae.join(",")};this.arValues.push({id:Z,name:Z,title:Z,className:af[aa].className||"",style:af[aa].arStyle||{fontFamily:ae.join(",")},action:"fontFamily",value:ae.join(",")})}}this.Create();if(ac){ac.appendChild(this.GetCont())}}BX.extend(w,window.BXHtmlEditor.DropDownList);w.prototype.SetValue=function(ad,Z){if(ad){var ag,af,aa,ab,ae=this.arValues.length,ac=Z[0],ah=BX.util.trim(BX.style(ac,"fontFamily"));if(ah!==""&&BX.type.isString(ah)){aa=ah.split(",");for(ag in aa){ab=false;if(aa.hasOwnProperty(ag)){for(af=0;af<ae;af++){aa[ag]=aa[ag].replace(/'|"/ig,"");if(this.arValues[af].value.indexOf(aa[ag])!==-1){ab=this.arValues[af].id;break}}if(ab!==false){break}}}this.SelectItem(ab,false,false)}else{this.SelectItem("",false,false)}}else{this.SelectItem("",false,false)}};function y(ab,aa){y.superclass.constructor.apply(this,arguments);this.id="font_size";this.title=BX.message("FontSizeTitle");this.className+=" bxhtmled-button-fontsize";this.activeClassName="bxhtmled-top-bar-btn-active bxhtmled-button-fontsize-active";this.disabledClassName="bxhtmled-top-bar-btn-disabled bxhtmled-button-fontsize-disabled";this.action="fontSize";this.zIndex=3007;this.disabledForTextarea=!ab.bbCode;var ac=[6,7,8,9,10,11,12,13,14,15,16,18,20,22,24,26,28,36,48,72];this.arValues=[{id:"font-size-0",className:"bxhtmled-top-bar-btn bxhtmled-button-remove-fontsize",action:this.action,value:"<i></i>"}];var Z,ad;for(Z in ac){if(ac.hasOwnProperty(Z)){ad=ac[Z];this.arValues.push({id:"font-size-"+ad,action:this.action,value:ad})}}this.Create();if(aa){aa.appendChild(this.pCont_)}BX.addCustomEvent(this,"OnPopupClose",BX.proxy(this.OnPopupClose,this))}BX.extend(y,window.BXHtmlEditor.DropDown);y.prototype.Create=function(){this.pCont_=BX.create("SPAN",{props:{className:"bxhtmled-button-fontsize-wrap",title:this.title}});this.pCont=this.pButCont=this.pCont_.appendChild(BX.create("SPAN",{props:{className:this.className},html:"<i></i>"}));this.pListCont=this.pCont_.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-top-bar-select",title:this.title},attrs:{unselectable:"on"},text:"",style:{display:"none"}}));this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesCont.style.zIndex=this.zIndex;this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dropdown-cont bxhtmled-font-size-popup"}}));this.valueIndex={};var Z,ab,ad=this,aa,ac="bxhtmled-dd-list-item";for(aa=0;aa<this.arValues.length;aa++){ab=this.arValues[aa];Z=this.pValuesContWrap.appendChild(BX.create("SPAN",{props:{className:ab.className||ac},html:ab.value,style:ab.style||{}}));Z.setAttribute("data-bx-dropdown-value",ab.id);this.valueIndex[ab.id]=aa;if(ab.action){Z.setAttribute("data-bx-type","action");Z.setAttribute("data-bx-action",ab.action);if(ab.value){Z.setAttribute("data-bx-value",ab.value)}}BX.bind(Z,"mousedown",function(ae){ad.SelectItem(this.getAttribute("data-bx-dropdown-value"));ad.editor.CheckCommand(this);ad.Close()})}this.editor.RegisterCheckableAction(this.action,{action:this.action,control:this});BX.bind(this.pCont_,"click",BX.proxy(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this))};y.prototype.SetValue=function(ac,ab){if(ab&&ab[0]){var Z=ab[0];var aa=Z.style.fontSize;this.SelectItem(false,{value:parseInt(aa,10),title:aa})}else{this.SelectItem(false,{value:0})}};y.prototype.SelectItem=function(Z,aa){if(!aa){aa=this.arValues[this.valueIndex[Z]]}if(aa.value){this.pListCont.innerHTML=aa.value;this.pListCont.title=this.title+": "+(aa.title||aa.value);this.pListCont.style.display="";this.pButCont.style.display="none"}else{this.pListCont.title=this.title;this.pButCont.style.display="";this.pListCont.style.display="none"}};y.prototype.GetPopupBindCont=function(){return this.pCont_};y.prototype.Open=function(){y.superclass.Open.apply(this,arguments);this.pValuesContWrap.firstChild.style.display=this.editor.bbCode&&this.editor.synchro.IsFocusedOnTextarea()?"none":"";BX.addClass(this.pListCont,"bxhtmled-top-bar-btn-active")};y.prototype.Close=function(){y.superclass.Close.apply(this,arguments);BX.removeClass(this.pListCont,"bxhtmled-top-bar-btn-active")};y.prototype.OnPopupClose=function(){var Z=this.editor.toolbar.controls.More;setTimeout(function(){if(Z&&Z.bOpened){Z.CheckOverlay()}},100)};function J(aa,Z){J.superclass.constructor.apply(this,arguments);this.id="bold";this.title=BX.message("Bold");this.className+=" bxhtmled-button-bold";this.action="bold";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(J,V);function B(aa,Z){B.superclass.constructor.apply(this,arguments);this.id="italic";this.title=BX.message("Italic");this.className+=" bxhtmled-button-italic";this.action="italic";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(B,V);function x(aa,Z){x.superclass.constructor.apply(this,arguments);this.id="underline";this.title=BX.message("Underline");this.className+=" bxhtmled-button-underline";this.action="underline";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(x,V);function h(aa,Z){h.superclass.constructor.apply(this,arguments);this.id="strike";this.title=BX.message("Strike");this.className+=" bxhtmled-button-strike";this.action="strikeout";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(h,V);function d(aa,Z){d.superclass.constructor.apply(this,arguments);this.id="remove_format";this.title=BX.message("RemoveFormat");this.className+=" bxhtmled-button-remove-format";this.action="removeFormat";this.checkableAction=false;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(d,V);function m(ae,ad){m.superclass.constructor.apply(this,arguments);this.id="template_selector";this.title=BX.message("TemplateSelectorTitle");this.className+=" ";this.width=85;this.zIndex=3007;this.arValues=[];var ab=this.editor.GetTemplateId(),aa=this.editor.config.templates,Z,ac;for(Z in aa){if(aa.hasOwnProperty(Z)){ac=aa[Z];this.arValues.push({id:ac.value,name:ac.name,title:ac.name,className:"bxhtmled-button-viewmode-wysiwyg",action:"changeTemplate",value:ac.value,defaultValue:ac.value==ab})}}this.Create();if(ad){ad.appendChild(this.GetCont())}this.SelectItem(ab)}BX.extend(m,window.BXHtmlEditor.DropDownList);function r(aa,Z){r.superclass.constructor.apply(this,arguments);this.id="ordered-list";this.title=BX.message("OrderedList");this.className+=" bxhtmled-button-ordered-list";this.action="insertOrderedList";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(r,V);r.prototype.OnClick=function(){if(!this.disabled){if(!this.editor.bbCode||!this.editor.synchro.IsFocusedOnTextarea()){r.superclass.OnClick.apply(this,arguments)}else{this.editor.GetDialog("InsertList").Show({type:"ol"})}}};function S(aa,Z){S.superclass.constructor.apply(this,arguments);this.id="unordered-list";this.title=BX.message("UnorderedList");this.className+=" bxhtmled-button-unordered-list";this.action="insertUnorderedList";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(S,V);S.prototype.OnClick=function(){if(!this.disabled){if(!this.editor.bbCode||!this.editor.synchro.IsFocusedOnTextarea()){r.superclass.OnClick.apply(this,arguments)}else{this.editor.GetDialog("InsertList").Show({type:"ul"})}}};function X(aa,Z){X.superclass.constructor.apply(this,arguments);this.id="indent";this.title=BX.message("Indent");this.className+=" bxhtmled-button-indent";this.action="indent";this.checkableAction=false;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(X,V);function L(aa,Z){L.superclass.constructor.apply(this,arguments);this.id="outdent";this.title=BX.message("Outdent");this.className+=" bxhtmled-button-outdent";this.action="outdent";this.checkableAction=false;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(L,V);function R(aa,Z){R.superclass.constructor.apply(this,arguments);this.id="align-list";this.title=BX.message("BXEdTextAlign");this.posOffset.left=0;this.action="align";var ab=this.className;this.className+=" bxhtmled-button-align-left";this.disabledForTextarea=!aa.bbCode;this.arValues=[{id:"align_left",title:BX.message("AlignLeft"),className:ab+" bxhtmled-button-align-left",action:"align",value:"left"},{id:"align_center",title:BX.message("AlignCenter"),className:ab+" bxhtmled-button-align-center",action:"align",value:"center"},{id:"align_right",title:BX.message("AlignRight"),className:ab+" bxhtmled-button-align-right",action:"align",value:"right"},{id:"align_justify",title:BX.message("AlignJustify"),className:ab+" bxhtmled-button-align-justify",action:"align",value:"justify"}];this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(R,window.BXHtmlEditor.DropDown);R.prototype.SetValue=function(aa,Z){if(this.disabled){this.SelectItem(null)}else{if(Z&&Z.value){this.SelectItem("align_"+Z.value)}else{this.SelectItem(null)}}};function z(aa,Z){z.superclass.constructor.apply(this,arguments);this.id="insert-link";this.title=BX.message("InsertLink");this.className+=" bxhtmled-button-link";this.posOffset={top:6,left:0};this.disabledForTextarea=!aa.bbCode;this.arValues=[{id:"edit_link",title:BX.message("EditLink"),className:this.className+" bxhtmled-button-link"},{id:"remove_link",title:BX.message("RemoveLink"),className:this.className+" bxhtmled-button-remove-link",action:"removeLink"}];this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(z,window.BXHtmlEditor.DropDown);z.prototype.OnClick=function(){if(this.disabled){return}if(!this.editor.bbCode||!this.editor.synchro.IsFocusedOnTextarea()){var ab,ad,ac,Z=0,aa=this.editor.action.CheckState("formatInline",{},"a");if(aa){for(ab=0;ab<aa.length;ab++){ad=aa[ab];if(ad){ac=ad;Z++}if(Z>1){break}}}if(Z===1&&ac){if(this.bOpened){this.Close()}else{this.Open()}}else{this.editor.GetDialog("Link").Show(aa,this.savedRange)}}else{this.editor.GetDialog("Link").Show(false,false)}};z.prototype.SelectItem=function(Z){if(Z=="edit_link"){this.editor.GetDialog("Link").Show(false,this.savedRange)}};function O(aa,Z){O.superclass.constructor.apply(this,arguments);this.id="image";this.title=BX.message("InsertImage");this.className+=" bxhtmled-button-image";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(O,V);O.prototype.OnClick=function(){if(!this.disabled){this.editor.GetDialog("Image").Show(false,this.savedRange)}};function P(aa,Z){P.superclass.constructor.apply(this,arguments);this.id="video";this.title=BX.message("BXEdInsertVideo");this.className+=" bxhtmled-button-video";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(P,V);P.prototype.OnClick=function(){if(!this.disabled){this.editor.GetDialog("Video").Show(false,this.savedRange)}};function k(aa,Z){k.superclass.constructor.apply(this,arguments);this.id="insert-anchor";this.title=BX.message("BXEdAnchor");this.className+=" bxhtmled-button-anchor";this.action="insertAnchor";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(k,V);k.prototype.OnClick=function(Z){var aa=this;if(this.disabled){return}if(!this.pPopup){this.pPopup=new BX.PopupWindow(this.id+"-popup",this.GetCont(),{zIndex:3005,lightShadow:true,offsetTop:4,overlay:{opacity:1},offsetLeft:-128,autoHide:true,closeByEsc:true,className:"bxhtmled-popup",content:""});this.pPopupCont=BX(this.id+"-popup");this.pPopupCont.className="bxhtmled-popup";this.pPopupCont.innerHTML='<div class="bxhtmled-popup-corner"></div>';this.pPopupContWrap=this.pPopupCont.appendChild(BX.create("DIV"));this.pPopupContInput=this.pPopupContWrap.appendChild(BX.create("INPUT",{props:{type:"text",placeholder:BX.message("BXEdAnchorName")+"...",title:BX.message("BXEdAnchorInsertTitle")},style:{width:"150px"}}));this.pPopupContBut=this.pPopupContWrap.appendChild(BX.create("INPUT",{props:{type:"button",value:BX.message("BXEdInsert")},style:{marginLeft:"6px"}}));BX.bind(this.pPopupContInput,"keyup",BX.proxy(this.OnKeyUp,this));BX.bind(this.pPopupContBut,"click",BX.proxy(this.Save,this));BX.addCustomEvent(this.pPopup,"onPopupClose",function(){aa.pPopup.destroy();aa.pPopup=null})}this.pPopupContInput.value="";this.pPopup.show();BX.focus(this.pPopupContInput)};k.prototype.Save=function(){var aa=BX.util.trim(this.pPopupContInput.value);if(aa!==""){aa=aa.replace(/[^ a-z0-9_\-]/gi,"");if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}var ab=this.editor.phpParser.GetSurrogateNode("anchor",BX.message("BXEdAnchor")+": #"+aa,null,{html:"",name:aa});this.editor.selection.InsertNode(ab);var Z=this.editor.util.CheckSurrogateNode(ab.parentNode);if(Z){this.editor.util.InsertAfter(ab,Z)}this.editor.selection.SetInvisibleTextAfterNode(ab);this.editor.synchro.StartSync(100);if(this.editor.toolbar.controls.More){this.editor.toolbar.controls.More.Close()}}this.pPopup.close()};k.prototype.OnKeyUp=function(Z){if(Z.keyCode===this.editor.KEY_CODES.enter){this.Save()}};function U(aa,Z){U.superclass.constructor.apply(this,arguments);this.id="insert-table";this.title=BX.message("BXEdTable");this.className+=" bxhtmled-button-table";this.itemClassName="bxhtmled-dd-list-item";this.action="insertTable";this.disabledForTextarea=!aa.bbCode;this.PATTERN_ROWS=10;this.PATTERN_COLS=10;this.zIndex=3007;this.posOffset={top:6,left:0};this.Create();if(Z){Z.appendChild(this.GetCont())}BX.addCustomEvent(this,"OnPopupClose",BX.proxy(this.OnPopupClose,this))}BX.extend(U,window.BXHtmlEditor.DropDown);U.prototype.Create=function(){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title},html:"<i></i>"});this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesCont.style.zIndex=this.zIndex;this.valueIndex={};this.pPatternWrap=this.pValuesCont.appendChild(BX.create("DIV"));this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV"));var ae=this,ad,ah,ag,ab,Z=false,ac=this.PATTERN_ROWS*this.PATTERN_COLS,af;this.pPatternTbl=this.pPatternWrap.appendChild(BX.create("TABLE",{props:{className:"bxhtmled-pattern-tbl"}}));function aa(al,ai){var aj,am,ak;for(aj=0;aj<ae.PATTERN_ROWS;aj++){for(am=0;am<ae.PATTERN_COLS;am++){ak=ae.pPatternTbl.rows[aj].cells[am];ak.className=(aj<=al&&am<=ai)?"bxhtmled-td-selected":""}}}BX.bind(this.pPatternTbl,"mousemove",function(aj){var ai=aj.target||aj.srcElement;if(ab!==ai){ab=ai;if(ai.nodeName=="TD"){Z=true;aa(ai.parentNode.rowIndex,ai.cellIndex)}else{if(ai.nodeName=="TABLE"){Z=false;aa(-1,-1)}}}});BX.bind(this.pPatternWrap,"mouseout",function(ai){Z=false;setTimeout(function(){if(!Z){aa(-1,-1)}},300)});BX.bind(this.pPatternTbl,"click",function(aj){var ai=aj.target||aj.srcElement;if(ai.nodeName=="TD"){if(ae.editor.action.IsSupported(ae.action)){if(ae.savedRange){ae.editor.selection.SetBookmark(ae.savedRange)}ae.editor.action.Exec(ae.action,{rows:ai.parentNode.rowIndex+1,cols:ai.cellIndex+1,border:1,cellPadding:1,cellSpacing:1})}if(ae.editor.toolbar.controls.More){ae.editor.toolbar.controls.More.Close()}ae.Close()}});for(ad=0;ad<ac;ad++){if(ad%this.PATTERN_COLS==0){ah=this.pPatternTbl.insertRow(-1)}ag=ah.insertCell(-1);ag.innerHTML="&nbsp;";ag.title=(ag.cellIndex+1)+"x"+(ah.rowIndex+1)}af=this.pValuesContWrap.appendChild(BX.create("SPAN",{props:{title:BX.message("BXEdInsertTableTitle"),className:this.itemClassName},html:BX.message("BXEdInsertTable")}));BX.bind(af,"mousedown",function(ai){ae.editor.GetDialog("Table").Show(false,ae.savedRange);if(ae.editor.toolbar.controls.More){ae.editor.toolbar.controls.More.Close()}ae.Close()});BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this))};U.prototype.OnPopupClose=function(){var Z=this.editor.toolbar.controls.More;setTimeout(function(){if(Z&&Z.bOpened){Z.CheckOverlay()}},100)};function e(aa,Z){e.superclass.constructor.apply(this,arguments);this.id="specialchar";this.title=BX.message("BXEdSpecialchar");this.className+=" bxhtmled-button-specialchar";this.itemClassName="bxhtmled-dd-list-item";this.CELLS_COUNT=10;this.posOffset={top:6,left:0};this.zIndex=3007;this.Create();if(Z){Z.appendChild(this.GetCont())}BX.addCustomEvent(this,"OnPopupClose",BX.proxy(this.OnPopupClose,this))}BX.extend(e,window.BXHtmlEditor.DropDown);e.prototype.Create=function(){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title},html:"<i></i>"});this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesCont.style.zIndex=this.zIndex;this.valueIndex={};this.pPatternWrap=this.pValuesCont.appendChild(BX.create("DIV"));this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV"));var ad=this.editor.GetLastSpecialchars(),af=this,ac,ae,aa,ab=ad.length,Z;this.pLastChars=this.pPatternWrap.appendChild(BX.create("TABLE",{props:{className:"bxhtmled-last-chars"}}));for(ac=0;ac<ab;ac++){if(ac%this.CELLS_COUNT==0){ae=this.pLastChars.insertRow(-1)}aa=ae.insertCell(-1)}BX.bind(this.pLastChars,"click",function(ai){var ag,ah=ai.target||ai.srcElement;if(ah.nodeType==3){ah=ah.parentNode}if(ah&&ah.getAttribute&&ah.getAttribute("data-bx-specialchar")&&af.editor.action.IsSupported("insertHTML")){if(af.savedRange){af.editor.selection.SetBookmark(af.savedRange)}ag=ah.getAttribute("data-bx-specialchar");af.editor.On("OnSpecialcharInserted",[ag]);af.editor.action.Exec("insertHTML",ag)}if(af.editor.toolbar.controls.More){af.editor.toolbar.controls.More.Close()}af.Close()});Z=this.pValuesContWrap.appendChild(BX.create("SPAN",{props:{title:BX.message("BXEdSpecialcharMoreTitle"),className:this.itemClassName},html:BX.message("BXEdSpecialcharMore")}));BX.bind(Z,"mousedown",function(){af.editor.GetDialog("Specialchar").Show(af.savedRange);if(af.editor.toolbar.controls.More){af.editor.toolbar.controls.More.Close()}af.Close()});BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this))};e.prototype.OnClick=function(){if(this.disabled){return}var ad=this.editor.GetLastSpecialchars(),ab,ac=-1,ae=-1,Z,aa=ad.length;for(ab=0;ab<aa;ab++){if(ab%this.CELLS_COUNT==0){ac++;ae=-1}ae++;Z=this.pLastChars.rows[ac].cells[ae];if(Z){Z.innerHTML=ad[ab];Z.setAttribute("data-bx-specialchar",ad[ab]);Z.title=BX.message("BXEdSpecialchar")+": "+ad[ab].substr(1,ad[ab].length-2)}}e.superclass.OnClick.apply(this,arguments)};e.prototype.OnPopupClose=function(){var Z=this.editor.toolbar.controls.More;setTimeout(function(){if(Z&&Z.bOpened){Z.CheckOverlay()}},100)};function c(aa,Z){c.superclass.constructor.apply(this,arguments);this.id="print_break";this.title=BX.message("BXEdPrintBreak");this.className+=" bxhtmled-button-print-break";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(c,V);c.prototype.OnClick=function(){if(this.disabled){return}if(this.editor.action.IsSupported("insertHTML")){if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}var ab=this.editor.GetIframeDoc(),ac=this.editor.SetBxTag(false,{tag:"printbreak",params:{innerHTML:'<span style="display: none">&nbsp;</span>'},name:BX.message("BXEdPrintBreakName"),title:BX.message("BXEdPrintBreakTitle")}),aa=BX.create("IMG",{props:{src:this.editor.EMPTY_IMAGE_SRC,id:ac,className:"bxhtmled-printbreak",title:BX.message("BXEdPrintBreakTitle")}},ab);this.editor.selection.InsertNode(aa);var Z=this.editor.util.CheckSurrogateNode(aa.parentNode);if(Z){this.editor.util.InsertAfter(aa,Z)}this.editor.selection.SetAfter(aa);this.editor.Focus();this.editor.synchro.StartSync(100)}if(this.editor.toolbar.controls.More){this.editor.toolbar.controls.More.Close()}};function I(aa,Z){I.superclass.constructor.apply(this,arguments);this.id="page_break";this.title=BX.message("BXEdPageBreak");this.className+=" bxhtmled-button-page-break";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(I,V);I.prototype.OnClick=function(){if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}var aa=this.editor.phpParser.GetSurrogateNode("pagebreak",BX.message("BXEdPageBreakSur"),BX.message("BXEdPageBreakSurTitle"));this.editor.selection.InsertNode(aa);var Z=this.editor.util.CheckSurrogateNode(aa.parentNode);if(Z){this.editor.util.InsertAfter(aa,Z)}this.editor.selection.SelectNode(aa);this.NormilizeBreakElement(aa);this.editor.selection.SetInvisibleTextAfterNode(aa);this.editor.synchro.StartSync(100);if(this.editor.toolbar.controls.More){this.editor.toolbar.controls.More.Close()}};I.prototype.NormilizeBreakElement=function(Z){if(Z.parentNode&&Z.parentNode.nodeName!=="BODY"){var aa=this.editor.util.GetNextNotEmptySibling(Z),ab=this.editor.util.GetPreviousNotEmptySibling(Z);if(!aa||!ab){if(!aa){this.editor.util.InsertAfter(Z,Z.parentNode)}if(!ab){Z.parentNode.parentNode.insertBefore(Z,Z.parentNode)}return this.NormilizeBreakElement(Z)}}};function p(aa,Z){p.superclass.constructor.apply(this,arguments);this.id="hr";this.title=BX.message("BXEdInsertHr");this.className+=" bxhtmled-button-hr";this.action="insertHr";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(p,V);function G(aa,Z){G.superclass.constructor.apply(this,arguments);this.id="spellcheck";this.title=BX.message("BXEdSpellcheck");this.className+=" bxhtmled-button-spell";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(G,V);G.prototype.OnClick=function(){if(this.disabled){return}if(this.editor.config.usePspell!=="Y"){alert(BX.message("BXEdNoPspellWarning"))}else{var Z=this;if(!window.BXHtmlEditor.Spellchecker){return BX.loadScript(this.editor.config.spellcheck_path,BX.proxy(this.OnClick,this))}if(!this.editor.Spellchecker){this.editor.Spellchecker=new window.BXHtmlEditor.Spellchecker(this.editor)}this.editor.GetDialog("Spell").Show(this.savedRange);this.editor.Spellchecker.CheckDocument()}};function u(aa,Z){u.superclass.constructor.apply(this,arguments);this.id="settings";this.title=BX.message("BXEdSettings");this.className+=" bxhtmled-button-settings";this.disabledForTextarea=false;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(u,V);u.prototype.OnClick=function(){this.editor.GetDialog("Settings").Show()};function K(aa,Z){K.superclass.constructor.apply(this,arguments);this.id="sub";this.title=BX.message("BXEdSub");this.className+=" bxhtmled-button-sub";this.action="sub";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(K,V);function N(aa,Z){N.superclass.constructor.apply(this,arguments);this.id="sup";this.title=BX.message("BXEdSup");this.className+=" bxhtmled-button-sup";this.action="sup";this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(N,V);function n(aa,Z){n.superclass.constructor.apply(this,arguments);this.id="fullscreen";this.title=BX.message("BXEdFullscreen");this.className+=" bxhtmled-button-fullscreen";this.action="fullscreen";this.disabledForTextarea=false;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(n,V);n.prototype.Check=function(Z){this.GetCont().title=Z?BX.message("BXEdFullscreenBack"):BX.message("BXEdFullscreen");n.superclass.Check.apply(this,arguments)};function j(aa,Z){j.superclass.constructor.apply(this,arguments);this.id="smile";this.title=BX.message("BXEdSmile");this.className+=" bxhtmled-button-smile";this.checkableAction=false;this.zIndex=3007;this.smileSizeDef=20;this.posOffset={top:6,left:0};this.smiles=aa.config.smiles||[];this.smileSets=aa.config.smileSets||[];this.disabledForTextarea=!aa.bbCode;this.Create();if(Z&&this.smiles.length>0){Z.appendChild(this.GetCont())}BX.addCustomEvent(this,"OnPopupClose",BX.proxy(this.OnPopupClose,this))}BX.extend(j,window.BXHtmlEditor.DropDown);j.prototype.CheckBeforeShow=function(){return this.editor.config.smiles&&this.editor.config.smiles.length>0};j.prototype.Create=function(){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title},html:"<i></i>"});this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-cont bxhtmled-smile-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesCont.style.zIndex=this.zIndex;this.valueIndex={};var ag=this,Z,af,ab,ae=this.smileSets.length,ad=Math.round(100/ae)+"%",ac=(100*ae)+"%";if(ae>1){this.smileSetsIndex={};this.smileTabsWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-smile-tabs-wrap"}}));this.smileSliderWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-smile-slider-wrap"}}));this.smileSlider=this.smileSliderWrap.appendChild(BX.create("DIV",{props:{className:"bxhtmled-smile-slider"},style:{width:ac}}));for(Z=0;Z<this.smileSets.length;Z++){if(!this.smileSets[Z].ID&&this.smileSets[Z].id){this.smileSets[Z].ID=this.smileSets[Z].id}this.smileSetsIndex[this.smileSets[Z].ID]=Z;this.smileSets[Z].butWrap=this.smileTabsWrap.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-smile-tab"}}));this.smileSets[Z].butWrap.setAttribute("data-bx-smile-set",this.smileSets[Z].ID);this.smileSets[Z].butWrapImage=false;this.smileSets[Z].smilesBlock=this.smileSlider.appendChild(BX.create("DIV",{props:{className:"bxhtmled-smiles-wrap"},style:{width:ad}}));if(Z==0){BX.addClass(this.smileSets[Z].butWrap,"bxhtmled-smile-tab-active");this.currentTab=this.smileSets[Z].butWrap}}}for(Z=0;Z<this.smiles.length;Z++){af=BX.create("IMG",{props:{className:"bxhtmled-smile-img",src:this.smiles[Z].path,title:this.smiles[Z].name||this.smiles[Z].code}});if(this.smiles[Z].width){af.style.width=parseInt(this.smiles[Z].width)+"px"}if(this.smiles[Z].height){af.style.height=parseInt(this.smiles[Z].height)+"px"}BX.bind(af,"error",function(){BX.remove(this)});if(this.smiles[Z].set_id&&this.smileSetsIndex&&this.smileSetsIndex[this.smiles[Z].set_id]!==undefined){ab=this.smileSetsIndex[this.smiles[Z].set_id];this.smileSets[ab].smilesBlock.appendChild(af);if(!this.smileSets[ab].butWrapImage){this.smileSets[ab].butWrapImage=af.cloneNode();this.smileSets[ab].butWrapImage.className="";this.smileSets[ab].butWrapImage.title="";this.smileSets[ab].butWrap.appendChild(this.smileSets[ab].butWrapImage);var aa=this.smiles[Z].height;if(aa<this.smileSizeDef){this.smileSets[ab].butWrapImage.style.marginTop=Math.round((this.smileSizeDef-aa)/2)+"px"}}}else{this.pValuesCont.appendChild(af)}af.setAttribute("data-bx-type","action");af.setAttribute("data-bx-action","insertSmile");af.setAttribute("data-bx-value",this.smiles[Z].code)}BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this));BX.bind(this.pValuesCont,"mousedown",function(ai){var ah=ai.target||ai.srcElement;if(ah&&ah.getAttribute("data-bx-smile-set")!==null){return ag.ShowSetTab(ah.getAttribute("data-bx-smile-set"))}else{if(ah&&ah.parentNode&&ah.parentNode.getAttribute("data-bx-smile-set")!==null){return ag.ShowSetTab(ah.parentNode.getAttribute("data-bx-smile-set"))}}ag.editor.CheckCommand(ai.target||ai.srcElement);ag.Close()})};j.prototype.ShowSetTab=function(aa){if(this.smileSetsIndex[aa]!==undefined){var ad=this,ab=this.smileSets[this.smileSetsIndex[aa]],ac=parseInt(this.smileSlider.style.marginLeft)||0,Z=-parseInt(this.smileSetsIndex[aa]*100);if(this.currentTab){BX.removeClass(this.currentTab,"bxhtmled-smile-tab-active")}BX.addClass(ab.butWrap,"bxhtmled-smile-tab-active");this.currentTab=ab.butWrap;this.ani=new BX.easing({duration:300,start:{marginLeft:ac},finish:{marginLeft:Z},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(ae){if(ad.smileSlider){ad.smileSlider.style.marginLeft=ae.marginLeft+"%"}},complete:function(){if(ad.smileSlider){ad.smileSlider.style.marginLeft="-"+Z+"%"}ad.ani=null}});this.ani.animate()}return false};U.prototype.OnPopupClose=function(){var Z=this.editor.toolbar.controls.More;setTimeout(function(){if(Z&&Z.bOpened){Z.CheckOverlay()}},100)};function f(aa,Z){f.superclass.constructor.apply(this,arguments);this.id="quote";this.title=BX.message("BXEdQuote");this.className+=" bxhtmled-button-quote";this.action="quote";this.disabledForTextarea=!aa.bbCode;this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(f,V);f.prototype.OnMouseDown=function(){this.editor.action.actions.quote.setExternalSelection(false);this.editor.action.actions.quote.setRange(false);var Z=this.editor.selection.GetRange(this.editor.selection.GetSelection(document));if(!this.editor.synchro.IsFocusedOnTextarea()&&this.editor.iframeView.isFocused){this.savedRange=this.editor.selection.SaveBookmark();this.editor.action.actions.quote.setRange(this.savedRange)}if((this.editor.synchro.IsFocusedOnTextarea()||!this.editor.iframeView.isFocused||this.savedRange.collapsed)&&Z&&!Z.collapsed){this.editor.action.actions.quote.setExternalSelectionFromRange(Z)}f.superclass.OnMouseDown.apply(this,arguments)};function g(aa,Z){g.superclass.constructor.apply(this,arguments);this.id="code";this.title=BX.message("BXEdCode");this.className+=" bxhtmled-button-code";this.action="code";this.disabledForTextarea=!aa.bbCode;this.lastStatus=null;this.allowedControls=["SearchButton","ChangeView","Undo","Redo","RemoveFormat","TemplateSelector","InsertChar","Settings","Fullscreen","Spellcheck","Code","More","BbCode"];this.Create();if(Z){Z.appendChild(this.GetCont())}}BX.extend(g,V);g.prototype.SetValue=function(ac,ad,ab){if(this.lastStatus!==ac){var aa=this.editor.toolbar;for(var Z in aa.controls){if(aa.controls.hasOwnProperty(Z)&&typeof aa.controls[Z].Disable=="function"&&!BX.util.in_array(Z,this.allowedControls)){aa.controls[Z].Disable(ac)}}}this.lastStatus=ac;this.Check(ac)};function q(aa,Z){q.superclass.constructor.apply(this,arguments);this.id="more";this.title=BX.message("BXEdMore");this.className+=" bxhtmled-button-more";this.Create();this.posOffset.left=-8;BX.addClass(this.pValuesContWrap,"bxhtmled-more-cnt");this.disabledForTextarea=false;if(Z){Z.appendChild(this.GetCont())}var ab=this;BX.bind(this.pValuesContWrap,"click",function(ad){var ac=ad.target||ad.srcElement,ae=(ac&&ac.getAttribute)?ac.getAttribute("data-bx-type"):false;ab.editor.CheckCommand(ac)})}BX.extend(q,window.BXHtmlEditor.DropDown);q.prototype.Open=function(){this.pValuesCont.style.width="";q.superclass.Open.apply(this,arguments);var Z=this.GetPopupBindCont(),ab=BX.pos(Z),aa=Math.round(ab.left-this.pValuesCont.offsetWidth/2+Z.offsetWidth/2+this.posOffset.left);this.pValuesCont.style.width=this.pValuesCont.offsetWidth+"px";this.pValuesCont.style.left=aa+"px"};q.prototype.GetPopupCont=function(){return this.pValuesContWrap};q.prototype.CheckClose=function(Z){if(!this.bOpened){return BX.unbind(document,"mousedown",BX.proxy(this.CheckClose,this))}var aa;if(Z.target){aa=Z.target}else{if(Z.srcElement){aa=Z.srcElement}}if(aa.nodeType==3){aa=aa.parentNode}if(aa.style.zIndex>this.zIndex){this.CheckOverlay()}else{if(!BX.findParent(aa,{className:"bxhtmled-popup"})){this.Close()}}};q.prototype.CheckOverlay=function(){var Z=this;this.editor.overlay.Show({zIndex:this.zIndex-1}).onclick=function(){Z.Close()}};function E(Z,aa){aa={id:"bx_image",width:700,resizable:false,className:"bxhtmled-img-dialog"};this.id="image";this.action="insertImage";this.loremIpsum=BX.message("BXEdLoremIpsum")+"\n"+BX.message("BXEdLoremIpsum");E.superclass.constructor.apply(this,[Z,aa]);this.readyToShow=false;if(!this.editor.fileDialogsLoaded){var ab=this;this.editor.LoadFileDialogs(function(){ab.SetContent(ab.Build());ab.readyToShow=true})}else{this.SetContent(this.Build());this.readyToShow=true}BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(E,t);E.prototype.Build=function(){function aa(an,am,ai){var al,ak,aj;al=an.insertRow(-1);if(ai){al.className="bxhtmled-add-row"}ak=al.insertCell(-1);ak.className="bxhtmled-left-c";if(am&&am.label){ak.appendChild(BX.create("LABEL",{props:{className:am.required?"bxhtmled-req":""},text:am.label})).setAttribute("for",am.id)}aj=al.insertCell(-1);aj.className="bxhtmled-right-c";return{row:al,leftCell:ak,rightCell:aj}}var ad=this,Z,af;this.pCont=BX.create("DIV",{props:{className:"bxhtmled-img-dialog-cnt"}});var ah=BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl bxhtmled-img-dialog-tbl"}});Z=ah.insertRow(-1);Z.className="bxhtmled-img-preview-row";af=BX.adjust(Z.insertCell(-1),{props:{colSpan:2,className:"bxhtmled-img-prev-c"}});this.pPreview=af.appendChild(BX.create("DIV",{props:{className:"bxhtmled-img-preview"+(this.editor.bbCode?" bxhtmled-img-preview-bb":""),id:this.id+"-preview"},html:this.editor.bbCode?"":this.loremIpsum}));this.pPreviewRow=Z;Z=aa(ah,{label:BX.message("BXEdImgSrc")+":",id:this.id+"-src",required:true});this.pSrc=Z.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-src",className:"bxhtmled-80-input"}}));this.pSrc.placeholder=BX.message("BXEdImgSrcRequired");BX.bind(this.pSrc,"blur",BX.proxy(this.SrcOnChange,this));BX.bind(this.pSrc,"change",BX.proxy(this.SrcOnChange,this));BX.bind(this.pSrc,"keyup",BX.proxy(this.SrcOnChange,this));this.firstFocus=this.pSrc;if(!this.editor.bbCode){var ag=BX("bx-open-file-medialib-but-"+this.editor.id);if(ag){Z.rightCell.appendChild(ag)}else{var ac=BX("bx_open_file_medialib_button_"+this.editor.id);if(ac){Z.rightCell.appendChild(ac);BX.bind(ac,"click",window["BxOpenFileBrowserImgFile"+this.editor.id])}else{var ab=BX("bx_ml_bx_open_file_medialib_button_"+this.editor.id);if(ab){Z.rightCell.appendChild(ab)}}}}else{ag=BX("bx-open-file-medialib-but-"+this.editor.id);ac=BX("bx_open_file_medialib_button_"+this.editor.id);if(ag){ag.style.display="none"}if(ac){ac.style.display="none"}}Z=aa(ah,{label:BX.message("BXEdImgSize")+":",id:this.id+"-size"});Z.rightCell.appendChild(this.GetSizeControl());BX.addClass(Z.leftCell,"bxhtmled-left-c-top");Z.leftCell.style.paddingTop="12px";this.pSizeRow=Z.row;if(!this.editor.bbCode){Z=aa(ah,{label:BX.message("BXEdImgTitle")+":",id:this.id+"-title"});this.pTitle=Z.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-title",className:"bxhtmled-90-input"}}))}Z=ah.insertRow(-1);var ae=Z.insertCell(-1);BX.adjust(ae,{props:{className:"bxhtmled-title-cell bxhtmled-title-cell-foldable",colSpan:2},text:BX.message("BXEdLinkAdditionalTitle")});ae.onclick=function(){ad.ShowRows(["align","style","alt","link"],true,!ad.bAdditional);ad.bAdditional=!ad.bAdditional};if(!this.editor.bbCode){Z=aa(ah,{label:BX.message("BXEdImgAlign")+":",id:this.id+"-align"});this.pAlign=Z.rightCell.appendChild(BX.create("SELECT",{props:{id:this.id+"-align"}}));this.pAlign.options.add(new Option(BX.message("BXEdImgAlignNone"),"",true,true));this.pAlign.options.add(new Option(BX.message("BXEdImgAlignTop"),"top",true,true));this.pAlign.options.add(new Option(BX.message("BXEdImgAlignLeft"),"left",true,true));this.pAlign.options.add(new Option(BX.message("BXEdImgAlignRight"),"right",true,true));this.pAlign.options.add(new Option(BX.message("BXEdImgAlignBottom"),"bottom",true,true));this.pAlign.options.add(new Option(BX.message("BXEdImgAlignMiddle"),"middle",true,true));BX.bind(this.pAlign,"change",BX.delegate(this.ShowPreview,this));this.pAlignRow=Z.row}if(!this.editor.bbCode){Z=aa(ah,{label:BX.message("BXEdImgAlt")+":",id:this.id+"-alt"});this.pAlt=Z.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-alt",className:"bxhtmled-90-input"}}));this.pAltRow=Z.row}if(!this.editor.bbCode){Z=aa(ah,{label:BX.message("BXEdCssClass")+":",id:this.id+"-style"},true);this.pClass=Z.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-style"}}));this.pStyleRow=Z.row}Z=aa(ah,{label:BX.message("BXEdImgLinkOnImage")+":",id:this.id+"-link"});this.pLink=Z.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-link",className:"bxhtmled-80-input"}}));this.pEditLinkBut=Z.rightCell.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-top-bar-btn bxhtmled-button-link",title:BX.message("EditLink")},html:"<i></i>"}));BX.bind(this.pEditLinkBut,"click",function(){if(BX.util.trim(ad.pSrc.value)==""){BX.focus(ad.pSrc)}else{var am=ad.pLink.value;ad.pLink.value="bx-temp-link-href";ad.Save();ad.oDialog.Close();var ak,al,aj=ad.editor.GetIframeDoc().getElementsByTagName("A");for(ak=0;ak<aj.length;ak++){var ai=aj[ak].getAttribute("href");if(ai=="bx-temp-link-href"){al=aj[ak];al.setAttribute("href",am);ad.editor.selection.SelectNode(al);ad.editor.GetDialog("Link").Show([al]);break}}}});this.pCont.appendChild(ah);this.pLinkRow=Z.row;if(!this.editor.bbCode){window["OnFileDialogImgSelect"+this.editor.id]=function(ai,al,ak){var aj;if(typeof ai=="object"){aj=ai.src;if(ad.pTitle){ad.pTitle.value=ai.description||ai.name}if(ad.pAlt){ad.pAlt.value=ai.description||ai.name}}else{aj=(al=="/"?"":al)+"/"+ai}ad.pSrc.value=aj;BX.focus(ad.pSrc);ad.pSrc.select();ad.SrcOnChange()}}this.rows={preview:{cont:this.pPreviewRow,height:200},size:{cont:this.pSizeRow,height:68},align:{cont:this.pAlignRow,height:36},style:{cont:this.pStyleRow,height:36},alt:{cont:this.pAltRow,height:36},link:{cont:this.pLinkRow,height:36}};return this.pCont};E.prototype.GetSizeControl=function(){var Z,ae,ad=this,ah,ac,aa=[100,90,80,70,60,50,40,30,20],aj=BX.create("DIV"),af=aj.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-size-perc"}}));this.percVals=aa;this.pPercWrap=af;this.pSizeCont=aj;this.oSize={};BX.bind(af,"click",function(am){var al=am.target||am.srcElement;if(al){var ak=parseInt(al.getAttribute("data-bx-size-val"),10);if(ak){ad.SetPercentSize(ak,true)}}});function ai(am){var an=0,ak,al=am.target||am.srcElement;if(al!==af){al=BX.findParent(al,function(ao){an++;return ao==af||an>3},af)}if(al!==af){ad.SetPercentSize(ad.savedPerc,false);if(ad.sizeControlChecker){BX.unbind(document,"mousemove",ai);ad.sizeControlChecker=false}}}BX.bind(af,"mouseover",function(am){var ak,al=am.target||am.srcElement;if(!ad.sizeControlChecker){BX.bind(document,"mousemove",ai);ad.sizeControlChecker=true}ak=parseInt(al.getAttribute("data-bx-size-val"),10);ad.overPerc=ak>0;if(ad.overPerc){ad.SetPercentSize(ak,false)}else{if(ah){clearTimeout(ah)}ah=setTimeout(function(){if(!ad.overPerc){ad.SetPercentSize(ad.savedPerc,false);if(ad.sizeControlChecker){BX.unbind(document,"mousemove",ai);ad.sizeControlChecker=false}}},200)}});BX.bind(af,"mouseout",function(am){var ak,al=am.target||am.srcElement;if(ah){clearTimeout(ah)}ah=setTimeout(function(){if(!ad.overPerc){ad.SetPercentSize(ad.savedPerc,false);if(ad.sizeControlChecker){BX.unbind(document,"mousemove",ai);ad.sizeControlChecker=false}}},200)});function ab(){var ak=parseInt(ad.pWidth.value);if(!isNaN(ak)&&Z!=ak){if(!ad.sizeRatio&&ad.originalWidth&&ad.originalHeight){ad.sizeRatio=ad.originalWidth/ad.originalHeight}if(ad.sizeRatio){ad.pHeight.value=Math.round(ak/ad.sizeRatio);Z=ak;ad.ShowPreview()}}}function ag(){var ak=parseInt(ad.pHeight.value);if(!isNaN(ak)&&ae!=ak){if(!ad.sizeRatio&&ad.originalWidth&&ad.originalHeight){ad.sizeRatio=ad.originalWidth/ad.originalHeight}if(ad.sizeRatio){ad.pWidth.value=parseInt(ak*ad.sizeRatio);ae=ak;ad.ShowPreview()}}}aj.appendChild(BX.create("LABEL",{text:BX.message("BXEdImgWidth")+": "})).setAttribute("for",this.id+"-width");this.pWidth=aj.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-width"},style:{width:"40px",marginBottom:"4px"}}));aj.appendChild(BX.create("LABEL",{style:{marginLeft:"20px"},text:BX.message("BXEdImgHeight")+": "})).setAttribute("for",this.id+"-height");this.pHeight=aj.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-height"},style:{width:"40px",marginBottom:"4px"}}));this.pNoSize=aj.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:this.id+"-no-size",className:"bxhtmled-img-no-size-ch"}}));aj.appendChild(BX.create("LABEL",{props:{className:"bxhtmled-img-no-size-lbl"},text:BX.message("BXEdImgNoSize")})).setAttribute("for",this.id+"-no-size");BX.bind(this.pNoSize,"click",BX.proxy(this.NoSizeCheck,this));BX.bind(this.pWidth,"blur",ab);BX.bind(this.pWidth,"change",ab);BX.bind(this.pWidth,"keyup",ab);BX.bind(this.pHeight,"blur",ag);BX.bind(this.pHeight,"change",ag);BX.bind(this.pHeight,"keyup",ag);for(ac=0;ac<aa.length;ac++){af.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-size-perc-i"},attrs:{"data-bx-size-val":aa[ac]},html:aa[ac]+"%"}))}return aj};E.prototype.NoSizeCheck=function(){if(this.pNoSize.checked){BX.addClass(this.pSizeCont,"bxhtmled-img-no-size-cont");this.pSizeRow.cells[0].style.height=this.pSizeRow.cells[1].style.height=""}else{BX.removeClass(this.pSizeCont,"bxhtmled-img-no-size-cont")}this.ShowPreview()};E.prototype.SetPercentSize=function(ab,ac){var ad,aa,Z="bxhtmled-size-perc-i-active";if(ac){for(aa=0;aa<this.pPercWrap.childNodes.length;aa++){ad=this.pPercWrap.childNodes[aa];if(ab&&ad.getAttribute("data-bx-size-val")==ab){BX.addClass(ad,Z)}else{BX.removeClass(ad,Z)}}}if(ab!==false){ab=ab/100;this.pWidth.value=Math.round(this.originalWidth*ab)||"";this.pHeight.value=Math.round(this.originalHeight*ab)||""}else{if(this.savedWidth&&this.savedHeight){this.pWidth.value=this.savedWidth;this.pHeight.value=this.savedHeight}}this.ShowPreview();if(ac){this.savedWidth=this.pWidth.value;this.savedHeight=this.pHeight.value;this.savedPerc=ab!==false?(ab||1)*100:false}};E.prototype.SrcOnChange=function(Z){var ac,aa,ab,ae,ad,ag=this,af=this.pSrc.value;Z=Z!==false;if(this.lastSrc!==af){this.lastSrc=af;if(!this.pInvisCont){this.pInvisCont=this.pCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-invis-cnt"}}))}else{BX.cleanNode(this.pInvisCont)}this.dummyImg=this.pInvisCont.appendChild(BX.create("IMG"));BX.bind(this.dummyImg,"load",function(){setTimeout(function(){ag.originalWidth=ag.dummyImg.offsetWidth;ag.originalHeight=ag.dummyImg.offsetHeight;if(Z){ag.pWidth.value=ag.originalWidth;ag.pHeight.value=ag.originalHeight;aa=100}else{aa=false;ae=Math.round(10000*parseInt(ag.pWidth.value)/parseInt(ag.originalWidth))/100;ad=Math.round(10000*parseInt(ag.pHeight.value)/parseInt(ag.originalHeight))/100;if(Math.abs(ae-ad)<=0.1){ab=(ae+ad)/2;for(ac=0;ac<ag.percVals.length;ac++){if(Math.abs(ag.percVals[ac]-ab)<=0.1){aa=ag.percVals[ac];break}}}}ag.sizeRatio=ag.originalWidth/ag.originalHeight;ag.SetPercentSize(aa,true);if(ag.bEmptySrcRowsHidden){ag.ShowRows((ag.bAdditional?["preview","size","align","style","alt"]:["preview","size"]),true,true);ag.bEmptySrcRowsHidden=false}ag.ShowPreview()},100)});BX.bind(this.dummyImg,"error",function(){ag.pWidth.value="";ag.pHeight.value=""});this.dummyImg.src=af}};E.prototype.ShowPreview=function(){if(!this.pPreviewImg){this.pPreviewImg=BX.create("IMG");if(this.pAlign){this.pPreview.insertBefore(this.pPreviewImg,this.pPreview.firstChild)}else{this.pPreview.appendChild(this.pPreviewImg)}}if(this.pPreviewImg.src!=this.pSrc.value){this.pPreviewImg.src=this.pSrc.value}if(this.pNoSize.checked){this.pPreviewImg.style.width="";this.pPreviewImg.style.height=""}else{this.pPreviewImg.style.width=this.pWidth.value+"px";this.pPreviewImg.style.height=this.pHeight.value+"px"}if(this.pAlign){var Z=this.pAlign.value;if(Z!=this.pPreviewImg.align){if(Z==""){this.pPreviewImg.removeAttribute("align")}else{this.pPreviewImg.align=Z}}}};E.prototype.SetValues=function(ac){if(!ac){ac={}}var Z,ab,aa=["preview","size","align","style","alt"];this.lastSrc="";this.bEmptySrcRowsHidden=this.bNewImage;if(this.bNewImage){for(Z=0;Z<aa.length;Z++){ab=this.rows[aa[Z]];if(ab&&ab.cont){ab.cont.style.display="none";this.SetRowHeight(ab.cont,0,0)}}}else{for(Z=0;Z<aa.length;Z++){ab=this.rows[aa[Z]];if(ab&&ab.cont){ab.cont.style.display="";this.SetRowHeight(ab.cont,ab.height,100)}}}this.pSrc.value=this.editor.util.spaceUrlDecode(ac.src||"");if(this.pTitle){this.pTitle.value=ac.title||""}if(this.pAlt){this.pAlt.value=ac.alt||""}this.savedWidth=this.pWidth.value=ac.width||"";this.savedHeight=this.pHeight.value=ac.height||"";if(this.pAlign){this.pAlign.value=ac.align||""}if(this.pClass){this.pClass.value=ac.className||""}this.pLink.value=ac.link||"";this.pNoSize.checked=ac.noWidth&&ac.noHeight;this.NoSizeCheck();this.ShowRows(["align","style","alt","link"],false,false);this.bAdditional=false;this.SrcOnChange(!ac.width||!ac.height);if(this.pClass){if(!this.oClass){this.oClass=new window.BXHtmlEditor.ClassSelector(this.editor,{id:this.id+"-class-selector",input:this.pClass,filterTag:"IMG",value:this.pClass.value});var ad=this;BX.addCustomEvent(this.oClass,"OnComboPopupClose",function(){ad.closeByEnter=true});BX.addCustomEvent(this.oClass,"OnComboPopupOpen",function(){ad.closeByEnter=false})}else{this.oClass.OnChange()}}};E.prototype.GetValues=function(){var Z={src:this.pSrc.value,width:this.pNoSize.checked?"":this.pWidth.value,height:this.pNoSize.checked?"":this.pHeight.value,link:this.pLink.value||"",image:this.image||false};if(this.pTitle){Z.title=this.pTitle.value}if(this.pAlt){Z.alt=this.pAlt.value}if(this.pAlign){Z.align=this.pAlign.value}if(this.pClass){Z.className=this.pClass.value||""}return Z};E.prototype.Show=function(Z,ag){var af=this,ad,ah={},aa,ab,ac=false;if(!this.readyToShow){return setTimeout(function(){af.Show(Z,ag)},100)}this.savedRange=ag;if(!this.editor.bbCode||!this.editor.synchro.IsFocusedOnTextarea()){if(!this.editor.iframeView.IsFocused()){this.editor.iframeView.Focus()}if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}if(!Z){ad=this.editor.selection.GetRange();Z=ad.getNodes([1])}}if(Z){for(ab=0;ab<Z.length;ab++){ac=Z[ab];aa=this.editor.GetBxTag(ac);if(aa.tag||!ac.nodeName||ac.nodeName!="IMG"){ac=false}else{break}}}this.bNewImage=!ac;this.image=ac;if(ac){ah.src=ac.getAttribute("src");if(ac.style.width){ah.width=ac.style.width}if(!ah.width&&ac.getAttribute("width")){ah.width=ac.getAttribute("width")}if(!ah.width){ah.width=ac.offsetWidth;ah.noWidth=true}if(ac.style.height){ah.height=ac.style.height}if(!ah.height&&ac.getAttribute("height")){ah.height=ac.getAttribute("height")}if(!ah.height){ah.height=ac.offsetHeight;ah.noHeight=true}var ae=ac.getAttribute("data-bx-clean-attribute");if(ae){ac.removeAttribute(ae);ac.removeAttribute("data-bx-clean-attribute")}ah.alt=ac.alt||"";ah.title=ac.title||"";ah.title=ac.title||"";ah.className=ac.className;ah.align=ac.align||"";var ai=ac.parentNode.nodeName=="A"?ac.parentNode:null;if(ai&&ai.href){ah.link=ai.getAttribute("href")}}if(!this.editor.bbCode){window["OnFileDialogSelect"+this.editor.id]=window["OnFileDialogImgSelect"+this.editor.id]=function(aj,am,al){var ak;if(typeof aj=="object"){ak=aj.src;if(af.pTitle){af.pTitle.value=aj.description||aj.name}if(af.pAlt){af.pAlt.value=aj.description||aj.name}}else{ak=(am=="/"?"":am)+"/"+aj}af.pSrc.value=ak;BX.focus(af.pSrc);af.pSrc.select();af.SrcOnChange()}}this.SetValues(ah);this.SetTitle(BX.message("InsertImage"));E.superclass.Show.apply(this,arguments)};E.prototype.SetPanelHeight=function(Z,aa){this.pSearchCont.style.height=Z+"px";this.pSearchCont.style.opacity=aa/100;this.editor.SetAreaContSize(this.origAreaWidth,this.origAreaHeight-Z,{areaContTop:this.editor.toolbar.GetHeight()+Z})};E.prototype.ShowRows=function(ah,Z,ae){var ad=this,af,aa,ai,ab,ac,ag;if(Z){for(ac=0;ac<ah.length;ac++){ag=this.rows[ah[ac]];if(ag&&ag.cont){if(ag.animation){ag.animation.stop()}ag.cont.style.display="";if(ae){af=0;aa=ag.height;ai=0;ab=100}else{af=ag.height;aa=0;ai=100;ab=0}ag.animation=new BX.easing({_row:ag,duration:300,start:{height:af,opacity:ai},finish:{height:aa,opacity:ab},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(aj){ad.SetRowHeight(this._row.cont,aj.height,aj.opacity)},complete:function(){ad.CheckSize();this._row.animation=null}});ag.animation.animate()}}}else{for(ac=0;ac<ah.length;ac++){ag=this.rows[ah[ac]];if(ag&&ag.cont){if(ae){ag.cont.style.display="";this.SetRowHeight(ag.cont,ag.height,100)}else{ag.cont.style.display="none";this.SetRowHeight(ag.cont,0,0)}}}this.CheckSize()}};E.prototype.SetRowHeight=function(ac,Z,aa){if(ac&&ac.cells){if(Z==0||aa==0){ac.style.display="none"}else{ac.style.display=""}ac.style.opacity=aa/100;for(var ab=0;ab<ac.cells.length;ab++){ac.cells[ab].style.height=Z+"px"}}};function T(Z,aa){aa={id:"bx_link",width:600,resizable:false,className:"bxhtmled-link-dialog"};T.superclass.constructor.apply(this,[Z,aa]);this.id="link"+this.editor.id;this.action="createLink";this.selectFirstFocus=true;this.readyToShow=false;if(!this.editor.fileDialogsLoaded){var ab=this;this.editor.LoadFileDialogs(function(){ab.SetContent(ab.Build());ab.readyToShow=true})}else{this.SetContent(this.Build());this.readyToShow=true}BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(T,t);T.prototype.Build=function(){function ab(ap,ao,ak){var an,am,al;an=ap.insertRow(-1);if(ak){an.className="bxhtmled-add-row"}am=an.insertCell(-1);am.className="bxhtmled-left-c";if(ao&&ao.label){am.appendChild(BX.create("LABEL",{text:ao.label})).setAttribute("for",ao.id)}al=an.insertCell(-1);al.className="bxhtmled-right-c";return{row:an,leftCell:am,rightCell:al}}var aa,aj=BX.create("DIV");var ai=BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl bxhtmled-dialog-tbl-collapsed"}});if(!this.editor.bbCode){aa=ab(ai,{label:BX.message("BXEdLinkType")+":",id:this.id+"-type"});this.pType=aa.rightCell.appendChild(BX.create("SELECT",{props:{id:this.id+"-type"}}));this.pType.options.add(new Option(BX.message("BXEdLinkTypeInner"),"internal",true,true));this.pType.options.add(new Option(BX.message("BXEdLinkTypeOuter"),"external",false,false));this.pType.options.add(new Option(BX.message("BXEdLinkTypeAnchor"),"anchor",false,false));this.pType.options.add(new Option(BX.message("BXEdLinkTypeEmail"),"email",false,false));BX.bind(this.pType,"change",BX.delegate(this.ChangeType,this))}aa=ab(ai,{label:BX.message("BXEdLinkText")+":",id:this.id+"-text"});this.pText=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-text",placeholder:BX.message("BXEdLinkTextPh")}}));this.pTextCont=aa.row;aa=ab(ai,{label:BX.message("BXEdLinkInnerHtml")+":",id:this.id+"-innerhtml"});this.pInnerHtml=aa.rightCell.appendChild(BX.create("DIV",{props:{className:"bxhtmled-ld-html-wrap"}}));this.pInnerHtmlCont=aa.row;this.firstFocus=this.pText;aa=ab(ai,{label:BX.message("BXEdLinkHref")+":",id:this.id+"-href"});this.pHrefIn=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-href",placeholder:BX.message("BXEdLinkHrefPh")}}));if(!this.editor.bbCode){this.pHrefIn.style.minWidth="80%";var ah=BX("bx-open-file-link-medialib-but-"+this.editor.id);if(ah){aa.rightCell.appendChild(ah)}else{var ae=BX("bx_open_file_link_medialib_button_"+this.editor.id);if(ae){aa.rightCell.appendChild(ae);BX.bind(ae,"click",window["BxOpenFileBrowserImgFile"+this.editor.id])}else{var ad=BX("bx_ml_bx_open_file_link_medialib_button_"+this.editor.id);if(ad){aa.rightCell.appendChild(ad)}}}}else{ah=BX("bx-open-file-link-medialib-but-"+this.editor.id);ae=BX("bx_open_file_link_medialib_button_"+this.editor.id);if(ah){ah.style.display="none"}if(ae){ae.style.display="none"}}this.pHrefIntCont=aa.row;aa=ab(ai,{label:BX.message("BXEdLinkHref")+":",id:this.id+"-href-ext"});this.pHrefType=aa.rightCell.appendChild(BX.create("SELECT",{props:{id:this.id+"-href-type"}}));this.pHrefType.options.add(new Option("http://","http://",false,false));this.pHrefType.options.add(new Option("https://","https://",false,false));this.pHrefType.options.add(new Option("ftp://","ftp://",false,false));this.pHrefType.options.add(new Option("","",false,false));this.pHrefExt=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-href-ext",placeholder:BX.message("BXEdLinkHrefExtPh")},style:{minWidth:"250px"}}));this.pHrefExtCont=aa.row;aa=ab(ai,{label:BX.message("BXEdLinkHrefAnch")+":",id:this.id+"-href-anch"});this.pHrefAnchor=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-href-anchor",placeholder:BX.message("BXEdLinkSelectAnchor")}}));this.pHrefAnchCont=aa.row;aa=ab(ai,{label:BX.message("BXEdLinkHrefEmail")+":",id:this.id+"-href-email"});var af=BX.browser.IsIE()||BX.browser.IsIE9()?"text":"email";this.pHrefEmail=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:af,id:this.id+"-href-email"}}));this.pHrefEmailCont=aa.row;if(!this.editor.bbCode){aa=ai.insertRow(-1);var ag=aa.insertCell(-1);BX.adjust(ag,{props:{className:"bxhtmled-title-cell bxhtmled-title-cell-foldable",colSpan:2},text:BX.message("BXEdLinkAdditionalTitle")});ag.onclick=function(){BX.toggleClass(ai,"bxhtmled-dialog-tbl-collapsed")};aa=ab(ai,false,true);this.pStatCont=aa.row;this.pStat=aa.leftCell.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:this.id+"-stat"}}));aa.rightCell.appendChild(BX.create("LABEL",{text:BX.message("BXEdLinkStat")})).setAttribute("for",this.id+"-stat");var ac,Z=aa.rightCell.appendChild(BX.create("DIV",{props:{className:"bxhtmled-stat-wrap"}}));ac=Z.appendChild(BX.create("DIV",{html:'<label for="event1">'+BX.message("BXEdLinkStatEv1")+":</label> "}));this.pStatEvent1=ac.appendChild(BX.create("INPUT",{props:{type:"text",id:"event1"},style:{minWidth:"50px"}}));ac=Z.appendChild(BX.create("DIV",{html:'<label for="event2">'+BX.message("BXEdLinkStatEv2")+":</label> "}));this.pStatEvent2=ac.appendChild(BX.create("INPUT",{props:{type:"text",id:"event2"},style:{minWidth:"50px"}}));ac=Z.appendChild(BX.create("DIV",{html:'<label for="event3">'+BX.message("BXEdLinkStatEv3")+":</label> "}));this.pStatEvent3=ac.appendChild(BX.create("INPUT",{props:{type:"text",id:"event3"},style:{minWidth:"50px"}}));BX.addClass(aa.leftCell,"bxhtmled-left-c-top");BX.bind(this.pStat,"click",BX.delegate(this.CheckShowStatParams,this));aa=ab(ai,{label:BX.message("BXEdLinkTitle")+":",id:this.id+"-title"},true);this.pTitle=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-title"}}));aa=ab(ai,{label:BX.message("BXEdCssClass")+":",id:this.id+"-style"},true);this.pClass=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-style"}}));aa=ab(ai,{label:BX.message("BXEdLinkTarget")+":",id:this.id+"-target"},true);this.pTarget=aa.rightCell.appendChild(BX.create("SELECT",{props:{id:this.id+"-target"}}));this.pTarget.options.add(new Option(BX.message("BXEdLinkTargetBlank"),"_blank",false,false));this.pTarget.options.add(new Option(BX.message("BXEdLinkTargetParent"),"_parent",false,false));this.pTarget.options.add(new Option(BX.message("BXEdLinkTargetSelf"),"_self",true,true));this.pTarget.options.add(new Option(BX.message("BXEdLinkTargetTop"),"_top",false,false));aa=ab(ai,false,true);this.pNoindex=aa.leftCell.appendChild(BX.create("INPUT",{props:{type:"checkbox",id:this.id+"-noindex"}}));aa.rightCell.appendChild(BX.create("LABEL",{text:BX.message("BXEdLinkNoindex")})).setAttribute("for",this.id+"-noindex");BX.bind(this.pNoindex,"click",BX.delegate(this.CheckNoindex,this));aa=ab(ai,{label:BX.message("BXEdLinkId")+":",id:this.id+"-id"},true);this.pId=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-id"}}));aa=ab(ai,{label:BX.message("BXEdLinkRel")+":",id:this.id+"-rel"},true);this.pRel=aa.rightCell.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-rel"}}))}aj.appendChild(ai);return aj};T.prototype.OpenFileDialog=function(){var Z=window["BxOpenFileBrowserWindFile"+this.editor.id];if(Z&&typeof Z=="function"){var aa=this;window["OnFileDialogSelect"+this.editor.id]=function(ab,ad,ac){aa.pHrefIn.value=(ad=="/"?"":ad)+"/"+ab;aa.pHrefIn.focus();aa.pHrefIn.select();window["OnFileDialogSelect"+aa.editor.id]=null};Z()}};T.prototype.ChangeType=function(){var Z=this.pType?this.pType.value:(this.editor.config.linkDialogType||"internal");this.pHrefIntCont.style.display="none";this.pHrefExtCont.style.display="none";this.pHrefAnchCont.style.display="none";this.pHrefEmailCont.style.display="none";if(this.pStatCont){this.pStatCont.style.display="none"}if(Z=="internal"){this.pHrefIntCont.style.display=""}else{if(Z=="external"){if(this.pStatCont){this.pStatCont.style.display=""}this.pHrefExtCont.style.display=""}else{if(Z=="anchor"){this.pHrefAnchCont.style.display=""}else{if(Z=="email"){this.pHrefEmailCont.style.display=""}}}}this.editor.config.linkDialogType=Z;this.editor.SaveOption("link_dialog_type",this.editor.config.linkDialogType)};T.prototype.CheckShowStatParams=function(){if(this.pStat.checked){BX.removeClass(this.pStatCont,"bxhtmled-link-stat-hide")}else{BX.addClass(this.pStatCont,"bxhtmled-link-stat-hide")}};T.prototype.CheckNoindex=function(){if(this.pNoindex.checked){this.pRel.value="nofollow";this.pRel.disabled=true}else{this.pRel.value=this.pRel.value=="nofollow"?"":this.pRel.value;this.pRel.disabled=false}};T.prototype.SetValues=function(ab){this.pHrefAnchor.value="";if(!this.editor.bbCode){this.pStatEvent1.value=this.pStatEvent2.value=this.pStatEvent3.value="";this.pStat.checked=false}if(!ab){ab={}}else{var aa=this.editor.util.spaceUrlDecode(ab.href||"");if(this.editor.bbCode){ab.type="internal";this.pHrefIn.value=aa||"";this.firstFocus=this.pHrefIn}else{if(aa!=""){if(aa.substring(0,"mailto:".length).toLowerCase()=="mailto:"){ab.type="email";this.pHrefEmail.value=aa.substring("mailto:".length)}else{if(aa.substr(0,1)=="#"){ab.type="anchor";this.pHrefAnchor.value=aa;this.firstFocus=this.pHrefAnchor}else{if(aa.indexOf("://")!==-1||aa.substr(0,"www.".length)=="www."||aa.indexOf("&goto=")!==-1){ab.type="external";if(aa.substr(0,"/bitrix/redirect.php".length)=="/bitrix/redirect.php"){this.pStat.checked=true;this.CheckShowStatParams();var Z=aa.substring("/bitrix/redirect.php".length);function ac(ah,ag){var ai=ag.indexOf(ah+"=");if(ai<0){return""}var af=ag.indexOf("&",ai+ah.length+1);if(af<0){ag=ag.substring(ai+ah.length+1)}else{ag=ag.substr(ai+ah.length+1,af-ai-1-ah.length)}return unescape(ag)}this.pStatEvent1.value=ac("event1",Z);this.pStatEvent2.value=ac("event2",Z);this.pStatEvent3.value=ac("event3",Z);aa=ac("goto",Z)}if(aa.substr(0,"www.".length)=="www."){aa="http://"+aa}var ad=aa.substr(0,aa.indexOf("://")+3);this.pHrefType.value=ad;if(this.pHrefType.value!=ad){this.pHrefType.value=""}this.pHrefExt.value=aa.substring(aa.indexOf("://")+3);this.firstFocus=this.pHrefExt}else{ab.type="internal";this.pHrefIn.value=aa||"";this.firstFocus=this.pHrefIn}}}}}if(!ab.type){if(ab.text&&ab.text.match(this.editor.autolinkEmailRegExp)){this.pHrefEmail.value=ab.text;ab.type="email";this.firstFocus=this.pHrefEmail}else{if(this.editor.config.linkDialogType&&BX.util.in_array(this.editor.config.linkDialogType,["internal","external","anchor","email"])){ab.type=this.editor.config.linkDialogType;if(ab.type=="email"){this.pHrefEmail.value="";this.firstFocus=this.pHrefEmail}else{if(ab.type=="anchor"){this.pHrefAnchor.value="";this.firstFocus=this.pHrefAnchor}else{if(ab.type=="internal"){this.pHrefIn.value="";this.firstFocus=this.pHrefIn}else{this.pHrefExt.value="";this.firstFocus=this.pHrefExt}}}}else{ab.type="internal";this.pHrefIn.value=aa||"";this.firstFocus=this.pHrefIn}}}if(this.pType){this.pType.value=ab.type}this.pInnerHtmlCont.style.display="none";this.pTextCont.style.display="none";if(ab.bTextContent){this.pText.value=ab.text||"";this.pTextCont.style.display=""}else{if(!ab.text&&ab.innerHtml){this.pInnerHtml.innerHTML=ab.innerHtml;this.pInnerHtmlCont.style.display=""}else{this.pText.value=ab.text||"";this.pTextCont.style.display=""}this._originalText=ab.text}}if(!this.editor.bbCode){this.pTitle.value=ab.title||"";this.pTarget.value=ab.target||"_self";this.pClass.value=ab.className||"";this.pId.value=ab.id||"";this.pRel.value=ab.rel||"";this.pNoindex.checked=ab.noindex}this.ChangeType();if(!this.editor.bbCode){this.CheckShowStatParams();this.CheckNoindex();if(!this.oClass){this.oClass=new window.BXHtmlEditor.ClassSelector(this.editor,{id:this.id+"-class-selector",input:this.pClass,filterTag:"A",value:this.pClass.value});var ae=this;BX.addCustomEvent(this.oClass,"OnComboPopupClose",function(){ae.closeByEnter=true});BX.addCustomEvent(this.oClass,"OnComboPopupOpen",function(){ae.closeByEnter=false})}else{this.oClass.OnChange()}}};T.prototype.GetValues=function(){var Z=this.pType?this.pType.value:"internal",aa={text:this.pText.value};if(!this.editor.bbCode){aa.className="";aa.title=this.pTitle.value;aa.id=this.pId.value;aa.rel=this.pRel.value;aa.noindex=!!this.pNoindex.checked}if(Z=="internal"){aa.href=this.pHrefIn.value}else{if(Z=="external"){aa.href=this.pHrefExt.value;if(this.pHrefType.value&&aa.href.indexOf("://")==-1){aa.href=this.pHrefType.value+aa.href}if(this.pStat&&this.pStat.checked){aa.href="/bitrix/redirect.php?event1="+escape(this.pStatEvent1.value)+"&event2="+escape(this.pStatEvent2.value)+"&event3="+escape(this.pStatEvent3.value)+"&goto="+escape(aa.href)}}else{if(Z=="anchor"){aa.href=this.pHrefAnchor.value}else{if(Z=="email"){aa.href="mailto:"+this.pHrefEmail.value}}}}if(this.pTarget&&this.pTarget.value!=="_self"){aa.target=this.pTarget.value}if(this.pClass&&this.pClass.value){aa.className=this.pClass.value}aa.node=this.lastLink||false;return aa};T.prototype.Show=function(aa,aj){var af=this,al={},ad,ac,ak,ag,ai=0;this.lastLink=false;if(!this.readyToShow){return setTimeout(function(){af.Show(aa,aj)},100)}this.savedRange=aj;if(!this.editor.bbCode||!this.editor.synchro.IsFocusedOnTextarea()){if(!aa){aa=this.editor.action.CheckState("formatInline",{},"a")}if(aa){for(ad=0;ad<aa.length;ad++){ak=aa[ad];if(ak){ag=ak;ai++}if(ai>1){break}}if(ai===1&&ag&&ag.querySelector){if(!ag.querySelector("*")){al.text=this.editor.util.GetTextContent(ag);al.bTextContent=true}else{al.text=this.editor.util.GetTextContent(ag);if(BX.util.trim(al.text)==""){al.innerHtml=ag.innerHTML}al.bTextContent=false}var ae=ag.getAttribute("data-bx-clean-attribute");if(ae){ag.removeAttribute(ae);ag.removeAttribute("data-bx-clean-attribute")}al.noindex=ag.getAttribute("data-bx-noindex")=="Y";al.href=ag.getAttribute("href");al.title=ag.title;al.id=ag.id;al.rel=ag.getAttribute("rel");al.target=ag.target;al.className=ag.className;this.lastLink=ag}}else{var am=BX.util.trim(this.editor.selection.GetText());if(am&&am!=this.editor.INVISIBLE_SPACE){al.text=am}}this.bNewLink=aa&&ai>0;var Z=[],ab;if(document.querySelectorAll){var ah=this.editor.sandbox.GetDocument().querySelectorAll(".bxhtmled-surrogate");ac=ah.length;for(ad=0;ad<ac;ad++){ab=this.editor.GetBxTag(ah[ad]);if(ab.tag=="anchor"){Z.push({NAME:"#"+ab.params.name,DESCRIPTION:BX.message("BXEdLinkHrefAnch")+": #"+ab.params.name,CLASS_NAME:"bxhtmled-inp-popup-item"})}}}if(Z.length>0){this.oHrefAnchor=new BXInputPopup({id:this.id+"-href-anchor-cntrl"+Math.round(Math.random()*1000000000),values:Z,input:this.pHrefAnchor,className:"bxhtmled-inp-popup"});BX.addCustomEvent(this.oHrefAnchor,"onInputPopupShow",function(an){if(an&&an.oPopup&&an.oPopup.popupContainer){an.oPopup.popupContainer.style.zIndex=3010;if(Z.length>20){an.oPopup.popupContainer.style.overflow="auto";an.oPopup.popupContainer.style.paddingRight="20px";an.oPopup.popupContainer.style.maxHeight="300px"}}})}}else{al.text=this.editor.textareaView.GetTextSelection()}if(!this.editor.bbCode){window["OnFileDialogImgSelect"+this.editor.id]=window["OnFileDialogSelect"+this.editor.id]=function(an,aq,ap){var ao;if(typeof an=="object"){ao=an.src;if(af.pTitle){af.pTitle.value=an.description||an.name}if(af.pAlt){af.pAlt.value=an.description||an.name}}else{ao=(aq=="/"?"":aq)+"/"+an}af.pHrefIn.value=ao;af.pHrefIn.focus();af.pHrefIn.select()}}this.SetValues(al);this.SetTitle(BX.message("InsertLink"));T.superclass.Show.apply(this,arguments)};function F(Z,aa){aa={id:"bx_video",width:600,className:"bxhtmled-video-dialog"};this.sizes=[{key:"560x315",width:560,height:315},{key:"640x360",width:640,height:360},{key:"853x480",width:853,height:480},{key:"1280x720",width:1280,height:720}];F.superclass.constructor.apply(this,[Z,aa]);this.id="video_"+this.editor.id;this.waitCounter=false;this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(F,t);F.prototype.Build=function(){this.pCont=BX.create("DIV",{props:{className:"bxhtmled-video-dialog-cnt bxhtmled-video-cnt  bxhtmled-video-empty"}});var ad=this,aa,ac,Z=BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl bxhtmled-video-dialog-tbl"}});aa=this.AddTableRow(Z,{label:BX.message("BXEdVideoSource")+":",id:this.id+"-source"});this.pSource=aa.rightCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-source",type:"text",className:"bxhtmled-90-input",placeholder:BX.message("BXEdVideoSourcePlaceholder")}}));BX.bind(this.pSource,"change",BX.delegate(this.VideoSourceChanged,this));BX.bind(this.pSource,"mouseup",BX.delegate(this.VideoSourceChanged,this));BX.bind(this.pSource,"keyup",BX.delegate(this.VideoSourceChanged,this));this.pErrorRow=Z.insertRow(-1);this.pErrorRow.style.display="none";ac=BX.adjust(this.pErrorRow.insertCell(-1),{props:{className:"bxhtmled-video-error-cell"},attrs:{colSpan:2}});this.pError=ac.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-video-error"}}));aa=Z.insertRow(-1);ac=BX.adjust(aa.insertCell(-1),{props:{className:"bxhtmled-video-params-wrap"},attrs:{colSpan:2}});var ab=ac.appendChild(BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl bxhtmled-video-dialog-tbl"}}));aa=this.AddTableRow(ab,{label:BX.message("BXEdVideoInfoTitle")+":",id:this.id+"-title"});this.pTitle=aa.rightCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-title",type:"text",className:"bxhtmled-90-input",disabled:!!this.editor.bbCode}}));BX.addClass(aa.row,"bxhtmled-video-ext-row bxhtmled-video-ext-loc-row");aa=this.AddTableRow(ab,{label:BX.message("BXEdVideoSize")+":",id:this.id+"-size"});this.pSize=aa.rightCell.appendChild(BX.create("SELECT",{props:{id:this.id+"-size"}}));BX.addClass(aa.row,"bxhtmled-video-ext-row");this.pUserSizeCnt=aa.rightCell.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-user-size"},style:{display:"none"}}));this.pUserSizeCnt.appendChild(BX.create("LABEL",{props:{className:"bxhtmled-width-lbl"},text:BX.message("BXEdImgWidth")+": ",attrs:{"for":this.id+"-width"}}));this.pWidth=this.pUserSizeCnt.appendChild(BX.create("INPUT",{props:{id:this.id+"-width",type:"text"}}));this.pUserSizeCnt.appendChild(BX.create("LABEL",{props:{className:"bxhtmled-width-lbl"},text:BX.message("BXEdImgHeight")+": ",attrs:{"for":this.id+"-height"}}));this.pHeight=this.pUserSizeCnt.appendChild(BX.create("INPUT",{props:{id:this.id+"-height",type:"text"}}));BX.bind(this.pSize,"change",function(){ad.pUserSizeCnt.style.display=ad.pSize.value==""?"":"none"});this.pPreviewCont=ab.insertRow(-1);ac=BX.adjust(this.pPreviewCont.insertCell(-1),{props:{title:BX.message("BXEdVideoPreview")},attrs:{colSpan:2}});this.pPreview=ac.appendChild(BX.create("DIV",{props:{className:"bxhtmled-video-preview-cnt"}}));BX.addClass(this.pPreviewCont,"bxhtmled-video-ext-row bxhtmled-video-ext-loc-row");this.pCont.appendChild(Z);return this.pCont};F.prototype.VideoSourceChanged=function(){var Z=BX.util.trim(this.pSource.value);if(Z!==this.lastSourceValue){this.lastSourceValue=Z;if(this.editor.bbCode&&this.bEdit&&Z.toLowerCase().indexOf("[/video]")!==-1){return}this.AnalyzeVideoSource(Z)}};F.prototype.AnalyzeVideoSource=function(ab){var ac=this;if(ab.match(/<iframe([\s\S]*?)\/iframe>/gi)){var Z=this.editor.phpParser.CheckForVideo(ab);if(Z){var aa=this.editor.phpParser.FetchVideoIframeParams(ab,Z.provider)||{};this.ShowVideoParams({html:ab,provider:Z.provider||false,title:aa.origTitle||"",width:aa.width||false,height:aa.height||false})}}else{this.StartWaiting();this.editor.Request({getData:this.editor.GetReqData("video_oembed",{video_source:ab}),handler:function(ad){if(ad.result){ac.StopWaiting();ac.ShowVideoParams(ad.data)}else{ac.StopWaiting();if(ad.error!==""){ac.ShowVideoParams(false,ad.error)}}}})}};F.prototype.StartWaiting=function(){var Z="",aa=this;this.waitCounter=(this.waitCounter===false||this.waitCounter>3)?0:this.waitCounter;if(aa.waitCounter==1){Z="."}else{if(aa.waitCounter==2){Z=".."}else{if(aa.waitCounter==3){Z="..."}}}aa.SetTitle(BX.message("BXEdVideoTitle")+Z);this.StopWaiting(false);this.waitingTimeout=setTimeout(function(){aa.waitCounter++;aa.StartWaiting()},250)};F.prototype.StopWaiting=function(Z){if(this.waitingTimeout){clearTimeout(this.waitingTimeout);this.waitingTimeout=null}if(Z!==false){this.waitCounter=false;this.SetTitle(Z||BX.message("BXEdVideoTitle"))}};F.prototype.ShowVideoParams=function(ad,ab){this.data=ad||{};this.pErrorRow.style.display="none";this.pPreviewCont.style.display="none";this.pPreview.innerHTML="";BX.removeClass(this.pCont,"bxhtmled-video-local");if(ad===false||typeof ad!="object"){BX.addClass(this.pCont,"bxhtmled-video-empty");if(ab){this.pErrorRow.style.display="";this.pError.innerHTML=BX.util.htmlspecialchars(ab)}}else{if(ad.remote&&!this.bEdit){BX.removeClass(this.pCont,"bxhtmled-video-empty");this.pTitle.value=ad.title||"";if(ad.width&&ad.height){this.SetSize(ad.width,ad.height)}else{this.SetSize(400,300)}}else{if(ad.local&&!this.bEdit){this.SetSize(400,300);BX.removeClass(this.pCont,"bxhtmled-video-empty");BX.addClass(this.pCont,"bxhtmled-video-local")}else{BX.removeClass(this.pCont,"bxhtmled-video-empty");if(ad.provider){this.SetTitle(BX.message("BXEdVideoTitleProvider").replace("#PROVIDER_NAME#",BX.util.htmlspecialchars(ad.provider)))}this.pTitle.value=ad.title||"";this.SetSize(ad.width,ad.height);if(ad.html){var aa=Math.min(ad.width,560),ac=Math.min(ad.height,315),Z=ad.html;Z=this.UpdateHtml(Z,aa,ac);this.pPreview.innerHTML=Z;this.pPreviewCont.style.display=""}else{this.pPreviewCont.style.display="none"}}}}};F.prototype.SetSize=function(ab,Z){var aa=ab+"x"+Z;if(!this.sizeIndex[aa]){this.ClearSizeControl([{key:aa,width:ab,height:Z,title:BX.message("BXEdVideoSizeAuto")+" ("+ab+" x "+Z+")"}].concat(this.sizes))}this.pSize.value=aa};F.prototype.ClearSizeControl=function(aa){aa=aa||this.sizes;this.pSize.options.length=0;this.sizeIndex={};for(var Z=0;Z<aa.length;Z++){this.sizeIndex[aa[Z].key]=true;this.pSize.options.add(new Option(aa[Z].title||(aa[Z].width+" x "+aa[Z].height),aa[Z].key,false,false))}this.pSize.options.add(new Option(BX.message("BXEdVideoSizeCustom"),"",false,false))};F.prototype.UpdateHtml=function(aa,ab,Z,ad){var ac=false;if(ad){ad=BX.util.htmlspecialchars(ad)}aa=aa.replace(/((?:title)|(?:width)|(?:height))\s*=\s*("|')([\s\S]*?)(\2)/ig,function(af,ae,ag,ah){ae=ae.toLowerCase();if(ae=="width"&&ab){return ae+'="'+ab+'"'}else{if(ae=="height"&&Z){return ae+'="'+Z+'"'}else{if(ae=="title"&&ad){ac=true;return ae+'="'+ad+'"'}}}return""});if(!ac&&ad){aa=aa.replace(/<iframe\s*/i,function(ae){return ae+' title="'+ad+'" '})}return aa};F.prototype.Show=function(aa,Z){this.savedRange=Z;if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}this.SetTitle(BX.message("BXEdVideoTitle"));this.ClearSizeControl();this.bEdit=aa&&aa.tag=="video";this.bxTag=aa;if(this.bEdit){this.pSource.value=this.lastSourceValue=aa.params.value;if(!this.editor.bbCode){this.AnalyzeVideoSource(aa.params.value)}}else{this.ShowVideoParams(false);this.pSource.value=""}F.superclass.Show.apply(this,arguments)};F.prototype.Save=function(){var ae=this,ag=this.pTitle.value,ab=parseInt(this.pWidth.value)||100,ai=parseInt(this.pHeight.value)||100,aa=this.data.mimeType||"";if(this.pSize.value!==""){var af=this.pSize.value.split("x");if(af&&af.length==2){ab=parseInt(af[0]);ai=parseInt(af[1])}}if(this.data&&this.data.html){this.data.html=this.UpdateHtml(this.data.html,ab,ai,ag)}var ah="",ad="";if(this.bEdit){if(this.bxTag&&this.editor.bbCode&&!this.data){this.bxTag.params.value=this.pSource.value}else{if(this.data&&this.editor.action.IsSupported("insertHTML")){var ac=this.editor.GetIframeElement(this.bxTag.id);if(ac){this.editor.selection.SelectNode(ac);BX.remove(ac)}ad=this.data.html}}}else{if(this.data){if(this.editor.bbCode&&this.data.local){ah=this.data.html="[VIDEO width="+ab+" height="+ai+"]"+this.data.path+"[/VIDEO]";ad=this.editor.bbParser.GetVideoSourse(this.data.path,{type:false,width:ab,height:ai,html:this.data.html},this.data.html)}else{if(this.editor.bbCode&&this.data.remote){ah="[VIDEO ";if(aa){ah+="mimetype='"+aa+"' "}ah+="width="+ab+" height="+ai+"]"+this.data.path+"[/VIDEO]";this.data.html=ah;ad=this.editor.bbParser.GetVideoSourse(this.data.path,{type:false,width:ab,height:ai,html:this.data.html,title:this.data.title},this.data.html)}else{if(this.data.html){if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}if(ae.editor.synchro.IsFocusedOnTextarea()){var Z=this.editor.phpParser.FetchVideoIframeParams(this.data.html);ah="[VIDEO TYPE="+this.data.provider.toUpperCase()+" WIDTH="+this.data.width+" HEIGHT="+this.data.height+"]"+Z.src+"[/VIDEO]"}ad=this.data.html}}}}}if(ae.editor.synchro.IsFocusedOnTextarea()){if(ah!==""){this.editor.textareaView.WrapWith(false,false,ah)}ae.editor.synchro.Sync()}else{if(ad!==""&&this.editor.action.IsSupported("insertHTML")){this.editor.action.Exec("insertHTML",ad)}setTimeout(function(){ae.editor.synchro.FullSyncFromIframe()},50)}};function A(Z,aa){aa={id:"bx_source",height:400,width:700,resizable:true,className:"bxhtmled-source-dialog"};A.superclass.constructor.apply(this,[Z,aa]);this.id="source_"+this.editor.id;this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(A,t);A.prototype.Build=function(){this.pValue=BX.create("TEXTAREA",{props:{className:"bxhtmled-source-value",id:this.id+"-value"}});return this.pValue};A.prototype.OnResize=function(){var Z=this.oDialog.PARTS.CONTENT_DATA.offsetWidth,aa=this.oDialog.PARTS.CONTENT_DATA.offsetHeight;this.pValue.style.width=(Z-30)+"px";this.pValue.style.height=(aa-30)+"px"};A.prototype.OnResizeFinished=function(){};A.prototype.Save=function(){this.bxTag.params.value=this.pValue.value;this.editor.SetBxTag(false,this.bxTag);var Z=this;setTimeout(function(){Z.editor.synchro.FullSyncFromIframe()},50)};A.prototype.Show=function(Z){this.bxTag=Z;if(Z&&Z.tag){this.SetTitle(Z.name);this.pValue.value=Z.params.value;A.superclass.Show.apply(this,arguments);this.OnResize();BX.focus(this.pValue)}};function o(Z,aa){aa={id:"bx_anchor",width:300,resizable:false,className:"bxhtmled-anchor-dialog"};o.superclass.constructor.apply(this,[Z,aa]);this.id="anchor_"+this.editor.id;this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(o,t);o.prototype.Build=function(){var Z=BX.create("DIV");Z.appendChild(BX.create("LABEL",{text:BX.message("BXEdAnchorName")+": "})).setAttribute("for",this.id+"-value");this.pValue=Z.appendChild(BX.create("INPUT",{props:{className:"",id:this.id+"-value"}}));return Z};o.prototype.Save=function(){this.bxTag.params.name=BX.util.trim(this.pValue.value.replace(/[^ a-z0-9_\-]/gi,""));this.editor.SetBxTag(false,this.bxTag);var Z=this;setTimeout(function(){Z.editor.synchro.FullSyncFromIframe()},50)};o.prototype.Show=function(Z){this.bxTag=Z;if(Z&&Z.tag){this.SetTitle(BX.message("BXEdAnchor"));this.pValue.value=Z.params.name;o.superclass.Show.apply(this,arguments);BX.focus(this.pValue);this.pValue.select()}};function M(Z,aa){aa={id:"bx_table",width:Z.bbCode?300:600,resizable:false,className:"bxhtmled-table-dialog"};T.superclass.constructor.apply(this,[Z,aa]);this.id="table"+this.editor.id;this.action="insertTable";this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(M,t);M.prototype.Build=function(){var ad,ac,af,Z=BX.create("DIV");var ab=BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl bxhtmled-dialog-tbl-hide-additional"}});ac=ab.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{attrs:{colSpan:4}});ad=af.appendChild(BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl"}}));ac=ad.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableRows")+":",attrs:{"for":this.id+"-rows"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pRows=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-rows"}}));if(!this.editor.bbCode){af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableWidth")+":",attrs:{"for":this.id+"-width"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pWidth=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-width"}}))}ac=ad.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableCols")+":",attrs:{"for":this.id+"-cols"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pCols=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-cols"}}));if(!this.editor.bbCode){af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableHeight")+":",attrs:{"for":this.id+"-height"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pHeight=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-height"}}))}if(!this.editor.bbCode){ac=ab.insertRow(-1);var aa=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-title-cell bxhtmled-title-cell-foldable",colSpan:4},text:BX.message("BXEdLinkAdditionalTitle")});BX.bind(aa,"click",function(){BX.toggleClass(ab,"bxhtmled-dialog-tbl-hide-additional")});var ae=ab.appendChild(BX.create("TBODY",{props:{className:"bxhtmled-additional-tbody"}}));ac=ae.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableHeads")+":",attrs:{"for":this.id+"-th"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pHeaders=af.appendChild(BX.create("SELECT",{props:{id:this.id+"-th"},style:{width:"130px"}}));this.pHeaders.options.add(new Option(BX.message("BXEdThNone"),"",true,true));this.pHeaders.options.add(new Option(BX.message("BXEdThTop"),"top",false,false));this.pHeaders.options.add(new Option(BX.message("BXEdThLeft"),"left",false,false));this.pHeaders.options.add(BX.adjust(new Option(BX.message("BXEdThTopLeft"),"topleft",false,false),{props:{title:BX.message("BXEdThTopLeftTitle")}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableCellSpacing")+":",attrs:{"for":this.id+"-cell-spacing"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pCellSpacing=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-cell-spacing"}}));ac=ae.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableBorder")+":",attrs:{"for":this.id+"-border"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pBorder=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-border"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableCellPadding")+":",attrs:{"for":this.id+"-cell-padding"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-val-cell"}});this.pCellPadding=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-cell-padding"}}));ac=ae.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{attrs:{colSpan:4}});ad=af.appendChild(BX.create("TABLE",{props:{className:"bxhtmled-dialog-inner-tbl"}}));ac=ad.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableAlign")+":",attrs:{"for":this.id+"-align"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-val-cell"}});this.pAlign=af.appendChild(BX.create("SELECT",{props:{id:this.id+"-align"},style:{width:"130px"}}));this.pAlign.options.add(new Option(BX.message("BXEdTableAlignLeft"),"left",true,true));this.pAlign.options.add(new Option(BX.message("BXEdTableAlignCenter"),"center",false,false));this.pAlign.options.add(new Option(BX.message("BXEdTableAlignRight"),"right",false,false));ac=ad.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableCaption")+":",attrs:{"for":this.id+"-caption"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-val-cell"}});this.pCaption=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-caption"}}));ac=ad.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdCssClass")+":",attrs:{"for":this.id+"-class"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-val-cell"}});this.pClass=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-class"}}));ac=ad.insertRow(-1);af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-lbl-cell"}});af.appendChild(BX.create("LABEL",{text:BX.message("BXEdTableId")+":",attrs:{"for":this.id+"-id"}}));af=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-inner-val-cell"}});this.pId=af.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-id"}}))}Z.appendChild(ab);return Z};M.prototype.SetValues=function(Z){this.pRows.value=Z.rows||3;this.pCols.value=Z.cols||4;if(!this.editor.bbCode){this.pWidth.value=Z.width||"";this.pHeight.value=Z.height||"";this.pId.value=Z.id||"";this.pCaption.value=Z.caption||"";this.pCellPadding.value=Z.cellPadding||"";this.pCellSpacing.value=Z.cellSpacing||"";this.pBorder.value=Z.border||"";this.pClass.value=Z.className||"";this.pHeaders.value=Z.headers||"";this.pRows.disabled=this.pCols.disabled=!!this.currentTable;this.pAlign.value=Z.align||"left";if(!this.oClass){this.oClass=new window.BXHtmlEditor.ClassSelector(this.editor,{id:this.id+"-class-selector",input:this.pClass,filterTag:"TABLE",value:this.pClass.value});var aa=this;BX.addCustomEvent(this.oClass,"OnComboPopupClose",function(){aa.closeByEnter=true});BX.addCustomEvent(this.oClass,"OnComboPopupOpen",function(){aa.closeByEnter=false})}else{this.oClass.OnChange()}}};M.prototype.GetValues=function(){var Z={table:this.currentTable||false,rows:parseInt(this.pRows.value)||1,cols:parseInt(this.pCols.value)||1};if(!this.editor.bbCode){Z.width=BX.util.trim(this.pWidth.value);Z.height=BX.util.trim(this.pHeight.value);Z.id=BX.util.trim(this.pId.value);Z.caption=BX.util.trim(this.pCaption.value);Z.cellPadding=isNaN(parseInt(this.pCellPadding.value))?"":parseInt(this.pCellPadding.value);Z.cellSpacing=isNaN(parseInt(this.pCellSpacing.value))?"":parseInt(this.pCellSpacing.value);Z.border=isNaN(parseInt(this.pBorder.value))?"":parseInt(this.pBorder.value);Z.headers=this.pHeaders.value;Z.className=this.pClass.value;Z.align=this.pAlign.value}return Z};M.prototype.Show=function(ab,ag){var ai,ah={};this.savedRange=ag;if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}if(!ab){ab=this.editor.action.CheckState("insertTable")}if(ab&&ab.nodeName){ai=ab}else{if((ab&&ab[0]&&ab[0].nodeName)){ai=ab[0]}}this.currentTable=false;if(ai){this.currentTable=ai;ah.rows=ai.rows.length;ah.cols=ai.rows[0].cells.length;if(ai.style.width){ah.width=ai.style.width}if(!ah.width&&ai.width){ah.width=ai.width}if(ai.style.height){ah.height=ai.style.height}if(!ah.height&&ai.height){ah.height=ai.height}ah.cellPadding=ai.getAttribute("cellPadding")||"";ah.cellSpacing=ai.getAttribute("cellSpacing")||"";ah.border=ai.getAttribute("border")||0;ah.id=ai.getAttribute("id")||"";var ad=BX.findChild(ai,{tag:"CAPTION"},false);ah.caption=ad?BX.util.htmlspecialcharsback(ad.innerHTML):"";ah.className=ai.className||"";var Z,af,ae,ac=true,aa=true;for(Z=0;Z<ai.rows.length;Z++){for(af=0;af<ai.rows[Z].cells.length;af++){ae=ai.rows[Z].cells[af];if(Z==0){ac=ae.nodeName=="TH"&&ac}if(af==0){aa=ae.nodeName=="TH"&&aa}}}if(!ac&&!aa){ah.headers=""}else{if(ac&&aa){ah.headers="topleft"}else{if(ac){ah.headers="top"}else{ah.headers="left"}}}ah.align=ai.getAttribute("align")}this.SetValues(ah);this.SetTitle(BX.message("BXEdTable"));M.superclass.Show.apply(this,arguments)};function W(Z,aa){aa={id:"bx_settings",width:600,resizable:false};this.id="settings";Q.superclass.constructor.apply(this,[Z,aa]);this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(W,t);W.prototype.Build=function(){this.pCont=BX.create("DIV",{props:{className:"bxhtmled-settings-dialog-cnt"}});var aa,ab,Z=BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl"}});aa=this.AddTableRow(Z);this.pCleanSpans=aa.leftCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-clean-spans",type:"checkbox"}}));aa.rightCell.appendChild(BX.create("LABEL",{html:BX.message("BXEdSettingsCleanSpans")})).setAttribute("for",this.id+"-clean-spans");aa=Z.insertRow(-1);ab=aa.insertCell(-1);BX.adjust(ab,{props:{className:"bxhtmled-title-cell",colSpan:2},text:BX.message("BXEdPasteSettings")});aa=this.AddTableRow(Z);this.pPasteSetColors=aa.leftCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-ps-colors",type:"checkbox"}}));aa.rightCell.appendChild(BX.create("LABEL",{html:BX.message("BXEdPasteSetColors")})).setAttribute("for",this.id+"-ps-colors");aa=this.AddTableRow(Z);this.pPasteSetBgBorders=aa.leftCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-ps-border",type:"checkbox"}}));aa.rightCell.appendChild(BX.create("LABEL",{html:BX.message("BXEdPasteSetBgBorders")})).setAttribute("for",this.id+"-ps-border");aa=this.AddTableRow(Z);this.pPasteSetDecor=aa.leftCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-ps-decor",type:"checkbox"}}));aa.rightCell.appendChild(BX.create("LABEL",{html:BX.message("BXEdPasteSetDecor")})).setAttribute("for",this.id+"-ps-decor");aa=this.AddTableRow(Z);this.pPasteTblDimen=aa.leftCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-ps-tbl-dim",type:"checkbox"}}));aa.rightCell.appendChild(BX.create("LABEL",{html:BX.message("BXEdPasteSetTableDimen")})).setAttribute("for",this.id+"-ps-tbl-dim");aa=Z.insertRow(-1);ab=aa.insertCell(-1);BX.adjust(ab,{props:{className:"bxhtmled-title-cell",colSpan:2},text:BX.message("BXEdViewSettings")});aa=this.AddTableRow(Z);this.pShowSnippets=aa.leftCell.appendChild(BX.create("INPUT",{props:{id:this.id+"-show-snippets",type:"checkbox"}}));aa.rightCell.appendChild(BX.create("LABEL",{html:BX.message("BXEdShowSnippets")+"*"})).setAttribute("for",this.id+"-show-snippets");aa=Z.insertRow(-1);ab=aa.insertCell(-1);BX.adjust(ab,{props:{className:"bxhtmled-notice-cell",colSpan:2},text:"* "+BX.message("BXEdRefreshNotice")});this.pCont.appendChild(Z);return this.pCont};W.prototype.Show=function(){var Z={};this.SetValues(Z);this.SetTitle(BX.message("BXEdSettings"));this.pCleanSpans.checked=this.editor.config.cleanEmptySpans;this.pPasteSetColors.checked=this.editor.config.pasteSetColors;this.pPasteSetBgBorders.checked=this.editor.config.pasteSetBorders;this.pPasteSetDecor.checked=this.editor.config.pasteSetDecor;this.pPasteTblDimen.checked=this.editor.config.pasteClearTableDimen;this.pShowSnippets.checked=this.editor.config.showSnippets;W.superclass.Show.apply(this,arguments)};W.prototype.Save=function(){this.editor.config.cleanEmptySpans=this.pCleanSpans.checked;this.editor.config.pasteSetColors=this.pPasteSetColors.checked;this.editor.config.pasteSetBorders=this.pPasteSetBgBorders.checked;this.editor.config.pasteSetDecor=this.pPasteSetDecor.checked;this.editor.config.pasteClearTableDimen=this.pPasteTblDimen.checked;this.editor.config.showSnippets=this.pShowSnippets.checked;this.editor.SaveOption("clean_empty_spans",this.editor.config.cleanEmptySpans?"Y":"N");this.editor.SaveOption("paste_clear_colors",this.editor.config.pasteSetColors?"Y":"N");this.editor.SaveOption("paste_clear_borders",this.editor.config.pasteSetBorders?"Y":"N");this.editor.SaveOption("paste_clear_decor",this.editor.config.pasteSetDecor?"Y":"N");this.editor.SaveOption("paste_clear_table_dimen",this.editor.config.pasteClearTableDimen?"Y":"N");this.editor.SaveOption("show_snippets",this.editor.config.showSnippets?"Y":"N")};function Q(Z,aa){aa={id:"bx_default",width:500,resizable:false,className:"bxhtmled-default-dialog"};this.id="default";this.action="universalFormatStyle";Q.superclass.constructor.apply(this,[Z,aa]);this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(Q,t);Q.prototype.Show=function(ab,aa){var ad=[],ac,af,ag=typeof ab!=="object"||ab.length==0,ae;this.savedRange=aa;if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}if(ag){ab=this.editor.action.CheckState(this.action)}if(!ab){ab=[]}var Z=ab.length==1&&ab[0].nodeName=="BODY";if(ab.length==1&&BX.util.in_array(ab[0].nodeName,["TD","TH","TR","TABLE"])){this.colorRow.style.display=""}else{this.colorRow.style.display="none"}if(!Z){for(ac=0;ac<ab.length;ac++){if(af===undefined&&ae===undefined){af=ab[ac].style.cssText;ae=ab[ac].className}else{af=ab[ac].style.cssText===af?af:false;ae=ab[ac].className===ae?ae:false}ad.push(ab[ac].nodeName)}}this.SetValues({nodes:ab,renewNodes:ag,style:af,className:ae});if(Z){this.SetTitle(BX.message("BXEdDefaultPropDialog").replace("#NODES_LIST#",BX.message("BXEdDefaultPropDialogTextNode")))}else{this.SetTitle(BX.message("BXEdDefaultPropDialog").replace("#NODES_LIST#",ad.join(", ")))}Q.superclass.Show.apply(this,arguments)};Q.prototype.Build=function(){var ac,ae,ad=this,Z=BX.create("DIV");var ab=BX.create("TABLE",{props:{className:"bxhtmled-dialog-tbl"}});ac=ab.insertRow(-1);ae=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-left-c"}});ae.appendChild(BX.create("LABEL",{text:BX.message("BXEdCssClass")+":",attrs:{"for":this.id+"-css-class"}}));ae=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-right-c"}});this.pCssClass=ae.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-css-class"}}));ac=ab.insertRow(-1);ae=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-left-c"}});ae.appendChild(BX.create("LABEL",{text:BX.message("BXEdCSSStyle")+":",attrs:{"for":this.id+"-css-style"}}));ae=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-right-c"}});this.pCssStyle=ae.appendChild(BX.create("INPUT",{props:{type:"text",id:this.id+"-css-style"}}));ac=ab.insertRow(-1);ae=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-left-c"}});ae.appendChild(BX.create("LABEL",{text:BX.message("BXEdColorpickerDialog")+":",attrs:{"for":this.id+"-css-class"}}));ae=BX.adjust(ac.insertCell(-1),{props:{className:"bxhtmled-right-c"}});this.textColor=ae.appendChild(BX.create("INPUT",{props:{type:"hidden",id:this.id+"-s"}}));this.bgColor=ae.appendChild(BX.create("INPUT",{props:{type:"hidden",id:this.id+"-s"}}));var aa=new window.BXHtmlEditor.Controls.Color(this.editor,ae,{registerActions:false,checkAction:false,BgColorMess:BX.message("BXEdBgColor"),callback:function(ah,ag){var ai,af=" "+ad.pCssStyle.value;if(ah=="foreColor"){ai=af.replace(/\s+color\s*:\s*([\s\S]*?);/ig,(ag?" color: "+ag+";":""));if(ai.toLowerCase()!=af.toLowerCase()){af=ai}else{if(ag){af+=" color: "+ag+";"}}}else{if(ah=="backgroundColor"){ai=af.replace(/background-color\s*:\s*([\s\S]*?);/ig,"background-color: "+ag+";");if(ai.toLowerCase()!=af.toLowerCase()){af=ai}else{if(ag){af+=" background-color: "+ag+";"}}}}ad.pCssStyle.value=BX.util.trim(af)}});this.colorRow=ac;Z.appendChild(ab);return Z};Q.prototype.SetValues=function(Z){if(!Z){Z={}}this.nodes=Z.nodes||[];this.renewNodes=Z.renewNodes;this.pCssStyle.value=this.editor.util.RgbToHex(Z.style||"");this.pCssClass.value=Z.className||"";if(!this.oClass){this.oClass=new window.BXHtmlEditor.ClassSelector(this.editor,{id:this.id+"-class-selector",input:this.pCssClass,filterTag:"A",value:this.pCssClass.value});var aa=this;BX.addCustomEvent(this.oClass,"OnComboPopupClose",function(){aa.closeByEnter=true});BX.addCustomEvent(this.oClass,"OnComboPopupOpen",function(){aa.closeByEnter=false})}else{this.oClass.OnChange()}};Q.prototype.GetValues=function(){return{className:this.pCssClass.value,style:this.pCssStyle.value,nodes:this.renewNodes?[]:this.nodes}};function i(Z,aa){this.editor=Z;aa={id:"bx_char",width:570,resizable:false,className:"bxhtmled-char-dialog"};this.id="char"+this.editor.id;i.superclass.constructor.apply(this,[Z,aa]);this.oDialog.ClearButtons();this.oDialog.SetButtons([this.oDialog.btnCancel]);this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(i,t);i.prototype.Build=function(){var ac=this,Z,ae,ab,ag=18,ad,aa=this.editor.HTML_ENTITIES.length,ah=BX.create("DIV");var af=BX.create("TABLE",{props:{className:"bxhtmled-specialchar-tbl"}});for(ab=0;ab<aa;ab++){if(ab%ag==0){Z=af.insertRow(-1)}ad=this.editor.HTML_ENTITIES[ab];ae=Z.insertCell(-1);ae.innerHTML=ad;ae.setAttribute("data-bx-specialchar",ad);ae.title=BX.message("BXEdSpecialchar")+": "+ad.substr(1,ad.length-2)}BX.bind(af,"click",function(ak){var ai,aj=ak.target||ak.srcElement;if(aj.nodeType==3){aj=aj.parentNode}if(aj&&aj.getAttribute&&aj.getAttribute("data-bx-specialchar")&&ac.editor.action.IsSupported("insertHTML")){if(ac.savedRange){ac.editor.selection.SetBookmark(ac.savedRange)}ai=aj.getAttribute("data-bx-specialchar");ac.editor.On("OnSpecialcharInserted",[ai]);ac.editor.action.Exec("insertHTML",ai)}ac.oDialog.Close()});ah.appendChild(af);return ah};i.prototype.SetValues=BX.DoNothing;i.prototype.GetValues=BX.DoNothing;i.prototype.Show=function(Z){this.savedRange=Z;if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}this.SetTitle(BX.message("BXEdSpecialchar"));i.superclass.Show.apply(this,arguments)};function s(Z,aa){this.editor=Z;aa={id:"bx_list",width:360,resizable:false,className:"bxhtmled-list-dialog"};this.id="list"+this.editor.id;s.superclass.constructor.apply(this,[Z,aa]);this.SetContent(this.Build());BX.addCustomEvent(this,"OnDialogSave",BX.proxy(this.Save,this))}BX.extend(s,t);s.prototype.Build=function(){var ag=this,ad,af,ac,ab=18,ae,aa=this.editor.HTML_ENTITIES.length,Z=BX.create("DIV");this.itemsWrap=Z.appendChild(BX.create("DIV",{props:{className:"bxhtmled-list-wrap"}}));this.addItem=Z.appendChild(BX.create("span",{props:{className:"bxhtmled-list-add-item"},text:BX.message("BXEdAddListItem")}));BX.bind(this.addItem,"click",BX.proxy(this.AddItem,this));return Z};s.prototype.BuildList=function(Z){if(this.pList){BX.remove(this.pList)}this.pList=this.itemsWrap.appendChild(BX.create(Z,{props:{className:"bxhtmled-list"}}));this.AddItem({focus:true});this.AddItem({focus:false});this.AddItem({focus:false})};s.prototype.AddItem=function(ac){if(typeof ac!=="object"){ac={}}var aa=BX.create("LI"),ab=aa.appendChild(BX.create("INPUT",{props:{type:"text",value:"",size:35}}));this.pList.appendChild(aa);var Z=aa.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-list-del-item",title:BX.message("DelListItem")}}));if(ac.focus!==false){setTimeout(function(){BX.focus(ab)},100)}BX.bind(ab,"keyup",BX.proxy(this.CheckList,this));BX.bind(ab,"mouseup",BX.proxy(this.CheckList,this));BX.bind(ab,"focus",BX.proxy(this.CheckList,this));BX.bind(Z,"click",BX.proxy(this.RemoveItem,this))};s.prototype.RemoveItem=function(ab){var aa=ab.target||ab.srcElement,Z=BX.findParent(aa,{tag:"LI"});if(Z){BX.remove(Z)}};s.prototype.CheckList=function(){var Z=this.pList.getElementsByTagName("LI");if(Z.length<3){this.AddItem({focus:false});this.CheckList({focus:false})}else{if(Z[Z.length-1].firstChild&&Z[Z.length-1].firstChild.value!==""){this.AddItem({focus:false})}}};s.prototype.InputKeyNavigation=function(ab){var aa=ab.target||ab.srcElement,Z=ab.keyCode};s.prototype.SetValues=BX.DoNothing;s.prototype.GetValues=BX.DoNothing;s.prototype.Show=function(Z){this.type=Z.type;this.SetTitle(Z.type=="ul"?BX.message("UnorderedList"):BX.message("OrderedList"));this.BuildList(Z.type);s.superclass.Show.apply(this,arguments)};s.prototype.Save=function(){var ab,aa=[],Z=this.pList.getElementsByTagName("INPUT");for(ab=0;ab<Z.length;ab++){if(Z[ab].value!==""){aa.push(Z[ab].value)}}this.editor.action.Exec(this.type=="ul"?"insertUnorderedList":"insertOrderedList",{items:aa})};window.BXHtmlEditor.Controls={SearchButton:v,ChangeView:H,Undo:C,Redo:b,StyleSelector:l,FontSelector:w,FontSize:y,Bold:J,Italic:B,Underline:x,Strikeout:h,Color:Y,RemoveFormat:d,TemplateSelector:m,OrderedList:r,UnorderedList:S,IndentButton:X,OutdentButton:L,AlignList:R,InsertLink:z,InsertImage:O,InsertVideo:P,InsertAnchor:k,InsertTable:U,InsertChar:e,Settings:u,Fullscreen:n,PrintBreak:c,PageBreak:I,InsertHr:p,Spellcheck:G,Code:g,Quote:f,Smile:j,Sub:K,Sup:N,More:q,BbCode:D};window.BXHtmlEditor.dialogs.Image=E;window.BXHtmlEditor.dialogs.Link=T;window.BXHtmlEditor.dialogs.Video=F;window.BXHtmlEditor.dialogs.Source=A;window.BXHtmlEditor.dialogs.Anchor=o;window.BXHtmlEditor.dialogs.Table=M;window.BXHtmlEditor.dialogs.Settings=W;window.BXHtmlEditor.dialogs.Default=Q;window.BXHtmlEditor.dialogs.Specialchar=i;window.BXHtmlEditor.dialogs.InsertList=s}if(window.BXHtmlEditor&&window.BXHtmlEditor.Button&&window.BXHtmlEditor.Dialog){a()}else{BX.addCustomEvent(window,"OnEditorBaseControlsDefined",a)}})();