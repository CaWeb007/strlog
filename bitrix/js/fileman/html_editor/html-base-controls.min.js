(function(){function a(p,q){this.editor=p;this.bShown=false;this.closedWidth=20;this.MIN_CLOSED_WIDTH=120;this.width=this.editor.config.taskbarWidth||250;this.taskbars={};this.freezeOnclickHandler=false;if(q){this.Init()}}a.prototype={Init:function(){this.pCont=this.editor.dom.taskbarCont;this.pCont.setAttribute("data-bx-type","taskbarmanager");this.pResizer=BX("bx-html-editor-tskbr-res-"+this.editor.id);this.pResizer.setAttribute("data-bx-type","taskbarflip");this.pTopCont=BX("bx-html-editor-tskbr-top-"+this.editor.id);BX.bind(this.pResizer,"mousedown",BX.proxy(this.StartResize,this));BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this));this.pSearchCont=BX("bxhed-tskbr-search-cnt-"+this.editor.id);this.pSearchAli=BX("bxhed-tskbr-search-ali-"+this.editor.id);this.pSearchInput=BX("bxhed-tskbr-search-inp-"+this.editor.id);this.pSearchNothingNotice=BX("bxhed-tskbr-search-nothing-"+this.editor.id);BX.bind(this.pSearchInput,"keyup",BX.proxy(this.TaskbarSearch,this))},OnClick:function(r){if(!r){r=window.event}if(this.freezeOnclickHandler){return}var s=this,q=r.target||r.srcElement,p=(q&&q.getAttribute)?q.getAttribute("data-bx-type"):null;if(!p){q=BX.findParent(q,function(t){return t==s.pCont||(t.getAttribute&&t.getAttribute("data-bx-type"))},this.pCont);p=(q&&q.getAttribute)?q.getAttribute("data-bx-type"):null}if(p=="taskbarflip"||(!this.bShown&&(p=="taskbarmanager"||!p))){if(this.bShown){this.Hide()}else{this.Show()}}else{if(p=="taskbargroup_title"){BX.onCustomEvent(this,"taskbargroupTitleClick",[q])}else{if(p=="taskbarelement"){BX.onCustomEvent(this,"taskbarelementClick",[q])}else{if(p=="taskbar_title_but"){BX.onCustomEvent(this,"taskbarTitleClick",[q])}else{if(p=="taskbar_top_menu"){BX.onCustomEvent(this,"taskbarMenuClick",[q])}else{if(p=="taskbar_search_cancel"){this.pSearchInput.value="";this.TaskbarSearch()}}}}}}},Show:function(p){if(!this.bShown){this.bShown=true;this.pCont.className="bxhtmled-taskbar-cnt bxhtmled-taskbar-shown"}this.pCont.style.width=this.GetWidth(true)+"px";this.editor.ResizeSceleton();if(p!==false){this.editor.SaveOption("taskbar_shown",1)}},Hide:function(p){if(this.bShown){this.bShown=false;this.pCont.className="bxhtmled-taskbar-cnt bxhtmled-taskbar-hidden"}this.pCont.style.width=this.GetWidth()+"px";this.editor.ResizeSceleton();if(p!==false){this.editor.SaveOption("taskbar_shown",0)}},GetWidth:function(r,q){var p;if(this.bShown){p=r?Math.max(this.width,this.closedWidth+this.MIN_CLOSED_WIDTH):this.width;if(q&&p>q){p=this.width=Math.round(q)}}else{p=this.closedWidth}return p},AddTaskbar:function(p){this.taskbars[p.id]=p;this.pCont.appendChild(p.GetCont());this.pTopCont.appendChild(p.GetTitleCont())},ShowTaskbar:function(p){this.pSearchInput.value="";for(var q in this.taskbars){if(this.taskbars.hasOwnProperty(q)){if(q==p){this.taskbars[q].Activate();this.pSearchInput.placeholder=this.taskbars[q].searchPlaceholder}else{this.taskbars[q].Deactivate()}this.activeTaskbarId=p;this.taskbars[q].ClearSearchResult()}}},GetActiveTaskbar:function(){return this.taskbars[this.activeTaskbarId]},StartResize:function(w){if(!w){w=window.event}var x=w.target||w.srcElement;if(x.getAttribute("data-bx-tsk-split-but")=="Y"){return true}this.freezeOnclickHandler=true;var p=this.GetWidth(),q=this.editor.dom.resizerOverlay,r=0,s,z=BX.GetWindowScrollPos(),u=w.clientX+z.scrollLeft,v=this;q.style.display="block";function t(C,B){if(!C){C=window.event}var A=C.clientX+z.scrollLeft;if(u==A){return}r=u-A;s=p+r;if(B){v.width=Math.max(s,v.closedWidth+v.MIN_CLOSED_WIDTH);if(isNaN(v.width)){v.width=v.closedWidth+v.MIN_CLOSED_WIDTH}}else{v.width=s}if(s>v.closedWidth+(B?20:0)){v.Show()}else{v.Hide()}}function y(A){t(A,true);BX.unbind(document,"mousemove",t);BX.unbind(document,"mouseup",y);q.style.display="none";setTimeout(function(){v.freezeOnclickHandler=false},10);BX.PreventDefault(A);v.editor.SaveOption("taskbar_width",v.GetWidth(true))}BX.bind(document,"mousemove",t);BX.bind(document,"mouseup",y)},Resize:function(p,q){var r=parseInt(this.pTopCont.offsetHeight,10);for(var t in this.taskbars){if(this.taskbars.hasOwnProperty(t)&&this.taskbars[t].pTreeCont){this.taskbars[t].pTreeCont.style.height=(q-r-42)+"px"}}this.pSearchCont.style.width=p+"px";if(!BX.browser.IsDoctype()){this.pSearchAli.style.width=(p-20)+"px"}var s=this;if(this.resizeTimeout){this.resizeTimeout=clearTimeout(this.resizeTimeout)}this.resizeTimeout=setTimeout(function(){if(parseInt(s.pTopCont.offsetHeight,10)!==r){s.Resize(p,q)}},100)},TaskbarSearch:function(r){var p=this.GetActiveTaskbar(),q=this.pSearchInput.value;if(r&&r.keyCode==this.editor.KEY_CODES.escape){q=this.pSearchInput.value=""}if(q.length<2){p.ClearSearchResult()}else{p.Search(q)}}};function d(p){this.editor=p;this.manager=this.editor.taskbarManager;this.searchIndex=[];this._searchResult=[];this._searchResultSect=[];BX.addCustomEvent(this.manager,"taskbargroupTitleClick",BX.proxy(this.OnGroupTitleClick,this));BX.addCustomEvent(this.manager,"taskbarelementClick",BX.proxy(this.OnElementClick,this));BX.addCustomEvent(this.manager,"taskbarTitleClick",BX.proxy(this.OnTitleClick,this));BX.addCustomEvent(this.manager,"taskbarMenuClick",BX.proxy(this.OnMenuClick,this))}d.prototype={GetCont:function(){return this.pTreeCont},GetTitleCont:function(){return this.pTitleCont},BuildSceleton:function(){this.pTitleCont=BX.create("span",{props:{className:"bxhtmled-split-btn"},html:'<span class="bxhtmled-split-btn-l"><span class="bxhtmled-split-btn-bg">'+this.title+'</span></span><span class="bxhtmled-split-btn-r"><span data-bx-type="taskbar_top_menu" data-bx-taskbar="'+this.id+'" class="bxhtmled-split-btn-bg"></span></span>'});this.pTitleCont.setAttribute("data-bx-type","taskbar_title_but");this.pTitleCont.setAttribute("data-bx-taskbar",this.id);this.pTreeCont=BX.create("DIV",{props:{className:"bxhtmled-taskbar-tree-cont"}});this.pTreeInnerCont=this.pTreeCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-taskbar-tree-inner-cont"}}))},BuildTree:function(q,p){BX.cleanNode(this.pTreeCont);this.treeSectionIndex={};this.BuildTreeSections(q);this.BuildTreeElements(p)},BuildTreeSections:function(q){this.sections=[];for(var p=0;p<q.length;p++){this.BuildSection(q[p])}},GetSectionsTreeInfo:function(){return this.sections},BuildSection:function(x){var p=this.GetSectionContByPath(x.path),z=BX.create("DIV",{props:{className:"bxhtmled-tskbr-sect-outer"}}),t=z.appendChild(BX.create("DIV",{props:{className:"bxhtmled-tskbr-sect"}})),u=t.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-tskbr-sect-icon"}})),v=t.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-tskbr-sect-title"},text:x.title||x.name})),w=z.appendChild(BX.create("DIV",{props:{className:"bxhtmled-tskb-child"}})),q=z.appendChild(BX.create("DIV",{props:{className:"bxhtmled-tskb-child-elements"}}));var y=x.path==""?x.name:x.path+","+x.name;var r=x.path==""?0:1;var s={key:y,children:[],section:x};this.treeSectionIndex[y]={icon:u,outerCont:z,cont:t,childCont:w,elementsCont:q,sect:s};this.GetSectionByPath(x.path).push(s);if(r>0){BX.addClass(t,"bxhtmled-tskbr-sect-"+r);BX.addClass(u,"bxhtmled-tskbr-sect-icon-"+r)}t.setAttribute("data-bx-type","taskbargroup_title");t.setAttribute("data-bx-taskbar",this.id);z.setAttribute("data-bx-type","taskbargroup");z.setAttribute("data-bx-path",y);z.setAttribute("data-bx-taskbar",this.id);p.appendChild(z)},BuildTreeElements:function(q){this.elements=q;for(var p in q){if(q.hasOwnProperty(p)){this.BuildElement(q[p])}}},BuildElement:function(r){var t=this,s=this.GetSectionContByPath(r.key||r.path,true),q=BX.create("DIV",{props:{className:"bxhtmled-tskbr-element"},html:'<span class="bxhtmled-tskbr-element-icon"></span><span class="bxhtmled-tskbr-element-text">'+r.title+"</span>"});var p=q.appendChild(BX.create("IMG",{props:{src:this.editor.util.GetEmptyImage(),className:"bxhtmled-drag"}}));this.HandleElementEx(q,p,r);this.searchIndex.push({content:(r.title+" "+r.name).toLowerCase(),element:q});p.onmousedown=function(w){if(!w){w=window.event}var v=w.target||w.srcElement,u=t.editor.GetBxTag(v);return t.OnElementMouseDownEx(w,v,u)};p.ondblclick=function(w){var v=w.target||w.srcElement,u=t.editor.GetBxTag(v);return t.OnElementDoubleClick(w,v,u)};p.ondragend=function(u){if(!u){u=window.event}t.OnDragEndHandler(u,this)};q.setAttribute("data-bx-type","taskbarelement");s.appendChild(q)},HandleElementEx:function(p){},GetSectionContByPath:function(q,p){if(q==""||!this.treeSectionIndex[q]){return this.pTreeCont}else{return p?this.treeSectionIndex[q].elementsCont:this.treeSectionIndex[q].childCont}},GetSectionByPath:function(p){if(p==""||!this.treeSectionIndex[p]){return this.sections}else{return this.treeSectionIndex[p].sect.children}},ToggleGroup:function(p,q){var s=p.getAttribute("data-bx-path");if(s){var r=this.treeSectionIndex[s];if(!r){return}if(q!==undefined){r.opened=!q}if(r.opened){BX.removeClass(r.cont,"bxhtmled-tskbr-sect-open");BX.removeClass(r.icon,"bxhtmled-tskbr-sect-icon-open");BX.removeClass(r.outerCont,"bxhtmled-tskbr-sect-outer-open");r.childCont.style.display="none";r.elementsCont.style.display="none";r.opened=false}else{BX.addClass(r.cont,"bxhtmled-tskbr-sect-open");BX.addClass(r.icon,"bxhtmled-tskbr-sect-icon-open");BX.addClass(r.outerCont,"bxhtmled-tskbr-sect-outer-open");r.childCont.style.display="block";r.elementsCont.style.display=r.elementsCont.childNodes.length>0?"block":"none";r.opened=true}}},OnDragEndHandler:function(q,p){var r=this;this.editor.skipPasteHandler=true;this.editor.skipPasteControl=true;if(this.editor.iframeView.pasteHandlerTimeout){this.editor.iframeView.pasteHandlerTimeout=clearTimeout(this.editor.iframeView.pasteHandlerTimeout)}setTimeout(function(){var t=r.editor.GetIframeElement(p.id);if(t&&t.parentNode){var s=r.editor.util.CheckSurrogateNode(t.parentNode);if(s){r.editor.util.InsertAfter(t,s)}}r.editor.synchro.FullSyncFromIframe();r.editor.skipPasteHandler=false;r.editor.skipPasteControl=false},20)},OnElementMouseDownEx:function(p){return true},OnElementClick:function(p){this.OnElementClickEx();return true},OnElementClickEx:function(){return true},OnElementDoubleClick:function(s,r,q){if(r){var p=r.cloneNode(true);this.editor.Focus();this.editor.selection.InsertNode(p);this.editor.synchro.FullSyncFromIframe()}},OnGroupTitleClick:function(p){if(p&&p.getAttribute("data-bx-taskbar")==this.id){return this.ToggleGroup(p.parentNode)}return true},OnTitleClick:function(p){if(p&&p.getAttribute("data-bx-taskbar")==this.id){return this.manager.ShowTaskbar(this.id)}return true},OnMenuClick:function(p){if(p&&p.getAttribute("data-bx-taskbar")==this.id){return this.ShowMenu(p)}return true},Activate:function(){this.pTreeCont.style.display="block";this.bActive=true;return true},Deactivate:function(){this.pTreeCont.style.display="none";this.bActive=false;return true},IsActive:function(){return !!this.bActive},ShowMenu:function(p){var q=this.GetMenuItems();BX.PopupMenu.destroy(this.uniqueId+"_menu");BX.PopupMenu.show(this.uniqueId+"_menu",p,q,{overlay:{opacity:0.1},events:{onPopupClose:function(){BX.removeClass(this.bindElement,"bxec-add-more-over")}},offsetLeft:1,zIndex:3005});return true},GetMenuItems:function(){return[]},Search:function(t){this.ClearSearchResult();var u=false,q,s,r,p=this.searchIndex.length;t=BX.util.trim(t.toLowerCase());BX.addClass(this.pTreeCont,"bxhtmled-taskbar-tree-cont-search");BX.addClass(this.manager.pSearchCont,"bxhtmled-search-cont-res");for(r=0;r<p;r++){s=this.searchIndex[r];if(s.content.indexOf(t)!==-1){u=true;BX.addClass(s.element,"bxhtmled-tskbr-search-res");this._searchResult.push(s.element);q=BX.findParent(s.element,function(v){return v.getAttribute&&v.getAttribute("data-bx-type")=="taskbargroup"},this.pTreeCont);while(q){BX.addClass(q,"bxhtmled-tskbr-search-res");this.ToggleGroup(q,true);this._searchResultSect.push(q);q=BX.findParent(q,function(v){return v.getAttribute&&v.getAttribute("data-bx-type")=="taskbargroup"},this.pTreeCont)}}}if(!u){this.manager.pSearchNothingNotice.style.display="block"}},ClearSearchResult:function(){BX.removeClass(this.pTreeCont,"bxhtmled-taskbar-tree-cont-search");BX.removeClass(this.manager.pSearchCont,"bxhtmled-search-cont-res");this.manager.pSearchNothingNotice.style.display="none";var p;if(this._searchResult){for(p=0;p<this._searchResult.length;p++){BX.removeClass(this._searchResult[p],"bxhtmled-tskbr-search-res")}this._searchResult=[]}if(this._searchResultSect){for(p=0;p<this._searchResultSect.length;p++){BX.removeClass(this._searchResultSect[p],"bxhtmled-tskbr-search-res");this.ToggleGroup(this._searchResultSect[p],false)}this._searchResultSect=[]}},GetId:function(){return this.id}};function e(p){e.superclass.constructor.apply(this,arguments);this.id="components";this.title=BX.message("ComponentsTitle");this.templateId=this.editor.templateId;this.uniqueId="taskbar_"+this.editor.id+"_"+this.id;this.searchPlaceholder=BX.message("BXEdCompSearchPlaceHolder");this.Init()}BX.extend(e,d);e.prototype.Init=function(){this.BuildSceleton();var p=this.editor.components.GetList();this.BuildTree(p.groups,p.items)};e.prototype.HandleElementEx=function(q,p,r){this.editor.SetBxTag(p,{tag:"component_icon",params:r});if(r.complex=="Y"){r.className="bxhtmled-surrogate-green";BX.addClass(q,"bxhtmled-tskbr-element-green");q.title=BX.message("BXEdComplexComp")}};e.prototype.OnElementMouseDownEx=function(r,q,p){if(!p||p.tag!=="component_icon"){return false}this.editor.components.LoadParamsList({name:p.params.name})};e.prototype.GetMenuItems=function(){var p=this;return[{text:BX.message("RefreshTaskbar"),title:BX.message("RefreshTaskbar"),className:"",onclick:function(){p.editor.componentsTaskbar.ClearSearchResult();p.editor.components.ReloadList();BX.PopupMenu.destroy(p.uniqueId+"_menu")}}]};function l(p,q){this.editor=p;this.id=q.id;this.params=q;this.className="bxhtmled-dialog"+(q.className?" "+q.className:"");this.zIndex=q.zIndex||3008;this.firstFocus=false;this.Init()}l.prototype={Init:function(){var q=this,p={title:this.params.title||this.params.name||"",width:this.params.width||600,resizable:false};if(this.params.resizable){p.resizable=true;p.min_width=this.params.min_width||400;p.min_height=this.params.min_height||250;p.resize_id=this.params.resize_id||this.params.id+"_res"}this.oDialog=new BX.CDialog(p);p.height=this.params.height||false;BX.addCustomEvent(this.oDialog,"onWindowResize",BX.proxy(this.OnResize,this));BX.addCustomEvent(this.oDialog,"onWindowResizeFinished",BX.proxy(this.OnResizeFinished,this));BX.addClass(this.oDialog.PARTS.CONTENT,this.className);if(!p.height){this.oDialog.PARTS.CONTENT_DATA.style.height=null}this.oDialog.SetButtons([new BX.CWindowButton({title:BX.message("DialogSave"),className:"adm-btn-save",action:function(){BX.onCustomEvent(q,"OnDialogSave");q.oDialog.Close()}}),this.oDialog.btnCancel]);BX.addCustomEvent(this.oDialog,"onWindowUnRegister",function(){BX.unbind(window,"keydown",BX.proxy(q.OnKeyDown,q));q.dialogShownTimeout=setTimeout(function(){q.editor.dialogShown=false},300);q.RestoreWindowOverflow()})},Show:function(){var t=this;this.editor.dialogShown=true;if(this.dialogShownTimeout){this.dialogShownTimeout=clearTimeout(this.dialogShownTimeout)}this.oDialog.Show();this.oDialog.DIV.style.zIndex=this.zIndex;this.oDialog.OVERLAY.style.zIndex=this.zIndex-2;var q=parseInt(this.oDialog.DIV.style.top)-180,s=BX.GetWindowScrollPos(document),p=s.scrollTop,r=p+50;this.oDialog.DIV.style.top=(q>r?q:r)+"px";BX.bind(window,"keydown",BX.proxy(this.OnKeyDown,this));this.savedBodyOverflow=this.savedScrollLeft=this.savedScrollTop=false;setTimeout(function(){if(BX.browser.IsOpera()){t.oDialog.Move(1,1)}t.oDialog.__resizeOverlay();if(t.firstFocus){BX.focus(t.firstFocus);if(t.selectFirstFocus){t.firstFocus.select()}}},100)},BuildTabControl:function(s,r){var q,p=BX.create("DIV",{props:{className:"bxhtmled-dlg-tabs-wrap"}}),t=BX.create("DIV",{props:{className:"bxhtmled-dlg-cont-wrap"}});for(q=0;q<r.length;q++){r[q].tab=p.appendChild(BX.create("SPAN",{props:{className:"bxhtmled-dlg-tab"+(q==0?" bxhtmled-dlg-tab-active":"")},attrs:{"data-bx-dlg-tab-ind":q.toString()},text:r[q].name}));r[q].cont=t.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dlg-cont"},style:{display:q==0?"":"none"}}))}BX.bind(p,"click",function(w){var u,v=w.target||w.srcElement;if(v&&v.getAttribute){u=parseInt(v.getAttribute("data-bx-dlg-tab-ind"));if(!isNaN(u)){for(q=0;q<r.length;q++){if(q==u){r[q].cont.style.display="";BX.addClass(r[q].tab,"bxhtmled-dlg-tab-active")}else{r[q].cont.style.display="none";BX.removeClass(r[q].tab,"bxhtmled-dlg-tab-active")}}}}});s.appendChild(p);s.appendChild(t);return{cont:s,tabsWrap:p,contWrap:t,tabs:r}},OnKeyDown:function(q){if(q.keyCode==13&&this.closeByEnter!==false){var p=q.target||q.srcElement;if(p&&p.nodeName!=="TEXTAREA"){this.oDialog.PARAMS.buttons[0].emulate()}}},SetContent:function(p){return this.oDialog.SetContent(p)},SetTitle:function(p){return this.oDialog.SetTitle(p)},OnResize:function(){},OnResizeFinished:function(){},GetContentSize:function(){return{width:this.oDialog.PARTS.CONTENT_DATA.offsetWidth,height:this.oDialog.PARTS.CONTENT_DATA.offsetHeight}},Save:function(){if(this.savedRange){this.editor.selection.SetBookmark(this.savedRange)}if(this.action&&this.editor.action.IsSupported(this.action)){this.editor.action.Exec(this.action,this.GetValues())}},Close:function(){if(this.IsOpen()){this.oDialog.Close()}},IsOpen:function(){return this.oDialog.isOpen},DisableKeyCheck:function(){this.closeByEnter=false;BX.WindowManager.disableKeyCheck()},EnableKeyCheck:function(){var p=this;setTimeout(function(){p.closeByEnter=true;BX.WindowManager.enableKeyCheck()},200)},AddTableRow:function(u,p){var t,s,q;t=u.insertRow(-1);s=t.insertCell(-1);s.className="bxhtmled-left-c";if(p&&p.label){s.appendChild(BX.create("LABEL",{props:{className:p.required?"bxhtmled-req":""},text:p.label})).setAttribute("for",p.id)}q=t.insertCell(-1);q.className="bxhtmled-right-c";return{row:t,leftCell:s,rightCell:q}},SetValues:BX.DoNothing,GetValues:BX.DoNothing,CheckSize:function(r){var t=this;if(this.checkSizeTimeout){this.checkSizeTimeout=clearTimeout(this.checkSizeTimeout)}if(r!==true){this.checkSizeTimeout=setTimeout(function(){t.CheckSize(true)},50);return}var p=BX.GetWindowInnerSize(document),q=this.oDialog.DIV.offsetHeight+50;if(q>=p.innerHeight){var s=BX.GetWindowScrollPos(document);this.savedBodyOverflow=document.body.style.overflow;this.savedScrollTop=s.scrollTop;this.savedScrollLeft=s.scrollLeft;document.body.style.overflow="auto";if(this.editor.expanded){BX.unbind(window,"scroll",BX.proxy(this.editor.PreventScroll,this.editor))}}else{this.RestoreWindowOverflow()}},RestoreWindowOverflow:function(){if(this.savedBodyOverflow!==false){document.body.style.overflow=this.savedBodyOverflow;this.savedBodyOverflow=false}if(this.savedScrollTop!==false){window.scrollTo(this.savedScrollLeft,this.savedScrollTop);this.savedScrollLeft=this.savedScrollTop=false}if(this.editor.expanded){BX.bind(window,"scroll",BX.proxy(this.editor.PreventScroll,this.editor))}}};function n(p){this.editor=p;BX.addCustomEvent(this.editor,"OnIframeContextMenu",BX.delegate(this.Show,this));this.Init()}n.prototype={Init:function(){var q=this,p={TEXT:BX.message("ContMenuDefProps"),ACTION:function(){q.editor.selection.SetBookmark(q.savedRange);q.editor.GetDialog("Default").Show(false,q.savedRange);q.Hide()}};this.items={php:[{TEXT:BX.message("BXEdContMenuPhpCode"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.php){q.editor.GetDialog("Source").Show(r.php.bxTag)}q.Hide()}}],anchor:[{TEXT:BX.message("BXEdEditAnchor"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.anchor){q.editor.GetDialog("Anchor").Show(r.anchor.bxTag)}q.Hide()}}],javascript:[{TEXT:BX.message("BXEdContMenuJavascript"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.javascript){q.editor.GetDialog("Source").Show(r.javascript.bxTag)}q.Hide()}}],htmlcomment:[{TEXT:BX.message("BXEdContMenuHtmlComment"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.htmlcomment){q.editor.GetDialog("Source").Show(r.htmlcomment.bxTag)}q.Hide()}}],iframe:[{TEXT:BX.message("BXEdContMenuIframe"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.iframe){q.editor.GetDialog("Source").Show(r.iframe.bxTag)}q.Hide()}}],style:[{TEXT:BX.message("BXEdContMenuStyle"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.style){q.editor.GetDialog("Source").Show(r.style.bxTag)}q.Hide()}}],object:[{TEXT:BX.message("BXEdContMenuObject"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.object){q.editor.GetDialog("Source").Show(r.object.bxTag)}q.Hide()}}],component:[{TEXT:BX.message("BXEdContMenuComponent"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.component){q.editor.components.ShowPropertiesDialog(r.component.bxTag.params,q.editor.GetBxTag(r.component.bxTag.surrogateId))}q.Hide()}},{TEXT:BX.message("BXEdContMenuComponentRemove"),ACTION:function(){var r=q.GetTargetItem();if(r&&r.component){BX.remove(r.component.element)}q.Hide()}}],printbreak:[{TEXT:BX.message("NodeRemove"),ACTION:function(s){var r=q.GetTargetItem("printbreak");if(r&&r.element){q.editor.selection.RemoveNode(r.element)}q.Hide()}}],video:[{TEXT:BX.message("BXEdVideoProps"),bbMode:true,ACTION:function(){var r=q.GetTargetItem("video");if(r){q.editor.GetDialog("Video").Show(r.bxTag)}q.Hide()}},{TEXT:BX.message("BXEdVideoDel"),bbMode:true,ACTION:function(s){var r=q.GetTargetItem("video");if(r&&r.element){q.editor.selection.RemoveNode(r.element)}q.Hide()}}],smile:[],A:[{TEXT:BX.message("ContMenuLinkEdit"),bbMode:true,ACTION:function(){var r=q.GetTargetItem("A");if(r){q.editor.GetDialog("Link").Show([r],this.savedRange)}q.Hide()}},{TEXT:BX.message("ContMenuLinkDel"),bbMode:true,ACTION:function(){var r=q.GetTargetItem("A");if(r&&q.editor.action.IsSupported("removeLink")){q.editor.action.Exec("removeLink",[r])}q.Hide()}}],IMG:[{TEXT:BX.message("ContMenuImgEdit"),bbMode:true,ACTION:function(){var r=q.GetTargetItem("IMG");if(r){q.editor.GetDialog("Image").Show([r],q.savedRange)}q.Hide()}},{TEXT:BX.message("ContMenuImgDel"),bbMode:true,ACTION:function(){var r=q.GetTargetItem("IMG");if(r){q.editor.selection.RemoveNode(r)}q.Hide()}}],DIV:[{TEXT:BX.message("ContMenuCleanDiv"),title:BX.message("ContMenuCleanDiv_Title"),ACTION:function(){var r=q.GetTargetItem("DIV");if(r){q.editor.On("OnHtmlContentChangedByControl");q.editor.util.ReplaceWithOwnChildren(r);q.editor.synchro.FullSyncFromIframe()}q.Hide()}},p],TABLE:[{TEXT:BX.message("BXEdTableInsertMenu"),HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length!=1},MENU:[{TEXT:BX.message("BXEdTableInsColLeft"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"insertColumnLeft",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}},{TEXT:BX.message("BXEdTableInsColRight"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"insertColumnRight",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}},{TEXT:BX.message("BXEdTableInsRowUpper"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"insertRowUpper",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}},{TEXT:BX.message("BXEdTableInsRowLower"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"insertRowLower",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}},{TEXT:BX.message("BXEdTableInsCellBefore"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"insertCellLeft",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}},{TEXT:BX.message("BXEdTableInsCellAfter"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"insertCellRight",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}}]},{TEXT:BX.message("BXEdTableRemoveMenu"),MENU:[{TEXT:BX.message("BXEdTableDelCol"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"removeColumn",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length!=1}},{TEXT:BX.message("BXEdTableDelRow"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"removeRow",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length!=1}},{TEXT:BX.message("BXEdTableDellCell"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"removeCell",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length!=1}},{TEXT:BX.message("BXEdTableDellSelectedCells"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"removeSelectedCells",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length===1}}]},{TEXT:BX.message("BXEdTableMergeMenu"),MENU:[{TEXT:BX.message("BXEdTableMergeSelectedCells"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"mergeSelectedCells",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){if(!q.savedRange.collapsed){return !q.editor.action.actions.tableOperation.canBeMerged(false,q.savedRange,q.GetTargetItem("TABLE"))}return true}},{TEXT:BX.message("BXEdTableMergeRight"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"mergeRightCell",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){return !q.editor.action.actions.tableOperation.canBeMergedWithRight(q.savedRange,q.GetTargetItem("TABLE"))}},{TEXT:BX.message("BXEdTableMergeBottom"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"mergeBottomCell",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){return !q.editor.action.actions.tableOperation.canBeMergedWithBottom(q.savedRange,q.GetTargetItem("TABLE"))}},{TEXT:BX.message("BXEdTableMergeRowCells"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"mergeRow",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length>1}},{TEXT:BX.message("BXEdTableMergeColCells"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"mergeColumn",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length>1}}]},{TEXT:BX.message("BXEdTableSplitMenu"),HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length!=1},MENU:[{TEXT:BX.message("BXEdTableSplitCellHor"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"splitHorizontally",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}},{TEXT:BX.message("BXEdTableSplitCellVer"),ACTION:function(){q.editor.action.Exec("tableOperation",{actionType:"splitVertically",tableNode:q.GetTargetItem("TABLE"),range:q.savedRange});q.Hide()}}]},{SEPARATOR:true},{TEXT:BX.message("BXEdTableTableCellProps"),ACTION:function(){var s=q.GetTargetItem("TABLE");if(s){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));q.editor.GetDialog("Default").Show(r,q.savedRange)}q.Hide()},HIDE_ITEM:function(){var r=q.editor.action.actions.tableOperation.getSelectedCells(q.savedRange,q.GetTargetItem("TABLE"));return !r||r.length!=1}},{TEXT:BX.message("BXEdTableTableProps"),ACTION:function(){var r=q.GetTargetItem("TABLE");if(r){q.editor.GetDialog("Table").Show([r],q.savedRange)}q.Hide()}},{TEXT:BX.message("BXEdTableDeleteTable"),bbMode:true,ACTION:function(){var r=q.GetTargetItem("TABLE");if(r){q.editor.selection.RemoveNode(r)}q.Hide()}}],DEFAULT:[p]}},Show:function(F,I,H){this.savedRange=this.editor.selection.GetBookmark();this.Hide();this.editor.contextMenuShown=true;if(this.contextMenuShownTimeout){this.contextMenuShownTimeout=clearTimeout(this.contextMenuShownTimeout)}this.nodes=[];this.tagIndex={};var z,E,C,B,J,G,v,w=[],r=20,D=0,p=I,s;this.targetItems={};while(true){if(p.nodeName&&p.nodeName.toUpperCase()!="BODY"){if(p.nodeType!=3){z=this.editor.GetBxTag(p);if(z&&z.tag=="surrogate_dd"){var q=this.editor.GetBxTag(z.params.origId);p=this.editor.GetIframeElement(q.id);this.PushTargetItem(q.tag,{element:p,bxTag:q});this.nodes=[p];this.tagIndex[q.tag]=0;D=0;p=p.parentNode;continue}else{if(z&&z.tag&&this.items[z.tag]){this.nodes=[p];this.PushTargetItem(z.tag,{element:p,bxTag:z.tag});this.nodes=[p];this.tagIndex[z.tag]=0;D=0;p=p.parentNode;continue}}s=p.nodeName;this.PushTargetItem(s,p);this.nodes.push(p);this.tagIndex[s]=this.nodes.length-1}D++}if(!p||p.nodeName&&p.nodeName.toUpperCase()=="BODY"||D>=r){break}p=p.parentNode}for(E in this.items){if(this.items.hasOwnProperty(E)&&this.tagIndex[E]!=undefined){if(w.length>0){w.push({SEPARATOR:true})}for(C=0;C<this.items[E].length;C++){if(typeof this.items[E][C].HIDE_ITEM=="function"&&this.items[E][C].HIDE_ITEM()===true){continue}if(this.editor.bbCode&&!this.items[E][C].bbMode){continue}if(this.items[E][C].MENU){v=BX.clone(this.items[E][C]);J=[];for(B=0;B<v.MENU.length;B++){G=v.MENU[B];if(typeof G.HIDE_ITEM=="function"&&G.HIDE_ITEM()===true){continue}if(this.editor.bbCode&&!G.bbMode){continue}J.push(G)}if(J.length===0){continue}v.MENU=J;w.push(v)}else{w.push(this.items[E][C])}}}}if(w.length==0&&(!this.editor.bbCode||this.items.DEFAULT.bbMode)){if(!this.savedRange||(!this.savedRange.collapsed&&!H)){for(C=0;C<this.items.DEFAULT.length;C++){w.push(this.items.DEFAULT[C])}}}var u=F.clientX,t=F.clientY;if(!this.dummyTarget){this.dummyTarget=this.editor.dom.iframeCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dummy-target"}}))}this.dummyTarget.style.left=u+"px";this.dummyTarget.style.top=t+"px";this.dummyTarget.style.zIndex="2002";if(w.length>0){this.OPENER=new BX.COpener({DIV:this.dummyTarget,MENU:w,TYPE:"click",ACTIVE_CLASS:"adm-btn-active",CLOSE_ON_CLICK:true});this.OPENER.Open();var A=this.OPENER.GetMenu().DIV;A.style.zIndex="3005";A.id="bx-admin-prefix";BX.addClass(A,"bx-core-popup-menu-editor");this.isOpened=true;BX.addCustomEvent(this.editor,"OnIframeClick",BX.proxy(this.Hide,this));BX.addCustomEvent(this.editor,"OnIframeKeyup",BX.proxy(this.CheckEscapeClose,this));return BX.PreventDefault(F)}},Hide:function(){if(this.OPENER){var p=this;this.contextMenuShownTimeout=setTimeout(function(){p.editor.contextMenuShown=false},300);this.OPENER.bMenuInit=true;this.OPENER.Close();this.isOpened=false;BX.removeCustomEvent(this.editor,"OnIframeClick",BX.proxy(this.Hide,this));BX.removeCustomEvent(this.editor,"OnIframeKeyup",BX.proxy(this.CheckEscapeClose,this))}},CheckEscapeClose:function(q,p){if(p==this.editor.KEY_CODES.escape){this.Hide()}},GetTargetItem:function(p){return p?(this.targetItems[p]||null):this.targetItems},PushTargetItem:function(q,p){if(!this.targetItems[q]){this.targetItems[q]=p}}};function j(p,q){this.editor=p;this.pCont=p.dom.toolbar;this.controls={};this.bCompact=false;this.topControls=q;this.showMoreButton=false;this.shown=true;this.height=34;this.Init()}j.prototype={Init:function(){this.BuildControls();BX.addCustomEvent(this.editor,"OnIframeFocus",BX.delegate(this.EnableWysiwygButtons,this));BX.addCustomEvent(this.editor,"OnTextareaFocus",BX.delegate(this.DisableWysiwygButtons,this))},BuildControls:function(){BX.cleanNode(this.pCont);var s,t,r,p,u=this.GetControlsMap(),q={left:this.pCont.appendChild(BX.create("span",{props:{className:"bxhtmled-top-bar-left-wrap"},style:{display:"none"}})),main:this.pCont.appendChild(BX.create("span",{props:{className:"bxhtmled-top-bar-wrap"},style:{display:"none"}})),right:this.pCont.appendChild(BX.create("span",{props:{className:"bxhtmled-top-bar-right-wrap"},style:{display:"none"}})),hidden:this.pCont.appendChild(BX.create("span",{props:{className:"bxhtmled-top-bar-hidden-wrap"}}))};this.hiddenWrap=q.hidden;this.editor.normalWidth=this.editor.NORMAL_WIDTH;for(s=0;s<u.length;s++){if(u[s].hidden){u[s].wrap="hidden";this.showMoreButton=true}else{if(u[s].checkWidth&&u[s].offsetWidth){this.editor.normalWidth+=u[s].offsetWidth}}t=q[(u[s].wrap||"main")];if(!t){t=BX(u[s].wrap);if(t){q[u[s].wrap]=t}else{t=q.main}}if(t.style.display=="none"){t.style.display=""}if(u[s].separator){t.appendChild(this.GetSeparator())}else{if(this.topControls[u[s].id]){if(!this.controls[u[s].id]){this.controls[u[s].id]=new this.topControls[u[s].id](this.editor,t)}else{p=this.controls[u[s].id].GetPopupBindCont?this.controls[u[s].id].GetPopupBindCont():this.controls[u[s].id].GetCont();if(this.controls[u[s].id].CheckBeforeShow&&!this.controls[u[s].id].CheckBeforeShow()){continue}if(this.controls.More&&((this.bCompact&&!u[s].compact)||u[s].hidden)){if(!r){r=this.controls.More.GetPopupCont()}r.appendChild(p)}else{t.appendChild(p)}}}}}for(s in q){if(q.hasOwnProperty(s)&&s!=="main"&&s!=="left"&&s!=="right"&&s!=="hidden"&&q[s].getAttribute("data-bx-check-command")!=="N"){q[s].setAttribute("data-bx-check-command","N");BX.bind(q[s],"click",BX.proxy(function(v){this.editor.CheckCommand(v.target||v.srcElement)},this))}}},GetControlsMap:function(){if(this.controlsMap){return this.controlsMap}var p=this.editor.config.controlsMap;if(!p){p=[{id:"ChangeView",wrap:"left",compact:true,sort:10},{id:"Undo",compact:false,sort:20},{id:"Redo",compact:false,sort:30},{id:"StyleSelector",compact:true,sort:40},{id:"FontSelector",compact:false,sort:50},{id:"FontSize",compact:false,sort:60},{separator:true,compact:false,sort:70},{id:"Bold",compact:true,sort:80},{id:"Italic",compact:true,sort:90},{id:"Underline",compact:true,sort:100},{id:"Strikeout",compact:true,sort:110},{id:"RemoveFormat",compact:true,sort:120},{id:"Color",compact:true,sort:130},{separator:true,compact:false,sort:140},{id:"OrderedList",compact:true,sort:150},{id:"UnorderedList",compact:true,sort:160},{id:"IndentButton",compact:true,sort:170},{id:"OutdentButton",compact:true,sort:180},{id:"AlignList",compact:true,sort:190},{separator:true,compact:false,sort:200},{id:"InsertLink",compact:true,sort:210},{id:"InsertImage",compact:true,sort:220},{id:"InsertVideo",compact:true,sort:230},{id:"InsertAnchor",compact:false,sort:240},{id:"InsertTable",compact:false,sort:250},{id:"InsertChar",compact:false,hidden:true,sort:260},{id:"PrintBreak",compact:false,hidden:true,sort:270},{id:"PageBreak",compact:false,hidden:true,sort:275},{id:"Spellcheck",compact:false,hidden:true,sort:280},{id:"InsertHr",compact:false,hidden:true,sort:290},{id:"Sub",compact:false,hidden:true,sort:310},{id:"Sup",compact:false,hidden:true,sort:320},{id:"TemplateSelector",compact:false,sort:330},{id:"Fullscreen",compact:true,sort:340},{id:"More",compact:true,sort:400},{id:"Settings",wrap:"right",compact:true,sort:500}]}this.editor.On("GetControlsMap",[p]);p=p.sort(function(r,q){return r.sort-q.sort});this.controlsMap=p;return p},GetSeparator:function(){return BX.create("span",{props:{className:"bxhtmled-top-bar-separator"}})},GetHeight:function(){var p=0;if(this.shown){if(!this.height){this.height=parseInt(this.editor.dom.toolbarCont.offsetHeight)}p=this.height}return p},DisableWysiwygButtons:function(q){q=q!==false;for(var p in this.controls){if(this.controls.hasOwnProperty(p)&&typeof this.controls[p].Disable=="function"&&this.controls[p].disabledForTextarea!==false){this.controls[p].Disable(q)}}},EnableWysiwygButtons:function(){this.DisableWysiwygButtons(false)},AdaptControls:function(q){var r=q<this.editor.normalWidth;if(this.controls.More){if(r||this.showMoreButton){this.controls.More.GetCont().style.display=""}else{this.controls.More.GetCont().style.display="none"}if(this.controls.More.pCont&&this.controls.More.pCont.style.display!=="none"){this.controls.More.Close()}}if(!r&&this.showMoreButton){var p=this.controls.More.GetPopupCont();while(this.hiddenWrap.firstChild){p.appendChild(this.hiddenWrap.firstChild)}}if(this.bCompact!=r){this.bCompact=r;this.BuildControls()}},Hide:function(){this.shown=false;this.editor.dom.toolbarCont.style.display="none";this.editor.ResizeSceleton()},Show:function(){this.shown=true;this.editor.dom.toolbarCont.style.display="";this.editor.ResizeSceleton()},IsShown:function(){return this.shown}};function g(p){this.editor=p;this.bShown=false;this.pCont=p.dom.navCont;this.controls={};this.height=28;this.Init()}g.prototype={Init:function(){BX.addCustomEvent(this.editor,"OnIframeMouseDown",BX.proxy(this.OnIframeMousedown,this));BX.addCustomEvent(this.editor,"OnIframeKeyup",BX.proxy(this.OnIframeKeyup,this));BX.addCustomEvent(this.editor,"OnTextareaFocus",BX.delegate(this.Disable,this));BX.addCustomEvent(this.editor,"OnHtmlContentChangedByControl",BX.delegate(this.OnIframeKeyup,this));BX.bind(this.pCont,"click",BX.delegate(this.ShowMenu,this));var p=this;this.items={php:function(r,q){p.editor.GetDialog("Source").Show(q)},anchor:function(r,q){p.editor.GetDialog("Anchor").Show(q)},javascript:function(r,q){p.editor.GetDialog("Source").Show(q)},htmlcomment:function(r,q){p.editor.GetDialog("Source").Show(q)},iframe:function(r,q){p.editor.GetDialog("Source").Show(q)},style:function(r,q){p.editor.GetDialog("Source").Show(q)},video:function(r,q){p.editor.GetDialog("Video").Show(q)},component:function(r,q){p.editor.components.ShowPropertiesDialog(q.params,p.editor.GetBxTag(q.surrogateId))},printbreak:false,A:function(q){p.editor.GetDialog("Link").Show([q])},IMG:function(q){p.editor.GetDialog("Image").Show([q])},TABLE:function(q){p.editor.GetDialog("Table").Show([q])},DEFAULT:function(q){p.editor.GetDialog("Default").Show([q])}}},Show:function(p){this.bShown=p=p!==false;this.pCont.style.display=p?"block":"none"},GetHeight:function(){if(!this.bShown){return 0}if(!this.height){this.height=parseInt(this.pCont.offsetHeight)}return this.height},OnIframeMousedown:function(r,q,p){this.BuildNavi(q)},OnIframeKeyup:function(r,q,p){this.BuildNavi(p)},BuildNavi:function(s){BX.cleanNode(this.pCont);if(!s){s=this.editor.GetIframeDoc().body}this.nodeIndex=[];var r,p,q;while(s){if(s.nodeType!=3){q=this.editor.GetBxTag(s);if(q.tag){if(q.tag=="surrogate_dd"){s=s.parentNode;continue}BX.cleanNode(this.pCont);this.nodeIndex=[];p=q.name||q.tag}else{p=s.nodeName}r=BX.create("SPAN",{props:{className:"bxhtmled-nav-item"},text:p});r.setAttribute("data-bx-node-ind",this.nodeIndex.length.toString());this.nodeIndex.push({node:s,bxTag:q.tag});if(this.pCont.firstChild){this.pCont.insertBefore(r,this.pCont.firstChild);if(!this.AdjustSize()){break}}else{this.pCont.appendChild(r)}}if(s.nodeName&&s.nodeName.toUpperCase()=="BODY"){break}s=s.parentNode}this.AdjustSize()},AdjustSize:function(){if(this.pCont.lastChild&&this.pCont.lastChild.offsetTop>0){BX.remove(this.pCont.firstChild);return false}return true},ShowMenu:function(t){if(!this.nodeIndex){return}var w=this,v,r,s;if(t.target){s=t.target}else{if(t.srcElement){s=t.srcElement}}if(s.nodeType==3){s=s.parentNode}if(s){v=s.getAttribute("data-bx-node-ind");if(!this.nodeIndex[v]){s=BX.findParent(s,function(x){return x==w.pCont||(x.getAttribute&&x.getAttribute("data-bx-node-ind")>=0)},this.pCont);v=s.getAttribute("data-bx-node-ind")}if(this.nodeIndex[v]){var u="bx_node_nav_"+Math.round(Math.random()*1000000000);r=this.nodeIndex[v].node;var q=[];if(r.nodeName&&r.nodeName.toUpperCase()!="BODY"){if(!this.nodeIndex[v].bxTag||!this.editor.phpParser.surrogateTags[this.nodeIndex[v].bxTag]){q.push({text:BX.message("NodeSelect"),title:BX.message("NodeSelect"),className:"",onclick:function(){w.editor.action.Exec("selectNode",r);this.popupWindow.close();this.popupWindow.destroy()}})}q.push({text:BX.message("NodeRemove"),title:BX.message("NodeRemove"),className:"",onclick:function(){if(r&&r.parentNode){w.BuildNavi(r.parentNode);w.editor.selection.RemoveNode(r)}this.popupWindow.close();this.popupWindow.destroy()}});var p=!(this.nodeIndex[v]&&this.nodeIndex[v].bxTag&&this.items[this.nodeIndex[v].bxTag]==false);if(p){q.push({text:BX.message("NodeProps"),title:BX.message("NodeProps"),className:"",onclick:function(){w.ShowNodeProperties(r);this.popupWindow.close();this.popupWindow.destroy()}})}}else{q=[{text:BX.message("NodeSelectBody"),title:BX.message("NodeSelectBody"),className:"",onclick:function(){w.editor.iframeView.CheckContentLastChild();w.editor.action.Exec("selectNode",r);w.editor.Focus();this.popupWindow.close();this.popupWindow.destroy()}},{text:BX.message("NodeRemoveBodyContent"),title:BX.message("NodeRemoveBodyContent"),className:"",onclick:function(){w.BuildNavi(r);w.editor.On("OnHtmlContentChangedByControl");w.editor.iframeView.Clear();w.editor.util.Refresh(r);w.editor.synchro.FullSyncFromIframe();w.editor.Focus();this.popupWindow.close();this.popupWindow.destroy()}}]}BX.PopupMenu.show(u+"_menu",s,q,{overlay:{opacity:1},events:{onPopupClose:function(){}},offsetLeft:1,zIndex:4000,bindOptions:{position:"top"}})}}},ShowNodeProperties:function(r){var q,p;if(r.nodeName&&r.nodeType==1){q=this.editor.GetBxTag(r);p=q.tag?q.tag:r.nodeName;if(this.items[p]&&typeof this.items[p]=="function"){this.items[p](r,q)}else{this.items.DEFAULT(r,q)}}},Disable:function(){this.BuildNavi(false)},Enable:function(){}};function c(p,q){this.editor=p;this.id="bxeditor_overlay"+this.editor.id;this.zIndex=q&&q.zIndex?q.zIndex:3001}c.prototype={Create:function(){this.bCreated=true;this.bShown=false;var p=BX.GetWindowScrollSize();this.pWnd=document.body.appendChild(BX.create("DIV",{props:{id:this.id,className:"bxhtmled-overlay"},style:{zIndex:this.zIndex,width:p.scrollWidth+"px",height:p.scrollHeight+"px"}}));this.pWnd.ondrag=BX.False;this.pWnd.onselectstart=BX.False},Show:function(q){if(!this.bCreated){this.Create()}this.bShown=true;if(this.shownTimeout){this.shownTimeout=clearTimeout(this.shownTimeout)}var p=BX.GetWindowScrollSize();this.pWnd.style.display="block";this.pWnd.style.width=p.scrollWidth+"px";this.pWnd.style.height=p.scrollHeight+"px";if(!q){q={}}this.pWnd.style.zIndex=q.zIndex||this.zIndex;BX.bind(window,"resize",BX.proxy(this.Resize,this));return this.pWnd},Hide:function(){if(!this.bShown){return}var p=this;p.shownTimeout=setTimeout(function(){p.bShown=false},300);this.pWnd.style.display="none";BX.unbind(window,"resize",BX.proxy(this.Resize,this));this.pWnd.onclick=null},Resize:function(){if(this.bCreated){var p=BX.GetWindowScrollSize();this.pWnd.style.width=p.scrollWidth+"px";this.pWnd.style.height=p.scrollHeight+"px"}}};function i(p){this.editor=p;this.className="bxhtmled-top-bar-btn";this.activeClassName="bxhtmled-top-bar-btn-active";this.disabledClassName="bxhtmled-top-bar-btn-disabled";this.checkableAction=true;this.disabledForTextarea=true}i.prototype={Create:function(){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title||""},html:"<i></i>"});BX.bind(this.pCont,"click",BX.delegate(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this));BX.bind(this.pCont,"dblclick",function(p){return BX.PreventDefault(p)});if(this.action){this.pCont.setAttribute("data-bx-type","action");this.pCont.setAttribute("data-bx-action",this.action);if(this.value){this.pCont.setAttribute("data-bx-value",this.value)}if(this.checkableAction){this.editor.RegisterCheckableAction(this.action,{action:this.action,control:this,value:this.value})}}},GetCont:function(){return this.pCont},Check:function(p){if(p==this.checked||this.disabled){return}this.checked=p;if(this.checked){BX.addClass(this.pCont,this.activeClassName)}else{BX.removeClass(this.pCont,this.activeClassName)}},Disable:function(p){if(p!=this.disabled){this.disabled=!!p;if(p){if(this.action){this.pCont.setAttribute("data-bx-type","")}BX.addClass(this.pCont,this.disabledClassName)}else{if(this.action){this.pCont.setAttribute("data-bx-type","action")}BX.removeClass(this.pCont,this.disabledClassName)}}},OnClick:BX.DoNothing,OnMouseUp:function(){if(!this.checked){BX.removeClass(this.pCont,this.activeClassName)}BX.unbind(document,"mouseup",BX.proxy(this.OnMouseUp,this));BX.removeCustomEvent(this.editor,"OnIframeMouseUp",BX.proxy(this.OnMouseUp,this));if(this.editor.toolbar&&this.editor.toolbar.controls&&this.editor.toolbar.controls.More){this.editor.toolbar.controls.More.Close()}},OnMouseDown:function(){if(!this.disabled){if(this.disabledForTextarea||!this.editor.synchro.IsFocusedOnTextarea()){this.savedRange=this.editor.selection.SaveBookmark()}BX.addClass(this.pCont,this.activeClassName);BX.bind(document,"mouseup",BX.proxy(this.OnMouseUp,this));BX.addCustomEvent(this.editor,"OnIframeMouseUp",BX.proxy(this.OnMouseUp,this))}},GetValue:function(){return !!this.checked},SetValue:function(p){this.Check(p)}};function b(p){this.editor=p;this.className="bxhtmled-top-bar-btn";this.activeClassName="bxhtmled-top-bar-btn-active";this.activeListClassName="bxhtmled-top-bar-btn-active";this.arValues=[];this.checkableAction=true;this.disabledForTextarea=true;this.posOffset={top:6,left:-4};this.zIndex=3005}b.prototype={Create:function(){this.pCont=BX.create("SPAN",{props:{className:this.className},html:"<i></i>"});this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});if(this.title){this.pCont.title=this.title}if(this.zIndex){this.pValuesCont.style.zIndex=this.zIndex}this.valueIndex={};this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV"));var p,r,s=this;for(var q=0;q<this.arValues.length;q++){r=this.arValues[q];p=this.pValuesContWrap.appendChild(BX.create("SPAN",{props:{title:r.title,className:r.className},html:"<i></i>"}));p.setAttribute("data-bx-dropdown-value",r.id);this.valueIndex[r.id]=q;if(r.action){p.setAttribute("data-bx-type","action");p.setAttribute("data-bx-action",r.action);if(r.value){p.setAttribute("data-bx-value",r.value)}}BX.bind(p,"mousedown",function(t){s.SelectItem(this.getAttribute("data-bx-dropdown-value"));s.editor.CheckCommand(this);s.Close()});this.arValues[q].listCont=p}if(this.action&&this.checkableAction){this.editor.RegisterCheckableAction(this.action,{action:this.action,control:this})}BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this));BX.bind(this.pCont,"mousedown",BX.delegate(this.OnMouseDown,this))},GetCont:function(){return this.pCont},GetPopupBindCont:function(){return this.pCont},Disable:function(p){if(p!=this.disabled){this.disabled=!!p;if(p){BX.addClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}else{BX.removeClass(this.pCont,"bxhtmled-top-bar-btn-disabled")}}},OnKeyDown:function(p){if(p.keyCode==27){this.Close()}},OnClick:function(){if(!this.disabled){if(this.bOpened){this.Close()}else{this.Open()}}},OnMouseUp:function(){this.editor.selection.RestoreBookmark();if(!this.checked){BX.removeClass(this.pCont,this.activeClassName)}BX.unbind(document,"mouseup",BX.proxy(this.OnMouseUp,this));BX.removeCustomEvent(this.editor,"OnIframeMouseUp",BX.proxy(this.OnMouseUp,this))},OnMouseDown:function(){if(!this.disabled){if(this.disabledForTextarea||!this.editor.synchro.IsFocusedOnTextarea()){this.savedRange=this.editor.selection.SaveBookmark()}BX.addClass(this.pCont,this.activeClassName);BX.bind(document,"mouseup",BX.proxy(this.OnMouseUp,this));BX.addCustomEvent(this.editor,"OnIframeMouseUp",BX.proxy(this.OnMouseUp,this))}},Close:function(){var p=this;this.popupShownTimeout=setTimeout(function(){p.editor.popupShown=false},300);BX.removeClass(this.pCont,this.activeClassName);this.pValuesCont.style.display="none";this.editor.overlay.Hide();BX.unbind(window,"keydown",BX.proxy(this.OnKeyDown,this));BX.unbind(document,"mousedown",BX.proxy(this.CheckClose,this));BX.onCustomEvent(this,"OnPopupClose");this.bOpened=false},CheckClose:function(p){if(!this.bOpened){return BX.unbind(document,"mousedown",BX.proxy(this.CheckClose,this))}var q;if(p.target){q=p.target}else{if(p.srcElement){q=p.srcElement}}if(q.nodeType==3){q=q.parentNode}if(!BX.findParent(q,{className:"bxhtmled-popup"})){this.Close()}},Open:function(){this.editor.popupShown=true;if(this.popupShownTimeout){this.popupShownTimeout=clearTimeout(this.popupShownTimeout)}document.body.appendChild(this.pValuesCont);this.pValuesCont.style.display="block";BX.addClass(this.pCont,this.activeClassName);var q=this.editor.overlay.Show({zIndex:this.zIndex-1}),p=this.GetPopupBindCont(),u=BX.pos(p),s=Math.round(u.left-this.pValuesCont.offsetWidth/2+p.offsetWidth/2+this.posOffset.left),r=Math.round(u.bottom+this.posOffset.top),t=this;BX.bind(window,"keydown",BX.proxy(this.OnKeyDown,this));q.onclick=function(){t.Close()};this.pValuesCont.style.top=r+"px";this.pValuesCont.style.left=s+"px";this.bOpened=true;setTimeout(function(){BX.bind(document,"mousedown",BX.proxy(t.CheckClose,t))},100)},SelectItem:function(q,p){if(!p){p=this.arValues[this.valueIndex[q]]}if(this.lastActiveItem){BX.removeClass(this.lastActiveItem,this.activeListClassName)}if(p){if(p.listCont){this.lastActiveItem=p.listCont;BX.addClass(p.listCont,this.activeListClassName)}this.pCont.className=p.className;this.pCont.title=BX.util.htmlspecialchars(p.title||p.name||"")}else{this.pCont.className=this.className;this.pCont.title=this.title}if(this.disabled){this.disabled=false;this.Disable(true)}return p},SetValue:function(){},GetValue:function(){}};function f(p){f.superclass.constructor.apply(this,arguments);this.className="bxhtmled-top-bar-select";this.itemClassName="bxhtmled-dd-list-item";this.activeListClassName="bxhtmled-dd-list-item-active";this.disabledForTextarea=true}BX.extend(f,b);f.prototype.Create=function(){this.pCont=BX.create("SPAN",{props:{className:this.className,title:this.title},attrs:{unselectable:"on"},text:""});if(this.width){this.pCont.style.width=this.width+"px"}this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-dropdown-list-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dd-list-wrap"}}));this.valueIndex={};if(this.zIndex){this.pValuesCont.style.zIndex=this.zIndex}var p,s,u=this,t,r,q;for(r=0;r<this.arValues.length;r++){s=this.arValues[r];t=this.itemClassName;if(s.className){t+=" "+s.className}q=s.tagName?("<"+s.tagName+">"+s.name+"</"+s.tagName+">"):s.name;p=this.pValuesContWrap.appendChild(BX.create("SPAN",{props:{title:s.title||s.name,className:t},html:q,style:s.style}));p.setAttribute("data-bx-dropdown-value",s.id);this.valueIndex[s.id]=r;if(s.defaultValue){this.SelectItem(null,s)}if(s.action){p.setAttribute("data-bx-type","action");p.setAttribute("data-bx-action",s.action);if(s.value){p.setAttribute("data-bx-value",s.value)}}BX.bind(p,"mousedown",function(v){if(!v){v=window.event}u.SelectItem(this.getAttribute("data-bx-dropdown-value"));u.editor.CheckCommand(this)});this.arValues[r].listCont=p}if(this.action&&this.checkableAction){this.editor.RegisterCheckableAction(this.action,{action:this.action,control:this})}BX.bind(this.pCont,"click",BX.proxy(this.OnClick,this))};f.prototype.SelectItem=function(p,r,q){q=q!==false;if(!r){r=this.arValues[this.valueIndex[p]]}if(this.lastActiveItem){BX.removeClass(this.lastActiveItem,this.activeListClassName)}if(r){this.pCont.innerHTML=BX.util.htmlspecialchars((r.topName||r.name||r.id));this.pCont.title=this.title+": "+BX.util.htmlspecialchars(r.title||r.name);if(r.listCont){this.lastActiveItem=r.listCont;BX.addClass(r.listCont,this.activeListClassName)}}if(this.bOpened&&q){this.Close()}};f.prototype.SetValue=function(q,p){};f.prototype.SetWidth=function(p){p=parseInt(p,10);if(p){this.width=p;this.pCont.style.width=p+"px"}};f.prototype.Disable=function(p){if(p!=this.disabled){this.disabled=!!p;if(p){BX.addClass(this.pCont,"bxhtmled-top-bar-select-disabled")}else{BX.removeClass(this.pCont,"bxhtmled-top-bar-select-disabled")}}};function k(p,q){this.values=[];this.pInput=q.input;this.editor=p;this.value=q.value||"";this.defaultValue=q.defaultValue||"";this.posOffset={top:8,left:-4};this.zIndex=3010;this.SPLIT_SYMBOL=",";this.itemClassName="bxhtmled-dd-list-item";this.itemClassNameActive="bxhtmled-dd-list-item-active"}k.prototype={Init:function(){BX.bind(this.pInput,"focus",BX.proxy(this.Focus,this));BX.bind(this.pInput,"click",BX.proxy(this.Focus,this));BX.bind(this.pInput,"blur",BX.proxy(this.Blur,this));BX.bind(this.pInput,"keyup",BX.proxy(this.KeyUp,this));this.visibleItemsLength=this.values.length;this.currentItem=false},UpdateValues:function(p){this.bCreated=false;this.values=p;this.visibleItemsLength=this.values.length;this.currentItem=false;if(this.bOpened){this.ClosePopup()}},Create:function(){this.pValuesCont=BX.create("DIV",{props:{className:"bxhtmled-popup bxhtmled-combo-cont"},html:'<div class="bxhtmled-popup-corner"></div>'});this.pValuesCont.style.zIndex=this.zIndex;if(this.pValuesContWrap){BX.cleanNode(this.pValuesContWrap);this.pValuesCont.appendChild(this.pValuesContWrap)}else{this.pValuesContWrap=this.pValuesCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dd-list-wrap"}}));BX.bind(this.pValuesContWrap,"mousedown",function(w){var v=w.target||w.srcElement;if(!v.getAttribute("data-bx-dropdown-value")){v=BX.findParent(v,function(x){return x.getAttribute&&x.getAttribute("data-bx-dropdown-value")},u.pValuesContWrap)}if(v){u.currentItem=parseInt(v.getAttribute("data-bx-dropdown-value"),10);u.SetValueFromList()}u.ClosePopup()})}this.valueIndex={};var p,s,u=this,t,r,q;for(r=0;r<this.values.length;r++){s=this.values[r];t=this.itemClassName||"";this.values[r].TITLE=this.values[r].TITLE||this.values[r].NAME;if(this.values[r].VALUE&&this.values[r].VALUE!==this.values[r].TITLE){this.values[r].TITLE+=" ("+this.values[r].VALUE+")"}else{this.values[r].VALUE=this.values[r].NAME}p=this.pValuesContWrap.appendChild(BX.create("SPAN",{props:{className:t},html:s.TITLE}));p.setAttribute("data-bx-dropdown-value",r);this.values[r].cont=p}this.bCreated=true},KeyUp:function(q){var p=q.keyCode;if(p==this.editor.KEY_CODES.down){this.SelectItem(1)}else{if(p==this.editor.KEY_CODES.up){this.SelectItem(-1)}else{if(p==this.editor.KEY_CODES.escape){if(this.bOpened){this.ClosePopup();return BX.PreventDefault(q)}}else{if(p==this.editor.KEY_CODES.enter){if(this.bOpened){this.SetValueFromList();this.ClosePopup();return BX.PreventDefault(q)}}else{this.FilterValue()}}}}},FilterValue:function(){var q,s,r=this.GetSplitedValues(),p=this.GetCaretPos(this.pInput);for(q=0;q<r.length;q++){s=r[q];if(p>=s.start&&p<=s.end){break}}this.FilterAndHighlight(s.value)},GetSplitedValues:function(){var v,r,p,s,u,q=[],t=this.pInput.value;if(t.indexOf(this.SPLIT_SYMBOL)===-1||this.bMultiple===false){q.push({start:0,end:t.length,value:BX.util.trim(t)})}else{v=t.split(this.SPLIT_SYMBOL);p=0;s=0;for(r=0;r<v.length;r++){u=v[r];s+=u.length+r;q.push({start:p,end:s,value:BX.util.trim(u)});p=s}}return q},FilterAndHighlight:function(q){q=BX.util.trim(q);var r,p,t=false,s;this.visibleItemsLength=0;for(p=0;p<this.values.length;p++){r=this.values[p];if(q===""){t=true;r.cont.style.display="";this.visibleItemsLength++}else{s=r.TITLE.toLowerCase().indexOf(q.toLowerCase());if(s!==-1||q==""){r.cont.innerHTML=BX.util.htmlspecialchars(r.TITLE.substr(0,s))+"<b>"+BX.util.htmlspecialchars(q)+"</b>"+BX.util.htmlspecialchars(r.TITLE.substr(s+q.length));t=true;r.cont.style.display="";r.cont.setAttribute("data-bx-dropdown-value",this.visibleItemsLength);this.visibleItemsLength++}else{r.cont.innerHTML=BX.util.htmlspecialchars(r.TITLE);r.cont.style.display="none"}}}this.currentItem=false;if(t&&!this.bOpened){this.ShowPopup()}else{if(!t&&this.bOpened){this.ClosePopup()}}},GetCaretPos:function(q){var r=0;if(document.selection){BX.focus(q);var p=document.selection.createRange();p.moveStart("character",-q.value.length);r=p.text.length}else{if(q.selectionStart||q.selectionStart=="0"){r=q.selectionStart}}return(r)},SetValue:function(p){this.pInput.value=p},SetValueFromList:function(){var s=0,r,u;for(u=0;u<this.values.length;u++){r=this.values[u];if(r.cont.style.display!="none"){if(s==this.currentItem){BX.addClass(r.cont,this.itemClassNameActive);break}s++}}var x,q=this.GetSplitedValues(),v=this.GetCaretPos(this.pInput);for(u=0;u<q.length;u++){x=q[u];if(v>=x.start&&v<=x.end){break}}var w=this.SPLIT_SYMBOL==" "?" ":this.SPLIT_SYMBOL+" ",t=this.pInput.value,y=t.substr(0,x.start),p=t.substr(x.end);y=y.replace(/^[\s\r\n\,]+/g,"").replace(/[\s\r\n\,]+$/g,"");p=p.replace(/^[\s\r\n\,]+/g,"").replace(/[\s\r\n\,]+$/g,"");this.pInput.value=y+(y==""?"":w)+r.VALUE+(p==""?"":w)+p;this.FilterAndHighlight("")},SelectItem:function(u){var s,t,q,p;if(this.currentItem===false){this.currentItem=0}else{if(u!==undefined){this.currentItem+=u;if(this.currentItem>this.visibleItemsLength-1){this.currentItem=0}else{if(this.currentItem<0){this.currentItem=this.visibleItemsLength-1}}}}if(document.querySelectorAll){var r=this.pValuesContWrap.querySelectorAll("."+this.itemClassNameActive);if(r){for(q=0;q<r.length;q++){BX.removeClass(r[q],this.itemClassNameActive)}}}s=0;p=this.values.length;for(q=0;q<this.values.length;q++){t=this.values[q];if(t.cont.style.display!="none"){if(s==this.currentItem){BX.addClass(t.cont,this.itemClassNameActive);break}s++}}},Focus:function(p){if(this.values.length>0&&!this.bFocused){BX.focus(this.pInput);this.bFocused=true;if(this.value==this.defaultValue){this.value=""}this.ShowPopup()}},Blur:function(){if(this.values.length>0&&this.bFocused){this.bFocused=false;this.ClosePopup()}},ShowPopup:function(){if(!this.bCreated){this.Create()}this.editor.popupShown=true;if(this.popupShownTimeout){this.popupShownTimeout=clearTimeout(this.popupShownTimeout)}document.body.appendChild(this.pValuesCont);this.pValuesCont.style.display="block";var p,t=BX.pos(this.pInput),s=t.left+this.posOffset.left,r=t.bottom+this.posOffset.top;this.pValuesCont.style.top=r+"px";this.pValuesCont.style.left=s+"px";this.bOpened=true;if(document.querySelectorAll){var q=this.pValuesContWrap.querySelectorAll("."+this.itemClassNameActive);if(q){for(p=0;p<q.length;p++){BX.removeClass(q[p],this.itemClassNameActive)}}}BX.onCustomEvent(this,"OnComboPopupOpen")},ClosePopup:function(){var p=this;this.popupShownTimeout=setTimeout(function(){p.editor.popupShown=false},300);this.pValuesCont.style.display="none";this.editor.overlay.Hide();this.bOpened=false;BX.onCustomEvent(this,"OnComboPopupClose")},OnChange:function(){},CheckClose:function(p){if(!this.bOpened){return BX.unbind(document,"mousedown",BX.proxy(this.CheckClose,this))}var q;if(p.target){q=p.target}else{if(p.srcElement){q=p.srcElement}}if(q.nodeType==3){q=q.parentNode}if(!BX.findParent(q,{className:"bxhtmled-popup"})){this.Close()}}};function o(p,q){o.superclass.constructor.apply(this,arguments);this.filterTag=q.filterTag||"";this.lastTemplateId=this.editor.GetTemplateId();this.values=this.GetClasses();this.SPLIT_SYMBOL=" ";this.Init()}BX.extend(o,k);o.prototype.OnChange=function(){if(this.lastTemplateId!=this.editor.GetTemplateId()){this.lastTemplateId=this.editor.GetTemplateId();this.values=this.GetClasses();this.bCreated=false}};o.prototype.GetClasses=function(){var r,q=this.editor.GetCurrentCssClasses(this.filterTag);this.values=[];if(q&&q.length>0){for(var p=0;p<q.length;p++){r=null;if(q[p].classTitle&&typeof q[p].classTitle=="object"){if(q[p].classTitle.title){r=q[p].classTitle.title}else{continue}}else{if(q[p].classTitle){r=q[p].classTitle}}this.values.push({VALUE:q[p].className,TITLE:r,NAME:q[p].className})}}return this.values};function m(p){this.editor=p;if(this.editor.config.pasteSetColors!==this.editor.config.pasteSetBorders||this.editor.config.pasteSetColors!==this.editor.config.pasteSetDecor){this.mode="default"}else{this.mode=this.editor.config.pasteSetColors&&this.editor.config.pasteSetBorders&&this.editor.config.pasteSetDecor?"text":"rich"}var q=this;this.items=[];if(this.mode=="default"){this.items=[{TEXT:BX.message("BXEdPasteDefault"),ACTION:function(){q.Hide("default")},CHECKED:this.mode=="default",_MODE:"default"}]}this.items.push({TEXT:BX.message("BXEdPasteText"),ACTION:function(){q.Hide("text")},CHECKED:this.mode=="text",_MODE:"text"});this.items.push({TEXT:BX.message("BXEdPasteFormattedText"),ACTION:function(){q.Hide("rich")},CHECKED:this.mode=="rich",_MODE:"rich"});BX.addCustomEvent("OnComponentParamsDisplay",BX.proxy(this.Hide,this))}m.prototype={CheckAndShow:function(){var p=this.isOpened,q=this;this.savedRange=this.editor.selection.GetBookmark();this.isOpened=true;this.lastPreviewMode=false;if(this.checkTimeout){this.checkTimeout=clearTimeout(this.checkTimeout)}this.checkTimeout=setTimeout(function(){var r=q.editor.skipPasteHandler;q.editor.skipPasteHandler=true;q.PreviewContent({mode:"rich",doTimeout:false,skipColors:true});var t=q.editor.iframeView.GetValue();t=t.replace(/<img((?:\s|\S)*?)>/ig,"");t=t.replace(/id="(\s|\S)*?"/ig,"");t=t.replace(/\s+/ig," ");q.PreviewContent({mode:"text",doTimeout:false});var s=q.editor.iframeView.GetValue();s=s.replace(/<img((?:\s|\S)*?)>/ig,"");s=s.replace(/id="(\s|\S)*?"/ig,"");s=s.replace(/\s+/ig," ");if(t!=s){q.isOpened=p;q.editor.SetCursorNode(q.savedRange);q.Show()}q.editor.skipPasteHandler=r},200)},Show:function(){var y=this;this.lastPreviewMode=false;this.Hide();this.pOverlay=this.editor.overlay.Show();BX.bind(this.pOverlay,"click",BX.proxy(this.Hide,this));BX.bind(this.pOverlay,"mousemove",BX.proxy(function(){this.PreviewContent({mode:"default"})},this));if(!this.dummyTarget){this.dummyTarget=this.editor.dom.iframeCont.appendChild(BX.create("DIV",{props:{className:"bxhtmled-dummy-target"}}))}var q=this.editor.GetIframeElement("bx-cursor-node"),A=0,t=0,u;if(q){if(q.parentNode){A+=q.offsetHeight;u=q;do{A+=u.offsetTop||0;t+=u.offsetLeft||0;u=u.offsetParent}while(u&&u.nodeName!="BODY")}}var r=BX.GetWindowScrollPos(this.editor.GetIframeDoc());A-=r.scrollTop;t-=r.scrollLeft;var v=this.editor.GetSceletonSize(),x=v.height-this.items.length*40,p=v.width-100;if(A<0){A=0}else{if(A>x){A=x}}if(t<0){t=0}else{if(t>p){t=p}}this.dummyTarget.style.left=t+"px";this.dummyTarget.style.top=A+"px";this.dummyTarget.style.zIndex="2002";this.OPENER=new BX.COpener({DIV:this.dummyTarget,MENU:this.items,TYPE:"click",ACTIVE_CLASS:"adm-btn-active",CLOSE_ON_CLICK:true});this.OPENER.Open();var s=this.OPENER.GetMenu().DIV;s.style.zIndex="3005";BX.addClass(s,"bxhtmled-paste-control bx-core-popup-menu-editor");BX.addCustomEvent(this.OPENER.GetMenu(),"onMenuClose",BX.proxy(this.Hide,this));var w,z=BX.findChild(s,{className:"bx-core-popup-menu-item"},1,1);for(w=0;w<z.length;w++){z[w].setAttribute("data-bx-mode",this.items[w]._MODE)}BX.bind(s,"mousemove",function(C){var B=C.target||C.srcElement,D=(B&&B.getAttribute)?B.getAttribute("data-bx-mode"):null;if(!D){B=BX.findParent(B,function(E){return E==s||(E.getAttribute&&E.getAttribute("data-bx-mode"))},s);D=(B&&B.getAttribute)?B.getAttribute("data-bx-mode"):null}y.PreviewContent({mode:D})});this.isOpened=true;BX.addCustomEvent(this.editor,"OnIframeKeydown",BX.CMenu.broadcastCloseEvent);BX.bind(document.body,"keydown",BX.CMenu.broadcastCloseEvent)},Hide:function(p){if(this.isOpened){this.editor.overlay.Hide();if(this.pOverlay){BX.unbind(this.pOverlay,"click",BX.proxy(this.Hide,this));BX.unbind(this.pOverlay,"mousemove",BX.proxy(this.PreviewContent,this))}BX.removeCustomEvent(this.editor,"OnIframeKeydown",BX.CMenu.broadcastCloseEvent);BX.unbind(document.body,"keydown",BX.CMenu.broadcastCloseEvent);if(!p||typeof p!=="string"||(p!=="text"&&p!=="rich")){p="default"}this.PreviewContent({mode:p});this.editor.Focus();this.editor.On("OnIframePaste");this.editor.On("OnIframeNewWord");this.isOpened=false}},PreviewContent:function(p){if(this.isOpened){if(this.lastPreviewMode!=p.mode||!this.lastPreviewMode){if(p.doTimeout!==false){p.doTimeout=false;var q=this;if(this.previewTimeout){clearTimeout(this.previewTimeout)}this.previewTimeout=setTimeout(function(){q.PreviewContent(p)},200);return}if(p.mode=="rich"){this.editor.config.pasteSetColors=!!p.skipColors;this.editor.config.pasteSetBorders=false;this.editor.config.pasteSetDecor=false}else{if(p.mode=="text"){this.editor.config.pasteSetColors=true;this.editor.config.pasteSetBorders=true;this.editor.config.pasteSetDecor=true}else{this.editor.config.pasteSetColors=this.defPasteSetColors;this.editor.config.pasteSetBorders=this.defPasteSetBorders;this.editor.config.pasteSetDecor=this.defPasteSetDecor}}this.editor.pasteHandleMode=true;this.editor.bbParseContentMode=true;this.editor.synchro.lastIframeValue=false;this.editor.iframeView.SetValue(this.pastedContent,false);this.editor.synchro.FromIframeToTextarea(true,true);this.editor.pasteHandleMode=false;this.editor.bbParseContentMode=false;this.editor.synchro.lastTextareaValue=false;this.editor.synchro.FromTextareaToIframe(true);this.editor.RestoreCursor();this.editor.skipPasteHandler=false;if(p.mode!="default"){this.editor.config.pasteSetColors=this.defPasteSetColors;this.editor.config.pasteSetBorders=this.defPasteSetBorders;this.editor.config.pasteSetDecor=this.defPasteSetDecor}}this.lastPreviewMode=p.mode}},SaveIframeContent:function(p){this.defPasteSetColors=this.editor.config.pasteSetColors;this.defPasteSetBorders=this.editor.config.pasteSetBorders;this.defPasteSetDecor=this.editor.config.pasteSetDecor;this.pastedContent=p}};function h(){window.BXHtmlEditor.TaskbarManager=a;window.BXHtmlEditor.Taskbar=d;window.BXHtmlEditor.ComponentsControl=e;window.BXHtmlEditor.ContextMenu=n;window.BXHtmlEditor.Dialog=l;window.BXHtmlEditor.Toolbar=j;window.BXHtmlEditor.NodeNavigator=g;window.BXHtmlEditor.Button=i;window.BXHtmlEditor.DropDown=b;window.BXHtmlEditor.DropDownList=f;window.BXHtmlEditor.ComboBox=k;window.BXHtmlEditor.ClassSelector=o;window.BXHtmlEditor.Overlay=c;window.BXHtmlEditor.PasteControl=m;BX.onCustomEvent(window.BXHtmlEditor,"OnEditorBaseControlsDefined")}if(window.BXHtmlEditor){h()}else{BX.addCustomEvent(window,"OnBXHtmlEditorInit",h)}})();