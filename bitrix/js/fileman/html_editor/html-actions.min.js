(function(){function a(b){this.editor=b;this.document=b.sandbox.GetDocument();BX.addCustomEvent(this.editor,"OnIframeReInit",BX.proxy(function(){this.document=this.editor.sandbox.GetDocument()},this));this.actions=this.GetActionList();this.contentActionIndex={removeFormat:1,bold:1,italic:1,underline:1,strikeout:1,fontSize:1,foreColor:1,backgroundColor:1,formatInline:1,formatBlock:1,createLink:1,insertHTML:1,insertImage:1,insertLineBreak:1,removeLink:1,insertOrderedList:1,insertUnorderedList:1,align:1,indent:1,outdent:1,formatStyle:1,fontFamily:1,universalFormatStyle:1,quote:1,code:1,sub:1,sup:1,insertSmile:1}}a.prototype={IsSupportedByBrowser:function(e){var d=BX.browser.IsIE()||BX.browser.IsIE10()||BX.browser.IsIE11(),c={indent:d,outdent:d,formatBlock:d,insertUnorderedList:BX.browser.IsIE()||BX.browser.IsOpera(),insertOrderedList:BX.browser.IsIE()||BX.browser.IsOpera()},b={insertHTML:BX.browser.IsFirefox()};if(!c[e]){try{return this.document.queryCommandSupported(e)}catch(g){}try{return this.document.queryCommandEnabled(e)}catch(f){return !!b[e]}}return false},IsSupported:function(b){return !!this.actions[b]},IsContentAction:function(b){return this.contentActionIndex[b]},Exec:function(c,i,j){var f=this,h=this.actions[c],b=h&&h.exec,d=this.IsContentAction(c),k=null;if(!j){this.editor.On("OnBeforeCommandExec",[d,c,h,i])}if(d){this.editor.Focus(false)}if(b){k=b.apply(h,arguments)}else{try{k=this.document.execCommand(c,false,i)}catch(g){}}if(d){setTimeout(function(){f.editor.Focus(false)},1)}if(!j){this.editor.On("OnAfterCommandExec",[d,c])}return k},CheckState:function(d,c){var g=this.actions[d],b=null;if(g&&g.state){b=g.state.apply(g,arguments)}else{try{b=this.document.queryCommandState(d)}catch(f){b=false}}return b},GetValue:function(d){var c=this.commands[d],f=c&&c.value;if(f){return f.call(c,this.composer,d)}else{try{return this.document.queryCommandValue(d)}catch(b){return null}}},GetActionList:function(){this.actions={changeView:this.GetChangeView(),splitMode:this.GetChangeSplitMode(),fullscreen:this.GetFullscreen(),changeTemplate:this.GetChangeTemplate(),removeFormat:this.GetRemoveFormat(),bold:this.GetBold(),italic:this.GetItalic(),underline:this.GetUnderline(),strikeout:this.GetStrikeout(),fontSize:this.GetFontSize(),foreColor:this.GetForeColor(),backgroundColor:this.GetBackgroundColor(),formatInline:this.GetFormatInline(),formatBlock:this.GetFormatBlock(),createLink:this.GetCreateLink(),insertHTML:this.GetInsertHTML(),insertImage:this.GetInsertImage(),insertLineBreak:this.GetInsertLineBreak(),insertTable:this.GetInsertTable(),removeLink:this.GetRemoveLink(),insertHr:this.GetInsertHr(),insertOrderedList:this.GetInsertList({bOrdered:true}),insertUnorderedList:this.GetInsertList({bOrdered:false}),align:this.GetAlign(),indent:this.GetIndent(),outdent:this.GetOutdent(),formatStyle:this.GetFormatStyle(),fontFamily:this.GetFontFamily(),universalFormatStyle:this.GetUniversalFormatStyle(),selectNode:this.GetSelectNode(),doUndo:this.GetUndoRedo(true),doRedo:this.GetUndoRedo(false),sub:this.GetSubSup("sub"),sup:this.GetSubSup("sup"),quote:this.GetQuote(),code:this.GetCode(),insertSmile:this.GetInsertSmile(),tableOperation:this.GetTableOperation(),formatBbCode:this.GetFormatBbCode()};this.editor.On("OnGetActionsList");return this.actions},GetChangeView:function(){var b=this;return{exec:function(){var c=arguments[1];if({code:1,wysiwyg:1,split:1}[c]){b.editor.SetView(c)}},state:function(){return false},value:function(){}}},GetChangeSplitMode:function(){var b=this;return{exec:function(){b.editor.SetSplitMode(arguments[1]==1)},state:function(){return b.editor.GetSplitMode()},value:function(){}}},GetFullscreen:function(){var b=this;return{exec:function(){b.editor.Expand()},state:function(){return b.editor.IsExpanded()},value:function(){}}},GetFormatInline:function(){var f=this,e={strong:"b",em:"i",b:"strong",i:"em"},d={};function b(j,m,k){var h=j+":";if(k){h+=k}if(m){for(var g in m){if(m.hasOwnProperty(g)){h+=g+"="+m[g]+";"}}}return h}function c(j,m,k){var i=b(j,m,k);if(!d[i]){var h=e[j];var g=h?[j.toLowerCase(),h.toLowerCase()]:[j.toLowerCase()];d[i]=new f.editor.HTMLStyler(f.editor,g,m,k,true)}return d[i]}return{exec:function(o,k,j,m,g,n){n=(!n||typeof n!="object")?{}:n;f.editor.iframeView.Focus();var h=f.editor.selection.GetRange();if(!h){return false}var i=c(j,m,g);if(n.bClear){h=i.UndoToRange(h,false)}else{h=i.ToggleRange(h)}setTimeout(function(){f.editor.selection.SetSelection(h);var x,u,s,q,r,w=[],v=[],p=h.getNodes([1]);for(u=0;u<p.length;u++){if(BX.util.in_array(p[u].nodeName,["TD","TR","TH"])){x=BX.findParent(p[u],function(y){return y.nodeName=="TABLE"},f.editor.GetIframeDoc().body);if(x&&!BX.util.in_array(x,w)){w.push(x)}}}for(u=0;u<w.length;u++){x=w[u];for(s=0;s<x.rows.length;s++){for(q=0;q<x.rows[s].childNodes.length;q++){r=x.rows[s].childNodes[q];if(r&&r.nodeType==1&&!BX.util.in_array(r.nodeName,f.editor.TABLE_TAGS)){v.push(r)}}}}for(u=0;u<v.length;u++){BX.cleanNode(v[u],true)}var t=f.editor.selection.GetSelectedNode();if(t&&t.nodeType==1){f.editor.lastCreatedId=Math.round(Math.random()*1000000);t.setAttribute("data-bx-last-created-id",f.editor.lastCreatedId)}},10)},state:function(h,o,g,i,p){var n=f.editor.GetIframeDoc(),m=e[g]||g;if(!f.editor.util.DocumentHasTag(n,g)&&(g!=m&&!f.editor.util.DocumentHasTag(n,m))){return false}var j=f.editor.selection.GetRange();if(!j){return false}var k=c(g,i,p);return k.IsAppliedToRange(j,false)},value:BX.DoNothing}},GetFormatBlock:function(){var i=this,o="DIV",j=i.editor.GetBlockTags(),e=i.editor.NESTED_BLOCK_TAGS;function k(p,q,r){if(p.className){d(p,r);p.className+=" "+q}else{p.className=q}}function d(p,q){p.className=p.className.replace(q,"")}function f(q){var r=i.editor.util.GetNextNotEmptySibling(q),p=i.editor.util.GetPreviousNotEmptySibling(q);if(r&&!h(r)){q.parentNode.insertBefore(i.document.createElement("BR"),r)}if(p&&!h(p)){q.parentNode.insertBefore(i.document.createElement("BR"),q)}}function m(q){var r=i.editor.util.GetNextNotEmptySibling(q),p=i.editor.util.GetPreviousNotEmptySibling(q);if(r&&r.nodeName==="BR"){r.parentNode.removeChild(r)}if(p&&p.nodeName==="BR"){p.parentNode.removeChild(p)}}function c(q){var p=q.lastChild;if(p&&p.nodeName==="BR"){p.parentNode.removeChild(p)}}function h(p){return p.nodeName==="BR"||i.editor.util.IsBlockElement(p)}function b(r,s,q,p){if(q||p){}i.document.execCommand(r,false,s)}function n(p){return !p.className||BX.util.trim(p.className)===""}function g(r,q,p,s){if(q){if(r.nodeName!==q){r=i.editor.util.RenameNode(r,q)}if(p){r.className=p}if(s&&s.length>0){i.editor.util.SetCss(r,s)}}else{f(r);i.editor.util.ReplaceWithOwnChildren(r)}}return{exec:function(s,p,q,F,K){K=K||{};p=typeof p==="string"?p.toUpperCase():p;var L,E,D,A=K.range||i.editor.selection.GetRange(),u=p?i.actions.formatBlock.state(s,p,q,F):false,H;if(K.range){i.editor.selection.RestoreBookmark()}if(u){var v=A.startContainer==u.firstChild&&A.endContainer==u.lastChild;if(p&&BX.util.in_array(p,e)&&K.nestedBlocks!==false){u=i.document.createElement(p||o);if(q){u.className=q}i.editor.selection.Surround(u);i.editor.selection.SelectNode(u);i.editor.util.SetCss(u,F);var J=i.editor.util.GetNextNotEmptySibling(u);if(J&&J.nodeName=="BR"){BX.remove(J)}setTimeout(function(){if(u){i.editor.selection.SelectNode(u)}},50)}else{if(K&&K.splitBlock&&!v){var I=i.document.createElement(p||o);i.editor.selection.Surround(I);i.editor.selection.SelectNode(I);if(q){I.className=q}i.editor.util.SetCss(I,F);if(u&&u.lastChild){var r=A.cloneRange();r.setStartAfter(I);r.setEndAfter(u.lastChild);var w=u.cloneNode(false);i.editor.selection.SetSelection(r);i.editor.selection.Surround(w);var N=i.editor.selection._GetNonTextFirstChild(w);if(N&&N.nodeName=="BR"){BX.remove(N)}}i.editor.selection.SetSelection(A);setTimeout(function(){if(I){i.editor.selection.SelectNode(I)}},50)}else{i.editor.util.SetCss(u,F);if(q){u.className=q;if(BX.browser.IsFirefox()){var y="bx-editor-temp-"+Math.round(Math.random()*1000000);u.id=y;u.parentNode.innerHTML=u.parentNode.innerHTML;u=i.editor.GetIframeElement(y);if(u){u.removeAttribute("id")}}}setTimeout(function(){if(u){i.editor.selection.SelectNode(u)}},50)}}}else{if(p===null||BX.util.in_array(p,j)){u=false;H=i.editor.selection.GetSelectedNode();if(H){if(H.nodeType==1&&BX.util.in_array(H.nodeName,j)){u=H}else{u=BX.findParent(H,function(O){return BX.util.in_array(O.nodeName,j)},i.document.body)}}else{var t=i.editor.selection.GetCommonAncestorForRange(A);if(t&&t.nodeName!=="BODY"&&BX.util.in_array(t.nodeName,j)){u=t}}if(u&&!i.actions.quote.checkNode(u)){i.editor.selection.ExecuteAndRestoreSimple(function(){g(u,p,q,F)});return true}}u=BX.create(p||o,{},i.document);if(q){u.className=q}i.editor.util.SetCss(u,F);if(A.collapsed||H&&H.nodeType==3){i.editor.selection.SelectNode(H)}else{if(A.collapsed){i.editor.selection.SelectLine()}}i.editor.selection.Surround(u,A);m(u);c(u);if(K.leaveChilds){return u}if(p&&!BX.util.in_array(p,e)){A=i.editor.selection.GetRange();D=A.getNodes([1]);if(p=="P"){L=u.getElementsByTagName(p);for(E=0;E<D.length;E++){if(F&&i.editor.util.CheckCss(D[E],F,false)&&i.editor.util.IsEmptyNode(D[E],true,true)){BX.remove(D[E])}}while(L[0]){f(L[0]);i.editor.util.ReplaceWithOwnChildren(L[0])}}else{if(p.substr(0,1)=="H"){for(E=0;E<D.length;E++){if(D[E].nodeName!==p&&i.editor.util.IsEmptyNode(D[E],true,true)){BX.remove(D[E])}}var B=BX.findChild(u,function(O){return BX.util.in_array(O.nodeName,j)&&O.nodeName.substr(0,1)=="H"},true,true);for(E=0;E<B.length;E++){f(B[E]);i.editor.util.ReplaceWithOwnChildren(B[E])}}}}if(u&&K.bxTagParams&&typeof K.bxTagParams=="object"){i.editor.SetBxTag(u,K.bxTagParams)}if(u&&u.parentNode){var x=u.parentNode;if(x.nodeName=="UL"||x.nodeName=="OL"){var z=i.editor.util.GetPreviousNotEmptySibling(u);if(i.editor.util.IsEmptyLi(z)){BX.remove(z)}z=i.editor.util.GetNextNotEmptySibling(u);if(i.editor.util.IsEmptyLi(z)){BX.remove(z)}if(!i.editor.util.GetPreviousNotEmptySibling(u)&&!i.editor.util.GetNextNotEmptySibling(u)){var G=u.cloneNode(false);x.parentNode.insertBefore(G,x);i.editor.util.ReplaceWithOwnChildren(u);G.appendChild(x)}}if(u.firstChild&&u.firstChild.nodeName=="BLOCKQUOTE"){var C=i.editor.util.GetPreviousNotEmptySibling(u);if(C&&C.nodeName=="BLOCKQUOTE"&&i.editor.util.IsEmptyNode(C)){BX.remove(C)}}if((u.nodeName=="BLOCKQUOTE"||u.nodeName=="PRE")&&i.editor.util.IsEmptyNode(u)){u.innerHTML="";var M=i.document.createElement("br");u.appendChild(M);i.editor.selection.SetAfter(M)}}setTimeout(function(){if(u){i.editor.selection.SelectNode(u)}},10);return true}},state:function(v,w,t,s){w=typeof(w)==="string"?w.toUpperCase():w;var p=false,u=i.editor.selection.GetSelectedNode();if(u&&u.nodeName){if(u.nodeName!=w){u=BX.findParent(u,function(x){return x.nodeName==w},i.document.body)}p=(u&&u.tagName==w)?u:false}else{var q=i.editor.selection.GetRange(),r=i.editor.selection.GetCommonAncestorForRange(q);if(r.nodeName==w){p=r}}return p},value:BX.DoNothing,removeBrBeforeAndAfter:m,addBrBeforeAndAfter:f}},GetRemoveFormat:function(){var c={B:1,STRONG:1,I:1,EM:1,U:1,DEL:1,S:1,STRIKE:1,A:1,SPAN:1,CODE:1,NOBR:1,Q:1,FONT:1,CENTER:1,CITE:1},d={H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,DIV:1,P:1,LI:1,UL:1,OL:1,MENU:1,BLOCKQUOTE:1,PRE:1},h=this;function k(m,n){if(!m){return}var o=m.nodeName;if(c[o]){h.editor.util.ReplaceWithOwnChildren(m)}else{if(d[o]){h.actions.formatBlock.addBrBeforeAndAfter(m);h.editor.util.ReplaceWithOwnChildren(m)}else{m.removeAttribute("style");m.removeAttribute("class");m.removeAttribute("align");if(h.editor.bbCode&&m.nodeName=="TABLE"){m.removeAttribute("align")}}}}function i(m){return BX.findParent(m,function(o){return o.nodeName=="TABLE"},h.editor.GetIframeDoc().body)}function b(p){var m,o,n=p.parentNode;while(n&&n.nodeName!=="BODY"){m=n.previousSibling&&!h.editor.util.IsEmptyNode(n.previousSibling);o=n.nextSibling&&!h.editor.util.IsEmptyNode(n.nextSibling);if(m||o||n.parentNode.nodeName=="BODY"){break}n=n.parentNode}return n}function e(o){var s=h.editor.GetIframeDoc(),q=BX.findParent(o,function(u){return u.nodeName=="UL"||u.nodeName=="OL"||u.nodeName=="MENU"},s.body);if(q){var n,t,r=q.cloneNode(false),m=q.cloneNode(false),p=true;BX.cleanNode(r);BX.cleanNode(m);for(n=0;n<q.childNodes.length;n++){t=q.childNodes[n];if(t==o){p=false}if(t.nodeName=="LI"){if(!h.editor.util.IsEmptyNode(t,true,true)){(p?r:m).appendChild(t.cloneNode(true))}}}if(r.childNodes.length>0){q.parentNode.insertBefore(r,q)}q.parentNode.insertBefore(o,q);if(m.childNodes.length>0){q.parentNode.insertBefore(m,q)}BX.remove(q);return true}return false}function f(o,q){if(o&&o.length>0){var p,m,n=[];for(p=0,m=o.length;p<m;p++){if(!h.editor.util.CheckSurrogateNode(o[p])){n.push({node:o[p],nesting:h.editor.util.GetNodeDomOffset(o[p])})}}n=n.sort(function(s,r){return r.nesting-s.nesting});for(p=0,m=n.length;p<m;p++){k(n[p].node,q)}}}function j(p){var o,q=false,n=h.editor.selection.SelectNode(p),m=n.getNodes([1]);if(p.nodeType==1){for(o=0;o<m.length;o++){if(m[o]==p){q=true;break}}if(!q){m=[p].concat(m)}}if(!m||typeof m!="object"||m.length==0){m=[p]}return m}function g(n,m){var o=[];if(n&&(!m||n==m)){o.push(n)}else{if(!n&&m){o.push(m)}}return o}return{exec:function(y,v){var s=h.editor.selection.GetRange();if(!s||h.editor.iframeView.IsEmpty()){return}var C=true,A,o,t,x,B,u=s.getNodes([1]),D=h.editor.GetIframeDoc();if(u.length==0){o=s.getNodes([3]);if(o&&o.length==1){t=o[0]}if(!t&&s.startContainer==s.endContainer){if(s.startContainer.nodeType==3){t=s.startContainer}else{C=false;u=j(s.startContainer)}}if(t&&u.length==0){x=b(t);if(x&&(x.nodeName!="BODY"||s.collapsed)){C=false;u=j(x)}}}else{var w=false,q=[],p=i(s.startContainer),r=i(s.endContainer);if(p){q.push({startContainer:s.startContainer,startOffset:s.startOffset,end:p});s.setStartAfter(p);w=true}if(r){w=true;q.push({start:r,endContainer:s.endContainer,endOffset:s.endOffset});s.setEndBefore(r)}var m=h.editor.util.FindParentEx(s.startContainer,function(E){return E.nodeName=="UL"||E.nodeName=="OL"||E.nodeName=="MENU"},D.body),z=h.editor.util.FindParentEx(s.endContainer,function(E){return E.nodeName=="UL"||E.nodeName=="OL"||E.nodeName=="MENU"},D.body);if(m){s.setStartBefore(m);if(!z){s.setEndAfter(m)}w=true}if(z){w=true;s.setEndAfter(z);if(!m){s.setStartBefore(z)}}if(w){h.editor.selection.SetSelection(s);u=s.getNodes([1])}}if(C){B=D.createElement("span");h.editor.selection.Surround(B,s);u=j(B)}if(u&&u.length>0){h.editor.selection.ExecuteAndRestoreSimple(function(){f(u,D)})}if(q&&q.length>0){var n=s.cloneRange();for(A=0;A<q.length;A++){if(q[A].start){n.setStartBefore(q[A].start)}else{n.setStart(q[A].startContainer,q[A].startOffset)}if(q[A].end){n.setEndAfter(q[A].end)}else{n.setEnd(q[A].endContainer,q[A].endOffset)}h.editor.selection.SetSelection(n);f(n.getNodes([1]),D)}h.editor.selection.SetSelection(s)}if(C&&B&&B.parentNode){if(e(B)){h.editor.selection.SelectNode(B)}h.editor.selection.ExecuteAndRestoreSimple(function(){h.editor.util.ReplaceWithOwnChildren(B)})}if(!h.editor.iframeView.IsEmpty(true)){h.actions.formatBlock.exec("formatBlock",null)}},state:BX.DoNothing,value:BX.DoNothing}},GetBold:function(){var b=this;return{exec:function(d,c){if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){return b.actions.formatInline.exec(d,c,"b")}else{return b.actions.formatBbCode.exec(d,{tag:"B"})}},state:function(d,c){return b.actions.formatInline.state(d,c,"b")},value:BX.DoNothing}},GetItalic:function(){var b=this;return{exec:function(d,c){if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){return b.actions.formatInline.exec(d,c,"i")}else{return b.actions.formatBbCode.exec(d,{tag:"I"})}},state:function(d,c){return b.actions.formatInline.state(d,c,"i")},value:BX.DoNothing}},GetUnderline:function(){var b=this;return{exec:function(d,c){if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){return b.actions.formatInline.exec(d,c,"u")}else{return b.actions.formatBbCode.exec(d,{tag:"U"})}},state:function(d,c){return b.actions.formatInline.state(d,c,"u")},value:BX.DoNothing}},GetStrikeout:function(){var b=this;return{exec:function(d,c){if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){return b.actions.formatInline.exec(d,c,"del")}else{return b.actions.formatBbCode.exec(d,{tag:"S"})}},state:function(d,c){return b.actions.formatInline.state(d,c,"del")},value:BX.DoNothing}},GetFontSize:function(){var b=this;return{exec:function(e,d){var c;if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){if(d>0){c=b.actions.formatInline.exec(e,d,"span",{fontSize:d+"pt"})}else{c=b.actions.formatInline.exec(e,d,"span",{fontSize:null},null,{bClear:true})}}else{c=b.actions.formatBbCode.exec(e,{tag:"SIZE",value:d+"pt"})}return c},state:function(d,c){return b.actions.formatInline.state(d,c,"span",{fontSize:c+"pt"})},value:BX.DoNothing}},GetForeColor:function(){var d=this;function c(){var k=d.editor.GetIframeDoc(),h,j,g=[],f=d.editor.selection.GetRange();if(f){var e=f.getNodes([1]);if(e.length==0&&f.startContainer==f.endContainer&&f.startContainer.nodeName!="BODY"){e=[f.startContainer]}for(h=0;h<e.length;h++){j=BX.findParent(e[h],function(i){return i.nodeName=="LI"&&i.style&&i.style.color},k.body);if(j){g.push(j)}}}return g.length===0?false:g}function b(o){var n=d.editor.GetIframeDoc(),f=d.editor.selection.GetSelectedNode(),h,g,m,k,p,q,e;if(f&&(f.nodeType===3||f.nodeName=="SPAN")){p=f.nodeName=="SPAN"?f:BX.findParent(f,{tag:"span"},n.body);if(p&&p.style.color){q=BX.findParent(p,{tag:"li"},n.body);if(q){if(q.childNodes.length==1&&q.firstChild==p){d.editor.selection.ExecuteAndRestoreSimple(function(){q.style.color=o;p.style.color="";if(BX.util.trim(p.style.cssText)==""){d.editor.util.ReplaceWithOwnChildren(p)}})}}}}else{if(!f){k=d.editor.selection.GetRange();e=k.getNodes([1])}else{e=[f]}for(h=0;h<e.length;h++){if(e[h]&&e[h].nodeName=="LI"&&!d.editor.bbCode){e[h].style.color=o;m=BX.findChild(e[h],function(i){return i.nodeName=="SPAN"},true,true);d.editor.selection.ExecuteAndRestoreSimple(function(){for(g=0;g<m.length;g++){if(m[g]&&m[g].parentNode&&m[g].parentNode.parentNode&&m[g].parentNode.parentNode.parentNode){try{m[g].style.color="";if(BX.util.trim(m[g].style.cssText)==""){d.editor.util.ReplaceWithOwnChildren(m[g])}}catch(i){}}}})}}}}return{exec:function(g,f){var e;if(!d.editor.bbCode||!d.editor.synchro.IsFocusedOnTextarea()){if(f==""){e=d.actions.formatInline.exec(g,f,"span",{color:null},null,{bClear:true})}else{e=d.actions.formatInline.exec(g,f,"span",{color:f});b(f)}}else{if(f){e=d.actions.formatBbCode.exec(g,{tag:"COLOR",value:f})}}return e},state:function(g,f){var e=d.actions.formatInline.state(g,f,"span",{color:f});if(!e){e=c()}return e},value:BX.DoNothing}},GetBackgroundColor:function(){var b=this;return{exec:function(e,d){var c;if(d==""){c=b.actions.formatInline.exec(e,d,"span",{backgroundColor:null},null,{bClear:true})}else{c=b.actions.formatInline.exec(e,d,"span",{backgroundColor:d})}return c},state:function(d,c){return b.actions.formatInline.state(d,c,"span",{backgroundColor:c})},value:BX.DoNothing}},GetCreateLink:function(){var b=["title","id","name","target","rel"],c=this;return{exec:function(f,r){if(c.editor.bbCode&&c.editor.synchro.IsFocusedOnTextarea()){c.editor.textareaView.Focus();var q="[URL="+c.editor.util.spaceUrlEncode(r.href)+"]"+(r.text||r.href)+"[/URL]";c.editor.textareaView.WrapWith(false,false,q)}else{c.editor.iframeView.Focus();var g,e=(r&&typeof(r)==="object")?r:{href:r},j,p,n=0,m,s;function t(u,v){var i;u.removeAttribute("class");u.removeAttribute("target");for(i in v){if(v.hasOwnProperty(i)&&BX.util.in_array(i,b)){if(v[i]==""||v[i]==undefined){u.removeAttribute(i)}else{u.setAttribute(i,v[i])}}}if(v.className){u.className=v.className}u.href=c.editor.util.spaceUrlEncode(v.href)||"";if(v.noindex){u.setAttribute("data-bx-noindex","Y")}else{u.removeAttribute("data-bx-noindex")}}s=r.node?[r.node]:c.actions.formatInline.state(f,r,"a");if(s){for(j=0;j<s.length;j++){p=s[j];if(p){t(p,e);m=p;n++}}if(n===1&&m&&(m.querySelector&&!m.querySelector("*"))&&e.text!=""){c.editor.util.SetTextContent(m,e.text)}g=m;if(g){c.editor.selection.SetAfter(g)}setTimeout(function(){if(g){c.editor.selection.SetAfter(g)}},10)}else{var o="_bx-editor-temp-"+Math.round(Math.random()*1000000),d,h,k;c.actions.formatInline.exec(f,r,"A",false,o);if(c.document.querySelectorAll){s=c.document.querySelectorAll("A."+o)}else{s=[]}for(j=0;j<s.length;j++){p=s[j];if(p){t(p,e)}}g=p;if(s.length===1){k=c.editor.util.GetTextContent(p);h=k===""||k===c.editor.INVISIBLE_SPACE;if(k!=e.text){c.editor.util.SetTextContent(p,e.text||e.href)}if(p.querySelector&&!p.querySelector("*")&&h){c.editor.util.SetTextContent(p,e.text||e.href)}}if(p){if(p.nextSibling&&p.nextSibling.nodeType==3&&c.editor.util.IsEmptyNode(p.nextSibling)){d=p.nextSibling}else{d=c.editor.util.GetInvisibleTextNode()}c.editor.util.InsertAfter(d,p);g=d}if(g){c.editor.selection.SetAfter(g)}setTimeout(function(){if(g){c.editor.selection.SetAfter(g)}},10)}}},state:function(e,d){return c.actions.formatInline.state(e,d,"a")},value:BX.DoNothing}},GetRemoveLink:function(){var b=this;return{exec:function(g,f){b.editor.iframeView.Focus();var d,e,c;if(f&&typeof f=="object"){c=f}else{c=b.actions.formatInline.state(g,f,"a")}if(c){b.editor.selection.ExecuteAndRestoreSimple(function(){for(d=0;d<c.length;d++){e=c[d];if(e){b.editor.util.ReplaceWithOwnChildren(c[d])}}})}},state:function(d,c){},value:BX.DoNothing}},GetInsertHTML:function(){var b=this;return{exec:function(d,c){b.editor.iframeView.Focus();if(b.IsSupportedByBrowser(d)){b.document.execCommand(d,false,c)}else{b.editor.selection.InsertHTML(c)}},state:function(){return false},value:BX.DoNothing}},GetInsertImage:function(){var b=["title","alt","width","height","align"],c=this;return{exec:function(i,k){if(k.src==""){return}k.src=c.editor.util.spaceUrlEncode(k.src);if(c.editor.bbCode&&c.editor.synchro.IsFocusedOnTextarea()){c.editor.textareaView.Focus();var o="";if(k.width){o+=" WIDTH="+parseInt(k.width)}if(k.height){o+=" HEIGHT="+parseInt(k.height)}var e="[IMG"+o+"]"+k.src+"[/IMG]";c.editor.textareaView.WrapWith(false,false,e);return}c.editor.iframeView.Focus();var h=(k&&typeof(k)==="object")?k:{src:k},g=k.image||c.actions.insertImage.state(i,k),f,d;function n(r,s){var p,q;r.removeAttribute("class");r.setAttribute("data-bx-orig-src",s.src||"");for(p in s){if(s.hasOwnProperty(p)&&BX.util.in_array(p,b)){if(s[p]==""||s[p]==undefined){r.removeAttribute(p)}else{q=r.getAttribute("data-bx-app-ex-"+p);if(!q||c.editor.phpParser.AdvancedPhpGetFragmentByCode(q,true)!=s[p]){r.setAttribute(p,s[p]);if(q){r.removeAttribute("data-bx-app-ex-"+p)}}}}}if(s.className){r.className=s.className}q=r.getAttribute("data-bx-app-ex-src");if(!q||c.editor.phpParser.AdvancedPhpGetFragmentByCode(q,true)!=s.src){r.src=s.src||"";if(q){r.removeAttribute("data-bx-app-ex-src")}}}if(!g){g=c.document.createElement("IMG");n(g,h);c.editor.selection.InsertNode(g)}else{n(g,h)}var j=g,m=(g.parentNode&&g.parentNode.nodeName=="A")?g.parentNode:null;if(h.link){if(m){m.href=h.link}else{m=c.document.createElement("A");m.href=h.link;g.parentNode.insertBefore(m,g);m.appendChild(g)}j=m}else{if(m){c.editor.util.ReplaceWithOwnChildren(m)}}if(BX.browser.IsIE()){c.editor.selection.SetAfter(g);d=g.nextSibling;if(d&&d.nodeType==3&&c.editor.util.IsEmptyNode(d)){f=d}else{f=c.editor.util.GetInvisibleTextNode()}c.editor.selection.InsertNode(f);j=f}c.editor.selection.SetAfter(j);c.editor.util.Refresh()},state:function(){var d,e,f;if(!c.editor.util.DocumentHasTag(c.document,"IMG")){return false}d=c.editor.selection.GetSelectedNode();if(!d){return false}if(d.nodeName==="IMG"){return d}if(d.nodeType!==1){return false}e=BX.util.trim(c.editor.selection.GetText());if(e&&e!=c.editor.INVISIBLE_SPACE){return false}f=c.editor.selection.GetNodes(1,function(g){return g.nodeName==="IMG"});if(f.length!==1){return false}return f[0]},value:BX.DoNothing}},GetInsertLineBreak:function(){var c=this,b="<br>"+(BX.browser.IsOpera()?" ":"");return{exec:function(d){if(c.IsSupportedByBrowser(d)){c.document.execCommand(d,false,null)}else{c.actions.insertHTML.exec("insertHTML",b)}if(BX.browser.IsChrome()||BX.browser.IsSafari()||BX.browser.IsIE10()){c.editor.selection.ScrollIntoView()}},state:BX.DoNothing,value:BX.DoNothing}},GetInsertHr:function(){var c=this,b="<hr>"+(BX.browser.IsOpera()?" ":"");return{exec:function(d){c.actions.insertHTML.exec("insertHTML",b);if(BX.browser.IsChrome()||BX.browser.IsSafari()||BX.browser.IsIE10()){c.editor.selection.ScrollIntoView()}},state:BX.DoNothing,value:BX.DoNothing}},GetInsertTable:function(){var f=this,c=["title","id","border","cellSpacing","cellPadding","align"];function e(h){var g=f.document.createElement("TH");while(h.firstChild){g.appendChild(h.firstChild)}f.editor.util.ReplaceNode(h,g)}function b(g){var h=f.document.createElement("TD");while(g.firstChild){h.appendChild(g.firstChild)}f.editor.util.ReplaceNode(g,h)}function d(j,m){var h;j.removeAttribute("class");for(h in m){if(m.hasOwnProperty(h)&&BX.util.in_array(h,c)){if(m[h]===""||m[h]==undefined){j.removeAttribute(h)}else{j.setAttribute(h,m[h])}}}if(m.className){j.className=m.className}j.removeAttribute("data-bx-no-border");if(j.getAttribute("border")==0||!j.getAttribute("border")){j.removeAttribute("border");j.setAttribute("data-bx-no-border","Y")}if(m.width){if(parseInt(m.width)==m.width){m.width=m.width+"px"}if(j.getAttribute("width")){j.setAttribute("width",m.width)}else{j.style.width=m.width}}if(m.height){if(parseInt(m.height)==m.height){m.height=m.height+"px"}if(j.getAttribute("height")){j.setAttribute("height",m.height)}else{j.style.height=m.height}}var i,n,k;for(i=0;i<j.rows.length;i++){for(n=0;n<j.rows[i].cells.length;n++){k=j.rows[i].cells[n];if(((m.headers=="top"||m.headers=="topleft")&&i==0)||((m.headers=="left"||m.headers=="topleft")&&n==0)){e(k)}else{if(k.nodeName=="TH"){b(k)}}}}var g=BX.findChild(j,{tag:"CAPTION"},false);if(m.caption){if(g){g.innerHTML=BX.util.htmlspecialchars(m.caption)}else{g=f.document.createElement("CAPTION");g.innerHTML=BX.util.htmlspecialchars(m.caption);j.insertBefore(g,j.firstChild)}}else{if(g){BX.remove(g)}}}return{exec:function(n,m){if(!f.editor.bbCode||!f.editor.synchro.IsFocusedOnTextarea()){if(!m||!m.rows||!m.cols){return false}f.editor.iframeView.Focus();var w=m.table||f.actions.insertTable.state(n,m);m.rows=parseInt(m.rows)||1;m.cols=parseInt(m.cols)||1;if(m.align=="left"||f.editor.bbCode){m.align=""}if(!w){w=f.document.createElement("TABLE");var t=w.appendChild(f.document.createElement("TBODY")),g,u,x,v;m.rows=parseInt(m.rows)||1;m.cols=parseInt(m.cols)||1;for(g=0;g<m.rows;g++){x=t.insertRow(-1);for(u=0;u<m.cols;u++){v=BX.adjust(x.insertCell(-1),{html:"&nbsp;"})}}d(w,m);f.editor.selection.InsertNode(w);var k=f.editor.util.GetNextNotEmptySibling(w);if(!k){f.editor.util.InsertAfter(BX.create("BR",{},f.document),w)}if(k&&k.nodeName=="BR"&&!k.nextSibling){f.editor.util.InsertAfter(f.editor.util.GetInvisibleTextNode(),k)}}else{d(w,m)}var p=w.rows[0].cells[0].firstChild;if(p){f.editor.selection.SetAfter(p)}setTimeout(function(){f.editor.util.Refresh(w)},10)}else{f.editor.textareaView.Focus();var s="",q,o,h=f.editor.INVISIBLE_SPACE;if(m.rows>0&&m.cols>0){s+="[TABLE]\n";for(q=0;q<m.rows;q++){s+="\t[TR]\n";for(o=0;o<m.cols;o++){s+="\t\t[TD]"+h+"[/TD]\n"}s+="\t[/TR]\n"}s+="[/TABLE]\n"}f.editor.textareaView.WrapWith(false,false,s)}},state:function(j,i){var h,g;if(!f.editor.util.DocumentHasTag(f.document,"TABLE")){return false}h=f.editor.selection.GetSelectedNode();if(!h){return false}if(h.nodeName==="TABLE"){return h}if(h.nodeType!==1){return false}g=f.editor.selection.GetNodes(1,function(k){return k.nodeName==="TABLE"});if(g.length!==1){return false}return g[0]},value:BX.DoNothing}},GetInsertList:function(g){var j=this;var h=!!g.bOrdered,m=h?"OL":"UL",c=h?"UL":"OL";function d(p){var q=p.nextSibling;while(q&&q.nodeType==3&&j.editor.util.IsEmptyNode(q,true)){q=q.nextSibling}return q}function k(t){if(t.nodeName!=="MENU"&&t.nodeName!=="UL"&&t.nodeName!=="OL"){return}var w=j.document.createDocumentFragment(),r=t.previousSibling,u,q,v,p;if(r&&!j.editor.util.IsBlockElement(r)&&!j.editor.util.IsEmptyNode(r,true)){w.appendChild(j.document.createElement("BR"))}while(p=t.firstChild){q=p.lastChild;while(u=p.firstChild){if(u.nodeName=="I"&&u.innerHTML==""&&u.className!=""){BX.remove(u);u=p.firstChild;if(!u){break}}v=u===q&&!j.editor.util.IsBlockElement(u)&&u.nodeName!=="BR";w.appendChild(u);if(v){w.appendChild(j.document.createElement("BR"))}}p.parentNode.removeChild(p)}var s=j.editor.util.GetNextNotEmptySibling(t);if(s&&s.nodeName=="BR"&&w.lastChild&&w.lastChild.nodeName=="BR"){BX.remove(w.lastChild)}t.parentNode.replaceChild(w,t)}function o(r,s){if(!r||!r.parentNode){return false}var u=r.nodeName.toUpperCase();if(u==="UL"||u==="OL"||u==="MENU"){return r}var t=j.document.createElement(s),q,p;while(r.firstChild){p=p||t.appendChild(j.document.createElement("li"));q=r.firstChild;if(j.editor.util.IsBlockElement(q)){p=p.firstChild?t.appendChild(j.document.createElement("li")):p;p.appendChild(q);p=null;continue}if(q.nodeName==="BR"){p=p.firstChild?null:p;r.removeChild(q);continue}p.appendChild(q)}r.parentNode.replaceChild(t,r);return t}function b(p){return p.nodeName=="OL"||p.nodeName=="UL"||p.nodeName=="MENU"}function f(A,q){if(!q){q=j.editor.selection.GetSelectedNode()}if(!q||q.nodeName=="BODY"){var v=j.editor.selection.GetRange(),z=j.editor.selection.GetCommonAncestorForRange(v);if(z&&b(z)){q=z}else{var t,u=true,w,y,p=v.getNodes([1]),r=p.length;if(z){w=y=BX.findParent(z,b,j.document.body)}if(!y){for(t=0;t<r;t++){y=BX.findParent(p[t],b,z);if(!y||(w&&y!=w)){u=false;break}w=y}}if(!w){var s=false;for(t=0;t<r;t++){if(b(p[t])){s=p[t];break}}if(s){var x=true;for(t=0;t<r;t++){if(p[t]==s||BX.findParent(p[t],function(B){return B===s},j.document.body)||p[t].nodeName=="BR"||j.editor.util.IsEmptyNode(p[t])){}else{x=false;break}}if(x){w=s}}}if(w){q=w}}}return q&&q.nodeName==A?q:BX.findParent(q,{tagName:A},j.document.body)}function e(t,p){if(!t){return false}if(!p){p={tag:"I",remove:true}}var r,s,q,u=t.ownerDocument;for(r=0;r<t.childNodes.length;r++){s=t.childNodes[r];if(s&&s.nodeType==1&&s.nodeName=="LI"){q=s.firstChild;if(q.nodeName==p.tag&&q.innerHTML==""){if(p.remove){BX.remove(q)}else{q.className=p.className}}else{s.insertBefore(BX.create(p.tag,{props:{className:p.className}},u),q)}}}}function i(s){if(!s){return false}var q,r,p;for(q=0;q<s.childNodes.length;q++){r=s.childNodes[q];if(r&&r.nodeType==1&&r.nodeName=="LI"){p=r.firstChild;if(p&&p.nodeName=="I"&&p.innerHTML==""&&p.className!==""){return p.className}}}return false}function n(u,w,r){if(u&&(u.nodeName=="UL"||u.nodeName=="OL")){var q,t,p,v=u.ownerDocument,s;for(q=0;q<u.childNodes.length;q++){t=u.childNodes[q];if(t&&t.nodeType==1&&t.nodeName=="LI"&&t.firstChild){p=t.firstChild;if(p.nodeName=="I"&&p.innerHTML==""&&p.className!==""){if(!w){w=p.className}}else{if(p.nodeName=="I"&&p.innerHTML==""&&w){p.className=w;s=p}else{if(p&&w){s=t.insertBefore(BX.create("I",{props:{className:w}},v),p)}}}}}if(r&&s){j.editor.selection._MoveCursorAfterNode(s)}}}return{exec:function(s,r){if(!j.editor.bbCode||!j.editor.synchro.IsFocusedOnTextarea()){var x=j.editor.selection.GetRange();if(j.IsSupportedByBrowser(s)&&x.collapsed){j.document.execCommand(s,false,null)}else{var y=j.editor.selection.GetSelectedNode(),z=f(m,y),A=f(c,y),w,p;if(z){j.editor.selection.ExecuteAndRestoreSimple(function(){k(z)})}else{if(A){j.editor.selection.ExecuteAndRestoreSimple(function(){j.editor.util.RenameNode(A,m)})}else{p=j.document.createElement("span");j.editor.selection.Surround(p);w=p.innerHTML===""||p.innerHTML===j.editor.INVISIBLE_SPACE;j.editor.selection.ExecuteAndRestoreSimple(function(){var D,C=p.getElementsByTagName("SPAN");for(D=C.length-1;D>=0;D--){if(!C[D].className&&!C[D].id&&!C[D].style.cssText){j.editor.util.ReplaceWithOwnChildren(C[D])}}z=o(p,m)});if(z){var v=0,B;while(v<z.childNodes.length){B=z.childNodes[v];if(B.nodeName=="LI"){if(j.editor.util.IsEmptyNode(B,true,true)){BX.remove(B);continue}v++}else{if(B.nodeType==1){BX.remove(B)}}}var q=j.editor.util.GetPreviousNotEmptySibling(z);if(q&&(q.nodeName=="BLOCKQUOTE"||q.nodeName=="PRE"||q.nodeName=="UL"||q.nodeName=="OL")&&z.childNodes[0]&&BX.findChild(z.childNodes[0],{tag:q.nodeName})){if(BX.util.trim(j.editor.util.GetTextContent(q))==""){BX.remove(q)}}}if(w&&z&&z.querySelector){j.editor.selection.SelectNode(z.querySelector("li"))}}}}}else{if(r&&r.items){j.editor.textareaView.Focus();var u="[LIST"+(h?"=1":"")+"]\n",t;for(t=0;t<r.items.length;t++){u+="\t[*]"+r.items[t]+"\n"}u+="[/LIST]\n";j.editor.textareaView.WrapWith(false,false,u)}}},state:function(){return f(m)||false},value:BX.DoNothing,customBullit:e,getCustomBullitClass:i,checkCustomBullitList:n}},GetAlign:function(){var q="bx-align-tmp",d="data-bx-checked-align-list",p="left",o={TD:1,TR:1,TH:1,TABLE:1,TBODY:1,CAPTION:1,COL:1,COLGROUP:1,TFOOT:1,THEAD:1},e={IMG:1,P:1,DIV:1,TABLE:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1},k=this;function g(v){var u=v.nodeName,t,s=false;if(v.nodeType===1){t=v.style.textAlign;if(v.style.textAlign){s={node:v,style:t}}if(e[u]){t=v.getAttribute("align");if(t){if(s){s.attribute=t}else{s={node:v,attribute:t}}}}}return s}function h(s){return s&&(s.nodeName=="TD"||s.nodeName=="TH")}function r(t,s){t.setAttribute("data-bx-tmp-align",s);t.style.textAlign=s}function b(t,s){if(s=="left"||s=="justify"||k.editor.bbCode){t.removeAttribute("align")}else{t.setAttribute("align",s)}}function m(w,x){var s,u,t=true,v=w.getElementsByTagName("TD");for(u=0;u<v.length;u++){if(v[u].getAttribute("data-bx-tmp-align")!=x){t=false;break}}if(t){s=w.getElementsByTagName("TH");for(u=0;u<s.length;u++){if(s[u].getAttribute("data-bx-tmp-align")!=x){t=false;break}}}if(t){b(w,x)}}function n(t,u){var s=BX.create("DIV",{style:{textAlign:u},html:t.innerHTML},k.editor.GetIframeDoc());t.innerHTML="";t.appendChild(s);return s}function c(t,u){var s=BX.create("DIV",{style:{textAlign:u}},k.editor.GetIframeDoc());t.parentNode.insertBefore(s,t);s.appendChild(t);return s}function j(x,v,w){var y=k.editor.GetIframeDoc(),z=k.editor.bbCode;if(!x&&v){x=BX.findParent(v,function(A){return A.nodeName=="OL"||A.nodeName=="UL"||A.nodeName=="MENU"},y)}if(x&&!x.getAttribute(d)){var u,t=true,s=x.getElementsByTagName("LI");for(u=0;u<s.length;u++){if(s[u].style.textAlign!==w){t=false;break}}if(z){x.style.textAlign="";if(x.style.cssText==""){x.removeAttribute("style")}i(x);c(x,w)}else{if(t){x.style.textAlign=w;i(x)}}x.setAttribute(d,"Y");return x}return false}function i(u){var t,s=u.getElementsByTagName("LI");for(t=0;t<s.length;t++){s[t].style.textAlign="";if(s[t].style.cssText==""){s[t].removeAttribute("style")}}}function f(s,v){if(v&&v.nodeName=="TABLE"){var t,u=false;for(t=0;t<s.length;t++){if(s[t]==v){u=true;break}}if(!u){s.push(v)}}return s}return{exec:function(N,M){var W;if(!k.editor.bbCode||!k.editor.synchro.IsFocusedOnTextarea()){var Q,u="P",I=k.editor.selection.GetRange(),x=false,R=false,y=false,D=k.editor.selection.GetBookmark(),T=k.editor.selection.GetSelectedNode();if(T){if(k.editor.util.IsBlockNode(T)){x=T}else{if(T.nodeType==1&&o[T.nodeName]){R=T;W=true;setTimeout(function(){k.editor.selection.SelectNode(R);if(R.nodeName=="TABLE"){b(R,M)}},10)}else{if(T.nodeName=="LI"){y=T}else{if(T.nodeName=="OL"||T.nodeName=="UL"||T.nodeName=="MENU"){if(k.editor.bbCode){c(T,M);T.style.textAlign=""}else{T.style.textAlign=M}W=true;i(T);setTimeout(function(){k.editor.selection.SelectNode(T)},10)}else{y=BX.findParent(T,function(X){return X.nodeName=="LI"},k.document.body)}}if(y){if(k.editor.bbCode){n(y,M);y.style.textAlign=""}else{y.style.textAlign=M}W=true;setTimeout(function(){k.editor.selection.SelectNode(y)},10)}else{x=BX.findParent(T,function(X){return k.editor.util.IsBlockNode(X)&&!k.actions.quote.checkNode(X)},k.document.body)}}}}else{var F=[],H=false,V=[],v=[],L=I.getNodes([1]);for(Q=0;Q<L.length;Q++){if(h(L[Q])){F=f(F,BX.findParent(L[Q],{tagName:"TABLE"}));r(L[Q],M);W=true}if(L[Q].nodeName=="TABLE"){F=f(F,L[Q]);H=true}else{if(L[Q].nodeName=="OL"||L[Q].nodeName=="UL"||L[Q].nodeName=="MENU"){L[Q].style.textAlign=M;V.push(L[Q]);W=true}else{if(L[Q].nodeName=="LI"){L[Q].style.textAlign=M;W=true;v.push(L[Q])}}}}for(Q=0;Q<F.length;Q++){m(F[Q],M)}if(W){var w=k.editor.selection.GetCommonAncestorForRange(I);if(w&&w.nodeName=="BODY"){W=false}}for(Q=0;Q<V.length;Q++){i(V[Q])}var G=[],U;for(Q=0;Q<v.length;Q++){U=j(false,v[Q],M);if(U){G.push(U)}}for(Q=0;Q<G.length;Q++){G[Q].removeAttribute(d)}}if(!W){if(x){if(k.editor.bbCode){n(x,M);x.style.textAlign=""}else{u=x.tagName!="DIV"?x.tagName:"P";W=k.actions.formatBlock.exec("formatBlock",u,null,{textAlign:M})}k.editor.util.Refresh(x)}else{if(R){if(h(R)){r(R,M)}else{var P=BX.findChild(R,h,true,true),t=BX.findChild(R,h,true,true);for(Q=0;Q<P.length;Q++){r(P[Q],M)}for(Q=0;Q<t.length;Q++){r(t[Q],M)}}}else{if(I.collapsed){W=k.actions.formatBlock.exec("formatBlock","P",q,{textAlign:M});var C,A=k.document.querySelectorAll("."+q);for(Q=0;Q<=A.length;Q++){BX.removeClass(A[Q],q);if(Q==0){C=A[Q].firstNode;if(!C){C=A[Q].appendChild(k.editor.util.GetInvisibleTextNode())}setTimeout(function(){if(C){k.editor.selection.SetAfter(C)}},100)}}}else{var J=k.actions.insertImage.state();if(!W&&false){var S=true;L=I.getNodes([1]);if(L&&L.length>0){for(Q=0;Q<L.length;Q++){if(L[Q].nodeName=="P"){L[Q].style.textAlign=M}else{S=false}}W=S}}if(!W){u=k.editor.bbCode?"DIV":"P";W=k.actions.formatBlock.exec("formatBlock",u,null,{textAlign:M},{leaveChilds:true,splitBlock:true});if(W&&typeof W=="object"&&W.nodeName==u){var O=0,B=2000,K,z,E,s=false;if(W.firstChild&&W.firstChild.nodeName=="BLOCKQUOTE"){K=k.editor.util.GetPreviousNotEmptySibling(W);if(K&&K.nodeName=="BLOCKQUOTE"&&k.editor.util.IsEmptyNode(K)){BX.remove(K)}}Q=0;while(Q<W.childNodes.length||O>B){z=W.childNodes[Q];if(k.editor.util.IsBlockNode(z)){z.style.textAlign=M;s=true;Q++}else{if(!E||s){E=k.document.createElement(u);E.style.textAlign=M;W.insertBefore(E,z);Q++}E.appendChild(z);s=false}O++}if(W.previousSibling&&W.previousSibling.nodeName=="P"&&k.editor.util.IsEmptyNode(W.previousSibling,true,true)){BX.remove(W.previousSibling)}if(W.nextSibling&&W.nextSibling.nodeName=="P"&&k.editor.util.IsEmptyNode(W.nextSibling,true,true)){BX.remove(W.nextSibling)}k.editor.util.ReplaceWithOwnChildren(W);setTimeout(function(){if(E){k.editor.selection.SelectNode(E)}},100)}}if(J){k.editor.util.Refresh(J)}}}}}setTimeout(function(){k.editor.selection.SetBookmark(D)},10)}else{if(M){W=k.actions.formatBbCode.exec(N,{tag:M.toUpperCase()})}}return W},state:function(w,B){var x,u,A=k.editor.selection.GetSelectedNode();if(A){x=g(A);if(!x){u=BX.findParent(A,function(D){x=g(D);return x},k.document.body)}return{node:x?x.node:null,value:x?(x.style||x.attribute):p,res:x}}else{var C={node:null,value:p,res:true},z=k.editor.selection.GetRange();if(!z.collapsed){var t,v="",y,s=z.getNodes([1]);for(y=0;y<s.length;y++){if(!k.editor.util.CheckSurrogateNode(s[y])&&s[y].nodeName!=="BR"&&k.editor.util.GetNodeDomOffset(s[y])==0){t=g(s[y]);B=t?(t.style||t.attribute):p;if(!v){v=B}if(B!=v){C.res=false;break}}}if(C.res){C.value=v}}else{C.res=false}return C}},value:BX.DoNothing}},GetIndent:function(){var b=this;return{exec:function(j){var c=b.editor.selection.GetRange();if(c&&c.collapsed&&c.endContainer==c.startContainer&&BX.util.in_array(c.startContainer.nodeName,["TD","TR","TH"])&&arguments[1]!==c.startContainer.nodeName){var e="bxed_bogus_node_59811",h=c.startContainer.appendChild(BX.create("SPAN",{props:{id:e},html:"&nbsp;"},b.document));is_text=b.editor.util.GetInvisibleTextNode();if(h){c.setStartBefore(h);c.setEndAfter(h);b.editor.selection.SetSelection(c);return setTimeout(function(){b.actions.indent.exec(j,c.startContainer.nodeName);var i=b.editor.GetIframeElement(e);if(i){b.editor.selection.SetAfter(i);BX.remove(i)}},0)}}if(b.IsSupportedByBrowser(j)){b.document.execCommand(j)}else{b.actions.formatBlock.exec("formatBlock","BLOCKQUOTE")}var n=b.editor.selection.GetRange();if(n){var g=0,m,d=n.getNodes([1]);for(m=0;m<d.length;m++){if(d[m].nodeName=="BLOCKQUOTE"){g++;d[m].removeAttribute("style")}}if(n.startContainer){var k,o=false,f=n.startContainer;while(f){f=BX.findParent(f,{tag:"BLOCKQUOTE"},b.document.body);if(f){if(!o){o=f}f.removeAttribute("style")}}if(o){k=b.editor.util.GetInvisibleTextNode();o.appendChild(k);b.editor.selection.SetAfter(k)}}}},state:function(g,f){var e=false,c=b.editor.selection.GetRange();if(c){var d=b.editor.selection.GetCommonAncestorForRange(c);if(d&&d.nodeType==1&&d.nodeName==="BLOCKQUOTE"){e=d}}return e},value:BX.DoNothing}},GetOutdent:function(){var b=this;return{exec:function(j,h){var f,c="data-bx-tmp-flag",k=b.editor.GetIframeDoc(),e=k.getElementsByTagName("BLOCKQUOTE");var d=[],g=k.getElementsByTagName("P");for(f=0;f<g.length;f++){g[f].setAttribute(c,"Y")}b.document.execCommand(j);g=k.getElementsByTagName("P");for(f=0;f<g.length;f++){if(!g[f].getAttribute(c)){d.push(g[f])}else{g[f].removeAttribute(c)}}b.editor.selection.ExecuteAndRestoreSimple(function(){for(f=0;f<d.length;f++){b.actions.formatBlock.addBrBeforeAndAfter(d[f]);b.editor.util.ReplaceWithOwnChildren(d[f])}})},state:function(e,d){var c=b.editor.selection.GetRange();return false},value:BX.DoNothing}},GetFontFamily:function(){var b=this;return{exec:function(e,d){var c;if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){if(d){c=b.actions.formatInline.exec(e,d,"span",{fontFamily:d})}else{c=b.actions.formatInline.exec(e,d,"span",{fontFamily:null},null,{bClear:true})}}else{return b.actions.formatBbCode.exec(e,{tag:"FONT",value:d})}return c},state:function(d,c){return b.actions.formatInline.state(d,c,"span",{fontFamily:c})},value:BX.DoNothing}},GetFormatStyle:function(){var f=this,c=this.editor.toolbar.controls.StyleSelector,e=c?c.checkedClasses:[],d=c?c.checkedTags:[];function b(g){if(g&&g.nodeType==1&&g.nodeName!=="BODY"&&(BX.util.in_array(g.nodeName,d)||BX.util.in_array(g.className,e))){return !f.editor.GetBxTag(g.id).tag}return false}return{exec:function(m,k){if(!k){return f.actions.removeFormat.exec("removeFormat")}else{if(typeof k==="string"){return f.actions.formatBlock.exec("formatBlock",k)}else{if(typeof k==="object"){if(k.tag=="UL"){var j=f.actions.insertUnorderedList.state();if(j&&k.className&&k.className.indexOf("~~")!==-1){var o=k.className.split("~~");if(o&&o.length>=2){var h=o[0],n=o[1];j.className=h;f.actions.insertUnorderedList.customBullit(j,{tag:"I",className:n,html:""})}}else{if(j){j.className=k.className||"";f.actions.insertUnorderedList.customBullit(j,false)}}}else{if(k.tag){var i=k.className,g=k.tag.toUpperCase();if(g=="SPAN"){f.actions.formatInline.exec(m,k,g,false,i)}else{f.actions.formatBlock.exec("formatBlock",g,i,null,{nestedBlocks:false})}}}if(!f.editor.util.FirstLetterSupported()){f.editor.parser.FirstLetterCheckNodes("","",true)}}}}},state:function(m,k){var g=false,j=f.editor.selection.GetSelectedNode();if(j){if(b(j)){g=j}else{g=BX.findParent(j,b,f.document.body)}}else{var h=f.editor.selection.GetRange(),i=f.editor.selection.GetCommonAncestorForRange(h);if(b(i)){g=i}}return g},value:BX.DoNothing}},GetChangeTemplate:function(){var b=this;return{exec:function(d,c){b.editor.ApplyTemplate(c)},state:function(d,c){return b.editor.GetTemplateId()},value:BX.DoNothing}},GetSelectNode:function(){var b=this;return{exec:function(d,c){if(!b.editor.iframeView.IsFocused()){b.editor.iframeView.Focus()}if(c===false||(c&&c.nodeName=="BODY")){if(b.IsSupportedByBrowser("SelectAll")){b.document.execCommand("SelectAll")}else{b.editor.selection.SelectNode(c)}}else{b.editor.selection.SelectNode(c)}},state:BX.DoNothing,value:BX.DoNothing}},GetUndoRedo:function(b){var c=this;return{exec:function(d){if(d=="doUndo"){c.editor.undoManager.Undo()}else{if(d=="doRedo"){c.editor.undoManager.Redo()}}},state:BX.DoNothing,value:BX.DoNothing}},GetUniversalFormatStyle:function(){var d="bx-tmp-ufs-class",c="data-bx-tmp-status",g=this;function e(n){var j=[];if(n&&n.length>0){var o,h,m=[],p,k;for(o=0,h=n.length;o<h;o++){if(!g.editor.util.CheckSurrogateNode(n[o])&&n[o].nodeName!=="BR"){n[o].setAttribute(c,"Y");m.push({node:n[o],nesting:g.editor.util.GetNodeDomOffset(n[o])})}}m=m.sort(function(q,i){return q.nesting-i.nesting});for(o=0,h=m.length;o<h;o++){p=m[o].node;k=p.getAttribute(c);if(k=="Y"&&!f(p)){BX.findChild(p,function(i){if(i.nodeType==1&&i.nodeName!=="BR"&&i.setAttribute){i.setAttribute(c,i.className==d?"GET_RID_OF":"SKIP")}return false},true,true);j.push(p)}}}return j}function f(i){var h=BX.findChild(i,function(j){return j.nodeType==1&&j.nodeName!=="BR"&&j.getAttribute&&j.getAttribute(c)!=="Y"},true,false);return !!h}function b(j,i,h){try{if(i!==false){if(i==""){j.removeAttribute("class")}else{j.className=i}}if(h!==false){if(h==""){j.removeAttribute("style")}else{j.style.cssText=h}}}catch(k){}}return{exec:function(p,o){if(o.nodes&&o.nodes.length>0){for(j=0;j<o.nodes.length;j++){b(o.nodes[j],o.className,o.style)}}else{g.actions.formatInline.exec(p,o,"span",false,d);if(document.querySelectorAll){var n=g.editor.GetIframeDoc().querySelectorAll("."+d);if(n){for(j=0;j<n.length;j++){m=n[j];if(BX.util.trim(m.innerHTML)==""){g.editor.util.ReplaceWithOwnChildren(m)}}}}var j,m,h=g.actions.universalFormatStyle.state(p),k=e(h);for(j=0;j<k.length;j++){b(k[j],o.className,o.style)}if(document.querySelectorAll){n=g.editor.GetIframeDoc().querySelectorAll("."+d);if(n){for(j=0;j<n.length;j++){m=n[j];if(m.getAttribute(c)=="GET_RID_OF"){g.editor.util.ReplaceWithOwnChildren(n[j])}else{b(n[j],o.className,o.style)}}}}}},state:function(m){var i=g.editor.selection.GetRange();if(i){var k,n,j,h=i.getNodes([1]);if(h.length==0){k=i.getNodes([3]);if(k&&k.length==1){n=k[0]}if(!n&&i.startContainer==i.endContainer){if(i.startContainer.nodeType==3){n=i.startContainer}else{g.editor.selection.SelectNode(i.startContainer);h=[i.startContainer]}}if(n&&h.length==0){j=n.parentNode;if(j){h=[j]}}}return h}},value:BX.DoNothing}},GetSubSup:function(b){var c=this;b=b=="sup"?"sup":"sub";return{exec:function(e,d){return c.actions.formatInline.exec(e,d,b)},state:function(e,d){return c.actions.formatInline.state(e,d,b)},value:BX.DoNothing}},GetQuote:function(){var f,e,g=this;function h(k){return k&&k.className=="bxhtmled-quote"&&k.nodeName=="BLOCKQUOTE"}function c(k){e=k}function i(){return e}function j(k){return f=k}function d(n){n=n||g.editor.selection.GetRange(g.editor.selection.GetSelection(document));if(n){var m;if(n.startContainer==n.endContainer&&n.startOffset==0&&n.endOffset==n.endContainer.length&&n.startContainer.parentNode&&n.startContainer.parentNode.nodeName=="A"&&n.startContainer.parentNode.href){m=BX.create("DIV",{html:n.startContainer.parentNode.href},g.editor.GetIframeDoc())}else{var o=n.toHtml();o=o.replace(/<br.*?>/ig,"#BX_BR#");m=BX.create("DIV",{html:BX.util.htmlspecialchars(o)},g.editor.GetIframeDoc())}var k=g.editor.util.GetTextContentEx(m);k=k.replace(/#BX_BR#/ig,"<br>");c(k);BX.remove(m)}else{c("")}}function b(o){var n,m,k=o.querySelectorAll("blockquote.bxhtmled-quote");for(n=0;n<k.length;n++){m=k[n];if(m.nextSibling===null){g.editor.util.InsertAfter(g.editor.util.GetInvisibleTextNode(),m)}}}return{exec:function(n){var k=false,m=i();if(g.editor.bbCode&&g.editor.synchro.IsFocusedOnTextarea()){g.editor.textareaView.Focus();if(m){k=g.editor.textareaView.WrapWith(false,false,"[QUOTE]"+m+"[/QUOTE]")}else{k=g.actions.formatBbCode.exec(n,{tag:"QUOTE"})}}else{if(!f&&g.editor.selection.lastCheckedRange&&g.editor.selection.lastCheckedRange.range){f=g.editor.selection.lastCheckedRange.range}g.editor.iframeView.Focus();if(f){g.editor.selection.SetSelection(f)}if(m){var o="bxq_"+Math.round(Math.random()*1000000);g.editor.InsertHtml('<blockquote id="'+o+'" class="bxhtmled-quote">'+m+"</blockquote>"+g.editor.INVISIBLE_SPACE,f);setTimeout(function(){var p=g.editor.GetIframeElement(o);if(p){var q=p.previousSibling;if(q&&q.nodeType==3&&g.editor.util.IsEmptyNode(q)&&q.previousSibling&&q.previousSibling.nodeName=="BR"){BX.remove(q)}p.removeAttribute("id")}},0)}else{if(!f&&g.editor.selection.lastRange){f=g.editor.selection.lastRange}k=g.actions.formatBlock.exec("formatBlock","blockquote","bxhtmled-quote",false,{range:f})}if(!m){g.editor.selection.ScrollIntoView()}}f=null;return k},state:function(){return g.actions.formatBlock.state("formatBlock","blockquote","bxhtmled-quote")},value:BX.DoNothing,setExternalSelectionFromRange:d,setExternalSelection:c,getExternalSelection:i,checkSpaceAfterQuotes:b,setRange:j,checkNode:h}},GetCode:function(){var b=this;return{exec:function(e){if(!b.editor.bbCode||!b.editor.synchro.IsFocusedOnTextarea()){var d=b.actions.code.state();if(d){var c=BX.util.trim(d.innerHTML);if(c=="<br>"||c===""){b.editor.selection.SetAfter(d);BX.remove(d)}else{b.editor.selection.ExecuteAndRestoreSimple(function(){d.className="";d=b.editor.util.RenameNode(d,"P")})}}else{b.actions.formatBlock.exec("formatBlock","pre","bxhtmled-code")}}else{return b.actions.formatBbCode.exec(e,{tag:"CODE"})}},state:function(){return b.actions.formatBlock.state("formatBlock","pre","bxhtmled-code")},value:BX.DoNothing}},GetInsertSmile:function(){var b=this;return{exec:function(g,f){var c=b.editor.smilesIndex[f];if(b.editor.bbCode&&b.editor.synchro.IsFocusedOnTextarea()){b.editor.textareaView.Focus();b.editor.textareaView.WrapWith(false,false," "+c.code+" ")}else{b.editor.iframeView.Focus();if(c){var h=BX.create("IMG",{props:{src:c.path,title:c.name||c.code}},b.editor.iframeView.document);b.editor.SetBxTag(h,{tag:"smile",params:c});if(c.width){h.style.width=parseInt(c.width)+"px"}if(c.height){h.style.height=parseInt(c.height)+"px"}b.editor.selection.InsertNode(h);var d=b.editor.iframeView.document.createTextNode(" ");h.parentNode.insertBefore(d,h);var e=BX.create("SPAN",{html:"&nbsp;"},b.editor.iframeView.document);b.editor.util.InsertAfter(e,h);b.editor.selection.SetAfter(e);setTimeout(function(){b.editor.selection.SetAfter(e)},10)}}},state:BX.DoNothing,value:BX.DoNothing}},GetTableOperation:function(){var s=this,q="&nbsp;";function r(M){var N=M.rows;var D=[],H,L,G,K,F,J,E,I,C=-1;for(H=0;H<N.length;H++){C++;if(!D[C]){D[C]=[]}L=-1;for(G=0;G<N[H].cells.length;G++){K=N[H].cells[G];L++;while(D[C][L]){L++}E=isNaN(K.colSpan)?1:K.colSpan;I=isNaN(K.rowSpan)?1:K.rowSpan;for(F=0;F<I;F++){if(!D[C+F]){D[C+F]=[]}for(J=0;J<E;J++){D[C+F][L+J]=N[H].cells[G]}}L+=E-1}}return D}function z(E,G){var F,D,C=[];for(F=0;F<G.length;F++){for(D=0,l=G[F].length;D<l;D++){if(G[F][D]==E){C.push({r:F,c:D})}}}return C}function i(F){var E=[],G=[],C={cells:0},D;for(D=0;D<F.length;D++){C.cells++;C.maxRow=D===0?F[D].r:Math.max(F[D].r,C.maxRow);C.minRow=D===0?F[D].r:Math.min(F[D].r,C.minRow);C.maxCol=D===0?F[D].c:Math.max(F[D].c,C.maxCol);C.minCol=D===0?F[D].c:Math.min(F[D].c,C.minCol);if(!BX.util.in_array(F[D].r,E)){E.push(F[D].r)}if(!BX.util.in_array(F[D].c,G)){G.push(F[D].c)}}C.rows=E.length;C.cols=G.length;return C}function v(C,E,D){if(E){E=b(E,D);if(E&&!BX.util.in_array(E,C)){C.push(E)}}return C}function x(I,K){var L=[],J;if(BX.browser.IsFirefox()){var H,C,E,G,F=rangy.getNativeSelection(s.editor.sandbox.GetWindow());for(H=0;H<F.rangeCount;H++){C=F.getRangeAt(H);E=C.startContainer.nodeType===1?C.startContainer.childNodes[C.startOffset]:C.startContainer;G=C.endContainer.nodeType===1?C.endContainer.childNodes[C.endOffset]:C.endContainer;L=v(L,E,K);L=v(L,G,K)}}else{if(I.collapsed){J=b(I.startContainer);L=v(L,J,K)}else{var D=I.getNodes([1]);for(H=0;H<D.length;H++){if(D[H].nodeName=="TD"||D[H].nodeName=="TH"){L=v(L,D[H],K)}}}}return L}function u(L,Q,G){var I=BX.findParent(L,{tag:"TD"});if(!I){return}var P=I.parentNode,M=G=="insertColumnLeft"?I.cellIndex:I.cellIndex+1,N=P.rowIndex,E=r(Q),D=z(I,E);P.insertCell(M).innerHTML=q;var C,F,K,O,J,H=G=="insertColumnLeft"?D[0].c:D[0].c+1;for(J=0;J<Q.rows.length;J++){C=Q.rows[J];if(C.rowIndex==N){continue}F=0;K=0;for(K=0;K<C.cells.length;K++){O=C.cells[K];D=z(O,E);if(D[0].c>=H){F=O.cellIndex;break}F=K+1}C.insertCell(F).innerHTML="&nbsp;"}}function e(G,H,E){var I=BX.findParent(G,{tag:"TR"});if(!I||!H){return}var F,J,C=E=="insertRowUpper"?I.rowIndex:I.rowIndex+1,D=H.insertRow(C);for(F=0;F<I.cells.length;F++){J=D.insertCell(F);J.innerHTML=q;J.colSpan=I.cells[F].colSpan}}function p(E,F,D){var H=b(E,F);if(!H||!F){return}var G=H.parentNode,C=D=="insertCellLeft"?H.cellIndex:H.cellIndex+1;G.insertCell(C).innerHTML=q}function b(D,C){if(D.nodeName=="TD"||D.nodeName=="TH"){return D}return BX.findParent(D,function(E){return E.nodeName=="TD"||E.nodeName=="TH"},C)}function c(L,K){var H,F,C=r(K),J=i(z(L[0],C)),I=J,E=false,D=true,G=true;for(F=1;F<L.length;F++){H=i(z(L[F],C));D=D&&H.rows==J.rows&&H.maxRow==J.maxRow&&H.minRow==J.minRow;G=G&&H.cols==J.cols&&H.maxCol==J.maxCol&&H.minCol==J.minCol;E=E||(D&&Math.abs(H.minCol-I.maxCol)>1)||(G&&Math.abs(H.minRow-I.maxRow)>1)||!D&&!G;I=H}return{sameCol:G,sameRow:D,gaps:E}}function w(D,C,F){if(!D){D=x(C,F)}if(!D||D.length<2){return false}var E=c(D,F);return !E.gaps&&(!E.sameRow&&E.sameCol||E.sameRow&&!E.sameCol)}function k(F,J){var L=x(F,J);if(!L||L.length!==1){return false}var C=r(J),D=z(L[0],C);if(D.length<1){return false}var E,G,K=D[D.length-1].c,H=true,I;for(E=0;E<D.length;E++){if(D[E].c==K){if(C[D[E].r]&&C[D[E].r][D[E].c+1]){I=C[D[E].r][D[E].c+1];if(G===undefined){G=I}else{if(G!==I){H=false}}}else{H=false}}}H=H&&G&&w([L[0],G],F,J);return H}function A(G,K){var L=x(G,K);if(!L||L.length!==1){return false}var C=r(K),D=z(L[0],C);if(D.length<1){return false}var E,F,J=D[D.length-1].r,H=true,I;for(E=0;E<D.length;E++){if(D[E].r==J){if(C[J+1]&&C[J+1][D[E].c]){I=C[J+1][D[E].c];if(F===undefined){F=I}else{if(F!==I){H=false}}}else{H=false}}}H=H&&F&&w([L[0],F],G,K);return H}function t(E,H,J){if(!J){J=x(E,H)}if(J.length<2){return}var G=c(J,H),D,F,I=0,C=0,K="";if(G.sameRow&&!G.sameCol&&!G.gaps){for(D=0;D<J.length;D++){K+=" "+BX.util.trim(J[D].innerHTML);F=J[D].parentNode;I+=J[D].colSpan;if(D>0){F.removeChild(J[D])}}J[0].colSpan=I;J[0].innerHTML=BX.util.trim(K)}else{if(!G.sameRow&&G.sameCol&&!G.gaps){for(D=0;D<J.length;D++){K+=" "+BX.util.trim(J[D].innerHTML);F=J[D].parentNode;C+=J[D].rowSpan;if(D>0){F.removeChild(J[D])}}J[0].rowSpan=C;J[0].innerHTML=BX.util.trim(K)}else{alert(BX.message("BXEdTableMergeError"))}}}function g(C,E){var D=x(C,E);if(!D||D.length!==1){return false}var F=BX.findParent(D[0],{tag:"TR"},E);if(D[0].cellIndex<F.cells.length-1){D.push(F.cells[D[0].cellIndex+1])}return t(C,E,D)}function B(G,K){var L=x(G,K);if(!L||L.length!==1){return false}var C=r(K),D=z(L[0],C),E,F,J=D[D.length-1].r,H=true,I;for(E=0;E<D.length;E++){if(D[E].r==J){if(C[J+1]&&C[J+1][D[E].c]){I=C[J+1][D[E].c];if(F===undefined){F=I}else{if(F!==I){H=false}}}else{H=false}}}if(H){L.push(F);return t(G,K,L)}}function o(C,G){var D=x(C,G);if(!D||D.length!==1){return false}var F,E=[],H=D[0].parentNode;for(F=0;F<H.cells.length;F++){E.push(H.cells[F])}return t(C,G,E)}function d(D,J){var F=x(D,J);if(!F||F.length!==1){return false}var H,E,G=[],I=r(J),C=i(z(F[0],I));for(H=0;H<I.length;H++){for(E=C.minCol;E<=C.minCol;E++){G=v(G,I[H][E],J)}}return t(D,J,G)}function m(G,M){var N=x(G,M);if(!N||N.length!=1){return false}var F,D,H=0,J,C,E,I=N[0].colSpan,L=N[0].rowSpan,K=N[0].parentNode;for(F=0;F<=N[0].cellIndex;F++){H+=K.cells[F].colSpan}if(I>1){N[0].colSpan--}else{for(D=0;D<M.rows.length;D++){if(D==K.rowIndex||D>=K.rowIndex&&D<K.rowIndex+L){continue}J=0;C=M.rows[D];F=0;while(J<H&&F<C.cells.length){J+=C.cells[F++].colSpan}F--;C.cells[F].colSpan+=1;if(C.cells[F].rowSpan>1){D=D+C.cells[F].rowSpan-1}}}E=K.insertCell(N[0].cellIndex+1);E.rowSpan=N[0].rowSpan;E.innerHTML=q}function j(N,T){var F=x(N,T);if(!F||F.length!=1){return false}var R,O,U,I,D,X,J,G,H=r(T),K=z(F[0],H),C=F[0].parentNode,S=C.rowIndex,M=F[0].cellIndex,Q=K[0].r,W=K[0].c,P=true,V=true;for(R=1;R<K.length;R++){if(K[R].r!=Q){V=false}if(K[R].c!=W){P=false}}if(V){var E=T.insertRow(C.rowIndex+1),L=E.insertCell(-1);L.innerHTML=q;if(!P){L.colSpan=F[0].colSpan}for(O=0;O<=Q;O++){I=T.rows[O];for(U=0;U<I.cells.length;U++){D=I.cells[U];if(O==S&&U==M){continue}J=O;if(D.rowSpan>1){J+=D.rowSpan-1}if(J>=Q){D.rowSpan++}}}}else{I=T.rows[S+ --F[0].rowSpan];G=false;for(U=0;U<I.cells.length;U++){X=z(I.cells[U],H);for(R=0;R<X.length;R++){if(X[R].c>M){G=0}else{if(X[R].c+1==M){G=I.cells[U].cellIndex+1}}if(G!==false){break}}}L=I.insertCell(G);L.innerHTML=q;if(!P){L.colSpan=F[0].colSpan}}}function y(G,J){var K=x(G,J);if(!K||K.length!=1){return false}var I=K[0];if(!I){return false}var H,E,C=r(J),D=z(I,C),F;for(F=0;F<C.length;F++){E=C[F][D[0].c];if(E&&E.parentNode){H=E.parentNode;BX.remove(E);if(H.cells.length==0){BX.remove(H)}}}if(J.rows.length==0){BX.remove(J)}}function h(D,F){var E=x(D,F);if(!E||E.length!=1){return false}var C=E[0];if(!C){return false}BX.remove(C.parentNode);if(F.rows.length==0){BX.remove(F)}}function f(D,F,C){if(!C){var E=x(D,F);if(!E||E.length!=1){return false}C=E[0]}if(!C){return false}var G=C.parentNode;BX.remove(C);if(G.cells.length==0){BX.remove(G)}if(F.rows.length==0){BX.remove(F)}}function n(C,F){var D=x(C,F);if(!D||D.length==1){return false}var E,G;for(E=0;E<D.length;E++){G=D[E].parentNode;BX.remove(D[E]);if(G.cells.length==0){BX.remove(G)}}if(F.rows.length==0){BX.remove(F)}}return{exec:function(E,D){var C=D.range.commonAncestorContainer;switch(D.actionType){case"insertColumnLeft":case"insertColumnRight":u(C,D.tableNode,D.actionType);break;case"insertRowUpper":case"insertRowLower":e(C,D.tableNode,D.actionType);break;case"insertCellLeft":case"insertCellRight":p(C,D.tableNode,D.actionType);break;case"removeColumn":y(D.range,D.tableNode);break;case"removeRow":h(D.range,D.tableNode);break;case"removeCell":f(D.range,D.tableNode);break;case"removeSelectedCells":n(D.range,D.tableNode);break;case"mergeSelectedCells":t(D.range,D.tableNode);break;case"mergeRightCell":g(D.range,D.tableNode);break;case"mergeBottomCell":B(D.range,D.tableNode);break;case"mergeRow":o(D.range,D.tableNode);break;case"mergeColumn":d(D.range,D.tableNode);break;case"splitHorizontally":m(D.range,D.tableNode);break;case"splitVertically":j(D.range,D.tableNode);break}},state:BX.DoNothing,value:BX.DoNothing,getSelectedCells:x,canBeMerged:w,canBeMergedWithRight:k,canBeMergedWithBottom:A}},GetFormatBbCode:function(){var b=this;return{view:"textarea",exec:function(f,g){var e=g.value,c=g.tag.toUpperCase(),d=c;if(c=="FONT"||c=="COLOR"||c=="SIZE"){c+="="+e}if(g.singleTag===true){b.editor.textareaView.WrapWith("[","]",c)}else{b.editor.textareaView.WrapWith("["+c+"]","[/"+d+"]")}},state:BX.DoNothing,value:BX.DoNothing}}};window.BXEditorActions=a})();