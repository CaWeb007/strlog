(function(){BX.namespace("BX.Fileman.Google");BX.Fileman.Google.Map=function(a,b){this.node=a;this.param=b;this.googleMap=null;BX.Fileman.Google.Loader.init(BX.proxy(this.create,this))};BX.Fileman.Google.Map.prototype.create=function(){this.googleMap=new window.google.maps.Map(this.node,this.processParameters(this.param))};BX.Fileman.Google.Map.prototype.getGoogleMap=function(){return this.googleMap};BX.Fileman.Google.Map.prototype.processParameters=function(b){var a={noClear:true};if(!!b){if(!!b.center){a.center=BX.Fileman.Google.getGoogleLatLng(b.center)}if(!!b.zoom){a.zoom=b.zoom}}return a};BX.Fileman.Google.Map.prototype.addPoint=function(a){return new BX.Fileman.Google.Point(this,a)};BX.Fileman.Google.Map.prototype.panTo=function(a){BX.Fileman.Google.Loader.init(BX.delegate(function(){this.getGoogleMap().panTo(BX.Fileman.Google.getGoogleLatLng(a))},this))};BX.Fileman.Google.Point=function(b,a,c){this.map=b;this.latLng=a;this.googleLatLng=null;this.infoWindow=null;this.infoWindowContent=null;this.events={change:null,click:null};this.draggable=true;BX.Fileman.Google.Loader.init(BX.delegate(function(){this.googleLatLng=BX.Fileman.Google.getGoogleLatLng(a);var e={position:this.googleLatLng,map:this.map.getGoogleMap(),draggable:this.draggable};if(!!c){for(var d in c){if(c.hasOwnProperty(d)){e[d]=c[d]}}}this.marker=new google.maps.Marker(e);this.marker.addListener("click",BX.proxy(this.click,this));this.marker.addListener("dragend",BX.proxy(this.dragend,this))},this))};BX.Fileman.Google.Point.prototype.setEvent=function(b,a){this.events[b]=a};BX.Fileman.Google.Point.prototype.getMarker=function(){return this.marker};BX.Fileman.Google.Point.prototype.setDraggable=function(a){if(this.marker){this.marker.setDraggable(a)}this.draggable=a};BX.Fileman.Google.Point.prototype.setContent=function(a){BX.Fileman.Google.Loader.init(BX.defer(function(){this.setContent=this._setContent;this.setContent(a)},this))};BX.Fileman.Google.Point.prototype._setContent=function(a){if(this.infoWindow===null){this.infoWindowContent=BX.create("span",{children:[a]});this.infoWindow=new google.maps.InfoWindow({content:this.infoWindowContent,disableAutoPan:true})}else{if(BX.type.isDomNode(a)){BX.cleanNode(this.infoWindowContent);this.infoWindowContent.appendChild(a)}else{BX.adjust(this.infoWindowContent,{text:a})}}this.infoWindow.open(this.map.getGoogleMap(),this.marker)};BX.Fileman.Google.Point.prototype.moveTo=function(a){this.latLng=a;BX.Fileman.Google.Loader.init(BX.delegate(function(){this.googleLatLng=BX.Fileman.Google.getGoogleLatLng(a);this.marker.setPosition(this.googleLatLng)},this))};BX.Fileman.Google.Point.prototype.click=function(a){if(!!this.events.click){this.events.click.apply(this,[this.latLng])}};BX.Fileman.Google.Point.prototype.dragend=function(a){this.googleLatLng=this.marker.getPosition();this.latLng=BX.Fileman.Google.getLatLng(this.googleLatLng);this.map.panTo(this.latLng);this.callChangeEvent()};BX.Fileman.Google.Point.prototype.callChangeEvent=function(){if(!!this.events.change){this.events.change.apply(this,[this.latLng])}BX.onCustomEvent(this,"onGoogleMapPointChanged",[this.index,this.latLng])};BX.Fileman.Google.Point.prototype.clean=function(){this.marker.setMap(null);this.marker=null};BX.Fileman.Google.Point.prototype.getPosition=function(){this.latLng=BX.Fileman.Google.getLatLng(this.googleLatLng);return this.latLng}})();