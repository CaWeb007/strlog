if(!BX.getClass("BX.Bizproc.FieldType")){(function(d){d.namespace("BX.Bizproc");var c=function(e){return(e.Multiple===true)};var b=function(e){if(!d.type.isArray(e)){return[e]}return e};var a={renderControl:function(i,k,m,j){var e,f=this.getRenderFunctionName(k),g=true;if(d.type.isString(i)){i=i.split("@")}if(f){if(c(k)&&k.Type!=="select"){var l=[],h=this;b(j).forEach(function(n){l.push(h[f](k,m,n))});e=this.wrapMultipleControls(k,m,l)}else{e=d.create("div",{children:[this[f](k,m,j)]})}}else{if(k.Type==="user"){e=d.create("div",{children:[d.create("div",{attrs:{className:"bizproc-type-control bizproc-type-control-user","data-role":"user-selector","data-config":JSON.stringify({valueInputName:m,value:j,multiple:(k.Multiple===true),required:(k.Required===true)})}})]})}else{e=d.create("div",{text:"..."});d.ajax.post("/bitrix/tools/bizproc_get_field.php",{DocumentType:i,Field:{Field:m,Form:"sfa_form"},Value:(j||""),Type:k,Als:0,rnd:Math.random(),Mode:"",Func:"",sessid:d.bitrix_sessid(),RenderMode:"public"},function(n){if(n){e.innerHTML=n;this.initControl(e)}}.bind(this))}}if(g&&e){this.initControl(e)}return e},formatValuePrintable:function(l,k){var e;switch(l.Type){case"bool":case"UF:boolean":e=d.message(k==="Y"?"BIZPROC_JS_BP_FIELD_TYPE_YES":"BIZPROC_JS_BP_FIELD_TYPE_NO");break;case"select":case"internalselect":if(d.type.isArray(k)){e=[];k.forEach(function(i){e.push(l.Options[i])});e=e.join(", ")}else{e=l.Options[k]}break;case"date":case"UF:date":case"datetime":case"text":case"int":case"double":case"string":e=k;break;case"user":e=[];var g,f,m,j,h=k.split(",");for(g=0;g<h.length;++g){m=d.util.trim(h[g]);if(j=m.match(/(.*)\[([A-Z]{0,2}\d+)\]/)){f=d.util.trim(j[1]);e.push(f)}else{e.push(m)}}e=e.join(", ");break;default:if(d.type.isString(k)){e=k}else{e="(?)"}break}return e},getRenderFunctionName:function(f){var e;switch(f.Type){case"B":case"bool":case"UF:boolean":e="createBoolNode";break;case"date":case"UF:date":case"datetime":case"S:Date":case"S:DateTime":e="createDateNode";break;case"L":case"select":case"internalselect":e="createSelectNode";break;case"T":case"text":e="createTextNode";break;case"N":case"int":case"double":e="createNumericNode";break;case"S":case"string":e="createStringNode";break;case"F":case"file":e="createFileNode";break}return e},wrapMultipleControls:function(g,i,e){var h=d.create("div",{children:e});var f=d.create("a",{attrs:{className:"bizproc-type-control-clone-btn"},text:d.message("BIZPROC_JS_BP_FIELD_TYPE_ADD"),events:{click:function(j){j.preventDefault();a.cloneControl(g,i,this.parentNode)}}});h.appendChild(d.create("div",{children:[f]}));return h},cloneControl:function(i,f,g){var h=this.getRenderFunctionName(i);if(h){var e=this[h](i,f);if(e&&g.parentNode){var j=d.create("div",{children:[e]});this.initControl(j);g.parentNode.insertBefore(j,g)}}},createBoolNode:function(k,l,j){var f=d.message("BIZPROC_JS_BP_FIELD_TYPE_YES");var e=d.message("BIZPROC_JS_BP_FIELD_TYPE_NO");f=f.charAt(0).toUpperCase()+f.slice(1);e=e.charAt(0).toUpperCase()+e.slice(1);var g=d.create("select",{attrs:{className:"bizproc-type-control bizproc-type-control-bool"+(c(k)?" bizproc-type-control-multiple":"")},props:{name:l+(c(k)?"[]":"")},children:[d.create("option",{props:{value:""},text:d.message("BIZPROC_JS_BP_FIELD_TYPE_NOT_SELECTED")})]});var i=d.create("option",{props:{value:"Y"},text:f});if(j==="Y"||j===1||j==="1"){i.setAttribute("selected","selected")}var h=d.create("option",{props:{value:"N"},text:e});if(j==="N"||j===0||j==="0"){h.setAttribute("selected","selected")}g.appendChild(i);g.appendChild(h);return g},createDateNode:function(j,l,i){var g=j.Type;if(g==="UF:date"||g==="S:Date"){g="date"}if(g==="S:DateTime"){g="datetime"}var f=d.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-"+g+(c(j)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target","data-selector-type":g},props:{type:"text",name:l+(c(j)?"[]":""),value:(i||"")}});var k=d.Bizproc.Automation&&d.Bizproc.Automation.Designer.getRobotSettingsDialog();if(!k){var e=d.create("img",{attrs:{src:"/bitrix/js/main/core/images/calendar-icon.gif",className:"calendar-icon",border:"0"},events:{click:function(m){m.preventDefault();d.calendar({node:this,field:f,bTime:(g==="datetime"),bHideTime:(g==="date")})}}});var h;if(j.Settings&&j.Settings["timezones"]){h=d.create("select",{props:{name:"tz_"+(l+(c(j)?"[]":""))},attrs:{className:"bizproc-type-control-date-lc"}});j.Settings["timezones"].forEach(function(m){var n=d.create("option",{props:{value:m.value},text:m.text});if(m.value==="current"){n.setAttribute("selected","selected")}h.appendChild(n)})}return d.create("div",{children:[f,e,h]})}return f},createNumericNode:function(f,g,e){return d.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-int"+(c(f)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target"},props:{type:"text",name:g+(c(f)?"[]":""),value:(e||"")}})},createStringNode:function(f,g,e){return d.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-string"+(c(f)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target"},props:{type:"text",name:g+(c(f)?"[]":""),value:(e||"")}})},createFileNode:function(h,j,g){var i=d.Bizproc.Automation&&d.Bizproc.Automation.Designer.getRobotSettingsDialog();if(!i){var e=d.create("input",{props:{type:"file",name:j+(c(h)?"[]":""),value:(g||"")},events:{change:function(){this.nextSibling.textContent=d.Bizproc.FieldType.File.parseLabel(this.value)}}});var f=d.create("span",{children:[d.create("span",{attrs:{className:"webform-small-button"},text:d.message("BIZPROC_JS_BP_FIELD_TYPE_CHOOSE_FILE")})]});return d.create("div",{children:[f,e,d.create("span",{attrs:{className:"bizproc-type-control-file-label"}})],attrs:{className:"bizproc-type-control bizproc-type-control-file"+(c(h)?" bizproc-type-control-multiple":"")}})}return d.create("input",{attrs:{className:"bizproc-type-control bizproc-type-control-file-selectable"+(c(h)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target","data-selector-type":"file"},props:{type:"text",name:j+(c(h)?"[]":""),value:(g||"")}})},createTextNode:function(f,g,e){return d.create("textarea",{attrs:{className:"bizproc-type-control bizproc-type-control-text"+(c(f)?" bizproc-type-control-multiple":""),"data-role":"inline-selector-target",rows:5,cols:40},props:{name:g+(c(f)?"[]":"")},text:(e||"")})},createSelectNode:function(l,m,k){var j=function(n,i){if(!n||!i){return false}if(d.type.isArray(i)){return d.util.in_array(n,i)}return(n.toString()===i.toString())};var g,h=d.create("select",{attrs:{className:"bizproc-type-control bizproc-type-control-select"+(c(l)?" bizproc-type-control-multiple":"")},props:{name:m+(c(l)?"[]":"")},children:[d.create("option",{props:{value:""},text:d.message("BIZPROC_JS_BP_FIELD_TYPE_NOT_SELECTED")})]});if(c(l)){h.setAttribute("multiple","multiple");h.setAttribute("size","5")}if(d.type.isPlainObject(l.Options)){for(var f in l.Options){if(!l.Options.hasOwnProperty(f)){continue}g=d.create("option",{props:{value:f},text:l.Options[f]});if(j(f,k)){g.setAttribute("selected","selected")}h.appendChild(g)}}else{if(d.type.isArray(l.Options)){for(var e=0;e<l.Options.length;++e){g=d.create("option",{props:{value:e},text:l.Options[e]});if(j(e,k)){g.setAttribute("selected","selected")}h.appendChild(g)}}}return h},initControl:function(e){var f;if(f=d.Bizproc.Automation&&d.Bizproc.Automation.Designer.getRobotSettingsDialog()){f.template.initRobotSettingsControls(f.robot,e)}else{if(f=d.Bizproc.Automation&&d.Bizproc.Automation.Designer.getTriggerSettingsDialog()){f.component.triggerManager.initSettingsDialogControls(e)}}},getDocumentFields:function(){var e=[];var f=d.Bizproc.Automation&&d.Bizproc.Automation.Designer.getRobotSettingsDialog();if(f&&f.robot.component){e=f.robot.component.data.DOCUMENT_FIELDS}if(!e.length&&d.Bizproc.Automation&&d.Bizproc.Automation.API.documentFields){e=d.Bizproc.Automation.API.documentFields}return e},getDocumentUserGroups:function(){if(d.Bizproc.Automation&&d.Bizproc.Automation.API.documentUserGroups){return d.Bizproc.Automation.API.documentUserGroups}return[]}};a.File={parseLabel:function(f){var e;if(f.lastIndexOf("\\")){e=f.lastIndexOf("\\")+1}else{e=f.lastIndexOf("/")+1}return f.slice(e)}};d.Bizproc.FieldType=a})(window.BX||window.top.BX)};