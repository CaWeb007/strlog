(function(b){function a(c){this.calendar=c;this.params={}}a.prototype={show:function(e){var c;this.params=e;this.entry=this.params.entry;var d=e.entry.getPart(0);if(e.specialTarget){this.bindNode=e.specialTarget}else{if(d&&d.params&&d.params.wrapNode){this.bindNode=d.params.wrapNode}}if(!this.bindNode){return}c=new BX.PopupWindow(this.calendar.id+"-simple-view-popup",this.bindNode,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,titleBar:true,draggable:true,resizable:false,lightShadow:true,className:"calendar-simple-view-popup",content:this.createContent()});BX.addClass(c.titleBar,"calendar-add-popup-titlebar");BX.removeClass(c.popupContainer,"popup-window-with-titlebar");BX.removeClass(c.closeIcon,"popup-window-titlebar-close-icon");c.show(true);this.popup=c;this.popupButtonsContainer=c.buttonsContainer;BX.addClass(c.contentContainer,"calendar-view-popup-wrap");BX.adjust(c.contentContainer,{attrs:{style:""}});c.popupContainer.style.minHeight=(c.popupContainer.offsetHeight-20)+"px";BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addCustomEvent(c,"onPopupClose",BX.proxy(this.close,this));this.calendar.keyHandlerEnabled=false},close:function(c){if(!c){c={}}this.calendar.keyHandlerEnabled=true;if(this.popup){BX.removeCustomEvent(this.popup,"onPopupClose",BX.proxy(this.close,this));this.popup.destroy()}if(this.params.closeCallback&&typeof this.params.closeCallback=="function"){this.params.closeCallback()}if(c.deselectEntry){setTimeout(BX.delegate(function(){this.calendar.getView().deselectEntry()},this),300)}BX.unbind(document,"keydown",BX.proxy(this.keyHandler,this))},isShown:function(){return this.popup&&this.popup.isShown&&this.popup.isShown()},createContent:function(f){if(f&&f.entry){this.entry=f.entry}this.wrap=BX.create("DIV",{props:{className:"calendar-right-block-event-info"}});var e;this.DOM={name:this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-right-block-event-info-title"},html:'<div class="calendar-right-block-event-info-title-calendar" style="background-color: '+this.entry.color+';"></div>'+BX.util.htmlspecialchars(this.entry.name)})),date:this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-right-block-event-info-date"},text:this.calendar.util.formatDateUsable(this.entry.from)})),tableWrap:this.wrap.appendChild(BX.create("TABLE",{props:{className:"calendar-field-right-block-table"}})),buttonsWrap:this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-right-block-event-info-btn-container"}}))};if(this.calendar.util.getDayCode(this.entry.from)==this.calendar.util.getDayCode(this.entry.to)){this.DOM.date.innerHTML=this.calendar.util.formatDateUsable(this.entry.from);if(this.entry.fullDay){this.DOM.date.innerHTML+=", "+BX.message("EC_ALL_DAY")}else{this.DOM.date.innerHTML+=", "+this.calendar.util.formatTime(this.entry.from.getHours(),this.entry.from.getMinutes())+" &ndash; "+this.calendar.util.formatTime(this.entry.to.getHours(),this.entry.to.getMinutes())}}else{this.DOM.date.innerHTML=this.calendar.util.formatDateUsable(this.entry.from)+", "+this.calendar.util.formatTime(this.entry.from.getHours(),this.entry.from.getMinutes())+" &ndash; "+this.calendar.util.formatDateUsable(this.entry.to)+", "+this.calendar.util.formatTime(this.entry.to.getHours(),this.entry.to.getMinutes())}if(this.entry.isRecursive()&&this.entry.data["~RRULE_DESCRIPTION"]){e=this.DOM.tableWrap.insertRow(-1);BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_REPEAT")+":"});BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-value"},html:'<div class="calendar-field-container calendar-field-container-text"><div class="calendar-field-block"><div class="calendar-text">'+BX.util.htmlspecialchars(this.entry.data["~RRULE_DESCRIPTION"])+"</div></div></div>"})}if(this.entry.isMeeting()&&this.entry.getAttendees().length>0){e=this.DOM.tableWrap.insertRow(-1);BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_HOST")+":"});this.DOM.hostWrap=BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-value"}}).appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-members"}})).appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-selected-members"}}));var d=false;this.showAttendees(this.DOM.hostWrap,this.entry.getAttendees().filter(function(g){if(d){return false}d=g.STATUS=="H"||(g.USER_ID==this.entry.getMeetingHost());return d},this));e=this.DOM.tableWrap.insertRow(-1);BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_ATTENDEES_LABEL")+":"});this.DOM.attendeesWrap=BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-value"}}).appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-members"}})).appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-selected-members"}}));this.showAttendees(this.DOM.attendeesWrap,this.entry.getAttendees().filter(function(g){return g.STATUS=="Y"||g.STATUS=="H"}),this.entry.getAttendees().length)}var c=this.calendar.util.getTextLocation(this.entry.location);if(c){e=this.DOM.tableWrap.insertRow(-1);BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_LOCATION")+":"});BX.adjust(e.insertCell(-1),{props:{className:"calendar-field-table-cell-value"},html:'<div class="calendar-field-container calendar-field-container-text"><div class="calendar-field-block"><div class="calendar-text">'+BX.util.htmlspecialchars(c)+"</div></div></div>"})}this.showButtons();return this.wrap},showButtons:function(){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW"),events:{click:BX.proxy(function(){if(this.entry.isTask()){BX.SidePanel.Instance.open(this.calendar.util.getViewTaskPath(this.entry.id),{loader:"task-new-loader"})}else{this.calendar.getView().showViewSlider({entry:this.entry})}this.close({deselectEntry:true})},this)}}));if(this.entry&&this.entry.getCurrentStatus()){var c=this.entry.getCurrentStatus();if(c=="Q"){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_Y"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"Y");this.close({deselectEntry:true})},this)}}));this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_N"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"N");this.close({deselectEntry:true})},this)}}))}else{if(c=="Y"){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_N"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"N");this.close({deselectEntry:true})},this)}}))}else{if(c=="N"){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_Y"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"Y");this.close({deselectEntry:true})},this)}}))}}}}if(this.calendar.entryController.canDo(this.entry,"edit")&&!this.entry.isTask()){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_SEC_EDIT"),events:{click:BX.proxy(function(){this.calendar.entryController.editEntry({entry:this.entry});this.close({deselectEntry:true})},this)}}))}if(this.calendar.entryController.canDo(this.entry,"delete")&&!this.entry.isTask()){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_SEC_DELETE"),events:{click:BX.proxy(function(){this.calendar.entryController.deleteEntry(this.entry);this.close({deselectEntry:true})},this)}}))}},showAttendees:function(h,j,e){var g,f,d=5,k=j.length,c=7;if(k>0){if(k>c){k=d}for(g=0;g<k;g++){f=j[g]||{};h.appendChild(BX.create("IMG",{attrs:{id:"simple_view_popup_"+f.ID,src:f.AVATAR||""},props:{title:f.DISPLAY_NAME,className:"calendar-member"}}));(function(i){setTimeout(function(){BX.tooltip(i,"simple_view_popup_"+i)},100)})(f.ID)}if(k<j.length){this.DOM.moreUsersLink=h.appendChild(BX.create("SPAN",{props:{className:"calendar-member-more-count"},text:" "+BX.message("EC_ATTENDEES_MORE").replace("#COUNT#",j.length-k),events:{click:BX.delegate(function(){this.showUserListPopup(this.DOM.moreUsersLink,j)},this)}}))}if(e-1>0&&k<e){this.DOM.allUsersLink=h.appendChild(BX.create("SPAN",{props:{className:"calendar-member-total-count"},text:" ("+BX.message("EC_ATTENDEES_TOTAL_COUNT").replace("#COUNT#",(e-1))+")",events:{click:BX.delegate(function(){this.showUserListPopup(this.DOM.allUsersLink,this.entry.getAttendees())},this)}}))}}},showUserListPopup:function(d,c){if(this.userListPopup){this.userListPopup.close()}if(this.popup){this.popup.setAutoHide(false)}if(!c||!c.length){return}this.DOM.userListPopupWrap=BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});c.forEach(function(e){var f=this.DOM.userListPopupWrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));f.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(BX.create("IMG",{props:{width:34,height:34,src:e.AVATAR}}));f.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(BX.create("A",{props:{href:e.URL?e.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:e.DISPLAY_NAME}))},this);this.userListPopup=new BX.PopupWindow(this.calendar.id+"-view-user-list-popup",d,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,width:200,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup"});this.userListPopup.setAngle({offset:36});this.userListPopup.show();BX.addCustomEvent(this.userListPopup,"onPopupClose",BX.delegate(function(){if(this.popup){this.popup.setAutoHide(true)}this.userListPopup.destroy()},this))},keyHandler:function(f){var c=this.calendar.util.getKeyCodes(),d=f.keyCode;if(this.entry){if(d==c.enter){if(this.entry.isTask()){BX.SidePanel.Instance.open(this.calendar.util.getViewTaskPath(this.entry.id),{loader:"task-new-loader"})}else{this.calendar.getView().showViewSlider({entry:this.entry})}this.close({deselectEntry:true})}else{if(d==c["delete"]||d==c.backspace){this.calendar.entryController.deleteEntry(this.entry)}}}}};if(b.BXEventCalendar){b.BXEventCalendar.SimpleViewPopup=a}else{BX.addCustomEvent(b,"onBXEventCalendarInit",function(){b.BXEventCalendar.SimpleViewPopup=a})}})(window);