(function(b){function a(d,c){this.calendar=d;this.util=this.calendar.util;this.filterId=c.filterId;this.minSearchStringLength=2;this.showCounters=false;this.counters=[{id:"invitation",className:"calendar-counter-invitation",pluralMessageId:"EC_COUNTER_INVITATION",value:c.counters.invitation||0}];this.filter=BX.Main.filterManager.getById(this.filterId);if(this.filter){this.filterApi=this.filter.getApi();BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate(this.beforeFilterApply,this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.applyFilter,this))}}a.prototype={getFilter:function(){return this.filter},updateCounters:function(){var c,d=this;this.showCounters=false;BX.cleanNode(this.calendar.countersCont);this.countersWrap=this.calendar.countersCont.appendChild(BX.create("DIV",{props:{className:"calendar-counter-title"}}));for(c=0;c<this.counters.length;c++){if(this.counters[c]&&this.counters[c].value>0){this.showCounters=true;break}}if(this.showCounters){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-page-name"},text:BX.message("EC_COUNTER_TOTAL")+":"}));for(c=0;c<this.counters.length;c++){if(this.counters[c]&&this.counters[c].value>0){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-container "+this.counters[c].className},attrs:{"data-bx-counter":this.counters[c].id},html:'<span class="calendar-counter-inner"><span class="calendar-counter-number">'+this.counters[c].value+'</span><span class="calendar-counter-text">'+this.util.getMessagePlural(this.counters[c].pluralMessageId,this.counters[c].value)+"</span></span>",events:{click:(function(e){return function(){d.appplyCounterEntries(e.id)}})(this.counters[c])}}))}}}else{this.countersWrap.innerHTML=BX.message("EC_NO_COUNTERS")}},appplyCounterEntries:function(c){if(c=="invitation"){this.filterApi.setFilter({preset_id:"filter_calendar_meeting_status_q"})}},beforeFilterApply:function(){if(!this.isFilterEmpty()){}},applyFilter:function(g,d,c,f,e){e.autoResolve=false;if(this.isFilterEmpty()){if(this.calendar.getView().resetFilterMode){this.calendar.getView().resetFilterMode({resetSearchFilter:false})}f.fulfill()}else{this.calendar.setView("list",{animation:false});setTimeout(BX.delegate(function(){this.calendar.getView().applyFilterMode()},this),100);this.calendar.request({data:{action:"get_filter_data"},handler:BX.delegate(function(h){if(h&&h.entries){if(!this.calendar.getView().filterMode){setTimeout(BX.delegate(function(){this.calendar.getView().applyFilterMode();this.displaySearchResult(h)},this),100)}else{this.displaySearchResult(h)}}f.fulfill()},this)})}},displaySearchResult:function(d){var e,c=[];for(e=0;e<d.entries.length;e++){c.push(new b.BXEventCalendar.Entry(this.calendar,d.entries[e]))}this.calendar.getView().displayResult(c);if(BX.type.isPlainObject(d.counters)){for(e=0;e<this.counters.length;e++){if(d.counters[this.counters[e].id]!==undefined){this.counters[e].value=d.counters[this.counters[e].id]||0}}this.updateCounters()}},isFilterEmpty:function(){var c=this.filter.getSearch();return !c.getLastSquare()&&(!c.getSearchString()||c.getSearchString().length<this.minSearchStringLength)},searchInput:function(){},resetFilter:function(){this.filter.resetFilter()}};if(b.BXEventCalendar){b.BXEventCalendar.Search=a}else{BX.addCustomEvent(b,"OnBXEventCalendarInit",function(){b.BXEventCalendar.Search=a})}})(window);