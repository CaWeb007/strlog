(function(b){function a(c){this.calendar=c}a.prototype={show:function(h){var c;this.params=h;this.entryTime=h.entryTime;this.attendees=[];this.attendeesCodesList=false;this.attendeesIndex={};this.attendeesCodes={};this.allowInvite=true;this.notify=true;if(this.calendar.ownerUser){this.attendees.push(this.calendar.ownerUser);this.attendeesIndex[this.calendar.ownerUser.id]=true;this.attendeesCodes["U"+this.calendar.ownerUser.id]="users"}this.attendees.push(this.calendar.currentUser);this.attendeesIndex[this.calendar.currentUser.id]=true;this.attendeesCodes["U"+this.calendar.currentUser.id]="users";var i,f,e=-152,d=370,l=420,j=8,g=BX.pos(h.entryNode),k=BX.GetWindowSize();if(g.right+d+j<k.innerWidth){i="left";f=g.width+j}else{i="right";f=-d-j}if(k.scrollTop+k.innerHeight-(g.bottom+l+e)<-35){i=false}c=BX.PopupWindowManager.create(this.calendar.id+"-simple-add-popup",h.bindNode||h.entryNode,{autoHide:true,closeByEsc:true,offsetTop:e,offsetLeft:f,closeIcon:true,width:d-20,titleBar:true,draggable:true,resizable:false,lightShadow:true,content:this.createContent(),overlay:{opacity:1},buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_SAVE")+" (ENTER)",className:"popup-window-button-accept",events:{click:BX.delegate(this.save,this)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CANCEL"),events:{click:BX.delegate(this.close,this)}})]});if(i!==false){c.setAngle({offset:130,position:i})}BX.addClass(c.titleBar,"calendar-add-popup-titlebar");BX.removeClass(c.popupContainer,"popup-window-with-titlebar");BX.removeClass(c.closeIcon,"popup-window-titlebar-close-icon");c.show(true);this.popup=c;if(c.overlay&&c.overlay.element){this.overlay=c.overlay.element;BX.addClass(c.overlay.element,"calendar-popup-overlay");setTimeout(BX.delegate(function(){BX.addClass(c.overlay.element,"calendar-popup-overlay-dark");c.overlay=null},this),1)}this.popupButtonsContainer=c.buttonsContainer;BX.addClass(c.contentContainer,"calendar-add-popup-wrap");BX.adjust(c.contentContainer,{attrs:{style:""}});c.popupContainer.style.minHeight=(c.popupContainer.offsetHeight-20)+"px";this.nameField.input.focus();this.nameField.input.select();BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addCustomEvent(c,"onPopupClose",BX.proxy(this.close,this));this.calendar.keyHandlerEnabled=false},save:function(e){if(!e){e={}}if(e.checkBusyUsers!==false){var c=this.getBusyUserList();if(c&&c.length>0){if(!this.busyUsersDialog){this.busyUsersDialog=new b.BXEventCalendar.BusyUsersDialog(this.calendar)}this.busyUsersDialog.show({users:c,saveCallback:BX.delegate(function(){var f,g=[];for(f=0;f<c.length;f++){g.push(c[f].id)}this.excludeUsers=g.join(",");e.checkBusyUsers=false;this.save(e)},this)});return}}if(this.params.section.id){var d=this.calendar.sectionController.getSection(this.params.section.id);if(d){d.show()}}this.calendar.entryController.saveEntry(this.getPopupData());if(this.params.saveCallback&&typeof this.params.saveCallback=="function"){this.params.saveCallback()}this.close()},close:function(){this.calendar.keyHandlerEnabled=true;if(this.popup){BX.removeCustomEvent(this.popup,"onPopupClose",BX.proxy(this.close,this));this.popup.destroy()}if(this.overlay){BX.removeClass(this.overlay,"calendar-popup-overlay-dark");setTimeout(BX.delegate(function(){BX.remove(this.overlay)},this),300)}BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));if(this.plannerId){BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}])}if(this.params.closeCallback&&typeof this.params.closeCallback=="function"){this.params.closeCallback()}BX.unbind(document,"keydown",BX.proxy(this.keyHandler,this))},getPopupData:function(){var f=[];this.attendees.forEach(function(i){f.push(i.id)});var h=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),g=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),e=new Date(this.entryTime.from.getTime()),c=new Date(this.entryTime.from.getTime());e.setHours(h.h,h.m,0);c.setHours(g.h,g.m,0);if(!this.attendeesCodesList&&this.attendeesCodes){this.attendeesCodesList=[];for(var d in this.attendeesCodes){if(this.attendeesCodes.hasOwnProperty(d)){this.attendeesCodesList.push(d)}}}return{name:this.nameField.input.value,from:e,to:c,dateFrom:this.calendar.util.formatDateTime(e),dateTo:this.calendar.util.formatDateTime(c),defaultTz:this.timezoneField&&this.timezoneField.select?this.timezoneField.select.value:this.calendar.util.getUserOption("timezoneName"),section:this.params.section.id,location:this.locationSelector.getTextValue(),locationValue:this.locationSelector.getValue(),remind:this.reminderValues||false,attendees:f,attendeesCodes:this.attendeesCodes,attendeesCodesList:this.attendeesCodesList,meetingNotify:this.notify,allowInvite:this.allowInvite,excludeUsers:this.excludeUsers||""}},createContent:function(){this.mainSlide=BX.create("DIV",{props:{className:"calendar-add-popup-main-slide"}});this.secondSlide=false;this.nameField=this.createField("string-select",this.mainSlide);this.nameField.input=this.nameField.innerWrap.appendChild(BX.create("INPUT",{props:{className:"calendar-field calendar-field-string"},attrs:{value:this.params.entryName,placeholder:BX.message("EC_ENTRY_NAME"),type:"text"},events:{click:BX.delegate(function(){this.nameField.input.select()},this),keyup:BX.proxy(this.entryNameChanged,this),blur:BX.proxy(this.entryNameChanged,this),change:BX.proxy(this.entryNameChanged,this)}}));this.createSectionSelector();this.createDateTimeField();this.createReminderField();this.createlocationField();this.createPlannerField();this.fullFormField=this.createField("container-text",this.mainSlide);this.fullFormField.link=this.fullFormField.innerWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-text-link"},text:BX.message("EC_FULL_FORM_LABEL"),events:{click:this.params.fullFormCallback}}));this.mainSlide.appendChild(BX.create("HR",{props:{className:"calendar-filed-separator"}}));this.sliderContainer=BX.create("DIV",{props:{className:"calendar-add-popup-slider-container"},children:[this.mainSlide]});return this.sliderContainer},prepareSecondSlide:function(c){this.closeSecondSlideCallback=c.closeCallback||null;if(this.secondSlide){BX.cleanNode(this.secondSlide)}else{this.secondSlide=this.sliderContainer.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-second-slide"}}))}this.backButton=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-second-slide-header"}})).appendChild(BX.create("SPAN",{props:{className:"calendar-add-popup-second-slide-back-btn"},html:BX.message("EC_SIMPLE_FORM_BACK")}));BX.bind(this.backButton,"click",BX.proxy(this.closeSecondSlide,this));BX.bind(document,"keyup",BX.proxy(function(d){if(d.keyCode==27){this.closeSecondSlide()}},this));this.popup.setClosingByEsc(false);this.popupButtonsContainer.style.display="none";this.resizeSecondSlide();setTimeout(BX.delegate(function(){BX.addClass(this.popup.contentContainer,"calendar-add-popup-wrap-second-tab-active")},this),0)},closeSecondSlide:function(){if(this.closeSecondSlideCallback){this.closeSecondSlideCallback()}BX.unbind(document,"keyup",BX.proxy(function(c){if(c.keyCode==27){this.closeSecondSlide()}},this));BX.removeClass(this.popup.contentContainer,"calendar-add-popup-wrap-second-tab-active");this.popupButtonsContainer.style.display="";this.clearSecondSlideHeight();this.popup.setClosingByEsc(true);if(this.resizeTimeout){this.resizeTimeout=clearTimeout(this.resizeTimeout)}BX.cleanNode(this.secondSlide)},resizeSecondSlide:function(){if(this.secondSlide){var c=this.secondSlide.scrollHeight;if(c!=parseInt(this.popup.contentContainer.style.minHeight)){this.secondSlide.style.minHeight=c+"px";this.sliderContainer.style.minHeight=c+"px"}this.resizeTimeout=setTimeout(BX.proxy(this.resizeSecondSlide,this),100)}},clearSecondSlideHeight:function(){if(this.secondSlide){this.secondSlide.style.minHeight=""}if(this.sliderContainer){this.sliderContainer.style.minHeight=""}},createField:function(f,c){if(!f){f="string"}var d=BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-"+f}}),e=d.appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}}));if(c){c.appendChild(d)}return{outerWrap:d,innerWrap:e}},createSectionSelector:function(){this.sectionField={select:this.nameField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field calendar-field-select calendar-field-tiny"}}))};this.sectionField.innerValue=this.sectionField.select.appendChild(BX.create("DIV",{props:{className:"calendar-field-select-icon"},style:{backgroundColor:this.params.section.color}}));BX.bind(this.sectionField.select,"click",d);var e=this,c=this.calendar.sectionController.getSectionListForEdit();function d(){if(e.sectionMenu&&e.sectionMenu.popupWindow&&e.sectionMenu.popupWindow.isShown()){return e.sectionMenu.close()}var g,f=[],h;for(g=0;g<c.length;g++){f.push({id:"bx-calendar-section-"+c[g].id,text:BX.util.htmlspecialchars(c[g].name),color:c[g].color,className:"calendar-add-popup-section-menu-item",onclick:(function(i){return function(){e.params.section=e.calendar.sectionController.getSection(i);e.calendar.util.setUserOption("lastUsedSection",e.params.section.id);e.sectionField.innerValue.style.backgroundColor=e.params.section.color;e.sectionMenu.close();if(e.params.changeSectionCallback&&typeof e.params.changeSectionCallback=="function"){e.params.changeSectionCallback(e.params.section)}}})(c[g].id)})}e.sectionMenu=BX.PopupMenu.create("sectionMenu"+e.calendar.id,e.sectionField.select,f,{closeByEsc:true,autoHide:true,zIndex:1200,offsetTop:0,offsetLeft:40,angle:true});e.sectionMenu.show();for(g=0;g<e.sectionMenu.menuItems.length;g++){if(e.sectionMenu.menuItems[g].layout.item){h=e.sectionMenu.menuItems[g].layout.item.querySelector(".menu-popup-item-icon");if(h){h.style.backgroundColor=e.sectionMenu.menuItems[g].color}}}BX.addClass(e.sectionField.select,"active");e.popup.setAutoHide(false);BX.addCustomEvent(e.sectionMenu.popupWindow,"onPopupClose",function(){e.popup.setAutoHide(true);BX.removeClass(e.sectionField.select,"active");BX.PopupMenu.destroy("sectionMenu"+e.calendar.id)})}},createDateTimeField:function(){var g=this,d=this.calendar.util.formatTime(this.entryTime.from.getHours(),this.entryTime.from.getMinutes()),e=this.calendar.util.formatTime(this.entryTime.to.getHours(),this.entryTime.to.getMinutes());this.dateTimeField={outerWrap:this.mainSlide.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-datetime"}}))};this.dateTimeField.dateWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-prefix"},text:this.calendar.util.formatDateUsable(this.entryTime.from,false)}));this.dateTimeField.fromTimeInputWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-left"}}));this.dateTimeField.fromTimeInput=this.dateTimeField.fromTimeInputWrap.appendChild(BX.create("INPUT",{attrs:{value:d,placeholder:BX.message("EC_TIME_FROM_PLACEHOLDER"),type:"text"},props:{className:"calendar-field calendar-field-datetime-menu"}}));this._fromDateValue=this.entryTime.from;this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-between"}}));this.dateTimeField.toTimeInputWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-right"}}));this.dateTimeField.toTimeInput=this.dateTimeField.toTimeInputWrap.appendChild(BX.create("INPUT",{attrs:{value:e,placeholder:BX.message("EC_TIME_TO_PLACEHOLDER"),type:"text"},props:{className:"calendar-field calendar-field-datetime-menu"}}));this.dateTimeField.fromTime=new b.BXEventCalendar.SelectInput({input:this.dateTimeField.fromTimeInput,value:this.calendar.util.adaptTimeValue(g.calendar.util.parseTime(g.dateTimeField.fromTimeInput.value)),values:this.calendar.util.getSimpleTimeList(),onChangeCallback:BX.proxy(function(){var k=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),j=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),i=new Date(this.entryTime.from.getTime()),h=new Date(this.entryTime.from.getTime());i.setHours(k.h,k.m,0);h.setHours(j.h,j.m,0);if(this._fromDateValue){this.entryTime.to=new Date(i.getTime()+((h.getTime()-this._fromDateValue.getTime())||3600000));this.dateTimeField.toTimeInput.value=this.calendar.util.formatTime(this.entryTime.to.getHours(),this.entryTime.to.getMinutes())}this.entryTime.from=i;this._fromDateValue=i;if(this.params.timeNode){this.params.timeNode.innerHTML=this.calendar.util.formatTime(k.h,k.m)}if(this.params.changeTimeCallback&&typeof this.params.changeTimeCallback=="function"){this.params.changeTimeCallback(k,j)}},this)});this.dateTimeField.toTime=new b.BXEventCalendar.SelectInput({input:this.dateTimeField.toTimeInput,value:this.calendar.util.adaptTimeValue(this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value)),values:this.calendar.util.getSimpleTimeList()});if(!this.calendar.util.getUserOption("timezoneName")){this.timezoneField=this.createField("container-string",this.mainSlide);this.timezoneField.innerWrap.appendChild(BX.create("LABEL",{props:{className:"calendar-timezone-label"},text:BX.message("EC_ASK_TZ")}));this.timezoneField.select=this.timezoneField.innerWrap.appendChild(BX.create("SELECT",{props:{className:"calendar-field calendar-field-select"},events:{change:function(){g.calendar.util.setUserOption("timezoneName",g.timezoneField.select.value)}}}));var f,c=this.calendar.util.getTimezoneList();for(f in c){if(c.hasOwnProperty(f)){this.timezoneField.select.options.add(new Option(c[f].title,f,false,false))}}this.timezoneField.select.value=this.calendar.util.getUserOption("timezoneDefaultName")||"";this.timezoneField.innerWrap.appendChild(BX.create("SPAN",{props:{title:BX.message("EC_EVENT_TZ_DEF_HINT"),className:"calendar-event-quest"},html:"?"}));BX.addClass(this.timezoneField.innerWrap,"calendar-field-timezone")}},setDateTimeValues:function(d,c){if(d&&c&&this.dateTimeField&&this.dateTimeField.dateWrap){this.dateTimeField.dateWrap.innerHTML=this.calendar.util.formatDateUsable(d);this.dateTimeField.fromTimeInput.value=this.calendar.util.formatTime(d.getHours(),d.getMinutes());this.dateTimeField.toTimeInput.value=this.calendar.util.formatTime(c.getHours(),c.getMinutes());this.entryTime.from=d;this.entryTime.to=c;this._fromDateValue=d;if(this.params.timeNode){this.params.timeNode.innerHTML=this.dateTimeField.fromTimeInput.value}}},createReminderField:function(){this.reminderValues=[];this.reminderField=this.createField("container-text",this.mainSlide);this.reminderField.innerCont=this.reminderField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-text"},text:BX.message("EC_REMIND_LABEL")+":"}));var c=this;this.reminderField.reminder=new b.BXEventCalendar.ReminderSelector({id:"reminder-"+this.calendar.id,selectedValues:[this.calendar.util.getUserOption("defaultReminder",15)],values:this.calendar.util.getRemindersList(),valuesContainerNode:this.reminderField.innerCont.appendChild(BX.create("SPAN")),addButtonNode:this.reminderField.innerCont.appendChild(BX.create("SPAN",{props:{className:"calendar-notification-btn-container calendar-notification-btn-add"},html:'<span class="calendar-notification-icon"></span>'})),changeCallack:function(d){c.reminderValues=d},showPopupCallBack:function(){c.popup.setAutoHide(false)},hidePopupCallBack:function(){c.popup.setAutoHide(true)}})},createlocationField:function(){this.locationField={outerWrap:this.mainSlide.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-select"}}))};this.locationSelector=new b.BXEventCalendar.LocationSelector(this.calendar.id+"-simple-slider-location",{value:this.entry?this.entry.location:"",wrapNode:this.locationField.outerWrap,getControlContentCallback:BX.delegate(function(){this.prepareSecondSlide({closeCallback:BX.proxy(this.locationSelector.saveValues,this.locationSelector)});this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-title-text"},text:BX.message("EC_MEETING_ROOM_LIST_TITLE")}));return this.secondSlide},this)},this.calendar)},createPlannerField:function(){this.plannerField=this.createField("container-members",this.mainSlide);this.plannerField.innerWrapAttendeesWrap=this.plannerField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-members-selected"},html:"<span>"+BX.message("EC_ATTENDEES_LABEL")+":</span>"}));this.plannerField.currentAttendeesWrap=this.plannerField.innerWrapAttendeesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-attendees-list"}}));this.showAttendees();this.plannerField.plannerLink=this.plannerField.innerWrapAttendeesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-members-change-link"},html:BX.message("EC_ATTENDEES_EDIT"),events:{click:BX.delegate(this.showPlannerSlide,this)}}))},showAttendees:function(){BX.cleanNode(this.plannerField.currentAttendeesWrap);var f,e,d=3,g=this.attendees.length,c=5;if(g>0){if(g>c){g=d}for(f=0;f<g;f++){e=this.attendees[f]||{};this.plannerField.currentAttendeesWrap.appendChild(BX.create("IMG",{attrs:{id:"simple_popup_"+e.id,src:e.smallAvatar||""},props:{className:"calendar-member"}}));(function(h){setTimeout(function(){BX.tooltip(h,"simple_popup_"+h)},100)})(e.id)}if(g<this.attendees.length){this.plannerField.currentAttendeesWrap.appendChild(BX.create("SPAN",{text:BX.message("EC_ATTENDEES_MORE").replace("#COUNT#",this.attendees.length-g)}))}}},showPlannerSlide:function(){this.popup.setAutoHide(false);this.prepareSecondSlide({closeCallback:BX.proxy(this.hidePlannerSlide,this)});this.attendeesSelector=new b.BXEventCalendar.DestinationSelector(this.calendar.id+"-simple-popup-destination",{wrapNode:this.secondSlide,itemsSelected:this.attendeesCodes||this.calendar.util.getSocnetDestinationConfig("itemsSelected"),calendar:this.calendar});this.loader=BX.adjust(this.calendar.util.getLoader(),{style:{height:"180px"}});this.secondSlide.appendChild(this.loader);this.initPlannerControl();this.meetingOptionsWrap=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-meeting-options-wrap"},style:{display:"none"}}));this.notifyField=this.createField("container-checkbox",this.meetingOptionsWrap);this.notifyField.label=this.notifyField.innerWrap.appendChild(BX.create("LABEL",{props:{className:"calendar-field-checkbox-label"},html:BX.message("EC_NOTIFY_STATUS_LABEL")}));this.notifyField.checkbox=this.notifyField.label.appendChild(BX.create("INPUT",{attrs:{type:"checkbox"},props:{className:"calendar-field-checkbox"}}));this.notifyField.checkbox.checked=this.notify},hidePlannerSlide:function(){this.popup.setAutoHide(true);if(this.allowInviteField){this.allowInvite=!!this.allowInviteField.checkbox.checked}if(this.notifyField){this.notify=!!this.notifyField.checkbox.checked}this.destroyDestinationControls()},entryNameChanged:function(){var c=this.nameField.input.value||BX.message("EC_ENTRY_NAME");if(this.params.nameNode){this.params.nameNode.innerHTML=BX.util.htmlspecialchars(c)}if(this.params.changeNameCallback&&typeof this.params.changeNameCallback=="function"){this.params.changeNameCallback(c)}},initPlannerControl:function(){this.plannerId=this.calendar.id+"-simple-planner";this.plannerShown=false;this.plannerWrap=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-planner-wrap"}}));BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.addCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));if(!this.requestPlanner){this.requestPlanner=true;BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_planner",sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",reqId:Math.round(Math.random()*1000000),planner_id:this.plannerId},BX.delegate(function(c){if(this.loader){BX.remove(this.loader)}c=BX.util.trim(c);this.plannerWrap.innerHTML=c;this.requestPlanner=false;this.checkPlannerState()},this))}},onCalendarPlannerSelectorChanged:function(c){if(this.calendar.util.getDayCode(this.entryTime.from)!==this.calendar.util.getDayCode(c.dateFrom)&&this.params.changeDateCallback){this.params.changeDateCallback(c.dateFrom);if(this.popup.angle){this.popup.setAngle(false)}}this.setDateTimeValues(c.dateFrom,c.dateTo)},destroyDestinationControls:function(){if(BX.SocNetLogDestination){if(BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.close()}BX.SocNetLogDestination.closeSearch()}BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.OnCalendarPlannerSelectorChanged,this))},plannerIsShown:function(){return this.plannerWrap&&BX.hasClass(this.plannerWrap,"calendar-add-popup-show-planner")},checkPlannerState:function(){var c={codes:this.attendeesSelector.getCodes(),from:this.calendar.util.formatDate(this.entryTime.from.getTime()-this.calendar.util.dayLength*3),to:this.calendar.util.formatDate(this.entryTime.from.getTime()+this.calendar.util.dayLength*10),location:this.locationSelector.getTextValue()};this.attendeesCodes=this.attendeesSelector.getAttendeesCodes();this.attendeesCodesList=this.attendeesSelector.getAttendeesCodesList(this.attendeesCodes);this.updatePlanner(c)},updatePlanner:function(d){if(!d){d={}}this.plannerLoadedlocation=d.location||"";var e=this,c=0;this.calendar.request({data:{action:"update_planner",codes:d.codes||[],cur_event_id:c,date_from:d.dateFrom||d.from||"",date_to:d.dateTo||d.to||"",timezone:this.timezoneField&&this.timezoneField.select?this.timezoneField.select.value:this.calendar.util.getUserOption("timezoneName"),location:this.plannerLoadedlocation,entries:d.entrieIds||false,add_cur_user_to_list:"N"},handler:function(j){var k,l=[],m={},f=false,h=!!(d.entries||(j.entries&&j.entries.length>0));for(k=0;k<j.entries.length;k++){if(j.entries[k].type=="user"){l.push({id:j.entries[k].id,name:j.entries[k].name,avatar:j.entries[k].avatar,smallAvatar:j.entries[k].smallAvatar||j.entries[k].avatar,url:j.entries[k].url});m[j.entries[k].id]=true;if(!e.attendeesIndex[j.entries[k].id]){f=true}}}if(!f){for(var n in e.attendeesIndex){if(e.attendeesIndex.hasOwnProperty(n)&&!m[n]){f=true;break}}}if(f){e.attendees=l;e.showAttendees()}if(h){var g={show:h&&!e.plannerIsShown()};if(d.entries){j.entries=d.entries;g.scaleFrom=d.from;g.scaleTo=d.to}g.loadedDataFrom=d.from;g.loadedDataTo=d.to;g.data={entries:j.entries,accessibility:j.accessibility};g.focusSelector=d.focusSelector==undefined?false:d.focusSelector;e.refreshPlannerState(g)}else{if(!h&&e.plannerIsShown()){e.hidePlanner()}}}})},refreshPlannerState:function(j){if(!j||typeof j!=="object"){j={}}this.plannerData=j.data;var e=this.calendar.util.getWorkTime(),f={changeFromFullDay:{scaleType:"1hour",timelineCellWidth:40},shownScaleTimeFrom:e.start,shownScaleTimeTo:e.end,width:this.plannerWrap.offsetWidth||400,minWidth:this.plannerWrap.offsetWidth||400,entriesListWidth:50,showEntiesHeader:false,showEntryName:false},c=this.plannerIsShown();if(j.focusSelector==undefined){j.focusSelector=true}if(!c&&!j.data){this.checkPlannerState()}else{if(j.show){BX.addClass(this.plannerWrap,"calendar-add-popup-show-planner");this.meetingOptionsWrap.style.display="";if(!c&&j.show){j.focusSelector=true}}var i=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),h=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),g=new Date(this.entryTime.from.getTime()),d=new Date(this.entryTime.from.getTime());g.setHours(i.h,i.m,0);d.setHours(h.h,h.m,0);BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,config:f,focusSelector:j.focusSelector,selector:{from:g,to:d,fullDay:false,animation:true,updateScaleLimits:true},data:j.data||false,loadedDataFrom:j.loadedDataFrom,loadedDataTo:j.loadedDataTo,show:!!j.show}])}},getBusyUserList:function(){var d,c=[];if(this.plannerData){for(d in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(d)&&this.plannerData.entries[d].id&&this.plannerData.entries[d].status!="h"&&this.plannerData.entries[d].strictStatus&&!this.plannerData.entries[d].currentStatus){c.push(this.plannerData.entries[d])}}}return c},hidePlanner:function(){this.meetingOptionsWrap.style.display="none";this.plannerWrap.style.opacity=0;this.plannerWrap.style.height=0;this.plannerWrap.style.overflow="hidden";BX.removeClass(this.plannerWrap,"calendar-add-popup-show-planner")},keyHandler:function(c){if(c.keyCode==this.calendar.util.KEY_CODES.enter){this.save()}}};if(b.BXEventCalendar){b.BXEventCalendar.SimpleAddPopup=a}else{BX.addCustomEvent(b,"onBXEventCalendarInit",function(){b.BXEventCalendar.SimpleAddPopup=a})}})(window);