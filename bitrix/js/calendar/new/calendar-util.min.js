(function(a){function b(e,d,c){this.calendar=e;this.config=d||{};this.additionalParams=c;this.dayLength=86400000;this.type=this.config.type;this.userId=parseInt(this.config.userId);this.ownerId=parseInt(this.config.ownerId);this.accessNames={};if(this.config.accessNames){this.handleAccessNames(this.config.accessNames)}this.DATE_FORMAT_BX=BX.message("FORMAT_DATE");this.DATETIME_FORMAT_BX=BX.message("FORMAT_DATETIME");if((this.DATETIME_FORMAT_BX.substr(0,this.DATE_FORMAT_BX.length)==this.DATE_FORMAT_BX)){this.TIME_FORMAT_BX=BX.util.trim(this.DATETIME_FORMAT_BX.substr(this.DATE_FORMAT_BX.length))}else{this.TIME_FORMAT_BX=BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS"}this.TIME_FORMAT_SHORT_BX=this.TIME_FORMAT_BX.replace(":SS","");this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if((this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)){this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length))}else{this.TIME_FORMAT=BX.date.convertBitrixFormat(BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS")}this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.KEY_CODES={backspace:8,enter:13,escape:27,space:32,"delete":46,left:37,right:39,up:38,down:40,z:90,y:89,shift:16,ctrl:17,alt:18,cmd:91,cmdRight:93,pageUp:33,pageDown:34}}b.prototype={getEventPath:function(d){var c=this.config.path;c+=(c.indexOf("?")===-1?"?":"&")+"EVENT_ID="+d.id+"&EVENT_DATE="+this.formatDate(d.from);return c},getWeekDays:function(){return this.config.weekDays},getWeekStart:function(){return this.config.weekStart},getWeekEnd:function(){return{MO:"SU",TU:"MO",WE:"TU",TH:"WE",FR:"TH",SA:"FR",SU:"SA"}[this.config.weekStart]},getWeekDayOffset:function(c){if(!this.weekDayOffsetIndex){var d,e=this.getWeekDays();this.weekDayOffsetIndex={};for(d=0;d<e.length;d++){this.weekDayOffsetIndex[e[d][2]]=d}}return this.weekDayOffsetIndex[c]},getWeekDayByInd:function(c){return["SU","MO","TU","WE","TH","FR","SA"][c]},isHoliday:function(e){var f;if(!this.weekHolidays){this.weekHolidays={};for(f in this.config.week_holidays){if(this.config.week_holidays.hasOwnProperty(f)){this.weekHolidays[this.config.week_holidays[f]]=true}}this.yearHolidays={};for(f in this.config.year_holidays){if(this.config.year_holidays.hasOwnProperty(f)){this.yearHolidays[this.config.year_holidays[f]]=true}}this.yearWorkdays={};for(f in this.config.year_workdays){if(this.config.year_workdays.hasOwnProperty(f)){this.yearWorkdays[this.config.year_workdays[f]]=true}}}var d=[6,0,1,2,3,4,5][e.getDay()],c=e.getDate(),g=e.getMonth();return(this.weekHolidays[d]||this.yearHolidays[c+"."+g])&&!this.yearWorkdays[c+"."+g]},isToday:function(d){var c=new Date();return c.getDate()==d.getDate()&&c.getMonth()==d.getMonth()&&c.getFullYear()==d.getFullYear()},getWorkTime:function(){this.config.userWorkTime=this.config.userWorkTime||[];if(this.config.userSettings.work_time_start&&this.config.userSettings.work_time_end){this.workTime={start:Math.floor(parseFloat(this.config.userSettings.work_time_start||9)),end:Math.ceil(parseFloat(this.config.userSettings.work_time_end||18))}}else{this.workTime={start:Math.floor(parseFloat(this.config.userWorkTime[0]||9)),end:Math.ceil(parseFloat(this.config.userWorkTime[1]||18))}}this.getWorkTime=BX.proxy(function(){return this.workTime},this);return this.workTime},setWorkTime:function(c){this.workTime={start:Math.min(Math.max(c.start,0),24),end:Math.min(Math.max(c.end,c.start),24)};BX.userOptions.save("calendar","workTime","start",this.workTime.start);BX.userOptions.save("calendar","workTime","end",this.workTime.end);return this.workTime},formatTime:function(g,c,f){if(BX.type.isDate(g)){c=g.getMinutes();g=g.getHours()}var e="";if(f!==true||!BX.isAmPmMode()){f=false}if(c==undefined){c="00"}else{c=parseInt(c,10);if(isNaN(c)){c="00"}else{if(c>59){c=59}c=(c<10)?"0"+c.toString():c.toString()}}g=parseInt(g,10);if(g>24){g=24}if(isNaN(g)){g=0}if(BX.isAmPmMode()){var d="am";if(g==0){g=12}else{if(g==12){d="pm"}else{if(g>12){d="pm";g-=12}}}if(f){e=g.toString()+" "+d}else{e=g.toString()+":"+c.toString()+" "+d}}else{e=g.toString()+":"+c.toString()}return e},formatDate:function(c){if(BX.type.isDate(c)){c=c.getTime()}return BX.date.format(this.DATE_FORMAT,c/1000)},formatDateTime:function(c){if(BX.type.isDate(c)){c=c.getTime()}return BX.date.format(this.DATETIME_FORMAT,c/1000)},formatDateUsable:function(c,e){var d=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));if(BX.message("LANGUAGE_ID")=="ru"||BX.message("LANGUAGE_ID")=="ua"){d="j F";if(c.getFullYear&&c.getFullYear()!=new Date().getFullYear()&&e!==false){d+=" Y"}}return BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",d]],c)},parseTime:function(d){var c=this.parseDate(BX.date.format(this.DATE_FORMAT,new Date())+" "+d,false);return c?{h:c.getHours(),m:c.getMinutes()}:c},parseDate:function(n,u,f){var r,q,p,g,v=false;if(!u){u=BX.message("FORMAT_DATETIME")}n=BX.util.trim(n);if(f!==false){u=u.replace(":SS","")}if(BX.type.isNotEmptyString(n)){g="";for(r=1;r<=12;r++){g=g+"|"+BX.message("MON_"+r)}var e=new RegExp("([0-9]+|[a-z]+"+g+")","ig"),y=n.match(e),j=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/ig),s=[],l=[],c={};if(!y){return null}if(y.length>j.length){j=u.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/ig)}for(r=0,q=y.length;r<q;r++){if(BX.util.trim(y[r])!=""){s[s.length]=y[r]}}for(r=0,q=j.length;r<q;r++){if(BX.util.trim(j[r])!=""){l[l.length]=j[r]}}var o=BX.util.array_search("MMMM",l);if(o>0){s[o]=BX.getNumMonth(s[o]);l[o]="MM"}else{o=BX.util.array_search("M",l);if(o>0){s[o]=BX.getNumMonth(s[o]);l[o]="MM"}}for(r=0,q=l.length;r<q;r++){p=l[r].toUpperCase();c[p]=p=="T"||p=="TT"?s[r]:parseInt(s[r],10)}if(c.DD>0&&c.MM>0&&c.YYYY>0){var x=new Date();if(v){x.setUTCDate(1);x.setUTCFullYear(c.YYYY);x.setUTCMonth(c.MM-1);x.setUTCDate(c.DD);x.setUTCHours(0,0,0)}else{x.setDate(1);x.setFullYear(c.YYYY);x.setMonth(c.MM-1);x.setDate(c.DD);x.setHours(0,0,0)}if((!isNaN(c.HH)||!isNaN(c.GG)||!isNaN(c.H)||!isNaN(c.G))&&!isNaN(c.MI)){if(!isNaN(c.H)||!isNaN(c.G)){var w=(c.T||c.TT||"am").toUpperCase()=="PM";var t=parseInt(c.H||c.G||0,10);if(w){c.HH=t+(t==12?0:12)}else{c.HH=t<12?t:0}}else{c.HH=parseInt(c.HH||c.GG||0,10)}if(isNaN(c.SS)){c.SS=0}if(v){x.setUTCHours(c.HH,c.MI,c.SS)}else{x.setHours(c.HH,c.MI,c.SS)}}return x}}return null},findTargetNode:function(f,e){if(f){var d=false,g="data-bx-calendar",c;if(!e){e=this.calendar.viewsCont}if(f.attributes&&f.attributes.length){for(c=0;c<f.attributes.length;c++){if(f.attributes[c].name&&f.attributes[c].name.substr(0,g.length)==g){d=f;break}}}if(!d){d=BX.findParent(f,function(i){var h;if(i.attributes&&i.attributes.length){for(h=0;h<i.attributes.length;h++){if(i.attributes[h].name&&i.attributes[h].name.substr(0,g.length)==g){return true}}}return false},e)}}return d},getViewHeight:function(){var d=756,c=BX.GetWindowInnerSize(document).innerHeight-300;return Math.max(d,c)},showWeekNumber:function(){return this.getUserOption("showWeekNumbers","N")=="Y"},getScrollbarWidth:function(){var g=this.calendar.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-outer"}})),e=g.offsetWidth;g.style.overflow="scroll";var d=g.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-inner"}})),f=d.offsetWidth,c=e-f;BX.cleanNode(g,true);this.getScrollbarWidth=function(){return c};return c},getMessagePlural:function(c,e){var d,f;f=BX.message("LANGUAGE_ID")||"en";e=parseInt(e);if(e<0){e=-1*e}if(f){switch(f){case"de":case"en":d=((e!==1)?1:0);break;case"ru":case"ua":d=(((e%10===1)&&(e%100!==11))?0:(((e%10>=2)&&(e%10<=4)&&((e%100<10)||(e%100>=20)))?1:2));break;default:d=1;break}}else{d=1}return BX.message(c+"_PLURAL_"+d)},getUserOption:function(d,c){if(this.config.userSettings[d]===undefined){return c}return this.config.userSettings[d]},setUserOption:function(c,d){if(this.config.userSettings[c]!==d){BX.userOptions.save("calendar","user_settings",c,d);this.config.userSettings[c]=d}},getKeyCodes:function(){return this.KEY_CODES},getMousePos:function(d){if(!d){d=a.event}var c=0,f=0;if(d.pageX||d.pageY){c=d.pageX;f=d.pageY}else{if(d.clientX||d.clientY){c=d.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;f=d.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}}return{x:c,y:f}},getDayCode:function(c){return c.getFullYear()+"-"+("0"+(~~(c.getMonth()+1))).substr(-2,2)+"-"+("0"+(~~(c.getDate()))).substr(-2,2)},getTextColor:function(e){if(!e){return false}if(e.charAt(0)=="#"){e=e.substring(1,7)}var h=parseInt(e.substring(0,2),16),f=parseInt(e.substring(2,4),16),c=parseInt(e.substring(4,6),16),d=(h*0.8+f+c*0.2)/510*100;return d<50},getTimeValue:function(c){return c.getHours()+Math.round(c.getMinutes()*100/60)/100},getTimeEx:function(c){return Math.round(c.getTime()/60000)*60000},getTimeByFraction:function(g,d){d=d||5;g=Math.min(Math.max(g,0),24);var f=true,e=Math.floor(g),c=f?(Math.floor((g-e)*60/d)*d):(Math.round((g-e)*60/d)*d);if(c==60){c=0;e++}if(e==24&&c==0){e=23;c=59}return{h:e,m:c}},getWeekNumberInMonthByDate:function(d){var c=new Date();c.setFullYear(d.getFullYear(),d.getMonth(),1);return parseInt(BX.date.format("W",d.getTime()/1000))-parseInt(BX.date.format("W",c.getTime()/1000))},getRemindersList:function(){if(!this.reminderList){this.reminderList=[{value:0,label:BX.message("EC_REMIND_0"),shortLabel:BX.message("EC_REMIND_SHORT_0")},{value:5,label:BX.message("EC_REMIND_5"),shortLabel:BX.message("EC_REMIND_SHORT_5")},{value:10,label:BX.message("EC_REMIND_10"),shortLabel:BX.message("EC_REMIND_SHORT_10")},{value:15,label:BX.message("EC_REMIND_15"),shortLabel:BX.message("EC_REMIND_SHORT_15")},{value:30,label:BX.message("EC_REMIND_30"),shortLabel:BX.message("EC_REMIND_SHORT_30")},{value:60,label:BX.message("EC_REMIND_60"),shortLabel:BX.message("EC_REMIND_SHORT_60")},{value:120,label:BX.message("EC_REMIND_120"),shortLabel:BX.message("EC_REMIND_SHORT_120")},{value:1440,label:BX.message("EC_REMIND_1440"),shortLabel:BX.message("EC_REMIND_SHORT_1440")},{value:2880,label:BX.message("EC_REMIND_2880"),shortLabel:BX.message("EC_REMIND_SHORT_2880")}]}return this.reminderList},getSimpleTimeList:function(){var d,c=[];for(d=0;d<24;d++){c.push({value:d*60,label:this.formatTime(d,0)});c.push({value:d*60+30,label:this.formatTime(d,30)})}this.getSimpleTimeList=function(){return c};return c},adaptTimeValue:function(d){d=parseInt(d.h*60)+parseInt(d.m);var g=this.getSimpleTimeList(),f=24*60,e=false,c;for(c=0;c<g.length;c++){if(Math.abs(g[c].value-d)<f){f=Math.abs(g[c].value-d);e=c;if(f<=15){break}}}return g[e||0]},getMeetingRoomList:function(){return this.config.meetingRooms||[]},getLocationList:function(){return this.additionalParams.locationList||[]},setLocationList:function(c){this.additionalParams.locationList=c},mergeSocnetDestinationConfig:function(c){if(c.USERS){for(var d in c.USERS){if(c.USERS.hasOwnProperty(d)&&!this.additionalParams.socnetDestination.USERS[d]){this.additionalParams.socnetDestination.USERS[d]=c.USERS[d]}}}},getSocnetDestinationConfig:function(e){var d,c=this.additionalParams.socnetDestination||{};if(e=="items"){d={users:c.USERS||{},groups:c.EXTRANET_USER=="Y"||c.DENY_TOALL?{}:{UA:{id:"UA",name:c.DEPARTMENT?BX.message("EC_SOCNET_DESTINATION_4"):BX.message("EC_SOCNET_DESTINATION_3")}},sonetgroups:c.SONETGROUPS||{},department:c.DEPARTMENT||{},departmentRelation:c.DEPARTMENT_RELATION||{}}}else{if(e=="itemsLast"&&c.LAST){d={users:c.LAST.USERS||{},groups:c.EXTRANET_USER=="Y"?{}:{UA:true},sonetgroups:c.LAST.SONETGROUPS||{},department:c.LAST.DEPARTMENT||{}}}else{if(e=="itemsSelected"){d=c.SELECTED||{}}}}return d||{}},getActionUrl:function(){return this.config.actionUrl},getTimezoneList:function(){return this.additionalParams.timezoneList||[]},getDefaultColors:function(){return this.additionalParams.defaultColorsList},getFormSettings:function(c){return this.additionalParams.formSettings&&this.additionalParams.formSettings[c]?this.additionalParams.formSettings[c]:{}},saveFormSettings:function(d,c){if(d){BX.userOptions.save("calendar",d,"pinnedFields",c.pinnedFields)}},randomInt:function(d,c){return Math.round(d-0.5+Math.random()*(c-d+1))},handleAccessNames:function(d){for(var c in d){if(d.hasOwnProperty(c)){this.accessNames[c]=d[c]}}},getAccessName:function(c){return this.accessNames[c]||c},getSectionAccessTasks:function(){return this.config.sectionAccessTasks},getTypeAccessTasks:function(){return this.config.typeAccessTasks},getDefaultTypeAccessTask:function(){var c,d=this.getTypeAccessTasks();for(c in d){if(d.hasOwnProperty(c)&&d[c].name=="calendar_type_view"){break}}this.getDefaultTypeAccessTask=function(){return c};return c},getDefaultSectionAccessTask:function(){var c,d=this.getSectionAccessTasks();for(c in d){if(d.hasOwnProperty(c)&&d[c].name=="calendar_view"){break}}this.getDefaultSectionAccessTask=function(){return c};return c},getSuperposedTrackedUsers:function(){return(this.config.trackingUsersList||[]).sort(function(d,c){if(!d.LAST_NAME){d.LAST_NAME=""}if(!c.LAST_NAME){c.LAST_NAME=""}return d.LAST_NAME.localeCompare(c.LAST_NAME)})},getSuperposedTrackedGroups:function(){return this.config.trackingGroupList||[]},isUserCalendar:function(){return this.type==="user"},isGroupCalendar:function(){return this.type==="group"},userIsOwner:function(){return this.isUserCalendar()&&this.userId===this.ownerId},hexToRgb:function(d){var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},hexToRgba:function(e,d){var c=this.hexToRgb(e);if(!c){c=this.hexToRgb("#9dcf00")}return"rgba("+c.r+", "+c.g+", "+c.b+", "+d+")"},parseLocation:function(e){if(!e){e=""}var c,d={type:false,value:false,str:e};if(e.length>5&&e.substr(0,5)=="ECMR_"){d.type="mr";c=e.split("_");if(c.length>=2){if(!isNaN(parseInt(c[1]))&&parseInt(c[1])>0){d.value=d.mrid=parseInt(c[1])}if(!isNaN(parseInt(c[2]))&&parseInt(c[2])>0){d.mrevid=parseInt(c[2])}}}else{if(e.length>5&&e.substr(0,9)=="calendar_"){d.type="calendar";c=e.split("_");if(c.length>=2){if(!isNaN(parseInt(c[1]))&&parseInt(c[1])>0){d.value=d.room_id=parseInt(c[1])}if(!isNaN(parseInt(c[2]))&&parseInt(c[2])>0){d.room_event_id=parseInt(c[2])}}}}return d},getTextLocation:function(c){var f=typeof c==="object"?c:this.parseLocation(c),d,h=f.str;if(f.type=="mr"){var e=this.calendar.util.getMeetingRoomList();for(d=0;d<e.length;d++){if(f.value==e[d].ID){h=e[d].NAME;break}}}if(f.type=="calendar"){var g=this.calendar.util.getLocationList();for(d=0;d<g.length;d++){if(f.value==g[d].ID){h=g[d].NAME;break}}}return h},getTextReminder:function(c){if(BX.util.in_array(c,[0,5,10,15,30,60,120,1440,2880])){return BX.message("EC_REMIND_SHORT_"+c)}return""},getEditTaskPath:function(){return this.config.editTaskPath},getViewTaskPath:function(c){return this.config.viewTaskPath.replace("#task_id#",c)},readOnlyMode:function(){this.readOnly=this.config.readOnly;if(!this.readOnly){var c=this.calendar.sectionController.getSectionListForEdit();if(!c||!c.length){this.readOnly=true}}this.readOnlyMode=BX.proxy(function(){return this.readOnly},this);return this.readOnly},getLoader:function(c){var d=c?'style="width: '+parseInt(c)+"px; height: "+parseInt(c)+'px;"':"";return BX.create("DIV",{props:{className:"calendar-loader"},html:'<svg class="calendar-loader-circular"'+d+' viewBox="25 25 50 50"><circle class="calendar-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/><circle class="calendar-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/></svg>'})},applyHacksForPopupzIndex:function(){var d=3200;if(BX.PopupMenu&&BX.PopupMenu.Data){for(var c in BX.PopupMenu.Data){if(BX.PopupMenu.Data.hasOwnProperty(c)&&BX.PopupMenu.Data[c].popupWindow&&BX.PopupMenu.Data[c].popupWindow.isShown()){BX.PopupMenu.Data[c].popupWindow.params.zIndex=d;BX.PopupMenu.Data[c].popupWindow.popupContainer.style.zIndex=d}}}},applyHacksHandlersForPopupzIndex:function(){var d=this,c=3200;BX.addCustomEvent("onPopupShow",function(e){if(d.calendar.viewSlider&&d.calendar.viewSlider.isOpened()||d.calendar.editSlider&&d.calendar.editSlider.isOpened()){e.params.zIndex=c;e.popupContainer.style.zIndex=c}})},isFilterEnabled:function(){return this.userIsOwner()&&this.config.counters},getCalDavConnections:function(){return this.config.connections||[]},isRichLocationEnabled:function(){return !!this.config.locationFeatureEnabled},isDarkColor:function(e){e=e.toLowerCase();if({"#9dcf00":true,"#2FC6F6":true,"#56D1E0":true,"#FFA900":true,"#47E4C2":true,"#F87396":true,"#9985DD":true,"#A8ADB4":true,"#AF7E00":true}[e]){return false}if(!e){return false}if(e.charAt(0)=="#"){e=e.substring(1,7)}var h=parseInt(e.substring(0,2),16),f=parseInt(e.substring(2,4),16),c=parseInt(e.substring(4,6),16),d=(h*0.8+f+c*0.2)/510*100;return d<50}};if(a.BXEventCalendar){a.BXEventCalendar.Util=b}else{BX.addCustomEvent(a,"onBXEventCalendarInit",function(){a.BXEventCalendar.Util=b})}})(window);