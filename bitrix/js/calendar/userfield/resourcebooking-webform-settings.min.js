(function(){BX.namespace("BX.Calendar.UserField");function d(u){this.params=u;this.complexFields={};this.userFieldParams=null;this.id="resbook-settings-popup-"+Math.round(Math.random()*100000);this.params.settings.data=this.settingsData=this.getSettingsData(this.params.settings.data);this.DOM={innerWrap:this.params.innerWrap,settingsWrap:this.params.innerWrap.appendChild(BX.create("div",{attrs:{"data-bx-resource-field-settings":"Y"}})),captionNode:this.params.captionNode,settingsInputs:{}}}BX.Calendar.UserField.CrmFormResourceBookingField=d;d.prototype={init:function(){this.showFieldLoader();BX.Calendar.UserField.getUserFieldParams({fieldName:this.params.entityName,selectedUsers:this.getSelectedUsers()}).then(BX.delegate(function(u){this.hideFieldLoader();this.userFieldParams=u;this.fieldLayout=new BX.Calendar.UserField.ResourceBookingFieldViewLayout({wrap:this.DOM.innerWrap,displayTitle:false,title:this.getCaption(),settings:this.getSettings()});this.fieldLayout.build();this.updateSettingsDataInputs()},this))},showSettingsPopup:function(){BX.Calendar.UserField.getUserFieldParams({fieldName:this.params.entityName,selectedUsers:this.getSelectedUsers()}).then(BX.delegate(function(u){this.userFieldParams=u;this.settingsPopupId="calendar-resourcebooking-settings-popup-"+Math.round(Math.random()*100000);this.settingsPopup=new BX.PopupWindow(this.settingsPopupId,null,{content:this.getSettingsContentNode(),className:"calendar-resbook-webform-settings-popup-window",autoHide:false,lightShadow:true,closeByEsc:true,overlay:{backgroundColor:"black",opacity:500},zIndex:-400,titleBar:BX.message("WEBF_RES_SETTINGS"),closeIcon:true,buttons:[new BX.PopupWindowButton({})]});var v=this.settingsPopup.buttons[0].buttonNode.parentNode;BX.remove(this.settingsPopup.buttons[0].buttonNode);this.settingsPopup.buttons[0].buttonNode=v.appendChild(BX.create("button",{props:{className:"ui-btn ui-btn-success"},events:{click:BX.proxy(function(){this.settingsPopup.close()},this)},text:BX.message("WEBF_RES_CLOSE_SETTINGS_POPUP")}));BX.removeClass(this.settingsPopup.buttons[0].buttonNode,"popup-window-button");this.settingsPopup.show();BX.addCustomEvent(this.settingsPopup,"onPopupClose",BX.delegate(function(w){this.destroyControls();this.settingsPopup.destroy(this.id);this.settingsPopup=null;if(this.previewFieldLayout){this.previewFieldLayout.destroy()}},this))},this))},getSettingsContentNode:function(){var v=BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup"}});var w=v.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-inner"}}));this.buildSettingsForm({wrap:w});var u=v.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-preview"}}));this.previewFieldLayout=new BX.Calendar.UserField.ResourceBookingFieldPreviewLayout({wrap:u,title:this.getCaption(),settings:this.getSettings()});this.previewFieldLayout.build();BX.addCustomEvent("ResourceBooking.webformSettings:onChanged",BX.proxy(this.handleWebformSettingsChanges,this));return v},buildSettingsForm:function(x){var v=this.getSettings(),u=x.wrap,w="title-"+this.id;this.DOM.captionWrap=u.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-title"},html:'<label for="'+w+'" class="calendar-resbook-webform-settings-popup-label">'+BX.message("WEBF_RES_NAME_LABEL")+"</label>"}));this.DOM.captionInput=this.DOM.captionWrap.appendChild(BX.create("input",{attrs:{id:w,className:"calendar-resbook-webform-settings-popup-input",type:"text",value:this.getCaption()},events:{change:BX.proxy(this.updateCaption,this),blur:BX.proxy(this.updateCaption,this),keyup:BX.proxy(this.updateCaption,this)}}));this.updateCaption();this.DOM.fieldsOuterWrap=u.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-content"},html:'<div class="calendar-resbook-webform-settings-popup-head"><div class="calendar-resbook-webform-settings-popup-head-inner"><span class="calendar-resbook-webform-settings-popup-head-text">'+BX.message("WEBF_RES_FIELD_NAME")+'</span><span class="calendar-resbook-webform-settings-popup-head-decs">'+BX.message("WEBF_RES_FIELD_NAME_IN_FORM")+'</span></div><div class="calendar-resbook-webform-settings-popup-head-inner"><span class="calendar-resbook-webform-settings-popup-head-text">'+BX.message("WEBF_RES_FIELD_SHOW_IN_FORM")+"</span></div></div>"}));this.DOM.fieldsWrap=this.DOM.fieldsOuterWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-list"}}));if(v.userfieldSettings.useUsers){this.buildComplexField("users",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:v.data.users,config:{users:v.userfieldSettings.users,selected:v.data.users.value}});BX.addCustomEvent("ResourceBooking.settingsUserSelector:onChanged",BX.proxy(this.checkBitrix24Limitation,this))}if(v.userfieldSettings.useResources){this.buildComplexField("resources",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:v.data.resources,config:{resources:v.userfieldSettings.resources,selected:v.data.resources.value}})}if(v.userfieldSettings.useServices){this.buildComplexField("services",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:v.data.services,config:{services:v.userfieldSettings.services,selected:v.data.services.value}})}else{this.buildComplexField("duration",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:v.data.duration})}this.buildComplexField("date",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:v.data.date});if(!v.userfieldSettings.fullDay){this.buildComplexField("time",{wrap:this.DOM.fieldsWrap,changeSettingsCallback:BX.delegate(this.updateSettings,this),params:v.data.time})}this.DOM.fieldsWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-item"},html:'<div class="calendar-resbook-webform-settings-popup-decs">'+(BX.message("WEBF_RES_BOOKING_SETTINGS_HELP").replace("#START_LINK#",'<a href="javascript:void(0);" onclick="if (top.BX.Helper){top.BX.Helper.show(\'redirect=detail&code=8366733\');}">').replace("#END_LINK#","</a>"))+"</div>"}))},destroyControls:function(){for(var u in this.complexFields){if(this.complexFields.hasOwnProperty(u)&&BX.type.isFunction(this.complexFields[u].destroy)){this.complexFields[u].destroy()}}},handleWebformSettingsChanges:function(){if(this.refreshLayoutTimeout){this.refreshLayoutTimeout=clearTimeout(this.refreshLayoutTimeout)}this.refreshLayoutTimeout=setTimeout(BX.delegate(function(){for(var u in this.complexFields){if(this.complexFields.hasOwnProperty(u)&&BX.type.isFunction(this.complexFields[u].getValue)){this.settingsData[u]=this.complexFields[u].getValue()}}this.updateSettingsDataInputs();this.previewFieldLayout.refreshLayout(this.settingsData);this.fieldLayout.refreshLayout(this.settingsData);this.previewFieldLayout.getOuterWrap().style.maxHeight=Math.round(this.previewFieldLayout.getInnerWrap().offsetHeight*0.73)+"px"},this),100)},buildComplexField:function(u,v){switch(u){case"users":this.complexFields[u]=new o();break;case"resources":this.complexFields[u]=new p();break;case"services":this.complexFields[u]=new b();break;case"duration":this.complexFields[u]=new l();break;case"date":this.complexFields[u]=new c();break;case"time":this.complexFields[u]=new r();break}this.complexFields[u].build(v)},getSettingsData:function(w){var x,u,v=BX.clone(this.getDefaultSettingsData(),true);if(BX.type.isPlainObject(w)){for(x in w){if(w.hasOwnProperty(x)&&v[x]){if(BX.type.isPlainObject(w[x])){for(u in w[x]){if(w[x].hasOwnProperty(u)){v[x][u]=w[x][u]}}}else{v[x]=w[x]}}}}return v},getDefaultSettingsData:function(){return{users:{show:"Y",label:BX.message("WEBF_RES_USERS_LABEL"),defaultMode:"auto",value:null},resources:{show:"Y",label:BX.message("WEBF_RES_RESOURCES_LABEL"),defaultMode:"auto",multiple:"N",value:null},services:{show:"Y",label:BX.message("WEBF_RES_SERVICE_LABEL"),value:null},duration:{show:"Y",label:BX.message("WEBF_RES_DURATION_LABEL"),defaultValue:60,manualInput:"N"},date:{label:BX.message("WEBF_RES_DATE_LABEL"),style:"line",start:"today"},time:{label:BX.message("WEBF_RES_TIME_LABEL"),style:"slots",showOnlyFree:"Y",showFinishTime:"N",scale:60}}},getSelectedUsers:function(){return this.settingsData&&this.settingsData.users&&BX.type.isString(this.settingsData.users.value)?this.settingsData.users.value.split("|"):[]},updateSettingsDataInputs:function(){var v,u;for(v in this.settingsData){if(this.settingsData.hasOwnProperty(v)){if(BX.type.isPlainObject(this.settingsData[v])){for(u in this.settingsData[v]){if(this.settingsData[v].hasOwnProperty(u)){this.updateSettingsInputValue([v,u],this.settingsData[v][u])}}}else{this.updateSettingsInputValue([v],this.settingsData[v])}}}},updateSettingsInputValue:function(u,v){var w=u.join("-");if(!this.DOM.settingsInputs[w]){this.DOM.settingsInputs[w]=this.DOM.settingsWrap.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.params.formName+"[SETTINGS_DATA]["+u.join("][")+"]"}}))}if(BX.type.isArray(v)){v=v.join("|")}this.DOM.settingsInputs[w].value=v},showFieldLoader:function(){if(this.DOM.innerWrap){this.hideFieldLoader();this.DOM.fieldLoader=this.DOM.innerWrap.appendChild(BX.Calendar.UserField.ResourceBooking.getLoader(100))}},hideFieldLoader:function(){BX.remove(this.DOM.fieldLoader)},getSettings:function(){if(!this.params.settings.userfieldSettings){this.params.settings.userfieldSettings={resources:this.userFieldParams.SETTINGS.SELECTED_RESOURCES,users:this.userFieldParams.SETTINGS.SELECTED_USERS,services:this.userFieldParams.SETTINGS.SERVICE_LIST,fullDay:this.userFieldParams.SETTINGS.FULL_DAY==="Y",useResources:this.userFieldParams.SETTINGS.USE_RESOURCES==="Y"&&this.userFieldParams.SETTINGS.SELECTED_RESOURCES.length,useUsers:this.userFieldParams.SETTINGS.USE_USERS==="Y",useServices:this.userFieldParams.SETTINGS.USE_SERVICES==="Y",resourceLimit:this.userFieldParams.SETTINGS.RESOURCE_LIMIT,userIndex:this.userFieldParams.SETTINGS.USER_INDEX}}return this.params.settings},updateSettings:function(u){},getCaption:function(){return this.params.settings.caption},updateCaption:function(){var u=this.DOM.captionInput.value;if(this.params.settings.caption!==u||!this.DOM.settingsInputs.caption){this.params.settings.caption=u;if(this.previewFieldLayout){this.previewFieldLayout.updateTitle(this.params.settings.caption)}if(!this.DOM.settingsInputs.caption){this.DOM.settingsInputs.caption=this.DOM.settingsWrap.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.params.formName+"[CAPTION]"}}))}this.DOM.settingsInputs.caption.value=this.params.settings.caption;if(this.DOM.captionNode){BX.adjust(this.DOM.captionNode,{text:this.params.settings.caption})}}},isRequired:function(){return this.params.settings.required==="Y"},updateRequiredValue:function(){this.params.settings.required=this.DOM.requiredCheckbox.checked?"Y":"N";if(!this.DOM.settingsInputs.required){this.DOM.settingsInputs.required=this.DOM.settingsWrap.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.params.formName+"[REQUIRED]"}}))}this.DOM.settingsInputs.required.value=this.params.settings.required},checkBitrix24Limitation:function(){var w=0,v=this.getSettings();if(BX.type.isArray(this.params.settings.userfieldSettings.resources)){w+=this.params.settings.userfieldSettings.resources.length}if(v.userfieldSettings.useUsers&&this.complexFields.users){var u=this.complexFields.users.getValue();if(u&&BX.type.isArray(u.value)){w+=u.value.length}}if(v.userfieldSettings.resourceLimit>0&&w>v.userfieldSettings.resourceLimit){BX.Calendar.UserField.ResourceBooking.showLimitationPopup()}}};function e(){this.label="";this.formLabel="";this.displayed=false;this.displayCheckboxDisabled=false;this.DOM={}}e.prototype={build:function(u){this.updateConfig(u.params);this.DOM.fieldWrap=BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-item"}});this.DOM.labelWrap=this.DOM.fieldWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-field"}}));this.DOM.labelNode=this.DOM.labelWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-title"},text:this.getLabel()}));this.DOM.formTitleWrap=this.DOM.labelWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-subtitle"+(this.isDisplayed()?" show":"")}}));this.DOM.formTitleLabel=this.DOM.formTitleWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-subtitle-text"},text:this.getFormLabel(),events:{click:BX.proxy(this.enableFormTitleEditMode,this)}}));this.DOM.formTitleEditIcon=this.DOM.formTitleWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-field-edit"},events:{click:BX.proxy(this.enableFormTitleEditMode,this)}}));this.DOM.checkboxNode=this.DOM.fieldWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-checkbox-container"}})).appendChild(BX.create("input",{attrs:{type:"checkbox",value:"Y",checked:this.isDisplayed(),disabled:this.displayCheckboxDisabled},events:{click:BX.delegate(this.checkDisplayMode,this)}}));this.buildStatePopup({wrap:this.DOM.fieldWrap,config:u.config||{}});this.buildValuePopup({wrap:this.DOM.fieldWrap,config:u.config||{}});if(BX.type.isFunction(u.changeSettingsCallback)){this.changeSettingsCallback=u.changeSettingsCallback}u.wrap.appendChild(this.DOM.fieldWrap)},destroy:function(){if(this.valuePopup&&BX.type.isFunction(this.valuePopup.closePopup)){this.valuePopup.closePopup()}if(this.statePopup&&BX.type.isFunction(this.statePopup.closePopup)){this.statePopup.closePopup()}},updateConfig:function(u){this.setFormLabel(u.label||this.formLabel);if(u.show){this.displayed=u.show!=="N"}},buildStatePopup:function(u){},buildValuePopup:function(u){},getLabel:function(){return this.label},getFormLabel:function(){return this.formLabel},setFormLabel:function(u){this.formLabel=u||""},isDisplayed:function(){return this.displayed},checkDisplayMode:function(){this.displayed=!!this.DOM.checkboxNode.checked;if(this.displayed){this.displayInForm()}else{this.hideInForm()}},displayInForm:function(){BX.addClass(this.DOM.formTitleWrap,"show");this.triggerChangeRefresh()},hideInForm:function(){BX.removeClass(this.DOM.formTitleWrap,"show");this.triggerChangeRefresh()},enableFormTitleEditMode:function(){if(!this.DOM.formTitleInputNode){this.DOM.formTitleInputNode=this.DOM.formTitleWrap.appendChild(BX.create("input",{attrs:{type:"text",className:"calendar-resbook-webform-settings-popup-field-subtitle-text"},events:{blur:BX.proxy(this.finishFormTitleEditMode,this)}}))}this.DOM.formTitleInputNode.value=this.getFormLabel();this.DOM.formTitleInputNode.style.display="";this.DOM.formTitleLabel.style.display="none";this.DOM.formTitleEditIcon.style.display="none";this.DOM.formTitleInputNode.focus()},finishFormTitleEditMode:function(){this.setFormLabel(this.DOM.formTitleInputNode.value);BX.adjust(this.DOM.formTitleLabel,{text:this.getFormLabel()});this.DOM.formTitleLabel.style.display="";this.DOM.formTitleEditIcon.style.display="";this.DOM.formTitleInputNode.style.display="none";this.triggerChangeRefresh()},getSettingsValue:function(){},triggerChangeRefresh:function(){setTimeout(BX.delegate(function(){BX.onCustomEvent("ResourceBooking.webformSettings:onChanged")},this),50)}};function o(){o.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_USERS");this.formLabel=BX.message("WEBF_RES_USERS_LABEL");this.displayed=true}BX.extend(o,e);o.prototype.updateConfig=function(u){o.superclass.updateConfig.apply(this,arguments);this.defaultMode=u.defaultMode};o.prototype.buildStatePopup=function(u){u.isDisplayed=BX.proxy(this.isDisplayed,this);u.defaultMode=u.defaultMode||this.defaultMode;this.statePopup=new t(u)};o.prototype.buildValuePopup=function(u){this.valuePopup=new a(u)};o.prototype.displayInForm=function(){o.superclass.displayInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setEnabled()};o.prototype.hideInForm=function(){o.superclass.hideInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setDisabled()};o.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),defaultMode:this.statePopup.getDefaultMode(),value:this.valuePopup.getSelectedValues()}};function p(){p.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_RESOURCES");this.formLabel=BX.message("WEBF_RES_RESOURCES_LABEL");this.displayed=true}BX.extend(p,e);p.prototype.updateConfig=function(u){p.superclass.updateConfig.apply(this,arguments);this.defaultMode=u.defaultMode;this.multiple=u.multiple==="Y"};p.prototype.buildStatePopup=function(u){u.isDisplayed=BX.proxy(this.isDisplayed,this);u.defaultMode=u.defaultMode||this.defaultMode;u.multiple=u.multiple==null?this.multiple:u.multiple;this.statePopup=new f(u)};p.prototype.buildValuePopup=function(u){this.valuePopup=new g(u)};p.prototype.displayInForm=function(){p.superclass.displayInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setEnabled()};p.prototype.hideInForm=function(){p.superclass.hideInForm.apply(this,arguments);this.statePopup.handleControlChanges();this.statePopup.setDisabled()};p.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),defaultMode:this.statePopup.getDefaultMode(),multiple:this.statePopup.getMultiple()?"Y":"N",value:this.valuePopup.getSelectedId()}};function b(){b.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_SERVICES");this.formLabel=BX.message("WEBF_RES_SERVICE_LABEL");this.displayed=true}BX.extend(b,e);b.prototype.buildStatePopup=function(u){if(u&&BX.type.isDomNode(u.wrap)){u.wrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-select disabled"},html:'<span class="calendar-resbook-webform-settings-popup-select-value">'+BX.message("WEBF_RES_FROM_LIST")+"</span>"}))}};b.prototype.buildValuePopup=function(u){this.valuePopup=new n(u)};b.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),value:this.valuePopup.getSelectedValues()}};function l(){l.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_DURATION");this.formLabel=BX.message("WEBF_RES_DURATION_LABEL")}BX.extend(l,e);l.prototype.updateConfig=function(u){l.superclass.updateConfig.apply(this,arguments);this.defaultValue=u.defaultValue;this.manualInput=u.manualInput==="Y"};l.prototype.buildStatePopup=function(u){u.isDisplayed=BX.proxy(this.isDisplayed,this);u.defaultValue=this.defaultValue;u.manualInput=this.manualInput;this.statePopup=new k(u)};l.prototype.displayInForm=function(){l.superclass.displayInForm.apply(this,arguments);this.statePopup.handleControlChanges()};l.prototype.hideInForm=function(){l.superclass.hideInForm.apply(this,arguments);this.statePopup.handleControlChanges()};l.prototype.getValue=function(){return{show:this.isDisplayed()?"Y":"N",label:this.getFormLabel(),defaultValue:this.statePopup.getDefaultValue(),manualInput:this.statePopup.getManualInput()?"Y":"N"}};function c(){c.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_DATE");this.formLabel=BX.message("WEBF_RES_DATE_LABEL");this.displayed=true;this.displayCheckboxDisabled=true}BX.extend(c,e);c.prototype.updateConfig=function(u){c.superclass.updateConfig.apply(this,arguments);this.style=u.style;this.start=u.start};c.prototype.buildStatePopup=function(u){u.style=u.style||this.style;u.start=u.start||this.start;this.statePopup=new s(u)};c.prototype.getValue=function(){return{label:this.getFormLabel(),style:this.statePopup.getStyle(),start:this.statePopup.getStart()}};function r(){r.superclass.constructor.apply(this,arguments);this.label=BX.message("WEBF_RES_TIME");this.formLabel=BX.message("WEBF_RES_TIME_LABEL");this.displayed=true;this.displayCheckboxDisabled=true}BX.extend(r,e);r.prototype.updateConfig=function(u){r.superclass.updateConfig.apply(this,arguments);this.style=u.style;this.showOnlyFree=u.showOnlyFree==="Y";this.showFinishTime=u.showFinishTime==="Y";this.scale=parseInt(u.scale)};r.prototype.buildStatePopup=function(u){u.style=u.style||this.style;u.showOnlyFree=this.showOnlyFree;u.showFinishTime=this.showFinishTime;u.scale=this.scale;this.statePopup=new i(u)};r.prototype.getValue=function(){return{label:this.getFormLabel(),style:this.statePopup.getStyle(),showFinishTime:this.statePopup.getShowFinishTime(),showOnlyFree:this.statePopup.getShowOnlyFree(),scale:this.statePopup.getScale()}};function h(u){this.id="resourcebooking-settings-popup-"+Math.round(Math.random()*100000);this.menuItems=[];this.DOM={outerWrap:u.wrap}}h.prototype={build:function(){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-select"}}));this.DOM.currentStateLink=this.DOM.innerWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-select-value"},text:this.getCurrentModeState(),events:{click:BX.delegate(this.showPopup,this)}}))},showPopup:function(){if(this.isPopupShown()||this.disabled){return this.closePopup()}this.menuItems=this.getMenuItems();this.popup=BX.PopupMenu.create(this.id,this.DOM.currentStateLink,this.menuItems,{className:"popup-window-resource-select",closeByEsc:true,autoHide:false,offsetTop:0,offsetLeft:0});this.popup.popupWindow.setAngle({offset:30,position:"top"});this.popup.show(true);this.popupContainer=this.popup.popupWindow.popupContainer;BX.addCustomEvent(this.popup.popupWindow,"onPopupClose",BX.proxy(function(){BX.PopupMenu.destroy(this.id);this.popup=null},this));this.popup.menuItems.forEach(function(z){var y=false,x,A,w="";if(z.dataset&&z.dataset.type){A=z.dataset.checked;var v="menu-popup-item";if(z.dataset.type==="radio"){y="radio";x="menu-popup-item-resource-radio";if(z.dataset.inputName){w=' name="'+z.dataset.inputName+'" '}}else{if(z.dataset.type==="checkbox"){y="checkbox";x="menu-popup-item-resource-checkbox"}}var u='<div class="menu-popup-item-inner">';if(z.dataset.type==="submenu-list"){v+=" menu-popup-item-submenu";u+='<div class="menu-popup-item-resource menu-popup-item-resource-wide"><span class="menu-popup-item-text"><span>'+z.text+'</span><span class="menu-popup-item-resource-subvalue">'+(z.dataset.textValue||z.dataset.value)+"</span></span></div>"}else{if(y){u+='<div class="menu-popup-item-resource">';if(y){u+='<input class="'+x+'" type="'+y+'"'+(A?'checked="checked"':"")+' id="'+z.id+'" '+w+'><label class="menu-popup-item-text"  for="'+z.id+'">'+z.text+"</label>"}u+="</div>"}}u+="</div>";z.layout.item.className=v;z.layout.item.innerHTML=u}},this);setTimeout(BX.delegate(function(){BX.bind(document,"click",BX.proxy(this.handleClick,this))},this),50)},closePopup:function(){if(this.isPopupShown()){this.popup.close();this.popupContainer.style.maxHeight="";BX.unbind(document,"click",BX.proxy(this.handleClick,this))}},isPopupShown:function(){return this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown&&this.popup.popupWindow.isShown()&&this.popup.popupWindow.popupContainer&&BX.isNodeInDom(this.popup.popupWindow.popupContainer)},getCurrentModeState:function(){return""},getPopupContent:function(){this.DOM.innerWrap=BX.create("div",{props:{className:""}});return this.DOM.innerWrap},handlePopupClick:function(v){var u=v.target||v.srcElement;if(u.hasAttribute("data-bx-resbook-control-node")||BX.findParent(u,{attribute:"data-bx-resbook-control-node"},this.DOM.innerWrap)){this.handleControlChanges()}},handleControlChanges:function(){if(this.changesTimeout){this.changesTimeout=clearTimeout(this.changesTimeout)}this.changesTimeout=setTimeout(BX.delegate(function(){BX.onCustomEvent("ResourceBooking.webformSettings:onChanged")},this),50)},menuItemClick:function(v,u){},handleClick:function(v){var u=v.target||v.srcElement;if(this.isPopupShown()&&!BX.isParentForNode(this.popupContainer,u)){return this.closePopup({animation:true})}},setDisabled:function(){this.disabled=true;if(this.isPopupShown()){this.closePopup()}BX.addClass(this.DOM.innerWrap,"disabled")},setEnabled:function(){this.disabled=false;BX.removeClass(this.DOM.innerWrap,"disabled")}};function t(u){t.superclass.constructor.apply(this,arguments);this.name="usersStatePopup";this.inputName="user-select-mode";this.id="users-state-"+Math.round(Math.random()*1000);this.defaultMode=u.defaultMode==="none"?"none":"auto";this.isDisplayed=BX.type.isFunction(u.isDisplayed)?u.isDisplayed:BX.DoNothing;this.build()}BX.extend(t,h);t.prototype.build=function(){t.superclass.build.apply(this,arguments);this.handleControlChanges()};t.prototype.getMenuItems=function(){var u="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";return[{text:"<span>"+BX.message("WEBF_RES_SELECT_DEFAULT_TITLE")+"</span>",className:u},{id:"users-state-list",text:BX.message("WEBF_RES_SELECT_DEFAULT_EMPTY"),dataset:{type:"radio",value:"none",inputName:this.inputName,checked:this.defaultMode==="none"},onclick:BX.proxy(this.menuItemClick,this)},{id:"users-state-auto",text:BX.message("WEBF_RES_SELECT_DEFAULT_FREE_USER"),dataset:{type:"radio",value:"auto",inputName:this.inputName,checked:this.defaultMode==="auto"},onclick:BX.proxy(this.menuItemClick,this)}]};t.prototype.menuItemClick=function(w,u){var v=w.target||w.srcElement;if(BX.type.isDomNode(v)&&v.nodeName.toLowerCase()==="input"&&u.dataset&&u.dataset.inputName===this.inputName){this.defaultMode=u.dataset.value}this.handleControlChanges();setTimeout(BX.delegate(this.closePopup,this),50)};t.prototype.getCurrentModeState=function(){return this.isDisplayed()?(BX.message("WEBF_RES_SELECT_USER_FROM_LIST_SHORT")+(this.defaultMode==="none"?"":(",<br>"+BX.message("WEBF_RES_AUTO_SELECT_USER_SHORT")))):BX.message("WEBF_RES_SELECT_USER_FROM_LIST_AUTO")};t.prototype.handleControlChanges=function(){t.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState();BX.onCustomEvent(this,"ResourceBooking.userSettingsField:onControlChanged",[])};t.prototype.getDefaultMode=function(){return this.defaultMode};function f(u){f.superclass.constructor.apply(this,arguments);this.name="resourcesStatePopup";this.inputName="resource-select-mode";this.defaultMode=u.defaultMode==="none"?"none":"auto";this.multiple=!!u.multiple;this.isDisplayed=BX.type.isFunction(u.isDisplayed)?u.isDisplayed:BX.DoNothing;this.build()}BX.extend(f,h);f.prototype.build=function(){t.superclass.build.apply(this,arguments);this.handleControlChanges()};f.prototype.getMenuItems=function(){var u="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";return[{text:"<span>"+BX.message("WEBF_RES_SELECT_DEFAULT_TITLE")+"</span>",className:u},{id:"resources-state-list",text:BX.message("WEBF_RES_SELECT_DEFAULT_EMPTY"),dataset:{type:"radio",value:"none",inputName:this.inputName,checked:this.defaultMode==="none"},onclick:BX.proxy(this.menuItemClick,this)},{id:"resources-state-auto",text:BX.message("WEBF_RES_AUTO_SELECT_RES"),dataset:{type:"radio",value:"auto",inputName:this.inputName,checked:this.defaultMode==="auto"},onclick:BX.proxy(this.menuItemClick,this)},{delimiter:true},{id:"resources-state-multiple",text:BX.message("WEBF_RES_MULTIPLE"),dataset:{type:"checkbox",value:"Y",checked:this.multiple},onclick:BX.proxy(this.menuItemClick,this)}]};f.prototype.getCurrentModeState=function(){return this.isDisplayed()?(BX.message("WEBF_RES_SELECT_RES_FROM_LIST_SHORT")+(this.defaultMode==="none"?"":(",<br>"+BX.message("WEBF_RES_AUTO_SELECT_RES_SHORT")))):BX.message("WEBF_RES_SELECT_RES_FROM_LIST_AUTO")};f.prototype.handleControlChanges=function(){f.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState();BX.onCustomEvent(this,"ResourceBooking.userSettingsField:onControlChanged",[])};f.prototype.menuItemClick=function(w,u){var v=w.target||w.srcElement;if(BX.type.isDomNode(v)&&v.nodeName.toLowerCase()==="input"&&u.dataset){if(u.dataset.inputName===this.inputName){this.defaultMode=u.dataset.value}else{if(u.id==="resources-state-multiple"){this.multiple=!!v.checked}}}this.handleControlChanges()};f.prototype.getDefaultMode=function(){return this.defaultMode};f.prototype.getMultiple=function(){return this.multiple};function k(u){k.superclass.constructor.apply(this,arguments);this.name="durationStatePopup";this.inputName="duration-select-mode";this.manualInput=!!u.manualInput;this.defaultValue=u.defaultValue||60;this.isDisplayed=BX.type.isFunction(u.isDisplayed)?u.isDisplayed:BX.DoNothing;this.durationList=BX.Calendar.UserField.ResourceBooking.getDurationList(u.fullDay);this.build()}BX.extend(k,h);k.prototype.build=function(){t.superclass.build.apply(this,arguments);this.handleControlChanges()};k.prototype.getMenuItems=function(){return[{id:"duration-default-value",text:BX.message("WEBF_RES_SELECT_DURATION_AUTO"),dataset:{type:"submenu-list",value:this.defaultValue,textValue:this.getDurationLabelByValue(this.defaultValue)},items:this.getDefaultMenuItems()}].concat((this.isDisplayed()?[{delimiter:true},{id:"duration-manual-input",text:BX.message("WEBF_RES_SELECT_MANUAL_INPUT"),dataset:{type:"checkbox",value:"Y",checked:this.manualInput},onclick:BX.proxy(this.menuItemClick,this)}]:[]))};k.prototype.getDefaultMenuItems=function(){var u=[];if(BX.type.isArray(this.durationList)){this.durationList.forEach(function(v){u.push({id:"duration-"+v.value,dataset:{type:"duration",value:v.value},text:v.label,onclick:BX.proxy(this.menuItemClick,this)})},this)}return u};k.prototype.getDurationLabelByValue=function(v){var u=this.durationList.find(function(w){return parseInt(w.value)===parseInt(v)});return u?u.label:null};k.prototype.getCurrentModeState=function(){return this.isDisplayed()?(BX.message("WEBF_RES_SELECT_DURATION_FROM_LIST_SHORT")+(",<br>"+BX.message("WEBF_RES_SELECT_DURATION_BY_DEFAULT")+" "+this.getDurationLabelByValue(this.defaultValue))):BX.message("WEBF_RES_SELECT_DURATION_AUTO")+" "+this.getDurationLabelByValue(this.defaultValue)};k.prototype.handleControlChanges=function(){k.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState();BX.onCustomEvent(this,"ResourceBooking.userSettingsField:onControlChanged",[])};k.prototype.menuItemClick=function(w,u){var v=w.target||w.srcElement;if(BX.type.isDomNode(v)&&v.nodeName.toLowerCase()==="input"&&u.dataset){if(u.id==="duration-manual-input"){this.manualInput=!!v.checked}}else{if(u.dataset&&u.dataset.type==="duration"){this.defaultValue=parseInt(u.dataset.value)}}this.handleControlChanges()};k.prototype.getManualInput=function(){return this.manualInput};k.prototype.getDefaultValue=function(){return this.defaultValue};function s(u){s.superclass.constructor.apply(this,arguments);this.name="dateStatePopup";this.styleInputName="date-select-style";this.startInputName="date-select-start";this.style=u.style==="popup"?"popup":"line";this.start=u.start==="today"?"today":"free";this.build()}BX.extend(s,h);s.prototype.getMenuItems=function(){var u="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";return[{text:"<span>"+BX.message("WEBF_RES_CALENDAR_STYLE")+"</span>",className:u},{id:"date-state-style-popup",text:BX.message("WEBF_RES_CALENDAR_STYLE_POPUP"),dataset:{type:"radio",value:"popup",inputName:this.styleInputName,checked:this.style==="popup"},onclick:BX.proxy(this.menuItemClick,this)},{id:"date-state-style-line",text:BX.message("WEBF_RES_CALENDAR_STYLE_LINE"),dataset:{type:"radio",value:"line",inputName:this.styleInputName,checked:this.style==="line"},onclick:BX.proxy(this.menuItemClick,this)},{text:"<span>"+BX.message("WEBF_RES_CALENDAR_START_FROM")+"</span>",className:u},{id:"date-state-start-from-today",text:BX.message("WEBF_RES_CALENDAR_START_FROM_TODAY"),dataset:{type:"radio",value:"today",inputName:this.startInputName,checked:this.start==="today"},onclick:BX.proxy(this.menuItemClick,this)},{id:"date-state-start-from-free",text:BX.message("WEBF_RES_CALENDAR_START_FROM_FREE"),dataset:{type:"radio",value:"free",inputName:this.startInputName,checked:this.start==="free"},onclick:BX.proxy(this.menuItemClick,this)}]};s.prototype.getCurrentModeState=function(){return(this.style==="popup"?BX.message("WEBF_RES_CALENDAR_STYLE_POPUP"):BX.message("WEBF_RES_CALENDAR_STYLE_LINE"))+", "+(this.start==="today"?BX.message("WEBF_RES_CALENDAR_START_FROM_TODAY_SHORT"):BX.message("WEBF_RES_CALENDAR_START_FROM_FREE_SHORT"))};s.prototype.handleControlChanges=function(){s.superclass.handleControlChanges.apply(this,arguments);BX.adjust(this.DOM.currentStateLink,{text:this.getCurrentModeState()})};s.prototype.menuItemClick=function(w,u){var v=w.target||w.srcElement;if(BX.type.isDomNode(v)&&v.nodeName.toLowerCase()==="input"&&u.dataset){if(u.dataset.inputName===this.styleInputName){this.style=u.dataset.value}else{if(u.dataset.inputName===this.startInputName){this.start=u.dataset.value}}}this.handleControlChanges()};s.prototype.getStyle=function(){return this.style};s.prototype.getStart=function(){return this.start};function i(u){i.superclass.constructor.apply(this,arguments);this.name="timeStatePopup";this.styleInputName="date-select-style";this.showOnlyFree=u.showOnlyFree;this.showFinishTime=u.showFinishTime;this.scale=u.scale;this.stateShowFreeId="time-state-show-free";this.stateShowFinishId="time-state-show-finish";this.style=u.style==="select"?"select":"slots";this.build()}BX.extend(i,h);i.prototype.build=function(){i.superclass.build.apply(this,arguments);this.handleControlChanges()};i.prototype.getMenuItems=function(){var u="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";return[{text:"<span>"+BX.message("WEBF_RES_TIME_STYLE")+"</span>",className:u},{id:"time-state-style-select",text:BX.message("WEBF_RES_TIME_STYLE_SELECT"),dataset:{type:"radio",value:"select",inputName:this.styleInputName,checked:this.style==="select"},onclick:BX.proxy(this.menuItemClick,this)},{id:"time-state-style-slots",text:BX.message("WEBF_RES_TIME_STYLE_SLOT"),dataset:{type:"radio",value:"slots",inputName:this.styleInputName,checked:this.style==="slots"},onclick:BX.proxy(this.menuItemClick,this)},{delimiter:true},{id:"time-state-scale",text:BX.message("WEBF_RES_TIME_BOOKING_SIZE"),dataset:{type:"submenu-list",value:this.scale,textValue:this.getDurationLabelByValue(this.scale)},items:this.getDurationMenuItems()},{delimiter:true},{id:this.stateShowFreeId,text:BX.message("WEBF_RES_TIME_SHOW_FREE_ONLY"),dataset:{type:"checkbox",value:"Y",checked:this.showOnlyFree},onclick:BX.proxy(this.menuItemClick,this)},{id:this.stateShowFinishId,text:BX.message("WEBF_RES_TIME_SHOW_FINISH_TIME"),dataset:{type:"checkbox",value:"Y",checked:this.showFinishTime},onclick:BX.proxy(this.menuItemClick,this)}]};i.prototype.getCurrentModeState=function(){return(this.style==="select"?BX.message("WEBF_RES_TIME_STYLE_SELECT"):BX.message("WEBF_RES_TIME_STYLE_SLOT"))+",<br>"+BX.message("WEBF_RES_TIME_BOOKING_SIZE")+": "+this.getDurationLabelByValue(this.scale)};i.prototype.handleControlChanges=function(){i.superclass.handleControlChanges.apply(this,arguments);this.DOM.currentStateLink.innerHTML=this.getCurrentModeState()};i.prototype.menuItemClick=function(w,u){var v=w.target||w.srcElement;if(BX.type.isDomNode(v)&&v.nodeName.toLowerCase()==="input"&&u.dataset){if(u.dataset.inputName===this.styleInputName){this.style=u.dataset.value}else{if(u.id===this.stateShowFreeId){this.showOnlyFree=!!v.checked}else{if(u.id===this.stateShowFinishId){this.showFinishTime=!!v.checked}}}}else{if(u.dataset&&u.dataset.type==="scale"){this.scale=parseInt(u.dataset.value)}}this.handleControlChanges()};i.prototype.getDurationMenuItems=function(){var v=this.getDurationList(),u=[];v.forEach(function(w){u.push({id:"duration-"+w.value,dataset:{type:"scale",value:w.value},text:w.label,onclick:BX.proxy(this.menuItemClick,this)})},this);return u};i.prototype.getDurationList=function(){if(!this.durationList){this.durationList=BX.Calendar.UserField.ResourceBooking.getDurationList(false);this.durationList=this.durationList.filter(function(u){return u.value&&u.value>=15&&u.value<=240})}return this.durationList};i.prototype.getDurationLabelByValue=function(v){var u=this.getDurationList().find(function(w){return w.value===v});return u?u.label:null};i.prototype.getStyle=function(){return this.style};i.prototype.getScale=function(){return this.scale};i.prototype.getShowOnlyFree=function(){return this.showOnlyFree?"Y":"N"};i.prototype.getShowFinishTime=function(){return this.showFinishTime?"Y":"N"};function j(u){this.id="resourcebooking-settings-value-popup-"+Math.round(Math.random()*100000);this.DOM={outerWrap:u.wrap}}j.prototype={build:function(){this.DOM.innerWrap=this.DOM.outerWrap.appendChild(BX.create("div",{props:{className:"calendar-resbook-webform-settings-popup-select-result"}}));this.DOM.valueLink=this.DOM.innerWrap.appendChild(BX.create("span",{props:{className:"calendar-resbook-webform-settings-popup-select-value"},text:this.getCurrentValueState(),events:{click:BX.delegate(this.showPopup,this),mouseover:BX.delegate(this.showHoverPopup,this),mouseout:BX.delegate(this.hideHoverPopup,this)}}))},showPopup:function(){if(this.popup&&this.popup.isShown()){return this.popup.close()}this.popup=new BX.PopupWindow(this.id,this.DOM.valueLink,{autoHide:true,loseByEsc:true,offsetTop:0,offsetLeft:0,width:this.getPopupWidth(),lightShadow:true,content:this.getPopupContent()});this.popup.setAngle({offset:60,position:"top"});this.popup.show(true);BX.unbind(this.DOM.innerWrap,"click",BX.proxy(this.handlePopupClick,this));BX.bind(this.DOM.innerWrap,"click",BX.proxy(this.handlePopupClick,this));BX.addCustomEvent(this.popup,"onPopupClose",BX.delegate(function(){this.handlePopupCloose();this.popup.destroy(this.id);this.popup=null},this))},closePopup:function(){if(this.isPopupShown()){this.popup.close()}},isPopupShown:function(){return this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown&&this.popup.popupWindow.isShown()&&this.popup.popupWindow.popupContainer&&BX.isNodeInDom(this.popup.popupWindow.popupContainer)},showHoverPopup:function(){},hideHoverPopup:function(){},handlePopupCloose:function(){},getCurrentValueState:function(){return BX.message("WEBF_RES_NO_VALUE")},getPopupContent:function(){this.DOM.innerWrap=BX.create("div",{props:{className:""}});this.DOM.innerWrap.style.minWidth="500px";this.DOM.innerWrap.style.minHeight="30px";return this.DOM.innerWrap},getPopupWidth:function(){return null},handlePopupClick:function(v){var u=v.target||v.srcElement;if(u.hasAttribute("data-bx-resbook-control-node")||BX.findParent(u,{attribute:"data-bx-resbook-control-node"},this.DOM.innerWrap)){this.handleControlChanges()}},handleControlChanges:function(){setTimeout(BX.delegate(function(){BX.onCustomEvent("ResourceBooking.webformSettings:onChanged")},this),50)},showPopupLoader:function(){if(this.DOM.innerWrap){this.hidePopupLoader();this.DOM.popupLoader=this.DOM.innerWrap.appendChild(BX.Calendar.UserField.ResourceBooking.getLoader(50))}},hidePopupLoader:function(){BX.remove(this.DOM.popupLoader)}};function m(u){m.superclass.constructor.apply(this,arguments);this.id="resourcebooking-settings-multiple-checknox-"+Math.round(Math.random()*100000)}BX.extend(m,j);m.prototype.showPopup=function(){if(this.isPopupShown()){return this.closePopup()}var u=[];this.values.forEach(function(v){u.push({id:v.id,text:BX.util.htmlspecialchars(v.title),dataset:v.dataset,onclick:BX.proxy(this.menuItemClick,this)})},this);if(u.length>1){this.selectAllMessage=this.selectAllMessage||"select all";u.push({text:this.selectAllMessage,onclick:BX.proxy(this.selectAllItemClick,this)})}this.popup=BX.PopupMenu.create(this.id,this.DOM.valueLink,u,{className:"popup-window-resource-select",closeByEsc:true,autoHide:false,offsetTop:0,offsetLeft:0});this.popup.popupWindow.setAngle({offset:60,position:"top"});this.popup.show(true);this.popupContainer=this.popup.popupWindow.popupContainer;BX.addCustomEvent(this.popup.popupWindow,"onPopupClose",BX.proxy(function(){this.handlePopupCloose();BX.PopupMenu.destroy(this.id);this.popup=null},this));this.popup.menuItems.forEach(function(v){var w;if(v.dataset&&v.dataset.id){w=this.selectedValues.find(function(x){return x===v.id});v.layout.item.className="menu-popup-item";v.layout.item.innerHTML='<div class="menu-popup-item-inner"><div class="menu-popup-item-resource"><input class="menu-popup-item-resource-checkbox" type="checkbox"'+(w?'checked="checked"':"")+' id="'+v.id+'"><label class="menu-popup-item-text" for="'+v.id+'">'+v.text+"</label></div></div>"}else{this.selectAllChecked=!this.values.find(function(x){return !this.selectedValues.find(function(y){return y===x.id})},this);v.layout.item.className="menu-popup-item menu-popup-item-resource-all";v.layout.item.innerHTML='<div class="menu-popup-item-inner"><div class="menu-popup-item-resource"><input class="menu-popup-item-resource-checkbox menu-popup-item-all-resources-checkbox" type="checkbox"'+(this.selectAllChecked?'checked="checked"':"")+' id="'+v.id+'"><label class="menu-popup-item-text" for="'+v.id+'">'+v.text+"</label></div></div>"}},this);setTimeout(BX.delegate(function(){BX.bind(document,"click",BX.proxy(this.handleClick,this))},this),50)};m.prototype.menuItemClick=function(z,w){var v,y=z.target||z.srcElement,x=w.layout.item.querySelector(".menu-popup-item-resource-checkbox"),u=this.values.find(function(A){return A.id===w.id});if(u){if(y&&(BX.hasClass(y,"menu-popup-item")||BX.hasClass(y,"menu-popup-item-resource-checkbox")||BX.hasClass(y,"menu-popup-item-inner"))){if(!BX.hasClass(y,"menu-popup-item-resource-checkbox")){x.checked=!x.checked}if(x.checked){this.selectItem(u)}else{this.deselectItem(u);v=this.popupContainer.querySelector(".menu-popup-item-all-resources-checkbox");this.selectAllChecked=false;if(v){v.checked=false}}}this.handleControlChanges()}};m.prototype.selectItem=function(u){if(!BX.util.in_array(u.id,this.selectedValues)){this.selectedValues.push(u.id)}};m.prototype.deselectItem=function(v){var u=BX.util.array_search(v.id,this.selectedValues);if(u>=0){this.selectedValues=BX.util.deleteFromArray(this.selectedValues,u)}};m.prototype.selectAllItemClick=function(z,v){var y=z.target||z.srcElement;if(y&&(BX.hasClass(y,"menu-popup-item")||BX.hasClass(y,"menu-popup-item-resource-checkbox"))){var x=v.layout.item.querySelector(".menu-popup-item-resource-checkbox");if(BX.hasClass(y,"menu-popup-item")){x.checked=!x.checked}var u,w=this.popupContainer.querySelectorAll("input.menu-popup-item-resource-checkbox");this.selectAllChecked=x.checked;for(u=0;u<w.length;u++){w[u].checked=this.selectAllChecked}this.selectedValues=[];if(this.selectAllChecked){this.values.forEach(function(A){this.selectedValues.push(A.id)},this)}this.handleControlChanges()}};m.prototype.handleClick=function(v){var u=v.target||v.srcElement;if(this.isPopupShown()&&!BX.isParentForNode(this.popupContainer,u)){this.closePopup({animation:true})}this.handleControlChanges()};m.prototype.closePopup=function(){if(this.isPopupShown()){this.popup.close();this.popupContainer.style.maxHeight="";BX.unbind(document,"click",BX.proxy(this.handleClick,this))}};m.prototype.getSelectedValues=function(){return this.selectedValues};function a(x){a.superclass.constructor.apply(this,arguments);this.name="usersValuePopup";this.values=[];this.selectedValues=[];this.selectedCodes=[];var y,u={},w=x.config.selected===null;y=BX.type.isArray(x.config.selected)?x.config.selected:x.config.selected.split("|");if(BX.type.isArray(y)){for(var v=0;v<y.length;v++){u[y[v]]=true;this.selectedValues.push(y[v]);this.selectedCodes.push("U"+y[v])}}if(BX.type.isArray(x.config.users)&&w){x.config.users.forEach(function(z){if(!u[z]){this.selectedValues.push(z);this.selectedCodes.push("U"+z)}},this)}this.config={};this.build()}BX.extend(a,j);a.prototype.getPopupContent=function(){a.superclass.getPopupContent.apply(this);var u=new BX.Promise();u.then(BX.delegate(this.buildUserSelector,this));if(!this.config.socnetDestination){this.showPopupLoader();BX.ajax.runAction("calendar.api.resourcebookingajax.getuserselectordata",{data:{selectedUserList:this.selectedValues}}).then(BX.delegate(function(v){this.hidePopupLoader();this.config.socnetDestination=v.data;u.fulfill()},this),function(v){})}else{u.fulfill()}return this.DOM.innerWrap};a.prototype.showPopupLoader=function(){if(this.DOM.innerWrap){this.hidePopupLoader();this.DOM.popupLoader=this.DOM.innerWrap.appendChild(BX.create("div",{props:{className:"calendar-resourcebook-popup-loader-wrap"}}));this.DOM.popupLoader.appendChild(BX.Calendar.UserField.ResourceBooking.getLoader(38))}};a.prototype.getPopupWidth=function(){return 680};a.prototype.buildUserSelector=function(){this.DOM.userCurrentvalueWrap=this.DOM.innerWrap.appendChild(BX.create("div",{props:{className:"calendar-resourcebook-content-block-control custom-field-item"}}));this.DOM.userSelectorWrap=this.DOM.innerWrap.appendChild(BX.create("div",{props:{className:"calendar-resourcebook-pseudo-popup-wrap"}}));this.userSelector=new q({wrapNode:this.DOM.userCurrentvalueWrap,socnetDestination:this.config.socnetDestination,itemsSelected:this.selectedCodes,addMessage:BX.message("USER_TYPE_RESOURCE_SELECT_USER"),externalWrap:this.DOM.userSelectorWrap});this.userSelectorId=this.userSelector.getId();BX.addCustomEvent("OnResourceBookDestinationAddNewItem",BX.proxy(this.triggerUserSelectorUpdate,this));BX.addCustomEvent("OnResourceBookDestinationUnselect",BX.proxy(this.triggerUserSelectorUpdate,this))};a.prototype.getSelectedValues=function(){return this.selectedValues};a.prototype.triggerUserSelectorUpdate=function(v,w,u){if(w===this.userSelectorId){if(this.selectorUpdateTimeout){this.selectorUpdateTimeout=clearTimeout(this.selectorUpdateTimeout)}if(u!==false){this.selectorUpdateTimeout=setTimeout(BX.proxy(function(){this.triggerUserSelectorUpdate(v,w,false)},this),300);return}this.selectedValues=[];this.selectedCodes=this.userSelector.getAttendeesCodesList();this.selectedCodes.forEach(function(x){if(x.substr(0,1)==="U"){this.selectedValues.push(parseInt(x.substr(1)))}},this);this.handleControlChanges()}};a.prototype.getCurrentValueState=function(){var u=this.selectedValues.length;return u?(u+" "+BX.Calendar.UserField.getPluralMessage("WEBF_RES_USER",u)):BX.message("WEBF_RES_NO_VALUE")};a.prototype.handleControlChanges=function(){BX.onCustomEvent("ResourceBooking.settingsUserSelector:onChanged");a.superclass.handleControlChanges.apply(this);BX.adjust(this.DOM.valueLink,{text:this.getCurrentValueState()})};function g(x){g.superclass.constructor.apply(this,arguments);this.name="resourcesValuePopup";this.selectAllMessage=BX.message("USER_TYPE_RESOURCE_SELECT_ALL");var y,u={},w=x.config.selected===null;if(BX.type.isArray(x.config.selected)){y=x.config.selected}else{if(BX.type.isString(x.config.selected)){y=x.config.selected.split("|")}}if(BX.type.isArray(y)){for(var v=0;v<y.length;v++){u[y[v]]=true}}this.values=[];this.selectedValues=[];if(BX.type.isArray(x.config.resources)){x.config.resources.forEach(function(A){var z=this.prepareValueId(A);this.values.push({id:z,title:A.title,dataset:A});if(w||u[A.id]){this.selectedValues.push(z)}},this)}this.build()}BX.extend(g,m);g.prototype.handleControlChanges=function(){g.superclass.handleControlChanges.apply(this);BX.adjust(this.DOM.valueLink,{text:this.getCurrentValueState()})};g.prototype.getCurrentValueState=function(){var u=this.selectedValues.length;return u?(u+" "+BX.Calendar.UserField.getPluralMessage("WEBF_RES_RESOURCE",u)):BX.message("WEBF_RES_NO_VALUE")};g.prototype.prepareValueId=function(u){return u.type+"|"+u.id};g.prototype.getSelectedId=function(){var u=[];this.getSelectedValues().forEach(function(v){var w=v.split("|");if(w&&w[1]){u.push(parseInt(w[1]))}});return u};function n(x){n.superclass.constructor.apply(this,arguments);this.name="ServiceValuePopup";this.selectAllMessage=BX.message("WEBF_RES_SELECT_ALL_SERVICES");var w=x.config.selected===null||x.config.selected===""||x.config.selected===undefined;this.values=[];this.selectedValues=[];var y,u={};if(BX.type.isArray(x.config.selected)){y=x.config.selected}else{if(BX.type.isString(x.config.selected)){y=x.config.selected.split("|")}}if(BX.type.isArray(y)){for(var v=0;v<y.length;v++){u[this.prepareServiceId(y[v])]=true}}if(BX.type.isArray(x.config.services)){x.config.services.forEach(function(z){z.id=this.prepareServiceId(z.name);this.values.push({id:z.id,title:z.name+" - "+BX.Calendar.UserField.ResourceBooking.getDurationLabel(z.duration),dataset:z});if(w||u[this.prepareServiceId(z.name)]){this.selectedValues.push(z.id)}},this)}this.config={};this.build()}BX.extend(n,m);n.prototype.handleControlChanges=function(){n.superclass.handleControlChanges.apply(this);BX.adjust(this.DOM.valueLink,{text:this.getCurrentValueState()})};n.prototype.getSelectedValues=function(){return this.selectedValues.length?this.selectedValues:"#EMPTY-SERVICE-LIST#"};n.prototype.getCurrentValueState=function(){var u=this.selectedValues.length;return u?(u+" "+BX.Calendar.UserField.getPluralMessage("WEBF_RES_SERVICE",u)):BX.message("WEBF_RES_NO_VALUE")};n.prototype.prepareServiceId=function(u){return BX.translit(u).replace(/[^a-z0-9_]/ig,"_")};function q(u){q.superclass.constructor.apply(this,arguments);this.DOM.externalWrap=u.externalWrap;this.closeDialogDelayFlag=false;this.finalShowClassName="calendar-resbook-socnet-dest-custom-wrap-appearing"}BX.extend(q,BX.Calendar.UserField.ResourceBooking.UserSelector);q.prototype.openDialogCallback=function(){q.superclass.openDialogCallback.apply(this,arguments);BX.cleanNode(this.DOM.externalWrap);var u=!this.closeDialogDelayFlag;if((this.popupContent&&BX.hasClass(this.popupContent,this.finalShowClassName))||(this.popupSearchContent&&BX.hasClass(this.popupSearchContent,this.finalShowClassName))){u=false}if(BX.SocNetLogDestination.popupWindow){this.popupContent=this.DOM.externalWrap.appendChild(BX.SocNetLogDestination.popupWindow.contentContainer);BX.addClass(BX.SocNetLogDestination.popupWindow.popupContainer,"calendar-resbook-socnet-dest-popup-hide");if(u){BX.addClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap");BX.defer(function(){BX.addClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap-show");setTimeout(BX.delegate(function(){BX.addClass(this.popupContent,this.finalShowClassName)},this),200)},this)()}else{BX.addClass(this.popupContent,this.finalShowClassName)}}if(BX.SocNetLogDestination.popupSearchWindow){this.popupSearchContent=this.DOM.externalWrap.appendChild(BX.SocNetLogDestination.popupSearchWindow.contentContainer);BX.addClass(this.popupSearchContent,this.finalShowClassName);BX.addClass(BX.SocNetLogDestination.popupSearchWindow.popupContainer,"calendar-resbook-socnet-dest-popup-hide")}};q.prototype.closeDialogCallback=function(){q.superclass.closeDialogCallback.apply(this,arguments);this.closeDialogDelayFlag=true;setTimeout(BX.delegate(function(){this.closeDialogDelayFlag=false},this),10);if(this.popupContent){BX.removeClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap");BX.removeClass(this.popupContent,"calendar-resbook-socnet-dest-custom-wrap-show");BX.removeClass(this.popupContent,this.finalShowClassName)}}})();