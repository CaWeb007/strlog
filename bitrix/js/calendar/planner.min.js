(function(b){function a(d,c){if(!d){d={}}this.config=d;this.id=d.id;this.userId=d.userId;this.shown=false;this.built=false;this.dayLength=86400000;this.shownScaleTimeFrom=24;this.shownScaleTimeTo=0;this.timelineCellWidthOrig=false;this.proposeTimeLimit=60;this.expandTimelineDelay=600;this.limitScaleSizeMode=false;this.globalAnimation=true;this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if((this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)){this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length))}else{this.TIME_FORMAT=BX.date.convertBitrixFormat(this.bAMPM?"H:MI:SS T":"HH:MI:SS")}this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.SCALE_TIME_FORMAT=BX.isAmPmMode()?"g a":"G:i";this.entryStatusMap={h:"user-status-h",y:"user-status-y",q:"user-status-q",n:"user-status-n"};this.SetConfig(d);this.SetLoadedDataLimits(this.scaleDateFrom,this.scaleDateTo);BX.addCustomEvent("OnCalendarPlannerDoUpdate",BX.proxy(this.DoUpdate,this));BX.addCustomEvent("OnCalendarPlannerDoExpand",BX.proxy(this.DoExpand,this));BX.addCustomEvent("OnCalendarPlannerDoResize",BX.proxy(this.DoResize,this));BX.addCustomEvent("OnCalendarPlannerDoSetConfig",BX.proxy(this.DoSetConfig,this));BX.addCustomEvent("OnCalendarPlannerDoUninstall",BX.proxy(this.DoUninstall,this));if(c){c.plannerId=this.id;if(c.selector){if(c.selector.from&&!c.selector.from.getTime){c.selector.from=BX.parseDate(c.selector.from)}if(c.selector.to&&!c.selector.to.getTime){c.selector.to=BX.parseDate(c.selector.to)}}this.globalAnimation=false;this.DoUpdate(c);setTimeout(BX.delegate(function(){this.globalAnimation=true},this),2000)}}a.prototype={Show:function(c){if(!this.compactMode||this.globalAnimation===false){c=false}if(this.hideAnimation){this.hideAnimation.stop();this.hideAnimation=null}this.outerWrap=BX(this.id);if(!this.outerWrap){return}if(!this.built){this.Build();this.BindEventHandlers()}else{this.ResizePlannerWidth(this.width)}this.HideSelector();this.BuildTimeline();if(this.adjustWidth){this.ResizePlannerWidth(this.timelineInnerWrap.offsetWidth)}this.outerWrap.style.display="";if(this.readonly){BX.addClass(this.mainContWrap,"calendar-planner-readonly")}else{BX.removeClass(this.mainContWrap,"calendar-planner-readonly")}if(this.compactMode){BX.addClass(this.mainContWrap,"calendar-planner-compact")}else{BX.removeClass(this.mainContWrap,"calendar-planner-compact")}this.entriesListOuterWrap.style.display=this.compactMode?"none":"";if(c){var d=this;if(this.showAnimation){this.showAnimation.stop();this.showAnimation=null}this.showAnimation=new BX.easing({duration:300,start:{height:0},finish:{height:this.height},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){d.outerWrap.style.height=e.height+"px"},complete:BX.proxy(function(){if(parseInt(d.outerWrap.style.height)<d.height){d.outerWrap.style.height=this.height+"px"}this.showAnimation=null},this)});this.showAnimation.animate()}else{if(parseInt(this.outerWrap.style.height)<this.height){this.outerWrap.style.height=this.height+"px"}this.AdjustPlannerHeight()}this.shown=true},Hide:function(c){if(this.showAnimation){this.showAnimation.stop();this.showAnimation=null}if(this.shown){this.shown=false;if(c){if(this.hideAnimation){this.hideAnimation.stop();this.hideAnimation=null}var d=this;this.hideAnimation=new BX.easing({duration:300,start:{height:this.height},finish:{height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){d.outerWrap.style.height=e.height+"px"},complete:BX.proxy(function(){this.hideAnimation=null;this.Hide(false)},this)});this.hideAnimation.animate()}else{this.outerWrap.style.display="none";if(this.timelineScaleCont){BX.cleanNode(this.timelineScaleCont)}this.timelineInnerWrap.removeAttribute("style");this.outerWrap.removeAttribute("style");this.mainContWrap.removeAttribute("style");this.entriesListOuterWrap.removeAttribute("style")}}},SetConfig:function(d){if(d.scaleType&&{"15min":1,"30min":1,"1hour":1,"2hour":1,"1day":1}[d.scaleType]){this.scaleType=d.scaleType}if(!this.scaleType){this.scaleType="1hour"}this.SetScaleType(this.scaleType);if(d.showTimelineDayTitle!==undefined){this.showTimelineDayTitle=!!d.showTimelineDayTitle}else{if(this.showTimelineDayTitle===undefined){this.showTimelineDayTitle=true}}if(d.compactMode!==undefined){this.compactMode=!!d.compactMode}else{if(this.compactMode===undefined){this.compactMode=false}}if(d.readonly!==undefined){this.readonly=!!d.readonly}else{if(this.readonly===undefined){this.readonly=false}}if(this.compactMode){var c=50;if(this.showTimelineDayTitle&&this.scaleType!="1day"){c+=20}this.height=this.minHeight=c}this.scaleLimitOffsetLeft=parseInt(d.scaleLimitOffsetLeft)||this.scaleLimitOffsetLeft||3;this.scaleLimitOffsetRight=parseInt(d.scaleLimitOffsetRight)||this.scaleLimitOffsetRight||5;this.maxTimelineSize=parseInt(d.maxTimelineSize)||this.maxTimelineSize||20;this.minEntryRows=parseInt(d.minEntryRows)||this.minEntryRows||3;this.maxEntryRows=parseInt(d.maxEntryRows)||this.maxEntryRows||10;this.width=parseInt(d.width)||this.width||700;this.height=parseInt(d.height)||this.height||84;this.minWidth=parseInt(d.minWidth)||this.minWidth||700;this.minHeight=parseInt(d.minHeight)||this.minHeight||84;if(this.width<this.minWidth){this.width=this.minWidth}if(this.height<this.minHeight){this.height=this.minHeight}this.workTime=d.workTime||this.workTime||[9,18];this.ExtendScaleTime(this.workTime[0],this.workTime[1]);this.weekHolidays=d.weekHolidays||this.weekHolidays||[];this.yearHolidays=d.yearHolidays||this.yearHolidays||[];this.accuracy=d.accuracy||this.accuracy||300;this.selectorAccuracy=parseInt(d.selectorAccuracy)||this.selectorAccuracy||300;this.entriesListWidth=parseInt(d.entriesListWidth)||this.entriesListWidth||200;this.timelineCellWidth=d.timelineCellWidth||this.timelineCellWidth||40;this.showEntiesHeader=d.showEntiesHeader===undefined?true:!!d.showEntiesHeader;this.showEntryName=d.showEntryName===undefined?true:!!d.showEntryName;if(this.scaleType=="1day"&&this.timelineCellWidth<90){this.timelineCellWidthOrig=this.timelineCellWidth;this.timelineCellWidth=90}else{if(this.timelineCellWidthOrig&&this.scaleType!="1day"){this.timelineCellWidth=this.timelineCellWidthOrig;this.timelineCellWidthOrig=false}}if(this.adjustCellWidth===undefined||d.adjustCellWidth!==undefined){this.adjustCellWidth=this.readonly&&this.compactMode&&d.adjustCellWidth!==false}this.AdjustCellWidth();if(d.scaleDateFrom!==undefined){this.scaleDateFrom=typeof d.scaleDateFrom=="string"?BX.parseDate(d.scaleDateFrom):d.scaleDateFrom}else{if(!this.scaleDateFrom){if(this.compactMode&&this.readonly){this.scaleDateFrom=new Date()}else{this.scaleDateFrom=new Date(new Date().getTime()-this.dayLength*this.scaleLimitOffsetLeft)}}}this.scaleDateFrom.setHours(this.scaleType=="1day"?0:this.shownScaleTimeFrom,0,0,0);if(d.scaleDateTo!==undefined){this.scaleDateTo=typeof d.scaleDateTo=="string"?BX.parseDate(d.scaleDateTo):d.scaleDateTo}else{if(!this.scaleDateTo){if(this.compactMode&&this.readonly){this.scaleDateTo=new Date()}else{this.scaleDateTo=new Date(new Date().getTime()+this.dayLength*this.scaleLimitOffsetRight)}}}this.scaleDateTo.setHours(this.scaleType=="1day"?0:this.shownScaleTimeTo,0,0,0)},SetLoadedDataLimits:function(d,c){if(d){this.loadedDataFrom=d.getTime?d:BX.parseDate(d)}if(c){this.loadedDataTo=c.getTime?c:BX.parseDate(c)}},ExtendScaleTime:function(d,c){if(d!==false&&!isNaN(parseInt(d))){this.shownScaleTimeFrom=Math.min(parseInt(d),this.shownScaleTimeFrom,23);this.shownScaleTimeFrom=Math.max(this.shownScaleTimeFrom,0);if(this.scaleDateFrom){this.scaleDateFrom.setHours(this.shownScaleTimeFrom,0,0,0)}}if(c!==false&&!isNaN(parseInt(c))){this.shownScaleTimeTo=Math.max(parseInt(c),this.shownScaleTimeTo,1);this.shownScaleTimeTo=Math.min(this.shownScaleTimeTo,24);if(this.scaleDateTo){this.scaleDateTo.setHours(this.shownScaleTimeTo,0,0,0)}}this.checkSelectorPosition=this.shownScaleTimeFrom!=0||this.shownScaleTimeTo!=24},AdjustCellWidth:function(){if(this.adjustCellWidth){this.timelineCellWidth=Math.round(this.width/((this.shownScaleTimeTo-this.shownScaleTimeFrom)*3600/this.scaleSize))}},Build:function(){this.outerWrap.style.width=this.width+"px";var d=this.compactMode?0:this.entriesListWidth;this.mainContWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-main-container"},style:{minHeight:this.minHeight+"px",height:this.height+"px",width:this.width+"px"}}));if(this.readonly){BX.addClass(this.mainContWrap,"calendar-planner-readonly")}if(this.compactMode){BX.addClass(this.mainContWrap,"calendar-planner-compact")}this.entriesListOuterWrap=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user-container"},style:{width:d+"px",height:this.height+"px"}}));this.PreventSelection(this.entriesListOuterWrap);if(this.compactMode){this.entriesListOuterWrap.style.display="none"}if(this.scaleType=="1day"){BX.addClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}else{BX.removeClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}this.entriesListHeader=this.entriesListOuterWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-header"}})).appendChild(BX.create("DIV",{props:{className:"calendar-planner-general-info"}})).appendChild(BX.create("DIV",{props:{className:"calendar-planner-users-header"}}));if(this.showEntiesHeader!==false){this.entriesListTitleCounter=this.entriesListHeader.appendChild(BX.create("span",{props:{className:"calendar-planner-users-item"},text:BX.message("EC_PL_ATTENDEES_TITLE")+" "})).appendChild(BX.create("span"));this.settingsButton=this.entriesListHeader.appendChild(BX.create("span",{props:{className:"calendar-planner-settings-icon",title:BX.message("EC_PL_SETTINGS")}}));BX.bind(this.settingsButton,"click",BX.proxy(this.ShowSettingsPopup,this))}this.entriesListWrap=this.entriesListOuterWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user-container-inner"}}));this.timelineFixedWrap=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-wrapper"},style:{height:this.height+"px"}}));this.timelineInnerWrap=this.timelineFixedWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-inner-wrapper"}}));this.timelineInnerWrap.setAttribute("data-bx-planner-meta","timeline");this.timelineScaleCont=this.timelineInnerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time"}}));this.PreventSelection(this.timelineScaleCont);this.timelineDataCont=this.timelineInnerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-container"},style:{height:(this.height)+"px"}}));this.accessibilityWrap=this.timelineDataCont.appendChild(BX.create("DIV",{props:{className:"calendar-planner-acc-wrap"}}));var c=this.BuildSelector();this.selector=c.selector;this.selectorTitle=c.selectorTitle;this.selectorProposeIcon=c.selectorProposeIcon;this.built=true},BuildSelector:function(){var c=this.timelineDataCont.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-selector"},html:'<span data-bx-planner-meta="selector-resize-left" class="calendar-planner-timeline-drag-left"></span><span class="calendar-planner-timeline-selector-grip"></span><span data-bx-planner-meta="selector-resize-right" class="calendar-planner-timeline-drag-right"></span>'}));c.setAttribute("data-bx-planner-meta","selector");c.ondrag=BX.False;c.ondragstart=BX.False;var d=c.appendChild(BX.create("DIV",{props:{className:"calendar-planner-selector-notice"},style:{display:"none"}}));return{selector:c,selectorTitle:d}},BuildTimeline:function(){if(this.timelineScaleCont){BX.cleanNode(this.timelineScaleCont)}this.GetScaleData();var f,e,d=this.timelineScaleCont;for(var g=0;g<this.scaleData.length;g++){if(this.showTimelineDayTitle&&this.scaleType!="1day"){if(this.scaleDayTitles[this.scaleData[g].daystamp]){d=this.scaleDayTitles[this.scaleData[g].daystamp]}else{f=this.timelineScaleCont.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-day-outer"}}));e=f.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-day-title"},text:BX.date.format("d F, l",this.scaleData[g].timestamp/1000)}));d=f.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-day"}}));this.scaleDayTitles[this.scaleData[g].daystamp]=d}}var h="calendar-planner-time-hour-item"+(this.scaleData[g].dayStart?" calendar-planner-day-start":"");if((this.scaleType=="15min"||this.scaleType=="30min")&&this.scaleData[g].title!==""){h+=" calendar-planner-time-hour-bold"}this.scaleData[g].cell=d.appendChild(BX.create("DIV",{props:{className:h},style:{width:this.timelineCellWidth+"px",minWidth:this.timelineCellWidth+"px"},html:this.scaleData[g].title!=""?"<i>"+this.scaleData[g].title+"</i>":this.scaleData[g].title}))}this.MapDatePos();var c=this.timelineScaleCont.offsetWidth;this.timelineInnerWrap.style.width=c+"px";this.entriesListWrap.style.top=(parseInt(this.timelineDataCont.offsetTop)+12)+"px";this.CheckRebuildTimeout(c)},CheckRebuildTimeout:function(c,d){var e=this;if(!d){d=200}if(!this._checkRebuildTimeoutCount){this._checkRebuildTimeoutCount=0}if(this.rebuildTimeout){this.rebuildTimeout=!!clearTimeout(this.rebuildTimeout)}if(this._checkRebuildTimeoutCount<=5){this._checkRebuildTimeoutCount++;this.rebuildTimeout=setTimeout(function(){if(c!==e.timelineScaleCont.offsetWidth){if(e.rebuildTimeout){e.rebuildTimeout=!!clearTimeout(e.rebuildTimeout)}e.RebuildPlanner();e.FocusSelector(true,200)}else{e.CheckRebuildTimeout(c,d)}},d)}else{delete this._checkRebuildTimeoutCount}},RebuildPlanner:function(c){if(!c||typeof c!="object"){c={}}this.BuildTimeline();this.ClearAccessibilityData();this.UpdateData({accessibility:this.accessibility,entries:this.entries});this.AdjustPlannerHeight();this.ResizePlannerWidth(this.width);if(c.updateSelector!==false){this.UpdateSelector(c.selectorParams||false)}},GetScaleData:function(){this.scaleData=[];this.scaleDayTitles={};var g,e,k,f,h,i,c=false,d=this.scaleType=="1day"?0:parseInt(this.shownScaleTimeFrom),j=this.scaleType=="1day"?0:parseInt(this.shownScaleTimeTo);this.scaleDateFrom.setHours(d,0,0,0);this.scaleDateTo.setHours(j,0,0,0);e=this.scaleDateFrom.getTime();k=this.scaleDateTo.getTime();for(g=e;g<k;g+=this.scaleSize*1000){f=parseFloat(BX.date.format("H.i",g/1000));if(this.scaleType=="1day"){i=BX.date.format("d F, D",g/1000)}else{i=BX.date.format("i",g/1000)=="00"?BX.date.format(this.SCALE_TIME_FORMAT,g/1000):""}if(this.scaleType=="1day"||(f>=d&&f<j)){h=BX.date.format("d.m.Y",g/1000);this.scaleData.push({daystamp:h,timestamp:g,value:g,title:i,dayStart:c!==h});c=h}}return this.scaleData},UpdateData:function(g){if(!g.accessibility){g.accessibility={}}this.accessibility=g.accessibility;this.entries=g.entries;var m,j,n,h;if(this.compactMode){var l=[];for(j in g.accessibility){if(g.accessibility.hasOwnProperty(j)&&g.accessibility[j]&&g.accessibility[j].length>0){for(m=0;m<g.accessibility[j].length;m++){l.push(this.HandleAccessibilityEntry(g.accessibility[j][m]))}}}this.compactRowWrap=this.accessibilityWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-space"},style:{}}));this.currentData=[l];for(m=0;m<l.length;m++){this.DisplayAccessibilityEntry(l[m],this.compactRowWrap)}}else{if(g.entries&&g.entries.length){g.entries.sort(function(q,k){if(q.type=="room"||(q.status=="h"&&k.type!=="room")){return -1}if(k.type=="room"||(k.status=="h"&&q.type!=="room")){return 1}var p=g.accessibility[q.id]?g.accessibility[q.id].length:0,i=g.accessibility[k.id]?g.accessibility[k.id].length:0;return i-p});var e=[],d=0,f=0,c=0,o=[];for(m=0;m<g.entries.length;m++){n=g.entries[m];h=g.accessibility[n.id]||[];if(n.type=="user"){d++}if(this.minEntryRows&&(m<this.minEntryRows||g.entries.length==this.minEntryRows+1)){c++;this.DisplayEntryRow(n,h)}else{f++;o.push(n.name);if(h.length>0){for(j=0;j<h.length;j++){e.push(this.HandleAccessibilityEntry(h[j]))}}}}if(this.entriesListTitleCounter){this.entriesListTitleCounter.innerHTML="("+d+")"}if(f>0){if(c==this.maxEntryRows){this.DisplayEntryRow({name:BX.message("EC_PL_ATTENDEES_LAST")+" ("+f+")",type:"lastUsers",title:o.join(", ")},e)}else{this.DisplayEntryRow({name:BX.message("EC_PL_ATTENDEES_SHOW_MORE")+" ("+f+")",type:"moreLink"},e)}}}}this.AdjustPlannerHeight()},ClearAccessibilityData:function(){BX.cleanNode(this.entriesListWrap);BX.cleanNode(this.accessibilityWrap)},HandleAccessibilityEntry:function(c){if(!c.from){c.from=BX.parseDate(c.dateFrom);c.from.setSeconds(0,0);c.fromTimestamp=c.from.getTime()}if(!c.to){c.to=BX.parseDate(c.dateTo);c.to.setSeconds(0,0);c.toTimestamp=c.to.getTime()}if(!c.toReal){if((c.toTimestamp-c.fromTimestamp)%this.dayLength==0&&BX.date.format("H:i",c.toTimestamp/1000)=="00:00"){c.toReal=new Date(c.to.getTime()+this.dayLength);c.toReal.setSeconds(0,0);c.toTimestampReal=c.toReal.getTime()}else{c.toReal=c.to;c.toTimestampReal=c.toTimestamp}}return c},DisplayAccessibilityEntry:function(l,d){var c,m,e=false,g=l.fromTimestamp,k=l.toTimestampReal||l.toTimestamp,o=this.scaleType=="1day"?0:this.shownScaleTimeFrom,f=this.scaleType=="1day"?24:this.shownScaleTimeTo,j=new Date(g),i=new Date(k);c=parseInt(j.getHours())+j.getMinutes()/60;m=parseInt(i.getHours())+i.getMinutes()/60;if(c>f){j=new Date(j.getTime()+this.dayLength-1);j.setHours(o,0,0,0);if(j.getTime()>=i.getTime()){e=true}}if(!e&&c<o){j.setHours(o,0,0,0);if(j.getTime()>=i.getTime()){e=true}}if(!e&&m>f){i.setHours(f,0,0,0);if(j.getTime()>=i.getTime()){e=true}}if(!e&&m<o){i=new Date(i.getTime()-this.dayLength+1);i.setHours(f,0,0,0);if(j.getTime()>=i.getTime()){e=true}}if(!e){var n=this.GetPosByDate(j),h=this.GetPosByDate(i);l.node=d.appendChild(BX.create("DIV",{props:{className:"calendar-planner-acc-entry"+(l.type&&l.type=="hr"?" calendar-planner-acc-entry-hr":"")},style:{left:n+"px",width:Math.max((h-n),1)+"px"}}))}},DisplayEntryRow:function(e,d){e.rowWrap=this.entriesListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-user"},style:{}}));if(e.type=="moreLink"){if(this.showEntryName){this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-all-users",title:e.title||""},text:e.name,events:{click:BX.proxy(this.ShowMoreUsers,this)}}))}else{this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-users-more",title:e.name},html:'<span class="calendar-planner-users-more-btn"></span>',events:{click:BX.proxy(this.ShowMoreUsers,this)}}))}}else{if(e.type=="lastUsers"){if(this.showEntryName){this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-all-users calendar-planner-last-users",title:e.title||""},text:e.name}))}else{this.showMoreUsers=e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-users-more",title:e.title||e.name},html:'<span class="calendar-planner-users-last-btn"></span>'}))}}else{if(e.id&&e.type=="user"){if(e.status&&this.entryStatusMap[e.status]){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-status-icon "+this.entryStatusMap[e.status],title:BX.message("EC_PL_STATUS_"+e.status.toUpperCase())}}))}e.rowWrap.id="anchor_pl_"+e.id;e.rowWrap.appendChild(BX.create("img",{props:{className:"calendar-planner-user-image-icon",src:e.avatar}}));if(this.showEntryName){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-name"}})).appendChild(BX.create("A",{props:{href:e.url?e.url:"#",className:"calendar-planner-user-name-link"},style:{width:(this.entriesListWidth-42)+"px"},text:e.name}))}BX.tooltip(e.id,"anchor_pl_"+e.id,"")}else{if(e.id&&e.type=="room"){if(this.showEntryName){e.rowWrap.appendChild(BX.create("span",{props:{className:"calendar-planner-user-name"}})).appendChild(BX.create("A",{props:{href:e.url?e.url:"#",className:"calendar-planner-user-name-link"},style:{width:(this.entriesListWidth-20)+"px"},text:e.name}))}else{e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-location-image-icon",title:e.name}}))}}else{e.rowWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-all-users"},text:e.name}))}}}}for(c=0;c<d.length;c++){d[c]=this.HandleAccessibilityEntry(d[c])}var c,f=e.rowWrap.offsetTop+13;e.dataRowWrap=this.accessibilityWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-timeline-space"},style:{top:f+"px"}}));for(c=0;c<d.length;c++){this.DisplayAccessibilityEntry(d[c],e.dataRowWrap)}},UpdateSelector:function(i){if(!i){i={}}i.updateScaleType=!!i.updateScaleType;i.updateScaleLimits=!!i.updateScaleLimits;i.animation=!!i.animation;var j=this,e=false,h,g,c;h=(i.from&&i.from.getTime?i.from:BX.parseDate(i.from))||this.currentSelectorDateFrom;g=(i.to&&i.to.getTime?i.to:BX.parseDate(i.to))||this.currentSelectorDateTo;c=i.fullDay!==undefined?i.fullDay:this.currentSelectorFullDay;if(g&&g.getTime()&&h&&h.getTime()){this.currentSelectorDateFrom=h;this.currentSelectorDateTo=g;this.currentSelectorFullDay=c;this.SetFullDayMode(c);if(c){g=new Date(g.getTime()+this.dayLength);h.setHours(0,0,0,0);g.setHours(0,0,0,0);if(this.scaleType!="1day"){this.SetScaleType("1day");e=true}}if(i.updateScaleLimits&&this.scaleType!=="1day"){var d=parseInt(h.getHours())+Math.floor(h.getMinutes()/60);var f=parseInt(g.getHours())+Math.ceil(g.getMinutes()/60);if(this.FormatDate(h)!==this.FormatDate(g)){this.ExtendScaleTime(0,24);e=true}else{if(d<this.shownScaleTimeFrom){this.ExtendScaleTime(d,false);e=true}if(f>this.shownScaleTimeTo){this.ExtendScaleTime(false,f);e=true}if(e){this.AdjustCellWidth()}}}if(e){this.RebuildPlanner({updateSelector:false})}j.ShowSelector({dateFrom:h,dateTo:g,animation:i.animation,focus:i.focus})}},ShowSelector:function(j){var c=j.selector||this.selector,i=j.dateFrom,h=j.dateTo,g=j.animation&&this.globalAnimation!==false,d=j.focus;c.style.display="block";if(i&&h){var e=this.GetPosByDate(i),f=this.GetPosByDate(h);c.style.width=(f-e)+"px";if(this.fullDayMode){g=false}if(g&&c.style.left){this.TransitSelector(false,e,false,d===true)}else{c.style.left=e+"px";c.style.width=(f-e)+"px";if(d===true){setTimeout(BX.proxy(this.FocusSelector,this),200)}this.CheckSelectorStatus(e)}}},HideSelector:function(){this.selector.style.display="none"},StartMovingSelector:function(){this.selectorIsDraged=true;this.selectorRoundedPos=false;this.selectorStartLeft=parseInt(this.selector.style.left);this.selectorStartScrollLeft=this.timelineFixedWrap.scrollLeft;if(this.currentSelectorInstances){for(var c=0;c<this.currentSelectorInstances.length;c++){this.currentSelectorInstances[c].selectorStartLeft=parseInt(this.currentSelectorInstances[c].selector.style.left)}}BX.addClass(document.body,"calendar-planner-unselectable")},MoveSelector:function(j){var g=parseInt(this.selector.style.width),h=this.selectorStartLeft+j;h-=this.selectorStartScrollLeft-this.timelineFixedWrap.scrollLeft;if(this.posDateMap[h]){this.selectorRoundedPos=h}else{var l=this.RoundPos(h);if(this.posDateMap[l]){this.selectorRoundedPos=l}}var k=this.CheckSelectorPosition(this.selectorRoundedPos);if(k!==this.selectorRoundedPos){this.selectorRoundedPos=k;h=k}this.selector.style.left=h+"px";this.ShowSelectorTitle({fromPos:h,toPos:this.selectorRoundedPos+g});if(this.currentSelectorInstances){var f,d,e=h-this.selectorStartLeft,c;for(f=0;f<this.currentSelectorInstances.length;f++){c=this.currentSelectorInstances[f].selector;d=this.currentSelectorInstances[f].selectorStartLeft+e;c.style.left=d+"px";this.ShowSelectorTitle({fromPos:d,toPos:d+g,selector:c,selectorTitle:this.currentSelectorInstances[f].selectorTitle})}}this.CheckSelectorStatus(this.selectorRoundedPos)},EndMovingSelector:function(){if(this.selectorRoundedPos){this.selector.style.left=this.selectorRoundedPos+"px";this.selectorRoundedPos=false;this.HideSelectorTitle();this.OnSelectorChanged(this.selectorRoundedPos);if(this.currentSelectorInstances){for(var c=0;c<this.currentSelectorInstances.length;c++){this.HideSelectorTitle({selectorTitle:this.currentSelectorInstances[c].selectorTitle,selectorIndex:c})}}}this.selectorIsDraged=false},StartResizeSelector:function(){this.selectorIsResized=true;this.selectorRoundedPos=false;this.selectorStartLeft=parseInt(this.selector.style.left);this.selectorStartWidth=parseInt(this.selector.style.width);this.selectorStartScrollLeft=this.timelineFixedWrap.scrollLeft;if(this.currentSelectorInstances){for(var c=0;c<this.currentSelectorInstances.length;c++){this.currentSelectorInstances[c].selectorStartLeft=parseInt(this.currentSelectorInstances[c].selector.style.left);this.currentSelectorInstances[c].selectorStartWidth=parseInt(this.currentSelectorInstances[c].selector.style.width)}}},ResizeSelector:function(k){var g,l,c=this.selectorStartWidth+k;c-=this.selectorStartScrollLeft-this.timelineFixedWrap.scrollLeft;var h=this.selectorStartLeft+c;if(h>parseInt(this.timelineInnerWrap.style.width)){h=parseInt(this.timelineInnerWrap.style.width)}g=this.GetDateByPos(h,true);if(this.fullDayMode){l=parseInt(g.getHours())+Math.round((g.getMinutes()/60)*10)/10;g.setHours(0,0,0,0);if(l>12){g=new Date(g.getTime()+this.dayLength);g.setHours(0,0,0,0)}h=this.GetPosByDate(g);c=h-this.selectorStartLeft;if(c<=10){g=this.GetDateByPos(this.selectorStartLeft);g=new Date(g.getTime()+this.dayLength);g.setHours(0,0,0,0);c=this.GetPosByDate(g)-this.selectorStartLeft;h=this.selectorStartLeft+c}}else{if(this.shownScaleTimeFrom!=0||this.shownScaleTimeTo!=24){var j=this.GetDateByPos(this.selectorStartLeft);if(g&&j&&this.FormatDate(j)!=this.FormatDate(g)){g=new Date(j.getTime());g.setHours(this.shownScaleTimeTo,0,0,0);h=this.GetPosByDate(g);c=h-this.selectorStartLeft}}}if(this.posDateMap[h]){this.selectorRoundedRightPos=h}else{var m=this.RoundPos(h);if(this.posDateMap[m]){this.selectorRoundedRightPos=m}}this.selector.style.width=c+"px";this.ShowSelectorTitle({fromPos:this.selectorStartLeft,toPos:this.selectorRoundedRightPos});if(this.currentSelectorInstances){var f,e,d;for(f=0;f<this.currentSelectorInstances.length;f++){d=this.currentSelectorInstances[f].selector;e=this.currentSelectorInstances[f].selectorStartLeft;d.style.width=c+"px";this.ShowSelectorTitle({fromPos:e,toPos:e+c,selector:d,selectorTitle:this.currentSelectorInstances[f].selectorTitle})}}this.CheckSelectorStatus(this.selectorStartLeft)},EndResizeSelector:function(){if(this.selectorRoundedRightPos){this.selector.style.width=(this.selectorRoundedPos-parseInt(this.selector.style.left))+"px";this.selectorRoundedRightPos=false;this.HideSelectorTitle();this.OnSelectorChanged();if(this.currentSelectorInstances){for(var c=0;c<this.currentSelectorInstances.length;c++){this.HideSelectorTitle({selectorTitle:this.currentSelectorInstances[c].selectorTitle,selectorIndex:c})}}}this.selectorIsResized=false},CheckSelectorStatus:function(l){if(this.config.useSolidBlueSelector){BX.removeClass(this.selector,"calendar-planner-timeline-selector-warning");BX.addClass(this.selector,"solid");return}if(!l){l=this.RoundPos(this.selector.style.left)}var d,g,c,h,f=parseInt(this.selector.style.width),m=parseInt(l),k=m+f,j=this.GetDateByPos(m),e=this.GetDateByPos(k,true);if(j&&e){g=this.CheckTimePeriod(j,e)===true;if(this.currentSelectorInstances&&g){for(d=0;d<this.currentSelectorInstances.length;d++){l=this.RoundPos(this.currentSelectorInstances[d].selector.style.left);m=parseInt(l);k=m+f;c=this.GetDateByPos(m);h=this.GetDateByPos(k,true);c.setHours(j.getHours(),j.getMinutes(),0,0);h.setHours(e.getHours(),e.getMinutes(),0,0);g=this.CheckTimePeriod(c,h)===true;if(!g){break}}}if(this.selectorIsFree!==g){this.selectorIsFree=g;if(this.selectorIsFree){BX.removeClass(this.selector,"calendar-planner-timeline-selector-warning");if(this.currentSelectorInstances){for(d=0;d<this.currentSelectorInstances.length;d++){BX.removeClass(this.currentSelectorInstances[d].selector,"calendar-planner-timeline-selector-warning")}}this.HideProposeControl()}else{BX.addClass(this.selector,"calendar-planner-timeline-selector-warning");if(this.currentSelectorInstances){for(d=0;d<this.currentSelectorInstances.length;d++){BX.addClass(this.currentSelectorInstances[d].selector,"calendar-planner-timeline-selector-warning")}}this.ShowProposeControl()}}}},OnSelectorChanged:function(c,d){if(!c){c=parseInt(this.selector.style.left)}if(c<0){c=0}if(!d){d=parseInt(this.selector.style.width)}if(c+d>parseInt(this.timelineInnerWrap.style.width)){c=parseInt(this.timelineInnerWrap.style.width)-d}var f=this.GetDateByPos(c),e=this.GetDateByPos(c+d,true);if(f&&e){if(this.fullDayMode){e=new Date(e.getTime()-this.dayLength)}this.currentSelectorDateFrom=f;this.currentSelectorDateTo=e;this.currentSelectorFullDay=this.fullDayMode;BX.onCustomEvent("OnCalendarPlannerSelectorChanged",[{plannerId:this.id,dateFrom:f,dateTo:e,fullDay:this.fullDayMode}])}},CheckSelectorPosition:function(i,d,f){if(this.checkSelectorPosition&&(this.scaleType!="1day"||this.fullDayMode)){if(!i){i=parseInt(this.selector.style.left)}if(!d){d=parseInt(this.selector.style.width)}if(!f){f=i+d}if(f>parseInt(this.timelineInnerWrap.style.width)){i=parseInt(this.timelineInnerWrap.style.width)-d}else{var g=this.GetDateByPos(i),e=this.GetDateByPos(f,true),c,h,k=parseInt(this.shownScaleTimeFrom),j=parseInt(this.shownScaleTimeTo);if(g&&e){if(this.fullDayMode){c=parseInt(g.getHours())+Math.round((g.getMinutes()/60)*10)/10;g.setHours(0,0,0,0);if(c>12){g=new Date(g.getTime()+this.dayLength);g.setHours(0,0,0,0)}i=this.GetPosByDate(g)}else{if(g.getDay()!=e.getDay()){c=parseInt(g.getHours())+Math.round((g.getMinutes()/60)*10)/10;h=parseInt(e.getHours())+Math.round((e.getMinutes()/60)*10)/10;if(Math.abs(j-c)>Math.abs(k-h)){g.setHours(this.shownScaleTimeTo,0,0,0);i=this.GetPosByDate(g)-d}else{e.setHours(this.shownScaleTimeFrom,0,0,0);i=this.GetPosByDate(e)}}}}}}return i},TransitSelector:function(h,g,d,c){var f=this;d=d!==false;g=this.RoundPos(g);if(!h){h=parseInt(this.selector.style.left)}var e=parseInt(this.selector.offsetWidth);if(g>(h+e)&&d){g-=e}if(h!=g){this.animation=new BX.easing({duration:300,start:{left:h},finish:{left:g},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(i){f.selector.style.left=i.left+"px"},complete:BX.proxy(function(){this.animation=null;var i=parseInt(this.selector.style.left);var j=this.CheckSelectorPosition(i);if(j!==i){this.selector.style.left=j+"px"}if(d){this.OnSelectorChanged(j)}if(c===true){this.FocusSelector(true,300)}this.CheckSelectorStatus(j)},this)});this.animation.animate()}else{if(d){this.OnSelectorChanged()}if(c===true){this.FocusSelector(true,300)}this.CheckSelectorStatus()}},ShowSelectorTitle:function(i){var f=i.fromPos,g=i.toPos,h=i.selectorTitle||this.selectorTitle,c=i.selectorTitle||this.selector,j=this,e,d;if(f&&g){if(g>parseInt(this.timelineInnerWrap.style.width)){f=parseInt(this.timelineInnerWrap.style.width)-parseInt(c.style.width);g=parseInt(this.timelineInnerWrap.style.width)}e=this.GetDateByPos(f);d=this.GetDateByPos(g,true);if(e&&d){if(this.fullDayMode){h.style.top="12px";if(Math.abs(d.getTime()-e.getTime()-this.dayLength)<1000){h.innerHTML=BX.date.format("d F, D",e.getTime()/1000)}else{h.innerHTML=BX.date.format("d F",e.getTime()/1000)+" - "+BX.date.format("d F",d.getTime()/1000)}}else{h.removeAttribute("style");h.innerHTML=this.FormatTime(e)+" - "+this.FormatTime(d)}}}if(h==this.selectorTitle){if(h.style.display=="none"||this.selectorHideTimeout){this.selectorHideTimeout=clearTimeout(this.selectorHideTimeout);this.selectorTitle.style.display="";this.selectorTitle.style.opacity=0;new BX.easing({duration:400,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(k){j.selectorTitle.style.opacity=k.opacity/100},complete:function(){j.selectorTitle.removeAttribute("style")}}).animate()}}else{h.removeAttribute("style")}},HideSelectorTitle:function(e){if(!e||typeof e!=="object"){e={}}var c=e.selectorIndex===undefined?"selectorHideTimeout":"selectorHideTimeout_"+e.selectorIndex,d=e.selectorTitle||this.selectorTitle,f=this;if(this[c]){this[c]=clearTimeout(this[c])}if(e.timeout!==false){this[c]=setTimeout(function(){e.timeout=false;f.HideSelectorTitle(e)},500)}else{d.style.display="";d.style.opacity=1;new BX.easing({duration:400,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(g){d.style.opacity=g.opacity/100},complete:function(){d.removeAttribute("style");d.style.display="none"}}).animate()}},BindEventHandlers:function(){BX.bind(this.outerWrap,"click",BX.proxy(this.Click,this));BX.bind(this.outerWrap,"mousedown",BX.proxy(this.Mousedown,this));BX.bind(document,"mousemove",BX.proxy(this.MouseMove,this));BX.bind(document,"mouseup",BX.proxy(this.MouseUp,this));if("onwheel" in document){BX.bind(this.timelineFixedWrap,"wheel",BX.proxy(this.MousewheelTimelineHandler,this))}else{BX.bind(this.timelineFixedWrap,"mousewheel",BX.proxy(this.MousewheelTimelineHandler,this))}},Click:function(i){if(!i){i=b.event}this.clickMousePos=this.GetMousePos(i);var d=5;var f=i.target||i.srcElement;if(!this.readonly&&!this.currentSelectorInstances){var g=this.FindTarget(f,"timeline"),c=this.FindTarget(f,"selector");if(g&&!c&&Math.abs(this.clickMousePos.x-this.mouseDownMousePos.x)<d&&Math.abs(this.clickMousePos.y-this.mouseDownMousePos.y)<d){var h=this.clickMousePos.x-BX.pos(this.timelineFixedWrap).left+this.timelineFixedWrap.scrollLeft;this.TransitSelector(false,h)}}},Mousedown:function(f){if(!f){f=b.event}var d=f.target||f.srcElement;this.mouseDownMousePos=this.GetMousePos(f);this.mouseDown=true;if(!this.readonly){var c=this.FindTarget(d,"selector");this.startMousePos=this.mouseDownMousePos;if(c){if(this.FindTarget(d,"selector-resize-right")){this.StartResizeSelector()}else{this.StartMovingSelector()}}else{if(this.FindTarget(d,"timeline")){this.StartScrollTimeline()}}}},MouseUp:function(){if(this.selectorIsDraged){this.EndMovingSelector()}if(this.selectorIsResized){this.EndResizeSelector()}if(this.timelineIsDraged){this.EndScrollTimeline()}if(this.shown&&!this.readonly&&this.mouseDown){this.CheckTimelineScroll()}this.mouseDown=false;BX.removeClass(document.body,"calendar-planner-unselectable")},MouseMove:function(d){var c;if(this.selectorIsDraged){c=this.GetMousePos(d);this.MoveSelector(c.x-this.startMousePos.x)}if(this.selectorIsResized){c=this.GetMousePos(d);this.ResizeSelector(c.x-this.startMousePos.x)}if(this.timelineIsDraged){c=this.GetMousePos(d);this.ScrollTimeline(c.x-this.startMousePos.x)}},MousewheelTimelineHandler:function(d){d=d||b.event;if(this.shown&&!this.readonly){var f=d.deltaY||d.detail||d.wheelDelta;if(Math.abs(f)>0){if(!BX.browser.IsMac()){f=f*5}var c=this.timelineFixedWrap.scrollLeft+f;this.timelineFixedWrap.scrollLeft=Math.max(c,0);this.CheckTimelineScroll();return BX.PreventDefault(d)}}},CheckTimelineScroll:function(){var d=this.GelTimelineScrollOffset(),c=this.timelineFixedWrap.scrollWidth-this.timelineFixedWrap.offsetWidth-this.GelTimelineScrollOffset();if(this.timelineFixedWrap.offsetWidth>0){if(this.timelineFixedWrap.scrollLeft<=d){this.ExpandTimeline("left")}else{if(this.timelineFixedWrap.scrollLeft>=c){this.ExpandTimeline("right")}}}},StartScrollTimeline:function(){this.timelineIsDraged=true;this.timelineStartScrollLeft=this.timelineFixedWrap.scrollLeft},ScrollTimeline:function(c){this.timelineFixedWrap.scrollLeft=Math.max(this.timelineStartScrollLeft-c,0)},EndScrollTimeline:function(){this.timelineIsDraged=false},FindTarget:function(f,c,e){if(!e){e=this.mainContWrap}var d=(f&&f.getAttribute)?f.getAttribute("data-bx-planner-meta"):null;if(d!==c){if(f){f=BX.findParent(f,function(g){return g.getAttribute&&g.getAttribute("data-bx-planner-meta")===c},e)}else{f=null}}return f},GetMousePos:function(d){if(!d){d=b.event}var c=0,f=0;if(d.pageX||d.pageY){c=d.pageX;f=d.pageY}else{if(d.clientX||d.clientY){c=d.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;f=d.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}}return{x:c,y:f}},FormatDate:function(c){return BX.date.format(this.DATE_FORMAT,c.getTime()/1000)},FormatTime:function(c,e){var d=(c&&typeof c==="object")?c.getTime():c;return BX.date.format(e===true?this.TIME_FORMAT:this.TIME_FORMAT_SHORT,d/1000)},FormatDateTime:function(c){return BX.date.format(this.DATETIME_FORMAT,c.getTime()/1000)},SetScaleType:function(c){this.scaleType=c;this.scaleSize=this.GetScaleSize(c);if(this.scaleType=="1day"&&this.timelineCellWidth<90){this.timelineCellWidthOrig=this.timelineCellWidth;this.timelineCellWidth=90}else{if(this.timelineCellWidthOrig&&this.scaleType!="1day"){this.timelineCellWidth=this.timelineCellWidthOrig;this.timelineCellWidthOrig=false}}if(this.entriesListOuterWrap){if(this.scaleType=="1day"){BX.addClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}else{BX.removeClass(this.entriesListOuterWrap,"calendar-planner-no-daytitle")}}},GetScaleSize:function(d){var c=3600,e={"15min":Math.round(c/4),"30min":Math.round(c/2),"1hour":c,"2hour":c*2,"1day":c*24};return e[d]||c},MapDatePos:function(){this.datePosMap={};this.posDateMap={};var h,g,e,f,c,d,k;this.substeps=Math.round(this.scaleSize/this.accuracy);this.posAccuracy=this.timelineCellWidth/this.substeps;for(h=0;h<this.scaleData.length;h++){e=this.scaleData[h].timestamp;f=this.scaleData[h].cell.offsetLeft;k=this.scaleData[h].cell.offsetWidth;this.datePosMap[e]=f;this.posDateMap[f]=e;for(g=1;g<=this.substeps;g++){if(g==this.substeps&&(!this.scaleData[h+1]||this.scaleData[h+1].dayStart)){c=e+this.accuracy*g*1000;d=f+Math.round((this.accuracy*g*10)/this.scaleSize*k)/10;this.datePosMap[c]=d;this.posDateMap[d+"_end"]=c}else{if(g<this.substeps){c=e+this.accuracy*g*1000;d=f+Math.round((this.accuracy*g*10)/this.scaleSize*k)/10;this.datePosMap[c]=d;this.posDateMap[d]=c}}}}},GetPosByDate:function(e){var c=0;if(e&&typeof e!=="object"){e=BX.parseDate(e)}if(e&&typeof e==="object"){var g,d=0,j=e.getTime();for(g=0;g<this.scaleData.length;g++){if(j>=this.scaleData[g].timestamp){d=g}else{break}}if(this.scaleData[d]&&this.scaleData[d].cell){c=this.scaleData[d].cell.offsetLeft;var h=this.scaleData[d].cell.offsetWidth,f=Math.round((j-this.scaleData[d].timestamp)/1000);if(f>0){c+=Math.round(f*10/this.scaleSize*h)/10}}}return c},GetDateByPos:function(c,d){var e,f=(d&&this.posDateMap[c+"_end"])?this.posDateMap[c+"_end"]:this.posDateMap[c];if(!f){c=this.RoundPos(c);f=(d&&this.posDateMap[c+"_end"])?this.posDateMap[c+"_end"]:this.posDateMap[c]}if(f){e=new Date(f)}return e},RoundPos:function(c){return Math.round(Math.round(parseInt(c)/this.posAccuracy)*this.posAccuracy*10)/10},ShowMoreUsers:function(){this.minEntryRows=this.maxEntryRows;this.ClearAccessibilityData();this.UpdateData({accessibility:this.accessibility,entries:this.entries})},AdjustPlannerHeight:function(){var c=this.entriesListWrap.offsetHeight+this.entriesListWrap.offsetTop+30,d=parseInt(this.outerWrap.style.height)||this.height;if(this.compactMode&&d<c||!this.compactMode){this.ResizePlannerHeight(c,Math.abs(c-d)>10)}},ResizePlannerHeight:function(d,f){this.height=d;if(f){if(this.resizeAnimation){this.resizeAnimation.stop();this.resizeAnimation=null}var c=parseInt(this.outerWrap.style.height),g=this;this.resizeAnimation=new BX.easing({duration:800,start:{height:c},finish:{height:d},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(h){g.ResizePlannerHeight(h.height,false)},complete:BX.proxy(function(){this.resizeAnimation=null},this)});this.resizeAnimation.animate()}else{this.outerWrap.style.height=d+"px";this.mainContWrap.style.height=d+"px";this.timelineFixedWrap.style.height=d+"px";var e=this.entriesListWrap.offsetHeight+3;this.timelineDataCont.style.height=e+"px";this.selector.style.height=(e+6)+"px";this.entriesListOuterWrap.style.height=d+"px";if(this.proposeTimeButton&&this.proposeTimeButton.style.display!="none"){this.proposeTimeButton.style.top=(this.timelineDataCont.offsetTop+e/2-16)+"px"}}},ResizePlannerWidth:function(d,e){if(e){}else{this.outerWrap.style.width=d+"px";var c=this.compactMode?0:this.entriesListWidth;this.mainContWrap.style.width=d+"px";this.entriesListOuterWrap.style.width=c+"px"}},ExpandFromCompactMode:function(){this.readonly=false;this.compactMode=false;this.showTimelineDayTitle=true;BX.removeClass(this.mainContWrap,"calendar-planner-readonly");BX.removeClass(this.mainContWrap,"calendar-planner-compact");this.entriesListOuterWrap.style.display="";if(this.scaleDateFrom&&this.scaleDateFrom.getTime){this.scaleDateFrom=new Date(this.scaleDateFrom.getTime()-this.dayLength*this.scaleLimitOffsetLeft)}if(this.scaleDateTo&&this.scaleDateTo.getTime){this.scaleDateTo=new Date(this.scaleDateTo.getTime()+this.dayLength*this.scaleLimitOffsetRight)}this.RebuildPlanner();this.FocusSelector(false,300)},FocusSelector:function(d,i){var h=this;if(this.focusSelectorTimeout){this.focusSelectorTimeout=!!clearTimeout(this.focusSelectorTimeout)}if(this.globalAnimation===false){d=false}if(i){this.focusSelectorTimeout=setTimeout(function(){h.FocusSelector(d,false)},i)}else{var e=parseInt(this.selector.style.left),g=parseInt(this.selector.style.width),j=50,f=this.timelineFixedWrap.offsetWidth,l=this.timelineFixedWrap.scrollLeft,c=l+f,k=l;if(e<l+j||e>c-j){if(g<=f){k=Math.max(Math.round(e-((f-g)/2)),j)}else{k=Math.max(Math.round(e-j),j)}}if(k!=l){if(d===false){this.timelineFixedWrap.scrollLeft=k}else{new BX.easing({duration:300,start:{scrollLeft:this.timelineFixedWrap.scrollLeft},finish:{scrollLeft:k},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(m){h.timelineFixedWrap.scrollLeft=m.scrollLeft},complete:function(){}}).animate()}}}},ExpandTimeline:function(m,f,o,d){if(this.loadDataLock){this.lastExpandparams={direction:m,loadedDataFrom:f,loadedDataTo:o,focusSelector:d};return}this.lastExpandparams=false;var q,c=3,k=3,e,j=this;if(!f){f=this.loadedDataFrom||this.scaleDateFrom}if(!o){o=this.loadedDataTo||this.scaleDateTo}if(m=="left"){var l=new Date(this.scaleDateFrom.getTime());this.scaleDateFrom=f=new Date(f-this.dayLength*c);q=(this.scaleDateTo.getTime()-this.scaleDateFrom.getTime())/this.dayLength;if(q>this.maxTimelineSize){this.scaleDateTo=new Date(this.scaleDateFrom.getTime()+this.dayLength*this.maxTimelineSize);this.loadedDataFrom=this.scaleDateFrom;this.loadedDataTo=this.scaleDateTo;o=this.loadedDataTo;this.limitScaleSizeMode=true}this.RebuildPlanner();e=this.GetPosByDate(l)}else{if(m=="right"){var p=this.scaleDateTo;e=j.timelineFixedWrap.scrollLeft;this.scaleDateTo=o=new Date(o.getTime()+this.dayLength*k);q=(this.scaleDateTo.getTime()-this.scaleDateFrom.getTime())/this.dayLength;if(q>this.maxTimelineSize){this.scaleDateFrom=new Date(this.scaleDateTo.getTime()-this.dayLength*this.maxTimelineSize);this.loadedDataFrom=this.scaleDateFrom;this.loadedDataTo=this.scaleDateTo;f=this.loadedDataFrom;e=this.GetPosByDate(p)-this.timelineFixedWrap.offsetWidth;setTimeout(function(){j.timelineFixedWrap.scrollLeft=j.GetPosByDate(p)-j.timelineFixedWrap.offsetWidth},1);this.limitScaleSizeMode=true}this.scaleDateTo=o;this.RebuildPlanner()}else{f=new Date(f-this.dayLength*c);o=new Date(o.getTime()+this.dayLength*k);this.scaleDateFrom=f;this.scaleDateTo=o;this.RebuildPlanner()}}if(e!==undefined){j.timelineFixedWrap.scrollLeft=e}var h,n,g=[];if(!BX.type.isArray(this.entries)){this.entries=[]}for(h=0;h<this.entries.length;h++){n=this.entries[h];g.push(n.id)}this.loadDataLock=true;BX.onCustomEvent("OnCalendarPlannerScaleChanged",[{from:this.FormatDate(f),to:this.FormatDate(o),entrieIds:g,entries:this.entries,focusSelector:d===true}])},GelTimelineScrollOffset:function(){return 10},DoUpdate:function(d){if(this.id==d.plannerId){var c=false;if(d.selector&&d.selector.fullDay){this.SetFullDayMode(d.selector.fullDay)}if(d.config){if(this.fullDayMode&&d.config.changeFromFullDay){d.config.scaleType=d.config.changeFromFullDay.scaleType;d.config.timelineCellWidth=d.config.changeFromFullDay.timelineCellWidth;delete d.config.changeFromFullDay}if(d.config.scaleDateFrom&&d.config.scaleDateFrom!==this.scaleDateFrom){c=true}if(!c&&d.config.scaleDateTo&&d.config.scaleDateTo!==this.scaleDateTo){c=true}if(!c&&d.config.scaleType&&d.config.scaleType!==this.scaleType){c=true}if(d.config.shownScaleTimeFrom&&d.config.shownScaleTimeFrom!==this.shownScaleTimeFrom){this.shownScaleTimeFrom=d.config.shownScaleTimeFrom;c=true}if(d.config.shownScaleTimeTo&&d.config.shownScaleTimeTo!==this.shownScaleTimeTo){this.shownScaleTimeTo=d.config.shownScaleTimeTo;c=true}this.SetConfig(d.config)}if(!this.shown&&d.show){this.Show(true)}else{if(c){this.RebuildPlanner({updateSelector:false})}}if(d.hide&&this.shown){this.Hide(d.hideAnimation!==false)}if(this.shown){if(d.data!==undefined&&d.data!==false){this.ClearAccessibilityData();this.UpdateData(d.data);this.SetLoadedDataLimits(d.loadedDataFrom,d.loadedDataTo)}if(d.selector!==undefined&&d.selector.from&&d.selector.to){d.selector.focus=d.focusSelector===true;d.selector.updateScaleType=false;if(d.selector.to.getTime()>this.loadedDataTo.getTime()&&!this.limitScaleSizeMode){this.ExpandTimeline("right",false,d.selector.to,true)}else{if(d.selector.from.getTime()<this.loadedDataFrom.getTime()&&!this.limitScaleSizeMode){this.ExpandTimeline("left",d.selector.from,false,true)}else{if(!this.readonly){this.scaleDateFrom=this.loadedDataFrom;this.scaleDateTo=this.loadedDataTo}this.RebuildPlanner({updateSelector:true,selectorParams:d.selector})}}}if(!this.compactMode&&this.loadedDataTo!==this.scaleDateTo){this.CheckTimelineScroll()}}if(d.params&&d.params.callback){d.params.callback()}if(this.expandTimeLineTimeout){this.expandTimeLineTimeout=!!clearTimeout(this.expandTimeLineTimeout)}var e=this;this.expandTimeLineTimeout=setTimeout(function(){e.loadDataLock=false;if(e.lastExpandparams){var f=e.lastExpandparams;e.ExpandTimeline(f.direction,f.loadedDataFrom,f.loadedDataTo,f.focusSelector)}},this.expandTimelineDelay)}this.limitScaleSizeMode=false},DoExpand:function(c){if(this.id==c.plannerId){if(this.compactMode){if(c.config){this.SetConfig(c.config)}this.ExpandFromCompactMode()}}},DoSetConfig:function(c){if(this.id==c.plannerId&&c.config){this.SetConfig(c.config)}},DoResize:function(c){if(this.id==c.plannerId){var d=this;if(c.width){c.width=parseInt(c.width)||this.width}c.width=Math.max(c.width,this.minWidth);this.width=c.width;this.AdjustCellWidth();this.ResizePlannerWidth(c.width,false);if(this.resizeRebuildTimeout){this.resizeRebuildTimeout=clearTimeout(this.resizeRebuildTimeout)}this.resizeRebuildTimeout=setTimeout(function(){d.RebuildPlanner()},200)}},DoUninstall:function(c){if(c&&this.id==c.plannerId){BX.cleanNode(this.outerWrap,1);BX.removeCustomEvent("OnCalendarPlannerDoUpdate",BX.proxy(this.DoUpdate,this));BX.removeCustomEvent("OnCalendarPlannerDoExpand",BX.proxy(this.DoExpand,this));BX.removeCustomEvent("OnCalendarPlannerDoResize",BX.proxy(this.DoResize,this));BX.removeCustomEvent("OnCalendarPlannerDoSetConfig",BX.proxy(this.DoSetConfig,this));BX.removeCustomEvent("OnCalendarPlannerDoUninstall",BX.proxy(this.DoUninstall,this));if(this.settingsPopup){this.settingsPopup.close()}}},ProposeTime:function(u){if(!u||typeof u!=="object"||u.target){u={}}var m=this,t,v,c=Math.round((this.currentSelectorDateTo-this.currentSelectorDateFrom)/1000)*1000,w=[],o,q;if(this.fullDayMode){c+=this.dayLength}t=Math.round(this.currentSelectorDateFrom.getTime()/(this.accuracy*1000))*this.accuracy*1000;v=new Date(t);v.setSeconds(0,0);t=v.getTime();for(o in this.accessibility){if(this.accessibility.hasOwnProperty(o)&&this.accessibility[o]&&this.accessibility[o].length>0){for(q=0;q<this.accessibility[o].length;q++){if(this.accessibility[o][q].toTimestampReal>=t){w.push(this.HandleAccessibilityEntry(this.accessibility[o][q]))}}}}w.sort(function(k,i){return k.fromTimestamp-i.fromTimestamp});var d=t,h,n,j,g,r;while(true){n=new Date(d);j=new Date(d+c);if(this.scaleType!=="1day"){r=parseInt(n.getHours())+n.getMinutes()/60;g=parseInt(j.getHours())+j.getMinutes()/60;if(r<=this.shownScaleTimeFrom){n.setHours(this.shownScaleTimeFrom,0,0,0);d=n.getTime();j=new Date(d+c)}if(g>=this.shownScaleTimeTo){n=new Date(d+this.dayLength-1000);n.setHours(this.shownScaleTimeFrom,0,0,0);d=n.getTime();j=new Date(d+c)}}if(this.fullDayMode){n.setHours(0,0,0,0);j.setHours(0,0,0,0)}h=this.CheckTimePeriod(n,j,w);if(h===true){if(j.getTime()>this.loadedDataTo.getTime()){if((j.getTime()-this.loadedDataTo.getTime())>this.proposeTimeLimit*this.dayLength||u.checkedFuture===true){this.ShowNoResultNotification()}else{if(u.checkedFuture!==true){var p=this.timelineFixedWrap.scrollLeft;var s=new Date(this.loadedDataTo.getTime()+this.dayLength*this.proposeTimeLimit);this.scaleDateTo=s;this.RebuildPlanner();this.timelineFixedWrap.scrollLeft=p;var e,f=[];for(q=0;q<this.entries.length;q++){e=this.entries[q];f.push(e.id)}BX.onCustomEvent("OnCalendarPlannerScaleChanged",[{from:this.FormatDate(this.loadedDataFrom),to:this.FormatDate(s),entrieIds:f,entries:this.entries,focusSelector:true,params:{callback:function(){m.ProposeTime({checkedFuture:true})}}}])}}}else{if(this.fullDayMode){j=new Date(j.getTime()-this.dayLength)}this.UpdateSelector({from:n,to:j,updateScaleType:false,updateScaleLimits:true,animation:true,focus:true});BX.onCustomEvent("OnCalendarPlannerSelectorChanged",[{plannerId:this.id,dateFrom:n,dateTo:j,fullDay:this.fullDayMode}])}break}else{if(h&&h.toTimestampReal){d=h.toTimestampReal;if(this.fullDayMode){var l=new Date(d+this.dayLength-1000);l.setHours(0,0,0,0);d=l.getTime()}}}}},CheckTimePeriod:function(l,h,g){var o=true,j=l.getTime(),m=h.getTime(),c=60*1000,n,f;if(g){for(f=0;f<g.length;f++){n=g[f];if(n.type&&n.type=="hr"){continue}if((n.fromTimestamp+c)<=m&&((n.toTimestampReal||n.toTimestamp)-c)>=j){o=n;break}}}else{var d={},k=this.selectorAccuracy*1000,e;for(e in this.accessibility){if(this.accessibility.hasOwnProperty(e)){d[e]=true;for(f=0;f<this.accessibility[e].length;f++){n=this.accessibility[e][f];if(n.type&&n.type=="hr"){continue}if((n.fromTimestamp+k)<=m&&((n.toTimestampReal||n.toTimestamp)-k)>=j){d[e]=false;o=n;break}}}}for(f=0;f<this.entries.length;f++){if(d[this.entries[f].id]!==undefined){this.entries[f].currentStatus=!!d[this.entries[f].id]}else{this.entries[f].currentStatus=true}}}return o},ShowSettingsPopup:function(){var k=this,e,j=["15min","30min","1hour","2hour","1day"],h=BX.create("DIV",{props:{className:"calendar-planner-settings-popup"}}),f=h.appendChild(BX.create("DIV",{props:{className:"calendar-planner-settings-row"},html:"<i>"+BX.message("EC_PL_SETTINGS_SCALE")+":</i>"})),d=f.appendChild(BX.create("span",{props:{className:"calendar-planner-option-container"}}));if(this.fullDayMode){f.title=BX.message("EC_PL_SETTINGS_SCALE_READONLY_TITLE");BX.addClass(f,"calendar-planner-option-container-disabled")}for(e=0;e<j.length;e++){d.appendChild(BX.create("span",{props:{className:"calendar-planner-option-tab"+(j[e]==this.scaleType?" calendar-planner-option-tab-active":"")},attrs:{"data-bx-planner-scale":j[e]},text:BX.message("EC_PL_SETTINGS_SCALE_"+j[e].toUpperCase())}))}var c=BX.PopupWindowManager.create(this.id+"-settings-popup",this.settingsButton,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:7,lightShadow:true,content:h,zIndex:4000,angle:{postion:"top"}});c.show(true);BX.bind(d,"click",BX.proxy(function(l){if(!this.fullDayMode){var i=l.target||l.srcElement,m=i&&i.getAttribute&&i.getAttribute("data-bx-planner-scale");if(m){this.ChangeScaleType(m);c.close()}}},this));function g(){if(c&&c.destroy){BX.removeCustomEvent(c,"onPopupClose",g);c.destroy();c=null;k.settingsPopup=null}}BX.addCustomEvent(c,"onPopupClose",g);this.settingsPopup=c},ChangeScaleType:function(c){if(c!==this.scaleType){this.SetScaleType(c);this.RebuildPlanner();this.FocusSelector(true,300)}},SetFullDayMode:function(c){this.fullDayMode=c},PreventSelection:function(c){c.ondrag=BX.False;c.ondragstart=BX.False;c.onselectstart=BX.False},ShowNoResultNotification:function(){alert(BX.message("EC_PL_PROPOSE_NO_RESULT"))},HandleRecursion:function(h){if(!h.instances){h.instances=[]}var c=new Date();c.setFullYear(2016,6,2);c.setHours(0,0,0,0);h.instances.push({date:c});c=new Date();c.setFullYear(2016,6,3);c.setHours(0,0,0,0);h.instances.push({date:c});var d,e;for(d=0;d<h.instances.length;d++){e=this.BuildSelector();h.instances[d].selector=e.selector;h.instances[d].selectorTitle=e.selectorTitle;var g=new Date(h.instances[d].date.getTime());g.setHours(12,0,0,0);var f=new Date(h.instances[d].date.getTime());f.setHours(13,0,0,0);this.ShowSelector({selector:h.instances[d].selector,dateFrom:g,dateTo:f,focus:false,animation:false})}this.currentSelectorInstances=h.instances},ShowProposeControl:function(){if(!this.proposeTimeButton){this.proposeTimeButton=this.mainContWrap.appendChild(BX.create("DIV",{props:{className:"calendar-planner-time-arrow-right"},html:'<span class="calendar-planner-time-arrow-right-text">'+BX.message("EC_PL_PROPOSE")+'</span><span class="calendar-planner-time-arrow-right-item"></span>'}));BX.bind(this.proposeTimeButton,"click",BX.proxy(this.ProposeTime,this))}this.proposeTimeButton.style.display="block";this.proposeTimeButton.style.top=(this.timelineDataCont.offsetTop+this.timelineDataCont.offsetHeight/2-16)+"px"},HideProposeControl:function(){if(this.proposeTimeButton){this.proposeTimeButton.style.display="none"}}};b.CalendarPlanner=a})(window);