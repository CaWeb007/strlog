this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(v,af,C,B,aw,T,ax,j,aj){var r=function(){function az(aD){babelHelpers.classCallCheck(this,az);babelHelpers.defineProperty(this,"Z_INDEX",4000);babelHelpers.defineProperty(this,"MIN_WIDTH",102);this.DOM={wrap:aD.wrap,input:aD.input};this.onChangeCallback=aw.Type.isFunction(aD.onChangeCallback)?aD.onChangeCallback:null;this.create()}babelHelpers.createClass(az,[{key:"create",value:function aA(){var aE=this;this.selectContol=new BX.Calendar.Controls.SelectInput({input:this.DOM.input,zIndex:this.Z_INDEX,values:az.getValueList(),minWidth:this.MIN_WIDTH,onChangeCallback:function aD(){if(aE.onChangeCallback){aE.onChangeCallback(aE.selectContol.getInputValue())}}})}},{key:"setValue",value:function aC(aG){var aH;if(aw.Type.isDate(aG)){aH={h:aG.getHours(),m:aG.getMinutes()}}else{aH=aj.Util.parseTime(aG)}var aE=az.adaptTimeValue(aH);this.selectContol.setValue({value:aE.value});var aD=Math.floor(aE.value/60);var aF=aE.value-aD*60;this.DOM.input.value=aj.Util.formatTime(aD,aF)}}],[{key:"adaptTimeValue",value:function ay(aE){aE=parseInt(aE.h*60)+parseInt(aE.m);var aH=az.getValueList(),aG=24*60,aF=false,aD;for(aD=0;aD<aH.length;aD++){if(Math.abs(aH[aD].value-aE)<aG){aG=Math.abs(aH[aD].value-aE);aF=aD;if(aG<=15){break}}}return aH[aF||0]}},{key:"getValueList",value:function aB(){if(!az.valueList){az.valueList=[];var aD;for(aD=0;aD<24;aD++){az.valueList.push({value:aD*60,label:aj.Util.formatTime(aD,0)});az.valueList.push({value:aD*60+30,label:aj.Util.formatTime(aD,30)})}}return az.valueList}}]);return az}();babelHelpers.defineProperty(r,"valueList",null);function t(){var az=babelHelpers.taggedTemplateLiteral(['<input id="inp-','" type="text" class="calendar-field calendar-field-datetime" value="" autocomplete="off" placeholder="','"/>']);ay=function ay(){return az};return az}function u(){var ay=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-clear-icon" data-bxc-value="','"/>']);az=function az(){return ay};return ay}function w(){var ay=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-reminder-item">\n\t\t\t\t\t\t<span class="calendar-reminder-item-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>"]);az=function az(){return ay};return ay}function x(){var ay=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-clear-icon" data-bxc-value="','"/>']);az=function az(){return ay};return ay}function y(){var az=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-item">\n\t\t\t\t\t<span class="calendar-reminder-item-title">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</span>"]);ay=function ay(){return az};return az}function z(){var az=babelHelpers.taggedTemplateLiteral(['<span class="calendar-reminder-clear-icon" data-bxc-value="','"/>']);ay=function ay(){return az};return az}function A(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-reminder-item">\n\t\t\t\t\t\t<span class="calendar-reminder-item-title">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>"]);ay=function ay(){return az};return az}function D(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="calendar-notification-add-btn-wrap">\n\t\t\t\t\t<span class="calendar-notification-text">','</span>\n\t\t\t\t\t<span class="calendar-notification-btn-container calendar-notification-btn-add">\n\t\t\t\t\t\t<span class="calendar-notification-icon"></span>\n\t\t\t\t\t</span>\n\t\t\t\t</span>']);ay=function ay(){return az};return az}var i=function(aT){babelHelpers.inherits(aC,aT);function aC(aY){var aX;babelHelpers.classCallCheck(this,aC);aX=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aC).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"defaultReminderTime",540);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"fullDayMode",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"extendedMode",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"selectedValues",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"controlList",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"viewMode",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aX),"DOM",{});aX.setEventNamespace("BX.Calendar.Controls.Reminder");aX.values=aX.getValues();aX.id=aY.id||"reminder-"+Math.round(Math.random()*1000000);aX.zIndex=aY.zIndex||3200;aX.rawValuesMap=new Map();aX.viewMode=aY.viewMode===true;aX.changeCallack=aY.changeCallack;aX.showPopupCallBack=aY.showPopupCallBack;aX.hidePopupCallBack=aY.hidePopupCallBack;aX.create(aY);aX.setValue(aY.selectedValues||[]);aX.bindEventHandlers();return aX}babelHelpers.createClass(aC,[{key:"create",value:function aK(aX){if(aw.Type.isElementNode(aX.wrap)){this.DOM.wrap=aX.wrap}if(!aw.Type.isElementNode(this.DOM.wrap)){return}aw.Dom.addClass(this.DOM.wrap,"calendar-notification-values");if(!this.viewMode){this.DOM.addButton=this.DOM.wrap.appendChild(aw.Tag.render(D(),aw.Loc.getMessage("EC_REMIND1_ADD")))}}},{key:"bindEventHandlers",value:function aO(){if(aw.Type.isDomNode(this.DOM.addButton)){aw.Event.bind(this.DOM.addButton,"click",this.showPopup.bind(this))}if(aw.Type.isDomNode(this.DOM.wrap)){aw.Event.bind(this.DOM.wrap,"click",this.handleClick.bind(this))}}},{key:"getValues",value:function ay(){var aX=[];if(!this.fullDayMode){aX=aX.concat([{value:0,label:aw.Loc.getMessage("EC_REMIND1_0"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_0")},{value:5,label:aw.Loc.getMessage("EC_REMIND1_5"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_5")},{value:10,label:aw.Loc.getMessage("EC_REMIND1_10"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_10")},{value:15,label:aw.Loc.getMessage("EC_REMIND1_15"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_15")},{value:20,label:aw.Loc.getMessage("EC_REMIND1_20"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_20")},{value:30,label:aw.Loc.getMessage("EC_REMIND1_30"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_30")},{value:60,label:aw.Loc.getMessage("EC_REMIND1_60"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_60")},{value:120,label:aw.Loc.getMessage("EC_REMIND1_120"),shortLabel:aw.Loc.getMessage("EC_REMIND1_SHORT_120")}])}if(this.extendedMode){aX=aX.concat([{id:"time-menu-day-0",label:aw.Loc.getMessage("EC_REMIND1_DAY_0"),dataset:{mode:"time-menu",daysBefore:0,time:this.defaultReminderTime}},{id:"time-menu-day-1",label:aw.Loc.getMessage("EC_REMIND1_DAY_1"),dataset:{mode:"time-menu",daysBefore:1,time:this.defaultReminderTime}},{id:"time-menu-day-2",label:aw.Loc.getMessage("EC_REMIND1_DAY_2"),dataset:{mode:"time-menu",daysBefore:2,time:this.defaultReminderTime}},{id:"custom",label:aw.Loc.getMessage("EC_REMIND1_CUSTOM"),dataset:{mode:"custom"}}])}return aX}},{key:"setValue",value:function aA(aX){var aZ=this;var aY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(aw.Type.isArray(aX)){aX.forEach(function(a0){aZ.addValue(a0,aY)},this)}}},{key:"getSelectedValues",value:function aP(){return this.selectedValues}},{key:"getSelectedRawValues",value:function aN(){var aX=this;var aY=[];this.selectedValues.forEach(function(aZ){aY.push(aX.rawValuesMap.get(aZ)||aZ)});return aY}},{key:"setFullDayMode",value:function aI(aX){if(aX!==this.fullDayMode){this.fullDayMode=aX;this.values=this.getValues()}}},{key:"showPopup",value:function aL(){var aY=this;var a1=this,aZ=[];this.values.forEach(function(a4){if(a4.mode==="time-menu"||a4.mode==="custom"||!BX.util.in_array(a4.value,aY.selectedValues)){var a3={};if(a4.dataset&&a4.dataset.mode==="time-menu"){a3.id=a4.id;var a2=aj.Util.getTimeByInt(aY.defaultReminderTime);a3.text=a4.label.replace("#TIME#",aj.Util.formatTime(a2.hour,a2.min));a3.dataset=BX.util.objectMerge({type:"submenu-list",value:aY.defaultReminderTime},a4.dataset);a3.items=aY.getSubmenuTimeValues(a3,a4.label);a3.onclick=function(){return function(){a1.addValue({before:a4.dataset.daysBefore,time:a4.dataset.time});BX.defer(function(){a1.reminderMenu.close()},a1)()}}()}else{if(a4.dataset&&a4.dataset.mode==="custom"){a3.id="custom";a3.text=a4.label;a3.items=[{id:"tmp",text:"tmp"}]}else{a3.text=a4.label;a3.onclick=function(a5,a6){return function(){a1.addValue(a5);a1.reminderMenu.close()}}(a4.value,a4.mode)}}aZ.push(a3)}},this);this.reminderMenu=ax.MenuManager.create(this.id,this.DOM.addButton,aZ,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false});var aX=this.adjustSubmenuPopup.bind(this);var a0=this.closeSubmenuPopup.bind(this);T.EventEmitter.subscribe("BX.Main.Popup:onShow",aX);T.EventEmitter.subscribe("BX.Main.Popup:onClose",a0);this.reminderMenu.popupWindow.subscribe("onClose",function(){T.EventEmitter.unsubscribe("BX.Main.Popup:onShow",aX);T.EventEmitter.unsubscribe("BX.Main.Popup:onClose",a0)});this.reminderMenu.show()}},{key:"getSubmenuTimeValues",value:function aV(aX,aZ){var aY=[];aC.getTimeValueList(60).forEach(function(a0){aY.push({id:"time-"+a0.value,dataset:{value:a0.value,daysBefore:aX.dataset.daysBefore},text:a0.label,onclick:function(a4,a2){var a3=aj.Util.getTimeByInt(a2.dataset.value);var a1=this.reminderMenu.getMenuItem(aX.id);if(a1){a1.setText(aZ.replace("#TIME#",aj.Util.formatTime(a3.hour,a3.min)))}this.addValue({time:a2.dataset.value,before:a2.dataset.daysBefore});BX.defer(function(){this.reminderMenu.close()},this)()}.bind(this)})},this);return aY}},{key:"addValue",value:function aR(a1){var aY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var aX,a0,aZ=aC.formatValue(a1);if(aw.Type.isPlainObject(a1)&&!this.selectedValues.includes(aZ)){if(aw.Type.isInteger(a1.before)&&aw.Type.isInteger(a1.time)){a0=this.DOM.wrap.appendChild(aw.Tag.render(A(),aC.getReminderLabel(a1)));if(!this.viewMode){a0.appendChild(aw.Tag.render(z(),aZ))}}else{if(a1.type==="date"&&aw.Type.isDate(a1.value)){a0=this.DOM.wrap.appendChild(aw.Tag.render(y(),aj.Util.formatDateUsable(a1.value)+" "+aj.Util.formatTime(a1.value)));if(!this.viewMode){a0.appendChild(aw.Tag.render(x(),aZ))}}}this.selectedValues.push(aZ);this.controlList[aZ]=a0;this.rawValuesMap.set(aZ,a1)}else{if(a1>=0&&!this.selectedValues.includes(aZ)){for(aX=0;aX<this.values.length;aX++){if(this.values[aX].value===a1){a0=this.DOM.wrap.appendChild(aw.Tag.render(w(),this.values[aX].shortLabel||this.values[aX].label));if(!this.viewMode){a0.appendChild(aw.Tag.render(u(),aZ))}this.selectedValues.push(aZ);this.controlList[aZ]=a0;this.rawValuesMap.set(aZ,a1);break}}if(a0===undefined){a0=this.DOM.wrap.appendChild(aw.Dom.create("SPAN",{props:{className:"calendar-reminder-item"},text:aC.getText(a1)}));if(!this.viewMode){a0.appendChild(aw.Dom.create("SPAN",{props:{className:"calendar-reminder-clear-icon"},events:{click:function(){this.removeValue(a1)}.bind(this)}}))}this.selectedValues.push(a1);this.controlList[a1]=a0;this.rawValuesMap.set(a1,a1)}}}if(this.changeCallack){this.changeCallack(this.selectedValues)}if(aY){this.emit("onChange",new T.BaseEvent({data:{values:this.selectedValues}}))}if(aw.Type.isElementNode(this.DOM.addButton)){this.DOM.wrap.appendChild(this.DOM.addButton)}}},{key:"removeValue",value:function aS(aX){if(this.controlList[aX]&&aw.Type.isDomNode(this.controlList[aX])){aw.Dom.remove(this.controlList[aX])}this.selectedValues=BX.util.deleteFromArray(this.selectedValues,BX.util.array_search(aX,this.selectedValues));if(this.changeCallack){this.changeCallack(this.selectedValues)}this.emit("onChange",new T.BaseEvent({data:{values:this.selectedValues}}))}},{key:"handleClick",value:function aG(aZ){var aY=aZ.target||aZ.srcElement;var aX=aY.getAttribute("data-bxc-value");if(this.selectedValues.includes(aX)){this.removeValue(aX)}}},{key:"adjustSubmenuPopup",value:function aW(aY){if(aY instanceof T.BaseEvent){var aX=aY.getTarget();if(aX instanceof ax.Popup){if(/^menu-popup-popup-submenu-time-menu-day-\d$/.test(aX.getId())){this.adjustTimeSubmenuPopup(aX)}else{if(/^menu-popup-popup-submenu-custom$/.test(aX.getId())){this.adjustCalendarSubmenuPopup(aX)}}}}}},{key:"closeSubmenuPopup",value:function aJ(aZ){if(aZ instanceof T.BaseEvent){var aX=aZ.getTarget();if(aX instanceof ax.Popup){if(/^menu-popup-popup-submenu-time-menu-day-\d$/.test(aX.getId())){}else{if(/^menu-popup-popup-submenu-custom$/.test(aX.getId())){var aY=aX.bindElement;var a0=aY.querySelector(".menu-popup-item-text");if(aw.Type.isDomNode(a0)){aw.Dom.clean(a0);a0.innerHTML=aw.Loc.getMessage("EC_REMIND1_CUSTOM")}}}}}}},{key:"adjustTimeSubmenuPopup",value:function aQ(aX){var aY=aX.getContentContainer().querySelector('span[data-value="'+this.defaultReminderTime+'"]');if(aw.Type.isDomNode(aY)){setTimeout(function(){aX.getContentContainer().scrollTop=parseInt(aY.offsetTop)-10;aw.Dom.addClass(aY,"menu-popup-item-open")},50)}}},{key:"adjustCalendarSubmenuPopup",value:function aU(aY){var a0=this;var a2=aY.bindElement;var a4=a2.querySelector(".menu-popup-item-text");if(aw.Type.isDomNode(a4)){aw.Dom.clean(a4);var aZ=a4.appendChild(aw.Tag.render(t(),Math.round(Math.random()*100000),aw.Loc.getMessage("EC_REMIND1_CUSTOM_PLACEHOLDER")));var a1=BX.calendar.get();a1.popup=null;a1._current_layer=null;a1._layers={};a1.Show({node:aZ,value:aj.Util.formatDateTime(aj.Util.getUsableDateTime(new Date())),field:aZ,bTime:true,bHideTime:false});var aX=a1.popup;aX.cacheable=false;if(aX&&aX.popupContainer){var a3=aX.popupContainer.querySelector(".bx-calendar");if(aw.Type.isDomNode(a3)){aY.contentContainer.appendChild(a3)}aX.close();ax.MenuManager.destroy(aX.uniquePopupId)}aw.Event.bind(aZ,"change",function(){var a6=aZ.value,a5=aj.Util.parseDate(a6);if(aw.Type.isDate(a5)){a0.addValue({type:"date",value:a5});a0.reminderMenu.close()}})}}},{key:"setViewMode",value:function aF(aX){this.viewMode=aX;if(this.viewMode){aw.Dom.addClass(this.DOM.wrap,"calendar-reminder-readonly");if(aw.Type.isElementNode(this.DOM.addButton)){this.DOM.addButton.style.display="none"}}else{aw.Dom.removeClass(this.DOM.wrap,"calendar-reminder-readonly")}}}],[{key:"getText",value:function az(a2){var aZ=a2,a0=[60,24],a1=["EC_REMIND1_MIN_COUNT","EC_REMIND1_HOUR_COUNT","EC_REMIND1_DAY_COUNT"],aX="";for(var aY=0;aY<a1.length;aY++){if(aZ<a0[aY]||aY===a0.length){aX=aw.Loc.getMessage(a1[aY]).toString();aX=aX.replace("#COUNT#",aZ.toString());break}else{aZ=Math.ceil(aZ/a0[aY])}}return aX}},{key:"getTimeValueList",value:function aH(){var aY=arguments.length>0&&arguments[0]!==undefined?arguments[0]:30;if(!aC.timeValueList){aC.timeValueList=[];var aX;for(aX=0;aX<24;aX++){aC.timeValueList.push({value:aX*60,label:aj.Util.formatTime(aX,0)});if(aY<=30){aC.timeValueList.push({value:aX*60+30,label:aj.Util.formatTime(aX,30)})}}}return aC.timeValueList}},{key:"formatValue",value:function aB(aX){if(aw.Type.isPlainObject(aX)&&aw.Type.isInteger(aX.before)&&aw.Type.isInteger(aX.time)){return"daybefore|"+aX.before+"|"+aX.time}else{if(aw.Type.isPlainObject(aX)&&aw.Type.isDate(aX.value)){return"date|"+aj.Util.formatDateTime(aX.value)}}return aX.toString()}},{key:"showCustomInputCalendar",value:function aM(aZ,aY){if(!aw.Type.isDomNode(aY)&&aZ){aY=aZ.target||aZ.srcElement}if(aw.Type.isDomNode(aY)&&aY.nodeName.toLowerCase()==="input"){BX.calendar({node:aY.parentNode,value:aj.Util.formatDateTime(aj.Util.getUsableDateTime(new Date())),field:aY,bTime:true,bHideTime:false});BX.onCustomEvent(window,"onCalendarControlChildPopupShown");var aX=BX.calendar.get().popup;if(aX){aX.params.zIndex=4200;aX.popupContainer.style.zIndex=aX.params.zIndex;BX.removeCustomEvent(aX,"onPopupClose",aC.inputCalendarClosePopupHandler);BX.addCustomEvent(aX,"onPopupClose",aC.inputCalendarClosePopupHandler)}}}},{key:"inputCalendarClosePopupHandler",value:function aD(aX){BX.onCustomEvent(window,"onCalendarControlChildPopupClosed")}},{key:"getReminderLabel",value:function aE(aY){var aX="";if(aw.Type.isInteger(aY.before)&&aw.Type.isInteger(aY.time)&&[0,1,2].includes(aY.before)){var aZ=aj.Util.getTimeByInt(aY.time);aX=aw.Loc.getMessage("EC_REMIND1_DAY_"+aY.before+"_SHORT").replace("#TIME#",aj.Util.formatTime(aZ.hour,aZ.min))}return aX}}]);return aC}(T.EventEmitter);babelHelpers.defineProperty(i,"timeValueList",null);function aa(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="calendar-text-link">',"</span>"]);aa=function ay(){return az};return az}function av(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-place-link">',"\n\t\t\t\t</div>"]);av=function ay(){return az};return az}var a=function(){function ay(aS){babelHelpers.classCallCheck(this,ay);this.params=aS;this.id=aS.id||"location-"+Math.round(Math.random()*1000000);this.zIndex=aS.zIndex||3100;this.DOM={wrapNode:aS.wrap};this.disabled=!aS.richLocationEnabled;this.value={type:"",text:"",value:""};this.inlineEditModeEnabled=aS.inlineEditModeEnabled;this.meetingRooms=aS.iblockMeetingRoomList||[];ay.setMeetingRoomList(aS.iblockMeetingRoomList);ay.setLocationList(aS.locationList);this.create()}babelHelpers.createClass(ay,[{key:"create",value:function aJ(){this.DOM.inputWrap=this.DOM.wrapNode.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field-block"}}));if(this.inlineEditModeEnabled){this.DOM.inlineEditLinkWrap=this.DOM.wrapNode.appendChild(aw.Tag.render(av(),this.DOM.inlineEditLink=aw.Tag.render(aa(),aw.Loc.getMessage("EC_REMIND1_ADD"))));this.DOM.inputWrap.style.display="none";aw.Event.bind(this.DOM.inlineEditLinkWrap,"click",this.displayInlineEditControls.bind(this))}if(this.disabled){BX.addClass(this.DOM.wrapNode,"locked");this.DOM.inputWrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-lock-icon"},events:{click:function aS(){B24.licenseInfoPopup.show("calendar_location",aw.Loc.getMessage("EC_B24_LOCATION_LIMITATION_TITLE"),aw.Loc.getMessage("EC_B24_LOCATION_LIMITATION"))}}}))}this.DOM.input=this.DOM.inputWrap.appendChild(aw.Dom.create("INPUT",{attrs:{name:this.params.inputName||"",placeholder:aw.Loc.getMessage("EC_LOCATION_LABEL"),type:"text",autocomplete:this.disabled?"on":"off"},props:{className:"calendar-field calendar-field-select"}}))}},{key:"setValues",value:function aR(){var aT=[],aS=false,aU=ay.getMeetingRoomList(),aV=ay.getLocationList();if(aw.Type.isArray(aU)){aU.forEach(function(aW){aW.ID=parseInt(aW.ID);aT.push({ID:aW.ID,label:BX.util.htmlspecialchars(aW.NAME),labelRaw:aW.NAME,value:aW.ID,type:"mr"});if(this.value.type==="mr"&&parseInt(this.value.value)===aW.ID){aS=aT.length-1}},this);if(aT.length>0){aT.push({delimiter:true})}}if(aw.Type.isArray(aV)){if(aV.length){aV.forEach(function(aW){aW.ID=parseInt(aW.ID);aT.push({ID:aW.ID,label:BX.util.htmlspecialchars(aW.NAME),labelRaw:aW.NAME,value:aW.ID,type:"calendar"});if(this.value.type==="calendar"&&parseInt(this.value.value)===parseInt(aW.ID)){aS=aT.length-1}},this);aT.push({delimiter:true});aT.push({label:aw.Loc.getMessage("EC_LOCATION_MEETING_ROOM_SET"),callback:this.editMeetingRooms.bind(this)})}else{aT.push({label:aw.Loc.getMessage("EC_ADD_LOCATION"),callback:this.editMeetingRooms.bind(this)})}}if(this.value){this.DOM.input.value=this.value.str||"";if(this.value.type&&this.value.str===this.getTextLocation(this.value)){this.DOM.input.value=aw.Loc.getMessage("EC_LOCATION_404")}}if(this.selectContol){this.selectContol.destroy()}this.selectContol=new BX.Calendar.Controls.SelectInput({input:this.DOM.input,values:aT,valueIndex:aS,zIndex:this.zIndex,disabled:this.disabled,onChangeCallback:BX.delegate(function(){var aW,aX=this.DOM.input.value;this.value={text:aX};for(aW=0;aW<aT.length;aW++){if(aT[aW].labelRaw===aX){this.value.type=aT[aW].type;this.value.value=aT[aW].value;break}}if(aw.Type.isFunction(this.params.onChangeCallback)){this.params.onChangeCallback()}},this)})}},{key:"editMeetingRooms",value:function aM(){var aS={};if(this.params.getControlContentCallback){aS.wrap=this.params.getControlContentCallback()}if(!aS.wrap){aS.wrap=this.showEditMeetingRooms()}this.buildLocationEditControl(aS)}},{key:"showEditMeetingRooms",value:function aI(){if(this.editDialog){this.editDialog.destroy()}this.editDialogContent=aw.Dom.create("DIV",{props:{className:"bxec-location-wrap"}});this.editDialog=new BX.PopupWindow(this.id+"_popup",null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_MEETING_ROOM_LIST_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_SEC_SLIDER_SAVE"),events:{click:BX.delegate(function(){this.saveValues();if(this.editDialog){this.editDialog.close()}},this)}}),new BX.PopupWindowButtonLink({text:aw.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(function(){if(this.editDialog){this.editDialog.close()}},this)}})],content:this.editDialogContent,events:{}});this.editDialog.show();return this.editDialogContent}},{key:"buildLocationEditControl",value:function aE(aT){var aS;this.locationEditControlShown=true;this.editDialogWrap=aT.wrap;this.locationRoomList=[];this.addNewButtonField=false;if(aw.Type.isArray(ay.locationList)){ay.locationList.forEach(function(aU){if(aU.NAME!==""&&aU.ID){this.locationRoomList.push({id:parseInt(aU.ID),name:aU.NAME})}},this)}if(!this.locationRoomList.length){this.locationRoomList.push({id:0,name:""})}for(aS=0;aS<this.locationRoomList.length;aS++){this.addRoomField(this.locationRoomList[aS],aT.wrap)}this.addNewButtonField={outerWrap:aT.wrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-container-text"}}))};this.addNewButtonField.innerWrap=this.addNewButtonField.outerWrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field-block"}}));this.addNewButtonField.innerCont=this.addNewButtonField.innerWrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-text"},html:'<span class="calendar-text-link">'+aw.Loc.getMessage("EC_MEETING_ROOM_ADD")+"</span>",events:{click:BX.delegate(function(){var aU=this.locationRoomList[this.locationRoomList.length-1];if(aU.id||aU.deleted||BX.util.trim(aU.field.input.value)){this.locationRoomList.push(this.addRoomField({id:0},aT.wrap))}},this)}}));aT.wrap.appendChild(this.addNewButtonField.outerWrap)}},{key:"addRoomField",value:function aF(aS){aS.field={outerWrap:this.editDialogWrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}}))};aS.field.innerWrap=aS.field.outerWrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field-block"}}));aS.field.innerWrap.style.paddingRight="40px";aS.field.input=aS.field.innerWrap.appendChild(aw.Dom.create("INPUT",{props:{className:"calendar-field calendar-field-string"},attrs:{value:aS.name||"",placeholder:aw.Loc.getMessage("EC_MEETING_ROOM_PLACEHOLDER"),type:"text"},events:{keyup:BX.delegate(function(aT){if(parseInt(aT.keyCode)===13){this.editRoom(aS)}},this)}}));aS.field.delRoomEntry=aS.field.innerWrap.appendChild(aw.Dom.create("SPAN",{props:{className:"calendar-remove-filed"},events:{click:BX.delegate(function(){ay.deleteField(aS)},this)}}));if(this.addNewButtonField){this.editDialogWrap.appendChild(this.addNewButtonField.outerWrap)}if(!aS.id){aS.field.input.focus()}return aS}},{key:"editRoom",value:function aK(aS){if(!this.locationEditControlShown){return}aS.field.input.value=BX.util.trim(aS.field.input.value);if(!aS.id){if(aS.field.input.value&&BX.util.trim(aS.field.input.value)!==BX.util.trim(aS.name)){aS.name=aS.field.input.value;this.locationRoomList.push(this.addRoomField({id:0}))}}else{if(BX.util.trim(aS.field.input.value)!==aS.name){aS.name=aS.field.input.value;aS.changed=true}}}},{key:"saveValues",value:function aB(){var aU=this;var aS,aT=[];for(aS=0;aS<this.locationRoomList.length;aS++){if(this.locationRoomList[aS].field&&this.locationRoomList[aS].field.input){if(this.locationRoomList[aS].name!==this.locationRoomList[aS].field.input.value&&this.locationRoomList[aS].id){this.locationRoomList[aS].changed=true}this.locationRoomList[aS].name=this.locationRoomList[aS].field.input.value}if(!this.locationRoomList[aS].deleted&&this.locationRoomList[aS].name||this.locationRoomList[aS].id){aT.push({id:this.locationRoomList[aS].id||0,name:this.locationRoomList[aS].name||"",changed:this.locationRoomList[aS].changed||!this.locationRoomList[aS].id?"Y":"N",deleted:this.locationRoomList[aS].deleted||!this.locationRoomList[aS].name?"Y":"N"})}}BX.ajax.runAction("calendar.api.calendarajax.saveLocationList",{data:{locationList:aT}}).then(function(aV){ay.setLocationList(aV.data.locationList);aU.setValues()},function(aV){});this.locationEditControlShown=false}},{key:"getTextValue",value:function aH(aT){if(!aT){aT=this.value}var aS=aT.str||aT.text||"";if(aT&&aT.type==="mr"){aS="ECMR_"+aT.value+(aT.mrevid?"_"+aT.mrevid:"")}else{if(aT&&aT.type==="calendar"){aS="calendar_"+aT.value+(aT.room_event_id?"_"+aT.room_event_id:"")}}return aS}},{key:"getValue",value:function aA(){return this.value}},{key:"setValue",value:function az(aS){if(aw.Type.isPlainObject(aS)){this.value.text=aS.text||"";this.value.type=aS.type||"";this.value.value=aS.value||""}else{this.value=ay.parseStringValue(aS)}this.setValues();if(this.inlineEditModeEnabled){var aT=this.getTextLocation(this.value);this.DOM.inlineEditLink.innerHTML=aw.Text.encode(aT||aw.Loc.getMessage("EC_REMIND1_ADD"))}}},{key:"getTextLocation",value:function aD(aS){var aU=aw.Type.isPlainObject(aS)?aS:ay.parseStringValue(aS),aT,aV=aU.str;if(aw.Type.isArray(this.meetingRooms)&&aU.type==="mr"){for(aT=0;aT<this.meetingRooms.length;aT++){if(parseInt(aU.value)===parseInt(this.meetingRooms[aT].ID)){aV=this.meetingRooms[aT].NAME;break}}}if(aw.Type.isArray(ay.locationList)&&aU.type==="calendar"){for(aT=0;aT<ay.locationList.length;aT++){if(parseInt(aU.value)===parseInt(ay.locationList[aT].ID)){aV=ay.locationList[aT].NAME;break}}}return aV}},{key:"displayInlineEditControls",value:function aL(){this.DOM.inlineEditLinkWrap.style.display="none";this.DOM.inputWrap.style.display=""}}],[{key:"deleteField",value:function aP(aS){BX.remove(aS.field.outerWrap,true);aS.deleted=true;aS.changed=true}},{key:"parseStringValue",value:function aQ(aV){if(!aw.Type.isString(aV)){aV=""}var aT={type:false,value:false,str:aV};if(aV.substr(0,5)==="ECMR_"){aT.type="mr";var aU=aV.split("_");if(aU.length>=2){if(!isNaN(parseInt(aU[1]))&&parseInt(aU[1])>0){aT.value=aT.mrid=parseInt(aU[1])}if(!isNaN(parseInt(aU[2]))&&parseInt(aU[2])>0){aT.mrevid=parseInt(aU[2])}}}else{if(aV.substr(0,9)==="calendar_"){aT.type="calendar";var aS=aV.split("_");if(aS.length>=2){if(!isNaN(parseInt(aS[1]))&&parseInt(aS[1])>0){aT.value=aT.room_id=parseInt(aS[1])}if(!isNaN(parseInt(aS[2]))&&parseInt(aS[2])>0){aT.room_event_id=parseInt(aS[2])}}}}return aT}},{key:"setLocationList",value:function aG(aS){if(aw.Type.isArray(aS)){ay.locationList=aS}}},{key:"getLocationList",value:function aC(){return ay.locationList}},{key:"setMeetingRoomList",value:function aN(aS){if(aw.Type.isArray(aS)){ay.meetingRoomList=aS}}},{key:"getMeetingRoomList",value:function aO(){return ay.meetingRoomList}}]);return ay}();babelHelpers.defineProperty(a,"locationList",[]);babelHelpers.defineProperty(a,"meetingRoomList",[]);var p=function(){function az(){var aL=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,az);this.params=aL;this.id=aL.id||"user_selector_"+Math.round(Math.random()*1000000);this.zIndex=aL.zIndex||3100;this.DOM={wrapNode:aL.wrapNode};this.destinationInputName=aL.inputName||"EVENT_DESTINATION";if(aw.Type.isArray(this.params.itemsSelected)&&this.params.itemsSelected.length){this.params.itemsSelected=this.convertAttendeesCodes(this.params.itemsSelected)}this.create()}babelHelpers.createClass(az,[{key:"create",value:function aF(){var aQ=this.id;this.DOM.socnetDestinationWrap=this.DOM.wrapNode.appendChild(aw.Dom.create("DIV",{props:{className:"event-grid-dest-wrap"},events:{click:function aN(aR){BX.SocNetLogDestination.openDialog(aQ)}}}));this.socnetDestinationItems=this.DOM.socnetDestinationWrap.appendChild(aw.Dom.create("SPAN",{props:{className:""},events:{click:function aN(aS){var aR=aS.target||aS.srcElement;if(aR.className==="feed-event-del-but"){top.BX.SocNetLogDestination.deleteItem(aR.getAttribute("data-item-id"),aR.getAttribute("data-item-type"),aQ);aS.preventDefault();aS.stopPropagation()}},mouseover:function aL(aS){var aR=aS.target||aS.srcElement;if(aR.className==="feed-event-del-but"){BX.addClass(aR.parentNode,"event-grid-dest-hover")}},mouseout:function aO(aS){var aR=aS.target||aS.srcElement;if(aR.className==="feed-event-del-but"){BX.removeClass(aR.parentNode,"event-grid-dest-hover")}}}}));this.socnetDestinationInputWrap=this.DOM.socnetDestinationWrap.appendChild(aw.Dom.create("SPAN",{props:{className:"feed-add-destination-input-box"}}));this.socnetDestinationInput=this.socnetDestinationInputWrap.appendChild(aw.Dom.create("INPUT",{props:{id:aQ+"-inp",className:"feed-add-destination-inp"},attrs:{value:"",type:"text"},events:{keydown:function aM(aR){return top.BX.SocNetLogDestination.searchBeforeHandler(aR,{formName:aQ,inputId:aQ+"-inp"})},keyup:function aP(aR){return top.BX.SocNetLogDestination.searchHandler(aR,{formName:aQ,inputId:aQ+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.socnetDestinationLink=this.DOM.socnetDestinationWrap.appendChild(aw.Dom.create("SPAN",{html:this.params.addLinkMessage||BX.message("EC_DESTINATION_ADD_USERS"),props:{id:aQ+"-link",className:"feed-add-destination-link"},events:{keydown:function aM(aR){return top.BX.SocNetLogDestination.searchBeforeHandler(aR,{formName:aQ,inputId:aQ+"-inp"})},keyup:function aP(aR){return top.BX.SocNetLogDestination.searchHandler(aR,{formName:aQ,inputId:aQ+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.init()}},{key:"init",value:function aK(){var aM=this;if(!this.socnetDestinationInput||!this.DOM.socnetDestinationWrap||!this.params.items){return}if(this.params.selectGroups===false){this.params.items.groups={};this.params.items.department={};this.params.items.sonetgroups={}}if(this.params.selectUsers===false){this.params.items.users={};this.params.items.groups={};this.params.items.department={}}BX.SocNetLogDestination.init({name:this.id,searchInput:this.socnetDestinationInput,extranetUser:false,userSearchArea:"I",bindMainPopup:{node:this.DOM.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:this.DOM.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},callback:{select:this.selectCallback.bind(this),unSelect:this.unSelectCallback.bind(this),openDialog:this.openDialogCallback.bind(this),closeDialog:this.closeDialogCallback.bind(this),openSearch:this.openDialogCallback.bind(this),closeSearch:function aL(){aM.closeDialogCallback(true)}},items:this.params.items,itemsLast:this.params.itemsLast,itemsSelected:this.params.itemsSelected,departmentSelectDisable:this.params.selectGroups===false})}},{key:"closeAll",value:function aC(){if(top.BX.SocNetLogDestination.isOpenDialog()){top.BX.SocNetLogDestination.closeDialog()}top.BX.SocNetLogDestination.closeSearch()}},{key:"selectCallback",value:function aG(aN,aM){var aL=aM,aO="S";if(aM==="sonetgroups"){aO="SG"}else{if(aM==="groups"){aO="UA";aL="all-users"}else{if(aM==="users"){aO="U"}else{if(aM==="department"){aO="DR"}}}}this.socnetDestinationItems.appendChild(aw.Dom.create("span",{attrs:{"data-id":aN.id},props:{className:"event-grid-dest event-grid-dest-"+aL},children:[aw.Dom.create("input",{attrs:{type:"hidden",name:this.destinationInputName+"["+aO+"][]",value:aN.id}}),aw.Dom.create("span",{props:{className:"event-grid-dest-text"},html:aN.name}),aw.Dom.create("span",{props:{className:"feed-event-del-but"},attrs:{"data-item-id":aN.id,"data-item-type":aM}})]}));BX.onCustomEvent("OnDestinationAddNewItem",[aN]);this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(top.BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))}},{key:"unSelectCallback",value:function aI(aO,aN,aM){var aP=BX.findChildren(this.socnetDestinationItems,{attribute:{"data-id":aO.id}},true);if(aP!=null){for(var aL=0;aL<aP.length;aL++){BX.remove(aP[aL])}}BX.onCustomEvent("OnDestinationUnselect");this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(top.BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))}},{key:"openDialogCallback",value:function aJ(){if(top.BX.SocNetLogDestination.popupWindow){top.BX.SocNetLogDestination.popupWindow.params.zIndex=this.zIndex;top.BX.SocNetLogDestination.popupWindow.popupContainer.style.zIndex=this.zIndex}if(top.BX.SocNetLogDestination.popupSearchWindow){top.BX.SocNetLogDestination.popupSearchWindow.params.zIndex=this.zIndex;top.BX.SocNetLogDestination.popupSearchWindow.popupContainer.style.zIndex=this.zIndex}BX.style(this.socnetDestinationInputWrap,"display","inline-block");BX.style(this.socnetDestinationLink,"display","none");BX.focus(this.socnetDestinationInput)}},{key:"closeDialogCallback",value:function aA(aL){if(!top.BX.SocNetLogDestination.isOpenSearch()&&this.socnetDestinationInput.value.length<=0){BX.style(this.socnetDestinationInputWrap,"display","none");BX.style(this.socnetDestinationLink,"display","inline-block");if(aL===true){this.socnetDestinationInput.value=""}if(top.BX.SocNetLogDestination.backspaceDisable||top.BX.SocNetLogDestination.backspaceDisable!=null){BX.unbind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable)}BX.bind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable=function(aM){if(aM.keyCode===8){aM.preventDefault();return false}});setTimeout(function(){BX.unbind(window,"keydown",top.BX.SocNetLogDestination.backspaceDisable);top.BX.SocNetLogDestination.backspaceDisable=null},5000)}}},{key:"getCodes",value:function aH(){var aN=this.socnetDestinationItems.getElementsByTagName("INPUT"),aL=[],aM;for(aM=0;aM<aN.length;aM++){aL.push(aN[aM].value)}return aL}},{key:"getAttendeesCodes",value:function aE(){var aN=this.socnetDestinationItems.getElementsByTagName("INPUT"),aL=[],aM;for(aM=0;aM<aN.length;aM++){aL.push(aN[aM].value)}return this.convertAttendeesCodes(aL)}},{key:"convertAttendeesCodes",value:function aD(aL){var aM={};if(aw.Type.isArray(aL)){aL.forEach(function(aN){if(aN.substr(0,2)==="DR"){aM[aN]="department"}else{if(aN.substr(0,2)==="UA"){aM[aN]="groups"}else{if(aN.substr(0,2)==="SG"){aM[aN]="sonetgroups"}else{if(aN.substr(0,1)==="U"){aM[aN]="users"}}}}})}return aM}},{key:"getAttendeesCodesList",value:function ay(aM){var aL=[];if(!aM){aM=this.getAttendeesCodes()}for(var aN in aM){if(aM.hasOwnProperty(aN)){aL.push(aN)}}return aL}},{key:"setValue",value:function aB(aL){if(this.socnetDestinationItems){aw.Dom.clean(this.socnetDestinationItems)}if(aw.Type.isArray(aL)){this.params.itemsSelected=this.convertAttendeesCodes(aL)}this.init()}}]);return az}();function au(){var az=babelHelpers.taggedTemplateLiteral(['<div style="background-color: #000;" class="calendar-field-select-icon"></div>']);au=function ay(){return az};return az}var am=function(aE){babelHelpers.inherits(aB,aE);function aB(aG){var aH;babelHelpers.classCallCheck(this,aB);aH=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aB).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aH),"LINE_MODE","line");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aH),"SELECTOR_MODE","selector");aH.setEventNamespace("BX.Calendar.Controls.ColorSelector");aH.id=aG.id||"color-select-"+Math.round(Math.random()*1000000);aH.defaultColors=aj.Util.getDefaultColorList();aH.colors=[];aH.zIndex=3100;aH.mode=aG.mode||aH.LINE_MODE;aH.DOM={wrap:aG.wrap};aH.create();aH.setViewMode(aG.viewMode||false);return aH}babelHelpers.createClass(aB,[{key:"create",value:function aA(){var aI=this;if(this.mode===this.LINE_MODE){for(var aG=0;aG<this.defaultColors.length;aG++){this.colors.push({color:this.defaultColors[aG],node:this.DOM.wrap.appendChild(aw.Dom.create("LI",{props:{className:"calendar-field-colorpicker-color-item"},attrs:{"data-bx-calendar-color":this.defaultColors[aG]},style:{backgroundColor:this.defaultColors[aG]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.DOM.customColorNode=this.DOM.wrap.appendChild(aw.Dom.create("LI",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:"transparent",width:0},html:'<span class="calendar-field-colorpicker-color"></span>'}));this.DOM.customColorLink=this.DOM.wrap.appendChild(aw.Dom.create("LI",{props:{className:"calendar-field-colorpicker-color-item-more"},html:'<span class="calendar-field-colorpicker-color-item-more-link">'+aw.Loc.getMessage("EC_COLOR")+"</span>",events:{click:function aH(){if(!aI.colorPickerPopup){aI.colorPickerPopup=new BX.ColorPicker({bindElement:aI.DOM.customColorLink,onColorSelected:aI.setValue.bind(aI),popupOptions:{zIndex:aI.zIndex}})}aI.colorPickerPopup.open()}}}));aw.Event.bind(this.DOM.wrap,"click",this.handleColorClick.bind(this))}else{if(this.mode===this.SELECTOR_MODE){this.DOM.colorIcon=this.DOM.wrap.appendChild(aw.Tag.render(au()));aw.Event.bind(this.DOM.wrap,"click",this.openPopup.bind(this))}}}},{key:"handleColorClick",value:function aD(aI){if(this.viewMode){return}var aH=aj.Util.findTargetNode(aI.target||aI.srcElement,this.DOM.wrap);if(aH&&aH.getAttribute){var aG=aH.getAttribute("data-bx-calendar-color");if(aG!==null){this.setValue(aG)}}}},{key:"setValue",value:function aF(aG){var aI=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this.viewMode){return}this.activeColor=aG;if(this.mode===this.LINE_MODE){if(this.DOM.activeColorNode){BX.removeClass(this.DOM.activeColorNode,"active")}if(!BX.util.in_array(this.activeColor,this.defaultColors)&&this.activeColor){this.DOM.customColorNode.style.backgroundColor=this.activeColor;this.DOM.customColorNode.style.width="";this.DOM.activeColorNode=this.DOM.customColorNode;BX.addClass(this.DOM.activeColorNode,"active")}var aH;for(aH=0;aH<this.colors.length;aH++){if(this.colors[aH].color===this.activeColor){this.DOM.activeColorNode=this.colors[aH].node;BX.addClass(this.DOM.activeColorNode,"active");break}}}else{if(this.mode===this.SELECTOR_MODE){if(this.DOM.colorIcon){this.DOM.colorIcon.style.backgroundColor=this.activeColor}if(this.viewMode){this.DOM.wrap.style.backgroundColor=this.activeColor}}}if(aI){this.emit("onChange",new T.BaseEvent({data:{value:this.activeColor}}))}}},{key:"getValue",value:function az(){return this.activeColor}},{key:"openPopup",value:function ay(){var aJ=this;if(this.viewMode){return}if(this.popup&&this.popup.popupWindow&&this.popup.popupWindow.isShown()){return this.popup.close()}var aH,aG=[],aI;this.defaultColors.forEach(function(aK){aG.push({text:aK,color:aK,className:"calendar-add-popup-color-menu-item",onclick:function(aL){return function(){aJ.setValue(aL);aJ.popup.close()}}(aK)})});this.popup=ax.MenuManager.create(this.id,this.DOM.colorIcon,aG,{className:"calendar-color-popup-wrap",width:162,closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:52,angle:true,cacheable:false});this.popup.show();for(aH=0;aH<this.popup.menuItems.length;aH++){if(this.popup.menuItems[aH].layout.item){aI=this.popup.menuItems[aH].layout.item.querySelector(".menu-popup-item-icon");if(aw.Type.isDomNode(aI)){aI.style.backgroundColor=this.popup.menuItems[aH].color}}}this.popup.popupWindow.angle.element.style.left="6px"}},{key:"setViewMode",value:function aC(aG){this.viewMode=aG;if(this.viewMode){aw.Dom.clean(this.DOM.wrap);this.DOM.wrap.className="calendar-field-select-icon";this.DOM.wrap.style.backgroundColor=this.activeColor}}}]);return aB}(T.EventEmitter);function H(){var ay=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-bitrix24"><i></i></div>']);H=function az(){return ay};return ay}function L(){var ay=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-user"><i></i></div>']);L=function az(){return ay};return ay}function Q(){var az=babelHelpers.taggedTemplateLiteral(['<div class="ui-icon ui-icon-common-user-group"><i></i></div>']);Q=function ay(){return az};return az}function U(){var az=babelHelpers.taggedTemplateLiteral(['<img class="calendar-field-choice-calendar-img-value" src="','">']);U=function ay(){return az};return az}function Z(){var az=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-choice-calendar-name">',"</span>"]);Z=function ay(){return az};return az}function at(){var az=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-choice-calendar-img"></span>']);at=function ay(){return az};return az}var ad=function(){function aI(aO){babelHelpers.classCallCheck(this,aI);this.id=aO.id||"section-select-"+Math.round(Math.random()*1000000);this.sectionList=aO.sectionList;this.sectionGroupList=aO.sectionGroupList;this.selectCallback=aO.selectCallback;this.openPopupCallback=aO.openPopupCallback;this.closePopupCallback=aO.closePopupCallback;this.getCurrentSection=aO.getCurrentSection;this.defaultCalendarType=aO.defaultCalendarType;this.defaultOwnerId=parseInt(aO.defaultOwnerId);this.zIndex=aO.zIndex||3200;this.mode=aO.mode;this.DOM={outerWrap:aO.outerWrap};this.create();this.initEventHandlers()}babelHelpers.createClass(aI,[{key:"create",value:function aD(){if(this.mode==="textselect"){this.DOM.select=this.DOM.outerWrap;this.DOM.selectImageWrap=this.DOM.select.appendChild(aw.Tag.render(at()));this.DOM.selectInnerText=this.DOM.select.appendChild(aw.Tag.render(Z(),aw.Text.encode(aw.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle())))}else{this.DOM.select=this.DOM.outerWrap.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field calendar-field-select"+(this.mode==="compact"?" calendar-field-tiny":"")}}));this.DOM.innerValue=this.DOM.select.appendChild(aw.Dom.create("DIV",{props:{className:"calendar-field-select-icon"},style:{backgroundColor:this.getCurrentColor()}}));if(this.mode==="full"){this.DOM.selectInnerText=this.DOM.select.appendChild(aw.Dom.create("SPAN",{text:this.getCurrentTitle()}))}}}},{key:"initEventHandlers",value:function ay(){aw.Event.bind(this.DOM.select,"click",BX.delegate(this.openPopup,this))}},{key:"openPopup",value:function aB(){var aT=this;if(this.viewMode){return false}if(this.sectionMenu&&this.sectionMenu.popupWindow&&this.sectionMenu.popupWindow.isShown()){return this.sectionMenu.close()}var aS="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";var aQ=[];var aO=[];var aV=this.getSectionList();var aP;if(aw.Type.isArray(this.sectionGroupList)){this.sectionGroupList.forEach(function(aW){var aX;if(aW.belongsToView){aX=aV.filter(aT.sectionBelongsToView,aT)}else{if(aW.type==="user"){aX=aV.filter(function(aZ){return aI.getSectionType(aZ)==="user"&&aI.getSectionOwner(aZ)===aW.ownerId})}else{if(aW.type==="company"){aX=aV.filter(function(aZ){return aI.getSectionType(aZ)==="company_calendar"||aI.getSectionType(aZ)===aW.type})}else{aX=aV.filter(function(aZ){return aI.getSectionType(aZ)===aW.type})}}}aX=aX.filter(function(aZ){var a0=parseInt(aZ.id||aZ.ID);if(aO.includes(a0)){return false}aO.push(a0);return true});if(aX.length>0){aQ.push({html:"<span>"+aW.title+"</span>",className:aS});for(var aY=0;aY<aX.length;aY++){aQ.push(aT.getMenuItem(aX[aY]))}}})}else{for(aP=0;aP<aV.length;aP++){aQ.push(this.getMenuItem(aV[aP]))}}var aU=0;if(this.mode==="compact"){aU=40}else{if(this.mode==="textselect"){aU=0}}this.sectionMenu=ax.MenuManager.create(this.id,this.DOM.select,aQ,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:aU,angle:this.mode==="compact"});this.sectionMenu.popupWindow.contentContainer.style.overflow="auto";this.sectionMenu.popupWindow.contentContainer.style.maxHeight="400px";if(this.mode==="full"){this.sectionMenu.popupWindow.setWidth(this.DOM.select.offsetWidth-2);this.sectionMenu.popupWindow.contentContainer.style.overflowX="hidden"}this.sectionMenu.show();for(aP=0;aP<this.sectionMenu.menuItems.length;aP++){if(this.sectionMenu.menuItems[aP].layout.item){var aR=this.sectionMenu.menuItems[aP].layout.item.querySelector(".menu-popup-item-icon");if(aR){aR.style.backgroundColor=this.sectionMenu.menuItems[aP].color}}}BX.addClass(this.DOM.select,"active");if(aw.Type.isFunction(this.openPopupCallback)){this.openPopupCallback(this)}BX.addCustomEvent(this.sectionMenu.popupWindow,"onPopupClose",BX.delegate(function(){if(aw.Type.isFunction(this.openPopupCallback)){this.closePopupCallback()}BX.removeClass(this.DOM.select,"active");BX.PopupMenu.destroy(this.id);this.sectionMenu=null},this))}},{key:"getCurrentColor",value:function az(){return(this.getCurrentSection()||{}).color||false}},{key:"getCurrentTitle",value:function aF(){return(this.getCurrentSection()||{}).name||""}},{key:"getSectionList",value:function aK(){return this.sectionList.filter(function(aO){return aO.PERM&&aO.PERM.edit||aw.Type.isFunction(aO.canDo)&&aO.canDo("edit")})}},{key:"updateSectionImageNode",value:function aN(aP){var aO=this;if(!aw.Type.isElementNode(this.DOM.selectImageWrap)){return}if(aP===undefined){aP=this.sectionList.find(function(aS){return parseInt(aS.id)===parseInt(aO.getCurrentSection().id)})}if(aP&&aP.type){var aR=aI.getSectionImage(aP);var aQ;if(aR){aQ=aw.Tag.render(U(),aR)}else{if(aP.type==="group"){aQ=aw.Tag.render(Q())}else{if(aP.type==="user"){aQ=aw.Tag.render(L())}else{aQ=aw.Tag.render(H())}}}aw.Dom.clean(this.DOM.selectImageWrap);this.DOM.selectImageWrap.appendChild(aQ)}}},{key:"getPopup",value:function aH(){return this.sectionMenu}},{key:"getMenuItem",value:function aE(aO){var aP=this;return{html:BX.util.htmlspecialchars(aO.name||aO.NAME),color:aO.color||aO.COLOR,className:"calendar-add-popup-section-menu-item"+(this.mode==="full"?" section-menu-item-full":""),onclick:function(aQ){return function(){if(aw.Type.isDomNode(aP.DOM.innerValue)){aP.DOM.innerValue.style.backgroundColor=aQ.color||aO.COLOR}aP.updateSectionImageNode(aQ);if(aw.Type.isFunction(aP.selectCallback)){if(!aQ.color&&aO.COLOR){aQ.color=aO.COLOR}if(!aQ.id&&aO.ID){aQ.id=aO.ID}aP.selectCallback(aQ)}aP.sectionMenu.close();aP.updateValue()}}(aO)}}},{key:"sectionBelongsToView",value:function aC(aO){return aI.getSectionType(aO)===this.defaultCalendarType&&aI.getSectionOwner(aO)===this.defaultOwnerId}},{key:"updateValue",value:function aJ(){if(aw.Type.isDomNode(this.DOM.innerValue)){this.DOM.innerValue.style.backgroundColor=this.getCurrentColor()}if(this.mode==="full"){this.DOM.select.appendChild(aw.Dom.adjust(this.DOM.selectInnerText,{text:this.getCurrentTitle(),props:{title:this.getCurrentTitle()}}))}else{if(this.mode==="textselect"){this.updateSectionImageNode();this.DOM.select.appendChild(aw.Dom.adjust(this.DOM.selectInnerText,{props:{title:aw.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle()},text:aw.Loc.getMessage("EC_CALENDAR_SECTION_TITLE")+" "+this.getCurrentTitle()}))}}}},{key:"setViewMode",value:function aG(aO){this.viewMode=aO;if(this.viewMode){aw.Dom.addClass(this.DOM.outerWrap,"calendar-section-selector-readonly")}else{aw.Dom.removeClass(this.DOM.outerWrap,"calendar-section-selector-readonly")}}}],[{key:"getSectionType",value:function aL(aO){return aO.type||aO.CAL_TYPE}},{key:"getSectionImage",value:function aA(){var aO=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return aO.data?aO.data.IMAGE:aO.IMAGE||""}},{key:"getSectionOwner",value:function aM(aO){return parseInt(aO.OWNER_ID||aO.data.OWNER_ID)}}]);return aI}();var o=function(){function aC(aE){babelHelpers.classCallCheck(this,aC);var aD=aE.rruleType.form.elements;this.getDate=aE.getDate;this.DOM={formElements:aD,wrap:aE.wrap,rruleType:aE.rruleType,interval:aD["EVENT_RRULE[INTERVAL]"],rruleEndsOn:{never:aD.rrule_endson[0],count:aD.rrule_endson[1],until:aD.rrule_endson[2]},count:aD["EVENT_RRULE[COUNT]"],until:aD["EVENT_RRULE[UNTIL]"]};this.create()}babelHelpers.createClass(aC,[{key:"create",value:function az(){BX.bind(this.DOM.rruleType,"change",BX.delegate(function(){this.changeType(this.DOM.rruleType.value)},this));BX.bind(this.DOM.until,"click",BX.proxy(function(){BX.calendar({node:this.DOM.until,field:this.DOM.until,bTime:false});BX.focus(this.DOM.until);this.DOM.rruleEndsOn.until.checked=true},this));BX.bind(this.DOM.count,"click",BX.proxy(function(){this.DOM.rruleEndsOn.count.checked=true},this))}},{key:"changeType",value:function ay(aF){this.DOM.rruleType.value=aF?aF.toUpperCase():"NONE";var aG=this.DOM.rruleType.value.toLowerCase();this.DOM.wrap.className="calendar-rrule-type-"+aG;if(aG==="weekly"&&BX.type.isFunction(this.getDate)){var aE=this.getDate();if(BX.type.isDate(aE)){var aD=aj.Util.getWeekDayByInd(aE.getDay());this.DOM.formElements["EVENT_RRULE[BYDAY][]"].forEach(function(aH){aH.checked=aH.checked||aH.value===aD},this)}}}},{key:"setValue",value:function aB(){var aD=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.changeType(aD.FREQ);this.DOM.interval.value=aD.INTERVAL||1;if(aD.COUNT){this.DOM.rruleEndsOn.count.checked="checked";this.DOM.count.value=aD.COUNT}else{if(aD["~UNTIL"]){this.DOM.rruleEndsOn.until.checked="checked";this.DOM.until.value=aD["~UNTIL"]}else{this.DOM.rruleEndsOn.never.checked="checked"}}if(BX.type.isPlainObject(aD.BYDAY)){this.DOM.formElements["EVENT_RRULE[BYDAY][]"].forEach(function(aE){aE.checked=aD.BYDAY.hasOwnProperty(aE.value)},this)}}},{key:"getType",value:function aA(){return this.DOM.rruleType.value.toLowerCase()}}]);return aC}();var q=function(){function az(aK){babelHelpers.classCallCheck(this,az);this.id=aK.id||"bx-select-input-"+Math.round(Math.random()*1000000);this.values=aK.values||false;this.input=aK.input;this.defaultValue=aK.defaultValue||"";this.openTitle=aK.openTitle||"";this.className=aK.className||"";this.onChangeCallback=aK.onChangeCallback||null;this.zIndex=aK.zIndex||1200;this.disabled=aK.disabled;this.minWidth=aK.minWidth||0;this.setValue({value:aK.value,valueIndex:aK.valueIndex});this.curInd=false;this.bindEventHandlers()}babelHelpers.createClass(az,[{key:"bindEventHandlers",value:function aA(){if(this.onChangeCallback){BX.bind(this.input,"change",this.onChangeCallback);BX.bind(this.input,"keyup",this.onChangeCallback)}if(this.values){BX.bind(this.input,"click",BX.proxy(this.onClick,this));BX.bind(this.input,"focus",BX.proxy(this.onFocus,this));BX.bind(this.input,"blur",BX.proxy(this.onBlur,this));BX.bind(this.input,"keyup",BX.proxy(this.onKeyup,this))}}},{key:"setValue",value:function aB(aK){this.currentValue={value:aK.value};this.currentValueIndex=aK.valueIndex;if(this.currentValueIndex!==undefined&&this.values[this.currentValueIndex]){this.input.value=this.values[this.currentValueIndex].label}}},{key:"getInputValue",value:function aF(){return this.input.value}},{key:"showPopup",value:function aE(){if(this.shown||this.disabled){return}var aP=0,aK=0,aM=[],aL,aQ=this;for(aL=0;aL<this.values.length;aL++){if(this.values[aL].delimiter){aM.push(this.values[aL])}else{if(this.currentValue&&this.values[aL]&&this.values[aL].value===this.currentValue.value){aP=aK}aM.push({id:this.values[aL].value,text:this.values[aL].label,onclick:this.values[aL].callback||function(aS,aR){return function(){aQ.input.value=aR;aQ.popupMenu.close();aQ.onChange()}}(this.values[aL].value,this.values[aL].labelRaw||this.values[aL].label)});aK++}}this.popupMenu=BX.PopupMenu.create(this.id,this.input,aM,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:-1});this.popupMenu.popupWindow.setWidth(Math.max(this.input.offsetWidth+2,this.minWidth));var aO=this.popupMenu.layout.menuContainer;BX.addClass(this.popupMenu.layout.menuContainer,"calendar-select-popup");this.popupMenu.show();var aN=this.popupMenu.menuItems[aP];if(aN&&aN.layout){aO.scrollTop=aN.layout.item.offsetTop-aN.layout.item.offsetHeight}BX.addCustomEvent(this.popupMenu.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(this.id);this.shown=false;this.popupMenu=null}.bind(this));this.input.select();this.shown=true}},{key:"closePopup",value:function aI(){BX.PopupMenu.destroy(this.id);this.popupMenu=null;this.shown=false}},{key:"onFocus",value:function aG(){setTimeout(function(){if(!this.shown){this.showPopup()}}.bind(this),200)}},{key:"onClick",value:function aD(){if(this.shown){this.closePopup()}else{this.showPopup()}}},{key:"onBlur",value:function ay(){setTimeout(BX.delegate(this.closePopup,this),200)}},{key:"onKeyup",value:function aJ(){setTimeout(BX.delegate(this.closePopup,this),50)}},{key:"onChange",value:function aC(){var aK=this.input.value;BX.onCustomEvent(this,"onSelectInputChanged",[this,aK]);if(BX.type.isFunction(this.onChangeCallback)){this.onChangeCallback({value:aK})}}},{key:"destroy",value:function aH(){if(this.onChangeCallback){BX.unbind(this.input,"change",this.onChangeCallback);BX.unbind(this.input,"keyup",this.onChangeCallback)}BX.unbind(this.input,"click",BX.proxy(this.onClick,this));BX.unbind(this.input,"focus",BX.proxy(this.onFocus,this));BX.unbind(this.input,"blur",BX.proxy(this.onBlur,this));BX.unbind(this.input,"keyup",BX.proxy(this.onKeyup,this));if(this.popupMenu){this.popupMenu.close()}BX.PopupMenu.destroy(this.id);this.popupMenu=null;this.shown=false}}]);return az}();var ak=function(){function aB(){var aF=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,aB);this.id=aF.id||"popup-dialog-"+Math.random();this.zIndex=aF.zIndex||3200;this.DOM={};this.title=""}babelHelpers.createClass(aB,[{key:"create",value:function aA(){this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:this.getTitle(),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:this.getButtons(),content:this.getContent(),events:{}})}},{key:"getTitle",value:function az(){return this.title}},{key:"getContent",value:function aD(){this.DOM.content=BX.create("DIV");return this.DOM.content}},{key:"getButtons",value:function aC(){this.buttons=[];return this.buttons}},{key:"show",value:function ay(aF){if(!this.dialog){this.create()}this.dialog.show()}},{key:"close",value:function aE(){if(this.dialog){this.dialog.close()}}}]);return aB}();function J(){var ay=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-text-mode-inner" style="display: none;"></div>']);J=function az(){return ay};return ay}function P(){var az=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-dropdown"></div>']);P=function ay(){return az};return az}function S(){var az=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-text-inner"></div>']);S=function ay(){return az};return az}function Y(){var az=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-text"></div>']);Y=function ay(){return az};return az}function ar(){var az=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-selector"></div>']);ar=function ay(){return az};return az}var d=function(ay){babelHelpers.inherits(aD,ay);function aD(){var aI;var aH=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,aD);aI=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aD).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aI),"views",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aI),"created",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aI),"currentValue",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aI),"currentViewMode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aI),"DOM",{});aI.setEventNamespace("BX.Calendar.Controls.ViewSelector");if(aw.Type.isArray(aH.views)){aI.views=aH.views}aI.zIndex=aH.zIndex||3200;aI.popupId=aH.id||"view-selector-"+Math.round(Math.random()*10000);aI.create();if(aH.currentView){aI.setValue(aH.currentView)}if(aH.currentViewMode){aI.setViewMode(aH.currentViewMode)}return aI}babelHelpers.createClass(aD,[{key:"create",value:function aA(){this.DOM.wrap=aw.Tag.render(ar());this.DOM.selectorText=aw.Tag.render(Y());this.DOM.selectorTextInner=this.DOM.selectorText.appendChild(aw.Tag.render(S()));this.DOM.wrap.appendChild(this.DOM.selectorText);this.DOM.wrap.appendChild(aw.Tag.render(P()));aw.Event.bind(this.DOM.wrap,"click",this.showPopup.bind(this));this.DOM.viewModeTextInner=this.DOM.selectorText.appendChild(aw.Tag.render(J()));this.created=true}},{key:"getOuterWrap",value:function aG(){if(!this.created){this.create()}return this.DOM.wrap}},{key:"setValue",value:function az(aH){this.currentValue=this.views.find(function(aI){return aH.name===aI.name},this);if(this.currentValue){aw.Dom.adjust(this.DOM.selectorTextInner,{text:this.currentValue.text})}}},{key:"setViewMode",value:function aB(aH){if(aH){this.currentViewMode=this.views.find(function(aI){return aH===aI.name&&aI.type==="additional"},this);if(this.currentViewMode){aw.Dom.adjust(this.DOM.viewModeTextInner,{text:"("+this.currentViewMode.text+")"})}this.DOM.viewModeTextInner.style.display=this.currentViewMode?"":"block"}}},{key:"getMenuItems",value:function aC(){var aH=[];this.views.forEach(function(aI){if(aI.type==="base"){aH.push({html:"<span>"+aI.text+"</span>"+(aI.hotkey?'<span class="calendar-item-hotkey">'+aI.hotkey+"</span>":""),className:this.currentValue.name===aI.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:aI.name,type:aI.type,dataset:aI.dataset});this.menuPopup.close()}.bind(this)})}},this);if(aH.length<this.views.length){aH.push({html:"<span>"+aw.Loc.getMessage("EC_VIEW_MODE_SHOW_BY")+"</span>",className:"main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label"});this.views.forEach(function(aI){if(aI.type==="additional"){aH.push({text:aI.text,className:this.currentViewMode.name===aI.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:aI.name,type:aI.type,dataset:aI.dataset});this.menuPopup.close()}.bind(this)})}},this)}return aH}},{key:"showPopup",value:function aE(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=ax.MenuManager.create(this.popupId,this.DOM.selectorText,this.getMenuItems(),{className:"calendar-view-switcher-popup",closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:-3,offsetLeft:this.DOM.selectorText.offsetWidth-6,angle:true,cacheable:false});this.menuPopup.show()}},{key:"closePopup",value:function aF(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}}]);return aD}(T.EventEmitter);function X(){var az=babelHelpers.taggedTemplateLiteral(['<span \n\t\t\t\t\t\tclass="calendar-view-switcher-list-item"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>',"</span>"]);X=function ay(){return az};return az}function aq(){var az=babelHelpers.taggedTemplateLiteral(['<div class="calendar-view-switcher-list"></div>']);aq=function ay(){return az};return az}var m=function(aB){babelHelpers.inherits(aC,aB);function aC(){var aG;var aF=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,aC);aG=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aC).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"views",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"created",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"currentValue",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"currentViewMode",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"DOM",{});aG.setEventNamespace("BX.Calendar.Controls.LineViewSelector");if(aw.Type.isArray(aF.views)){aG.views=aF.views}aG.viewsMap=new WeakMap();aG.zIndex=aF.zIndex||3200;aG.popupId=aF.id||"view-selector-"+Math.round(Math.random()*10000);aG.create();if(aF.currentView){aG.setValue(aF.currentView)}return aG}babelHelpers.createClass(aC,[{key:"create",value:function az(){var aF=this;this.DOM.wrap=aw.Tag.render(aq());this.views.forEach(function(aG){if(aG.type==="base"){aF.viewsMap.set(aG,{wrap:aF.DOM.wrap.appendChild(aw.Tag.render(X(),function(){aF.emit("onChange",{name:aG.name,type:aG.type,dataset:aG.dataset})},aG.text))})}});this.created=true}},{key:"getOuterWrap",value:function aE(){if(!this.created){this.create()}return this.DOM.wrap}},{key:"setValue",value:function aD(aH){this.currentValue=this.views.find(function(aI){return aH.name===aI.name},this);if(this.currentValue){var aG=this.viewsMap.get(this.currentValue);var aF=this.DOM.wrap.querySelector(".calendar-view-switcher-list-item-active");if(aw.Type.isDomNode(aF)){aw.Dom.removeClass(aF,"calendar-view-switcher-list-item-active")}if(aw.Type.isDomNode(aG.wrap)){aw.Dom.addClass(aG.wrap,"calendar-view-switcher-list-item-active")}}}},{key:"setViewMode",value:function aA(aF){if(aF){this.currentViewMode=this.views.find(function(aG){return aF===aG.name&&aG.type==="additional"},this)}}},{key:"getMenuItems",value:function ay(){var aG=this;var aF=[];this.views.forEach(function(aH){if(aH.type==="base"){aF.push({html:"<span>"+aH.text+"</span>"+(aH.hotkey?'<span class="calendar-item-hotkey">'+aH.hotkey+"</span>":""),className:aG.currentValue.name===aH.name?"menu-popup-item-accept":" ",onclick:function aI(){aG.emit("onChange",{name:aH.name,type:aH.type,dataset:aH.dataset});aG.menuPopup.close()}})}});if(aF.length<this.views.length){aF.push({html:"<span>"+aw.Loc.getMessage("EC_VIEW_MODE_SHOW_BY")+"</span>",className:"main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label"});this.views.forEach(function(aH){if(aH.type==="additional"){aF.push({text:aH.text,className:this.currentViewMode.name===aH.name?"menu-popup-item-accept":" ",onclick:function(){this.emit("onChange",{name:aH.name,type:aH.type,dataset:aH.dataset});this.menuPopup.close()}.bind(this)})}},this)}return aF}}]);return aC}(T.EventEmitter);var n=function(ay){babelHelpers.inherits(aA,ay);function aA(){var aG;var aF=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,aA);aG=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aA).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"showTasks",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"DOM",{});aG.setEventNamespace("BX.Calendar.Controls.AddButton");aG.zIndex=aF.zIndex||3200;aG.popupId=aF.id||"add-button-"+Math.round(Math.random()*10000);aG.showTasks=aF.showTasks;aG.addEntryHandler=aw.Type.isFunction(aF.addEntry)?aF.addEntry:null;aG.addTaskHandler=aw.Type.isFunction(aF.addTask)?aF.addTask:null;aG.create();return aG}babelHelpers.createClass(aA,[{key:"create",value:function az(){this.menuItems=[{text:aw.Loc.getMessage("EC_ADD_EVENT"),onclick:this.addEntry.bind(this)}];if(this.addTaskHandler){this.menuItems.push({text:aw.Loc.getMessage("EC_ADD_TASK"),onclick:this.addTask.bind(this)})}if(this.menuItems.length>1){this.DOM.wrap=aw.Dom.create("span",{props:{className:"ui-btn-split ui-btn-primary"},children:[aw.Dom.create("button",{props:{className:"ui-btn-main",type:"button"},html:aw.Loc.getMessage("EC_ADD"),events:{click:this.addEntry.bind(this)}})]});this.DOM.addButtonExtra=aw.Dom.create("span",{props:{className:"ui-btn-extra"},events:{click:this.showPopup.bind(this)}});this.DOM.wrap.appendChild(this.DOM.addButtonExtra)}else{this.DOM.wrap=aw.Dom.create("button",{props:{className:"ui-btn ui-btn-primary",type:"button"},html:aw.Loc.getMessage("EC_ADD"),events:{click:this.addEntry.bind(this)}})}}},{key:"getWrap",value:function aD(){return this.DOM.wrap}},{key:"showPopup",value:function aE(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=BX.PopupMenu.create(this.popupId,this.DOM.addButtonExtra,this.menuItems,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true});this.menuPopup.show();BX.addCustomEvent(this.menuPopup.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(this.popupId);this.menuPopup=null;this.addBtnMenu=null}.bind(this))}},{key:"addEntry",value:function aC(){if(this.addEntryHandler){this.addEntryHandler()}if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}},{key:"addTask",value:function aB(){if(this.addTaskHandler){this.addTaskHandler()}if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}}}]);return aA}(aw.Event.EventEmitter);var O=function(az){babelHelpers.inherits(aE,az);function aE(){var aG;var aF=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,aE);aG=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aE).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"showTasks",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aG),"DOM",{});aG.setEventNamespace("BX.Calendar.Controls.MeetingStatusControl");aG.BX=aj.Util.getBX();if(aF.wrap&&aw.Type.isDomNode(aF.wrap)){aG.DOM.wrap=aF.wrap}else{throw new Error('The argument "params.wrap" must be a DOM node.')}aG.id=aF.id||"meeting-status-control-"+Math.round(Math.random()*10000);aG.zIndex=3100;aG.create();aG.status=aF.currentStatus||null;if(aG.status){aG.updateStatus()}return aG}babelHelpers.createClass(aE,[{key:"create",value:function aC(){this.acceptBtn=new BX.UI.Button({text:aw.Loc.getMessage("EC_VIEW_DESIDE_BUT_Y"),className:"ui-btn ui-btn-primary",events:{click:this.accept.bind(this)}});this.acceptBtn.renderTo(this.DOM.wrap);this.declineBtn=new BX.UI.Button({text:aw.Loc.getMessage("EC_VIEW_DESIDE_BUT_N"),className:"ui-btn ui-btn-light-border",events:{click:this.decline.bind(this)}});this.declineBtn.renderTo(this.DOM.wrap)}},{key:"updateStatus",value:function ay(){if(this.status==="H"){this.acceptBtn.getContainer().style.display="none";this.declineBtn.getContainer().style.display="";this.declineBtn.setText(aw.Loc.getMessage("EC_VIEW_DESIDE_BUT_OWNER_N"))}else{if(this.status==="Y"){this.acceptBtn.getContainer().style.display="none";this.declineBtn.getContainer().style.display=""}else{if(this.status==="N"){this.acceptBtn.getContainer().style.display="";this.declineBtn.getContainer().style.display="none"}else{this.acceptBtn.getContainer().style.display="";this.declineBtn.getContainer().style.display=""}}}}},{key:"accept",value:function aB(){this.setStatus("Y")}},{key:"decline",value:function aD(){this.setStatus("N")}},{key:"setStatus",value:function aA(aF){var aG=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.status=aF;if(this.menuPopup){this.menuPopup.close()}if(aG){this.emit("onSetStatus",new aw.Event.BaseEvent({data:{status:aF}}))}this.updateStatus()}}]);return aE}(aw.Event.EventEmitter);var ab=function(aA){babelHelpers.inherits(az,aA);function az(){var aC;babelHelpers.classCallCheck(this,az);aC=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(az).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"DOM",{});aC.setEventNamespace("BX.Calendar.Controls.ConfirmStatusDialog");aC.zIndex=3200;aC.id="confirm-status-dialog-"+Math.round(Math.random()*10000);return aC}babelHelpers.createClass(az,[{key:"show",value:function ay(){var aC=aw.Dom.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_DECLINE_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:aw.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:this.close.bind(this)}})],content:aC,events:{}});aC.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_DECLINE_ONLY_THIS"),events:{click:function(){this.emit("onDecline",new T.BaseEvent({data:{recursionMode:"this"}}));this.close()}.bind(this)}}).buttonNode);aC.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_DECLINE_NEXT"),events:{click:function(){this.emit("onDecline",new T.BaseEvent({data:{recursionMode:"next"}}));this.close()}.bind(this)}}).buttonNode);aC.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_DECLINE_ALL"),events:{click:function(){this.emit("onDecline",new T.BaseEvent({data:{recursionMode:"all"}}));this.close()}.bind(this)}}).buttonNode);this.dialog.show()}},{key:"close",value:function aB(){if(this.dialog){this.dialog.close()}}}]);return az}(T.EventEmitter);var b=function(aA){babelHelpers.inherits(az,aA);function az(){var aC;babelHelpers.classCallCheck(this,az);aC=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(az).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"DOM",{});aC.setEventNamespace("BX.Calendar.Controls.ConfirmEditDialog");aC.zIndex=3200;aC.id="confirm-status-dialog-"+Math.round(Math.random()*10000);return aC}babelHelpers.createClass(az,[{key:"show",value:function ay(){var aE=this;var aD=aw.Dom.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_EDIT_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:aw.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:this.close.bind(this)}})],content:aD,events:{},cacheable:false});aD.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:function aC(){aE.emit("onEdit",new T.BaseEvent({data:{recursionMode:"this"}}));aE.close()}}}).buttonNode);aD.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_REC_EV_NEXT"),events:{click:function aC(){aE.emit("onEdit",new T.BaseEvent({data:{recursionMode:"next"}}));aE.close()}}}).buttonNode);aD.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_REC_EV_ALL"),events:{click:function aC(){aE.emit("onEdit",new T.BaseEvent({data:{recursionMode:"all"}}));aE.close()}}}).buttonNode);this.dialog.show()}},{key:"close",value:function aB(){if(this.dialog){this.dialog.close()}}}]);return az}(T.EventEmitter);var h=function(ay){babelHelpers.inherits(az,ay);function az(){var aD;var aC=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,az);aD=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(az).call(this,aC));aD.title=BX.message("EC_DEL_REC_EVENT");aD.entry=aC.entry;return aD}babelHelpers.createClass(az,[{key:"getContent",value:function aB(){this.DOM.content=BX.create("DIV");this.DOM.content.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:function(){this.entry.deleteThis();this.close()}.bind(this)}}).buttonNode);this.DOM.content.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_NEXT"),events:{click:function(){this.entry.deleteNext();this.close()}.bind(this)}}).buttonNode);this.DOM.content.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ALL"),events:{click:function(){this.entry.deleteAll();this.close()}.bind(this)}}).buttonNode);return this.DOM.content}},{key:"getButtons",value:function aA(){return[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:this.close.bind(this)}})]}}]);return az}(ak);function ac(){var az=babelHelpers.taggedTemplateLiteral(['<label for="{this.UID}">',"</label>"]);ay=function ay(){return az};return az}function ae(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input value="Y" type="checkbox" id="{this.UID}"/>\n\t\t\t']);ay=function ay(){return az};return az}function ag(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="calendar-event-full-day"></span>\n\t\t\t']);ay=function ay(){return az};return az}function ah(){var ay=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-date"></span>']);az=function az(){return ay};return ay}function ai(){var ay=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-datetime" value="" type="text" autocomplete="off" style="width: ','px;"/>']);az=function az(){return ay};return ay}function s(){var az=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-time"></span>']);ay=function ay(){return az};return az}function E(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-time" value="" type="text" autocomplete="off" style="width: ','px;"/>\n\t\t\t']);E=function ay(){return az};return az}function F(){var ay=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block calendar-field-block-right"></div>']);F=function az(){return ay};return ay}function G(){var ay=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block calendar-field-block-between" />']);G=function az(){return ay};return ay}function I(){var ay=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-time"></span>']);I=function az(){return ay};return ay}function N(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-time" value="" type="text" autocomplete="off" style="width: ','px;"/>\n\t\t\t']);N=function ay(){return az};return az}function R(){var az=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field-value calendar-field-value-date"></span>']);R=function ay(){return az};return az}function W(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input class="calendar-field calendar-field-datetime" value="" type="text" autocomplete="off" style="width: ','px;"/>\n\t\t\t']);W=function ay(){return az};return az}function ap(){var az=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block calendar-field-block-left"></div>']);ap=function ay(){return az};return az}var f=function(aM){babelHelpers.inherits(aN,aM);function aN(aS){var aT;var aR=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{showTimezone:true};babelHelpers.classCallCheck(this,aN);aT=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aN).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aT),"DATE_INPUT_WIDTH",110);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aT),"TIME_INPUT_WIDTH",70);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aT),"zIndex",4200);aT.setEventNamespace("BX.Calendar.Controls.DateTimeControl");aT.showTimezone=aR.showTimezone;aT.inlineEditMode=!!aR.inlineEditMode;aT.currentInlineEditMode=aR.currentInlineEditMode||"view";aT.UID=aS||"date-time-"+Math.round(Math.random()*100000);aT.DOM={outerWrap:aR.outerWrap||null,outerContent:aR.outerContent||null};aT.create();return aT}babelHelpers.createClass(aN,[{key:"create",value:function aH(){if(aw.Type.isDomNode(this.DOM.outerWrap)){if(this.inlineEditMode){aw.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}this.DOM.leftInnerWrap=this.DOM.outerWrap.appendChild(aw.Tag.render(ap()));this.DOM.fromDate=this.DOM.leftInnerWrap.appendChild(aw.Tag.render(W(),this.DATE_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.fromDateText=this.DOM.leftInnerWrap.appendChild(aw.Tag.render(R()))}this.DOM.fromTime=this.DOM.leftInnerWrap.appendChild(aw.Tag.render(N(),this.TIME_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.fromTimeText=this.DOM.leftInnerWrap.appendChild(aw.Tag.render(I()))}this.DOM.outerWrap.appendChild(aw.Tag.render(G()));this.DOM.rightInnerWrap=this.DOM.outerWrap.appendChild(aw.Tag.render(F()));this.DOM.toTime=this.DOM.rightInnerWrap.appendChild(aw.Tag.render(E(),this.TIME_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.toTimeText=this.DOM.rightInnerWrap.appendChild(aw.Tag.render(s()))}this.DOM.toDate=this.DOM.rightInnerWrap.appendChild(aw.Tag.render(ai(),this.DATE_INPUT_WIDTH));if(this.inlineEditMode){this.DOM.toDateText=this.DOM.rightInnerWrap.appendChild(aw.Tag.render(ah()))}this.fromTimeControl=new r({input:this.DOM.fromTime,onChangeCallback:this.handleTimeFromChange.bind(this)});this.toTimeControl=new r({input:this.DOM.toTime,onChangeCallback:this.handleTimeToChange.bind(this)});var aR=this.DOM.outerWrap.appendChild(aw.Tag.render(ag()));this.DOM.fullDay=aR.appendChild(aw.Tag.render(ae()));aR.appendChild(aw.Tag.render(ac(),aw.Loc.getMessage("EC_ALL_DAY")))}if(this.showTimezone){}this.bindEventHandlers()}},{key:"setValue",value:function az(){var aR=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.DOM.fromDate.value=aj.Util.formatDate(aR.from);this.DOM.toDate.value=aj.Util.formatDate(aR.to);this.lastDateValue=aR.from;this.fromTimeControl.setValue(aR.from);this.toTimeControl.setValue(aR.to);this.DOM.fromTime.value=aj.Util.formatTime(aR.from);this.DOM.toTime.value=aj.Util.formatTime(aR.to);if(this.inlineEditMode){this.DOM.fromDateText.innerHTML=aj.Util.formatDateUsable(aR.from,true,true);this.DOM.toDateText.innerHTML=aj.Util.formatDateUsable(aR.to,true,true);this.DOM.toDateText.style.display=this.DOM.fromDate.value===this.DOM.toDate.value?"none":"";this.DOM.fromTimeText.innerHTML=this.DOM.fromTime.value;this.DOM.toTimeText.innerHTML=this.DOM.toTime.value}if(aR.fullDay!==undefined){this.DOM.fullDay.checked=aR.fullDay}if(this.showTimezone){aR.timezoneFrom=aR.timezoneFrom||aR.timezoneName;aR.timezoneTo=aR.timezoneTo||aR.timezoneName;if(aR.timezoneFrom!==undefined&&aw.Type.isDomNode(this.DOM.fromTz)){this.DOM.fromTz.value=aR.timezoneFrom}if(aR.timezoneTo!==undefined&&aw.Type.isDomNode(this.DOM.toTz)){this.DOM.toTz.value=aR.timezoneTo}if(aR.timezoneName!==undefined&&(aR.timezoneName!==aR.timezoneFrom||aR.timezoneName!==aR.timezoneTo)){this.switchTimezone(true)}}this.value=aR;this.handleFullDayChange()}},{key:"getValue",value:function aA(){var aS={fullDay:this.DOM.fullDay.checked,fromDate:this.DOM.fromDate.value,toDate:this.DOM.toDate.value,fromTime:this.DOM.fromTime.value,toTime:this.DOM.toTime.value,timezoneFrom:this.DOM.fromTz?this.DOM.fromTz.value:this.value.timezoneFrom||this.value.timezoneName||null,timezoneTo:this.DOM.toTz?this.DOM.toTz.value:this.value.timezoneTo||this.value.timezoneName||null};aS.from=aj.Util.parseDate(aS.fromDate);if(aw.Type.isDate(aS.from)){aS.to=aj.Util.parseDate(aS.toDate);if(!aw.Type.isDate(aS.to)){aS.to=aS.from}if(aS.fullDay){aS.from.setHours(0,0,0);aS.to.setHours(0,0,0)}else{var aT=aj.Util.parseTime(aS.fromTime),aR=aj.Util.parseTime(aS.toTime)||aT;if(aT&&aR){aS.from.setHours(aT.h,aT.m,0);aS.to.setHours(aR.h,aR.m,0)}}}return aS}},{key:"bindEventHandlers",value:function aJ(){var aR=this;aw.Event.bind(this.DOM.fromDate,"click",aN.showInputCalendar);aw.Event.bind(this.DOM.fromDate,"change",this.handleDateFromChange.bind(this));aw.Event.bind(this.DOM.toDate,"click",aN.showInputCalendar);aw.Event.bind(this.DOM.toDate,"change",this.handleDateToChange.bind(this));aw.Event.bind(this.DOM.fullDay,"click",function(){aR.handleFullDayChange();aR.handleValueChange()});if(this.inlineEditMode){aw.Event.bind(this.DOM.outerWrap,"click",this.changeInlineEditMode.bind(this))}if(aw.Type.isDomNode(this.DOM.defTimezone)){aw.Event.bind(this.DOM.defTimezone,"change",BX.delegate(function(){if(this.bindFromToDefaultTimezones){this.DOM.fromTz.value=this.DOM.toTz.value=this.DOM.defTimezone.value}},this))}if(this.showTimezone){if(aw.Type.isDomNode(this.DOM.tzButton)){aw.Event.bind(this.DOM.tzButton,"click",this.switchTimezone.bind(this))}aw.Event.bind(this.DOM.fromTz,"change",function(){if(this.bindTimezones){this.DOM.toTz.value=this.DOM.fromTz.value}this.bindFromToDefaultTimezones=false}.bind(this));aw.Event.bind(this.DOM.toTz,"change",function(){this.bindTimezones=false;this.bindFromToDefaultTimezones=false}.bind(this));this.bindTimezones=this.DOM.fromTz.value===this.DOM.toTz.value;this.bindFromToDefaultTimezones=this.bindTimezones&&this.DOM.fromTz.value===this.DOM.toTz.value&&this.DOM.fromTz.value===this.DOM.defTimezone.value}}},{key:"handleDateFromChange",value:function aO(){var aU=aj.Util.parseTime(this.DOM.fromTime.value),aT=aj.Util.parseTime(this.DOM.toTime.value),aS=aj.Util.parseDate(this.DOM.fromDate.value),aR=aj.Util.parseDate(this.DOM.toDate.value);if(this.lastDateValue){if(this.DOM.fullDay.checked&&this.lastDateValue){this.lastDateValue.setHours(0,0,0)}else{if(aS&&aU){aS.setHours(aU.h,aU.m,0)}if(aR&&aT){aR.setHours(aT.h,aT.m,0)}}if(aS&&this.lastDateValue){aR=new Date(aS.getTime()+(aR.getTime()-this.lastDateValue.getTime()||3600000));if(aR){this.DOM.toDate.value=aj.Util.formatDate(aR)}}}this.lastDateValue=aS;this.handleValueChange()}},{key:"handleTimeFromChange",value:function aB(){var aV=aj.Util.parseTime(this.DOM.fromTime.value),aU=aj.Util.parseTime(this.DOM.toTime.value),aT=aj.Util.parseDate(this.DOM.fromDate.value),aR=aj.Util.parseDate(this.DOM.toDate.value);if(aT&&aV){aT.setHours(aV.h,aV.m,0)}if(aR&&aU){aR.setHours(aU.h,aU.m,0)}if(this.lastDateValue){var aS=new Date(aj.Util.getTimeRounded(aT)+aj.Util.getTimeRounded(aR)-aj.Util.getTimeRounded(this.lastDateValue));this.DOM.toTime.value=aj.Util.formatTime(aS);this.DOM.toDate.value=aj.Util.formatDate(aS)}this.lastDateValue=aT;this.handleValueChange()}},{key:"handleDateToChange",value:function aK(){this.handleValueChange()}},{key:"handleTimeToChange",value:function aG(){this.handleValueChange()}},{key:"handleFullDayChange",value:function aP(){var aR=this.getFullDayValue();if(aR){if(aw.Type.isDomNode(this.DOM.dateTimeWrap)){aw.Dom.addClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(aw.Type.isDomNode(this.DOM.outerWrap)){aw.Dom.addClass(this.DOM.outerWrap,"calendar-options-item-datetime-hide-time")}}else{if(aw.Type.isDomNode(this.DOM.dateTimeWrap)){aw.Dom.removeClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}if(aw.Type.isDomNode(this.DOM.outerWrap)){aw.Dom.removeClass(this.DOM.outerWrap,"calendar-options-item-datetime-hide-time")}}}},{key:"handleValueChange",value:function ay(){this.emit("onChange",new T.BaseEvent({data:{value:this.getValue()}}))}},{key:"getFullDayValue",value:function aQ(){return !!this.DOM.fullDay.checked}},{key:"switchTimezone",value:function aE(aR){if(!aw.Type.isBoolean(aR)){aR=BX.hasClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}if(aR){aw.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-expand");aw.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}else{aw.Dom.addClass(this.DOM.tzCont,"calendar-options-timezone-collapse");aw.Dom.removeClass(this.DOM.tzCont,"calendar-options-timezone-expand")}}},{key:"changeInlineEditMode",value:function aL(){if(!this.viewMode){this.setInlineEditMode("edit")}}},{key:"setViewMode",value:function aF(aR){this.viewMode=aR;if(this.viewMode&&this.currentInlineEditMode==="edit"){this.setInlineEditMode("view")}}},{key:"setInlineEditMode",value:function aD(aR){if(this.inlineEditMode){this.currentInlineEditMode=aR;if(this.currentInlineEditMode==="edit"){aw.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-edit");aw.Dom.removeClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}else{aw.Dom.removeClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-edit");aw.Dom.addClass(this.DOM.outerWrap,"calendar-datetime-inline-mode-view")}}}}],[{key:"showInputCalendar",value:function aI(aS){var aT=4000;var aR=aS.target||aS.srcElement;if(aw.Type.isDomNode(aR)&&aR.nodeName.toLowerCase()==="input"){BX.calendar({node:aR.parentNode,field:aR,bTime:false});BX.onCustomEvent(window,"onCalendarControlChildPopupShown");if(BX.calendar.get().popup){BX.removeCustomEvent(BX.calendar.get().popup,"onPopupClose",aN.inputCalendarClosePopupHandler);BX.addCustomEvent(BX.calendar.get().popup,"onPopupClose",aN.inputCalendarClosePopupHandler);BX.calendar.get().popup.popupContainer.style.zIndex=aT}}}},{key:"inputCalendarClosePopupHandler",value:function aC(aR){BX.onCustomEvent(window,"onCalendarControlChildPopupClosed")}}]);return aN}(T.EventEmitter);var l=function(az){babelHelpers.inherits(aB,az);function aB(){var aC;babelHelpers.classCallCheck(this,aB);aC=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aB).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"DOM",{});aC.setEventNamespace("BX.Calendar.Controls.ConfirmStatusDialog");aC.zIndex=3200;aC.id="confirm-status-dialog-"+Math.round(Math.random()*10000);return aC}babelHelpers.createClass(aB,[{key:"show",value:function ay(){var aF=this;var aG=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.plural=aG.users.length>1;var aC,aH=[];for(aC=0;aC<aG.users.length;aC++){aH.push(aG.users[aC].DISPLAY_NAME)}aH=aH.join(", ");var aE=BX.create("DIV",{props:{className:"calendar-busy-users-content-wrap"},html:'<div class="calendar-busy-users-content">'+BX.util.htmlspecialchars(this.plural?aw.Loc.getMessage("EC_BUSY_USERS_PLURAL").replace("#USER_LIST#",aH):aw.Loc.getMessage("EC_BUSY_USERS_SINGLE").replace("#USER_NAME#",aG.users[0].DISPLAY_NAME))+"</div>"});this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_BUSY_USERS_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",content:aE,events:{}});aE.appendChild(new BX.PopupWindowButton({text:aw.Loc.getMessage("EC_BUSY_USERS_BACK2EDIT"),events:{click:function aD(){aF.close()}}}).buttonNode);aE.appendChild(new BX.PopupWindowButton({text:this.plural?aw.Loc.getMessage("EC_BUSY_USERS_EXCLUDE_PLURAL"):aw.Loc.getMessage("EC_BUSY_USERS_EXCLUDE_SINGLE"),events:{click:function aD(){aF.emit("onSaveWithout");aF.close()}}}).buttonNode);this.dialog.show()}},{key:"close",value:function aA(){if(this.dialog){this.dialog.close()}}}]);return aB}(T.EventEmitter);function V(){var az=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<img \n\t\t\t\ttitle="','" \n\t\t\t\tclass="calendar-member" \n\t\t\t\tid="simple_popup_','"\n\t\t\t\tsrc="','"\n\t\t\t>']);V=function ay(){return az};return az}function ao(){var az=babelHelpers.taggedTemplateLiteral(['<div title="','" class="ui-icon ','"><i></i></div>']);ao=function ay(){return az};return az}var g=function(aU){babelHelpers.inherits(aT,aU);function aT(){var a1;var a0=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,aT);a1=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aT).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a1),"zIndex",4200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a1),"readOnlyMode",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a1),"meetingNotifyValue",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a1),"userSelectorDialog",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a1),"attendeesEntityList",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a1),"inlineEditMode",aT.VIEW_MODE);a1.setEventNamespace("BX.Calendar.Controls.UserPlannerSelector");a1.selectorId=a0.id||"user-selector-"+Math.round(Math.random()*10000);a1.BX=aj.Util.getBX();a1.DOM={outerWrap:a0.outerWrap,wrap:a0.wrap,informWrap:a0.informWrap,moreLink:a0.outerWrap.querySelector(".calendar-members-more"),changeLink:a0.outerWrap.querySelector(".calendar-members-change-link"),attendeesLabel:a0.outerWrap.querySelector(".calendar-attendees-label"),attendeesList:a0.outerWrap.querySelector(".calendar-attendees-list"),userSelectorWrap:a0.outerWrap.querySelector(".calendar-user-selector-wrap"),plannerOuterWrap:a0.plannerOuterWrap,chatLink:a0.outerWrap.querySelector(".calendar-create-chat-link")};a1.refreshPlanner=aw.Runtime.debounce(a1.refreshPlannerState,100,babelHelpers.assertThisInitialized(a1));if(aw.Type.isBoolean(a0.readOnlyMode)){a1.readOnlyMode=a0.readOnlyMode}a1.userId=a0.userId;a1.type=a0.type;a1.ownerId=a0.ownerId;a1.zIndex=a0.zIndex||a1.zIndex;a1.create();return a1}babelHelpers.createClass(aT,[{key:"create",value:function aN(){var a0=this;if(this.DOM.changeLink&&!this.isReadOnly()){aw.Event.bind(this.DOM.changeLink,"click",function(){if(!a0.userSelectorDialog){a0.userSelectorDialog=new B.Dialog({targetNode:a0.DOM.changeLink,context:"CALENDAR",preselectedItems:a0.attendeesPreselectedItems,enableSearch:true,zIndex:a0.zIndex+10,events:{"Item:onSelect":a0.handleUserSelectorChanges.bind(a0),"Item:onDeselect":a0.handleUserSelectorChanges.bind(a0)},entities:[{id:"user",options:{inviteGuestLink:true,emailUsers:true}},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}],searchTabOptions:{stubOptions:{title:aw.Loc.getMessage("EC_USER_DIALOG_404_TITLE"),subtitle:aw.Loc.getMessage("EC_USER_DIALOG_404_SUBTITLE"),icon:"/bitrix/images/calendar/search-email.svg",iconOpacity:100,arrow:true}}})}a0.userSelectorDialog.show()})}if(this.DOM.moreLink){aw.Event.bind(this.DOM.moreLink,"click",this.showMoreAttendeesPopup.bind(this))}if(this.DOM.chatLink){aw.Event.bind(this.DOM.chatLink,"click",function(){a0.emit("onOpenChat")})}this.planner=new C.Planner({wrap:this.DOM.plannerOuterWrap,minWidth:aT.PLANNER_WIDTH,width:aT.PLANNER_WIDTH,showEntryName:false});aw.Event.bind(this.DOM.informWrap,"click",function(){a0.setInformValue(!a0.meetingNotifyValue);a0.emit("onNotifyChange")});this.DOM.attendeesLabel.innerHTML=aw.Text.encode(aw.Loc.getMessage("EC_ATTENDEES_LABEL_ONE"));this.planner.subscribe("onDateChange",function(a1){a0.emit("onDateChange",a1)})}},{key:"setValue",value:function aE(a6){var a4=this;var a7=a6.attendeesEntityList,a5=a6.attendees,a0=a6.location,a2=a6.notify,a1=a6.viewMode,a3=a6.entryId;this.attendeesEntityList=aw.Type.isArray(a7)?a7:[];this.attendeesPreselectedItems=this.attendeesEntityList.map(function(a8){return[a8.entityId,a8.id]});this.entryId=a3;if(this.attendeesEntityList.length>1&&!a1){this.showPlanner()}if(this.DOM.chatLink){this.DOM.chatLink.style.display="none"}this.setEntityList(this.attendeesEntityList);this.setInformValue(a2);this.setLocationValue(a0);if(aw.Type.isArray(a5)){this.displayAttendees(a5);if(window.location.host==="cp.bitrix.ru"&&this.DOM.chatLink&&a1&&a5.length>1&&a5.find(function(a8){return a8.STATUS!=="N"&&parseInt(a8.ID)===parseInt(a4.userId)})){this.DOM.chatLink.style.display=""}}this.refreshPlanner()}},{key:"handleUserSelectorChanges",value:function aF(){this.showPlanner();this.setEntityList(this.userSelectorDialog.getSelectedItems().map(function(a0){return{entityId:a0.entityId,id:a0.id,entityType:a0.entityType}}));this.refreshPlanner();this.emit("onUserCodesChange")}},{key:"getEntityList",value:function aQ(){return this.selectorEntityList}},{key:"setEntityList",value:function aW(a0){if(this.type==="user"&&this.userId!==this.ownerId){a0.push({entityId:"user",id:this.ownerId})}else{a0.push({entityId:"user",id:this.userId})}this.selectorEntityList=a0}},{key:"isReadOnly",value:function aP(){return this.readOnlyMode}},{key:"getUserSelector",value:function aM(){return BX.UI.SelectorManager.instances[this.selectorId]}},{key:"handleAdditionalParams",value:function aB(){}},{key:"showUserSelectorLoader",value:function aA(){}},{key:"hideUserSelectorLoader",value:function aC(){}},{key:"showPlanner",value:function ay(){if(!this.isPlannerDisplayed()){aw.Dom.addClass(this.DOM.outerWrap,"user-selector-edit-mode");this.planner.show();this.planner.showLoader()}}},{key:"refreshPlannerState",value:function aY(){var a0=this;if(this.planner&&this.planner.isShown()){var a1=this.getDateTime();this.loadPlannerData({entityList:this.getEntityList(),from:aj.Util.formatDate(a1.from.getTime()-aj.Util.getDayLength()*3),to:aj.Util.formatDate(a1.to.getTime()+aj.Util.getDayLength()*10),timezone:a1.timezoneFrom,location:this.getLocationValue(),entryId:this.entryId}).then(function(a2){a0.displayAttendees((a2.data.entries||[]).filter(function(a3){return a3.type==="user"}).map(function(a3){return{ID:a3.id,AVATAR:a3.avatar,DISPLAY_NAME:a3.name,EMAIL_USER:a3.emailUser,STATUS:(a3.status||"").toUpperCase(),URL:a3.url}}))})}}},{key:"loadPlannerData",value:function aD(){var a0=this;var a1=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.planner.showLoader();return new Promise(function(a2){a0.BX.ajax.runAction("calendar.api.calendarajax.updatePlanner",{data:{entryId:a1.entryId||0,ownerId:a0.ownerId,type:a0.type,entityList:a1.entityList||[],dateFrom:a1.from||"",dateTo:a1.to||"",timezone:a1.timezone||"",location:a1.location||"",entries:a1.entrieIds||false}}).then(function(a3){a0.planner.hideLoader();var a4=a0.getDateTime();a0.planner.update(a3.data.entries,a3.data.accessibility);a0.planner.updateSelector(a4.from,a4.to,a4.fullDay);a2(a3)},function(a3){a2(a3)})})}},{key:"setDateTime",value:function aO(a1){var a0=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.dateTime=a1;if(this.planner&&a0){this.planner.updateSelector(a1.from,a1.to,a1.fullDay)}}},{key:"getDateTime",value:function aI(){return this.dateTime}},{key:"setLocationValue",value:function aR(a0){this.location=a0}},{key:"getLocationValue",value:function aL(){return this.location}},{key:"displayAttendees",value:function aS(){var a1=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];aw.Dom.clean(this.DOM.attendeesList);this.attendeeList={accepted:a1.filter(function(a3){return["H","Y"].includes(a3.STATUS)}),requested:a1.filter(function(a3){return a3.STATUS==="Q"||a3.STATUS===""}),declined:a1.filter(function(a3){return a3.STATUS==="N"})};var a2=this.attendeeList.accepted.length;if(a2>0){if(a2>aT.MAX_USER_COUNT_DISPLAY){a2=aT.MAX_USER_COUNT}for(var a0=0;a0<a2;a0++){this.attendeeList.accepted[a0].shown=true;this.DOM.attendeesList.appendChild(aT.getUserAvatarNode(this.attendeeList.accepted[a0]))}}if(a2>1){this.DOM.attendeesLabel.innerHTML=aw.Text.encode(aw.Loc.getMessage("EC_ATTENDEES_LABEL_NUM")).replace("#COUNT#","<span>(</span>".concat(this.attendeeList.accepted.length,"<span>)</span>"))}else{this.DOM.attendeesLabel.innerHTML=aw.Text.encode(aw.Loc.getMessage("EC_ATTENDEES_LABEL_ONE"))}if(a2<a1.length){if(a2===1){this.DOM.moreLink.innerHTML=aw.Text.encode(aw.Loc.getMessage("EC_ATTENDEES_ALL_COUNT").replace("#COUNT#",a1.length))}else{this.DOM.moreLink.innerHTML=aw.Text.encode(aw.Loc.getMessage("EC_ATTENDEES_ALL"))}aw.Dom.show(this.DOM.moreLink)}else{aw.Dom.hide(this.DOM.moreLink)}}},{key:"showMoreAttendeesPopup",value:function aG(){var a0=this;if(this.morePopup){this.morePopup.destroy()}var a2="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label";var a1=[];[{code:"accepted",title:aw.Loc.getMessage("EC_ATTENDEES_Y_NUM")},{code:"requested",title:aw.Loc.getMessage("EC_ATTENDEES_Q_NUM")},{code:"declined",title:aw.Loc.getMessage("EC_ATTENDEES_N_NUM")}].forEach(function(a4){var a3=a0.attendeeList[a4.code];if(a3.length>0){a1.push({text:"<span>"+a4.title.replace("#COUNT#",a3.length)+"</span>",className:a2});a3.forEach(function(a5){a1.push({text:BX.util.htmlspecialchars(a5.DISPLAY_NAME),dataset:{user:a5},className:"calendar-add-popup-user-menu-item",onclick:function a6(){BX.SidePanel.Instance.open(a5.URL,{loader:"intranet:profile",cacheable:false,allowChangeHistory:false,contentClassName:"bitrix24-profile-slider-content",width:1100});a0.morePopup.close()}})})}});this.morePopup=ax.MenuManager.create("compact-event-form-attendees"+Math.round(Math.random()*100000),this.DOM.moreLink,a1,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true,cacheable:false,className:"calendar-popup-user-menu"});this.morePopup.show();this.morePopup.menuItems.forEach(function(a4){var a3=a4.layout.item.querySelector(".menu-popup-item-icon");if(aw.Type.isPlainObject(a4.dataset)){a3.appendChild(aT.getUserAvatarNode(a4.dataset.user))}})}},{key:"setInformValue",value:function aX(a1){if(aw.Type.isBoolean(a1)){var a0="calendar-field-container-inform-off";this.meetingNotifyValue=a1;if(this.meetingNotifyValue){aw.Dom.removeClass(this.DOM.informWrap,a0);this.DOM.informWrap.title=aw.Loc.getMessage("EC_NOTIFY_OPTION_ON_TITLE")}else{aw.Dom.addClass(this.DOM.informWrap,a0);this.DOM.informWrap.title=aw.Loc.getMessage("EC_NOTIFY_OPTION_OFF_TITLE")}}}},{key:"getInformValue",value:function aH(a0){return this.meetingNotifyValue}},{key:"setViewMode",value:function aJ(a0){this.readOnlyMode=a0;if(this.readOnlyMode){aw.Dom.addClass(this.DOM.outerWrap,"calendar-userselector-readonly")}else{aw.Dom.removeClass(this.DOM.outerWrap,"calendar-userselector-readonly")}}},{key:"isPlannerDisplayed",value:function aK(){return this.planner.isShown()}},{key:"hasExternalEmailUsers",value:function aZ(){return !!this.getEntityList().find(function(a0){return a0.entityType==="email"})}},{key:"destroySelector",value:function az(){if(this.userSelectorDialog){this.userSelectorDialog.destroy();this.userSelectorDialog=null}}}],[{key:"getUserAvatarNode",value:function aV(a1){var a2,a0=a1.AVATAR||a1.SMALL_AVATAR;if(!a0||a0==="/bitrix/images/1.gif"){a2=aw.Tag.render(ao(),aw.Text.encode(a1.DISPLAY_NAME),a1.EMAIL_USER?"ui-icon-common-user-mail":"ui-icon-common-user")}else{a2=aw.Tag.render(V(),aw.Text.encode(a1.DISPLAY_NAME),parseInt(a1.ID),a0)}return a2}}]);return aT}(T.EventEmitter);babelHelpers.defineProperty(g,"VIEW_MODE","view");babelHelpers.defineProperty(g,"EDIT_MODE","edit");babelHelpers.defineProperty(g,"MAX_USER_COUNT",8);babelHelpers.defineProperty(g,"MAX_USER_COUNT_DISPLAY",10);babelHelpers.defineProperty(g,"PLANNER_WIDTH",450);var M=function(aA){babelHelpers.inherits(az,aA);function az(){var aC;babelHelpers.classCallCheck(this,az);aC=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(az).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"DOM",{});aC.setEventNamespace("BX.Calendar.Controls.ReinviteUserDialog");aC.zIndex=3200;aC.id="reinvite-dialog-"+Math.round(Math.random()*10000);return aC}babelHelpers.createClass(az,[{key:"show",value:function ay(){var aE=this;var aD=aw.Dom.create("DIV");this.dialog=new ax.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_REINVITE_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"reinvite-popup-window",content:aD,events:{},cacheable:false});new BX.UI.Button({text:aw.Loc.getMessage("EC_REINVITE_YES"),className:"ui-btn ui-btn-primary",events:{click:function aC(){aE.emit("onSelect",new T.BaseEvent({data:{sendInvitesAgain:true}}));aE.close()}}}).renderTo(aD);new BX.UI.Button({text:aw.Loc.getMessage("EC_REINVITE_NO"),className:"ui-btn ui-btn-light-border",events:{click:function aC(){aE.emit("onSelect",new T.BaseEvent({data:{sendInvitesAgain:false}}));aE.close()}}}).renderTo(aD);this.dialog.show()}},{key:"close",value:function aB(){if(this.dialog){this.dialog.close()}}}]);return az}(T.EventEmitter);function an(){var az=babelHelpers.taggedTemplateLiteral(['<div style="display: none;"></div>']);an=function ay(){return az};return az}var e=function(ay){babelHelpers.inherits(aC,ay);function aC(aM){var aN;babelHelpers.classCallCheck(this,aC);aN=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aC).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aN),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aN),"CONFIRM_POPUP_ID","add_from_email");aN.setEventNamespace("BX.Calendar.Controls.EmailSelectorControl");aN.DOM.select=aM.selectNode;aN.mailboxList=aw.Type.isArray(aM.mailboxList)?aM.mailboxList:[];aN.DOM.componentWrap=aN.DOM.select.parentNode.appendChild(aw.Tag.render(an()));aN.allowAddNewEmail=aM.allowAddNewEmail;aN.checkValueDebounce=aw.Runtime.debounce(aN.checkValue,50,babelHelpers.assertThisInitialized(aN));aN.create();return aN}babelHelpers.createClass(aC,[{key:"create",value:function aF(){this.setSelectValues();aw.Event.bind(this.DOM.select,"change",this.checkValueDebounce);aw.Event.bind(this.DOM.select,"click",this.checkValueDebounce)}},{key:"checkValue",value:function aH(){if(this.DOM.select.value==="add"){this.showAdd();this.setValue("")}}},{key:"getValue",value:function aD(){return this.DOM.select.value}},{key:"setValue",value:function aA(aM){if(this.mailboxList.length&&this.mailboxList.find(function(aN){return aN.email===aM})){this.DOM.select.value=aM}else{this.DOM.select.value=""}this.emit("onSetValue",{value:this.DOM.select.value})}},{key:"setSelectValues",value:function aJ(){var aM=this;aw.Dom.clean(this.DOM.select);this.DOM.select.options.add(new Option(aw.Loc.getMessage("EC_NO_VALUE"),""));if(this.mailboxList.length){this.mailboxList.forEach(function(aN){aM.DOM.select.options.add(new Option(aN.formatted,aN.email))},this)}if(this.allowAddNewEmail){this.DOM.select.options.add(new Option(aw.Loc.getMessage("EC_ADD_NEW"),"add"))}}},{key:"onClick",value:function aK(aM){this.input.value=aM.sender;this.mailbox.textContent=aM.sender}},{key:"showAdd",value:function aE(){var aN=this;if(window.BXMainMailConfirm){window.BXMainMailConfirm.showForm(this.onAdd.bind(this))}var aM=ax.PopupManager.getPopupById(this.CONFIRM_POPUP_ID);if(aM){aM.subscribe("onClose",function(){aN.reloadMailboxList()})}}},{key:"onAdd",value:function aI(aN){var aM=this;this.reloadMailboxList().then(function(){setTimeout(function(){aM.setValue(aN.email)},0)})}},{key:"getMenuItem",value:function aG(aM){return{id:aM.id,text:BX.util.htmlspecialchars(aM.sender),onclick:this.onClick.bind(this,aM)}}},{key:"loadMailboxData",value:function aB(){var aM=this;return new Promise(function(aN){BX.ajax.runAction("calendar.api.calendarajax.getAllowedMailboxData").then(function(aO){BX.html(aM.DOM.componentWrap,aO.data.html);aM.mailboxList=aO.data.additionalParams.mailboxList;aM.checkBXMainMailConfirmLoaded(aN)})})}},{key:"checkBXMainMailConfirmLoaded",value:function aL(aN){var aM=this;if(window.BXMainMailConfirm){this.setSelectValues();aN()}else{setTimeout(function(){aM.checkBXMainMailConfirmLoaded(aN)},200)}}},{key:"reloadMailboxList",value:function az(){var aM=this;return new Promise(function(aN){BX.ajax.runAction("calendar.api.calendarajax.getAllowedMailboxList").then(function(aO){aM.mailboxList=aO.data.mailboxList;aM.setSelectValues();aN()})})}}]);return aC}(T.EventEmitter);function al(){var az=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-confirm-email-text">','</div>\n\t\t\t<div class="calendar-confirm-email-text"><a class="calendar-confirm-email-help-link" href="javascript:void(0);">','</a></div>\n\t\t\t<div class="calendar-field-block">\n\t\t\t\t<select class="calendar-field calendar-field-select ui-btn ui-btn ui-btn-light-border ui-btn-clock"></select>\n\t\t\t</div>\n\t\t</div>']);al=function ay(){return az};return az}var k=function(aB){babelHelpers.inherits(aA,aB);function aA(){var aE;babelHelpers.classCallCheck(this,aA);aE=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aA).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aE),"Z_INDEX",3200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aE),"SLIDER_Z_INDEX",4400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aE),"WIDTH",400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aE),"DOM",{});aE.setEventNamespace("BX.Calendar.Controls.ConfirmedEmailDialog");aE.id="confirm-email-dialog-"+Math.round(Math.random()*10000);return aE}babelHelpers.createClass(aA,[{key:"show",value:function ay(){var aF=this;this.DOM.content=aw.Tag.render(al(),aw.Loc.getMessage("EC_CONFIRMED_EMAIL_TEXT"),aw.Loc.getMessage("EC_CONFIRMED_EMAIL_HELP_LINK"));this.dialog=new ax.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,width:this.WIDTH,closeByEsc:true,zIndex:this.Z_INDEX,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_CONFIRMED_EMAIL_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"confirmemail-popup-window",content:this.DOM.content,events:{},cacheable:false,buttons:[new BX.UI.Button({text:aw.Loc.getMessage("EC_CONFIRMED_EMAIL_SEND"),className:"ui-btn ui-btn-primary ".concat(BX.UI.Button.State.DISABLED),events:{click:function aE(){if(aF.DOM.select.value&&aF.DOM.select.value!=="add"){var aG=aj.Util.getUserSettings();aG.sendFromEmail=aF.emailSelectorControl.getValue();aj.Util.setUserSettings(aG);BX.userOptions.save("calendar","user_settings","sendFromEmail",aG.sendFromEmail);aF.emit("onSelect",new T.BaseEvent({data:{sendFromEmail:aG.sendFromEmail}}));aF.close()}}}}),new BX.UI.Button({text:aw.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-light-border",events:{click:this.close.bind(this)}})]});this.DOM.processButton=this.dialog.buttons[0].button;this.DOM.select=this.DOM.content.querySelector("select.calendar-field-select");aw.Dom.addClass(this.DOM.select,BX.UI.Button.State.CLOCKING);this.DOM.select.disabled=true;this.emailSelectorControl=new j.EmailSelectorControl({selectNode:this.DOM.select,allowAddNewEmail:true});aw.Event.bind(this.DOM.select,"change",this.handleSelectChanges.bind(this));this.emailSelectorControl.subscribe("onSetValue",this.handleSelectChanges.bind(this));this.emailSelectorControl.loadMailboxData().then(function(){aF.emailSelectorControl.setValue(aj.Util.getUserSettings().sendFromEmail);aF.DOM.select.disabled=false;aF.DOM.select.className="calendar-field calendar-field-select"});this.DOM.helpLinlk=this.DOM.content.querySelector(".calendar-confirm-email-help-link");aw.Event.bind(this.DOM.helpLinlk,"click",this.openHelpSlider.bind(this));this.dialog.show()}},{key:"close",value:function aD(){if(this.dialog){this.dialog.close()}}},{key:"handleSelectChanges",value:function aC(){if(this.DOM.select.value&&this.DOM.select.value!=="add"){aw.Dom.removeClass(this.DOM.processButton,BX.UI.Button.State.DISABLED)}else{aw.Dom.addClass(this.DOM.processButton,BX.UI.Button.State.DISABLED)}}},{key:"openHelpSlider",value:function az(){if(BX.Helper){BX.Helper.show("redirect=detail&code=12070142",{zIndex:this.SLIDER_Z_INDEX})}}}]);return aA}(T.EventEmitter);function K(){var az=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-email-limit-text">','</div>\n\t\t\t<div class="calendar-email-limit-subtext">',"</div>\n\t\t</div>"]);K=function ay(){return az};return az}var c=function(aB){babelHelpers.inherits(aA,aB);function aA(){var aD;babelHelpers.classCallCheck(this,aA);aD=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(aA).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aD),"Z_INDEX",3200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aD),"EXPAND_LICENSE_URL","/settings/license_all.php");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aD),"WIDTH",480);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aD),"DOM",{});aD.setEventNamespace("BX.Calendar.Controls.EmailLimitationDialog");aD.id="email-limitation-dialog-"+Math.round(Math.random()*10000);return aD}babelHelpers.createClass(aA,[{key:"show",value:function ay(){var aF=this;var aD=aj.Util.getEventWithEmailGuestAmount();var aE=aj.Util.isEventWithEmailGuestAllowed();if(aD===4){this.text=aw.Loc.getMessage("EC_EMAIL_LIMIT_5")}else{if(aD===8){this.text=aw.Loc.getMessage("EC_EMAIL_LIMIT_9")}else{this.text=aw.Loc.getMessage("EC_EMAIL_LIMIT_DENY")}}this.subText=aw.Loc.getMessage("EC_EMAIL_LIMIT_SUBTEXT");this.DOM.content=aw.Tag.render(K(),this.text,this.subText);this.dialog=this.getDialogPopup();this.dialog.subscribe("onClose",function(){aF.emit("onClose")});this.dialog.show()}},{key:"getDialogPopup",value:function az(){var aD=this;return new ax.Popup(this.id,null,{overlay:{opacity:10},autoHide:true,width:this.WIDTH,closeByEsc:true,zIndex:this.Z_INDEX,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:aw.Loc.getMessage("EC_EMAIL_LIMIT_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"email-limit-popup",content:this.DOM.content,events:{},cacheable:false,buttons:[new BX.UI.Button({text:aw.Loc.getMessage("EC_EMAIL_LIMIT_EXPAND_PLAN"),className:"ui-btn ui-btn-primary ui-btn-icon-plan",events:{click:function aE(){window.open(aD.EXPAND_LICENSE_URL,"_blank")}}}),new BX.UI.Button({text:aj.Util.isEventWithEmailGuestAllowed()?aw.Loc.getMessage("EC_SEC_SLIDER_CLOSE"):aw.Loc.getMessage("EC_EMAIL_LIMIT_SAVE_WITHOUT"),className:"ui-btn ui-btn-link",events:{click:this.close.bind(this)}})]})}},{key:"close",value:function aC(){if(this.dialog){this.dialog.close()}}}]);return aA}(T.EventEmitter);v.Reminder=i;v.Location=a;v.UserSelector=p;v.ColorSelector=am;v.SectionSelector=ad;v.RepeatSelector=o;v.TimeSelector=r;v.SelectInput=q;v.PopupDialog=ak;v.ViewSelector=d;v.LineViewSelector=m;v.AddButton=n;v.MeetingStatusControl=O;v.ConfirmStatusDialog=ab;v.ConfirmEditDialog=b;v.ConfirmDeleteDialog=h;v.DateTimeControl=f;v.BusyUsersDialog=l;v.UserPlannerSelector=g;v.ReinviteUserDialog=M;v.EmailSelectorControl=e;v.ConfirmedEmailDialog=k;v.EmailLimitationDialog=c}((this.BX.Calendar.Controls=this.BX.Calendar.Controls||{}),BX,BX.Calendar,BX.UI.EntitySelector,BX,BX.Event,BX.Main,BX.Calendar.Controls,BX.Calendar));