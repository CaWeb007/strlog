this.BX=this.BX||{};(function(E,b,D,z,A,t,C,B,r){function v(){var G=babelHelpers.taggedTemplateLiteral(['<span class="calendar-field calendar-field-string">',"</span>"]);H=function H(){return G};return G}function w(){var G=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);H=function H(){return G};return G}function y(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>']);G=function G(){return H};return H}function e(){var H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);G=function G(){return H};return H}function g(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>']);G=function G(){return H};return H}function i(){var H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block" style="display: none">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);G=function G(){return H};return H}function k(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-link"></div>']);G=function G(){return H};return H}function m(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-title"></div>']);G=function G(){return H};return H}function n(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-text"></div>']);G=function G(){return H};return H}function o(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-block">\n\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t","\n\t\t</div>"]);G=function G(){return H};return H}function p(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-place"></div>']);G=function G(){return H};return H}function q(){var G=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-planner-wrapper" style="height: 0">\n\t\t\t\t</div>']);H=function H(){return G};return G}function s(){var G=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-container-inform">\n\t\t\t\t\t<span class="calendar-field-container-inform-text">',"</span>\n\t\t\t\t</div>"]);H=function H(){return G};return G}function F(){var H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t<div class="calendar-members-selected">\n\t\t\t\t\t\t<span class="calendar-attendees-label"></span>\n\t\t\t\t\t\t<span class="calendar-attendees-list"></span>\n\t\t\t\t\t\t<span class="calendar-members-more">','</span>\n\t\t\t\t\t\t<span class="calendar-members-change-link">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>"]);G=function G(){return H};return H}function a(){var H=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t<div class="calendar-field-container calendar-field-container-members">\n\t\t\t\t','\n\t\t\t\t<span class="calendar-create-chat-link">',"</span>\n\t\t\t\t",'\n\t\t\t</div>\n\t\t\t<div class="calendar-user-selector-wrap"></div>\n\t\t\t<div class="calendar-add-popup-planner-wrap calendar-add-popup-show-planner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t<div>"]);G=function G(){return H};return H}function c(){var G=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-container calendar-field-container-datetime"></div>']);H=function H(){return G};return G}function d(){var G=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field-choice-calendar"></div>']);H=function H(){return G};return G}function f(){var G=babelHelpers.taggedTemplateLiteral(['<div class="calendar-field calendar-field-select calendar-field-tiny"></div>']);H=function H(){return G};return G}function h(){var H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="calendar-field calendar-field-string" \n\t\t\t\tvalue="" \n\t\t\t\tplaceholder="','" \n\t\t\t\ttype="text" \n\t\t\t/>\n\t\t']);G=function G(){return H};return H}function j(){var H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t<div class="calendar-field-title">',":</div>\n\t\t\t\t\t","\n\t\t\t\t</div>"]);G=function G(){return H};return H}function l(){var H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-string-select">\n\t\t\t\t<div class="calendar-field-block">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>"]);G=function G(){return H};return H}function u(){var H=babelHelpers.taggedTemplateLiteral(['<div class="calendar-add-popup-wrap">\n\t\t\t','\n\t\t\t<div class="calendar-field-container calendar-field-container-choice">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t\t\n\t\t\t","\n\t\t\t\n\t\t\t",'\n\t\t\t\n\t\t\t<div class="calendar-field-container calendar-field-container-info">\n\t\t\t\t',"\n\t\t\t\t\n\t\t\t\t\t","\n\t\t\t\t\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"]);G=function G(){return H};return H}var x=function(ay){babelHelpers.inherits(R,ay);function R(){var aC;var aB=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,R);aC=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(R).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"STATE",{READY:1,REQUEST:2,ERROR:3});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"zIndex",1200);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"Z_INDEX_OFFSET",-1000);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"userSettings","");babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"displayed",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"sections",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"sectionIndex",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"trackingUsersList",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(aC),"checkDataBeforeCloseMode",true);aC.setEventNamespace("BX.Calendar.CompactEventForm");aC.userId=aB.userId||z.Util.getCurrentUserId();aC.type=aB.type||"user";aC.ownerId=aB.ownerId||aC.userId;aC.BX=z.Util.getBX();aC.checkForChanges=b.Runtime.debounce(aC.checkForChangesImmediately,300,babelHelpers.assertThisInitialized(aC));aC.checkOutsideClickClose=aC.checkOutsideClickClose.bind(babelHelpers.assertThisInitialized(aC));aC.outsideMouseDownClose=aC.outsideMouseDownClose.bind(babelHelpers.assertThisInitialized(aC));aC.keyHandler=aC.handleKeyPress.bind(babelHelpers.assertThisInitialized(aC));return aC}babelHelpers.createClass(R,[{key:"show",value:function al(){var aB=this;var aD=arguments.length>0&&arguments[0]!==undefined?arguments[0]:R.EDIT_MODE;var aC=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.setParams(aC);this.setMode(aD);this.state=this.STATE.READY;this.popupId="compact-event-form-"+Math.round(Math.random()*100000);if(this.popup){this.popup.destroy()}this.popup=this.getPopup(aC);b.Dom.addClass(this.popup.titleBar,"calendar-add-popup-titlebar");b.Dom.removeClass(this.popup.popupContainer,"popup-window-with-titlebar");b.Dom.removeClass(this.popup.closeIcon,"popup-window-titlebar-close-icon");b.Event.bind(document,"mousedown",this.outsideMouseDownClose);b.Event.bind(document,"mouseup",this.checkOutsideClickClose);b.Event.bind(document,"keydown",this.keyHandler);b.Event.bind(this.popup.popupContainer,"transitionend",function(){b.Dom.removeClass(aB.popup.popupContainer,"calendar-simple-view-popup-show")});this.setFormValues();this.popup.show();this.checkDataBeforeCloseMode=true;if(this.canDo("edit")&&this.DOM.titleInput&&aD===R.EDIT_MODE){this.DOM.titleInput.focus();this.DOM.titleInput.select()}this.displayed=true}},{key:"getPopup",value:function ab(aB){return new A.Popup(this.popupId,aB.bindNode,{zIndex:this.zIndex+this.Z_INDEX_OFFSET,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,titleBar:true,draggable:true,resizable:false,lightShadow:true,className:"calendar-simple-view-popup calendar-simple-view-popup-show",cacheable:false,content:this.getPopupContent(),buttons:this.getButtons(),events:{onPopupClose:this.close.bind(this)}})}},{key:"isShown",value:function aq(){return this.displayed}},{key:"close",value:function at(){if(this.getMode()===R.EDIT_MODE&&this.formDataChanged()&&this.checkDataBeforeCloseMode&&!confirm(BX.message("EC_SAVE_ENTRY_CONFIRM"))){return}this.displayed=false;this.emit("onClose");b.Event.unbind(document,"mousedown",this.outsideMouseDownClose);b.Event.unbind(document,"mouseup",this.checkOutsideClickClose);b.Event.unbind(document,"keydown",this.keyHandler);if(this.popup){this.popup.destroy()}z.Util.closeAllPopups()}},{key:"getPopupContent",value:function ad(){this.DOM.wrap=b.Tag.render(u(),this.DOM.titleOuterWrap=b.Tag.render(l(),this.getTitleControl(),this.getColorControl()),this.getSectionControl(),this.getDateTimeControl(),this.getUserPlannerSelector(),this.getTypeInfoControl(),this.getLocationControl(),this.DOM.remindersOuterWrap=b.Tag.render(j(),b.Loc.getMessage("EC_REMIND_LABEL"),this.createRemindersControl()),this.getRRuleInfoControl(),this.getTimezoneInfoControl());return this.DOM.wrap}},{key:"getButtons",value:function aA(){var aB=this;var aD=[];var aE=this.getMode();if(aE===R.EDIT_MODE){aD.push(new BX.UI.Button({text:this.isNewEntry()?b.Loc.getMessage("CALENDAR_EVENT_DO_ADD"):b.Loc.getMessage("CALENDAR_EVENT_DO_SAVE"),className:"ui-btn ui-btn-primary",events:{click:function aC(){aB.checkDataBeforeCloseMode=false;aB.save()}}}));aD.push(new BX.UI.Button({text:b.Loc.getMessage("CALENDAR_EVENT_DO_CANCEL"),className:"ui-btn ui-btn-link",events:{click:function aC(){if(aB.isNewEntry()){aB.checkDataBeforeCloseMode=false;aB.close()}else{aB.setFormValues();if(aB.userPlannerSelector){aB.userPlannerSelector.destroySelector()}aB.setMode(R.VIEW_MODE);aB.popup.setButtons(aB.getButtons())}}}}));aD.push(new BX.UI.Button({text:b.Loc.getMessage("CALENDAR_EVENT_FULL_FORM"),className:"ui-btn calendar-full-form-btn",events:{click:this.editEntryInSlider.bind(this)}}))}else{if(aE===R.VIEW_MODE){if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"){aD.push(new BX.UI.Button({className:"ui-btn ui-btn-primary",text:b.Loc.getMessage("EC_DESIDE_BUT_Y"),events:{click:function aC(){C.EntryManager.setMeetingStatus(aB.entry,"Y").then(aB.refreshMeetingStatus.bind(aB))}}}));aD.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:b.Loc.getMessage("EC_DESIDE_BUT_N"),events:{click:function aC(){C.EntryManager.setMeetingStatus(aB.entry,"N").then(aB.refreshMeetingStatus.bind(aB))}}}))}aD.push(new BX.UI.Button({className:"ui-btn ".concat(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Q"?"ui-btn-link":"ui-btn-primary"),text:b.Loc.getMessage("CALENDAR_EVENT_DO_OPEN"),events:{click:function aC(){aB.checkDataBeforeCloseMode=false;BX.Calendar.EntryManager.openViewSlider(aB.entry.id,{entry:aB.entry,type:aB.type,ownerId:aB.ownerId,userId:aB.userId,from:aB.entry.from,timezoneOffset:aB.entry&&aB.entry.data?aB.entry.data.TZ_OFFSET_FROM:null});aB.close()}}}));if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="N"){aD.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:b.Loc.getMessage("EC_DESIDE_BUT_Y"),events:{click:function aC(){C.EntryManager.setMeetingStatus(aB.entry,"Y").then(aB.refreshMeetingStatus.bind(aB))}}}))}if(this.entry.isMeeting()&&this.entry.getCurrentStatus()==="Y"){aD.push(new BX.UI.Button({className:"ui-btn ui-btn-link",text:b.Loc.getMessage("EC_DESIDE_BUT_N"),events:{click:function aC(){C.EntryManager.setMeetingStatus(aB.entry,"N").then(aB.refreshMeetingStatus.bind(aB))}}}))}if(!this.isNewEntry()&&this.canDo("edit")){aD.push(new BX.UI.Button({text:b.Loc.getMessage("CALENDAR_EVENT_DO_EDIT"),className:"ui-btn ui-btn-link",events:{click:this.editEntryInSlider.bind(this)}}))}if(!this.isNewEntry()&&this.canDo("delete")){if(!this.entry.isMeeting()||!this.entry.getCurrentStatus()||this.entry.getCurrentStatus()==="H"){aD.push(new BX.UI.Button({text:b.Loc.getMessage("CALENDAR_EVENT_DO_DELETE"),className:"ui-btn ui-btn-link",events:{click:function aC(){C.EntryManager.deleteEntry(aB.entry);D.EventEmitter.subscribeOnce("BX.Calendar.Entry:delete",function(){aB.checkDataBeforeCloseMode=false;aB.close()});if(!aB.entry.wasEverRecursive()){aB.close()}}}}))}}}}if(aD.length>2){aD[1].button.className="ui-btn ui-btn-light-border"}setTimeout(function(){if(aB.popup&&aB.popup.popupContainer){}},0);return aD}},{key:"refreshMeetingStatus",value:function ai(){this.emit("doRefresh");this.popup.setButtons(this.getButtons());if(this.userPlannerSelector){this.userPlannerSelector.displayAttendees(this.entry.getAttendees())}}},{key:"hideLoader",value:function T(){if(b.Type.isDomNode(this.DOM.loader)){b.Dom.remove(this.DOM.loader);this.DOM.loader=null}}},{key:"showInEditMode",value:function ap(){var aB=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(R.EDIT_MODE,aB)}},{key:"showInViewMode",value:function M(){var aB=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.show(R.VIEW_MODE,aB)}},{key:"setMode",value:function an(aB){if(aB==="edit"||aB==="view"){this.mode=aB}}},{key:"getMode",value:function ak(){return this.mode}},{key:"checkForChangesImmediately",value:function J(){if(!this.isNewEntry()&&this.getMode()===R.VIEW_MODE&&this.formDataChanged()){this.setMode(R.EDIT_MODE);this.popup.setButtons(this.getButtons())}else{if(!this.isNewEntry()&&this.getMode()===R.EDIT_MODE&&!this.formDataChanged()){this.setMode(R.VIEW_MODE);this.popup.setButtons(this.getButtons())}}this.emitOnChange()}},{key:"updateSetMeetingButtons",value:function O(){var aB=this.getCurrentEntry();if(aB.isMeeting()){}}},{key:"getformDataChanges",value:function W(){var aE=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var aC=this.entry;var aB=[];if(!aE.includes("name")&&aC.name!==this.DOM.titleInput.value){aB.push("name")}if(!aE.includes("location")&&this.locationSelector.getTextLocation(t.Location.parseStringValue(aC.getLocation()))!==this.locationSelector.getTextLocation(t.Location.parseStringValue(this.locationSelector.getTextValue()))){aB.push("location")}var aD=this.dateTimeControl.getValue();if(!aE.includes("date&time")&&(aC.isFullDay()!==aD.fullDay||aD.from.toString()!==aC.from.toString()||aD.to.toString()!==aC.to.toString())){aB.push("date&time")}if(!aE.includes("notify")&&(!aC.isMeeting()||aC.getMeetingNotify())!==this.userPlannerSelector.getInformValue()){aB.push("notify")}if(!aE.includes("section")&&parseInt(aC.sectionId)!==parseInt(this.sectionValue)){aB.push("section")}if(!aE.includes("codes")&&this.userPlannerSelector.getEntityList().map(function(aF){return aF.entityId+":"+aF.id}).join("|")!==aC.getAttendeesEntityList().map(function(aF){return aF.entityId+":"+aF.id}).join("|")){aB.push("codes")}return aB}},{key:"formDataChanged",value:function S(){return this.getformDataChanges().length>0}},{key:"setParams",value:function ao(){var aB=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.userId=aB.userId||z.Util.getCurrentUserId();this.type=aB.type||"user";this.ownerId=aB.ownerId?aB.ownerId:0;if(this.type==="user"&&!this.ownerId){this.ownerId=this.userId}this.entry=C.EntryManager.getEntryInstance(aB.entry,aB.userIndex,{type:this.type,ownerId:this.ownerId});this.sectionValue=null;if(!this.entry.id&&b.Type.isPlainObject(aB.entryTime)&&b.Type.isDate(aB.entryTime.from)&&b.Type.isDate(aB.entryTime.to)){this.entry.setDateTimeValue(aB.entryTime)}if(b.Type.isPlainObject(aB.userSettings)){this.userSettings=aB.userSettings}this.locationFeatureEnabled=!!aB.locationFeatureEnabled;this.locationList=aB.locationList||[];this.iblockMeetingRoomList=aB.iblockMeetingRoomList||[];this.setSections(aB.sections,aB.trackingUserList)}},{key:"setSections",value:function aw(aD){var aB=this;var aC=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];this.sections=aD;this.sectionIndex={};this.trackingUsersList=aC||[];if(b.Type.isArray(aD)){aD.forEach(function(aF,aE){aB.sectionIndex[parseInt(aF.ID||aF.id)]=aE},this)}}},{key:"prepareData",value:function af(){return new Promise(function(aB){setTimeout(function(){aB()},0)})}},{key:"getTitleControl",value:function aa(){this.DOM.titleInput=b.Tag.render(h(),b.Loc.getMessage("EC_ENTRY_NAME"));b.Event.bind(this.DOM.titleInput,"keyup",this.checkForChanges);b.Event.bind(this.DOM.titleInput,"change",this.checkForChanges);return this.DOM.titleInput}},{key:"getColorControl",value:function ae(){var aB=this;this.DOM.colorSelect=b.Tag.render(f());this.colorSelector=new t.ColorSelector({wrap:this.DOM.colorSelect,mode:"selector"});this.colorSelector.subscribe("onChange",function(aD){if(aD instanceof D.BaseEvent){var aC=aD.getData().value;if(!aB.isNewEntry()&&(aB.canDo("edit")||aB.entry.getCurrentStatus()!==false)){aB.BX.ajax.runAction("calendar.api.calendarajax.updateColor",{data:{entryId:aB.entry.id,userId:aB.userId,color:aC}});aB.entry.data.COLOR=aC;aB.emit("doRefresh");aB.emitOnChange()}}});return this.DOM.colorSelect}},{key:"getSectionControl",value:function ah(){var aC=this;this.DOM.sectionSelectWrap=b.Tag.render(d());this.sectionSelector=new t.SectionSelector({outerWrap:this.DOM.sectionSelectWrap,defaultCalendarType:this.type,defaultOwnerId:this.ownerId,sectionList:this.sections,sectionGroupList:B.CalendarSectionManager.getSectionGroupList({type:this.type,ownerId:this.ownerId,userId:this.userId,trackingUsersList:this.trackingUsersList}),mode:"textselect",zIndex:this.zIndex,getCurrentSection:function aD(){var aE=aC.getCurrentSection();if(aE){return{id:aE.id,name:aE.name,color:aE.color}}return false},selectCallback:function aB(aE){if(aE){if(aC.colorSelector){aC.colorSelector.setValue(aE.color)}aC.sectionValue=aE.id;aC.checkForChanges()}}});return this.DOM.sectionSelectWrap}},{key:"getDateTimeControl",value:function Y(){var aB=this;this.DOM.dateTimeWrap=b.Tag.render(c());this.dateTimeControl=new t.DateTimeControl(null,{showTimezone:false,outerWrap:this.DOM.dateTimeWrap,inlineEditMode:true});this.dateTimeControl.subscribe("onChange",function(aC){if(aC instanceof D.BaseEvent){var aD=aC.getData().value;if(aB.remindersControl){aB.remindersControl.setFullDayMode(aD.fullDay)}if(aB.userPlannerSelector){if(!aB.userPlannerSelector.isPlannerDisplayed()){aB.userPlannerSelector.showPlanner()}aB.userPlannerSelector.setLocationValue(aB.locationSelector.getTextValue());aB.userPlannerSelector.setDateTime(aD,true);aB.userPlannerSelector.refreshPlanner()}aB.checkForChanges()}});return this.DOM.dateTimeWrap}},{key:"getUserPlannerSelector",value:function I(){var aB=this;this.DOM.userPlannerSelectorOuterWrap=b.Tag.render(a(),this.DOM.userSelectorWrap=b.Tag.render(F(),b.Loc.getMessage("EC_ATTENDEES_MORE"),b.Loc.getMessage("EC_SEC_SLIDER_CHANGE")),b.Loc.getMessage("EC_SEC_SLIDER_CREATE_CHAT_LINK"),this.DOM.informWrap=b.Tag.render(s(),b.Loc.getMessage("EC_NOTIFY_OPTION")),this.DOM.plannerOuterWrap=b.Tag.render(q()));this.userPlannerSelector=new t.UserPlannerSelector({outerWrap:this.DOM.userPlannerSelectorOuterWrap,wrap:this.DOM.userSelectorWrap,informWrap:this.DOM.informWrap,plannerOuterWrap:this.DOM.plannerOuterWrap,readOnlyMode:false,userId:this.userId,type:this.type,ownerId:this.ownerId,zIndex:this.zIndex+10});this.userPlannerSelector.subscribe("onDateChange",this.handlePlannerSelectorChanges.bind(this));this.userPlannerSelector.subscribe("onNotifyChange",this.checkForChanges);this.userPlannerSelector.subscribe("onUserCodesChange",this.checkForChanges);this.userPlannerSelector.subscribe("onOpenChat",function(){C.EntryManager.openChatForEntry({entryId:aB.entry.parentId,entry:aB.entry})});return this.DOM.userPlannerSelectorOuterWrap}},{key:"getLocationControl",value:function H(){var aC=this;this.DOM.locationWrap=b.Tag.render(p());this.DOM.locationOuterWrap=b.Tag.render(o(),b.Loc.getMessage("EC_LOCATION_LABEL"),this.DOM.locationWrap);this.locationSelector=new t.Location({wrap:this.DOM.locationWrap,richLocationEnabled:this.locationFeatureEnabled,locationList:this.locationList||[],iblockMeetingRoomList:this.iblockMeetingRoomList||[],inlineEditModeEnabled:true,onChangeCallback:function aB(){if(aC.userPlannerSelector){aC.userPlannerSelector.setLocationValue(aC.locationSelector.getTextValue());if(aC.locationSelector.getValue().type!==undefined&&!aC.userPlannerSelector.isPlannerDisplayed()){aC.userPlannerSelector.showPlanner()}aC.userPlannerSelector.refreshPlanner()}aC.checkForChanges()}});return this.DOM.locationOuterWrap}},{key:"createRemindersControl",value:function ax(){var aB=this;this.reminderValues=[];this.DOM.remindersWrap=b.Tag.render(n());this.remindersControl=new t.Reminder({wrap:this.DOM.remindersWrap,zIndex:this.zIndex});this.remindersControl.subscribe("onChange",function(aC){if(aC instanceof D.BaseEvent){aB.reminderValues=aC.getData().values;if(!aB.isNewEntry()&&(aB.canDo("edit")||aB.entry.getCurrentStatus()!==false)){aB.BX.ajax.runAction("calendar.api.calendarajax.updateReminders",{data:{entryId:aB.entry.id,userId:aB.userId,reminders:aB.reminderValues}}).then(function(aD){aB.entry.data.REMIND=aD.data.REMIND})}}});return this.DOM.remindersWrap}},{key:"getTypeInfoControl",value:function G(){this.DOM.typeInfoTitle=b.Tag.render(m());this.DOM.typeInfoLink=b.Tag.render(k());this.DOM.typeInfoWrap=b.Tag.render(i(),this.DOM.typeInfoTitle,this.DOM.typeInfoLink);return this.DOM.typeInfoWrap}},{key:"getRRuleInfoControl",value:function ar(){this.DOM.rruleInfo=b.Tag.render(g());this.DOM.rruleInfoWrap=b.Tag.render(e(),b.Loc.getMessage("EC_REPEAT"),this.DOM.rruleInfo);return this.DOM.rruleInfoWrap}},{key:"getTimezoneInfoControl",value:function L(){this.DOM.timezoneInfo=b.Tag.render(y());this.DOM.timezoneInfoWrap=b.Tag.render(w(),b.Loc.getMessage("EC_TIMEZONE"),this.DOM.timezoneInfo);return this.DOM.timezoneInfoWrap}},{key:"isNewEntry",value:function az(){return !this.entry.id}},{key:"canDo",value:function ag(aB){var aC=this.getCurrentSection();if(aB==="edit"||aB==="delete"){if(this.entry.isMeeting()&&this.entry.id!==this.entry.parentId){return false}if(this.entry.isResourcebooking()){return false}return aC.canDo("edit")}if(aB==="view"){return aC.canDo("view_time")}if(aB==="viewFull"){return aC.canDo("view_full")}return true}},{key:"setFormValues",value:function K(){var aE=this.entry,aG=this.getCurrentSection(),aH=!this.canDo("edit");this.dateTimeControl.setValue({from:new Date(aE.from.getTime()-(parseInt(aE.data["~USER_OFFSET_FROM"])||0)*1000),to:new Date(aE.to.getTime()-(parseInt(aE.data["~USER_OFFSET_TO"])||0)*1000),fullDay:aE.fullDay,timezoneFrom:aE.getTimezoneFrom()||"",timezoneTo:aE.getTimezoneTo()||"",timezoneName:this.userSettings.timezoneName});this.dateTimeControl.setInlineEditMode(this.isNewEntry()?"edit":"view");this.dateTimeControl.setViewMode(aH);this.DOM.titleInput.value=aE.getName();if(aH){if(this.entry.getCurrentStatus()===false){this.DOM.titleInput.type="hidden";this.DOM.titleLabel=this.DOM.titleInput.parentNode.insertBefore(b.Tag.render(v(),b.Text.encode(aE.getName())),this.DOM.titleInput);b.Dom.addClass(this.DOM.titleOuterWrap,"calendar-field-container-view")}else{this.DOM.titleInput.disabled=true}}this.colorSelector.setValue(aE.getColor()||aG.color,false);this.colorSelector.setViewMode(aH&&this.entry.getCurrentStatus()===false);this.sectionValue=this.getCurrentSectionId();this.sectionSelector.updateValue();this.sectionSelector.setViewMode(aH);this.remindersControl.setValue(aE.getReminders(),false);this.remindersControl.setViewMode(aH&&this.entry.getCurrentStatus()===false);if(aH&&this.entry.getCurrentStatus()===false){this.DOM.remindersOuterWrap.style.display="none"}if(aE.isRecursive()){this.DOM.rruleInfoWrap.style="";b.Dom.adjust(this.DOM.rruleInfo,{text:aE.getRRuleDescription()})}var aF=this.mode==="view"?this.userSettings.timezoneName:aE.getTimezoneFrom();if(b.Type.isStringFilled(aE.getTimezoneFrom())&&aE.getTimezoneFrom()!==this.userSettings.timezoneName&&!this.isNewEntry()){this.DOM.timezoneInfoWrap.style="";b.Dom.adjust(this.DOM.timezoneInfo,{text:aF})}var aB=aE.getLocation();if(aH&&!aB){b.Dom.remove(this.DOM.locationOuterWrap)}else{this.locationSelector.setValue(aE.getLocation())}if(this.userPlannerSelector&&(this.canDo("viewFull")||aE.getCurrentStatus()!==false)){this.userPlannerSelector.setValue({attendeesEntityList:aE.getAttendeesEntityList(),location:aB,attendees:aE.getAttendees(),notify:!aE.isMeeting()||aE.getMeetingNotify(),viewMode:this.getMode()===R.VIEW_MODE,entryId:aE.id});this.userPlannerSelector.setDateTime(this.dateTimeControl.getValue());this.userPlannerSelector.setViewMode(aH)}else{b.Dom.remove(this.DOM.userPlannerSelectorOuterWrap)}this.updateSetMeetingButtons();var aD=true;this.DOM.infoContainer=this.DOM.wrap.querySelector(".calendar-field-container-info");for(var aC=0;aC<=this.DOM.infoContainer.childNodes.length;aC++){if(b.Type.isElementNode(this.DOM.infoContainer.childNodes[aC])&&this.DOM.infoContainer.childNodes[aC].style.display!=="none"){aD=false}}if(aD){this.DOM.infoContainer.style.display="none"}}},{key:"save",value:function X(){var aF=this;var aB=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.state===this.STATE.REQUEST){return}var aC=this.getCurrentEntry();aB=b.Type.isPlainObject(aB)?aB:{};if(this.isNewEntry()&&this.userPlannerSelector.hasExternalEmailUsers()&&z.Util.checkEmailLimitationPopup()&&!aB.emailLimitationDialogShown){C.EntryManager.showEmailLimitationDialog({callback:function aG(aH){aB.emailLimitationDialogShown=true;aF.save(aB)}});return false}if(!this.userSettings.sendFromEmail&&this.userPlannerSelector.hasExternalEmailUsers()){C.EntryManager.showConfirmedEmailDialog({callback:function aG(aH){aF.save(aB)}});return false}if(!this.isNewEntry()&&aC.isRecursive()&&!aB.confirmed&&this.getformDataChanges(["section","notify"]).length>0){C.EntryManager.showConfirmEditDialog({callback:function aG(aH){aB.recursionMode=aH.recursionMode;aB.confirmed=true;aF.save(aB)}});return false}if(!this.isNewEntry()&&aC.isMeeting()&&aB.sendInvitesAgain===undefined&&this.getformDataChanges().includes("date&time")&&aC.getAttendees().find(function(aH){return aH.STATUS==="N"})){C.EntryManager.showReInviteUsersDialog({callback:function aG(aH){aB.sendInvitesAgain=aH.sendInvitesAgain;aF.save(aB)}});return false}var aE=this.dateTimeControl.getValue();var aD={id:aC.id,section:this.sectionValue,name:this.DOM.titleInput.value,reminder:this.remindersControl.getSelectedValues(),date_from:aE.fromDate,date_to:aE.toDate,skip_time:aE.fullDay?"Y":"N",time_from:aE.fromTime,time_to:aE.toTime,location:this.locationSelector.getTextValue(),tz_from:aC.getTimezoneFrom(),tz_to:aC.getTimezoneTo(),meeting_notify:this.userPlannerSelector.getInformValue()?"Y":"N",exclude_users:this.excludeUsers||[],attendeesEntityList:this.userPlannerSelector.getEntityList(),sendInvitesAgain:aB.sendInvitesAgain?"Y":"N"};if(aC.id&&aC.isRecursive()){aD.EVENT_RRULE=aC.data.RRULE}if(aB.recursionMode){aD.rec_edit_mode=aB.recursionMode;aD.current_date_from=z.Util.formatDate(aC.from)}if(this.getCurrentSection().color.toLowerCase()!==this.colorSelector.getValue().toLowerCase()){aD.color=this.colorSelector.getValue()}this.state=this.STATE.REQUEST;this.BX.ajax.runAction("calendar.api.calendarajax.editEntry",{data:aD}).then(function(aH){aF.state=aF.STATE.READY;if(aH.data.entryId){if(aC.id){C.EntryManager.showEditEntryNotification(aH.data.entryId)}else{C.EntryManager.showNewEntryNotification(aH.data.entryId)}}aF.emit("onSave",new D.BaseEvent({data:{responseData:aH.data,options:aB}}));aF.close();if(aH.data.displayMobileBanner){new r.MobileSyncBanner().showInPopup()}if(aH.data.countEventWithEmailGuestAmount){z.Util.setEventWithEmailGuestAmount(aH.data.countEventWithEmailGuestAmount)}},function(aH){if(aH.data&&b.Type.isPlainObject(aH.data.busyUsersList)){aF.handleBusyUsersError(aH.data.busyUsersList);var aI=[];aH.errors.forEach(function(aJ){if(aJ.code!=="edit_entry_user_busy"){aI.push(aJ)}});aH.errors=aI}if(aH.errors&&aH.errors.length){aF.showError(aH.errors)}aF.state=aF.STATE.ERROR})}},{key:"handleBusyUsersError",value:function V(aB){var aC=this;var aF=[],aD=[];for(var aE in aB){if(aB.hasOwnProperty(aE)){aF.push(aB[aE]);aD.push(aE)}}this.busyUsersDialog=new t.BusyUsersDialog();this.busyUsersDialog.subscribe("onSaveWithout",function(){aC.excludeUsers=aD.join(",");aC.save()});this.busyUsersDialog.show({users:aF})}},{key:"handleKeyPress",value:function Q(aC){if(this.getMode()===R.EDIT_MODE&&aC.keyCode===z.Util.getKeyCode("enter")){this.save()}else{if(aC.keyCode===z.Util.getKeyCode("escape")&&this.couldBeClosedByEsc()){this.close()}else{if(aC.keyCode===z.Util.getKeyCode("delete")&&!this.isNewEntry()&&this.canDo("delete")){var aB=event.target||event.srcElement;if(b.Type.isDomNode(aB)&&aB.tagName!=="INPUT"){C.EntryManager.deleteEntry(this.entry);this.close()}}}}}},{key:"getCurrentEntry",value:function au(){return this.entry}},{key:"getCurrentSection",value:function ac(){var aC=false;var aB=this.getCurrentSectionId();if(aB&&this.sectionIndex[aB]!==undefined&&this.sections[this.sectionIndex[aB]]!==undefined){aC=this.sections[this.sectionIndex[aB]]}return aC}},{key:"getCurrentSectionId",value:function P(){var aC=0;if(this.sectionValue){aC=this.sectionValue}else{var aB=this.getCurrentEntry();if(aB instanceof C.Entry){aC=parseInt(aB.sectionId)}if(!aC&&this.lastUsedSection&&this.sections[this.sectionIndex[parseInt(this.lastUsedSection)]]){aC=parseInt(this.lastUsedSection)}if(!aC&&this.sections[0]){aC=parseInt(this.sections[0].ID)}}return aC}},{key:"handlePlannerSelectorChanges",value:function U(aB){if(aB instanceof D.BaseEvent){var aC=aB.getData();this.dateTimeControl.setValue({from:aC.dateFrom,to:aC.dateTo})}}},{key:"editEntryInSlider",value:function aj(){this.checkDataBeforeCloseMode=false;var aB=this.dateTimeControl.getValue();BX.Calendar.EntryManager.openEditSlider({entry:this.entry,type:this.type,ownerId:this.ownerId,userId:this.userId,formDataValue:{section:this.sectionValue,name:this.DOM.titleInput.value,reminder:this.remindersControl.getSelectedRawValues(),color:this.colorSelector.getValue(),from:aB.from,to:aB.to,fullDay:aB.fullDay,location:this.locationSelector.getTextValue(),meetingNotify:this.userPlannerSelector.getInformValue()?"Y":"N",attendeesEntityList:this.userPlannerSelector.getEntityList()}});this.close()}},{key:"outsideMouseDownClose",value:function Z(aB){var aC=aB.target||aB.srcElement;this.outsideMouseDown=!aC.closest("div.popup-window")}},{key:"checkOutsideClickClose",value:function am(aB){var aC=aB.target||aB.srcElement;this.outsideMouseUp=!aC.closest("div.popup-window");if(this.couldBeClosedByEsc()&&this.outsideMouseDown&&this.outsideMouseUp&&(this.getMode()===R.VIEW_MODE||!this.formDataChanged()||this.isNewEntry())){setTimeout(this.close.bind(this),0)}}},{key:"couldBeClosedByEsc",value:function av(){var aB=this;return !A.PopupManager._popups.find(function(aC){return aC&&aC.getId()!==aB.popupId&&aC.isShown()})}},{key:"emitOnChange",value:function N(){this.emit("onChange",new D.BaseEvent({data:{form:this,entry:this.entry}}))}}]);return R}(D.EventEmitter);babelHelpers.defineProperty(x,"VIEW_MODE","view");babelHelpers.defineProperty(x,"EDIT_MODE","edit");E.CompactEventForm=x}((this.BX.Calendar=this.BX.Calendar||{}),BX,BX.Event,BX.Calendar,BX.Main,BX.Calendar.Controls,BX.Calendar,BX.Calendar,BX.Calendar.Sync.Interface));