(function(){if(window.BX.seoParser){return}var g=window.BX,d=[];g.seoParser=function(i,h){this.textarea=h;this.contentData=[];this.editors=[];this.editors_index={};this.parseContent(i);g.ready(g.delegate(this.init,this))};g.seoParser.prototype.init=function(){this.textarea=g(this.textarea);g.bind(this.textarea,"change",g.delegate(this.parseContent,this))};g.seoParser.prototype.parseContent=function(l){this.contentData=[];if(typeof l=="undefined"||!g.type.isString(l)){l=this.textarea.value}if(l.length>0){var j=l.split(/\n+/g);var m="",o={name:"",data:[]},k;for(k=0;k<j.length;k++){var h=g.util.trim(j[k]);if(h.length>0){var n;if(/^#/.test(h)){n=[h]}else{n=h.split(/:\s*/);n=[n.shift(),n.join(":")]}if(n[0].toUpperCase()=="USER-AGENT"){if(m!==""){this.contentData.push(o)}m=n[1];o={name:m,data:[]}}else{if(!!m){if(n[0].toUpperCase()=="DISALLOW"&&(!n[1]||n[1].replace(/#.*/,"")==="")){continue}o.data.push(n)}}}}if(m!==""){this.contentData.push(o)}for(k=0;k<this.editors.length;k++){this.sendData(this.editors[k].getUserAgent())}}};g.seoParser.prototype.compile=function(){var k,h,l="",m="\r\n";for(k=0;k<this.contentData.length;k++){if(typeof this.editors_index[this.contentData[k].name.toUpperCase()]!="undefined"){delete this.contentData[k]}}for(k=0;k<this.editors.length;k++){this.contentData=g.util.insertIntoArray(this.contentData,k,{name:this.editors[k].getUserAgent(),data:this.editors[k].getRules()})}this.contentData=g.util.array_values(this.contentData);for(k=0;k<this.contentData.length;k++){if(g.type.isArray(this.contentData[k].data)&&this.contentData[k].data.length>0){l+=(l===""?"":m)+"User-Agent: "+this.contentData[k].name+m;for(h=0;h<this.contentData[k].data.length;h++){l+=this.contentData[k].data[h][0];if(typeof this.contentData[k].data[h][1]!="undefined"&&this.contentData[k].data[h][1].length>0){l+=": "+this.contentData[k].data[h][1]}l+=m}}}this.textarea.value=l};g.seoParser.prototype.registerEditor=function(h){this.editors_index[h.getUserAgent().toUpperCase()]=this.editors.length;this.editors.push(h);this.sendData(h.getUserAgent())};g.seoParser.prototype.sendData=function(j){j=j.toUpperCase();if(typeof this.editors_index[j]!="undefined"){for(var h=0;h<this.contentData.length;h++){if(this.contentData[h].name.toUpperCase()==j){this.editors[this.editors_index[j]].setRules(this.contentData[h].data||[]);return}}this.editors[this.editors_index[j]].setRules([])}};g.seoEditor=function(h){this.service=h.service;this.userAgent=h.userAgent;this.cont={rules:h.cont.rules,buttons:h.cont.buttons};this.rules=[];g.ready(g.delegate(this.init,this))};g.seoEditor.prototype.init=function(){this.cont.rules=g(this.cont.rules);this.cont.buttons=g(this.cont.buttons);this.build();this.buildButtons()};g.seoEditor.prototype.buildButtons=function(){var j=function(k,l){return function(i){d[k].callback(l);return g.PreventDefault(i)}};for(var h=0;h<d.length;h++){if(typeof d[h].compatible!="undefined"&&g.type.isArray(d[h].compatible)&&!g.util.in_array(this.service,d[h].compatible)){continue}this.cont.buttons.appendChild(g.create("DIV",{props:{className:"seo-robots-action"},children:[g.create("INPUT",{props:{type:"button",className:"seo-robots-action-button "+(d[h].className||"adm-btn"),name:d[h].name||"",value:d[h].text,title:d[h].title||""},events:{click:j(h,this)}})]}))}};g.seoEditor.prototype.build=function(){if(!g.isReady){g.ready(g.delegate(this.build,this));return}this.cont.rules.innerHTML="";this.cont.rules.appendChild(g.create("DIV",{text:"User-Agent: "+this.userAgent}));this.rules=g.util.array_values(this.rules);for(var h=0;h<this.rules.length;h++){if(!!this.rules[h]){var j=this.rules[h][0];if(typeof this.rules[h][1]!="undefined"&&this.rules[h][1].length>0){j+=": "+this.rules[h][1]}this.cont.rules.appendChild(g.create("DIV",{props:{className:"seo-robots-entry"},children:[g.create("SPAN",{text:j}),g.create("SPAN",{props:{className:"seo-robots-delete"},events:{click:this.getDeleteAction(h)}})]}))}}};g.seoEditor.prototype.getDeleteAction=function(h){return g.delegate(function(){delete this.rules[h];this.build()},this)};g.seoEditor.prototype.getUserAgent=function(){return this.userAgent};g.seoEditor.prototype.getRules=function(k){var l=[],j=this.rules.length;if(!!k){k=k.toUpperCase()}for(var h=0;h<j;h++){if(!k||k==this.rules[h][0].toUpperCase()){l.push([this.rules[h][0],this.rules[h][1]])}}return l};g.seoEditor.prototype.setRules=function(k,j){if(typeof j=="undefined"){this.rules=k}else{var h;for(h=0;h<this.rules.length;h++){if(!!this.rules[h]&&this.rules[h][0]==j){delete this.rules[h]}}if(!!k&&k.length>0){for(h=0;h<k.length;h++){this.rules.push([k[h][0],k[h][1]])}}}this.build()};g.seoEditor.prototype.addRule=function(k,j){if(!j){for(var h=0;h<this.rules.length;h++){if(!!this.rules[h]){if(this.rules[h][0]==k[0]&&this.rules[h][1]==k[1]){return}}}}this.rules.push([k[0],k[1]]);this.build()};var b=null;var e=["*/index.php","/bitrix/","/*show_include_exec_time=","/*show_page_exec_time=","/*show_sql_stat=","/*bitrix_include_areas=","/*clear_cache=","/*clear_cache_session=","/*ADD_TO_COMPARE_LIST","/*ORDER_BY","/*PAGEN","/*?print=","/*&print=","/*print_course=","/*?action=","/*&action=","/*register=","/*forgot_password=","/*change_password=","/*login=","/*logout=","/*auth=","/*backurl=","/*back_url=","/*BACKURL=","/*BACK_URL=","/*back_url_admin=","/*?utm_source=","/*?bxajaxid=","/*&bxajaxid=","/*?view_result=","/*&view_result="];var f=["/bitrix/components/","/bitrix/cache/","/bitrix/js/","/bitrix/templates/","/bitrix/panel/"];function a(){if(!b){b=new g.PopupWindow(Math.random(),null,{closeByEsc:true,closeIcon:true,titleBar:true,overlay:{backgroundColor:"black",opacity:"50"}});b.closeBtn=new g.PopupWindowButtonLink({text:g.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-link-cancel",events:{click:function(h){this.popupWindow.close();return g.PreventDefault(h)}}})}return b}function c(h,l){var k="seo_callback_"+parseInt(Math.random()*100000);window[k]=h;var i={site:g.message("SEO_SITE_ID"),path:"/",view:"list",sort:"type",sort_order:"asc"};var j={submitFuncName:k,select:"FD",operation:"O",showUploadTab:false,showAddToMenuTab:false,site:g.message("SEO_SITE_ID"),path:"/",lang:g.message("LANGUAGE_ID"),fileFilter:"",allowAllFiles:false,saveConfig:true,sessid:g.bitrix_sessid(),checkChildren:true,genThumb:true,zIndex:2500};if(!!window.oBXFileDialog&&!!window.oBXFileDialog.UserConfig){i=window.oBXFileDialog.UserConfig;j.path=i.path}if(!!l){j.path=l}window.oBXFileDialog=new window.BXFileDialog();window.oBXFileDialog.Open(j,i)}d.push({name:"auto",compatible:["common"],text:g.message("SEO_ROBOT_ACTION_AUTO"),title:g.message("SEO_ROBOT_ACTION_AUTO_TITLE"),className:"adm-btn",callback:function(k){var m=g.message("SEO_HOST");var l=a();var j=k.getRules("Host");if(j.length>0){m=""}var i=function(){var r=[];var q=[];var o=[];var n=k.getRules("Disallow");var p;for(p=0;p<n.length;p++){if(typeof n[1]!="undefined"&&n[1]!==""){q.push(n[1])}}n=k.getRules("Allow");for(p=0;p<n.length;p++){if(typeof n[1]!="undefined"&&n[1]!==""){o.push(n[1])}}for(p=0;p<e.length;p++){if(!g.util.in_array(e[p],q)){k.addRule(["Disallow",e[p]])}}for(p=0;p<f.length;p++){if(!g.util.in_array(f[p],o)){k.addRule(["Allow",f[p]])}}if(m.length>0){k.addRule(["Host",m])}l.close()};if(m.length>0&&m.substring(0,4)!="www."){var h=g.create("DIV",{html:'<input type="text" value="www.'+g.util.htmlspecialchars(m)+'" class="seo-robots-settings-input">'});l.setTitleBar(g.message("SEO_ROBOT_ACTION_MAIN_HOST"));l.setContent(h);l.setButtons([new g.PopupWindowButton({text:g.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function(){m=h.firstChild.value;i()}}}),l.closeBtn]);l.show()}else{i()}}});d.push({name:"disallow_url",text:g.message("SEO_ROBOT_ACTION_DISALLOW"),title:g.message("SEO_ROBOT_ACTION_DISALLOW_TITLE"),className:"adm-btn",callback:function(l){var h=l.getRules("Disallow");var o='<div class="seo-robots-settings-row"><input type="text" value="#PATH#" class="seo-robots-settings-input"><input type="button" value="..."></div>';var n="";for(var k=0;k<h.length+5;k++){n+=o.replace("#PATH#",g.util.htmlspecialchars((h[k]||["",""])[1]))}var j=g.create("DIV",{props:{className:"seo-robots-settings"},events:{click:g.delegateEvent({tagName:"INPUT",property:{type:"button",value:"..."}},function(){var i=this.previousSibling;c(function(p,r,q,t,s){i.value=r.replace(/\/+$/,"")+"/"+p},i.value)})},html:n});var m=a();m.setTitleBar(g.message("SEO_ROBOT_ACTION_DISALLOW_PATH"));m.setContent(j);m.setButtons([new g.PopupWindowButton({text:g.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function(){var i=j.firstChild;var p=[];while(!!i){if(i.tagName.toUpperCase()=="DIV"&&!!i.firstChild&&i.firstChild.tagName.toUpperCase()=="INPUT"&&i.firstChild.type=="text"&&i.firstChild.value!==""){p.push(["Disallow",i.firstChild.value])}i=i.nextSibling}l.setRules(p,"Disallow");m.close()}}}),m.closeBtn]);m.show()}});d.push({name:"allow_url",text:g.message("SEO_ROBOT_ACTION_ALLOW"),title:g.message("SEO_ROBOT_ACTION_ALLOW_TITLE"),className:"adm-btn",callback:function(l){var h=l.getRules("Allow");var o='<div class="seo-robots-settings-row"><input type="text" value="#PATH#" class="seo-robots-settings-input"><input type="button" value="..."></div>';var n="";for(var k=0;k<h.length+5;k++){n+=o.replace("#PATH#",g.util.htmlspecialchars((h[k]||["",""])[1]))}var j=g.create("DIV",{props:{className:"seo-robots-settings"},events:{click:g.delegateEvent({tagName:"INPUT",property:{type:"button",value:"..."}},function(){var i=this.previousSibling;c(function(p,r,q,t,s){i.value=r.replace(/\/+$/,"")+"/"+p},i.value)})},html:n});var m=a();m.setTitleBar(g.message("SEO_ROBOT_ACTION_ALLOW_PATH"));m.setContent(j);m.setButtons([new g.PopupWindowButton({text:g.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function(){var i=j.firstChild;var p=[];while(!!i){if(i.tagName.toUpperCase()=="DIV"&&!!i.firstChild&&i.firstChild.tagName.toUpperCase()=="INPUT"&&i.firstChild.type=="text"&&i.firstChild.value!==""){p.push(["Allow",i.firstChild.value])}i=i.nextSibling}l.setRules(p,"Allow");m.close()}}}),m.closeBtn]);m.show()}});d.push({name:"main_host",text:g.message("SEO_ROBOT_ACTION_MAIN_HOST"),title:g.message("SEO_ROBOT_ACTION_MAIN_HOST_TITLE"),className:"adm-btn",callback:function(k){var j=k.getRules("Host");var p=g.message("SEO_HOST"),o=location.protocol=="https:";if(j.length>0){p=j[0][1];if(p.substring(0,8)=="https://"){o=true;p=p.substring(8,p.length)}}var h='<form name="host_form">';h+='<div class="seo-robots-settings-row"><input type="checkbox" id="main_host_https" name="main_host_https"'+(o?' checked="checked"':"")+'><label for="main_host_https">&nbsp;https</label></div>';var n=(p==g.message("SEO_HOST"))||!p;var m=!n;h+='<div class="seo-robots-settings-row"><input type="radio" name="main_host" value="'+g.util.htmlspecialchars(g.message("SEO_HOST"))+'" id="main_host_1"'+(n?' checked="checked"':"")+'><label for="main_host_1">'+g.util.htmlspecialchars(g.message("SEO_HOST"))+"</label></div>";if(g.message("SEO_HOST").substring(0,4)!="www."){n=p=="www."+g.message("SEO_HOST");m&=!n;h+='<div class="seo-robots-settings-row"><input type="radio" name="main_host" value="www.'+g.util.htmlspecialchars(g.message("SEO_HOST"))+'" id="main_host_2"'+(n?' checked="checked"':"")+'><label for="main_host_2">www.'+g.util.htmlspecialchars(g.message("SEO_HOST"))+"</label></div>"}h+='<div class="seo-robots-settings-row"><input type="radio" name="main_host" value="" id="main_host_3"'+(m?' checked="checked"':"")+'><input type="text" name="main_host_value" value="'+(m?p:"")+'" onfocus="BX(\'main_host_3\').checked=true" class="seo-robots-settings-input"></div>';h+="</form>";var l=g.create("DIV",{props:{className:"seo-robots-settings"},html:h});var i=a();i.setTitleBar(g.message("SEO_ROBOT_MAIN_HOST"));i.setContent(l);i.setButtons([new g.PopupWindowButton({text:g.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function(){var q=document.forms.host_form.main_host,s=g.message("SEO_HOST"),t=[];for(var r=0;r<q.length;r++){if(q[r].checked){s=q[r].value;break}}if(s===""){s=document.forms.host_form.main_host_value.value}if(s.length>0){if(document.forms.host_form.main_host_https.checked){s="https://"+s}t.push(["Host",s])}k.setRules(t,"Host");i.close()}}}),i.closeBtn]);i.show();g.adminFormTools.modifyFormElements(document.forms.host_form)}});d.push({name:"crawl_delay",text:g.message("SEO_ROBOT_ACTION_CRAWL_DELAY"),title:g.message("SEO_ROBOT_ACTION_CRAWL_DELAY_TITLE"),compatible:["common","yandex"],className:"adm-btn",callback:function(j){var h=j.getRules("Crawl-delay");var l=2;if(h.length>0&&!isNaN(parseInt(h[0][1]))){l=h[0][1]}var m='<input type="text" value="'+g.util.htmlspecialchars(l)+'" class="seo-robots-settings-input">';var i=g.create("DIV",{html:m});var k=a();k.setTitleBar(g.message("SEO_ROBOT_CRAWL_DELAY"));k.setContent(i);k.setButtons([new g.PopupWindowButton({text:g.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function(){var n=i.lastChild,o=[];if(n.value.length>0){o.push(["Crawl-delay",n.value])}j.setRules(o,"Crawl-delay");k.close()}}}),k.closeBtn]);k.show()}});d.push({name:"sitemap",compatible:["common"],text:g.message("SEO_ROBOT_ACTION_SITEMAP"),title:g.message("SEO_ROBOT_ACTION_SITEMAP_TITLE"),className:"adm-btn",callback:function(j){var l="http://"+g.message("SEO_HOST");var h=j.getRules("Host");if(h.length>0){l=h[0][1];if(!/^http[s]{0,1}:\/\//.test(l)){l="http://"+l}}var m=l+"/sitemap.xml";var n='<input type="text" value="'+g.util.htmlspecialchars(m)+'" class="seo-robots-settings-input">';var i=g.create("DIV",{html:n});var k=a();k.setTitleBar(g.message("SEO_ROBOT_ACTION_SITEMAP_URL"));k.setContent(i);k.setButtons([new g.PopupWindowButton({text:g.message("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function(){var o=i.lastChild;j.addRule(["Sitemap",o.value]);k.close()}}}),k.closeBtn]);k.show()}})})();