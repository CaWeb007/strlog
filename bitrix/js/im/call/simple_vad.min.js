(function(){if(BX.SimpleVAD){return}var b=0.1;var a=2000;BX.SimpleVAD=function(c){this.mediaStream=c.mediaStream;this.audioContext=null;this.mediaStreamNode=null;this.analyserNode=null;this.audioTimeDomainData=null;this.voiceState=false;this.measureInterval=0;this.inactivityTimeout=0;this.callbacks={voiceStarted:BX.type.isFunction(c.onVoiceStarted)?c.onVoiceStarted:BX.DoNothing,voiceStopped:BX.type.isFunction(c.onVoiceStopped)?c.onVoiceStopped:BX.DoNothing};if(BX.SimpleVAD.isSupported()){this.init()}};BX.SimpleVAD.isSupported=function(){return(window.AudioContext||window.webkitAudioContext)&&window.AnalyserNode&&typeof(window.AnalyserNode.prototype.getFloatTimeDomainData)==="function"};BX.SimpleVAD.prototype.init=function(){if(!(this.mediaStream instanceof MediaStream)){return false}this.audioContext=new (window.AudioContext||window.webkitAudioContext)();this.analyserNode=this.audioContext.createAnalyser();this.analyserNode.fftSize=128;this.mediaStreamNode=this.audioContext.createMediaStreamSource(this.mediaStream);this.mediaStreamNode.connect(this.analyserNode);this.audioTimeDomainData=new Float32Array(this.analyserNode.fftSize);this.measureInterval=setInterval(this.analyzeAudioStream.bind(this),100)};BX.SimpleVAD.prototype.analyzeAudioStream=function(){this.analyserNode.getFloatTimeDomainData(this.audioTimeDomainData);var c=this.getAverageVolume(this.audioTimeDomainData);this.setVoiceState(c>=b)};BX.SimpleVAD.prototype.setVoiceState=function(c){if(this.voiceState==c){return}if(c){this.callbacks.voiceStarted();clearTimeout(this.inactivityTimeout);this.inactivityTimeout=0;this.voiceState=true}else{if(!this.inactivityTimeout){this.inactivityTimeout=setTimeout(this.onInactivityTimeout.bind(this),a)}}};BX.SimpleVAD.prototype.onInactivityTimeout=function(){this.inactivityTimeout=0;this.voiceState=false;this.callbacks.voiceStopped()};BX.SimpleVAD.prototype.getAverageVolume=function(d){var e=0;for(var c=0;c<d.length;c++){e+=d[c]*d[c]}return Math.sqrt(e/d.length)};BX.SimpleVAD.prototype.destroy=function(){if(this.analyserNode){this.analyserNode.disconnect()}if(this.mediaStreamNode){this.mediaStreamNode.disconnect()}if(this.audioContext){this.audioContext.close()}clearInterval(this.measureInterval);this.analyserNode=null;this.mediaStreamNode=null;this.mediaStream=null;this.audioContext=null;this.callbacks={voiceStarted:BX.DoNothing,voiceStopped:BX.DoNothing}}})();