(function(a){if(BX.PopupWindowManager){return}BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(g,e,h){var i=g;if(BX.type.isPlainObject(g)&&!e&&!h){i=g.id;if(!BX.type.isNotEmptyString(i)){throw new Error("BX.PopupWindowManager: 'id' parameter is required.")}}var f=this.getPopupById(i);if(f===null){f=new BX.PopupWindow(g,e,h);BX.addCustomEvent(f,"onPopupShow",BX.delegate(this.onPopupShow,this));BX.addCustomEvent(f,"onPopupClose",BX.delegate(this.onPopupClose,this))}return f},onPopupWindowIsInitialized:function(f,e){BX.addCustomEvent(e,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this));this._popups.push(e)},onPopupShow:function(e){if(this._currentPopup!==null){this._currentPopup.close()}this._currentPopup=e},onPopupClose:function(e){this._currentPopup=null},onPopupDestroy:function(f){var e;if((e=this._getPopupIndex(f.uniquePopupId))!==-1){this._popups=BX.util.deleteFromArray(this._popups,e)}},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(e){return this._getPopupIndex(e)!==-1},isAnyPopupShown:function(){for(var e=0,f=this._popups.length;e<f;e++){if(this._popups[e].isShown()){return true}}return false},getPopupById:function(f){for(var e=0;e<this._popups.length;e++){if(this._popups[e].getId()===f){return this._popups[e]}}return null},_getPopupIndex:function(g){var e=-1;for(var f=0;f<this._popups.length;f++){if(this._popups[f].uniquePopupId===g){return f}}return e},getMaxZIndex:function(){var f=0,e;for(e=0;e<this._popups.length;e++){f=Math.max(f,this._popups[e].params.zIndex)}return f}};BX.addCustomEvent("onPopupWindowIsInitialized",BX.proxy(BX.PopupWindowManager.onPopupWindowIsInitialized,BX.PopupWindowManager));BX.PopupWindow=function(i,h,j){this.compatibleMode=j&&BX.type.isBoolean(j.compatibleMode)?j.compatibleMode:true;if(BX.type.isPlainObject(i)&&!h&&!j){j=i;i=j.id;h=j.bindElement;this.compatibleMode=false}j=j||{};this.params=j;if(!BX.type.isNotEmptyString(i)){i="popup-window-"+BX.util.getRandomString().toLowerCase()}BX.onCustomEvent("onPopupWindowInit",[i,h,j]);this.uniquePopupId=i;this.params.zIndex=BX.type.isNumber(j.zIndex)?parseInt(j.zIndex):0;this.params.zIndexAbsolute=BX.type.isNumber(j.zIndexAbsolute)?parseInt(j.zIndexAbsolute):0;this.buttons=j.buttons&&BX.type.isArray(j.buttons)?j.buttons:[];this.offsetTop=BX.PopupWindow.getOption("offsetTop");this.offsetLeft=BX.PopupWindow.getOption("offsetLeft");this.firstShow=false;this.bordersWidth=20;this.bindElementPos=null;this.closeIcon=null;this.resizeIcon=null;this.angle=null;this.overlay=null;this.titleBar=null;this.bindOptions=typeof(j.bindOptions)==="object"?j.bindOptions:{};this.autoHide=j.autoHide===true;this.autoHideHandler=BX.type.isFunction(j.autoHideHandler)?j.autoHideHandler:null;this.handleAutoHide=this.handleAutoHide.bind(this);this.handleOverlayClick=this.handleOverlayClick.bind(this);this.isAutoHideBinded=false;this.closeByEsc=j.closeByEsc===true;this.isCloseByEscBinded=false;this.cacheable=true;this.destroyed=false;this.width=null;this.height=null;this.minWidth=null;this.minHeight=null;this.maxWidth=null;this.maxHeight=null;this.padding=null;this.contentPadding=null;this.background=null;this.contentBackground=null;this.appendContainer=document.body;this.dragOptions={cursor:"",callback:BX.DoNothing,eventName:""};this.dragged=false;this.dragPageX=0;this.dragPageY=0;this.animationShowClassName=null;this.animationCloseClassName=null;this.animationCloseEventType=null;this.handleDocumentKeyUp=this.handleDocumentKeyUp.bind(this);this.handleResizeWindow=this.handleResizeWindow.bind(this);if(j.events){for(var g in j.events){BX.addCustomEvent(this,g,j.events[g])}}var f="popup-window";if(j.contentColor&&BX.type.isNotEmptyString(j.contentColor)){f+=" popup-window-content-"+j.contentColor}if(j.titleBar){f+=" popup-window-with-titlebar"}if(j.className&&BX.type.isNotEmptyString(j.className)){f+=" "+j.className}if(j.darkMode){f+=" popup-window-dark"}this.popupContainer=document.createElement("div");var e="popup-window-titlebar-"+i;if(j.titleBar){this.titleBar=BX.create("div",{props:{className:"popup-window-titlebar",id:e}})}if(j.closeIcon){this.closeIcon=BX.create("span",{props:{className:"popup-window-close-icon"+(j.titleBar?" popup-window-titlebar-close-icon":"")},style:(typeof(j.closeIcon)==="object"?j.closeIcon:{}),events:{click:BX.proxy(this.handleCloseIconClick,this)}});if(BX.browser.IsIE()){BX.adjust(this.closeIcon,{attrs:{hidefocus:"true"}})}}this.contentContainer=BX.create("div",{props:{id:"popup-window-content-"+i,className:"popup-window-content"}});BX.adjust(this.popupContainer,{props:{id:i,className:f},style:{zIndex:this.getZindex(),position:"absolute",display:"none",top:"0px",left:"0px"},children:[this.titleBar,this.contentContainer,this.closeIcon]});this.appendContainer.appendChild(this.popupContainer);this.buttonsContainer=null;if(j.angle){this.setAngle(j.angle)}if(j.overlay){this.setOverlay(j.overlay)}this.setOffset(j);this.setBindElement(h);this.setTitleBar(j.titleBar);this.setContent(j.content);this.setButtons(j.buttons);this.setWidth(j.width);this.setHeight(j.height);this.setMinWidth(j.minWidth);this.setMinHeight(j.minHeight);this.setMaxWidth(j.maxWidth);this.setMaxHeight(j.maxHeight);this.setResizeMode(j.resizable);this.setPadding(j.padding);this.setContentPadding(j.contentPadding);this.setBackground(j.background);this.setContentBackground(j.contentBackground);this.setAnimation(j.animation);this.setCacheable(j.cacheable);if(j.contentNoPaddings){this.setContentPadding(0)}if(j.noAllPaddings){this.setPadding(0);this.setContentPadding(0)}if(j.bindOnResize!==false){BX.bind(a,"resize",this.handleResizeWindow)}BX.onCustomEvent("onPopupWindowIsInitialized",[i,this])};BX.PopupWindow.prototype.getId=function(){return this.uniquePopupId};BX.PopupWindow.prototype.isCompatibleMode=function(){return this.compatibleMode};BX.PopupWindow.prototype.setContent=function(f){if(!this.contentContainer||!f){return}if(BX.type.isElementNode(f)){BX.cleanNode(this.contentContainer);var e=BX.type.isDomNode(f.parentNode);this.contentContainer.appendChild(f);if(this.isCompatibleMode()||e){f.style.display="block"}}else{if(BX.type.isString(f)){this.contentContainer.innerHTML=f}else{this.contentContainer.innerHTML="&nbsp;"}}};BX.PopupWindow.prototype.setButtons=function(h){this.buttons=h&&BX.type.isArray(h)?h:[];if(this.buttonsContainer){BX.remove(this.buttonsContainer)}if(this.buttons.length>0&&this.contentContainer){var e=[];for(var g=0;g<this.buttons.length;g++){var f=this.buttons[g];if(f instanceof BX.PopupWindowButton){f.popupWindow=this;e.push(f.render())}else{if(f instanceof BX.UI.Button){f.setContext(this);e.push(f.render())}}}this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:e}))}};BX.PopupWindow.prototype.getButtons=function(){return this.buttons};BX.PopupWindow.prototype.getButton=function(g){for(var f=0;f<this.buttons.length;f++){var e=this.buttons[f];if(e.getId()===g){return e}}return null};BX.PopupWindow.prototype.setBindElement=function(e){if(e===null){this.bindElement=null}else{if(typeof(e)==="object"){if(BX.type.isDomNode(e)||(BX.type.isNumber(e.top)&&BX.type.isNumber(e.left))){this.bindElement=e}else{if(BX.type.isNumber(e.clientX)&&BX.type.isNumber(e.clientY)){BX.fixEventPageXY(e);this.bindElement={left:e.pageX,top:e.pageY,bottom:e.pageY}}}}}};BX.PopupWindow.prototype.getBindElementPos=function(e){if(BX.type.isDomNode(e)){return BX.pos(e,false)}else{if(e&&typeof(e)==="object"){if(!BX.type.isNumber(e.bottom)){e.bottom=e.top}return e}else{var f=BX.GetWindowInnerSize();var i=BX.GetWindowScrollPos();var g=this.getPopupContainer().offsetWidth;var h=this.getPopupContainer().offsetHeight;this.bindOptions.forceTop=true;return{left:f.innerWidth/2-g/2+i.scrollLeft,top:f.innerHeight/2-h/2+i.scrollTop,bottom:f.innerHeight/2-h/2+i.scrollTop,windowSize:f,windowScroll:i,popupWidth:g,popupHeight:h}}}};BX.PopupWindow.prototype.setAngle=function(f){if(f===false){if(this.angle!==null){BX.remove(this.angle.element)}this.angle=null;return}var k="popup-window-angly";if(this.angle===null){var h=this.bindOptions.position&&this.bindOptions.position==="top"?"bottom":"top";var m=BX.PopupWindow.getOption(h==="top"?"angleMinTop":"angleMinBottom");var i=BX.type.isNumber(f.offset)?f.offset:0;var l=BX.PopupWindow.getOption("angleLeftOffset",null);if(i>0&&BX.type.isNumber(l)){i+=l-BX.PopupWindow.defaultOptions.angleLeftOffset}this.angle={element:BX.create("div",{props:{className:k+" "+k+"-"+h}}),position:h,offset:0,defaultOffset:Math.max(i,m)};this.getPopupContainer().appendChild(this.angle.element)}if(typeof(f)==="object"&&f.position&&BX.util.in_array(f.position,["top","right","bottom","left","hide"])){BX.removeClass(this.angle.element,k+"-"+this.angle.position);BX.addClass(this.angle.element,k+"-"+f.position);this.angle.position=f.position}if(typeof(f)==="object"&&BX.type.isNumber(f.offset)){var g=f.offset;var j,e;if(this.angle.position==="top"){j=BX.PopupWindow.getOption("angleMinTop");e=this.getPopupContainer().offsetWidth-BX.PopupWindow.getOption("angleMaxTop");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.left=this.angle.offset+"px";this.angle.element.style.marginLeft=0;this.angle.element.style.removeProperty("top")}else{if(this.angle.position==="bottom"){j=BX.PopupWindow.getOption("angleMinBottom");e=this.getPopupContainer().offsetWidth-BX.PopupWindow.getOption("angleMaxBottom");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.marginLeft=this.angle.offset+"px";this.angle.element.style.left=0;this.angle.element.style.removeProperty("top")}else{if(this.angle.position==="right"){j=BX.PopupWindow.getOption("angleMinRight");e=this.getPopupContainer().offsetHeight-BX.PopupWindow.getOption("angleMaxRight");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.top=this.angle.offset+"px";this.angle.element.style.removeProperty("left");this.angle.element.style.removeProperty("margin-left")}else{if(this.angle.position==="left"){j=BX.PopupWindow.getOption("angleMinLeft");e=this.getPopupContainer().offsetHeight-BX.PopupWindow.getOption("angleMaxLeft");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.top=this.angle.offset+"px";this.angle.element.style.removeProperty("left");this.angle.element.style.removeProperty("margin-left")}}}}}};BX.PopupWindow.prototype.getWidth=function(){return this.width};BX.PopupWindow.prototype.setWidth=function(e){this.setWidthProperty("width",e)};BX.PopupWindow.prototype.getHeight=function(){return this.height};BX.PopupWindow.prototype.setHeight=function(e){this.setHeightProperty("height",e)};BX.PopupWindow.prototype.getMinWidth=function(){return this.minWidth};BX.PopupWindow.prototype.setMinWidth=function(e){this.setWidthProperty("minWidth",e)};BX.PopupWindow.prototype.getMinHeight=function(){return this.minHeight};BX.PopupWindow.prototype.setMinHeight=function(e){this.setHeightProperty("minHeight",e)};BX.PopupWindow.prototype.getMaxWidth=function(){return this.maxWidth};BX.PopupWindow.prototype.setMaxWidth=function(e){this.setWidthProperty("maxWidth",e)};BX.PopupWindow.prototype.getMaxHeight=function(){return this.maxHeight};BX.PopupWindow.prototype.setMaxHeight=function(e){this.setHeightProperty("maxHeight",e)};BX.PopupWindow.prototype.setWidthProperty=function(h,f){var e=["width","minWidth","maxWidth"];if(e.indexOf(h)===-1){return}if(BX.type.isNumber(f)&&f>=0){this[h]=f;this.getResizableContainer().style[h]=f+"px";this.getContentContainer().style.overflowX="auto";this.getPopupContainer().classList.add("popup-window-fixed-width");if(this.getTitleContainer()&&BX.browser.IsIE11()){this.getTitleContainer().style[h]=f+"px"}}else{if(f===null||f===false){this[h]=null;this.getResizableContainer().style.removeProperty(BX.util.getCssName(h));var g=e.some(function(i){return this.getResizableContainer().style.getPropertyValue(BX.util.getCssName(i))!==""},this);if(!g){this.getContentContainer().style.removeProperty("overflow-x");this.getPopupContainer().classList.remove("popup-window-fixed-width")}if(this.getTitleContainer()&&BX.browser.IsIE11()){this.getTitleContainer().style.removeProperty(BX.util.getCssName(h))}}}};BX.PopupWindow.prototype.setHeightProperty=function(h,e){var f=["height","minHeight","maxHeight"];if(f.indexOf(h)===-1){return}if(BX.type.isNumber(e)&&e>=0){this[h]=e;this.getResizableContainer().style[h]=e+"px";this.getContentContainer().style.overflowY="auto";this.getPopupContainer().classList.add("popup-window-fixed-height")}else{if(e===null||e===false){this[h]=null;this.getResizableContainer().style.removeProperty(BX.util.getCssName(h));var g=f.some(function(i){return this.getResizableContainer().style.getPropertyValue(BX.util.getCssName(i))!==""},this);if(!g){this.getContentContainer().style.removeProperty("overflow-y");this.getPopupContainer().classList.remove("popup-window-fixed-height")}}}};BX.PopupWindow.prototype.setPadding=function(e){if(BX.type.isNumber(e)&&e>=0){this.padding=e;this.getPopupContainer().style.padding=e+"px"}else{if(e===null){this.padding=null;this.getPopupContainer().style.removeProperty("padding")}}};BX.PopupWindow.prototype.getPadding=function(){return this.padding};BX.PopupWindow.prototype.setContentPadding=function(e){if(BX.type.isNumber(e)&&e>=0){this.contentPadding=e;this.getContentContainer().style.padding=e+"px"}else{if(e===null){this.contentPadding=null;this.getContentContainer().style.removeProperty("padding")}}};BX.PopupWindow.prototype.getContentPadding=function(){return this.contentPadding};BX.PopupWindow.prototype.setBackground=function(e){if(BX.type.isNotEmptyString(e)){this.background=e;this.getPopupContainer().style.background=e}else{if(e===null){this.background=null;this.getPopupContainer().style.removeProperty("background")}}};BX.PopupWindow.prototype.getBackground=function(){return this.background};BX.PopupWindow.prototype.setContentBackground=function(e){if(BX.type.isNotEmptyString(e)){this.contentBackground=e;this.getContentContainer().style.background=e}else{if(e===null){this.contentBackground=null;this.getContentContainer().style.removeProperty("background")}}};BX.PopupWindow.prototype.getContentBackground=function(){return this.contentBackground};BX.PopupWindow.prototype.isDestroyed=function(){return this.destroyed};BX.PopupWindow.prototype.setCacheable=function(e){this.cacheable=e!==false};BX.PopupWindow.prototype.isCacheable=function(){return this.cacheable};BX.PopupWindow.prototype.setResizeMode=function(e){if(e===true||BX.type.isPlainObject(e)){if(!this.resizeIcon){this.resizeIcon=BX.create("div",{props:{className:"popup-window-resize"},events:{mousedown:BX.proxy(this.onResizeMouseDown,this)}});this.getPopupContainer().appendChild(this.resizeIcon)}this.setMinWidth(e.minWidth);this.setMinHeight(e.minHeight)}else{if(e===false&&this.resizeIcon){BX.remove(this.resizeIcon);this.resizeIcon=null}}};BX.PopupWindow.prototype.getPopupContainer=function(){return this.popupContainer};BX.PopupWindow.prototype.getContentContainer=function(){return this.contentContainer};BX.PopupWindow.prototype.getResizableContainer=function(){return BX.browser.IsIE11()?this.getContentContainer():this.getPopupContainer()};BX.PopupWindow.prototype.getTitleContainer=function(){return this.titleBar};BX.PopupWindow.prototype.onTitleMouseDown=function(e){this._startDrag(e,{cursor:"move",callback:BX.proxy(this.move,this),eventName:"Drag"})};BX.PopupWindow.prototype.onResizeMouseDown=function(e){this._startDrag(e,{cursor:"nwse-resize",eventName:"Resize",callback:BX.proxy(this._resize,this)});this.resizeContentPos=BX.pos(this.getResizableContainer());this.resizeContentOffset=this.resizeContentPos.left-BX.pos(this.getPopupContainer()).left};BX.PopupWindow.prototype._resize=function(f,k,j,h){var i=j-this.resizeContentPos.left;var e=h-this.resizeContentPos.top;var g=BX.GetWindowScrollSize().scrollWidth;if(this.resizeContentPos.left+i+this.resizeContentOffset>=g){i=g-this.resizeContentPos.left-this.resizeContentOffset}i=Math.max(i,this.getMinWidth());e=Math.max(e,this.getMinHeight());if(this.getMaxWidth()!==null){i=Math.min(i,this.getMaxWidth())}if(this.getMaxHeight()!==null){e=Math.min(e,this.getMaxHeight())}this.setWidth(i);this.setHeight(e)};BX.PopupWindow.prototype.isTopAngle=function(){return this.angle!==null&&this.angle.position==="top"};BX.PopupWindow.prototype.isBottomAngle=function(){return this.angle!==null&&this.angle.position==="bottom"};BX.PopupWindow.prototype.isTopOrBottomAngle=function(){return this.angle!==null&&BX.util.in_array(this.angle.position,["top","bottom"])};BX.PopupWindow.prototype.getAngleHeight=function(){return(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleTopOffset"):0)};BX.PopupWindow.prototype.setOffset=function(e){if(!BX.type.isPlainObject(e)){return}if(BX.type.isNumber(e.offsetLeft)){this.offsetLeft=e.offsetLeft+BX.PopupWindow.getOption("offsetLeft")}if(BX.type.isNumber(e.offsetTop)){this.offsetTop=e.offsetTop+BX.PopupWindow.getOption("offsetTop")}};BX.PopupWindow.prototype.setTitleBar=function(e){if(!this.titleBar){return}if(typeof(e)==="object"&&BX.type.isDomNode(e.content)){this.titleBar.innerHTML="";this.titleBar.appendChild(e.content)}else{if(typeof(e)==="string"){this.titleBar.innerHTML="";this.titleBar.appendChild(BX.create("span",{props:{className:"popup-window-titlebar-text"},text:e}))}}if(this.params.draggable){this.titleBar.style.cursor="move";BX.bind(this.titleBar,"mousedown",BX.proxy(this.onTitleMouseDown,this))}};BX.PopupWindow.prototype.setClosingByEsc=function(e){e=BX.type.isBoolean(e)?e:true;if(e){this.closeByEsc=true;this.bindClosingByEsc()}else{this.closeByEsc=false;this.unbindClosingByEsc()}};BX.PopupWindow.prototype.bindClosingByEsc=function(){if(this.closeByEsc&&!this.isCloseByEscBinded){BX.bind(document,"keyup",this.handleDocumentKeyUp);this.isCloseByEscBinded=true}};BX.PopupWindow.prototype.unbindClosingByEsc=function(){if(this.isCloseByEscBinded){BX.unbind(document,"keyup",this.handleDocumentKeyUp);this.isCloseByEscBinded=false}};BX.PopupWindow.prototype.setAutoHide=function(e){e=BX.type.isBoolean(e)?e:true;if(e){this.autoHide=true;this.bindAutoHide()}else{this.autoHide=false;this.unbindAutoHide()}};BX.PopupWindow.prototype.bindAutoHide=function(){if(this.autoHide&&!this.isAutoHideBinded&&this.isShown()){this.isAutoHideBinded=true;if(this.isCompatibleMode()){BX.bind(this.getPopupContainer(),"click",this.cancelBubble)}if(this.overlay&&this.overlay.element){BX.bind(this.overlay.element,"click",this.handleOverlayClick)}else{if(this.isCompatibleMode()){BX.bind(document,"click",this.handleAutoHide)}else{document.addEventListener("click",this.handleAutoHide,true)}}}};BX.PopupWindow.prototype.unbindAutoHide=function(){if(this.isAutoHideBinded){this.isAutoHideBinded=false;if(this.isCompatibleMode()){BX.unbind(this.getPopupContainer(),"click",this.cancelBubble)}if(this.overlay&&this.overlay.element){BX.unbind(this.overlay.element,"click",this.handleOverlayClick)}else{if(this.isCompatibleMode()){BX.unbind(document,"click",this.handleAutoHide)}else{document.removeEventListener("click",this.handleAutoHide,true)}}}};BX.PopupWindow.prototype.handleAutoHide=function(e){if(this.isDestroyed()){return}if(this.autoHideHandler!==null){if(this.autoHideHandler(e)){this._tryCloseByEvent(e)}}else{if(e.target!==this.getPopupContainer()&&!this.getPopupContainer().contains(e.target)){this._tryCloseByEvent(e)}}};BX.PopupWindow.prototype._tryCloseByEvent=function(e){if(this.isCompatibleMode()){this.tryCloseByEvent(e)}else{setTimeout(BX.proxy(this.tryCloseByEvent,this),0,e)}};BX.PopupWindow.prototype.handleOverlayClick=function(e){this.tryCloseByEvent(e);e.stopPropagation()};BX.PopupWindow.prototype.setOverlay=function(e){if(this.overlay===null){this.overlay={element:BX.create("div",{props:{className:"popup-window-overlay",id:"popup-window-overlay-"+this.uniquePopupId}})};this.adjustOverlayZindex();this.resizeOverlay();this.appendContainer.appendChild(this.overlay.element)}if(e&&e.hasOwnProperty("opacity")&&BX.type.isNumber(e.opacity)&&e.opacity>=0&&e.opacity<=100){if(BX.browser.IsIE()&&!BX.browser.IsIE9()){this.overlay.element.style.filter="alpha(opacity="+e.opacity+")"}else{this.overlay.element.style.filter="none";this.overlay.element.style.opacity=parseFloat(e.opacity/100).toPrecision(3)}}if(e&&e.backgroundColor){this.overlay.element.style.backgroundColor=e.backgroundColor}};BX.PopupWindow.prototype.removeOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){BX.remove(this.overlay.element)}if(this.overlayTimeout){clearInterval(this.overlayTimeout);this.overlayTimeout=null}this.overlay=null};BX.PopupWindow.prototype.hideOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){if(this.overlayTimeout){clearInterval(this.overlayTimeout);this.overlayTimeout=null}this.overlay.element.style.display="none"}};BX.PopupWindow.prototype.showOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){this.overlay.element.style.display="block";var e=this.getPopupContainer().offsetHeight;this.overlayTimeout=setInterval(function(){if(e!==this.getPopupContainer().offsetHeight){this.resizeOverlay();e=this.getPopupContainer().offsetHeight}}.bind(this),1000)}};BX.PopupWindow.prototype.resizeOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){var e=BX.GetWindowScrollSize();var f=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);this.overlay.element.style.width=e.scrollWidth+"px";this.overlay.element.style.height=f+"px"}};BX.PopupWindow.prototype.getZindex=function(){if(this.overlay!==null){return(this.params.zIndexAbsolute>0?this.params.zIndexAbsolute:BX.PopupWindow.getOption("popupOverlayZindex")+this.params.zIndex)}else{return(this.params.zIndexAbsolute>0?this.params.zIndexAbsolute:BX.PopupWindow.getOption("popupZindex")+this.params.zIndex)}};BX.PopupWindow.prototype.adjustOverlayZindex=function(){if(this.overlay!==null&&this.overlay.element!==null){this.overlay.element.style.zIndex=parseInt(this.getPopupContainer().style.zIndex)-1}};BX.PopupWindow.prototype.show=function(){if(this.isShown()||this.isDestroyed()){return}if(!this.firstShow){BX.onCustomEvent(this,"onPopupFirstShow",[this]);this.firstShow=true}BX.onCustomEvent(this,"onPopupShow",[this]);this.showOverlay();this.getPopupContainer().style.display="block";this.adjustPosition();this.animateOpening(function(){if(this.isDestroyed()){return}BX.removeClass(this.getPopupContainer(),this.animationShowClassName);BX.onCustomEvent(this,"onAfterPopupShow",[this])}.bind(this));this.bindClosingByEsc();if(this.isCompatibleMode()){setTimeout(function(){this.bindAutoHide()}.bind(this),100)}else{this.bindAutoHide()}};BX.PopupWindow.prototype.animateOpening=function(g){BX.removeClass(this.getPopupContainer(),this.animationCloseClassName);if(this.animationShowClassName!==null){BX.addClass(this.getPopupContainer(),this.animationShowClassName);if(this.animationCloseEventType!==null){var e=this.animationCloseEventType+"end";this.getPopupContainer().addEventListener(e,function f(){this.removeEventListener(e,f);g()})}else{g()}}else{g()}};BX.PopupWindow.prototype.animateClosing=function(g){BX.removeClass(this.getPopupContainer(),this.animationShowClassName);if(this.animationCloseClassName!==null){BX.addClass(this.getPopupContainer(),this.animationCloseClassName);if(this.animationCloseEventType!==null){var e=this.animationCloseEventType+"end";this.getPopupContainer().addEventListener(e,function f(){this.removeEventListener(e,f);g()})}else{g()}}else{g()}};BX.PopupWindow.prototype.isShown=function(){return !this.isDestroyed()&&this.getPopupContainer().style.display==="block"};BX.PopupWindow.prototype.cancelBubble=function(e){e=e||a.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}};BX.PopupWindow.prototype.close=function(){if(this.isDestroyed()||!this.isShown()){return}BX.onCustomEvent(this,"onPopupClose",[this]);if(this.isDestroyed()){return}this.animateClosing(function(){if(this.isDestroyed()){return}this.hideOverlay();this.getPopupContainer().style.display="none";BX.removeClass(this.getPopupContainer(),this.animationCloseClassName);this.unbindClosingByEsc();if(this.isCompatibleMode()){setTimeout(function(){this.unbindAutoHide()}.bind(this),0)}else{this.unbindAutoHide()}BX.onCustomEvent(this,"onPopupAfterClose",[this]);if(!this.isCacheable()){this.destroy()}}.bind(this))};BX.PopupWindow.prototype.toggle=function(){this.isShown()?this.close():this.show()};BX.PopupWindow.prototype.tryCloseByEvent=function(e){if(this.isLeftButton(e)){this.close()}};BX.PopupWindow.prototype.setAnimation=function(e){if(BX.type.isPlainObject(e)){this.animationShowClassName=BX.type.isNotEmptyString(e.showClassName)?e.showClassName:null;this.animationCloseClassName=BX.type.isNotEmptyString(e.closeClassName)?e.closeClassName:null;this.animationCloseEventType=BX.util.in_array(e.closeAnimationType,["animation","transition"])?e.closeAnimationType:null}else{if(BX.type.isNotEmptyString(e)){var f=e;if(f==="fading"){this.animationShowClassName="popup-window-show-animation-opacity";this.animationCloseClassName="popup-window-close-animation-opacity";this.animationCloseEventType="animation"}else{if(f==="fading-slide"){this.animationShowClassName="popup-window-show-animation-opacity-transform";this.animationCloseClassName="popup-window-close-animation-opacity";this.animationCloseEventType="animation"}else{if(f==="scale"){this.animationShowClassName="popup-window-show-animation-scale";this.animationCloseClassName="popup-window-close-animation-opacity";this.animationCloseEventType="animation"}}}}else{if(e===false||e===null){this.animationShowClassName=null;this.animationCloseClassName=null;this.animationCloseEventType=null}}}};BX.PopupWindow.prototype.handleCloseIconClick=function(e){this.tryCloseByEvent(e);e.stopPropagation()};BX.PopupWindow.prototype.isLeftButton=function(e){return e.button===0};BX.PopupWindow.prototype.handleDocumentKeyUp=function(e){e=e||a.event;if(e.keyCode===27){b(this.getZindex(),BX.proxy(this.close,this))}};BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]);this.destroyed=true;this.unbindClosingByEsc();if(this.isCompatibleMode()){setTimeout(function(){this.unbindAutoHide()}.bind(this),0)}else{this.unbindAutoHide()}BX.unbindAll(this);BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));BX.unbind(a,"resize",this.handleResizeWindow);BX.remove(this.popupContainer);this.removeOverlay();this.popupContainer=null;this.contentContainer=null;this.closeIcon=null;this.titleBar=null;this.buttonsContainer=null;this.angle=null;this.resizeIcon=null};BX.PopupWindow.prototype.enterFullScreen=function(){if(BX.PopupWindow.fullscreenStatus){if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}}else{if(BX.browser.IsChrome()||BX.browser.IsSafari()){this.contentContainer.webkitRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT);BX.bind(a,"webkitfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this))}else{if(BX.browser.IsFirefox()){this.contentContainer.mozRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT);BX.bind(a,"mozfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this))}}}};BX.PopupWindow.prototype.eventFullScreen=function(e){if(BX.PopupWindow.fullscreenStatus){if(BX.browser.IsChrome()||BX.browser.IsSafari()){BX.unbind(a,"webkitfullscreenchange",this.fullscreenBind)}else{if(BX.browser.IsFirefox()){BX.unbind(a,"mozfullscreenchange",this.fullscreenBind)}}BX.removeClass(this.contentContainer,"popup-window-fullscreen",[this.contentContainer]);BX.PopupWindow.fullscreenStatus=false;BX.onCustomEvent(this,"onPopupFullscreenLeave");this.adjustPosition()}else{BX.addClass(this.contentContainer,"popup-window-fullscreen");BX.PopupWindow.fullscreenStatus=true;BX.onCustomEvent(this,"onPopupFullscreenEnter",[this.contentContainer]);this.adjustPosition()}};BX.PopupWindow.prototype.adjustPosition=function(m){if(m&&typeof(m)==="object"){this.bindOptions=m}var g=this.getBindElementPos(this.bindElement);if(!this.bindOptions.forceBindPosition&&this.bindElementPos!==null&&g.top===this.bindElementPos.top&&g.left===this.bindElementPos.left){return}this.bindElementPos=g;var k=g.windowSize?g.windowSize:BX.GetWindowInnerSize();var n=g.windowScroll?g.windowScroll:BX.GetWindowScrollPos();var j=g.popupWidth?g.popupWidth:this.popupContainer.offsetWidth;var h=g.popupHeight?g.popupHeight:this.popupContainer.offsetHeight;var l=BX.PopupWindow.getOption("angleTopOffset");var f=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&(f+j+this.bordersWidth)>=(k.innerWidth+n.scrollLeft)&&(k.innerWidth+n.scrollLeft-j-this.bordersWidth)>0){var e=f;f=k.innerWidth+n.scrollLeft-j-this.bordersWidth;if(this.isTopOrBottomAngle()){this.setAngle({offset:e-f+this.angle.defaultOffset})}}else{if(this.isTopOrBottomAngle()){this.setAngle({offset:this.angle.defaultOffset+(f<0?f:0)})}}if(f<0){f=0}var i=0;if(this.bindOptions.position&&this.bindOptions.position==="top"){i=this.bindElementPos.top-h-this.offsetTop-(this.isBottomAngle()?l:0);if(i<0||(!this.bindOptions.forceTop&&i<n.scrollTop)){i=this.bindElementPos.bottom+this.offsetTop;if(this.angle!==null){i+=l;this.setAngle({position:"top"})}}else{if(this.isTopAngle()){i=i-l+BX.PopupWindow.getOption("positionTopXOffset");this.setAngle({position:"bottom"})}else{i+=BX.PopupWindow.getOption("positionTopXOffset")}}}else{i=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight();if(!this.bindOptions.forceTop&&(i+h)>(k.innerHeight+n.scrollTop)&&(this.bindElementPos.top-h-this.getAngleHeight())>=0){i=this.bindElementPos.top-h;if(this.isTopOrBottomAngle()){i-=l;this.setAngle({position:"bottom"})}i+=BX.PopupWindow.getOption("positionTopXOffset")}else{if(this.isBottomAngle()){i+=l;this.setAngle({position:"top"})}}}if(i<0){i=0}BX.adjust(this.popupContainer,{style:{top:i+"px",left:f+"px",zIndex:this.getZindex()}});this.adjustOverlayZindex()};BX.PopupWindow.prototype.handleResizeWindow=function(e){if(this.isShown()){this.adjustPosition();if(this.overlay!==null){this.resizeOverlay()}}};BX.PopupWindow.prototype.move=function(k,j,i,g){var f=parseInt(this.popupContainer.style.left)+k;var l=parseInt(this.popupContainer.style.top)+j;if(typeof(this.params.draggable)==="object"&&this.params.draggable.restrict){if(f<0){f=0}var e=BX.GetWindowScrollSize();var m=this.popupContainer.offsetWidth;var h=this.popupContainer.offsetHeight;if(f>(e.scrollWidth-m)){f=e.scrollWidth-m}if(l>(e.scrollHeight-h)){l=e.scrollHeight-h}if(l<0){l=0}}this.popupContainer.style.left=f+"px";this.popupContainer.style.top=l+"px"};BX.PopupWindow.prototype._startDrag=function(f,e){f=f||a.event;BX.fixEventPageXY(f);e=e||{};if(BX.type.isNotEmptyString(e.cursor)){this.dragOptions.cursor=e.cursor}if(BX.type.isNotEmptyString(e.eventName)){this.dragOptions.eventName=e.eventName}if(BX.type.isFunction(e.callback)){this.dragOptions.callback=e.callback}this.dragPageX=f.pageX;this.dragPageY=f.pageY;this.dragged=false;BX.bind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.bind(document,"mouseup",BX.proxy(this._stopDrag,this));if(document.body.setCapture){document.body.setCapture()}document.body.ondrag=BX.False;document.body.onselectstart=BX.False;document.body.style.cursor=this.dragOptions.cursor;document.body.style.MozUserSelect="none";this.popupContainer.style.MozUserSelect="none";return BX.PreventDefault(f)};BX.PopupWindow.prototype._moveDrag=function(e){e=e||a.event;BX.fixEventPageXY(e);if(this.dragPageX===e.pageX&&this.dragPageY===e.pageY){return}this.dragOptions.callback(e.pageX-this.dragPageX,e.pageY-this.dragPageY,e.pageX,e.pageY);this.dragPageX=e.pageX;this.dragPageY=e.pageY;if(!this.dragged){BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName+"Start",[this]);this.dragged=true}BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName,[this])};BX.PopupWindow.prototype._stopDrag=function(e){if(document.body.releaseCapture){document.body.releaseCapture()}BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));document.body.ondrag=null;document.body.onselectstart=null;document.body.style.cursor="";document.body.style.MozUserSelect="";this.popupContainer.style.MozUserSelect="";BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName+"End",[this]);this.dragged=false;return BX.PreventDefault(e)};BX.PopupWindow.options={};BX.PopupWindow.defaultOptions={angleLeftOffset:40,positionTopXOffset:-11,angleTopOffset:10,popupZindex:1000,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:30,angleMinRight:10,angleMaxRight:30,angleMinBottom:23,angleMaxBottom:25,angleMinTop:23,angleMaxTop:25,offsetLeft:0,offsetTop:0};BX.PopupWindow.setOptions=function(e){if(!e||typeof(e)!=="object"){return}for(var f in e){BX.PopupWindow.options[f]=e[f]}};BX.PopupWindow.getOption=function(f,e){if(typeof(BX.PopupWindow.options[f])!=="undefined"){return BX.PopupWindow.options[f]}else{if(typeof(e)!=="undefined"){return e}else{return BX.PopupWindow.defaultOptions[f]}}};BX.PopupWindowButton=function(f){this.popupWindow=null;this.params=f||{};this.text=this.params.text||"";this.id=this.params.id||"";this.className=this.params.className||"";this.events=this.params.events||{};this.contextEvents={};for(var e in this.events){this.contextEvents[e]=BX.proxy(this.events[e],this)}this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})};BX.PopupWindowButton.prototype.render=function(){return this.buttonNode};BX.PopupWindowButton.prototype.getId=function(){return this.id};BX.PopupWindowButton.prototype.getName=function(){return this.name};BX.PopupWindowButton.prototype.getContainer=function(){return this.buttonNode};BX.PopupWindowButton.prototype.setName=function(e){this.text=e||"";if(this.buttonNode){BX.cleanNode(this.buttonNode);BX.adjust(this.buttonNode,{text:this.text})}};BX.PopupWindowButton.prototype.setClassName=function(e){if(this.buttonNode){if(BX.type.isString(this.className)&&(this.className!=="")){BX.removeClass(this.buttonNode,this.className)}BX.addClass(this.buttonNode,e)}this.className=e};BX.PopupWindowButton.prototype.addClassName=function(e){if(this.buttonNode){BX.addClass(this.buttonNode,e);this.className=this.buttonNode.className}};BX.PopupWindowButton.prototype.removeClassName=function(e){if(this.buttonNode){BX.removeClass(this.buttonNode,e);this.className=this.buttonNode.className}};BX.PopupWindowButtonLink=function(e){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments);this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},text:this.text,events:this.contextEvents})};BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton);BX.PopupWindowCustomButton=function(e){BX.PopupWindowCustomButton.superclass.constructor.apply(this,arguments);this.buttonNode=BX.create("span",{props:{className:(this.className.length>0?this.className:""),id:this.id},events:this.contextEvents,text:this.text})};BX.extend(BX.PopupWindowCustomButton,BX.PopupWindowButton);BX.PopupMenu={Data:{},currentItem:null,show:function(e){if(this.currentItem!==null){this.currentItem.popupWindow.close()}this.currentItem=this.create.apply(this,arguments);this.currentItem.popupWindow.show()},create:function(f){var i=null;var e=arguments[1];var g=arguments[2];var h=arguments[3];if(BX.type.isPlainObject(f)&&!e&&!g&&!h){i=f.id;if(!BX.type.isNotEmptyString(i)){throw new Error("BX.PopupMenu.create: 'id' parameter is required.")}}else{i=f}if(!this.Data[i]){this.Data[i]=new BX.PopupMenuWindow(f,e,g,h);BX.addCustomEvent(this.Data[i],"onPopupMenuDestroy",this.onPopupDestroy.bind(this))}return this.Data[i]},getCurrentMenu:function(){return this.currentItem},getMenuById:function(e){return this.Data[e]?this.Data[e]:null},onPopupDestroy:function(e){this.destroy(e.id)},destroy:function(f){var e=this.getMenuById(f);if(e){if(this.currentItem===e){this.currentItem=null}e.popupWindow.destroy();delete this.Data[f]}}};BX.PopupMenuWindow=function(j,e,g,h){if(BX.type.isPlainObject(j)&&!e&&!g&&!h){h=j;h.compatibleMode=false;j=h.id;e=h.bindElement;g=h.items;if(!BX.type.isNotEmptyString(j)){j="menu-popup-"+BX.util.getRandomString().toLowerCase()}}this.id=j;this.bindElement=e;this.menuItems=[];this.itemsContainer=null;this.params=h&&typeof(h)==="object"?h:{};this.parentMenuWindow=null;this.parentMenuItem=null;if(g&&BX.type.isArray(g)){for(var f=0;f<g.length;f++){this.addMenuItemInternal(g[f],null)}}this.layout={menuContainer:null,itemsContainer:null};this.popupWindow=this.__createPopup()};BX.PopupMenuWindow.prototype.__createPopup=function(){var f=[];for(var j=0;j<this.menuItems.length;j++){var m=this.menuItems[j];var l=m.getLayout();f.push(l.item)}var g={closeByEsc:false,angle:false,autoHide:true,offsetTop:1,offsetLeft:0,animation:"fading"};var n=BX.mergeEx(g,this.params);n.noAllPaddings=true;n.darkMode=false;n.autoHideHandler=this.handleAutoHide.bind(this);n.content=(this.layout.menuContainer=BX.create("div",{props:{className:"menu-popup"},children:[(this.layout.itemsContainer=this.itemsContainer=BX.create("div",{props:{className:"menu-popup-items"},children:f}))]}));n.events={onPopupClose:this.onMenuWindowClose.bind(this),onPopupDestroy:this.onMenuWindowDestroy.bind(this)};var e=n.compatibleMode===false?this.getId():"menu-popup-"+this.getId();var h=new BX.PopupWindow(e,this.bindElement,n);if(this.params&&this.params.events){for(var k in this.params.events){if(this.params.events.hasOwnProperty(k)){BX.addCustomEvent(h,k,this.params.events[k])}}}return h};BX.PopupMenuWindow.prototype.getPopupWindow=function(){return this.popupWindow};BX.PopupMenuWindow.prototype.show=function(){BX.onCustomEvent(this,"onPopupMenuShow",[this]);this.getPopupWindow().show()};BX.PopupMenuWindow.prototype.close=function(){BX.onCustomEvent(this,"onPopupMenuClose",[this]);this.getPopupWindow().close()};BX.PopupMenuWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupMenuDestroy",[this]);this.getPopupWindow().destroy()};BX.PopupMenuWindow.prototype.toggle=function(){if(this.getPopupWindow().isShown()){this.close()}else{this.show()}};BX.PopupMenuWindow.prototype.getId=function(){return this.id};BX.PopupMenuWindow.prototype.onMenuWindowClose=function(){for(var e=0;e<this.menuItems.length;e++){var f=this.menuItems[e];f.closeSubMenu()}};BX.PopupMenuWindow.prototype.onMenuWindowDestroy=function(){for(var e=0;e<this.menuItems.length;e++){var f=this.menuItems[e];f.destroySubMenu()}};BX.PopupMenuWindow.prototype.handleAutoHide=function(e){return !this.containsTarget(e.target)};BX.PopupMenuWindow.prototype.containsTarget=function(f){var e=this.getPopupWindow().getPopupContainer();if(this.getPopupWindow().isShown()&&(f===e||e.contains(f))){return true}return this.getMenuItems().some(function(g){return g.getSubMenu()&&g.getSubMenu().containsTarget(f)})};BX.PopupMenuWindow.prototype.setParentMenuWindow=function(e){if(e instanceof BX.PopupMenuWindow){this.parentMenuWindow=e}};BX.PopupMenuWindow.prototype.getParentMenuWindow=function(){return this.parentMenuWindow};BX.PopupMenuWindow.prototype.getRootMenuWindow=function(){var e=null;var f=this.getParentMenuWindow();while(f!==null){e=f;f=f.getParentMenuWindow()}return e};BX.PopupMenuWindow.prototype.setParentMenuItem=function(e){if(e instanceof BX.PopupMenuItem){this.parentMenuItem=e}};BX.PopupMenuWindow.prototype.getParentMenuItem=function(){return this.parentMenuItem};BX.PopupMenuWindow.prototype.addMenuItem=function(e,j){var g=this.addMenuItemInternal(e,j);if(!g){return null}var f=g.getLayout();var i=this.getMenuItem(j);if(i!==null){var h=i.getLayout();this.itemsContainer.insertBefore(f.item,h.item)}else{this.itemsContainer.appendChild(f.item)}return g};BX.PopupMenuWindow.prototype.addMenuItemInternal=function(f,h){if(!f||(!f.delimiter&&!BX.type.isNotEmptyString(f.text))||(f.id&&this.getMenuItem(f.id)!==null)){return null}if(BX.type.isNumber(this.params.menuShowDelay)){f.menuShowDelay=this.params.menuShowDelay}var g=new BX.PopupMenuItem(f);g.setMenuWindow(this);var e=this.getMenuItemPosition(h);if(e>=0){this.menuItems=BX.util.insertIntoArray(this.menuItems,e,g)}else{this.menuItems.push(g)}return g};BX.PopupMenuWindow.prototype.removeMenuItem=function(i){var h=this.getMenuItem(i);if(!h){return}for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e]===h){h.destroySubMenu();this.menuItems=BX.util.deleteFromArray(this.menuItems,e);break}}if(!this.menuItems.length){var g=h.getMenuWindow();if(g){var f=g.getParentMenuItem();if(f){f.destroySubMenu()}else{g.destroy()}}}h.layout.item.parentNode.removeChild(h.layout.item);h.layout={item:null,text:null}};BX.PopupMenuWindow.prototype.getMenuItem=function(f){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].id&&this.menuItems[e].id===f){return this.menuItems[e]}}return null};BX.PopupMenuWindow.prototype.getMenuItems=function(){return this.menuItems};BX.PopupMenuWindow.prototype.getMenuItemPosition=function(f){if(f){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].id&&this.menuItems[e].id===f){return e}}}return -1};BX.PopupMenuItem=function(f){f=f||{};this.options=f;this.id=f.id||BX.util.getRandomString().toLowerCase();this.text=BX.type.isNotEmptyString(f.text)?f.text:"";this.title=BX.type.isNotEmptyString(f.title)?f.title:"";this.delimiter=f.delimiter===true;this.href=BX.type.isNotEmptyString(f.href)?f.href:null;this.target=BX.type.isNotEmptyString(f.target)?f.target:null;this.dataset=BX.type.isPlainObject(f.dataset)?f.dataset:null;this.className=BX.type.isNotEmptyString(f.className)?f.className:null;this.menuShowDelay=BX.type.isNumber(f.menuShowDelay)?f.menuShowDelay:300;this.subMenuOffsetX=BX.type.isNumber(f.subMenuOffsetX)?f.subMenuOffsetX:4;this._items=BX.type.isArray(f.items)?f.items:[];this.disabled=f.disabled===true;this.cacheable=f.cacheable===true;this.onclick=BX.type.isNotEmptyString(f.onclick)||BX.type.isFunction(f.onclick)?f.onclick:null;if(BX.type.isPlainObject(f.events)){for(var e in f.events){BX.addCustomEvent(this,e,f.events[e])}}this.menuWindow=null;this.subMenuWindow=null;this.layout={item:null,text:null};this.getLayout();this.events={};this.items=[];for(var g in f){if(f.hasOwnProperty(g)&&typeof(this[g])==="undefined"){this[g]=f[g]}}};BX.PopupMenuItem.prototype={getLayout:function(){if(this.layout.item){return this.layout}if(this.delimiter){if(BX.type.isNotEmptyString(this.text)){this.layout.item=BX.create("span",{props:{className:"popup-window-delimiter-section"},children:[(this.layout.text=BX.create("span",{props:{className:"popup-window-delimiter-text"},html:this.text}))]})}else{this.layout.item=BX.create("span",{props:{className:"popup-window-delimiter"}})}}else{this.layout.item=BX.create(this.href?"a":"span",{props:{className:["menu-popup-item",(this.className?this.className:"menu-popup-no-icon"),(this.hasSubMenu()?"menu-popup-item-submenu":"")].join(" ")},attrs:{title:this.title,onclick:BX.type.isString(this.onclick)?this.onclick:"",target:this.target?this.target:""},dataset:this.dataset,events:BX.type.isFunction(this.onclick)?{click:BX.delegate(this.onItemClick,this)}:null,children:[BX.create("span",{props:{className:"menu-popup-item-icon"}}),(this.layout.text=BX.create("span",{props:{className:"menu-popup-item-text"},html:this.text}))]});if(this.href){this.layout.item.href=this.href}if(this.isDisabled()){this.disable()}BX.bind(this.layout.item,"mouseenter",this.onItemMouseEnter.bind(this));BX.bind(this.layout.item,"mouseleave",this.onItemMouseLeave.bind(this))}return this.layout},getContainer:function(){return this.getLayout().item},getTextContainer:function(){return this.getLayout().text},getText:function(){return this.text},setText:function(e){if(BX.type.isString(e)){this.text=e;this.getTextContainer().innerHTML=e}},onItemClick:function(e){this.onclick.call(this.menuWindow,e,this)},onItemMouseEnter:function(e){if(this.isDisabled()){return}BX.onCustomEvent(this,"onMouseEnter");this.clearSubMenuTimeout();if(this.hasSubMenu()){this.subMenuTimeout=setTimeout(function(){this.showSubMenu()}.bind(this),this.menuShowDelay)}else{this.subMenuTimeout=setTimeout(function(){this.closeSiblings()}.bind(this),this.menuShowDelay)}},onItemMouseLeave:function(e){if(this.isDisabled()){return}BX.onCustomEvent(this,"onMouseLeave");this.clearSubMenuTimeout()},clearSubMenuTimeout:function(){if(this.subMenuTimeout){clearTimeout(this.subMenuTimeout)}this.subMenuTimeout=null},hasSubMenu:function(){return this.subMenuWindow!==null||this._items.length},showSubMenu:function(){this.addSubMenu(this._items);if(this.subMenuWindow){BX.addClass(this.layout.item,"menu-popup-item-open");this.closeSiblings();this.closeChildren();var e=this.subMenuWindow.getPopupWindow();if(!e.isShown()){BX.onCustomEvent(this,"onSubMenuShow");e.show()}this.adjustSubMenu()}},addSubMenu:function(e){if(this.subMenuWindow!==null||!BX.type.isArray(e)||!e.length){return null}var g=this.getMenuWindow().getRootMenuWindow()||this.getMenuWindow();var f=g.params;f.autoHide=false;f.menuShowDelay=this.menuShowDelay;f.cacheable=this.isCacheable();f.zIndexAbsolute=this.getMenuWindow().getPopupWindow().getZindex()+2;f.bindOptions={forceTop:true,forceLeft:true,forceBindPosition:true};delete f.zIndex;delete f.events;delete f.angle;delete f.overlay;this.subMenuWindow=new BX.PopupMenuWindow("popup-submenu-"+this.id,this.layout.item,e,f);this.subMenuWindow.setParentMenuWindow(this.getMenuWindow());this.subMenuWindow.setParentMenuItem(this);BX.addCustomEvent(this.subMenuWindow.getPopupWindow(),"onPopupDestroy",this.handleSubMenuDestroy.bind(this));BX.addClass(this.layout.item,"menu-popup-item-submenu");return this.subMenuWindow},handleSubMenuDestroy:function(){this.subMenuWindow=null},closeSubMenu:function(){this.clearSubMenuTimeout();if(this.subMenuWindow){BX.removeClass(this.layout.item,"menu-popup-item-open");this.closeChildren();var e=this.subMenuWindow.getPopupWindow();if(e.isShown()){BX.onCustomEvent(this,"onSubMenuClose")}this.subMenuWindow.close()}},closeSiblings:function(){var f=this.menuWindow.getMenuItems();for(var e=0;e<f.length;e++){if(f[e]!==this){f[e].closeSubMenu()}}},closeChildren:function(){if(this.subMenuWindow){var f=this.subMenuWindow.getMenuItems();for(var e=0;e<f.length;e++){f[e].closeSubMenu()}}},destroySubMenu:function(){if(this.subMenuWindow){BX.removeClass(this.layout.item,"menu-popup-item-open menu-popup-item-submenu");this.destroyChildren();this.subMenuWindow.destroy();this.subMenuWindow=null;this._items=[]}},destroyChildren:function(){if(this.subMenuWindow){var f=this.subMenuWindow.getMenuItems();for(var e=0;e<f.length;e++){f[e].destroySubMenu()}}},adjustSubMenu:function(){if(!this.subMenuWindow||!this.layout.item){return}var j=this.subMenuWindow.getPopupWindow();var n=this.layout.item.getBoundingClientRect();var g=n.width+this.subMenuOffsetX;var e=n.height+this.getPopupPadding();var h=n.height/2-this.getPopupPadding();var m="left";var q=j.getPopupContainer().offsetWidth;var o=j.getPopupContainer().offsetHeight;var p=n.top+o;var r=document.documentElement.clientWidth;var l=document.documentElement.clientHeight;var i=p-l;if(i>0){var k=Math.ceil(i/n.height)*n.height;if(k>n.top){k-=Math.ceil((k-n.top)/n.height)*n.height}if(n.bottom>(p-k)){k-=n.bottom-(p-k)+this.getPopupPadding()}e+=k;h+=k}if((n.left+g+q)>r){var f=n.left-q-this.subMenuOffsetX;if(f>0){g=-q-this.subMenuOffsetX;m="right"}}j.setBindElement(this.layout.item);j.setOffset({offsetLeft:g,offsetTop:-e});j.setAngle({position:m,offset:h});j.adjustPosition()},getPopupPadding:function(){if(!BX.type.isNumber(this.popupPadding)){if(this.subMenuWindow){var e=this.subMenuWindow.layout.menuContainer;this.popupPadding=parseInt(BX.style(e,"paddingTop"),10)}else{this.popupPadding=0}}return this.popupPadding},getSubMenu:function(){return this.subMenuWindow},getId:function(){return this.id},setMenuWindow:function(e){this.menuWindow=e},getMenuWindow:function(){return this.menuWindow},getMenuShowDelay:function(){return this.menuShowDelay},enable:function(){this.disabled=false;this.getContainer().classList.remove("menu-popup-item-disabled")},disable:function(){this.disabled=true;this.closeSubMenu();this.getContainer().classList.add("menu-popup-item-disabled")},isDisabled:function(){return this.disabled},setCacheable:function(e){this.cacheable=e!==false},isCacheable:function(){return this.cacheable}};a.BXInputPopup=function(e){this.id=e.id||"bx-inp-popup-"+Math.round(Math.random()*1000000);this.handler=e.handler||false;this.values=e.values||false;this.pInput=e.input;this.bValues=!!this.values;this.defaultValue=e.defaultValue||"";this.openTitle=e.openTitle||"";this.className=e.className||"";this.noMRclassName=e.noMRclassName||"ec-no-rm";this.emptyClassName=e.noMRclassName||"ec-label";var f=this;this.curInd=false;if(this.bValues){this.pInput.onfocus=this.pInput.onclick=function(g){if(this.value==f.defaultValue){this.value="";this.className=f.className}f.ShowPopup();return BX.PreventDefault(g)};this.pInput.onblur=function(){if(f.bShowed){setTimeout(function(){f.ClosePopup(true)},200)}f.OnChange()}}else{this.pInput.className=this.noMRclassName;this.pInput.onblur=BX.proxy(this.OnChange,this)}};BXInputPopup.prototype={ShowPopup:function(){if(this.bShowed){return}var j=this;if(!this.oPopup){var h,g=BX.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}});for(var f=0,e=this.values.length;f<e;f++){h=g.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+f},text:this.values[f].NAME,events:{mouseover:function(){BX.addClass(this,"bxecplloc-over")},mouseout:function(){BX.removeClass(this,"bxecplloc-over")},click:function(){var i=this.id.substr("bxecmr_".length);j.pInput.value=j.values[i].NAME;j.curInd=i;j.OnChange();j.ClosePopup(true)}}}));if(this.values[f].DESCRIPTION){h.title=this.values[f].DESCRIPTION}if(this.values[f].CLASS_NAME){BX.addClass(h,this.values[f].CLASS_NAME)}if(this.values[f].URL){h.appendChild(BX.create("A",{props:{href:this.values[f].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}))}}this.oPopup=new BX.PopupWindow(this.id,this.pInput,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,closeByEsc:true,content:g});BX.addCustomEvent(this.oPopup,"onPopupClose",BX.proxy(this.ClosePopup,this))}this.oPopup.show();this.pInput.select();this.bShowed=true;BX.onCustomEvent(this,"onInputPopupShow",[this])},ClosePopup:function(e){this.bShowed=false;if(this.pInput.value==""){this.OnChange()}BX.onCustomEvent(this,"onInputPopupClose",[this]);if(e===true){this.oPopup.close()}},OnChange:function(){var e=this.pInput.value;if(this.bValues){if(this.pInput.value==""||this.pInput.value==this.defaultValue){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName;e=""}else{this.pInput.className=""}}if(isNaN(parseInt(this.curInd))||this.curInd!==false&&e!=this.values[this.curInd].NAME){this.curInd=false}else{this.curInd=parseInt(this.curInd)}BX.onCustomEvent(this,"onInputPopupChanged",[this,this.curInd,e]);if(this.handler&&typeof this.handler=="function"){this.handler({ind:this.curInd,value:e})}},Set:function(f,g,e){this.curInd=f;if(this.curInd!==false){this.pInput.value=this.values[this.curInd].NAME}else{this.pInput.value=g}if(e!==false){this.OnChange()}},Get:function(e){var f=false;if(typeof e=="undefined"){e=this.curInd}if(e!==false&&this.values[e]){f=this.values[e].ID}return f},GetIndex:function(g){for(var f=0,e=this.values.length;f<e;f++){if(this.values[f].ID==g){return f}}return false},Deactivate:function(e){if(this.pInput.value==""||this.pInput.value==this.defaultValue){if(e){this.pInput.value="";this.pInput.className=this.noMRclassName}else{if(this.oEC.bUseMR){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName}}}this.pInput.disabled=e}};var d=-1,c=null;function b(g,f){if(g===false){if(c&&c.length>0){for(var e=0;e<c.length;e++){c[e]()}c=null;d=-1}}else{if(c===null){c=[];d=-1;BX.defer(b)(false)}if(g>d){d=g;c=[f]}else{if(g==d){c.push(f)}}}}})(window);