AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(a){this.className="AmPieChart";this.chartType="pie";AmCharts.AmPieChart.base.construct.call(this,a);this.pieBrightnessStep=30;this.minRadius=10;this.depth3D=0;this.startAngle=90;this.angle=this.innerRadius=0;this.startRadius="500%";this.pullOutRadius="20%";this.labelRadius=30;this.labelText="[[title]]: [[percents]]%";this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]";this.previousScale=1;AmCharts.applyTheme(this,a,"AmPieChart")},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var T=this.chartData;if(AmCharts.ifArray(T)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var R=this.startDuration,V=this.container,X=this.updateWidth();this.realWidth=X;var Q=this.updateHeight();this.realHeight=Q;var U=AmCharts.toCoordinate,P=U(this.marginLeft,X),W=U(this.marginRight,X),J=U(this.marginTop,Q)+this.getTitleHeight(),O=U(this.marginBottom,Q),D,C,S,G=AmCharts.toNumber(this.labelRadius),H=this.measureMaxLabel();this.labelText&&this.labelsEnabled||(G=H=0);D=void 0===this.pieX?(X-P-W)/2+P:U(this.pieX,this.realWidth);C=void 0===this.pieY?(Q-J-O)/2+J:U(this.pieY,Q);S=U(this.radius,X,Q);S||(X=0<=G?X-P-W-2*H:X-P-W,Q=Q-J-O,S=Math.min(X,Q),Q<X&&(S/=1-this.angle/90,S>X&&(S=X)),Q=AmCharts.toCoordinate(this.pullOutRadius,S),S=(0<=G?S-1.8*(G+Q):S-1.8*Q)/2);S<this.minRadius&&(S=this.minRadius);Q=U(this.pullOutRadius,S);J=AmCharts.toCoordinate(this.startRadius,S);U=U(this.innerRadius,S);U>=S&&(U=S-1);O=AmCharts.fitToBounds(this.startAngle,0,360);0<this.depth3D&&(O=270<=O?270:90);O-=90;X=S-S*this.angle/90;for(P=0;P<T.length;P++){if(W=T[P],!0!==W.hidden&&0<W.percents){var L=360*W.percents/100,H=Math.sin((O+L/2)/180*Math.PI),o=-Math.cos((O+L/2)/180*Math.PI)*(X/S),M=this.outlineColor;M||(M=W.color);M={fill:W.color,stroke:M,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":this.alpha};W.url&&(M.cursor="pointer");M=AmCharts.wedge(V,D,C,O,L,S,X,U,this.depth3D,M,this.gradientRatio,W.pattern);this.addEventListeners(M,W);W.startAngle=O;T[P].wedge=M;W.ix=H;W.iy=o;W.wedge=M;W.index=P;if(this.labelsEnabled&&this.labelText&&W.percents>=this.hideLabelsPercent){var N=O+L/2,L=G;isNaN(W.labelRadius)||(L=W.labelRadius);var K=D+H*(S+L),F=C+o*(S+L),j,E=0;if(0<=L){var i;90>=N&&0<=N?(i=0,j="start",E=8):90<=N&&180>N?(i=1,j="start",E=8):180<=N&&270>N?(i=2,j="end",E=-8):270<=N&&360>N&&(i=3,j="end",E=-8);W.labelQuarter=i}else{j="middle"}var N=this.formatString(this.labelText,W),I=W.labelColor;I||(I=this.color);N=AmCharts.text(V,N,I,this.fontFamily,this.fontSize,j);N.translate(K+1.5*E,F);W.tx=K+1.5*E;W.ty=F;F=U+(S-U)/2;W.pulled&&(F+=this.pullOutRadiusReal);W.balloonX=H*F+D;W.balloonY=o*F+C;0<=L?M.push(N):this.freeLabelsSet.push(N);W.label=N;W.tx=K;W.tx2=K+E;W.tx0=D+H*S;W.ty0=C+o*S}W.startX=Math.round(H*J);W.startY=Math.round(o*J);W.pullX=Math.round(H*Q);W.pullY=Math.round(o*Q);this.graphsSet.push(M);(0===W.alpha||0<R&&!this.chartCreated)&&M.hide();O+=360*W.percents/100}}0<G&&!this.labelRadiusField&&this.arrangeLabels();this.pieXReal=D;this.pieYReal=C;this.radiusReal=S;this.innerRadiusReal=U;0<G&&this.drawTicks();this.initialStart();this.setDepths()}(T=this.legend)&&T.invalidateSize()}else{this.cleanChart()}this.dispDUpd();this.chartCreated=!0},setDepths:function(){var f=this.chartData,d;for(d=0;d<f.length;d++){var h=f[d],b=h.wedge,h=h.startAngle;0<=h&&180>h?b.toFront():180<=h&&b.toBack()}},arrangeLabels:function(){var f=this.chartData,d=f.length,h,b;for(b=d-1;0<=b;b--){h=f[b],0!==h.labelQuarter||h.hidden||this.checkOverlapping(b,h,0,!0,0)}for(b=0;b<d;b++){h=f[b],1!=h.labelQuarter||h.hidden||this.checkOverlapping(b,h,1,!1,0)}for(b=d-1;0<=b;b--){h=f[b],2!=h.labelQuarter||h.hidden||this.checkOverlapping(b,h,2,!0,0)}for(b=0;b<d;b++){h=f[b],3!=h.labelQuarter||h.hidden||this.checkOverlapping(b,h,3,!1,0)}},checkOverlapping:function(o,n,r,t,m){var p,j,s=this.chartData,f=s.length,i=n.label;if(i){if(!0===t){for(j=o+1;j<f;j++){s[j].labelQuarter==r&&(p=this.checkOverlappingReal(n,s[j],r))&&(j=f)}}else{for(j=o-1;0<=j;j--){s[j].labelQuarter==r&&(p=this.checkOverlappingReal(n,s[j],r))&&(j=0)}}!0===p&&100>m&&(p=n.ty+3*n.iy,n.ty=p,i.translate(n.tx2,p),this.checkOverlapping(o,n,r,t,m+1))}},checkOverlappingReal:function(j,i,l){var b=!1,f=j.label,k=i.label;j.labelQuarter!=l||j.hidden||i.hidden||!k||(f=f.getBBox(),l={},l.width=f.width,l.height=f.height,l.y=j.ty,l.x=j.tx,j=k.getBBox(),k={},k.width=j.width,k.height=j.height,k.y=i.ty,k.x=i.tx,AmCharts.hitTest(l,k)&&(b=!0));return b}});