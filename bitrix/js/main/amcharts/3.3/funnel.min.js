AmCharts.AmFunnelChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(a){this.chartType="funnel";AmCharts.AmFunnelChart.base.construct.call(this,a);this.startX=this.startY=0;this.baseWidth="100%";this.neckHeight=this.neckWidth=0;this.rotate=!1;this.valueRepresents="height";this.pullDistance=30;this.labelPosition="center";this.labelText="[[title]]: [[value]]";this.balloonText="[[title]]: [[value]]\n[[description]]";AmCharts.applyTheme(this,a,"AmFunnelChart")},drawChart:function(){AmCharts.AmFunnelChart.base.drawChart.call(this);var P=this.chartData;if(AmCharts.ifArray(P)){if(0<this.realWidth&&0<this.realHeight){var M=this.container,S=this.startDuration,X=this.rotate,H=this.updateWidth();this.realWidth=H;var aa=this.updateHeight();this.realHeight=aa;var U=AmCharts.toCoordinate,R=U(this.marginLeft,H),J=U(this.marginRight,H),af=U(this.marginTop,aa)+this.getTitleHeight(),U=U(this.marginBottom,aa),J=H-R-J,G=AmCharts.toCoordinate(this.baseWidth,J),T=AmCharts.toCoordinate(this.neckWidth,J),O=aa-U-af,o=AmCharts.toCoordinate(this.neckHeight,O),L=af+O-o;X&&(af=aa-U,L=af-O+o);this.firstSliceY=af;AmCharts.VML&&(this.startAlpha=1);for(var Z=J/2+R,N=(O-o)/((G-T)/2),j=G/2,G=(O-o)*(G+T)/2+T*o,o=af,I=0,K=0;K<P.length;K++){var ad=P[K];if(!0!==ad.hidden){var W=[],Y=[],ae;if("height"==this.valueRepresents){ae=O*ad.percents/100}else{var V=-G*ad.percents/100/2,i=j,ac=-1/(2*N);ae=Math.pow(i,2)-4*ac*V;0>ae&&(ae=0);ae=(Math.sqrt(ae)-i)/(2*ac);if(!X&&af>=L||X&&af<=L){ae=2*-V/T}else{if(!X&&af+ae>L||X&&af-ae<L){ac=X?Math.round(ae+(af-ae-L)):Math.round(ae-(af+ae-L)),ae=ac/N,ae=ac+2*(-V-(i-ae/2)*ac)/T}}}V=j-ae/N;i=!1;!X&&af+ae>L||X&&af-ae<L?(V=T/2,W.push(Z-j,Z+j,Z+V,Z+V,Z-V,Z-V),X?(ac=ae+(af-ae-L),Y.push(af,af,af-ac,af-ae,af-ae,af-ac,af)):(ac=ae-(af+ae-L),Y.push(af,af,af+ac,af+ae,af+ae,af+ac,af)),i=!0):(W.push(Z-j,Z+j,Z+V,Z-V),X?Y.push(af,af,af-ae,af-ae):Y.push(af,af,af+ae,af+ae));M.set();ac=M.set();W=AmCharts.polygon(M,W,Y,ad.color,ad.alpha,this.outlineThickness,this.outlineColor,this.outlineAlpha);ac.push(W);this.graphsSet.push(ac);ad.wedge=ac;ad.index=K;if(Y=this.gradientRatio){var Q=[],ab;for(ab=0;ab<Y.length;ab++){Q.push(AmCharts.adjustLuminosity(ad.color,Y[ab]))}0<Q.length&&W.gradient("linearGradient",Q);ad.pattern&&W.pattern(ad.pattern)}0<S&&(W=this.startAlpha,this.chartCreated&&(W=ad.alpha),ac.setAttr("opacity",W));this.addEventListeners(ac,ad);this.labelsEnabled&&this.labelText&&ad.percents>=this.hideLabelsPercent&&(Y=this.formatString(this.labelText,ad),Q=ad.labelColor,Q||(Q=this.color),W=this.labelPosition,ab="left","center"==W&&(ab="middle"),"left"==W&&(ab="right"),Y=AmCharts.text(M,Y,Q,this.fontFamily,this.fontSize,ab),ac.push(Y),Q=Z,X?(ab=af-ae/2,ad.ty0=ab):(ab=af+ae/2,ad.ty0=ab,ab<o+I+5&&(ab=o+I+5),ab>aa-U&&(ab=aa-U)),"right"==W&&(Q=J+10+R,ad.tx0=Z+(j-ae/2/N),i&&(ad.tx0=Z+V)),"left"==W&&(ad.tx0=Z-(j-ae/2/N),i&&(ad.tx0=Z-V),Q=R),ad.label=Y,ad.labelX=Q,ad.labelY=ab,ad.labelHeight=Y.getBBox().height,Y.translate(Q,ab),(0===ad.alpha||0<S&&!this.chartCreated)&&ac.hide(),af=X?af-ae:af+ae,j=V,I=Y.getBBox().height,o=ab);ad.startX=AmCharts.toCoordinate(this.startX,H);ad.startY=AmCharts.toCoordinate(this.startY,aa);ad.pullX=AmCharts.toCoordinate(this.pullDistance,H);ad.pullY=0;ad.balloonX=Z;ad.balloonY=ad.ty0}}this.arrangeLabels();this.initialStart();(P=this.legend)&&P.invalidateSize()}else{this.cleanChart()}}this.dispDUpd();this.chartCreated=!0},arrangeLabels:function(){var b=this.rotate,q;q=b?0:this.realHeight;for(var e=0,h=this.chartData,m=h.length,i,g=0;g<m;g++){i=h[m-g-1];var d=i.label,o=i.labelY,j=i.labelX,l=i.labelHeight,c=o;b?q+e+5>o&&(c=q+e+5):o+l+5>q&&(c=q-5-l);q=c;e=l;d.translate(j,c);i.labelY=c;i.tx=j;i.ty=c;i.tx2=j}"center"!=this.labelPosition&&this.drawTicks()}});