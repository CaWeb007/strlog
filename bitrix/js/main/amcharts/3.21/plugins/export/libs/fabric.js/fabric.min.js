/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.6.2"};if(typeof exports!=="undefined"){exports.fabric=fabric}if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window;window.fabric=fabric}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");if(fabric.document.createWindow){fabric.window=fabric.document.createWindow()}else{fabric.window=fabric.document.parentWindow}}fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.fontPaths={};fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;(function(){function d(f,g){if(!this.__eventListeners[f]){return}var e=this.__eventListeners[f];if(g){e[e.indexOf(g)]=false}else{fabric.util.array.fill(e,false)}}function c(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function a(e,f){if(!this.__eventListeners){return}if(arguments.length===0){for(e in this.__eventListeners){d.call(this,e)}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return}var f=this.__eventListeners[g];if(!f){return}for(var j=0,e=f.length;j<e;j++){f[j]&&f[j].call(this,h||{})}this.__eventListeners[g]=f.filter(function(i){return i!==false});return this}fabric.Observable={observe:c,stopObserving:a,fire:b,on:c,off:a,trigger:b}})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;a<b;a++){this._onObjectAdded(arguments[a])}this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(b,a,d){var c=this.getObjects();if(d){c[a]=b}else{c.splice(a,0,b)}this._onObjectAdded(b);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){var d=this.getObjects(),a;for(var b=0,c=arguments.length;b<c;b++){a=d.indexOf(arguments[b]);if(a!==-1){d.splice(a,1);this._onObjectRemoved(arguments[b])}}this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,b){var c=this.getObjects(),a=c.length;while(a--){d.call(b,c[a],a,c)}return this},getObjects:function(a){if(typeof a==="undefined"){return this._objects}return this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){a+=b.complexity?b.complexity():0;return a},0)}};(function(e){var f=Math.sqrt,c=Math.atan2,d=Math.pow,a=Math.abs,b=Math.PI/180;fabric.util={removeFromArray:function(i,h){var g=i.indexOf(h);if(g!==-1){i.splice(g,1)}return i},getRandomInt:function(h,g){return Math.floor(Math.random()*(g-h+1))+h},degreesToRadians:function(g){return g*b},radiansToDegrees:function(g){return g/b},rotatePoint:function(g,i,j){g.subtractEquals(i);var h=fabric.util.rotateVector(g,j);return new fabric.Point(h.x,h.y).addEquals(i)},rotateVector:function(g,l){var h=Math.sin(l),j=Math.cos(l),k=g.x*j-g.y*h,i=g.x*h+g.y*j;return{x:k,y:i}},transformPoint:function(i,h,g){if(g){return new fabric.Point(h[0]*i.x+h[2]*i.y,h[1]*i.x+h[3]*i.y)}return new fabric.Point(h[0]*i.x+h[2]*i.y+h[4],h[1]*i.x+h[3]*i.y+h[5])},makeBoundingBoxFromPoints:function(n){var i=[n[0].x,n[1].x,n[2].x,n[3].x],l=fabric.util.array.min(i),h=fabric.util.array.max(i),j=Math.abs(l-h),m=[n[0].y,n[1].y,n[2].y,n[3].y],k=fabric.util.array.min(m),g=fabric.util.array.max(m),o=Math.abs(k-g);return{left:l,top:k,width:j,height:o}},invertTransform:function(h){var g=1/(h[0]*h[3]-h[1]*h[2]),i=[g*h[3],-g*h[1],-g*h[2],g*h[0]],j=fabric.util.transformPoint({x:h[4],y:h[5]},i,true);i[4]=-j.x;i[5]=-j.y;return i},toFixed:function(h,g){return parseFloat(Number(h).toFixed(g))},parseUnit:function(j,i){var h=/\D{0,2}$/.exec(j),g=parseFloat(j);if(!i){i=fabric.Text.DEFAULT_SVG_FONT_SIZE}switch(h[0]){case"mm":return g*fabric.DPI/25.4;case"cm":return g*fabric.DPI/2.54;case"in":return g*fabric.DPI;case"pt":return g*fabric.DPI/72;case"pc":return g*fabric.DPI/72*12;case"em":return g*i;default:return g}},falseFunction:function(){return false},getKlass:function(h,g){h=fabric.util.string.camelize(h.charAt(0).toUpperCase()+h.slice(1));return fabric.util.resolveNamespace(g)[h]},resolveNamespace:function(j){if(!j){return fabric}var l=j.split("."),g=l.length,k=e||fabric.window;for(var h=0;h<g;++h){k=k[l[h]]}return k},loadImage:function(i,k,j,h){if(!i){k&&k.call(j,i);return}var g=fabric.util.createImage();g.onload=function(){k&&k.call(j,g);g=g.onload=g.onerror=null};g.onerror=function(){fabric.log("Error loading "+g.src);k&&k.call(j,null,true);g=g.onload=g.onerror=null};if(i.indexOf("data")!==0&&h){g.crossOrigin=h}g.src=i},enlivenObjects:function(k,n,i,h){k=k||[];function j(){if(++m===g){n&&n(l)}}var l=[],m=0,g=k.length;if(!g){n&&n(l);return}k.forEach(function(r,q){if(!r||!r.type){j();return}var p=fabric.util.getKlass(r.type,i);if(p.async){p.fromObject(r,function(s,o){if(!o){l[q]=s;h&&h(r,l[q])}j()})}else{l[q]=p.fromObject(r);h&&h(r,l[q]);j()}})},groupSVGElements:function(i,h,j){var g;g=new fabric.PathGroup(i,h);if(typeof j!=="undefined"){g.setSourcePath(j)}return g},populateWithProperties:function(l,h,k){if(k&&Object.prototype.toString.call(k)==="[object Array]"){for(var j=0,g=k.length;j<g;j++){if(k[j] in l){h[k[j]]=l[k[j]]}}}},drawDashedLine:function(p,n,k,g,l,r){var s=g-n,q=l-k,i=f(s*s+q*q),h=c(q,s),o=r.length,j=0,m=true;p.save();p.translate(n,k);p.moveTo(0,0);p.rotate(h);n=0;while(i>n){n+=r[j++%o];if(n>i){n=i}p[m?"lineTo":"moveTo"](n,0);m=!m}p.restore()},createCanvasElement:function(g){g||(g=fabric.document.createElement("canvas"));if(!g.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(g)}return g},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image)():fabric.document.createElement("img")},createAccessors:function(g){var l=g.prototype;for(var j=l.stateProperties.length;j--;){var m=l.stateProperties[j],n=m.charAt(0).toUpperCase()+m.slice(1),h="set"+n,k="get"+n;if(!l[k]){l[k]=(function(i){return new Function('return this.get("'+i+'")')})(m)}if(!l[h]){l[h]=(function(i){return new Function("value",'return this.set("'+i+'", value)')})(m)}}},clipContext:function(h,g){g.save();g.beginPath();h.clipTo(g);g.clip()},multiplyTransformMatrices:function(h,g,i){return[h[0]*g[0]+h[2]*g[1],h[1]*g[0]+h[3]*g[1],h[0]*g[2]+h[2]*g[3],h[1]*g[2]+h[3]*g[3],i?0:h[0]*g[4]+h[2]*g[5]+h[4],i?0:h[1]*g[4]+h[3]*g[5]+h[5]]},qrDecompose:function(g){var l=c(g[1],g[0]),i=d(g[0],2)+d(g[1],2),j=f(i),h=(g[0]*g[3]-g[2]*g[1])/j,k=c(g[0]*g[2]+g[1]*g[3],i);return{angle:l/b,scaleX:j,scaleY:h,skewX:k/b,skewY:0,translateX:g[4],translateY:g[5]}},customTransformMatrix:function(i,h,k){var g=[1,0,a(Math.tan(k*b)),1],j=[a(i),0,0,a(h)];return fabric.util.multiplyTransformMatrices(j,g,true)},resetObjectTransform:function(g){g.scaleX=1;g.scaleY=1;g.skewX=0;g.skewY=0;g.flipX=false;g.flipY=false;g.setAngle(0)},getFunctionBody:function(g){return(String(g).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(q,o,n,m){if(m>0){if(o>m){o-=m}else{o=0}if(n>m){n-=m}else{n=0}}var h=true,g=q.getImageData(o,n,(m*2)||1,(m*2)||1);for(var k=3,j=g.data.length;k<j;k+=4){var p=g.data[k];h=p<=0;if(h===false){break}}g=null;return h},parsePreserveAspectRatioAttribute:function(j){var k="meet",h="Mid",g="Mid",i=j.split(" "),l;if(i&&i.length){k=i.pop();if(k!=="meet"&&k!=="slice"){l=k;k="meet"}else{if(i.length){l=i.pop()}}}h=l!=="none"?l.slice(1,4):"none";g=l!=="none"?l.slice(5,8):"none";return{meetOrSlice:k,alignX:h,alignY:g}}}})(typeof exports!=="undefined"?exports:this);(function(){var b={},c={},h={},d=Array.prototype.join;function g(m,k,r,q,j,B,w){var S=d.call(arguments);if(b[S]){return b[S]}var I=Math.PI,t=w*I/180,O=Math.sin(t),H=Math.cos(t),C=0,z=0;r=Math.abs(r);q=Math.abs(q);var G=-H*m*0.5-O*k*0.5,D=-H*k*0.5+O*m*0.5,P=r*r,p=q*q,l=D*D,L=G*G,N=P*p-P*l-p*L,K=0;if(N<0){var A=Math.sqrt(1-N/(P*p));r*=A;q*=A}else{K=(j===B?-1:1)*Math.sqrt(N/(P*l+p*L))}var o=K*r*D/q,n=-K*q*G/r,F=H*o-O*n+m*0.5,Q=O*o+H*n+k*0.5,R=e(1,0,(G-o)/r,(D-n)/q),E=e((G-o)/r,(D-n)/q,(-G-o)/r,(-D-n)/q);if(B===0&&E>0){E-=2*I}else{if(B===1&&E<0){E+=2*I}}var J=Math.ceil(Math.abs(E/I*2)),v=[],y=E/J,u=8/3*Math.sin(y/4)*Math.sin(y/4)/Math.sin(y/2),x=R+y;for(var M=0;M<J;M++){v[M]=f(R,x,H,O,r,q,F,Q,u,C,z);C=v[M][4];z=v[M][5];R=x;x+=y}b[S]=v;return v}function f(t,r,x,B,o,n,w,D,p,v,u){var k=d.call(arguments);if(c[k]){return c[k]}var m=Math.cos(t),z=Math.sin(t),l=Math.cos(r),y=Math.sin(r),j=x*o*l-B*n*y+w,i=B*o*l+x*n*y+D,s=v+p*(-x*o*z-B*n*m),q=u+p*(-B*o*z+x*n*m),C=j+p*(x*o*y+B*n*l),A=i+p*(B*o*y-x*n*l);c[k]=[s,q,C,A,j,i];return c[k]}function e(l,k,n,m){var j=Math.atan2(k,l),i=Math.atan2(m,n);if(i>=j){return i-j}else{return 2*Math.PI-(j-i)}}fabric.util.drawArc=function(x,p,o,u){var m=u[0],j=u[1],n=u[2],v=u[3],w=u[4],s=u[5],q=u[6],l=[[],[],[],[]],k=g(s-p,q-o,m,j,v,w,n);for(var r=0,t=k.length;r<t;r++){l[r][0]=k[r][0]+p;l[r][1]=k[r][1]+o;l[r][2]=k[r][2]+p;l[r][3]=k[r][3]+o;l[r][4]=k[r][4]+p;l[r][5]=k[r][5]+o;x.bezierCurveTo.apply(x,l[r])}};fabric.util.getBoundsOfArc=function(p,o,m,k,n,y,z,u,r){var x=0,w=0,q=[],j=[],l=g(u-p,r-o,m,k,y,z,n),t=[[],[]];for(var s=0,v=l.length;s<v;s++){q=a(x,w,l[s][0],l[s][1],l[s][2],l[s][3],l[s][4],l[s][5]);t[0].x=q[0].x+p;t[0].y=q[0].y+o;t[1].x=q[1].x+p;t[1].y=q[1].y+o;j.push(t[0]);j.push(t[1]);x=l[s][4];w=l[s][5]}return j};function a(L,o,K,m,J,l,I,k){var Q=d.call(arguments);if(h[Q]){return h[Q]}var P=Math.sqrt,E=Math.min,H=Math.max,B=Math.abs,C=[],p=[[],[]],O,N,M,z,v,s,n,q;N=6*L-12*K+6*J;O=-3*L+9*K-9*J+3*I;M=3*K-3*L;for(var G=0;G<2;++G){if(G>0){N=6*o-12*m+6*l;O=-3*o+9*m-9*l+3*k;M=3*m-3*o}if(B(O)<1e-12){if(B(N)<1e-12){continue}z=-M/N;if(0<z&&z<1){C.push(z)}continue}n=N*N-4*M*O;if(n<0){continue}q=P(n);v=(-N+q)/(2*O);if(0<v&&v<1){C.push(v)}s=(-N-q)/(2*O);if(0<s&&s<1){C.push(s)}}var u,r,F=C.length,A=F,D;while(F--){z=C[F];D=1-z;u=(D*D*D*L)+(3*D*D*z*K)+(3*D*z*z*J)+(z*z*z*I);p[0][F]=u;r=(D*D*D*o)+(3*D*D*z*m)+(3*D*z*z*l)+(z*z*z*k);p[1][F]=r}p[0][A]=L;p[1][A]=o;p[0][A+1]=I;p[1][A+1]=k;var w=[{x:E.apply(null,p[0]),y:E.apply(null,p[1])},{x:H.apply(null,p[0]),y:H.apply(null,p[1])}];h[Q]=w;return w}fabric.util.getBoundsOfCurve=a})();(function(){var f=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(i){if(this===void 0||this===null){throw new TypeError()}var j=Object(this),g=j.length>>>0;if(g===0){return -1}var l=0;if(arguments.length>0){l=Number(arguments[1]);if(l!==l){l=0}else{if(l!==0&&l!==Number.POSITIVE_INFINITY&&l!==Number.NEGATIVE_INFINITY){l=(l>0||-1)*Math.floor(Math.abs(l))}}}if(l>=g){return -1}var h=l>=0?l:Math.max(g-Math.abs(l),0);for(;h<g;h++){if(h in j&&j[h]===i){return h}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(k,j){for(var h=0,g=this.length>>>0;h<g;h++){if(h in this){k.call(j,this[h],h,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(l,k){var h=[];for(var j=0,g=this.length>>>0;j<g;j++){if(j in this){h[j]=l.call(k,this[j],j,this)}}return h}}if(!Array.prototype.every){Array.prototype.every=function(k,j){for(var h=0,g=this.length>>>0;h<g;h++){if(h in this&&!k.call(j,this[h],h,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(k,j){for(var h=0,g=this.length>>>0;h<g;h++){if(h in this&&k.call(j,this[h],h,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(l,k){var h=[],m;for(var j=0,g=this.length>>>0;j<g;j++){if(j in this){m=this[j];if(l.call(k,m,j,this)){h.push(m)}}}return h}}if(!Array.prototype.reduce){Array.prototype.reduce=function(j){var g=this.length>>>0,h=0,k;if(arguments.length>1){k=arguments[1]}else{do{if(h in this){k=this[h++];break}if(++h>=g){throw new TypeError()}}while(true)}for(;h<g;h++){if(h in this){k=j.call(null,k,this[h],h,this)}}return k}}function b(m,l){var j=f.call(arguments,2),h=[];for(var k=0,g=m.length;k<g;k++){h[k]=j.length?m[k][l].apply(m[k],j):m[k][l].call(m[k])}return h}function a(h,g){return e(h,g,function(j,i){return j>=i})}function c(h,g){return e(h,g,function(j,i){return j<i})}function d(i,h){var g=i.length;while(g--){i[g]=h}return i}function e(l,j,k){if(!l||l.length===0){return}var h=l.length-1,g=j?l[h][j]:l[h];if(j){while(h--){if(k(l[h][j],g)){g=l[h][j]}}}else{while(h--){if(k(l[h],g)){g=l[h]}}}return g}fabric.util.array={fill:d,invoke:b,min:c,max:a}})();(function(){function b(c,e){for(var d in e){c[d]=e[d]}return c}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function b(d){return d.replace(/-+(.)?/g,function(e,f){return f?f.toUpperCase():""})}function c(d,e){return d.charAt(0).toUpperCase()+(e?d.slice(1):d.slice(1).toLowerCase())}function a(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}fabric.util.string={camelize:b,capitalize:c,escapeXml:a}}());(function(){var c=Array.prototype.slice,a=Function.prototype.apply,b=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(d){var g=this,e=c.call(arguments,1),f;if(e.length){f=function(){return a.call(g,this instanceof b?this:d,e.concat(c.call(arguments)))}}else{f=function(){return a.call(g,this instanceof b?this:d,arguments)}}b.prototype=this.prototype;f.prototype=new b();return f}}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=this.constructor.superclass.prototype[h];return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}fabric.util.createClass=e})();(function(){var r="unknown";function m(u){var x=Array.prototype.slice.call(arguments,1),w,v,s=x.length;for(v=0;v<s;v++){w=typeof u[x[v]];if(!(/^(?:function|object|unknown)$/).test(w)){return false}}return true}var g,q,j=(function(){var s=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+s++)}})();(function(){var s={};g=function(t){return s[t]};q=function(u,t){s[u]=t}})();function d(s,t){return{handler:t,wrappedHandler:l(s,t)}}function l(s,t){return function(u){t.call(g(s),u||fabric.window.event)}}function f(t,s){return function(x){if(o[t]&&o[t][s]){var v=o[t][s];for(var w=0,u=v.length;w<u;w++){v[w].call(this,x||fabric.window.event)}}}}var p=(m(fabric.document.documentElement,"addEventListener","removeEventListener")&&m(fabric.window,"addEventListener","removeEventListener")),h=(m(fabric.document.documentElement,"attachEvent","detachEvent")&&m(fabric.window,"attachEvent","detachEvent")),n={},o={},k,c;if(p){k=function(t,s,u){t.addEventListener(s,u,false)};c=function(t,s,u){t.removeEventListener(s,u,false)}}else{if(h){k=function(u,s,v){var t=j(u);q(t,u);if(!n[t]){n[t]={}}if(!n[t][s]){n[t][s]=[]}var w=d(t,v);n[t][s].push(w);u.attachEvent("on"+s,w.wrappedHandler)};c=function(w,t,x){var v=j(w),y;if(n[v]&&n[v][t]){for(var u=0,s=n[v][t].length;u<s;u++){y=n[v][t][u];if(y&&y.handler===x){w.detachEvent("on"+t,y.wrappedHandler);n[v][t][u]=null}}}}}else{k=function(u,s,v){var t=j(u);if(!o[t]){o[t]={}}if(!o[t][s]){o[t][s]=[];var w=u["on"+s];if(w){o[t][s].push(w)}u["on"+s]=f(t,s)}o[t][s].push(v)};c=function(x,u,y){var w=j(x);if(o[w]&&o[w][u]){var t=o[w][u];for(var v=0,s=t.length;v<s;v++){if(t[v]===y){t.splice(v,1)}}}}}}fabric.util.addListener=k;fabric.util.removeListener=c;function i(u){u||(u=fabric.window.event);var t=u.target||(typeof u.srcElement!==r?u.srcElement:null),s=fabric.util.getScrollLeftTop(t);return{x:b(u)+s.left,y:a(u)+s.top}}var b=function(s){return(typeof s.clientX!==r?s.clientX:0)},a=function(s){return(typeof s.clientY!==r?s.clientY:0)};function e(t,v,s){var u=t.type==="touchend"?"changedTouches":"touches";return(t[u]&&t[u][0]?(t[u][0][v]-(t[u][0][v]-t[u][0][s]))||t[s]:t[s])}if(fabric.isTouchSupported){b=function(s){return e(s,"pageX","clientX")};a=function(s){return e(s,"pageY","clientY")}}fabric.util.getPointer=i;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var j=Array.prototype.slice;function i(l){return typeof l==="string"?fabric.document.getElementById(l):l}var k,c=function(l){return j.call(l,0)};try{k=c(fabric.document.childNodes) instanceof Array}catch(b){}if(!k){c=function(m){var l=new Array(m.length),n=m.length;while(n--){l[n]=m[n]}return l}}function d(m,l){var n=fabric.document.createElement(m);for(var o in l){if(o==="class"){n.className=l[o]}else{if(o==="for"){n.htmlFor=l[o]}else{n.setAttribute(o,l[o])}}}return n}function h(l,m){if(l&&(" "+l.className+" ").indexOf(" "+m+" ")===-1){l.className+=(l.className?" ":"")+m}}function g(m,n,l){if(typeof n==="string"){n=d(n,l)}if(m.parentNode){m.parentNode.replaceChild(n,m)}n.appendChild(m);return n}function a(n){var p=0,o=0,m=fabric.document.documentElement,l=fabric.document.body||{scrollLeft:0,scrollTop:0};while(n&&(n.parentNode||n.host)){n=n.parentNode||n.host;if(n===fabric.document){p=l.scrollLeft||m.scrollLeft||0;o=l.scrollTop||m.scrollTop||0}else{p+=n.scrollLeft||0;o+=n.scrollTop||0}if(n.nodeType===1&&fabric.util.getElementStyle(n,"position")==="fixed"){break}}return{left:p,top:o}}function f(o){var m,r=o&&o.ownerDocument,p={left:0,top:0},s={left:0,top:0},q,n={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r){return s}for(var l in n){s[n[l]]+=parseInt(e(o,l),10)||0}m=r.documentElement;if(typeof o.getBoundingClientRect!=="undefined"){p=o.getBoundingClientRect()}q=a(o);return{left:p.left+q.left-(m.clientLeft||0)+s.left,top:p.top+q.top-(m.clientTop||0)+s.top}}var e;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){e=function(m,l){var n=fabric.document.defaultView.getComputedStyle(m,null);return n?n[l]:undefined}}else{e=function(m,l){var n=m.style[l];if(!n&&m.currentStyle){n=m.currentStyle[l]}return n}}(function(){var m=fabric.document.documentElement.style,n="userSelect" in m?"userSelect":"MozUserSelect" in m?"MozUserSelect":"WebkitUserSelect" in m?"WebkitUserSelect":"KhtmlUserSelect" in m?"KhtmlUserSelect":"";function o(p){if(typeof p.onselectstart!=="undefined"){p.onselectstart=fabric.util.falseFunction}if(n){p.style[n]="none"}else{if(typeof p.unselectable==="string"){p.unselectable="on"}}return p}function l(p){if(typeof p.onselectstart!=="undefined"){p.onselectstart=null}if(n){p.style[n]=""}else{if(typeof p.unselectable==="string"){p.unselectable=""}}return p}fabric.util.makeElementUnselectable=o;fabric.util.makeElementSelectable=l})();(function(){function l(m,q){var o=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),p=true;n.onload=n.onreadystatechange=function(r){if(p){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}p=false;q(r||fabric.window.event);n=n.onload=n.onreadystatechange=null}};n.src=m;o.appendChild(n)}fabric.util.getScript=l})();fabric.util.getById=i;fabric.util.toArray=c;fabric.util.makeElement=d;fabric.util.addClass=h;fabric.util.wrapElement=g;fabric.util.getScrollLeftTop=a;fabric.util.getElementOffset=f;fabric.util.getElementStyle=e})();(function(){function d(e,f){return e+(/\?/.test(e)?"&":"?")+f}var c=(function(){var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var e=h.length;e--;){try{var g=h[e]();if(g){return h[e]}}catch(f){}}})();function a(){}function b(g,f){f||(f={});var j=f.method?f.method.toUpperCase():"GET",h=f.onComplete||function(){},i=c(),e;i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){e=null;if(typeof f.parameters==="string"){g=d(g,f.parameters)}}i.open(j,g,true);if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}i.send(e);return i}fabric.util.request=b})();fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){["log","warn"].forEach(function(a){if(typeof console[a]!=="undefined"&&typeof console[a].apply==="function"){fabric[a]=function(){return console[a].apply(console,arguments)}}})}(function(){function a(d){b(function(k){d||(d={});var f=k||+new Date(),h=d.duration||500,o=f+h,g,l=d.onChange||function(){},i=d.abort||function(){return false},m=d.easing||function(r,q,u,s){return -u*Math.cos(r/s*(Math.PI/2))+u+q},e="startValue" in d?d.startValue:0,n="endValue" in d?d.endValue:100,p=d.byValue||n-e;d.onStart&&d.onStart();(function j(q){g=q||+new Date();var r=g>o?h:(g-f);if(i()){d.onComplete&&d.onComplete();return}l(m(r,e,p,h));if(g>o){d.onComplete&&d.onComplete();return}b(j)})(f)})}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){fabric.window.setTimeout(d,1000/60)};function b(){return c.apply(fabric.window,arguments)}fabric.util.animate=a;fabric.util.requestAnimFrame=b})();(function(){function y(C,F,E,D){if(C<Math.abs(F)){C=F;D=E/4}else{if(F===0&&C===0){D=E/(2*Math.PI)*Math.asin(1)}else{D=E/(2*Math.PI)*Math.asin(F/C)}}return{a:C,c:F,p:E,s:D}}function p(D,C,E){return D.a*Math.pow(2,10*(C-=1))*Math.sin((C*E-D.s)*(2*Math.PI)/D.p)}function o(D,C,F,E){return F*((D=D/E-1)*D*D+1)+C}function s(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D+C}return F/2*((D-=2)*D*D+2)+C}function r(D,C,F,E){return F*(D/=E)*D*D*D+C}function f(D,C,F,E){return -F*((D=D/E-1)*D*D*D-1)+C}function j(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D+C}return -F/2*((D-=2)*D*D*D-2)+C}function w(D,C,F,E){return F*(D/=E)*D*D*D*D+C}function i(D,C,F,E){return F*((D=D/E-1)*D*D*D*D+1)+C}function l(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D*D+C}return F/2*((D-=2)*D*D*D*D+2)+C}function e(D,C,F,E){return -F*Math.cos(D/E*(Math.PI/2))+F+C}function m(D,C,F,E){return F*Math.sin(D/E*(Math.PI/2))+C}function t(D,C,F,E){return -F/2*(Math.cos(Math.PI*D/E)-1)+C}function B(D,C,F,E){return(D===0)?C:F*Math.pow(2,10*(D/E-1))+C}function c(D,C,F,E){return(D===E)?C+F:F*(-Math.pow(2,-10*D/E)+1)+C}function h(D,C,F,E){if(D===0){return C}if(D===E){return C+F}D/=E/2;if(D<1){return F/2*Math.pow(2,10*(D-1))+C}return F/2*(-Math.pow(2,-10*--D)+2)+C}function g(D,C,F,E){return -F*(Math.sqrt(1-(D/=E)*D)-1)+C}function n(D,C,F,E){return F*Math.sqrt(1-(D=D/E-1)*D)+C}function v(D,C,F,E){D/=E/2;if(D<1){return -F/2*(Math.sqrt(1-D*D)-1)+C}return F/2*(Math.sqrt(1-(D-=2)*D)+1)+C}function q(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return -p(G,E,I)+C}function x(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return G.a*Math.pow(2,-10*E)*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)+G.c+C}function a(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I/2;if(E===2){return C+J}if(!H){H=I*(0.3*1.5)}var G=y(D,J,H,F);if(E<1){return -0.5*p(G,E,I)+C}return G.a*Math.pow(2,-10*(E-=1))*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)*0.5+G.c+C}function k(D,C,G,F,E){if(E===undefined){E=1.70158}return G*(D/=F)*D*((E+1)*D-E)+C}function u(D,C,G,F,E){if(E===undefined){E=1.70158}return G*((D=D/F-1)*D*((E+1)*D+E)+1)+C}function z(D,C,G,F,E){if(E===undefined){E=1.70158}D/=F/2;if(D<1){return G/2*(D*D*(((E*=(1.525))+1)*D-E))+C}return G/2*((D-=2)*D*(((E*=(1.525))+1)*D+E)+2)+C}function d(D,C,F,E){return F-b(E-D,0,F,E)+C}function b(D,C,F,E){if((D/=E)<(1/2.75)){return F*(7.5625*D*D)+C}else{if(D<(2/2.75)){return F*(7.5625*(D-=(1.5/2.75))*D+0.75)+C}else{if(D<(2.5/2.75)){return F*(7.5625*(D-=(2.25/2.75))*D+0.9375)+C}else{return F*(7.5625*(D-=(2.625/2.75))*D+0.984375)+C}}}}function A(D,C,F,E){if(D<E/2){return d(D*2,0,F,E)*0.5+C}return b(D*2-E,0,F,E)*0.5+F*0.5+C}fabric.util.ease={easeInQuad:function(D,C,F,E){return F*(D/=E)*D+C},easeOutQuad:function(D,C,F,E){return -F*(D/=E)*(D-2)+C},easeInOutQuad:function(D,C,F,E){D/=(E/2);if(D<1){return F/2*D*D+C}return -F/2*((--D)*(D-2)-1)+C},easeInCubic:function(D,C,F,E){return F*(D/=E)*D*D+C},easeOutCubic:o,easeInOutCubic:s,easeInQuart:r,easeOutQuart:f,easeInOutQuart:j,easeInQuint:w,easeOutQuint:i,easeInOutQuint:l,easeInSine:e,easeOutSine:m,easeInOutSine:t,easeInExpo:B,easeOutExpo:c,easeInOutExpo:h,easeInCirc:g,easeOutCirc:n,easeInOutCirc:v,easeInElastic:q,easeOutElastic:x,easeInOutElastic:a,easeInBack:k,easeOutBack:u,easeInOutBack:z,easeInBounce:d,easeOutBounce:b,easeInOutBounce:A}}());(function(x){var t=x.fabric||(x.fabric={}),D=t.util.object.extend,n=t.util.string.capitalize,E=t.util.object.clone,s=t.util.toFixed,v=t.util.parseUnit,A=t.util.multiplyTransformMatrices,p=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,a=/^(symbol|image|marker|pattern|view|svg)$/i,o=/^(?:pattern|defs|symbol|metadata)$/i,b=/^(symbol|g|a|svg)$/i,B={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},i={stroke:"strokeOpacity",fill:"fillOpacity"};t.cssRules={};t.gradientDefs={};function c(F){if(F in B){return B[F]}return F}function k(F,K,I,J){var G=Object.prototype.toString.call(K)==="[object Array]",H;if((F==="fill"||F==="stroke")&&K==="none"){K=""}else{if(F==="strokeDashArray"){K=K.replace(/,/g," ").split(/\s+/).map(function(L){return parseFloat(L)})}else{if(F==="transformMatrix"){if(I&&I.transformMatrix){K=A(I.transformMatrix,t.parseTransformAttribute(K))}else{K=t.parseTransformAttribute(K)}}else{if(F==="visible"){K=(K==="none"||K==="hidden")?false:true;if(I&&I.visible===false){K=false}}else{if(F==="originX"){K=K==="start"?"left":K==="end"?"right":"center"}else{H=G?K.map(v):v(K,J)}}}}}return(!G&&isNaN(H)?K:H)}function e(H){for(var F in i){if(typeof H[i[F]]==="undefined"||H[F]===""){continue}if(typeof H[F]==="undefined"){if(!t.Object.prototype[F]){continue}H[F]=t.Object.prototype[F]}if(H[F].indexOf("url(")===0){continue}var G=new t.Color(H[F]);H[F]=G.setAlpha(s(G.getAlpha()*H[i[F]],2)).toRgba()}return H}t.parseTransformAttribute=(function(){function F(Z,aa){var ab=aa[0],Y=(aa.length===3)?aa[1]:0,ac=(aa.length===3)?aa[2]:0;Z[0]=Math.cos(ab);Z[1]=Math.sin(ab);Z[2]=-Math.sin(ab);Z[3]=Math.cos(ab);Z[4]=Y-(Z[0]*Y+Z[2]*ac);Z[5]=ac-(Z[1]*Y+Z[3]*ac)}function J(aa,ab){var Z=ab[0],Y=(ab.length===2)?ab[1]:ab[0];aa[0]=Z;aa[3]=Y}function W(Y,Z){Y[2]=Math.tan(t.util.degreesToRadians(Z[0]))}function H(Y,Z){Y[1]=Math.tan(t.util.degreesToRadians(Z[0]))}function R(Y,Z){Y[4]=Z[0];if(Z.length===2){Y[5]=Z[1]}}var L=[1,0,0,1,0,0],G=t.reNum,T="(?:\\s+,?\\s*|,\\s*)",M="(?:(skewX)\\s*\\(\\s*("+G+")\\s*\\))",K="(?:(skewY)\\s*\\(\\s*("+G+")\\s*\\))",U="(?:(rotate)\\s*\\(\\s*("+G+")(?:"+T+"("+G+")"+T+"("+G+"))?\\s*\\))",X="(?:(scale)\\s*\\(\\s*("+G+")(?:"+T+"("+G+"))?\\s*\\))",P="(?:(translate)\\s*\\(\\s*("+G+")(?:"+T+"("+G+"))?\\s*\\))",S="(?:(matrix)\\s*\\(\\s*("+G+")"+T+"("+G+")"+T+"("+G+")"+T+"("+G+")"+T+"("+G+")"+T+"("+G+")\\s*\\))",Q="(?:"+S+"|"+P+"|"+X+"|"+U+"|"+M+"|"+K+")",N="(?:"+Q+"(?:"+T+"*"+Q+")*)",V="^\\s*(?:"+N+"?)\\s*$",O=new RegExp(V),I=new RegExp(Q,"g");return function(ab){var Y=L.concat(),Z=[];if(!ab||(ab&&!O.test(ab))){return Y}ab.replace(I,function(af){var ac=new RegExp(Q).exec(af).filter(function(ag){return(ag!==""&&ag!=null)}),ad=ac[1],ae=ac.slice(2).map(parseFloat);switch(ad){case"translate":R(Y,ae);break;case"rotate":ae[0]=t.util.degreesToRadians(ae[0]);F(Y,ae);break;case"scale":J(Y,ae);break;case"skewX":W(Y,ae);break;case"skewY":H(Y,ae);break;case"matrix":Y=ae;break}Z.push(Y.concat());Y=L.concat()});var aa=Z[0];while(Z.length>1){Z.shift();aa=t.util.multiplyTransformMatrices(aa,Z[0])}return aa}})();function u(H,G){var F,I;H.replace(/;\s*$/,"").split(";").forEach(function(J){var K=J.split(":");F=c(K[0].trim().toLowerCase());I=k(F,K[1].trim());G[F]=I})}function r(H,G){var F,I;for(var J in H){if(typeof H[J]==="undefined"){continue}F=c(J.toLowerCase());I=k(F,H[J]);G[F]=I}}function C(G,F){var H={};for(var J in t.cssRules[F]){if(z(G,J.split(" "))){for(var I in t.cssRules[F][J]){H[I]=t.cssRules[F][J][I]}}}return H}function z(H,G){var F,I=true;F=m(H,G.pop());if(F&&G.length){I=q(H,G)}return F&&I&&(G.length===0)}function q(H,G){var F,I=true;while(H.parentNode&&H.parentNode.nodeType===1&&G.length){if(I){F=G.pop()}H=H.parentNode;I=m(H,F)}return G.length===0}function m(H,F){var L=H.nodeName,J=H.getAttribute("class"),K=H.getAttribute("id"),I;I=new RegExp("^"+L,"i");F=F.replace(I,"");if(K&&F.length){I=new RegExp("#"+K+"(?![a-zA-Z\\-]+)","i");F=F.replace(I,"")}if(J&&F.length){J=J.split(" ");for(var G=J.length;G--;){I=new RegExp("\\."+J[G]+"(?![a-zA-Z\\-]+)","i");F=F.replace(I,"")}}return F.length===0}function w(J,K){var G;J.getElementById&&(G=J.getElementById(K));if(G){return G}var I,F,H=J.getElementsByTagName("*");for(F=0;F<H.length;F++){I=H[F];if(K===I.getAttribute("id")){return I}}}function g(S){var U=S.getElementsByTagName("use"),N=0;while(U.length&&N<U.length){var I=U[N],L=I.getAttribute("xlink:href").substr(1),R=I.getAttribute("x")||0,Q=I.getAttribute("y")||0,J=w(S,L).cloneNode(true),F=(J.getAttribute("transform")||"")+" translate("+R+", "+Q+")",O,H=U.length,P,M,T,K;j(J);if(/^svg$/i.test(J.nodeName)){var G=J.ownerDocument.createElement("g");for(M=0,T=J.attributes,K=T.length;M<K;M++){P=T.item(M);G.setAttribute(P.nodeName,P.nodeValue)}while(J.firstChild!=null){G.appendChild(J.firstChild)}J=G}for(M=0,T=I.attributes,K=T.length;M<K;M++){P=T.item(M);if(P.nodeName==="x"||P.nodeName==="y"||P.nodeName==="xlink:href"){continue}if(P.nodeName==="transform"){F=P.nodeValue+" "+F}else{J.setAttribute(P.nodeName,P.nodeValue)}}J.setAttribute("transform",F);J.setAttribute("instantiated_by_use","1");J.removeAttribute("id");O=I.parentNode;O.replaceChild(J,I);if(U.length===H){N++}}}var l=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function j(G){var H=G.getAttribute("viewBox"),X=1,V=1,W=0,U=0,J,P,S,F,O=G.getAttribute("width"),Q=G.getAttribute("height"),K=G.getAttribute("x")||0,I=G.getAttribute("y")||0,L=G.getAttribute("preserveAspectRatio")||"",Y=(!H||!a.test(G.tagName)||!(H=H.match(l))),N=(!O||!Q||O==="100%"||Q==="100%"),R=Y&&N,T={},M="";T.width=0;T.height=0;T.toBeParsed=R;if(R){return T}if(Y){T.width=v(O);T.height=v(Q);return T}W=-parseFloat(H[1]),U=-parseFloat(H[2]),J=parseFloat(H[3]),P=parseFloat(H[4]);if(!N){T.width=v(O);T.height=v(Q);X=T.width/J;V=T.height/P}else{T.width=J;T.height=P}L=t.util.parsePreserveAspectRatioAttribute(L);if(L.alignX!=="none"){V=X=(X>V?V:X)}if(X===1&&V===1&&W===0&&U===0&&K===0&&I===0){return T}if(K||I){M=" translate("+v(K)+" "+v(I)+") "}S=M+" matrix("+X+" 0 0 "+V+" "+(W*X)+" "+(U*V)+") ";if(G.tagName==="svg"){F=G.ownerDocument.createElement("g");while(G.firstChild!=null){F.appendChild(G.firstChild)}G.appendChild(F)}else{F=G;S=F.getAttribute("transform")+S}F.setAttribute("transform",S);return T}t.parseSVGDocument=(function(){function F(G,H){while(G&&(G=G.parentNode)){if(H.test(G.nodeName)&&!G.getAttribute("instantiated_by_use")){return true}}return false}return function(O,P,M){if(!O){return}g(O);var H=new Date(),N=t.Object.__uid++,Q=j(O),I=t.util.toArray(O.getElementsByTagName("*"));Q.svgUid=N;if(I.length===0&&t.isLikelyNode){I=O.selectNodes('//*[name(.)!="svg"]');var K=[];for(var J=0,L=I.length;J<L;J++){K[J]=I[J]}I=K}var G=I.filter(function(R){j(R);return p.test(R.tagName)&&!F(R,o)});if(!G||(G&&!G.length)){P&&P([],{});return}t.gradientDefs[N]=t.getGradientDefs(O);t.cssRules[N]=t.getCSSRules(O);t.parseElements(G,function(R){t.documentParsingTime=new Date()-H;if(P){P(R,Q)}},E(Q),M)}})();var y={has:function(F,G){G(false)},get:function(){},set:function(){}};function f(H){var G=H.objects,F=H.options;G=G.map(function(I){return t[n(I.type)].fromObject(I)});return({objects:G,options:F})}function h(F,G,H){if(G[H]&&G[H].toSVG){F.push('\t<pattern x="0" y="0" id="',H,'Pattern" ','width="',G[H].source.width,'" height="',G[H].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',G[H].source.width,'" height="',G[H].source.height,'" xlink:href="',G[H].source.src,'"></image>\n\t</pattern>\n')}}var d=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");D(t,{parseFontDeclaration:function(L,G){var I=L.match(d);if(!I){return}var M=I[1],H=I[3],K=I[4],J=I[5],F=I[6];if(M){G.fontStyle=M}if(H){G.fontWeight=isNaN(parseFloat(H))?H:parseFloat(H)}if(K){G.fontSize=v(K)}if(F){G.fontFamily=F}if(J){G.lineHeight=J==="normal"?1:J}},getGradientDefs:function(N){var Q=N.getElementsByTagName("linearGradient"),F=N.getElementsByTagName("radialGradient"),H,L,K=0,G,J,M=[],O={},P={};M.length=Q.length+F.length;L=Q.length;while(L--){M[K++]=Q[L]}L=F.length;while(L--){M[K++]=F[L]}while(K--){H=M[K];J=H.getAttribute("xlink:href");G=H.getAttribute("id");if(J){P[G]=J.substr(1)}O[G]=H}for(G in P){var I=O[P[G]].cloneNode(true);H=O[G];while(I.firstChild){H.appendChild(I.firstChild)}}return O},parseAttributes:function(I,H,F){if(!I){return}var L,G={},K;if(typeof F==="undefined"){F=I.getAttribute("svgUid")}if(I.parentNode&&b.test(I.parentNode.nodeName)){G=t.parseAttributes(I.parentNode,H,F)}K=(G&&G.fontSize)||I.getAttribute("font-size")||t.Text.DEFAULT_SVG_FONT_SIZE;var J=H.reduce(function(N,M){L=I.getAttribute(M);if(L){M=c(M);L=k(M,L,G,K);N[M]=L}return N},{});J=D(J,D(C(I,F),t.parseStyleAttribute(I)));if(J.font){t.parseFontDeclaration(J.font,J)}return e(D(G,J))},parseElements:function(H,I,G,F){new t.ElementsParser(H,I,G,F).parse()},parseStyleAttribute:function(G){var F={},H=G.getAttribute("style");if(!H){return F}if(typeof H==="string"){u(H,F)}else{r(H,F)}return F},parsePointsAttribute:function(I){if(!I){return null}I=I.replace(/,/g," ").trim();I=I.split(/\s+/);var G=[],H,F;H=0;F=I.length;for(;H<F;H+=2){G.push({x:parseFloat(I[H]),y:parseFloat(I[H+1])})}return G},getCSSRules:function(K){var I=K.getElementsByTagName("style"),G={},L;for(var H=0,F=I.length;H<F;H++){var J=I[H].textContent||I[H].text;J=J.replace(/\/\*[\s\S]*?\*\//g,"");if(J.trim()===""){continue}L=J.match(/[^{]*\{[\s\S]*?\}/g);L=L.map(function(M){return M.trim()});L.forEach(function(S){var Q=S.match(/([\s\S]*?)\s*\{([^}]*)\}/),O={},M=Q[2].trim(),U=M.replace(/;$/,"").split(/\s*;\s*/);for(var P=0,R=U.length;P<R;P++){var N=U[P].split(/\s*:\s*/),V=c(N[0]),T=k(V,N[1],N[0]);O[V]=T}S=Q[1];S.split(",").forEach(function(W){W=W.replace(/^svg/i,"").trim();if(W===""){return}G[W]=t.util.object.clone(O)})})}return G},loadSVGFromURL:function(G,I,F){G=G.replace(/^\n\s*/,"").trim();y.has(G,function(J){if(J){y.get(G,function(L){var K=f(L);I(K.objects,K.options)})}else{new t.util.request(G,{method:"get",onComplete:H})}});function H(K){var J=K.responseXML;if(J&&!J.documentElement&&t.window.ActiveXObject&&K.responseText){J=new ActiveXObject("Microsoft.XMLDOM");J.async="false";J.loadXML(K.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!J||!J.documentElement){return}t.parseSVGDocument(J.documentElement,function(M,L){y.set(G,{objects:t.util.array.invoke(M,"toObject"),options:L});I(M,L)},F)}},loadSVGFromString:function(G,J,F){G=G.trim();var H;if(typeof DOMParser!=="undefined"){var I=new DOMParser();if(I&&I.parseFromString){H=I.parseFromString(G,"text/xml")}}else{if(t.window.ActiveXObject){H=new ActiveXObject("Microsoft.XMLDOM");H.async="false";H.loadXML(G.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}}t.parseSVGDocument(H.documentElement,function(L,K){J(L,K)},F)},createSVGFontFacesMarkup:function(Q){var R="",M={},K,N,G,S,O,P,F,H=t.fontPaths;for(var J=0,L=Q.length;J<L;J++){K=Q[J];N=K.fontFamily;if(K.type.indexOf("text")===-1||M[N]||!H[N]){continue}M[N]=true;if(!K.styles){continue}G=K.styles;for(O in G){S=G[O];for(F in S){P=S[F];N=P.fontFamily;if(!M[N]&&H[N]){M[N]=true}}}}for(var I in M){R+=["\t\t@font-face {\n","\t\t\tfont-family: '",I,"';\n","\t\t\tsrc: url('",H[I],"');\n","\t\t}\n"].join("")}if(R){R=['\t<style type="text/css">',"<![CDATA[\n",R,"]]>","</style>\n"].join("")}return R},createSVGRefElementsMarkup:function(G){var F=[];h(F,G,"backgroundColor");h(F,G,"overlayColor");return F.join("")}})})(typeof exports!=="undefined"?exports:this);fabric.ElementsParser=function(c,d,b,a){this.elements=c;this.callback=d;this.options=b;this.reviver=a;this.svgUid=(b&&b.svgUid)||0};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var b=0,a=this.elements.length;b<a;b++){this.elements[b].setAttribute("svgUid",this.svgUid);(function(d,c){setTimeout(function(){d.createObject(d.elements[c],c)},0)})(this,b)}};fabric.ElementsParser.prototype.createObject=function(c,b){var a=fabric[fabric.util.string.capitalize(c.tagName)];if(a&&a.fromElement){try{this._createObject(a,c,b)}catch(d){fabric.log(d)}}else{this.checkIfDone()}};fabric.ElementsParser.prototype._createObject=function(a,c,b){if(a.async){a.fromElement(c,this.createCallback(b,c),this.options)}else{var d=a.fromElement(c,this.options);this.resolveGradient(d,"fill");this.resolveGradient(d,"stroke");this.reviver&&this.reviver(c,d);this.instances[b]=d;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill");c.resolveGradient(d,"stroke");c.reviver&&c.reviver(b,d);c.instances[a]=d;c.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(d,c){var a=d.get(c);if(!(/^url\(/).test(a)){return}var b=a.slice(5,a.length-1);if(fabric.gradientDefs[this.svgUid][b]){d.set(c,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][b],d))}};fabric.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(a){return a!=null});this.callback(this.instances)}};(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){this.x=d;this.y=e}a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return new a(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){this.status=d;this.points=[]}b.Intersection=c;b.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}};b.Intersection.intersectLineLine=function(h,g,l,k){var m,e=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(g.x-h.x)*(h.y-l.y)-(g.y-h.y)*(h.x-l.x),i=(k.y-l.y)*(g.x-h.x)-(k.x-l.x)*(g.y-h.y);if(i!==0){var f=e/i,d=j/i;if(0<=f&&f<=1&&0<=d&&d<=1){m=new c("Intersection");m.points.push(new b.Point(h.x+f*(g.x-h.x),h.y+f*(g.y-h.y)))}else{m=new c()}}else{if(e===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c(),f=l.length;for(var h=0;h<f;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c(),l=j.length;for(var k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c();o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Color){c.warn("fabric.Color is already defined.");return}function d(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}c.Color=d;c.Color.prototype={_tryParsingColor:function(e){var f;if(e in d.colorNameMap){e=d.colorNameMap[e]}if(e==="transparent"){f=[255,255,255,0]}if(!f){f=d.sourceFromHex(e)}if(!f){f=d.sourceFromRgb(e)}if(!f){f=d.sourceFromHsl(e)}if(!f){f=[0,0,0,1]}if(f){this.setSource(f)}},_rgbToHsl:function(e,k,n){e/=255,k/=255,n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);f=(o+i)/2;if(o===i){j=p=0}else{var m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break}j/=6}return[Math.round(j*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var i=this.getSource(),h,f,e;h=i[0].toString(16);h=(h.length===1)?("0"+h):h;f=i[1].toString(16);f=(f.length===1)?("0"+f):f;e=i[2].toString(16);e=(e.length===1)?("0"+e):e;return h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();e[3]=f;this.setSource(e);return this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),e=g[3];this.setSource([f,f,f,e]);return this},toBlackWhite:function(e){var h=this.getSource(),g=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0),f=h[3];e=e||127;g=(Number(g)<Number(e))?0:255;this.setSource([g,g,g,f]);return this},overlayWith:function(l){if(!(l instanceof d)){l=new d(l)}var e=[],k=this.getAlpha(),h=0.5,j=this.getSource(),f=l.getSource();for(var g=0;g<3;g++){e.push(Math.round((j[g]*(1-h))+(f[g]*h)))}e[3]=k;this.setSource(e);return this}};c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function a(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g}c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))};c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}};c.Color.fromRgba=d.fromRgb;c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))};c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(!n){return}var m=(((parseFloat(n[1])%360)+360)%360)/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1),e,o,t;if(u===0){e=o=t=j}else{var f=j<=0.5?j*(u+1):j+u-j*u,i=j*2-f;e=a(i,f,m+1/3);o=a(i,f,m);t=a(i,f,m-1/3)}return[Math.round(e*255),Math.round(o*255),Math.round(t*255),n[4]?parseFloat(n[4]):1]};c.Color.fromHsla=d.fromHsl;c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))};c.Color.sourceFromHex=function(h){if(h.match(d.reHex)){var k=h.slice(h.indexOf("#")+1),f=(k.length===3),j=f?(k.charAt(0)+k.charAt(0)):k.substring(0,2),i=f?(k.charAt(1)+k.charAt(1)):k.substring(2,4),e=f?(k.charAt(2)+k.charAt(2)):k.substring(4,6);return[parseInt(j,16),parseInt(i,16),parseInt(e,16),1]}};c.Color.fromSource=function(e){var f=new d();f.setSource(e);return f}})(typeof exports!=="undefined"?exports:this);(function(){function d(f){var e=f.getAttribute("style"),h=f.getAttribute("offset")||0,g,m,l;h=parseFloat(h)/(/%$/.test(h)?100:1);h=h<0?0:h>1?1:h;if(e){var k=e.split(/\s*;\s*/);if(k[k.length-1]===""){k.pop()}for(var j=k.length;j--;){var n=k[j].split(/\s*:\s*/),p=n[0].trim(),o=n[1].trim();if(p==="stop-color"){g=o}else{if(p==="stop-opacity"){l=o}}}}if(!g){g=f.getAttribute("stop-color")||"rgb(0,0,0)"}if(!l){l=f.getAttribute("stop-opacity")}g=new fabric.Color(g);m=g.getAlpha();l=isNaN(parseFloat(l))?1:parseFloat(l);l*=m;return{offset:h,color:g.toRgb(),opacity:l}}function b(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}function c(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(e){e||(e={});var f={};this.id=fabric.Object.__uid++;this.type=e.type||"linear";f={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0};if(this.type==="radial"){f.r1=e.coords.r1||0;f.r2=e.coords.r2||0}this.coords=f;this.colorStops=e.colorStops.slice();if(e.gradientTransform){this.gradientTransform=e.gradientTransform}this.offsetX=e.offsetX||this.offsetX;this.offsetY=e.offsetY||this.offsetY},addColorStop:function(f){for(var e in f){var g=new fabric.Color(f[e]);this.colorStops.push({offset:e,color:g.toRgb(),opacity:g.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(g){var j=fabric.util.object.clone(this.coords),f,e;this.colorStops.sort(function(l,i){return l.offset-i.offset});if(!(g.group&&g.group.type==="path-group")){for(var k in j){if(k==="x1"||k==="x2"||k==="r2"){j[k]+=this.offsetX-g.width/2}else{if(k==="y1"||k==="y2"){j[k]+=this.offsetY-g.height/2}}}}e='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';if(this.gradientTransform){e+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '}if(this.type==="linear"){f=["<linearGradient ",e,' x1="',j.x1,'" y1="',j.y1,'" x2="',j.x2,'" y2="',j.y2,'">\n']}else{if(this.type==="radial"){f=["<radialGradient ",e,' cx="',j.x2,'" cy="',j.y2,'" r="',j.r2,'" fx="',j.x1,'" fy="',j.y1,'">\n']}}for(var h=0;h<this.colorStops.length;h++){f.push("<stop ",'offset="',(this.colorStops[h].offset*100)+"%",'" style="stop-color:',this.colorStops[h].color,(this.colorStops[h].opacity!=null?";stop-opacity: "+this.colorStops[h].opacity:";"),'"/>\n')}f.push((this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n"));return f.join("")},toLive:function(o,f){var m,e,n=fabric.util.object.clone(this.coords);if(!this.type){return}if(f.group&&f.group.type==="path-group"){for(e in n){if(e==="x1"||e==="x2"){n[e]+=-this.offsetX+f.width/2}else{if(e==="y1"||e==="y2"){n[e]+=-this.offsetY+f.height/2}}}}if(this.type==="linear"){m=o.createLinearGradient(n.x1,n.y1,n.x2,n.y2)}else{if(this.type==="radial"){m=o.createRadialGradient(n.x1,n.y1,n.r1,n.x2,n.y2,n.r2)}}for(var j=0,l=this.colorStops.length;j<l;j++){var g=this.colorStops[j].color,k=this.colorStops[j].opacity,h=this.colorStops[j].offset;if(typeof k!=="undefined"){g=new fabric.Color(g).setAlpha(k).toRgba()}m.addColorStop(parseFloat(h),g)}return m}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(f,p){var n=f.getElementsByTagName("stop"),l=(f.nodeName==="linearGradient"?"linear":"radial"),h=f.getAttribute("gradientUnits")||"objectBoundingBox",e=f.getAttribute("gradientTransform"),g=[],o={},k;if(l==="linear"){o=b(f)}else{if(l==="radial"){o=c(f)}}for(var j=n.length;j--;){g.push(d(n[j]))}k=a(p,o,h);var m=new fabric.Gradient({type:l,coords:o,colorStops:g,offsetX:-p.left,offsetY:-p.top});if(e||k!==""){m.gradientTransform=fabric.parseTransformAttribute((e||"")+k)}return m},forObject:function(f,e){e||(e={});a(f,e.coords,"userSpaceOnUse");return new fabric.Gradient(e)}});function a(h,m,g){var f,l=0,k=1,i="";for(var e in m){f=parseFloat(m[e],10);if(typeof m[e]==="string"&&/^\d+%$/.test(m[e])){k=0.01}else{k=1}if(e==="x1"||e==="x2"||e==="r2"){k*=g==="objectBoundingBox"?h.width:1;l=g==="objectBoundingBox"?h.left||0:0}else{if(e==="y1"||e==="y2"){k*=g==="objectBoundingBox"?h.height:1;l=g==="objectBoundingBox"?h.top||0:0}}m[e]=f*k+l}if(h.type==="ellipse"&&m.r2!==null&&g==="objectBoundingBox"&&h.rx!==h.ry){var j=h.ry/h.rx;i=" scale(1, "+j+")";if(m.y1){m.y1/=j}if(m.y2){m.y2/=j}}return i}})();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){a||(a={});this.id=fabric.Object.__uid++;if(a.source){if(typeof a.source==="string"){if(typeof fabric.util.getFunctionBody(a.source)!=="undefined"){this.source=new Function(fabric.util.getFunctionBody(a.source))}else{var b=this;this.source=fabric.util.createImage();fabric.util.loadImage(a.source,function(c){b.source=c})}}else{this.source=a.source}}if(a.repeat){this.repeat=a.repeat}if(a.offsetX){this.offsetX=a.offsetX}if(a.offsetY){this.offsetY=a.offsetY}},toObject:function(){var a;if(typeof this.source==="function"){a=String(this.source)}else{if(typeof this.source.src==="string"){a=this.source.src}else{if(typeof this.source==="object"&&this.source.toDataURL){a=this.source.toDataURL()}}}return{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(b){var a=typeof this.source==="function"?this.source():this.source,f=a.width/b.getWidth(),d=a.height/b.getHeight(),e=this.offsetX/b.getWidth(),c=this.offsetY/b.getHeight(),g="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat"){d=1}if(this.repeat==="repeat-y"||this.repeat==="no-repeat"){f=1}if(a.src){g=a.src}else{if(a.toDataURL){g=a.toDataURL()}}return'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+c+'" width="'+f+'" height="'+d+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},toLive:function(a){var b=typeof this.source==="function"?this.source():this.source;if(!b){return""}if(typeof b.src!=="undefined"){if(!b.complete){return""}if(b.naturalWidth===0||b.naturalHeight===0){return""}}return a.createPattern(b,this.repeat)}});(function(b){var c=b.fabric||(b.fabric={}),a=c.util.toFixed;if(c.Shadow){c.warn("fabric.Shadow is already defined.");return}c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,initialize:function(d){if(typeof d==="string"){d=this._parseShadow(d)}for(var e in d){this[e]=d[e]}this.id=c.Object.__uid++},_parseShadow:function(g){var f=g.trim(),e=c.Shadow.reOffsetsAndBlur.exec(f)||[],d=f.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:d.trim(),offsetX:parseInt(e[1],10)||0,offsetY:parseInt(e[2],10)||0,blur:parseInt(e[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var d=40,i=40,f=c.Object.NUM_FRACTION_DIGITS,h=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-e.angle)),g=20;if(e.width&&e.height){d=a((Math.abs(h.x)+this.blur)/e.width,f)*100+g;i=a((Math.abs(h.y)+this.blur)/e.height,f)*100+g}if(e.flipX){h.x*=-1}if(e.flipY){h.y*=-1}return('<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+a(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+a(h.x,f)+'" dy="'+a(h.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke}}var e={},d=c.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke"].forEach(function(f){if(this[f]!==d[f]){e[f]=this[f]}},this);return e}});c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,c=fabric.util.getElementOffset,d=fabric.util.removeFromArray,a=fabric.util.toFixed,b=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(g,f){f||(f={});this._initStatic(g,f)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,preserveObjectStacking:false,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:true,_initStatic:function(g,f){this._objects=[];this._createLowerCanvas(g);this._initOptions(f);this._setImageSmoothing();if(!this.interactive){this._initRetinaScaling()}if(f.overlayImage){this.setOverlayImage(f.overlayImage,this.renderAll.bind(this))}if(f.backgroundImage){this.setBackgroundImage(f.backgroundImage,this.renderAll.bind(this))}if(f.backgroundColor){this.setBackgroundColor(f.backgroundColor,this.renderAll.bind(this))}if(f.overlayColor){this.setOverlayColor(f.overlayColor,this.renderAll.bind(this))}this.calcOffset()},_isRetinaScaling:function(){return(fabric.devicePixelRatio!==1&&this.enableRetinaScaling)},_initRetinaScaling:function(){if(!this._isRetinaScaling()){return}this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio);this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio);this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio)},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(g,h,f){return this.__setBgOverlayImage("overlayImage",g,h,f)},setBackgroundImage:function(g,h,f){return this.__setBgOverlayImage("backgroundImage",g,h,f)},setOverlayColor:function(g,f){return this.__setBgOverlayColor("overlayColor",g,f)},setBackgroundColor:function(f,g){return this.__setBgOverlayColor("backgroundColor",f,g)},_setImageSmoothing:function(){var f=this.getContext();f.imageSmoothingEnabled=f.imageSmoothingEnabled||f.webkitImageSmoothingEnabled||f.mozImageSmoothingEnabled||f.msImageSmoothingEnabled||f.oImageSmoothingEnabled;f.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(g,h,i,f){if(typeof h==="string"){fabric.util.loadImage(h,function(j){this[g]=new fabric.Image(j,f);i&&i(j)},this,f&&f.crossOrigin)}else{f&&h.setOptions(f);this[g]=h;i&&i(h)}return this},__setBgOverlayColor:function(g,f,i){if(f&&f.source){var h=this;fabric.util.loadImage(f.source,function(j){h[g]=new fabric.Pattern({source:j,repeat:f.repeat,offsetX:f.offsetX,offsetY:f.offsetY});i&&i()})}else{this[g]=f;i&&i()}return this},_createCanvasElement:function(){var f=fabric.document.createElement("canvas");if(!f.style){f.style={}}if(!f){throw b}this._initCanvasElement(f);return f},_initCanvasElement:function(f){fabric.util.createCanvasElement(f);if(typeof f.getContext==="undefined"){throw b}},_initOptions:function(f){for(var g in f){this[g]=f[g]}this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.width=this.width;this.lowerCanvasEl.height=this.height;this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px";this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(f){this.lowerCanvasEl=fabric.util.getById(f)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,f){return this.setDimensions({width:g},f)},setHeight:function(g,f){return this.setDimensions({height:g},f)},setDimensions:function(h,g){var f;g=g||{};for(var i in h){f=h[i];if(!g.cssOnly){this._setBackstoreDimension(i,h[i]);f+="px"}if(!g.backstoreOnly){this._setCssDimension(i,f)}}this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();if(!g.cssOnly){this.renderAll()}return this},_setBackstoreDimension:function(g,f){this.lowerCanvasEl[g]=f;if(this.upperCanvasEl){this.upperCanvasEl[g]=f}if(this.cacheCanvasEl){this.cacheCanvasEl[g]=f}this[g]=f;return this},_setCssDimension:function(g,f){this.lowerCanvasEl.style[g]=f;if(this.upperCanvasEl){this.upperCanvasEl.style[g]=f}if(this.wrapperEl){this.wrapperEl.style[g]=f}return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(j){var h=this.getActiveGroup();this.viewportTransform=j;this.renderAll();for(var g=0,f=this._objects.length;g<f;g++){this._objects[g].setCoords()}if(h){h.setCoords()}return this},zoomToPoint:function(g,k){var j=g;g=fabric.util.transformPoint(g,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=k;this.viewportTransform[3]=k;var l=fabric.util.transformPoint(g,this.viewportTransform);this.viewportTransform[4]+=j.x-l.x;this.viewportTransform[5]+=j.y-l.y;this.renderAll();for(var h=0,f=this._objects.length;h<f;h++){this._objects[h].setCoords()}return this},setZoom:function(f){this.zoomToPoint(new fabric.Point(0,0),f);return this},absolutePan:function(g){this.viewportTransform[4]=-g.x;this.viewportTransform[5]=-g.y;this.renderAll();for(var h=0,f=this._objects.length;h<f;h++){this._objects[h].setCoords()}return this},relativePan:function(f){return this.absolutePan(new fabric.Point(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_onObjectAdded:function(f){this.stateful&&f.setupState();f._set("canvas",this);f.setCoords();this.fire("object:added",{target:f});f.fire("added")},_onObjectRemoved:function(f){if(this.getActiveObject()===f){this.fire("before:selection:cleared",{target:f});this._discardActiveObject();this.fire("selection:cleared")}this.fire("object:removed",{target:f});f.fire("removed")},clearContext:function(f){f.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire("canvas:cleared");this.renderAll();return this},_chooseObjectsToRender:function(){var j=this.getActiveGroup(),g,l=[],f=[];if(j&&!this.preserveObjectStacking){for(var h=0,k=this._objects.length;h<k;h++){g=this._objects[h];if(!j.contains(g)){l.push(g)}else{f.push(g)}}j._set("_objects",f)}else{l=this._objects}return l},renderAll:function(){var f=this.contextContainer,g;if(this.contextTop&&this.selection&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop)}this.clearContext(f);this.fire("before:render");if(this.clipTo){fabric.util.clipContext(this,f)}this._renderBackground(f);f.save();g=this._chooseObjectsToRender();f.transform.apply(f,this.viewportTransform);this._renderObjects(f,g);this.preserveObjectStacking||this._renderObjects(f,[this.getActiveGroup()]);f.restore();if(!this.controlsAboveOverlay&&this.interactive){this.drawControls(f)}if(this.clipTo){f.restore()}this._renderOverlay(f);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(f)}this.fire("after:render");return this},_renderObjects:function(f,j){for(var g=0,h=j.length;g<h;++g){j[g]&&j[g].render(f)}},_renderBackgroundOrOverlay:function(f,h){var g=this[h+"Color"];if(g){f.fillStyle=g.toLive?g.toLive(f):g;f.fillRect(g.offsetX||0,g.offsetY||0,this.width,this.height)}g=this[h+"Image"];if(g){g.render(f)}},_renderBackground:function(f){this._renderBackgroundOrOverlay(f,"background")},_renderOverlay:function(f){this._renderBackgroundOrOverlay(f,"overlay")},renderTop:function(){var f=this.contextTop||this.contextContainer;this.clearContext(f);if(this.selection&&this._groupSelector){this._drawSelection()}this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){this._centerObject(f,new fabric.Point(this.getCenter().left,f.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(f){this._centerObject(f,new fabric.Point(f.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(g){var f=this.getCenter();this._centerObject(g,new fabric.Point(f.left,f.top));this.renderAll();return this},_centerObject:function(g,f){g.setPositionByOrigin(f,"center","center");return this},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,h){var g={objects:this._toObjects(f,h)};e(g,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,g,h);return g},_toObjects:function(f,g){return this.getObjects().map(function(h){return this._toObject(h,f,g)},this)},_toObject:function(f,h,k){var g;if(!this.includeDefaultValues){g=f.includeDefaultValues;f.includeDefaultValues=false}var j=this._realizeGroupTransformOnObject(f),i=f[h](k);if(!this.includeDefaultValues){f.includeDefaultValues=g}this._unwindGroupTransformOnObject(f,j);return i},_realizeGroupTransformOnObject:function(f){var g=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(f.group&&f.group===this.getActiveGroup()){var h={};g.forEach(function(i){h[i]=f[i]});this.getActiveGroup().realizeTransform(f);return h}else{return null}},_unwindGroupTransformOnObject:function(f,g){if(g){f.set(g)}},__serializeBgOverlay:function(){var f={background:(this.backgroundColor&&this.backgroundColor.toObject)?this.backgroundColor.toObject():this.backgroundColor};if(this.overlayColor){f.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor}if(this.backgroundImage){f.backgroundImage=this.backgroundImage.toObject()}if(this.overlayImage){f.overlayImage=this.overlayImage.toObject()}return f},svgViewportTransformation:true,toSVG:function(h,f){h||(h={});var g=[];this._setSVGPreamble(g,h);this._setSVGHeader(g,h);this._setSVGBgOverlayColor(g,"backgroundColor");this._setSVGBgOverlayImage(g,"backgroundImage");this._setSVGObjects(g,f);this._setSVGBgOverlayColor(g,"overlayColor");this._setSVGBgOverlayImage(g,"overlayImage");g.push("</svg>");return g.join("")},_setSVGPreamble:function(f,g){if(g.suppressPreamble){return}f.push('<?xml version="1.0" encoding="',(g.encoding||"UTF-8"),'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(g,h){var j=h.width||this.width,f=h.height||this.height,l,k='viewBox="0 0 '+this.width+" "+this.height+'" ',i=fabric.Object.NUM_FRACTION_DIGITS;if(h.viewBox){k='viewBox="'+h.viewBox.x+" "+h.viewBox.y+" "+h.viewBox.width+" "+h.viewBox.height+'" '}else{if(this.svgViewportTransformation){l=this.viewportTransform;k='viewBox="'+a(-l[4]/l[0],i)+" "+a(-l[5]/l[3],i)+" "+a(this.width/l[0],i)+" "+a(this.height/l[3],i)+'" '}}g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',j,'" ','height="',f,'" ',(this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null),k,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(j,h){for(var k=0,l=this.getObjects(),g=l.length;k<g;k++){var f=l[k],m=this._realizeGroupTransformOnObject(f);j.push(f.toSVG(h));this._unwindGroupTransformOnObject(f,m)}},_setSVGBgOverlayImage:function(f,g){if(this[g]&&this[g].toSVG){f.push(this[g].toSVG())}},_setSVGBgOverlayColor:function(f,g){if(this[g]&&this[g].source){f.push('<rect x="',this[g].offsetX,'" y="',this[g].offsetY,'" ','width="',(this[g].repeat==="repeat-y"||this[g].repeat==="no-repeat"?this[g].source.width:this.width),'" height="',(this[g].repeat==="repeat-x"||this[g].repeat==="no-repeat"?this[g].source.height:this.height),'" fill="url(#'+g+'Pattern)"',"></rect>\n")}else{if(this[g]&&g==="overlayColor"){f.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[g],'"',"></rect>\n")}}},sendToBack:function(f){if(!f){return this}var h=this.getActiveGroup?this.getActiveGroup():null,g,j,k;if(f===h){k=h._objects;for(g=k.length;g--;){j=k[g];d(this._objects,j);this._objects.unshift(j)}}else{d(this._objects,f);this._objects.unshift(f)}return this.renderAll&&this.renderAll()},bringToFront:function(f){if(!f){return this}var h=this.getActiveGroup?this.getActiveGroup():null,g,j,k;if(f===h){k=h._objects;for(g=0;g<k.length;g++){j=k[g];d(this._objects,j);this._objects.push(j)}}else{d(this._objects,f);this._objects.push(f)}return this.renderAll&&this.renderAll()},sendBackwards:function(g,j){if(!g){return this}var l=this.getActiveGroup?this.getActiveGroup():null,h,m,f,k,n;if(g===l){n=l._objects;for(h=0;h<n.length;h++){m=n[h];f=this._objects.indexOf(m);if(f!==0){k=f-1;d(this._objects,m);this._objects.splice(k,0,m)}}}else{f=this._objects.indexOf(g);if(f!==0){k=this._findNewLowerIndex(g,f,j);d(this._objects,g);this._objects.splice(k,0,g)}}this.renderAll&&this.renderAll();return this},_findNewLowerIndex:function(h,f,k){var l;if(k){l=f;for(var j=f-1;j>=0;--j){var g=h.intersectsWithObject(this._objects[j])||h.isContainedWithinObject(this._objects[j])||this._objects[j].isContainedWithinObject(h);if(g){l=j;break}}}else{l=f-1}return l},bringForward:function(g,j){if(!g){return this}var l=this.getActiveGroup?this.getActiveGroup():null,h,m,f,k,n;if(g===l){n=l._objects;for(h=n.length;h--;){m=n[h];f=this._objects.indexOf(m);if(f!==this._objects.length-1){k=f+1;d(this._objects,m);this._objects.splice(k,0,m)}}}else{f=this._objects.indexOf(g);if(f!==this._objects.length-1){k=this._findNewUpperIndex(g,f,j);d(this._objects,g);this._objects.splice(k,0,g)}}this.renderAll&&this.renderAll();return this},_findNewUpperIndex:function(h,f,k){var l;if(k){l=f;for(var j=f+1;j<this._objects.length;++j){var g=h.intersectsWithObject(this._objects[j])||h.isContainedWithinObject(this._objects[j])||this._objects[j].isContainedWithinObject(h);if(g){l=j;break}}}else{l=f+1}return l},moveTo:function(g,f){d(this._objects,g);this._objects.splice(f,0,g);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var h=fabric.util.createCanvasElement();if(!h||!h.getContext){return null}var f=h.getContext("2d");if(!f){return null}switch(g){case"getImageData":return typeof f.getImageData!=="undefined";case"setLineDash":return typeof f.setLineDash!=="undefined";case"toDataURL":return typeof h.toDataURL!=="undefined";case"toDataURLWithQuality":try{h.toDataURL("image/jpeg",0);return true}catch(i){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(a){this.shadow=new fabric.Shadow(a);return this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color;a.lineWidth=this.width;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin;if(this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")){a.setLineDash(this.strokeDashArray)}},_setShadow:function(){if(!this.shadow){return}var a=this.canvas.contextTop;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur;a.shadowOffsetX=this.shadow.offsetX;a.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a;this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a);this._captureDrawingPath(a);this._render()},onMouseMove:function(a){this._captureDrawingPath(a);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(b){var a=new fabric.Point(b.x,b.y);this._reset();this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);this._addPoint(b)},_render:function(){var b=this.canvas.contextTop,c=this.canvas.viewportTransform,f=this._points[0],e=this._points[1];b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);b.beginPath();if(this._points.length===2&&f.x===e.x&&f.y===e.y){f.x-=0.5;e.x+=0.5}b.moveTo(f.x,f.y);for(var d=1,a=this._points.length;d<a;d++){var g=f.midPointFrom(e);b.quadraticCurveTo(f.x,f.y,g.x,g.y);f=this._points[d];e=this._points[d+1]}b.lineTo(f.x,f.y);b.stroke();b.restore()},convertPointsToSVGPath:function(c){var e=[],f=new fabric.Point(c[0].x,c[0].y),d=new fabric.Point(c[1].x,c[1].y);e.push("M ",c[0].x," ",c[0].y," ");for(var b=1,a=c.length;b<a;b++){var g=f.midPointFrom(d);e.push("Q ",f.x," ",f.y," ",g.x," ",g.y," ");f=new fabric.Point(c[b].x,c[b].y);if((b+1)<c.length){d=new fabric.Point(c[b+1].x,c[b+1].y)}}e.push("L ",f.x," ",f.y," ");return e},createPath:function(b){var a=new fabric.Path(b,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});if(this.shadow){this.shadow.affectStroke=true;a.setShadow(this.shadow)}return a},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var c=this.convertPointsToSVGPath(this._points).join("");if(c==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var b=this.createPath(c);this.canvas.add(b);b.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:b})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a;this.points=[]},drawDot:function(d){var a=this.addPoint(d),b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);b.fillStyle=a.fill;b.beginPath();b.arc(a.x,a.y,a.radius,0,Math.PI*2,false);b.closePath();b.fill();b.restore()},onMouseDown:function(a){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var f=[];for(var c=0,b=this.points.length;c<b;c++){var a=this.points[c],e=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&e.setShadow(this.shadow);f.push(e)}var d=new fabric.Group(f,{originX:"center",originY:"center"});d.canvas=this.canvas;this.canvas.add(d);this.canvas.fire("path:created",{path:d});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=g;this.canvas.renderAll()},addPoint:function(c){var d=new fabric.Point(c.x,c.y),a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=b;this.points.push(d);return d}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(a){this.canvas=a;this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(a);this.render()},onMouseMove:function(a){this.addSprayChunk(a);this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var h=[];for(var c=0,a=this.sprayChunks.length;c<a;c++){var d=this.sprayChunks[c];for(var b=0,k=d.length;b<k;b++){var f=new fabric.Rect({width:d[b].width,height:d[b].width,left:d[b].x+1,top:d[b].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&f.setShadow(this.shadow);h.push(f)}}if(this.optimizeOverlapping){h=this._getOptimizedRects(h)}var g=new fabric.Group(h,{originX:"center",originY:"center"});g.canvas=this.canvas;this.canvas.add(g);this.canvas.fire("path:created",{path:g});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(c){var b={},e;for(var d=0,a=c.length;d<a;d++){e=c[d].left+""+c[d].top;if(!b[e]){b[e]=c[d]}}var f=[];for(e in b){f.push(b[e])}return f},render:function(){var c=this.canvas.contextTop;c.fillStyle=this.color;var d=this.canvas.viewportTransform;c.save();c.transform(d[0],d[1],d[2],d[3],d[4],d[5]);for(var e=0,b=this.sprayChunkPoints.length;e<b;e++){var a=this.sprayChunkPoints[e];if(typeof a.opacity!=="undefined"){c.globalAlpha=a.opacity}c.fillRect(a.x,a.y,a.width,a.width)}c.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var c,g,e,b=this.width/2;for(var d=0;d<this.density;d++){c=fabric.util.getRandomInt(f.x-b,f.x+b);g=fabric.util.getRandomInt(f.y-b,f.y+b);if(this.dotWidthVariance){e=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{e=this.dotWidth}var a=new fabric.Point(c,g);a.width=e;if(this.randomOpacity){a.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=20,b=5,c=fabric.document.createElement("canvas"),a=c.getContext("2d");c.width=c.height=d+b;a.fillStyle=this.color;a.beginPath();a.arc(d/2,d/2,d/2,0,Math.PI*2,false);a.closePath();a.fill();return c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(b){var a=this.callSuper("createPath",b);a.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return a}});(function(){var c=fabric.util.getPointer,d=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees,e=Math.atan2,b=Math.abs,a=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(i,h){h||(h={});this._initStatic(i,h);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:false,uniScaleKey:"shiftKey",centeredScaling:false,centeredRotation:false,centeredKey:"altKey",altActionKey:"shiftKey",interactive:true,selection:true,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(){var h=this._currentTransform;h.target.set({scaleX:h.original.scaleX,scaleY:h.original.scaleY,skewX:h.original.skewX,skewY:h.original.skewY,left:h.original.left,top:h.original.top});if(this._shouldCenterTransform(h.target)){if(h.action==="rotate"){this._setOriginToCenter(h.target)}else{if(h.originX!=="center"){if(h.originX==="right"){h.mouseXSign=-1}else{h.mouseXSign=1}}if(h.originY!=="center"){if(h.originY==="bottom"){h.mouseYSign=-1}else{h.mouseYSign=1}}h.originX="center";h.originY="center"}}else{h.originX=h.original.originX;h.originY=h.original.originY}},containsPoint:function(j,i){var k=this.getPointer(j,true),h=this._normalizePointer(i,k);return(i.containsPoint(h)||i._findTargetCorner(k))},_normalizePointer:function(j,n){var l=this.getActiveGroup(),k=(l&&j.type!=="group"&&l.contains(j)),i,h;if(k){h=fabric.util.multiplyTransformMatrices(this.viewportTransform,l.calcTransformMatrix());h=fabric.util.invertTransform(h);n=fabric.util.transformPoint(n,h,false);i=fabric.util.transformPoint(l.getCenterPoint(),h,false);n.x-=i.x;n.y-=i.y}return{x:n.x,y:n.y}},isTargetTransparent:function(n,h,o){var k=n.hasBorders,l=n.transparentCorners,j=this.contextCache,i=n.group&&n.group===this.getActiveGroup();n.hasBorders=n.transparentCorners=false;if(i){j.save();j.transform.apply(j,n.group.calcTransformMatrix())}n.render(j);n.active&&n._renderControls(j);n.hasBorders=k;n.transparentCorners=l;var m=fabric.util.isTransparent(j,h,o,this.targetFindTolerance);i&&j.restore();this.clearContext(j);return m},_shouldClearSelection:function(k,j){var i=this.getActiveGroup(),h=this.getActiveObject();return(!j||(j&&i&&!i.contains(j)&&i!==j&&!k[this.selectionKey])||(j&&!j.evented)||(j&&!j.selectable&&h&&h!==j))},_shouldCenterTransform:function(j){if(!j){return}var i=this._currentTransform,h;if(i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"){h=this.centeredScaling||j.centeredScaling}else{if(i.action==="rotate"){h=this.centeredRotation||j.centeredRotation}}return h?!i.altKey:i.altKey},_getOriginFromCorner:function(j,i){var h={x:j.originX,y:j.originY};if(i==="ml"||i==="tl"||i==="bl"){h.x="right"}else{if(i==="mr"||i==="tr"||i==="br"){h.x="left"}}if(i==="tl"||i==="mt"||i==="tr"){h.y="bottom"}else{if(i==="bl"||i==="mb"||i==="br"){h.y="top"}}return h},_getActionFromCorner:function(j,h,i){if(!h){return"drag"}switch(h){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(l,k){if(!k){return}var m=this.getPointer(l),i=k._findTargetCorner(this.getPointer(l,true)),j=this._getActionFromCorner(k,i,l),h=this._getOriginFromCorner(k,i);this._currentTransform={target:k,action:j,corner:i,scaleX:k.scaleX,scaleY:k.scaleY,skewX:k.skewX,skewY:k.skewY,offsetX:m.x-k.left,offsetY:m.y-k.top,originX:h.x,originY:h.y,ex:m.x,ey:m.y,lastX:m.x,lastY:m.y,left:k.left,top:k.top,theta:d(k.angle),width:k.width*k.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:l.shiftKey,altKey:l[this.centeredKey]};this._currentTransform.original={left:k.left,top:k.top,scaleX:k.scaleX,scaleY:k.scaleY,skewX:k.skewX,skewY:k.skewY,originX:h.x,originY:h.y};this._resetCurrentTransform()},_translateObject:function(h,o){var j=this._currentTransform,n=j.target,m=h-j.offsetX,i=o-j.offsetY,l=!n.get("lockMovementX")&&n.left!==m,k=!n.get("lockMovementY")&&n.top!==i;l&&n.set("left",m);k&&n.set("top",i);return l||k},_changeSkewTransformOrigin:function(m,o,i){var l="originX",j={0:"center"},q=o.target.skewX,p="left",n="right",k=o.corner==="mt"||o.corner==="ml"?1:-1,h=1;m=m>0?1:-1;if(i==="y"){q=o.target.skewY;p="top";n="bottom";l="originY"}j[-1]=p;j[1]=n;o.target.flipX&&(h*=-1);o.target.flipY&&(h*=-1);if(q===0){o.skewSign=-k*m*h;o[l]=j[-m]}else{q=q>0?1:-1;o.skewSign=q;o[l]=j[q*k*h]}},_skewObject:function(q,p,n){var s=this._currentTransform,m=s.target,v=false,j=m.get("lockSkewingX"),i=m.get("lockSkewingY");if((j&&n==="x")||(i&&n==="y")){return false}var h=m.getCenterPoint(),r=m.toLocalPoint(new fabric.Point(q,p),"center","center")[n],u=m.toLocalPoint(new fabric.Point(s.lastX,s.lastY),"center","center")[n],o,k,l=m._getTransformedDimensions();this._changeSkewTransformOrigin(r-u,s,n);o=m.toLocalPoint(new fabric.Point(q,p),s.originX,s.originY)[n],k=m.translateToOriginPoint(h,s.originX,s.originY);v=this._setObjectSkew(o,s,n,l);s.lastX=q;s.lastY=p;m.setPositionByOrigin(k,s.originX,s.originY);return v},_setObjectSkew:function(r,j,o,p){var n=j.target,h,w=false,m=j.skewSign,l,i,v,u,k,q,t,s;if(o==="x"){v="y";u="Y";k="X";t=0;s=n.skewY}else{v="x";u="X";k="Y";t=n.skewX;s=0}i=n._getTransformedDimensions(t,s);q=2*Math.abs(r)-i[o];if(q<=2){h=0}else{h=m*Math.atan((q/n["scale"+k])/(i[v]/n["scale"+u]));h=fabric.util.radiansToDegrees(h)}w=n["skew"+k]!==h;n.set("skew"+k,h);if(n["skew"+u]!==0){l=n._getTransformedDimensions();h=(p[v]/l[v])*n["scale"+u];n.set("scale"+u,h)}return w},_scaleObject:function(r,q,n){var s=this._currentTransform,l=s.target,o=l.get("lockScalingX"),m=l.get("lockScalingY"),h=l.get("lockScalingFlip");if(o&&m){return false}var i=l.translateToOriginPoint(l.getCenterPoint(),s.originX,s.originY),p=l.toLocalPoint(new fabric.Point(r,q),s.originX,s.originY),k=l._getTransformedDimensions(),j=false;this._setLocalMouse(p,s);j=this._setObjectScale(p,s,o,m,n,h,k);l.setPositionByOrigin(i,s.originX,s.originY);return j},_setObjectScale:function(r,i,p,n,o,h,q){var m=i.target,l=false,k=false,j=false,v,u,t,s;t=r.x*m.scaleX/q.x;s=r.y*m.scaleY/q.y;v=m.scaleX!==t;u=m.scaleY!==s;if(h&&t<=0&&t<m.scaleX){l=true}if(h&&s<=0&&s<m.scaleY){k=true}if(o==="equally"&&!p&&!n){l||k||(j=this._scaleObjectEqually(r,m,i,q))}else{if(!o){l||p||(m.set("scaleX",t)&&(j=j||v));k||n||(m.set("scaleY",s)&&(j=j||u))}else{if(o==="x"&&!m.get("lockUniScaling")){l||p||(m.set("scaleX",t)&&(j=j||v))}else{if(o==="y"&&!m.get("lockUniScaling")){k||n||(m.set("scaleY",s)&&(j=j||u))}}}}i.newScaleX=t;i.newScaleY=s;l||k||this._flipObject(i,o);return j},_scaleObjectEqually:function(n,j,i,m){var l=n.y+n.x,k=m.y*i.original.scaleY/j.scaleY+m.x*i.original.scaleX/j.scaleX,h;i.newScaleX=i.original.scaleX*l/k;i.newScaleY=i.original.scaleY*l/k;h=i.newScaleX!==j.scaleX||i.newScaleY!==j.scaleY;j.set("scaleX",i.newScaleX);j.set("scaleY",i.newScaleY);return h},_flipObject:function(h,i){if(h.newScaleX<0&&i!=="y"){if(h.originX==="left"){h.originX="right"}else{if(h.originX==="right"){h.originX="left"}}}if(h.newScaleY<0&&i!=="x"){if(h.originY==="top"){h.originY="bottom"}else{if(h.originY==="bottom"){h.originY="top"}}}},_setLocalMouse:function(j,h){var i=h.target;if(h.originX==="right"){j.x*=-1}else{if(h.originX==="center"){j.x*=h.mouseXSign*2;if(j.x<0){h.mouseXSign=-h.mouseXSign}}}if(h.originY==="bottom"){j.y*=-1}else{if(h.originY==="center"){j.y*=h.mouseYSign*2;if(j.y<0){h.mouseYSign=-h.mouseYSign}}}if(b(j.x)>i.padding){if(j.x<0){j.x+=i.padding}else{j.x-=i.padding}}else{j.x=0}if(b(j.y)>i.padding){if(j.y<0){j.y+=i.padding}else{j.y-=i.padding}}else{j.y=0}},_rotateObject:function(h,m){var i=this._currentTransform;if(i.target.get("lockRotation")){return false}var j=e(i.ey-i.top,i.ex-i.left),l=e(m-i.top,h-i.left),k=f(l-j+i.theta);if(k<0){k=360+k}i.target.angle=k%360;return true},setCursor:function(h){this.upperCanvasEl.style.cursor=h},_resetObjectTransform:function(h){h.scaleX=1;h.scaleY=1;h.skewX=0;h.skewY=0;h.setAngle(0)},_drawSelection:function(){var i=this.contextTop,h=this._groupSelector,o=h.left,n=h.top,m=b(o),k=b(n);i.fillStyle=this.selectionColor;i.fillRect(h.ex-((o>0)?0:-o),h.ey-((n>0)?0:-n),m,k);i.lineWidth=this.selectionLineWidth;i.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var l=h.ex+a-((o>0)?0:m),j=h.ey+a-((n>0)?0:k);i.beginPath();fabric.util.drawDashedLine(i,l,j,l+m,j,this.selectionDashArray);fabric.util.drawDashedLine(i,l,j+k-1,l+m,j+k-1,this.selectionDashArray);fabric.util.drawDashedLine(i,l,j,l,j+k,this.selectionDashArray);fabric.util.drawDashedLine(i,l+m-1,j,l+m-1,j+k,this.selectionDashArray);i.closePath();i.stroke()}else{i.strokeRect(h.ex+a-((o>0)?0:m),h.ey+a-((n>0)?0:k),m,k)}},_isLastRenderedObject:function(h){return(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(h,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(h,true)))},findTarget:function(k,h){if(this.skipTargetFind){return}if(this._isLastRenderedObject(k)){return this.lastRenderedObjectWithControlsAboveOverlay}var i=this.getActiveGroup();if(!h&&this._checkTarget(k,i,this.getPointer(k,true))){return i}var j=this._searchPossibleTargets(k,h);this._fireOverOutEvents(j,k);return j},_fireOverOutEvents:function(i,h){if(i){if(this._hoveredTarget!==i){if(this._hoveredTarget){this.fire("mouse:out",{target:this._hoveredTarget,e:h});this._hoveredTarget.fire("mouseout")}this.fire("mouse:over",{target:i,e:h});i.fire("mouseover");this._hoveredTarget=i}}else{if(this._hoveredTarget){this.fire("mouse:out",{target:this._hoveredTarget,e:h});this._hoveredTarget.fire("mouseout");this._hoveredTarget=null}}},_checkTarget:function(j,i,k){if(i&&i.visible&&i.evented&&this.containsPoint(j,i)){if((this.perPixelTargetFind||i.perPixelTargetFind)&&!i.isEditing){var h=this.isTargetTransparent(i,k.x,k.y);if(!h){return true}}else{return true}}},_searchPossibleTargets:function(l,j){var k,m=this.getPointer(l,true),h=this._objects.length;while(h--){if((!this._objects[h].group||j)&&this._checkTarget(l,this._objects[h],m)){this.relatedTarget=this._objects[h];k=this._objects[h];break}}return k},getPointer:function(n,l,k){if(!k){k=this.upperCanvasEl}var o=c(n),m=k.getBoundingClientRect(),j=m.width||0,h=m.height||0,i;if(!j||!h){if("top" in m&&"bottom" in m){h=Math.abs(m.top-m.bottom)}if("right" in m&&"left" in m){j=Math.abs(m.right-m.left)}}this.calcOffset();o.x=o.x-this._offset.left;o.y=o.y-this._offset.top;if(!l){o=fabric.util.transformPoint(o,fabric.util.invertTransform(this.viewportTransform))}if(j===0||h===0){i={width:1,height:1}}else{i={width:k.width/j,height:k.height/h}}return{x:o.x*i.width,y:o.y*i.height}},_createUpperCanvas:function(){var h=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+h);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var j=this.getWidth()||i.width,h=this.getHeight()||i.height;fabric.util.setStyle(i,{position:"absolute",width:j+"px",height:h+"px",left:0,top:0});i.width=j;i.height=h;fabric.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,h){h.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(h){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=h;h.set("active",true)},setActiveObject:function(h,i){this._setActiveObject(h);this.renderAll();this.fire("object:selected",{target:h,e:i});h.fire("selected",{e:i});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null},discardActiveObject:function(h){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:h});return this},_setActiveGroup:function(h){this._activeGroup=h;if(h){h.set("active",true)}},setActiveGroup:function(i,h){this._setActiveGroup(i);if(i){this.fire("object:selected",{target:i,e:h});i.fire("selected",{e:h})}return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var h=this.getActiveGroup();if(h){h.destroy()}this.setActiveGroup(null)},discardActiveGroup:function(h){this._discardActiveGroup();this.fire("selection:cleared",{e:h});return this},deactivateAll:function(){var j=this.getObjects(),k=0,h=j.length;for(;k<h;k++){j[k].set("active",false)}this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(i){var h=this.getActiveGroup()||this.getActiveObject();if(h){this.fire("before:selection:cleared",{target:h,e:i})}this.deactivateAll();if(h){this.fire("selection:cleared",{e:i})}return this},dispose:function(){this.callSuper("dispose");var h=this.wrapperEl;this.removeListeners();h.removeChild(this.upperCanvasEl);h.removeChild(this.lowerCanvasEl);delete this.upperCanvasEl;if(h.parentNode){h.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl)}delete this.wrapperEl;return this},drawControls:function(h){var i=this.getActiveGroup();if(i){i._renderControls(h)}else{this._drawObjectsControls(h)}},_drawObjectsControls:function(j){for(var k=0,h=this._objects.length;k<h;++k){if(!this._objects[k]||!this._objects[k].active){continue}this._objects[k]._renderControls(j);this.lastRenderedObjectWithControlsAboveOverlay=this._objects[k]}}});for(var g in fabric.StaticCanvas){if(g!=="prototype"){fabric.Canvas[g]=fabric.StaticCanvas[g]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents();b(fabric.window,"resize",this._onResize);b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"mousewheel",this._onMouseWheel);b(this.upperCanvasEl,"mouseout",this._onMouseOut);b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof eventjs!=="undefined"&&"add" in eventjs){eventjs.add(this.upperCanvasEl,"gesture",this._onGesture);eventjs.add(this.upperCanvasEl,"drag",this._onDrag);eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange);eventjs.add(this.upperCanvasEl,"shake",this._onShake);eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress)}},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);c(this.upperCanvasEl,"mouseout",this._onMouseOut);c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof eventjs!=="undefined"&&"remove" in eventjs){eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture);eventjs.remove(this.upperCanvasEl,"drag",this._onDrag);eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange);eventjs.remove(this.upperCanvasEl,"shake",this._onShake);eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress)}},_onGesture:function(f,d){this.__onTransformGesture&&this.__onTransformGesture(f,d)},_onDrag:function(f,d){this.__onDrag&&this.__onDrag(f,d)},_onMouseWheel:function(f,d){this.__onMouseWheel&&this.__onMouseWheel(f,d)},_onMouseOut:function(f){var d=this._hoveredTarget;this.fire("mouse:out",{target:d,e:f});this._hoveredTarget=null;d&&d.fire("mouseout",{e:f})},_onOrientationChange:function(f,d){this.__onOrientationChange&&this.__onOrientationChange(f,d)},_onShake:function(f,d){this.__onShake&&this.__onShake(f,d)},_onLongPress:function(f,d){this.__onLongPress&&this.__onLongPress(f,d)},_onMouseDown:function(d){this.__onMouseDown(d);b(fabric.document,"touchend",this._onMouseUp);b(fabric.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(d.type==="touchstart"){c(this.upperCanvasEl,"mousedown",this._onMouseDown)}else{b(fabric.document,"mouseup",this._onMouseUp);b(fabric.document,"mousemove",this._onMouseMove)}},_onMouseUp:function(d){this.__onMouseUp(d);c(fabric.document,"mouseup",this._onMouseUp);c(fabric.document,"touchend",this._onMouseUp);c(fabric.document,"mousemove",this._onMouseMove);c(fabric.document,"touchmove",this._onMouseMove);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if(d.type==="touchend"){var f=this;setTimeout(function(){b(f.upperCanvasEl,"mousedown",f._onMouseDown)},400)}},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault();this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(e,f){var d=this.getActiveGroup()||this.getActiveObject();return !!((e&&(e.isMoving||e!==d))||(!e&&!!d)||(!e&&!d&&!this._groupSelector)||(f&&this._previousPointer&&this.selection&&(f.x!==this._previousPointer.x||f.y!==this._previousPointer.y)))},__onMouseUp:function(h){var g,f=true,d=this._currentTransform;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(h);return}if(d){this._finalizeCurrentTransform();f=!d.actionPerformed}g=f?this.findTarget(h,true):d.target;var i=this._shouldRender(g,this.getPointer(h));this._maybeGroupObjects(h);if(g){g.isMoving=false}i&&this.renderAll();this._handleCursorAndEvent(h,g)},_handleCursorAndEvent:function(f,d){this._setCursorFromEvent(f,d);this.fire("mouse:up",{target:d,e:f});d&&d.fire("mouseup",{e:f})},_finalizeCurrentTransform:function(){var d=this._currentTransform,e=d.target;if(e._scaling){e._scaling=false}e.setCoords();this._restoreOriginXY(e);if(d.actionPerformed||(this.stateful&&e.hasStateChanged())){this.fire("object:modified",{target:e});e.fire("modified")}},_restoreOriginXY:function(e){if(this._previousOriginX&&this._previousOriginY){var d=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX;e.originY=this._previousOriginY;e.left=d.x;e.top=d.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(g){this._isCurrentlyDrawing=true;this.discardActiveObject(g).renderAll();if(this.clipTo){fabric.util.clipContext(this,this.contextTop)}var d=fabric.util.invertTransform(this.viewportTransform),h=fabric.util.transformPoint(this.getPointer(g,true),d);this.freeDrawingBrush.onMouseDown(h);this.fire("mouse:down",{e:g});var f=this.findTarget(g);if(typeof f!=="undefined"){f.fire("mousedown",{e:g,target:f})}},_onMouseMoveInDrawingMode:function(g){if(this._isCurrentlyDrawing){var d=fabric.util.invertTransform(this.viewportTransform),h=fabric.util.transformPoint(this.getPointer(g,true),d);this.freeDrawingBrush.onMouseMove(h)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:g});var f=this.findTarget(g);if(typeof f!=="undefined"){f.fire("mousemove",{e:g,target:f})}},_onMouseUpInDrawingMode:function(f){this._isCurrentlyDrawing=false;if(this.clipTo){this.contextTop.restore()}this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:f});var d=this.findTarget(f);if(typeof d!=="undefined"){d.fire("mouseup",{e:f,target:d})}},__onMouseDown:function(h){var d="which" in h?h.which===1:h.button===0;if(!d&&!fabric.isTouchSupported){return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(h);return}if(this._currentTransform){return}var g=this.findTarget(h),j=this.getPointer(h,true);this._previousPointer=j;var i=this._shouldRender(g,j),f=this._shouldGroup(h,g);if(this._shouldClearSelection(h,g)){this._clearSelection(h,g,j)}else{if(f){this._handleGrouping(h,g);g=this.getActiveGroup()}}if(g){if(g.selectable&&(g.__corner||!f)){this._beforeTransform(h,g);this._setupCurrentTransform(h,g)}if(g!==this.getActiveGroup()&&g!==this.getActiveObject()){this.deactivateAll();g.selectable&&this.setActiveObject(g,h)}}i&&this.renderAll();this.fire("mouse:down",{target:g,e:h});g&&g.fire("mousedown",{e:h})},_beforeTransform:function(f,d){this.stateful&&d.saveState();if(d._findTargetCorner(this.getPointer(f))){this.onBeforeScaleRotate(d)}},_clearSelection:function(f,d,g){this.deactivateAllWithDispatch(f);if(d&&d.selectable){this.setActiveObject(d,f)}else{if(this.selection){this._groupSelector={ex:g.x,ey:g.y,top:0,left:0}}}},_setOriginToCenter:function(e){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var d=e.getCenterPoint();e.originX="center";e.originY="center";e.left=d.x;e.top=d.y;this._currentTransform.left=e.left;this._currentTransform.top=e.top},_setCenterToOrigin:function(e){var d=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX;e.originY=this._previousOriginY;e.left=d.x;e.top=d.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(g){var f,h;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(g);return}if(typeof g.touches!=="undefined"&&g.touches.length>1){return}var d=this._groupSelector;if(d){h=this.getPointer(g,true);d.left=h.x-d.ex;d.top=h.y-d.ey;this.renderTop()}else{if(!this._currentTransform){f=this.findTarget(g);this._setCursorFromEvent(g,f)}else{this._transformObject(g)}}this.fire("mouse:move",{target:f,e:g});f&&f.fire("mousemove",{e:g})},_transformObject:function(f){var g=this.getPointer(f),d=this._currentTransform;d.reset=false,d.target.isMoving=true;this._beforeScaleTransform(f,d);this._performTransformAction(f,d,g);this.renderAll()},_performTransformAction:function(i,f,k){var d=k.x,l=k.y,h=f.target,g=f.action,j=false;if(g==="rotate"){(j=this._rotateObject(d,l))&&this._fire("rotating",h,i)}else{if(g==="scale"){(j=this._onScale(i,f,d,l))&&this._fire("scaling",h,i)}else{if(g==="scaleX"){(j=this._scaleObject(d,l,"x"))&&this._fire("scaling",h,i)}else{if(g==="scaleY"){(j=this._scaleObject(d,l,"y"))&&this._fire("scaling",h,i)}else{if(g==="skewX"){(j=this._skewObject(d,l,"x"))&&this._fire("skewing",h,i)}else{if(g==="skewY"){(j=this._skewObject(d,l,"y"))&&this._fire("skewing",h,i)}else{j=this._translateObject(d,l);if(j){this._fire("moving",h,i);this.setCursor(h.moveCursor||this.moveCursor)}}}}}}}f.actionPerformed=j},_fire:function(d,g,f){this.fire("object:"+d,{target:g,e:f});g.fire(d,{e:f})},_beforeScaleTransform:function(g,d){if(d.action==="scale"||d.action==="scaleX"||d.action==="scaleY"){var f=this._shouldCenterTransform(d.target);if((f&&(d.originX!=="center"||d.originY!=="center"))||(!f&&d.originX==="center"&&d.originY==="center")){this._resetCurrentTransform();d.reset=true}}},_onScale:function(g,f,d,h){if((g[this.uniScaleKey]||this.uniScaleTransform)&&!f.target.get("lockUniScaling")){f.currentAction="scale";return this._scaleObject(d,h)}else{if(!f.reset&&f.currentAction==="scale"){this._resetCurrentTransform()}f.currentAction="scaleEqually";return this._scaleObject(d,h,"equally")}},_setCursorFromEvent:function(h,g){if(!g){this.setCursor(this.defaultCursor);return false}var i=g.hoverCursor||this.hoverCursor;if(!g.selectable){this.setCursor(i)}else{var d=this.getActiveGroup(),f=g._findTargetCorner&&(!d||!d.contains(g))&&g._findTargetCorner(this.getPointer(h,true));if(!f){this.setCursor(i)}else{this._setCornerCursor(f,g,h)}}return true},_setCornerCursor:function(d,g,f){if(d in a){this.setCursor(this._getRotatedCornerCursor(d,g,f))}else{if(d==="mtr"&&g.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{this.setCursor(this.defaultCursor);return false}}},_getRotatedCornerCursor:function(d,g,f){var h=Math.round((g.getAngle()%360)/45);if(h<0){h+=8}h+=a[d];if(f[this.altActionKey]&&a[d]%2===0){h+=2}h%=8;return this.cursorMap[h]}})})();(function(){var b=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(f,d){var c=this.getActiveObject();return f[this.selectionKey]&&d&&d.selectable&&(this.getActiveGroup()||(c&&c!==d))&&this.selection},_handleGrouping:function(d,c){if(c===this.getActiveGroup()){c=this.findTarget(d,true);if(!c||c.isType("group")){return}}if(this.getActiveGroup()){this._updateActiveGroup(c,d)}else{this._createActiveGroup(c,d)}if(this._activeGroup){this._activeGroup.saveCoords()}},_updateActiveGroup:function(f,d){var c=this.getActiveGroup();if(c.contains(f)){c.removeWithUpdate(f);f.set("active",false);if(c.size()===1){this.discardActiveGroup(d);this.setActiveObject(c.item(0));return}}else{c.addWithUpdate(f)}this.fire("selection:created",{target:c,e:d});c.set("active",true)},_createActiveGroup:function(f,d){if(this._activeObject&&f!==this._activeObject){var c=this._createGroup(f);c.addWithUpdate();this.setActiveGroup(c);this._activeObject=null;this.fire("selection:created",{target:c,e:d})}f.set("active",true)},_createGroup:function(f){var e=this.getObjects(),c=e.indexOf(this._activeObject)<e.indexOf(f),d=c?[this._activeObject,f]:[f,this._activeObject];return new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();if(c.length===1){this.setActiveObject(c[0],d)}else{if(c.length>1){c=new fabric.Group(c.reverse(),{canvas:this});c.addWithUpdate();this.setActiveGroup(c,d);c.saveCoords();this.fire("selection:created",{target:c});this.renderAll()}}},_collectObjects:function(){var m=[],g,d=this._groupSelector.ex,k=this._groupSelector.ey,c=d+this._groupSelector.left,h=k+this._groupSelector.top,f=new fabric.Point(b(d,c),b(k,h)),j=new fabric.Point(a(d,c),a(k,h)),l=d===c&&k===h;for(var e=this._objects.length;e--;){g=this._objects[e];if(!g||!g.selectable||!g.visible){continue}if(g.intersectsWithRect(f,j)||g.isContainedWithinRect(f,j)||g.containsPoint(f)||g.containsPoint(j)){g.set("active",true);m.push(g);if(l){break}}}return m},_maybeGroupObjects:function(d){if(this.selection&&this._groupSelector){this._groupSelectedObjects(d)}var c=this.getActiveGroup();if(c){c.setObjectsCoords().setCoords();c.isMoving=false;this.setCursor(this.defaultCursor)}this._groupSelector=null;this._currentTransform=null}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",e=a.quality||1,d=a.multiplier||1,c={left:a.left,top:a.top,width:a.width,height:a.height};if(this._isRetinaScaling()){d*=fabric.devicePixelRatio}if(d!==1){return this.__toDataURLWithMultiplier(b,e,c,d)}else{return this.__toDataURL(b,e,c)}},__toDataURL:function(d,f,e){this.renderAll();var b=this.contextContainer.canvas,a=this.__getCroppedCanvas(b,e);if(d==="jpg"){d="jpeg"}var c=(fabric.StaticCanvas.supports("toDataURLWithQuality"))?(a||b).toDataURL("image/"+d,f):(a||b).toDataURL("image/"+d);if(a){a=null}return c},__getCroppedCanvas:function(c,e){var b,d,a="left" in e||"top" in e||"width" in e||"height" in e;if(a){b=fabric.util.createCanvasElement();d=b.getContext("2d");b.width=e.width||this.width;b.height=e.height||this.height;d.drawImage(c,-e.left||0,-e.top||0)}return b},__toDataURLWithMultiplier:function(h,i,b,l){var j=this.getWidth(),m=this.getHeight(),e=j*l,g=m*l,a=this.getActiveObject(),c=this.getActiveGroup(),k=this.getZoom(),f=k*l/fabric.devicePixelRatio;if(l>1){this.setDimensions({width:e,height:g})}this.setZoom(f);if(b.left){b.left*=l}if(b.top){b.top*=l}if(b.width){b.width*=l}else{if(l<1){b.width=e}}if(b.height){b.height*=l}else{if(l<1){b.height=g}}if(c){this._tempRemoveBordersControlsFromGroup(c)}else{if(a&&this.deactivateAll){this.deactivateAll()}}var d=this.__toDataURL(h,i,b);if(c){this._restoreBordersControlsOnGroup(c)}else{if(a&&this.setActiveObject){this.setActiveObject(a)}}this.setZoom(k);this.setDimensions({width:j,height:m});return d},toDataURLWithMultiplier:function(a,c,b){return this.toDataURL({format:a,multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=true;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(b){b.origBorderColor=b.borderColor;b.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;a.borderColor=a.origBorderColor;a.forEachObject(function(b){b.borderColor=b.origBorderColor;delete b.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(b,c,a){return this.loadFromJSON(b,c,a)},loadFromJSON:function(b,f,a){if(!b){return}var c=(typeof b==="string")?JSON.parse(b):fabric.util.object.clone(b);this.clear();var e=this;this._enlivenObjects(c.objects,function(){e._setBgOverlay(c,f)},a);delete c.objects;delete c.backgroundImage;delete c.overlayImage;delete c.background;delete c.overlay;for(var d in c){this[d]=c[d]}return this},_setBgOverlay:function(c,e){var d=this,b={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!c.backgroundImage&&!c.overlayImage&&!c.background&&!c.overlay){e&&e();return}var a=function(){if(b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor){d.renderAll();e&&e()}};this.__setBgOverlay("backgroundImage",c.backgroundImage,b,a);this.__setBgOverlay("overlayImage",c.overlayImage,b,a);this.__setBgOverlay("backgroundColor",c.background,b,a);this.__setBgOverlay("overlayColor",c.overlay,b,a);a()},__setBgOverlay:function(c,b,a,e){var d=this;if(!b){a[c]=true;return}if(c==="backgroundImage"||c==="overlayImage"){fabric.Image.fromObject(b,function(f){d[c]=f;a[c]=true;e&&e()})}else{this["set"+fabric.util.string.capitalize(c,true)](b,function(){a[c]=true;e&&e()})}},_enlivenObjects:function(b,e,a){var d=this;if(!b||b.length===0){e&&e();return}var c=this.renderOnAddRemove;this.renderOnAddRemove=false;fabric.util.enlivenObjects(b,function(f){f.forEach(function(h,g){d.insertAt(h,g,true)});d.renderOnAddRemove=c;e&&e()},null,a)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(c,a){var b=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(b,function(){c&&c(d)})})},cloneWithoutData:function(c){var a=fabric.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var b=new fabric.Canvas(a);b.clipTo=this.clipTo;if(this.backgroundImage){b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();c&&c(b)});b.backgroundImageOpacity=this.backgroundImageOpacity;b.backgroundImageStretch=this.backgroundImageStretch}else{c&&c(b)}}});(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,a=e.util.toFixed,c=e.util.string.capitalize,b=e.util.degreesToRadians,f=e.StaticCanvas.supports("setLineDash");if(e.Object){return}e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY").split(" "),initialize:function(h){if(h){this.setOptions(h)}},_initGradient:function(h){if(h.fill&&h.fill.colorStops&&!(h.fill instanceof e.Gradient)){this.set("fill",new e.Gradient(h.fill))}if(h.stroke&&h.stroke.colorStops&&!(h.stroke instanceof e.Gradient)){this.set("stroke",new e.Gradient(h.stroke))}},_initPattern:function(h){if(h.fill&&h.fill.source&&!(h.fill instanceof e.Pattern)){this.set("fill",new e.Pattern(h.fill))}if(h.stroke&&h.stroke.source&&!(h.stroke instanceof e.Pattern)){this.set("stroke",new e.Pattern(h.stroke))}},_initClipping:function(h){if(!h.clipTo||typeof h.clipTo!=="string"){return}var i=e.util.getFunctionBody(h.clipTo);if(typeof i!=="undefined"){this.clipTo=new Function("ctx",i)}},setOptions:function(h){for(var i in h){this.set(i,h[i])}this._initGradient(h);this._initPattern(h);this._initClipping(h)},transform:function(i,j){if(this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup){this.group.transform(i)}var h=j?this._getLeftTopCoords():this.getCenterPoint();i.translate(h.x,h.y);i.rotate(b(this.angle));i.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));i.transform(1,0,Math.tan(b(this.skewX)),1,0,0);i.transform(1,Math.tan(b(this.skewY)),0,1,0,0)},toObject:function(j){var i=e.Object.NUM_FRACTION_DIGITS,h={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,i),top:a(this.top,i),width:a(this.width,i),height:a(this.height,i),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,i),scaleX:a(this.scaleX,i),scaleY:a(this.scaleY,i),angle:a(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,i),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:a(this.skewX,i),skewY:a(this.skewY,i)};if(!this.includeDefaultValues){h=this._removeDefaultValues(h)}e.util.populateWithProperties(this,h,j);return h},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(i){var h=e.util.getKlass(i.type).prototype,j=h.stateProperties;j.forEach(function(l){if(i[l]===h[l]){delete i[l]}var k=Object.prototype.toString.call(i[l])==="[object Array]"&&Object.prototype.toString.call(h[l])==="[object Array]";if(k&&i[l].length===0&&h[l].length===0){delete i[l]}});return i},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(h){return this[h]},_setObject:function(h){for(var i in h){this._set(i,h[i])}},set:function(h,i){if(typeof h==="object"){this._setObject(h)}else{if(typeof i==="function"&&h!=="clipTo"){this._set(h,i(this.get(h)))}else{this._set(h,i)}}return this},_set:function(h,i){var j=(h==="scaleX"||h==="scaleY");if(j){i=this._constrainScale(i)}if(h==="scaleX"&&i<0){this.flipX=!this.flipX;i*=-1}else{if(h==="scaleY"&&i<0){this.flipY=!this.flipY;i*=-1}else{if(h==="shadow"&&i&&!(i instanceof e.Shadow)){i=new e.Shadow(i)}}}this[h]=i;if(h==="width"||h==="height"){this.minScaleLimit=Math.min(0.1,1/Math.max(this.width,this.height))}return this},setOnGroup:function(){},toggle:function(i){var h=this.get(i);if(typeof h==="boolean"){this.set(i,!h)}return this},setSourcePath:function(h){this.sourcePath=h;return this},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},render:function(h,i){if((this.width===0&&this.height===0)||!this.visible){return}h.save();this._setupCompositeOperation(h);this.drawSelectionBackground(h);if(!i){this.transform(h)}this._setStrokeStyles(h);this._setFillStyles(h);if(this.transformMatrix){h.transform.apply(h,this.transformMatrix)}this._setOpacity(h);this._setShadow(h);this.clipTo&&e.util.clipContext(this,h);this._render(h,i);this.clipTo&&h.restore();h.restore()},_setOpacity:function(h){if(this.group){this.group._setOpacity(h)}h.globalAlpha*=this.opacity},_setStrokeStyles:function(h){if(this.stroke){h.lineWidth=this.strokeWidth;h.lineCap=this.strokeLineCap;h.lineJoin=this.strokeLineJoin;h.miterLimit=this.strokeMiterLimit;h.strokeStyle=this.stroke.toLive?this.stroke.toLive(h,this):this.stroke}},_setFillStyles:function(h){if(this.fill){h.fillStyle=this.fill.toLive?this.fill.toLive(h,this):this.fill}},_setLineDash:function(h,i,j){if(!i){return}if(1&i.length){i.push.apply(i,i)}if(f){h.setLineDash(i)}else{j&&j(h)}},_renderControls:function(h,l){if(!this.active||l||(this.group&&this.group!==this.canvas.getActiveGroup())){return}var k=this.getViewportTransform(),i=this.calcTransformMatrix(),j;i=e.util.multiplyTransformMatrices(k,i);j=e.util.qrDecompose(i);h.save();h.translate(j.translateX,j.translateY);h.lineWidth=1/this.borderScaleFactor;h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;if(this.group&&this.group===this.canvas.getActiveGroup()){h.rotate(b(j.angle));this.drawBordersInGroup(h,j)}else{h.rotate(b(this.angle));this.drawBorders(h)}this.drawControls(h);h.restore()},_setShadow:function(h){if(!this.shadow){return}var j=(this.canvas&&this.canvas.viewportTransform[0])||1,i=(this.canvas&&this.canvas.viewportTransform[3])||1;if(this.canvas&&this.canvas._isRetinaScaling()){j*=e.devicePixelRatio;i*=e.devicePixelRatio}h.shadowColor=this.shadow.color;h.shadowBlur=this.shadow.blur*(j+i)*(this.scaleX+this.scaleY)/4;h.shadowOffsetX=this.shadow.offsetX*j*this.scaleX;h.shadowOffsetY=this.shadow.offsetY*i*this.scaleY},_removeShadow:function(h){if(!this.shadow){return}h.shadowColor="";h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_renderFill:function(h){if(!this.fill){return}h.save();if(this.fill.gradientTransform){var i=this.fill.gradientTransform;h.transform.apply(h,i)}if(this.fill.toLive){h.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule==="evenodd"){h.fill("evenodd")}else{h.fill()}h.restore()},_renderStroke:function(h){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(h)}h.save();this._setLineDash(h,this.strokeDashArray,this._renderDashedStroke);if(this.stroke.gradientTransform){var i=this.stroke.gradientTransform;h.transform.apply(h,i)}if(this.stroke.toLive){h.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0)}h.stroke();h.restore()},clone:function(i,h){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(h),i)}return new e.Object(this.toObject(h))},cloneAsImage:function(i){var h=this.toDataURL();e.util.loadImage(h,function(j){if(i){i(new e.Image(j))}});return this},toDataURL:function(j){j||(j={});var k=e.util.createCanvasElement(),i=this.getBoundingRect();k.width=i.width;k.height=i.height;e.util.wrapElement(k,"div");var h=new e.StaticCanvas(k);if(j.format==="jpg"){j.format="jpeg"}if(j.format==="jpeg"){h.backgroundColor="#fff"}var m={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",false);this.setPositionByOrigin(new e.Point(h.getWidth()/2,h.getHeight()/2),"center","center");var n=this.canvas;h.add(this);var l=h.toDataURL(j);this.set(m).setCoords();this.canvas=n;h.dispose();h=null;return l},isType:function(h){return this.type===h},complexity:function(){return 0},toJSON:function(h){return this.toObject(h)},setGradient:function(k,j){j||(j={});var l={colorStops:[]};l.type=j.type||(j.r1||j.r2?"radial":"linear");l.coords={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2};if(j.r1||j.r2){l.coords.r1=j.r1;l.coords.r2=j.r2}j.gradientTransform&&(l.gradientTransform=j.gradientTransform);for(var h in j.colorStops){var i=new e.Color(j.colorStops[h]);l.colorStops.push({offset:h,color:i.toRgb(),opacity:i.getAlpha()})}return this.set(k,e.Gradient.forObject(this,l))},setPatternFill:function(h){return this.set("fill",new e.Pattern(h))},setShadow:function(h){return this.set("shadow",h?new e.Shadow(h):null)},setColor:function(h){this.set("fill",h);return this},setAngle:function(i){var h=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(h){this._setOriginToCenter()}this.set("angle",i);if(h){this._resetOrigin()}return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(i,j){j=j||this.canvas.getPointer(i);var h=new e.Point(j.x,j.y),k=this._getLeftTopCoords();if(this.angle){h=e.util.rotatePoint(h,k,e.util.degreesToRadians(-this.angle))}return{x:h.x-k.x,y:h.y-k.y}},_setupCompositeOperation:function(h){if(this.globalCompositeOperation){h.globalCompositeOperation=this.globalCompositeOperation}}});e.util.createAccessors(e.Object);e.Object.prototype.rotate=e.Object.prototype.setAngle;g(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.degreesToRadians,c={left:-0.5,center:0,right:0.5},b={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(m,e,d,k,i){var l=m.x,j=m.y,h=c[k]-c[e],f=b[i]-b[d],g;if(h||f){g=this._getTransformedDimensions();l=m.x+h*g.x;j=m.y+f*g.y}return new fabric.Point(l,j)},translateToCenterPoint:function(d,f,e){var g=this.translateToGivenOrigin(d,f,e,"center","center");if(this.angle){return fabric.util.rotatePoint(g,d,a(this.angle))}return g},translateToOriginPoint:function(d,f,e){var g=this.translateToGivenOrigin(d,"center","center",f,e);if(this.angle){return fabric.util.rotatePoint(g,d,a(this.angle))}return g},getCenterPoint:function(){var d=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(d,this.originX,this.originY)},getPointByOrigin:function(f,e){var d=this.getCenterPoint();return this.translateToOriginPoint(d,f,e)},toLocalPoint:function(e,g,f){var d=this.getCenterPoint(),i,h;if(g&&f){i=this.translateToGivenOrigin(d,"center","center",g,f)}else{i=new fabric.Point(this.left,this.top)}h=new fabric.Point(e.x,e.y);if(this.angle){h=fabric.util.rotatePoint(h,d,-a(this.angle))}return h.subtractEquals(i)},setPositionByOrigin:function(h,g,f){var e=this.translateToCenterPoint(h,g,f),d=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",d.x);this.set("top",d.y)},adjustPosition:function(h){var g=a(this.angle),f=this.getWidth(),e=Math.cos(g)*f,d=Math.sin(g)*f;this.left+=e*(c[h]-c[this.originX]);this.top+=d*(c[h]-c[this.originX]);this.setCoords();this.originX=h},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var d=this.getCenterPoint();this.originX="center";this.originY="center";this.left=d.x;this.top=d.y},_resetOrigin:function(){var d=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=d.x;this.top=d.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();(function(){function c(d){return[new fabric.Point(d.tl.x,d.tl.y),new fabric.Point(d.tr.x,d.tr.y),new fabric.Point(d.br.x,d.br.y),new fabric.Point(d.bl.x,d.bl.y)]}var a=fabric.util.degreesToRadians,b=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(d,e){var g=c(this.oCoords),f=fabric.Intersection.intersectPolygonRectangle(g,d,e);return f.status==="Intersection"},intersectsWithObject:function(d){var e=fabric.Intersection.intersectPolygonPolygon(c(this.oCoords),c(d.oCoords));return e.status==="Intersection"},isContainedWithinObject:function(d){var e=d.getBoundingRect(),g=new fabric.Point(e.left,e.top),f=new fabric.Point(e.left+e.width,e.top+e.height);return this.isContainedWithinRect(g,f)},isContainedWithinRect:function(d,f){var e=this.getBoundingRect();return(e.left>=d.x&&e.left+e.width<=f.x&&e.top>=d.y&&e.top+e.height<=f.y)},containsPoint:function(d){var f=this._getImageLines(this.oCoords),e=this._findCrossPoints(d,f);return(e!==0&&e%2===1)},_getImageLines:function(d){return{topline:{o:d.tl,d:d.tr},rightline:{o:d.tr,d:d.br},bottomline:{o:d.br,d:d.bl},leftline:{o:d.bl,d:d.tl}}},_findCrossPoints:function(m,d){var l,k,f,e,j,i,h=0,g;for(var n in d){g=d[n];if((g.o.y<m.y)&&(g.d.y<m.y)){continue}if((g.o.y>=m.y)&&(g.d.y>=m.y)){continue}if((g.o.x===g.d.x)&&(g.o.x>=m.x)){j=g.o.x;i=m.y}else{l=0;k=(g.d.y-g.o.y)/(g.d.x-g.o.x);f=m.y-l*m.x;e=g.o.y-k*g.o.x;j=-(f-e)/(l-k);i=f+l*j}if(j>=m.x){h+=1}if(h===2){break}}return h},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(d){if(Math.abs(d)<this.minScaleLimit){if(d<0){return -this.minScaleLimit}else{return this.minScaleLimit}}return d},scale:function(d){d=this._constrainScale(d);if(d<0){this.flipX=!this.flipX;this.flipY=!this.flipY;d*=-1}this.scaleX=d;this.scaleY=d;this.setCoords();return this},scaleToWidth:function(e){var d=this.getBoundingRect().width/this.getWidth();return this.scale(e/this.width/d)},scaleToHeight:function(e){var d=this.getBoundingRect().height/this.getHeight();return this.scale(e/this.height/d)},setCoords:function(){var j=a(this.angle),x=this.getViewportTransform(),q=this._calculateCurrentDimensions(),l=q.x,g=q.y;if(l<0){l=Math.abs(l)}var t=Math.sin(j),n=Math.cos(j),k=l>0?Math.atan(g/l):0,m=(l/Math.cos(k))/2,v=Math.cos(k+j)*m,u=Math.sin(k+j)*m,r=fabric.util.transformPoint(this.getCenterPoint(),x),h=new fabric.Point(r.x-v,r.y-u),e=new fabric.Point(h.x+(l*n),h.y+(l*t)),f=new fabric.Point(h.x-(g*t),h.y+(g*n)),w=new fabric.Point(r.x+v,r.y+u),s=new fabric.Point((h.x+f.x)/2,(h.y+f.y)/2),o=new fabric.Point((e.x+h.x)/2,(e.y+h.y)/2),p=new fabric.Point((w.x+e.x)/2,(w.y+e.y)/2),d=new fabric.Point((w.x+f.x)/2,(w.y+f.y)/2),i=new fabric.Point(o.x+t*this.rotatingPointOffset,o.y-n*this.rotatingPointOffset);this.oCoords={tl:h,tr:e,br:w,bl:f,ml:s,mt:o,mr:p,mb:d,mtr:i};this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){if(this.angle){var e=a(this.angle),f=Math.cos(e),d=Math.sin(e);return[f,d,-d,f,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var d=this.getCenterPoint(),g=[1,0,0,1,d.x,d.y],h=this._calcRotateMatrix(),e=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,true),f=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];f=b(f,g);f=b(f,h);f=b(f,e);return f},_calcDimensionsTransformMatrix:function(i,h,g){var e=[1,0,Math.tan(a(i)),1],d=[1,Math.tan(a(h)),0,1],l=this.scaleX*(g&&this.flipX?-1:1),j=this.scaleY*(g&&this.flipY?-1:1),k=[l,0,0,j],f=b(k,e,true);return b(f,d,true)}})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(a){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a)}else{this.canvas.sendBackwards(this,a)}return this},bringForward:function(a){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a)}else{this.canvas.bringForward(this,a)}return this},moveTo:function(a){if(this.group){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a)}else{this.canvas.moveTo(this,a)}return this}});(function(){function a(f,d){if(!d){return f+": none; "}else{if(d.toLive){return f+": url(#SVGID_"+d.id+"); "}else{var b=new fabric.Color(d),e=f+": "+d+"; ",c=b.getAlpha();if(c!==1){e=f+": "+b.toRgb()+"; ";e+=f+"-opacity: "+c.toString()+"; "}return e}}}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(h){var e=this.fillRule,j=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"none",m=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",d=this.strokeMiterLimit?this.strokeMiterLimit:"4",g=typeof this.opacity!=="undefined"?this.opacity:"1",b=this.visible?"":" visibility: hidden;",c=h?"":this.getSvgFilter(),l=a("fill",this.fill),k=a("stroke",this.stroke);return[k,"stroke-width: ",j,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",m,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",d,"; ",l,"fill-rule: ",e,"; ","opacity: ",g,";",c,b].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&this.group.type==="path-group"){return""}var c=fabric.util.toFixed,f=this.getAngle(),m=(this.getSkewX()%360),l=(this.getSkewY()%360),b=this.getCenterPoint(),p=fabric.Object.NUM_FRACTION_DIGITS,g=this.type==="path-group"?"":"translate("+c(b.x,p)+" "+c(b.y,p)+")",o=f!==0?(" rotate("+c(f,p)+")"):"",h=(this.scaleX===1&&this.scaleY===1)?"":(" scale("+c(this.scaleX,p)+" "+c(this.scaleY,p)+")"),j=m!==0?" skewX("+c(m,p)+")":"",i=l!==0?" skewY("+c(l,p)+")":"",e=this.type==="path-group"?this.width:0,n=this.flipX?" matrix(-1 0 0 1 "+e+" 0) ":"",d=this.type==="path-group"?this.height:0,k=this.flipY?" matrix(1 0 0 -1 0 "+d+")":"";return[g,o,h,n,k,j,i].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var b=[];if(this.fill&&this.fill.toLive){b.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){b.push(this.stroke.toSVG(this,false))}if(this.shadow){b.push(this.shadow.toSVG(this))}return b}})})();fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this);if(a&&a.stateProperties){a.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this)}return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var a=fabric.util.degreesToRadians,b=function(){return typeof G_vmlCanvasManager!=="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(h){if(!this.hasControls||!this.active){return false}var g=h.x,e=h.y,d,c;this.__corner=0;for(var f in this.oCoords){if(!this.isControlVisible(f)){continue}if(f==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(f==="mt"||f==="mr"||f==="mb"||f==="ml")){continue}c=this._getImageLines(this.oCoords[f].corner);d=this._findCrossPoints({x:g,y:e},c);if(d!==0&&d%2===1){this.__corner=f;return f}}return false},_setCornerCoords:function(){var i=this.oCoords,g=a(45-this.angle),h=this.cornerSize*0.707106,e=h*Math.cos(g),f=h*Math.sin(g),d,j;for(var c in i){d=i[c].x;j=i[c].y;i[c].corner={tl:{x:d-f,y:j-e},tr:{x:d+e,y:j-f},bl:{x:d-e,y:j+f},br:{x:d+f,y:j+e}}}},_getNonTransformedDimensions:function(){var g=this.strokeWidth,d=this.width,e=this.height,f=true,c=true;if(this.type==="line"&&this.strokeLineCap==="butt"){c=d;f=e}if(c){e+=e<0?-g:g}if(f){d+=d<0?-g:g}return{x:d,y:e}},_getTransformedDimensions:function(g,f){if(typeof g==="undefined"){g=this.skewX}if(typeof f==="undefined"){f=this.skewY}var c=this._getNonTransformedDimensions(),l=c.x/2,k=c.y/2,h=[{x:-l,y:-k},{x:l,y:-k},{x:-l,y:k},{x:l,y:k}],e,d=this._calcDimensionsTransformMatrix(g,f,false),j;for(e=0;e<h.length;e++){h[e]=fabric.util.transformPoint(h[e],d)}j=fabric.util.makeBoundingBoxFromPoints(h);return{x:j.width,y:j.height}},_calculateCurrentDimensions:function(){var f=this.getViewportTransform(),e=this._getTransformedDimensions(),c=e.x,d=e.y;c+=2*this.padding;d+=2*this.padding;return fabric.util.transformPoint(new fabric.Point(c,d),f,true)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||!this.active||this.group){return this}e.save();var c=this.getCenterPoint(),d=this._calculateCurrentDimensions();e.translate(c.x,c.y);e.rotate(a(this.angle));e.fillStyle=this.selectionBackgroundColor;e.fillRect(-d.x/2,-d.y/2,d.x,d.y);e.restore();return this},drawBorders:function(e){if(!this.hasBorders){return this}var d=this._calculateCurrentDimensions(),h=1/this.borderScaleFactor,f=d.x+h,c=d.y+h;e.save();e.strokeStyle=this.borderColor;this._setLineDash(e,this.borderDashArray,null);e.strokeRect(-f/2,-c/2,f,c);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var g=-c/2;e.beginPath();e.moveTo(0,g);e.lineTo(0,g-this.rotatingPointOffset);e.closePath();e.stroke()}e.restore();return this},drawBordersInGroup:function(e,g){if(!this.hasBorders){return this}var i=this._getNonTransformedDimensions(),f=fabric.util.customTransformMatrix(g.scaleX,g.scaleY,g.skewX),d=fabric.util.transformPoint(i,f),j=1/this.borderScaleFactor,h=d.x+j+2*this.padding,c=d.y+j+2*this.padding;e.save();this._setLineDash(e,this.borderDashArray,null);e.strokeStyle=this.borderColor;e.strokeRect(-h/2,-c/2,h,c);e.restore();return this},drawControls:function(f){if(!this.hasControls){return this}var e=this._calculateCurrentDimensions(),h=e.x,d=e.y,c=this.cornerSize,j=-(h+c)/2,i=-(d+c)/2,g=this.transparentCorners?"stroke":"fill";f.save();f.strokeStyle=f.fillStyle=this.cornerColor;if(!this.transparentCorners){f.strokeStyle=this.cornerStrokeColor}this._setLineDash(f,this.cornerDashArray,null);this._drawControl("tl",f,g,j,i);this._drawControl("tr",f,g,j+h,i);this._drawControl("bl",f,g,j,i+d);this._drawControl("br",f,g,j+h,i+d);if(!this.get("lockUniScaling")){this._drawControl("mt",f,g,j+h/2,i);this._drawControl("mb",f,g,j+h/2,i+d);this._drawControl("mr",f,g,j+h,i+d/2);this._drawControl("ml",f,g,j,i+d/2)}if(this.hasRotatingPoint){this._drawControl("mtr",f,g,j+h/2,i-this.rotatingPointOffset)}f.restore();return this},_drawControl:function(i,c,d,h,g){if(!this.isControlVisible(i)){return}var e=this.cornerSize,f=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":c.beginPath();c.arc(h+e/2,g+e/2,e/2,0,2*Math.PI,false);c[d]();if(f){c.stroke()}break;default:b()||this.transparentCorners||c.clearRect(h,g,e,e);c[d+"Rect"](h,g,e,e);if(f){c.strokeRect(h,g,e,e)}}},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,d){this._getControlsVisibility()[c]=d;return this},setControlsVisibility:function(c){c||(c={});for(var d in c){this.setControlVisible(d,c[d])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true}}return this._controlsVisibility}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){b.set("active",false)},onChange:function(g){b.set("opacity",g);f.renderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var e=[],d,b;for(d in arguments[0]){e.push(d)}for(var c=0,a=e.length;c<a;c++){d=e[c];b=c!==a-1;this._animate(d,arguments[0][d],arguments[1],b)}}else{this._animate.apply(this,arguments)}return this},_animate:function(e,g,c,a){var f=this,b;g=g.toString();if(!c){c={}}else{c=fabric.util.object.clone(c)}if(~e.indexOf(".")){b=e.split(".")}var d=b?this.get(b[0])[b[1]]:this.get(e);if(!("from" in c)){c.from=d}if(~g.indexOf("=")){g=d+parseFloat(g.replace("=",""))}else{g=parseFloat(g)}fabric.util.animate({startValue:c.from,endValue:g,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(h){if(b){f[b[0]][b[1]]=h}else{f.set(e,h)}if(a){return}c.onChange&&c.onChange()},onComplete:function(){if(a){return}f.setCoords();c.onComplete&&c.onComplete()}})}});(function(b){var c=b.fabric||(b.fabric={}),f=c.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},d=c.StaticCanvas.supports("setLineDash");if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(h,g){g=g||{};if(!h){h=[0,0,0,0]}this.callSuper("initialize",g);this.set("x1",h[0]);this.set("y1",h[1]);this.set("x2",h[2]);this.set("y2",h[3]);this._setWidthHeight(g)},_setWidthHeight:function(g){g||(g={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left" in g?g.left:this._getLeftToOriginX();this.top="top" in g?g.top:this._getTopToOriginY()},_set:function(g,h){this.callSuper("_set",g,h);if(typeof a[g]!=="undefined"){this._setWidthHeight()}return this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(g,j){g.beginPath();if(j){var i=this.getCenterPoint();g.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&d){var h=this.calcLinePoints();g.moveTo(h.x1,h.y1);g.lineTo(h.x2,h.y2)}g.lineWidth=this.strokeWidth;var k=g.strokeStyle;g.strokeStyle=this.stroke||g.fillStyle;this.stroke&&this._renderStroke(g);g.strokeStyle=k},_renderDashedStroke:function(g){var h=this.calcLinePoints();g.beginPath();c.util.drawDashedLine(g,h.x1,h.y1,h.x2,h.y2,this.strokeDashArray);g.closePath()},toObject:function(g){return f(this.callSuper("toObject",g),this.calcLinePoints())},calcLinePoints:function(){var l=this.x1<=this.x2?-1:1,k=this.y1<=this.y2?-1:1,h=(l*this.width*0.5),j=(k*this.height*0.5),g=(l*this.width*-0.5),i=(k*this.height*-0.5);return{x1:h,x2:g,y1:j,y2:i}},toSVG:function(g){var h=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(!(this.group&&this.group.type==="path-group")){i=this.calcLinePoints()}h.push("<line ",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return g?g(h.join("")):h.join("")},complexity:function(){return 1}});c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));c.Line.fromElement=function(h,g){var j=c.parseAttributes(h,c.Line.ATTRIBUTE_NAMES),i=[j.x1||0,j.y1||0,j.x2||0,j.y2||0];return new c.Line(i,f(j,g))};c.Line.fromObject=function(g){var h=[g.x1,g.y1,g.x2,g.y2];return new c.Line(h,g)};function e(h,m){var k=h.origin,n=h.axis1,l=h.axis2,j=h.dimension,i=m.nearest,g=m.center,o=m.farthest;return function(){switch(this.get(k)){case i:return Math.min(this.get(n),this.get(l));case g:return Math.min(this.get(n),this.get(l))+(0.5*this.get(j));case o:return Math.max(this.get(n),this.get(l))}}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI,e=b.util.object.extend;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:d*2,initialize:function(f){f=f||{};this.callSuper("initialize",f);this.set("radius",f.radius||0);this.startAngle=f.startAngle||this.startAngle;this.endAngle=f.endAngle||this.endAngle},_set:function(f,g){this.callSuper("_set",f,g);if(f==="radius"){this.setRadius(g)}return this},toObject:function(f){return e(this.callSuper("toObject",f),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(j){var n=this._createBaseSVGMarkup(),k=0,i=0,f=(this.endAngle-this.startAngle)%(2*d);if(f===0){if(this.group&&this.group.type==="path-group"){k=this.left+this.radius;i=this.top+this.radius}n.push("<circle ",'cx="'+k+'" cy="'+i+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}else{var h=Math.cos(this.startAngle)*this.radius,g=Math.sin(this.startAngle)*this.radius,m=Math.cos(this.endAngle)*this.radius,l=Math.sin(this.endAngle)*this.radius,o=f>d?"1":"0";n.push('<path d="M '+h+" "+g," A "+this.radius+" "+this.radius," 0 ",+o+" 1"," "+m+" "+l,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return j?j(n.join("")):n.join("")},_render:function(f,g){f.beginPath();f.arc(g?this.left+this.radius:0,g?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,false);this._renderFill(f);this._renderStroke(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){this.radius=f;return this.set("width",f*2).set("height",f*2)},complexity:function(){return 1}});b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));b.Circle.fromElement=function(g,f){f||(f={});var h=b.parseAttributes(g,b.Circle.ATTRIBUTE_NAMES);if(!c(h)){throw new Error("value of `r` attribute is required and can not be negative")}h.left=h.left||0;h.top=h.top||0;var i=new b.Circle(e(h,f));i.left-=i.radius;i.top-=i.radius;return i};function c(f){return(("radius" in f)&&(f.radius>=0))}b.Circle.fromObject=function(f){return new b.Circle(f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(c){var d=this.width/2,e=this.height/2;c.beginPath();b.util.drawDashedLine(c,-d,e,0,-e,this.strokeDashArray);b.util.drawDashedLine(c,0,-e,d,e,this.strokeDashArray);b.util.drawDashedLine(c,d,e,-d,e,this.strokeDashArray);c.closePath()},toSVG:function(c){var d=this._createBaseSVGMarkup(),e=this.width/2,f=this.height/2,g=[-e+" "+f,"0 "+-f,e+" "+f].join(",");d.push("<polygon ",'points="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c?c(d.join("")):d.join("")},complexity:function(){return 1}});b.Triangle.fromObject=function(c){return new b.Triangle(c)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0)},_set:function(e,f){this.callSuper("_set",e,f);switch(e){case"rx":this.rx=f;this.set("width",f*2);break;case"ry":this.ry=f;this.set("height",f*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return d(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(f){var g=this._createBaseSVGMarkup(),e=0,h=0;if(this.group&&this.group.type==="path-group"){e=this.left+this.rx;h=this.top+this.ry}g.push("<ellipse ",'cx="',e,'" cy="',h,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return f?f(g.join("")):g.join("")},_render:function(e,f){e.beginPath();e.save();e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(f?this.left+this.rx:0,f?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,false);e.restore();this._renderFill(e);this._renderStroke(e)},complexity:function(){return 1}});b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));b.Ellipse.fromElement=function(f,e){e||(e={});var h=b.parseAttributes(f,b.Ellipse.ATTRIBUTE_NAMES);h.left=h.left||0;h.top=h.top||0;var g=new b.Ellipse(d(h,e));g.top-=g.ry;g.left-=g.rx;return g};b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=b.util.object.extend;if(b.Rect){b.warn("fabric.Rect is already defined");return}var c=b.Object.prototype.stateProperties.concat();c.push("rx","ry","x","y");b.Rect=b.util.createClass(b.Object,{stateProperties:c,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(e){e=e||{};this.callSuper("initialize",e);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(p,g){if(this.width===1&&this.height===1){p.fillRect(-0.5,-0.5,1,1);return}var f=this.rx?Math.min(this.rx,this.width/2):0,e=this.ry?Math.min(this.ry,this.height/2):0,o=this.width,j=this.height,n=g?this.left:-this.width/2,m=g?this.top:-this.height/2,l=f!==0||e!==0,i=1-0.5522847498;p.beginPath();p.moveTo(n+f,m);p.lineTo(n+o-f,m);l&&p.bezierCurveTo(n+o-i*f,m,n+o,m+i*e,n+o,m+e);p.lineTo(n+o,m+j-e);l&&p.bezierCurveTo(n+o,m+j-i*e,n+o-i*f,m+j,n+o-f,m+j);p.lineTo(n+f,m+j);l&&p.bezierCurveTo(n+i*f,m+j,n,m+j-i*e,n,m+j-e);p.lineTo(n,m+e);l&&p.bezierCurveTo(n,m+i*e,n+i*f,m,n+f,m);p.closePath();this._renderFill(p);this._renderStroke(p)},_renderDashedStroke:function(g){var e=-this.width/2,j=-this.height/2,f=this.width,i=this.height;g.beginPath();b.util.drawDashedLine(g,e,j,e+f,j,this.strokeDashArray);b.util.drawDashedLine(g,e+f,j,e+f,j+i,this.strokeDashArray);b.util.drawDashedLine(g,e+f,j+i,e,j+i,this.strokeDashArray);b.util.drawDashedLine(g,e,j+i,e,j,this.strokeDashArray);g.closePath()},toObject:function(f){var e=d(this.callSuper("toObject",f),{rx:this.get("rx")||0,ry:this.get("ry")||0});if(!this.includeDefaultValues){this._removeDefaultValues(e)}return e},toSVG:function(f){var g=this._createBaseSVGMarkup(),e=this.left,h=this.top;if(!(this.group&&this.group.type==="path-group")){e=-this.width/2;h=-this.height/2}g.push("<rect ",'x="',e,'" y="',h,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return f?f(g.join("")):g.join("")},complexity:function(){return 1}});b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));b.Rect.fromElement=function(f,e){if(!f){return null}e=e||{};var h=b.parseAttributes(f,b.Rect.ATTRIBUTE_NAMES);h.left=h.left||0;h.top=h.top||0;var g=new b.Rect(d((e?b.util.object.clone(e):{}),h));g.visible=g.width>0&&g.height>0;return g};b.Rect.fromObject=function(e){return new b.Rect(e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Polyline){b.warn("fabric.Polyline is already defined");return}b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(d,c){return b.Polygon.prototype.initialize.call(this,d,c)},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return b.Polygon.prototype._applyPointOffset.call(this)},toObject:function(c){return b.Polygon.prototype.toObject.call(this,c)},toSVG:function(c){return b.Polygon.prototype.toSVG.call(this,c)},_render:function(c,d){if(!b.Polygon.prototype.commonRender.call(this,c,d)){return}this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(d){var g,f;d.beginPath();for(var e=0,c=this.points.length;e<c;e++){g=this.points[e];f=this.points[e+1]||g;b.util.drawDashedLine(d,g.x,g.y,f.x,f.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat();b.Polyline.fromElement=function(d,c){if(!d){return null}c||(c={});var e=b.parsePointsAttribute(d.getAttribute("points")),f=b.parseAttributes(d,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(e,b.util.object.extend(f,c))};b.Polyline.fromObject=function(c){var d=c.points;return new b.Polyline(d,c,true)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(h,g){g=g||{};this.points=h||[];this.callSuper("initialize",g);this._calcDimensions();if(!("top" in g)){this.top=this.minY}if(!("left" in g)){this.left=this.minX}this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var h=this.points,g=c(h,"x"),k=c(h,"y"),j=b(h,"x"),i=b(h,"y");this.width=(j-g)||0;this.height=(i-k)||0;this.minX=g||0,this.minY=k||0},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},toSVG:function(h){var m=[],k,j=this._createBaseSVGMarkup();for(var l=0,g=this.points.length;l<g;l++){m.push(a(this.points[l].x,2),",",a(this.points[l].y,2)," ")}if(!(this.group&&this.group.type==="path-group")){k=" translate("+(-this.pathOffset.x)+", "+(-this.pathOffset.y)+") "}j.push("<",this.type," ",'points="',m.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),k," ",this.getSvgTransformMatrix(),'"/>\n');return h?h(j.join("")):j.join("")},_render:function(g,h){if(!this.commonRender(g,h)){return}this._renderFill(g);if(this.stroke||this.strokeDashArray){g.closePath();this._renderStroke(g)}},commonRender:function(j,l){var h,g=this.points.length;if(!g||isNaN(this.points[g-1].y)){return false}l||j.translate(-this.pathOffset.x,-this.pathOffset.y);j.beginPath();j.moveTo(this.points[0].x,this.points[0].y);for(var k=0;k<g;k++){h=this.points[k];j.lineTo(h.x,h.y)}return true},_renderDashedStroke:function(g){e.Polyline.prototype._renderDashedStroke.call(this,g);g.closePath()},complexity:function(){return this.points.length}});e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polygon.fromElement=function(h,g){if(!h){return null}g||(g={});var i=e.parsePointsAttribute(h.getAttribute("points")),j=e.parseAttributes(h,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(i,f(j,g))};e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g,true)}})(typeof exports!=="undefined"?exports:this);(function(a){var c=a.fabric||(a.fabric={}),d=c.util.array.min,g=c.util.array.max,f=c.util.object.extend,b=Object.prototype.toString,h=c.util.drawArc,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},e={m:"l",M:"L"};if(c.Path){c.warn("fabric.Path is already defined");return}c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(l,k){k=k||{};this.setOptions(k);if(!l){l=[]}var j=b.call(l)==="[object Array]";this.path=j?l:l.match&&l.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!j){this.path=this._parsePath()}this._setPositionDimensions(k);if(k.sourcePath){this.setSourcePath(k.sourcePath)}},_setPositionDimensions:function(k){var j=this._parseDimensions();this.minX=j.left;this.minY=j.top;this.width=j.width;this.height=j.height;if(typeof k.left==="undefined"){this.left=j.left+(this.originX==="center"?this.width/2:this.originX==="right"?this.width:0)}if(typeof k.top==="undefined"){this.top=j.top+(this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0)}this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(z){var r,p=null,B=0,w=0,u=0,s=0,j=0,A=0,o,n,k=-this.pathOffset.x,v=-this.pathOffset.y;if(this.group&&this.group.type==="path-group"){k=0;v=0}z.beginPath();for(var m=0,q=this.path.length;m<q;++m){r=this.path[m];switch(r[0]){case"l":u+=r[1];s+=r[2];z.lineTo(u+k,s+v);break;case"L":u=r[1];s=r[2];z.lineTo(u+k,s+v);break;case"h":u+=r[1];z.lineTo(u+k,s+v);break;case"H":u=r[1];z.lineTo(u+k,s+v);break;case"v":s+=r[1];z.lineTo(u+k,s+v);break;case"V":s=r[1];z.lineTo(u+k,s+v);break;case"m":u+=r[1];s+=r[2];B=u;w=s;z.moveTo(u+k,s+v);break;case"M":u=r[1];s=r[2];B=u;w=s;z.moveTo(u+k,s+v);break;case"c":o=u+r[5];n=s+r[6];j=u+r[3];A=s+r[4];z.bezierCurveTo(u+r[1]+k,s+r[2]+v,j+k,A+v,o+k,n+v);u=o;s=n;break;case"C":u=r[5];s=r[6];j=r[3];A=r[4];z.bezierCurveTo(r[1]+k,r[2]+v,j+k,A+v,u+k,s+v);break;case"s":o=u+r[3];n=s+r[4];if(p[0].match(/[CcSs]/)===null){j=u;A=s}else{j=2*u-j;A=2*s-A}z.bezierCurveTo(j+k,A+v,u+r[1]+k,s+r[2]+v,o+k,n+v);j=u+r[1];A=s+r[2];u=o;s=n;break;case"S":o=r[3];n=r[4];if(p[0].match(/[CcSs]/)===null){j=u;A=s}else{j=2*u-j;A=2*s-A}z.bezierCurveTo(j+k,A+v,r[1]+k,r[2]+v,o+k,n+v);u=o;s=n;j=r[1];A=r[2];break;case"q":o=u+r[3];n=s+r[4];j=u+r[1];A=s+r[2];z.quadraticCurveTo(j+k,A+v,o+k,n+v);u=o;s=n;break;case"Q":o=r[3];n=r[4];z.quadraticCurveTo(r[1]+k,r[2]+v,o+k,n+v);u=o;s=n;j=r[1];A=r[2];break;case"t":o=u+r[1];n=s+r[2];if(p[0].match(/[QqTt]/)===null){j=u;A=s}else{j=2*u-j;A=2*s-A}z.quadraticCurveTo(j+k,A+v,o+k,n+v);u=o;s=n;break;case"T":o=r[1];n=r[2];if(p[0].match(/[QqTt]/)===null){j=u;A=s}else{j=2*u-j;A=2*s-A}z.quadraticCurveTo(j+k,A+v,o+k,n+v);u=o;s=n;break;case"a":h(z,u+k,s+v,[r[1],r[2],r[3],r[4],r[5],r[6]+u+k,r[7]+s+v]);u+=r[6];s+=r[7];break;case"A":h(z,u+k,s+v,[r[1],r[2],r[3],r[4],r[5],r[6]+k,r[7]+v]);u=r[6];s=r[7];break;case"z":case"Z":u=B;s=w;z.closePath();break}p=r}this._renderFill(z);this._renderStroke(z)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(k){var j=f(this.callSuper("toObject",k),{path:this.path.map(function(l){return l.slice()}),pathOffset:this.pathOffset});if(this.sourcePath){j.sourcePath=this.sourcePath}if(this.transformMatrix){j.transformMatrix=this.transformMatrix}return j},toDatalessObject:function(k){var j=this.toObject(k);if(this.sourcePath){j.path=this.sourcePath}delete j.sourcePath;return j},toSVG:function(k){var p=[],l=this._createBaseSVGMarkup(),m="";for(var n=0,j=this.path.length;n<j;n++){p.push(this.path[n].join(" "))}var o=p.join(" ");if(!(this.group&&this.group.type==="path-group")){m=" translate("+(-this.pathOffset.x)+", "+(-this.pathOffset.y)+") "}l.push("<path ",'d="',o,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),m,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return k?k(l.join("")):l.join("")},complexity:function(){return this.path.length},_parsePath:function(){var B=[],w=[],x,u,z=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,r,l;for(var p=0,v,s=this.path.length;p<s;p++){x=this.path[p];l=x.slice(1).trim();w.length=0;while((r=z.exec(l))){w.push(r[0])}v=[x.charAt(0)];for(var o=0,y=w.length;o<y;o++){u=parseFloat(w[o]);if(!isNaN(u)){v.push(u)}}var n=v[0],A=i[n.toLowerCase()],q=e[n]||n;if(v.length-1>A){for(var m=1,t=v.length;m<t;m+=A){B.push([n].concat(v.slice(m,m+A)));n=q}}else{B.push(v)}}return B},_parseDimensions:function(){var n=[],k=[],v,m=null,B=0,A=0,t=0,s=0,l=0,j=0,q,p,r;for(var w=0,z=this.path.length;w<z;++w){v=this.path[w];switch(v[0]){case"l":t+=v[1];s+=v[2];r=[];break;case"L":t=v[1];s=v[2];r=[];break;case"h":t+=v[1];r=[];break;case"H":t=v[1];r=[];break;case"v":s+=v[1];r=[];break;case"V":s=v[1];r=[];break;case"m":t+=v[1];s+=v[2];B=t;A=s;r=[];break;case"M":t=v[1];s=v[2];B=t;A=s;r=[];break;case"c":q=t+v[5];p=s+v[6];l=t+v[3];j=s+v[4];r=c.util.getBoundsOfCurve(t,s,t+v[1],s+v[2],l,j,q,p);t=q;s=p;break;case"C":t=v[5];s=v[6];l=v[3];j=v[4];r=c.util.getBoundsOfCurve(t,s,v[1],v[2],l,j,t,s);break;case"s":q=t+v[3];p=s+v[4];if(m[0].match(/[CcSs]/)===null){l=t;j=s}else{l=2*t-l;j=2*s-j}r=c.util.getBoundsOfCurve(t,s,l,j,t+v[1],s+v[2],q,p);l=t+v[1];j=s+v[2];t=q;s=p;break;case"S":q=v[3];p=v[4];if(m[0].match(/[CcSs]/)===null){l=t;j=s}else{l=2*t-l;j=2*s-j}r=c.util.getBoundsOfCurve(t,s,l,j,v[1],v[2],q,p);t=q;s=p;l=v[1];j=v[2];break;case"q":q=t+v[3];p=s+v[4];l=t+v[1];j=s+v[2];r=c.util.getBoundsOfCurve(t,s,l,j,l,j,q,p);t=q;s=p;break;case"Q":l=v[1];j=v[2];r=c.util.getBoundsOfCurve(t,s,l,j,l,j,v[3],v[4]);t=v[3];s=v[4];break;case"t":q=t+v[1];p=s+v[2];if(m[0].match(/[QqTt]/)===null){l=t;j=s}else{l=2*t-l;j=2*s-j}r=c.util.getBoundsOfCurve(t,s,l,j,l,j,q,p);t=q;s=p;break;case"T":q=v[1];p=v[2];if(m[0].match(/[QqTt]/)===null){l=t;j=s}else{l=2*t-l;j=2*s-j}r=c.util.getBoundsOfCurve(t,s,l,j,l,j,q,p);t=q;s=p;break;case"a":r=c.util.getBoundsOfArc(t,s,v[1],v[2],v[3],v[4],v[5],v[6]+t,v[7]+s);t+=v[6];s+=v[7];break;case"A":r=c.util.getBoundsOfArc(t,s,v[1],v[2],v[3],v[4],v[5],v[6],v[7]);t=v[6];s=v[7];break;case"z":case"Z":t=B;s=A;break}m=v;r.forEach(function(o){n.push(o.x);k.push(o.y)});n.push(t);k.push(s)}var F=d(n)||0,E=d(k)||0,D=g(n)||0,C=g(k)||0,H=D-F,G=C-E,u={left:F,top:E,width:H,height:G};return u}});c.Path.fromObject=function(j,k){if(typeof j.path==="string"){c.loadSVGFromURL(j.path,function(l){var m=l[0],n=j.path;delete j.path;c.util.object.extend(m,j);m.setSourcePath(n);k(m)})}else{k(new c.Path(j.path,j))}};c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]);c.Path.fromElement=function(k,m,j){var l=c.parseAttributes(k,c.Path.ATTRIBUTE_NAMES);m&&m(new c.Path(l.d,f(l,j)))};c.Path.async=true})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),e=d.util.object.extend,a=d.util.array.invoke,b=d.Object.prototype.toObject;if(d.PathGroup){d.warn("fabric.PathGroup is already defined");return}d.PathGroup=d.util.createClass(d.Path,{type:"path-group",fill:"",initialize:function(h,f){f=f||{};this.paths=h||[];for(var g=this.paths.length;g--;){this.paths[g].group=this}if(f.toBeParsed){this.parseDimensionsFromPaths(f);delete f.toBeParsed}this.setOptions(f);this.setCoords();if(f.sourcePath){this.setSourcePath(f.sourcePath)}},parseDimensionsFromPaths:function(t){var o,f,k=[],r=[],s,q,g,h;for(var l=this.paths.length;l--;){s=this.paths[l];q=s.height+s.strokeWidth;g=s.width+s.strokeWidth;o=[{x:s.left,y:s.top},{x:s.left+g,y:s.top},{x:s.left,y:s.top+q},{x:s.left+g,y:s.top+q}];h=this.paths[l].transformMatrix;for(var n=0;n<o.length;n++){f=o[n];if(h){f=d.util.transformPoint(f,h,false)}k.push(f.x);r.push(f.y)}}t.width=Math.max.apply(null,k);t.height=Math.max.apply(null,r)},render:function(g){if(!this.visible){return}g.save();if(this.transformMatrix){g.transform.apply(g,this.transformMatrix)}this.transform(g);this._setShadow(g);this.clipTo&&d.util.clipContext(this,g);g.translate(-this.width/2,-this.height/2);for(var h=0,f=this.paths.length;h<f;++h){this.paths[h].render(g,true)}this.clipTo&&g.restore();g.restore()},_set:function(h,g){if(h==="fill"&&g&&this.isSameColor()){var f=this.paths.length;while(f--){this.paths[f]._set(h,g)}}return this.callSuper("_set",h,g)},toObject:function(g){var f=e(b.call(this,g),{paths:a(this.getObjects(),"toObject",g)});if(this.sourcePath){f.sourcePath=this.sourcePath}return f},toDatalessObject:function(g){var f=this.toObject(g);if(this.sourcePath){f.paths=this.sourcePath}return f},toSVG:function(h){var l=this.getObjects(),m=this.getPointByOrigin("left","top"),g="translate("+m.x+" "+m.y+")",j=this._createBaseSVGMarkup();j.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),g,this.getSvgTransform(),'" ',">\n");for(var k=0,f=l.length;k<f;k++){j.push("\t",l[k].toSVG(h))}j.push("</g>\n");return h?h(j.join("")):j.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var f=this.getObjects()[0].get("fill")||"";if(typeof f!=="string"){return false}f=f.toLowerCase();return this.getObjects().every(function(g){var h=g.get("fill")||"";return typeof h==="string"&&(h).toLowerCase()===f})},complexity:function(){return this.paths.reduce(function(f,g){return f+((g&&g.complexity)?g.complexity():0)},0)},getObjects:function(){return this.paths}});d.PathGroup.fromObject=function(f,g){if(typeof f.paths==="string"){d.loadSVGFromURL(f.paths,function(i){var j=f.paths;delete f.paths;var h=d.util.groupSVGElements(i,f,j);g(h)})}else{d.util.enlivenObjects(f.paths,function(h){delete f.paths;g(new d.PathGroup(h,f))})}};d.PathGroup.async=true})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke;if(e.Group){return}var f={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,initialize:function(k,h,l){h=h||{};this._objects=[];l&&this.callSuper("initialize",h);this._objects=k||[];for(var j=this._objects.length;j--;){this._objects[j].group=this}this.originalState={};if(h.originX){this.originX=h.originX}if(h.originY){this.originY=h.originY}if(l){this._updateObjectsCoords(true)}else{this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",h)}this.setCoords();this.saveCoords()},_updateObjectsCoords:function(h){for(var j=this._objects.length;j--;){this._updateObjectCoords(this._objects[j],h)}},_updateObjectCoords:function(j,i){j.__origHasControls=j.hasControls;j.hasControls=false;if(i){return}var k=j.getLeft(),l=j.getTop(),h=this.getCenterPoint();j.set({originalLeft:k,originalTop:l,left:k-h.x,top:l-h.y});j.setCoords()},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(h){this._restoreObjectsState();e.util.resetObjectTransform(this);if(h){this._objects.push(h);h.group=this;h._set("canvas",this.canvas)}this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(h){h.set("active",true);h.group=this},removeWithUpdate:function(h){this._restoreObjectsState();e.util.resetObjectTransform(this);this.forEachObject(this._setObjectActive,this);this.remove(h);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(h){h.group=this;h._set("canvas",this.canvas)},_onObjectRemoved:function(h){delete h.group;h.set("active",false)},delegatedProperties:{fill:true,stroke:true,strokeWidth:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textAlign:true,backgroundColor:true},_set:function(j,k){var h=this._objects.length;if(this.delegatedProperties[j]||j==="canvas"){while(h--){this._objects[h].set(j,k)}}else{while(h--){this._objects[h].setOnGroup(j,k)}}this.callSuper("_set",j,k)},toObject:function(h){return g(this.callSuper("toObject",h),{objects:b(this._objects,"toObject",h)})},render:function(j){if(!this.visible){return}j.save();if(this.transformMatrix){j.transform.apply(j,this.transformMatrix)}this.transform(j);this._setShadow(j);this.clipTo&&e.util.clipContext(this,j);for(var k=0,h=this._objects.length;k<h;k++){this._renderObject(this._objects[k],j)}this.clipTo&&j.restore();j.restore()},_renderControls:function(j,l){this.callSuper("_renderControls",j,l);for(var k=0,h=this._objects.length;k<h;k++){this._objects[k]._renderControls(j)}},_renderObject:function(j,i){if(!j.visible){return}var h=j.hasRotatingPoint;j.hasRotatingPoint=false;j.render(i);j.hasRotatingPoint=h},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(k){var i=k.calcTransformMatrix(),j=e.util.qrDecompose(i),h=new e.Point(j.translateX,j.translateY);k.scaleX=j.scaleX;k.scaleY=j.scaleY;k.skewX=j.skewX;k.skewY=j.skewY;k.angle=j.angle;k.flipX=false;k.flipY=false;k.setPositionByOrigin(h,"center","center");return k},_restoreObjectState:function(h){this.realizeTransform(h);h.setCoords();h.hasControls=h.__origHasControls;delete h.__origHasControls;h.set("active",false);delete h.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},_calcBounds:function(m){var q=[],p=[],k,h,s=["tr","br","bl","tl"],r=0,l=this._objects.length,n,t=s.length;for(;r<l;++r){k=this._objects[r];k.setCoords();for(n=0;n<t;n++){h=s[n];q.push(k.oCoords[h].x);p.push(k.oCoords[h].y)}}this.set(this._getBounds(q,p,m))},_getBounds:function(j,i,n){var l=e.util.invertTransform(this.getViewportTransform()),k=e.util.transformPoint(new e.Point(c(j),c(i)),l),h=e.util.transformPoint(new e.Point(a(j),a(i)),l),m={width:(h.x-k.x)||0,height:(h.y-k.y)||0};if(!n){m.left=k.x||0;m.top=k.y||0;if(this.originX==="center"){m.left+=m.width/2}if(this.originX==="right"){m.left+=m.width}if(this.originY==="center"){m.top+=m.height/2}if(this.originY==="bottom"){m.top+=m.height}}return m},toSVG:function(j){var k=this._createBaseSVGMarkup();k.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var l=0,h=this._objects.length;l<h;l++){k.push("\t",this._objects[l].toSVG(j))}k.push("</g>\n");return j?j(k.join("")):k.join("")},get:function(k){if(k in f){if(this[k]){return this[k]}else{for(var j=0,h=this._objects.length;j<h;j++){if(this._objects[j][k]){return true}}return false}}else{if(k in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(k)}return this[k]}}});e.Group.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(j){delete h.objects;i&&i(new e.Group(j,h,true))})};e.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(d,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(d,c)},getElement:function(){return this._element},setElement:function(d,e,c){this._element=d;this._originalElement=d;this._initConfig(c);if(this.filters.length!==0){this.applyFilters(e)}else{if(e){e()}}return this},setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},_stroke:function(d){if(!this.stroke||this.strokeWidth===0){return}var c=this.width/2,e=this.height/2;d.beginPath();d.moveTo(-c,-e);d.lineTo(c,-e);d.lineTo(c,e);d.lineTo(-c,e);d.lineTo(-c,-e);d.closePath()},_renderDashedStroke:function(e){var c=-this.width/2,g=-this.height/2,d=this.width,f=this.height;e.save();this._setStrokeStyles(e);e.beginPath();fabric.util.drawDashedLine(e,c,g,c+d,g,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g,c+d,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g+f,c,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c,g+f,c,g,this.strokeDashArray);e.closePath();e.restore()},toObject:function(i){var h=[],g=[],f=this._originalElement,e=1,c=1;this.filters.forEach(function(j){if(j){if(j.type==="Resize"){e*=j.scaleX;c*=j.scaleY}h.push(j.toObject())}});this.resizeFilters.forEach(function(j){j&&g.push(j.toObject())});var d=b(this.callSuper("toObject",i),{src:f?f.src||f._src:"",filters:h,resizeFilters:g,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});d.width/=e;d.height/=c;if(!this.includeDefaultValues){this._removeDefaultValues(d)}return d},toSVG:function(d){var e=this._createBaseSVGMarkup(),c=-this.width/2,h=-this.height/2,g="none";if(this.group&&this.group.type==="path-group"){c=this.left;h=this.top}if(this.alignX!=="none"&&this.alignY!=="none"){g="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice}e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',h,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',g,'"',"></image>\n");if(this.stroke||this.strokeDashArray){var f=this.fill;this.fill=null;e.push("<rect ",'x="',c,'" y="',h,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n');this.fill=f}e.push("</g>\n");return d?d(e.join("")):e.join("")},getSrc:function(){if(this.getElement()){return this.getElement().src||this.getElement()._src}},setSrc:function(d,e,c){fabric.util.loadImage(d,function(f){return this.setElement(f,e,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(j,f,g,c){f=f||this.filters;g=g||this._originalElement;if(!g){return}var h=g,d=fabric.util.createCanvasElement(),e=fabric.util.createImage(),i=this;d.width=h.width;d.height=h.height;d.getContext("2d").drawImage(h,0,0,h.width,h.height);if(f.length===0){this._element=g;j&&j();return d}f.forEach(function(k){k&&k.applyTo(d,k.scaleX||i.scaleX,k.scaleY||i.scaleY);if(!c&&k&&k.type==="Resize"){i.width*=k.scaleX;i.height*=k.scaleY}});e.width=d.width;e.height=d.height;if(fabric.isLikelyNode){e.src=d.toBuffer(undefined,fabric.Image.pngCompression);i._element=e;!c&&(i._filteredEl=e);j&&j()}else{e.onload=function(){i._element=e;!c&&(i._filteredEl=e);j&&j();e.onload=d=h=null};e.src=d.toDataURL("image/png")}return d},_render:function(e,g){var c,h,d=this._findMargins(),f;c=(g?this.left:-this.width/2);h=(g?this.top:-this.height/2);if(this.meetOrSlice==="slice"){e.beginPath();e.rect(c,h,this.width,this.height);e.clip()}if(this.isMoving===false&&this.resizeFilters.length&&this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;f=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,true)}else{f=this._element}f&&e.drawImage(f,c+d.marginX,h+d.marginY,d.width,d.height);this._stroke(e);this._renderStroke(e)},_needsResize:function(){return(this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY)},_findMargins:function(){var f=this.width,c=this.height,h,g,e=0,d=0;if(this.alignX!=="none"||this.alignY!=="none"){h=[this.width/this._element.width,this.height/this._element.height];g=this.meetOrSlice==="meet"?Math.min.apply(null,h):Math.max.apply(null,h);f=this._element.width*g;c=this._element.height*g;if(this.alignX==="Mid"){e=(this.width-f)/2}if(this.alignX==="Max"){e=this.width-f}if(this.alignY==="Mid"){d=(this.height-c)/2}if(this.alignY==="Max"){d=this.height-c}}return{width:f,height:c,marginX:e,marginY:d}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(d,c){this.setElement(fabric.util.getById(d),null,c);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c);if(this._element&&this.crossOrigin){this._element.crossOrigin=this.crossOrigin}},_initFilters:function(c,d){if(c&&c.length){fabric.util.enlivenObjects(c,function(e){d&&d(e)},"fabric.Image.filters")}else{d&&d()}},_setWidthHeight:function(c){this.width="width" in c?c.width:(this.getElement()?this.getElement().width||0:0);this.height="height" in c?c.height:(this.getElement()?this.getElement().height||0:0)},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(c,d){fabric.util.loadImage(c.src,function(e){fabric.Image.prototype._initFilters.call(c,c.filters,function(f){c.filters=f||[];fabric.Image.prototype._initFilters.call(c,c.resizeFilters,function(h){c.resizeFilters=h||[];var g=new fabric.Image(e,c);d&&d(g)})})},null,c.crossOrigin)};fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f){e&&e(new fabric.Image(f,d))},null,d&&d.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" "));fabric.Image.fromElement=function(d,g,c){var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES),f;if(e.preserveAspectRatio){f=fabric.util.parsePreserveAspectRatioAttribute(e.preserveAspectRatio);b(e,f)}fabric.Image.fromURL(e["xlink:href"],g,b((c?fabric.util.object.clone(c):{}),e))};fabric.Image.async=true;fabric.Image.pngCompression=1})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;if(a>0){return Math.round((a-1)/90)*90}return Math.round(a/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.setAngle(f);a()},onComplete:function(){e.setCoords();d()},onStart:function(){e.set("active",false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.renderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(a){if(a){this.setOptions(a)}},setOptions:function(a){for(var b in a){this[b]=a[b]}},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(d){d=d||{};this.brightness=d.brightness||0},applyTo:function(g){var f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),h=k.data,j=this.brightness;for(var e=0,d=h.length;e<d;e+=4){h[e]+=j;h[e+1]+=j;h[e+2]+=j}f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}});b.Image.filters.Brightness.fromObject=function(d){return new b.Image.filters.Brightness(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(d){d=d||{};this.opaque=d.opaque;this.matrix=d.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(k){var B=this.matrix,h=k.getContext("2d"),t=h.getImageData(0,0,k.width,k.height),e=Math.round(Math.sqrt(B.length)),j=Math.floor(e/2),l=t.data,u=t.width,E=t.height,m=h.createImageData(u,E),F=m.data,q=this.opaque?1:0,s,A,C,D,v,z,w,p,d;for(var n=0;n<E;n++){for(var o=0;o<u;o++){v=(n*u+o)*4;s=0;A=0;C=0;D=0;for(var f=0;f<e;f++){for(var i=0;i<e;i++){w=n+f-j;z=o+i-j;if(w<0||w>E||z<0||z>u){continue}p=(w*u+z)*4;d=B[f*e+i];s+=l[p]*d;A+=l[p+1]*d;C+=l[p+2]*d;D+=l[p+3]*d}}F[v]=s;F[v+1]=A;F[v+2]=C;F[v+3]=D+q*(255-D)}}h.putImageData(m,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});b.Image.filters.Convolute.fromObject=function(d){return new b.Image.filters.Convolute(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(d){d=d||{};this.threshold=d.threshold||100},applyTo:function(h){var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.threshold,j=k.length;for(var f=0,d=k.length;f<d;f+=4){k[f+3]=e+255*(j-f)/j}g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}});b.Image.filters.GradientTransparency.fromObject=function(d){return new b.Image.filters.GradientTransparency(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(f){var e=f.getContext("2d"),i=e.getImageData(0,0,f.width,f.height),h=i.data,c=i.width*i.height*4,d=0,g;while(d<c){g=(h[d]+h[d+1]+h[d+2])/3;h[d]=g;h[d+1]=g;h[d+2]=g;d+=4}e.putImageData(i,0,0)}});b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(f){var e=f.getContext("2d"),h=e.getImageData(0,0,f.width,f.height),g=h.data,c=g.length,d;for(d=0;d<c;d+=4){g[d]=255-g[d];g[d+1]=255-g[d+1];g[d+2]=255-g[d+2]}e.putImageData(h,0,0)}});b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(d){d=d||{};this.mask=d.mask;this.channel=[0,1,2,3].indexOf(d.channel)>-1?d.channel:0},applyTo:function(h){if(!this.mask){return}var e=h.getContext("2d"),d=e.getImageData(0,0,h.width,h.height),j=d.data,l=this.mask.getElement(),n=b.util.createCanvasElement(),m=this.channel,k,g=d.width*d.height*4;n.width=h.width;n.height=h.height;n.getContext("2d").drawImage(l,0,0,h.width,h.height);var f=n.getContext("2d").getImageData(0,0,h.width,h.height),o=f.data;for(k=0;k<g;k+=4){j[k+3]=o[k+m]}e.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});b.Image.filters.Mask.fromObject=function(d,e){b.util.loadImage(d.mask.src,function(f){d.mask=new b.Image(f,d.mask);e&&e(new b.Image.filters.Mask(d))})};b.Image.filters.Mask.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(d){d=d||{};this.noise=d.noise||0},applyTo:function(h){var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.noise,j;for(var f=0,d=k.length;f<d;f+=4){j=(0.5-Math.random())*e;k[f]+=j;k[f+1]+=j;k[f+2]+=j}g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}});b.Image.filters.Noise.fromObject=function(d){return new b.Image.filters.Noise(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(d){d=d||{};this.blocksize=d.blocksize||4},applyTo:function(h){var f=h.getContext("2d"),e=f.getImageData(0,0,h.width,h.height),o=e.data,k=e.height,x=e.width,s,p,n,d,q,u,v;for(p=0;p<k;p+=this.blocksize){for(n=0;n<x;n+=this.blocksize){s=(p*4)*x+(n*4);d=o[s];q=o[s+1];u=o[s+2];v=o[s+3];for(var m=p,w=p+this.blocksize;m<w;m++){for(var l=n,t=n+this.blocksize;l<t;l++){s=(m*4)*x+(l*4);o[s]=d;o[s+1]=q;o[s+2]=u;o[s+3]=v}}}}f.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}});b.Image.filters.Pixelate.fromObject=function(d){return new b.Image.filters.Pixelate(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(d){d=d||{};this.threshold=d.threshold||30;this.distance=d.distance||20},applyTo:function(j){var h=j.getContext("2d"),e=h.getImageData(0,0,j.width,j.height),m=e.data,n=this.threshold,f=this.distance,k=255-n,s=Math.abs,d,o,q;for(var l=0,p=m.length;l<p;l+=4){d=m[l];o=m[l+1];q=m[l+2];if(d>k&&o>k&&q>k&&s(d-o)<f&&s(d-q)<f&&s(o-q)<f){m[l+3]=0}}h.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});b.Image.filters.RemoveWhite.fromObject=function(d){return new b.Image.filters.RemoveWhite(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(f){var e=f.getContext("2d"),j=e.getImageData(0,0,f.width,f.height),g=j.data,c=g.length,d,h;for(d=0;d<c;d+=4){h=0.3*g[d]+0.59*g[d+1]+0.11*g[d+2];g[d]=h+100;g[d+1]=h+50;g[d+2]=h+255}e.putImageData(j,0,0)}});b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(f){var e=f.getContext("2d"),c=e.getImageData(0,0,f.width,f.height),j=c.data,h=j.length,k,d,l,m;for(k=0;k<h;k+=4){d=j[k];l=j[k+1];m=j[k+2];j[k]=(d*0.393+l*0.769+m*0.189)/1.351;j[k+1]=(d*0.349+l*0.686+m*0.168)/1.203;j[k+2]=(d*0.272+l*0.534+m*0.131)/2.14}e.putImageData(c,0,0)}});b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(d){d=d||{};this.color=d.color||"#000000";this.opacity=typeof d.opacity!=="undefined"?d.opacity:new b.Color(this.color).getAlpha()},applyTo:function(k){var h=k.getContext("2d"),f=h.getImageData(0,0,k.width,k.height),m=f.data,l=m.length,n,p,t,j,e,o,q,s,d;d=new b.Color(this.color).getSource();p=d[0]*this.opacity;t=d[1]*this.opacity;j=d[2]*this.opacity;s=1-this.opacity;for(n=0;n<l;n+=4){e=m[n];o=m[n+1];q=m[n+2];m[n]=p+e*s;m[n+1]=t+o*s;m[n+2]=j+q*s}h.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});b.Image.filters.Tint.fromObject=function(d){return new b.Image.filters.Tint(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Multiply=b.util.createClass(b.Image.filters.BaseFilter,{type:"Multiply",initialize:function(d){d=d||{};this.color=d.color||"#000000"},applyTo:function(g){var f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),j=k.data,d=j.length,e,h;h=new b.Color(this.color).getSource();for(e=0;e<d;e+=4){j[e]*=h[0]/255;j[e+1]*=h[1]/255;j[e+2]*=h[2]/255}f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}});b.Image.filters.Multiply.fromObject=function(d){return new b.Image.filters.Multiply(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric;b.Image.filters.Blend=b.util.createClass(b.Image.filters.BaseFilter,{type:"Blend",initialize:function(c){c=c||{};this.color=c.color||"#000";this.image=c.image||false;this.mode=c.mode||"multiply";this.alpha=c.alpha||1},applyTo:function(j){var e=j.getContext("2d"),v=e.getImageData(0,0,j.width,j.height),y=v.data,c,k,l,m,u,x,w,f,h,o,q=false;if(this.image){q=true;var n=b.util.createCanvasElement();n.width=this.image.width;n.height=this.image.height;var d=new b.StaticCanvas(n);d.add(this.image);var p=d.getContext("2d");o=p.getImageData(0,0,d.width,d.height).data}else{o=new b.Color(this.color).getSource();c=o[0]*this.alpha;k=o[1]*this.alpha;l=o[2]*this.alpha}for(var s=0,t=y.length;s<t;s+=4){m=y[s];u=y[s+1];x=y[s+2];if(q){c=o[s]*this.alpha;k=o[s+1]*this.alpha;l=o[s+2]*this.alpha}switch(this.mode){case"multiply":y[s]=m*c/255;y[s+1]=u*k/255;y[s+2]=x*l/255;break;case"screen":y[s]=1-(1-m)*(1-c);y[s+1]=1-(1-u)*(1-k);y[s+2]=1-(1-x)*(1-l);break;case"add":y[s]=Math.min(255,m+c);y[s+1]=Math.min(255,u+k);y[s+2]=Math.min(255,x+l);break;case"diff":case"difference":y[s]=Math.abs(m-c);y[s+1]=Math.abs(u-k);y[s+2]=Math.abs(x-l);break;case"subtract":w=m-c;f=u-k;h=x-l;y[s]=(w<0)?0:w;y[s+1]=(f<0)?0:f;y[s+2]=(h<0)?0:h;break;case"darken":y[s]=Math.min(m,c);y[s+1]=Math.min(u,k);y[s+2]=Math.min(x,l);break;case"lighten":y[s]=Math.max(m,c);y[s+1]=Math.max(u,k);y[s+2]=Math.max(x,l);break}}e.putImageData(v,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});b.Image.filters.Blend.fromObject=function(c){return new b.Image.filters.Blend(c)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.pow,c=Math.floor,g=Math.sqrt,j=Math.abs,f=Math.max,i=Math.round,e=Math.sin,h=Math.ceil;b.Image.filters.Resize=b.util.createClass(b.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(o,n,m){this.rcpScaleX=1/n;this.rcpScaleY=1/m;var l=o.width,q=o.height,k=i(l*n),p=i(q*m),r;if(this.resizeType==="sliceHack"){r=this.sliceByTwo(o,l,q,k,p)}if(this.resizeType==="hermite"){r=this.hermiteFastResize(o,l,q,k,p)}if(this.resizeType==="bilinear"){r=this.bilinearFiltering(o,l,q,k,p)}if(this.resizeType==="lanczos"){r=this.lanczosResize(o,l,q,k,p)}o.width=k;o.height=p;o.getContext("2d").putImageData(r,0,0)},sliceByTwo:function(o,m,w,r,l){var n=o.getContext("2d"),k,q=0.5,A=0.5,y=1,t=1,p=false,z=false,x=m,s=w,u=b.util.createCanvasElement(),v=u.getContext("2d");r=c(r);l=c(l);u.width=f(r,m);u.height=f(l,w);if(r>m){q=2;y=-1}if(l>w){A=2;t=-1}k=n.getImageData(0,0,m,w);o.width=f(r,m);o.height=f(l,w);n.putImageData(k,0,0);while(!p||!z){m=x;w=s;if(r*y<c(x*q*y)){x=c(x*q)}else{x=r;p=true}if(l*t<c(s*A*t)){s=c(s*A)}else{s=l;z=true}k=n.getImageData(0,0,m,w);v.putImageData(k,0,0);n.clearRect(0,0,x,s);n.drawImage(u,0,0,m,w,0,0,x,s)}return n.getImageData(0,0,r,l)},lanczosResize:function(s,E,r,p,v){function x(G){return function(H){if(H>G){return 0}H*=Math.PI;if(j(H)<1e-16){return 1}var I=H/G;return e(H)*e(I)/H/I}}function y(S){var R,K,L,Q,O,G,I,P,H,N,M;D.x=(S+0.5)*m;A.x=c(D.x);for(R=0;R<v;R++){D.y=(R+0.5)*l;A.y=c(D.y);O=0,G=0,I=0,P=0,H=0;for(K=A.x-q;K<=A.x+q;K++){if(K<0||K>=E){continue}N=c(1000*j(K-D.x));if(!k[N]){k[N]={}}for(var J=A.y-o;J<=A.y+o;J++){if(J<0||J>=r){continue}M=c(1000*j(J-D.y));if(!k[N][M]){k[N][M]=t(g(d(N*z,2)+d(M*w,2))/1000)}L=k[N][M];if(L>0){Q=(J*E+K)*4;O+=L;G+=L*C[Q];I+=L*C[Q+1];P+=L*C[Q+2];H+=L*C[Q+3]}}}Q=(R*p+S)*4;B[Q]=G/O;B[Q+1]=I/O;B[Q+2]=P/O;B[Q+3]=H/O}if(++S<p){return y(S)}else{return F}}var n=s.getContext("2d"),u=n.getImageData(0,0,E,r),F=n.getImageData(0,0,p,v),C=u.data,B=F.data,t=x(this.lanczosLobes),m=this.rcpScaleX,l=this.rcpScaleY,z=2/this.rcpScaleX,w=2/this.rcpScaleY,q=h(m*this.lanczosLobes/2),o=h(l*this.lanczosLobes/2),k={},D={},A={};return y(0)},bilinearFiltering:function(o,C,H,B,q){var M,L,K,J,A,u,G,F,I,v,t,E,p=0,s,m=this.rcpScaleX,k=this.rcpScaleY,l=o.getContext("2d"),r=4*(C-1),N=l.getImageData(0,0,C,H),D=N.data,n=l.getImageData(0,0,B,q),z=n.data;for(G=0;G<q;G++){for(F=0;F<B;F++){A=c(m*F);u=c(k*G);I=m*F-A;v=k*G-u;s=4*(u*C+A);for(t=0;t<4;t++){M=D[s+t];L=D[s+4+t];K=D[s+r+t];J=D[s+r+4+t];E=M*(1-I)*(1-v)+L*I*(1-v)+K*v*(1-I)+J*I*v;z[p++]=E}}}return n},hermiteFastResize:function(p,N,o,n,G){var m=this.rcpScaleX,B=this.rcpScaleY,I=h(m/2),E=h(B/2),l=p.getContext("2d"),Q=l.getImageData(0,0,N,o),P=Q.data,O=l.getImageData(0,0,n,G),q=O.data;for(var J=0;J<G;J++){for(var K=0;K<n;K++){var L=(K+J*n)*4,F=0,M=0,u=0,k=0,s=0,x=0,y=0,t=(J+0.5)*B;for(var H=c(J*B);H<(J+1)*B;H++){var A=j(t-(H+0.5))/E,v=(K+0.5)*m,D=A*A;for(var r=c(K*m);r<(K+1)*m;r++){var C=j(v-(r+0.5))/I,z=g(D+C*C);if(z>1&&z<-1){continue}F=2*z*z*z-3*z*z+1;if(F>0){C=4*(r+H*N);y+=F*P[C+3];u+=F;if(P[C+3]<255){F=F*P[C+3]/250}k+=F*P[C];s+=F*P[C+1];x+=F*P[C+2];M+=F}}}q[L]=k/M;q[L+1]=s/M;q[L+2]=x/M;q[L+3]=y/u}}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});b.Image.filters.Resize.fromObject=function(k){return new b.Image.filters.Resize(k)}})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),h=d.util.object.extend,g=d.util.object.clone,a=d.util.toFixed,e=d.StaticCanvas.supports("setLineDash"),b=d.Object.NUM_FRACTION_DIGITS;if(d.Text){d.warn("fabric.Text is already defined");return}var f=d.Object.prototype.stateProperties.concat();f.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor");d.Text=d.util.createClass(d.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true,textAlign:true},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:f,stroke:null,shadow:null,_fontSizeFraction:0.25,_fontSizeMult:1.13,initialize:function(j,i){i=i||{};this.text=j;this.__skipDimension=true;this.setOptions(i);this.__skipDimension=false;this._initDimensions()},_initDimensions:function(i){if(this.__skipDimension){return}if(!i){i=d.util.createCanvasElement().getContext("2d");this._setTextStyles(i)}this._textLines=this._splitTextIntoLines();this._clearCache();this.width=this._getTextWidth(i);this.height=this._getTextHeight(i)},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(i){this.clipTo&&d.util.clipContext(this,i);this._setOpacity(i);this._setShadow(i);this._setupCompositeOperation(i);this._renderTextBackground(i);this._setStrokeStyles(i);this._setFillStyles(i);this._renderText(i);this._renderTextDecoration(i);this.clipTo&&i.restore()},_renderText:function(i){this._translateForTextAlign(i);this._renderTextFill(i);this._renderTextStroke(i);this._translateForTextAlign(i,true)},_translateForTextAlign:function(j,k){if(this.textAlign!=="left"&&this.textAlign!=="justify"){var i=k?-1:1;j.translate(this.textAlign==="center"?(i*this.width/2):i*this.width,0)}},_setTextStyles:function(i){i.textBaseline="alphabetic";if(!this.skipTextAlign){i.textAlign=this.textAlign}i.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(k){var m=this._getLineWidth(k,0);for(var l=1,j=this._textLines.length;l<j;l++){var n=this._getLineWidth(k,l);if(n>m){m=n}}return m},_renderChars:function(p,j,k,n,m){var l=p.slice(0,-4);if(this[l].toLive){var i=-this.width/2+this[l].offsetX||0,o=-this.height/2+this[l].offsetY||0;j.save();j.translate(i,o);n-=i;m-=o}j[p](k,n,m);this[l].toLive&&j.restore()},_renderTextLine:function(j,x,z,m,u,w){u-=this.fontSize*this._fontSizeFraction;var q=this._getLineWidth(x,w);if(this.textAlign!=="justify"||this.width<q){this._renderChars(j,x,z,m,u,w);return}var t=z.split(/\s+/),s=0,y=this._getWidthOfWords(x,z,w,0),p=this.width-y,o=t.length-1,v=o>0?p/o:0,l=0,k;for(var n=0,r=t.length;n<r;n++){while(z[s]===" "&&s<z.length){s++}k=t[n];this._renderChars(j,x,k,m+l,u,w,s);l+=this._getWidthOfWords(x,k,w,s)+v;s+=k.length}},_getWidthOfWords:function(j,i){return j.measureText(i.replace(/\s+/g,"")).width},_getLeftOffset:function(){return -this.width/2},_getTopOffset:function(){return -this.height/2},isEmptyStyles:function(){return true},_renderTextFill:function(k){if(!this.fill&&this.isEmptyStyles()){return}var o=0;for(var l=0,j=this._textLines.length;l<j;l++){var m=this._getHeightOfLine(k,l),n=m/this.lineHeight;this._renderTextLine("fillText",k,this._textLines[l],this._getLeftOffset(),this._getTopOffset()+o+n,l);o+=m}},_renderTextStroke:function(k){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return}var o=0;if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(k)}k.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}e&&k.setLineDash(this.strokeDashArray)}k.beginPath();for(var l=0,j=this._textLines.length;l<j;l++){var m=this._getHeightOfLine(k,l),n=m/this.lineHeight;this._renderTextLine("strokeText",k,this._textLines[l],this._getLeftOffset(),this._getTopOffset()+o+n,l);o+=m}k.closePath();k.restore()},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(i){this._renderTextBoxBackground(i);this._renderTextLinesBackground(i)},_renderTextBoxBackground:function(i){if(!this.backgroundColor){return}i.fillStyle=this.backgroundColor;i.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);this._removeShadow(i)},_renderTextLinesBackground:function(l){if(!this.textBackgroundColor){return}var o=0,n,k,p;l.fillStyle=this.textBackgroundColor;for(var m=0,j=this._textLines.length;m<j;m++){n=this._getHeightOfLine(l,m);k=this._getLineWidth(l,m);if(k>0){p=this._getLineLeftOffset(k);l.fillRect(this._getLeftOffset()+p,this._getTopOffset()+o,k,n/this.lineHeight)}o+=n}this._removeShadow(l)},_getLineLeftOffset:function(i){if(this.textAlign==="center"){return(this.width-i)/2}if(this.textAlign==="right"){return this.width-i}return 0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearCache:function(){var j=false;if(this._forceClearCache){this._forceClearCache=false;return true}for(var i in this._dimensionAffectingProps){if(this["__"+i]!==this[i]){this["__"+i]=this[i];j=true}}return j},_getLineWidth:function(j,m){if(this.__lineWidths[m]){return this.__lineWidths[m]===-1?this.width:this.__lineWidths[m]}var l,k,i=this._textLines[m];if(i===""){l=0}else{l=this._measureLine(j,m)}this.__lineWidths[m]=l;if(l&&this.textAlign==="justify"){k=i.split(/\s+/);if(k.length>1){this.__lineWidths[m]=-1}}return l},_measureLine:function(i,j){return i.measureText(this._textLines[j]).width},_renderTextDecoration:function(j){if(!this.textDecoration){return}var l=this.height/2,m=this,k=[];function i(o){var q,v=0,t,p,u,s,r,n;for(q=0,t=m._textLines.length;q<t;q++){s=m._getLineWidth(j,q),r=m._getLineLeftOffset(s),n=m._getHeightOfLine(j,q);for(p=0,u=o.length;p<u;p++){j.fillRect(m._getLeftOffset()+r,v+(m._fontSizeMult-1+o[p])*m.fontSize-l,s,m.fontSize/15)}v+=n}}if(this.textDecoration.indexOf("underline")>-1){k.push(0.85)}if(this.textDecoration.indexOf("line-through")>-1){k.push(0.43)}if(this.textDecoration.indexOf("overline")>-1){k.push(-0.12)}if(k.length>0){i(k)}},_getFontDeclaration:function(){return[(d.isLikelyNode?this.fontWeight:this.fontStyle),(d.isLikelyNode?this.fontStyle:this.fontWeight),this.fontSize+"px",(d.isLikelyNode?('"'+this.fontFamily+'"'):this.fontFamily)].join(" ")},render:function(i,j){if(!this.visible){return}i.save();this._setTextStyles(i);if(this._shouldClearCache()){this._initDimensions(i)}this.drawSelectionBackground(i);if(!j){this.transform(i)}if(this.transformMatrix){i.transform.apply(i,this.transformMatrix)}if(this.group&&this.group.type==="path-group"){i.translate(this.left,this.top)}this._render(i);i.restore()},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(j){var i=h(this.callSuper("toObject",j),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});if(!this.includeDefaultValues){this._removeDefaultValues(i)}return i},toSVG:function(i){var j=this._createBaseSVGMarkup(),l=this._getSVGLeftTopOffsets(this.ctx),k=this._getSVGTextAndBg(l.textTop,l.textLeft);this._wrapSVGTextAndBg(j,k);return i?i(j.join("")):j.join("")},_getSVGLeftTopOffsets:function(k){var l=this._getHeightOfLine(k,0),j=-this.width/2,i=0;return{textLeft:j+(this.group&&this.group.type==="path-group"?this.left:0),textTop:i+(this.group&&this.group.type==="path-group"?-this.top:0),lineTop:l}},_wrapSVGTextAndBg:function(i,l){var m=true,k=this.getSvgFilter(),j=k===""?"":' style="'+k+'"';i.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',j,">\n",l.textBgRects.join(""),"\t\t<text ",(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(this.textDecoration?'text-decoration="'+this.textDecoration+'" ':""),'style="',this.getSvgStyles(m),'" >\n',l.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(l,m){var p=[],o=[],k=0;this._setSVGBg(o);for(var n=0,j=this._textLines.length;n<j;n++){if(this.textBackgroundColor){this._setSVGTextLineBg(o,n,m,l,k)}this._setSVGTextLineText(n,p,k,m,l,o);k+=this._getHeightOfLine(this.ctx,n)}return{textSpans:p,textBgRects:o}},_setSVGTextLineText:function(m,o,k,l,j){var n=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-j+k-this.height/2;if(this.textAlign==="justify"){this._setSVGTextLineJustifed(m,o,n,l);return}o.push('\t\t\t<tspan x="',a(l+this._getLineLeftOffset(this._getLineWidth(this.ctx,m)),b),'" ','y="',a(n,b),'" ',this._getFillAttributes(this.fill),">",d.util.string.escapeXml(this._textLines[m]),"</tspan>\n")},_setSVGTextLineJustifed:function(o,k,l,m){var u=d.util.createCanvasElement().getContext("2d");this._setTextStyles(u);var w=this._textLines[o],s=w.split(/\s+/),v=this._getWidthOfWords(u,w),q=this.width-v,p=s.length-1,t=p>0?q/p:0,j,n=this._getFillAttributes(this.fill),r;m+=this._getLineLeftOffset(this._getLineWidth(u,o));for(o=0,r=s.length;o<r;o++){j=s[o];k.push('\t\t\t<tspan x="',a(m,b),'" ','y="',a(l,b),'" ',n,">",d.util.string.escapeXml(j),"</tspan>\n");m+=this._getWidthOfWords(u,j)+t}},_setSVGTextLineBg:function(n,m,l,k,j){n.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(l+this._getLineLeftOffset(this._getLineWidth(this.ctx,m)),b),'" y="',a(j-this.height/2,b),'" width="',a(this._getLineWidth(this.ctx,m),b),'" height="',a(this._getHeightOfLine(this.ctx,m)/this.lineHeight,b),'"></rect>\n')},_setSVGBg:function(i){if(this.backgroundColor){i.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,b),'" y="',a(-this.height/2,b),'" width="',a(this.width,b),'" height="',a(this.height,b),'"></rect>\n')}},_getFillAttributes:function(i){var j=(i&&typeof i==="string")?new d.Color(i):"";if(!j||!j.getSource()||j.getAlpha()===1){return'fill="'+i+'"'}return'opacity="'+j.getAlpha()+'" fill="'+j.setAlpha(1).toRgb()+'"'},_set:function(i,j){this.callSuper("_set",i,j);if(i in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},complexity:function(){return 1}});d.Text.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));d.Text.DEFAULT_SVG_FONT_SIZE=16;d.Text.fromElement=function(k,j){if(!k){return null}var m=d.parseAttributes(k,d.Text.ATTRIBUTE_NAMES);j=d.util.object.extend((j?d.util.object.clone(j):{}),m);j.top=j.top||0;j.left=j.left||0;if("dx" in m){j.left+=m.dx}if("dy" in m){j.top+=m.dy}if(!("fontSize" in j)){j.fontSize=d.Text.DEFAULT_SVG_FONT_SIZE}if(!j.originX){j.originX="left"}var l="";if(!("textContent" in k)){if("firstChild" in k&&k.firstChild!==null){if("data" in k.firstChild&&k.firstChild.data!==null){l=k.firstChild.data}}}else{l=k.textContent}l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var n=new d.Text(l,j),i=0;if(n.originX==="left"){i=n.getWidth()/2}if(n.originX==="right"){i=-n.getWidth()/2}n.set({left:n.getLeft()+i,top:n.getTop()-n.getHeight()/2+n.fontSize*(0.18+n._fontSizeFraction)});return n};d.Text.fromObject=function(i){return new d.Text(i.text,g(i))};d.util.createAccessors(d.Text)})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:false,editable:true,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1000,cursorDuration:600,styles:null,caching:true,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,_charWidthsCache:{},__widthOfSpace:[],initialize:function(c,b){this.styles=b?(b.styles||{}):{};this.callSuper("initialize",c,b);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles){return true}var d=this.styles;for(var e in d){for(var c in d[e]){for(var b in d[e][c]){return false}}}return true},setSelectionStart:function(b){b=Math.max(b,0);if(this.selectionStart!==b){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this});this.selectionStart=b}this._updateTextarea()},setSelectionEnd:function(b){b=Math.min(b,this.text.length);if(this.selectionEnd!==b){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this});this.selectionEnd=b}this._updateTextarea()},getSelectionStyles:function(g,e){if(arguments.length===2){var d=[];for(var b=g;b<e;b++){d.push(this.getSelectionStyles(b))}return d}var f=this.get2DCursorLocation(g),c=this._getStyleDeclaration(f.lineIndex,f.charIndex);return c||{}},setSelectionStyles:function(c){if(this.selectionStart===this.selectionEnd){this._extendStyles(this.selectionStart,c)}else{for(var b=this.selectionStart;b<this.selectionEnd;b++){this._extendStyles(b,c)}}this._forceClearCache=true;return this},_extendStyles:function(b,c){var d=this.get2DCursorLocation(b);if(!this._getLineStyle(d.lineIndex)){this._setLineStyle(d.lineIndex,{})}if(!this._getStyleDeclaration(d.lineIndex,d.charIndex)){this._setStyleDeclaration(d.lineIndex,d.charIndex,{})}fabric.util.object.extend(this._getStyleDeclaration(d.lineIndex,d.charIndex),c)},_render:function(b){this.callSuper("_render",b);this.ctx=b;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active){return}var d=this.text.split(""),c,b;if(this.canvas.contextTop){b=this.canvas.contextTop;b.save();b.transform.apply(b,this.canvas.viewportTransform);this.transform(b);this.transformMatrix&&b.transform.apply(b,this.transformMatrix)}else{b=this.ctx;b.save()}if(this.selectionStart===this.selectionEnd){c=this._getCursorBoundaries(d,"cursor");this.renderCursor(c,b)}else{c=this._getCursorBoundaries(d,"selection");this.renderSelection(d,c,b)}b.restore()},get2DCursorLocation:function(d){if(typeof d==="undefined"){d=this.selectionStart}var b=this._textLines.length;for(var c=0;c<b;c++){if(d<=this._textLines[c].length){return{lineIndex:c,charIndex:d}}d-=this._textLines[c].length+1}return{lineIndex:c-1,charIndex:this._textLines[c-1].length<d?this._textLines[c-1].length:d}},getCurrentCharStyle:function(d,c){var b=this._getStyleDeclaration(d,c===0?0:c-1);return{fontSize:b&&b.fontSize||this.fontSize,fill:b&&b.fill||this.fill,textBackgroundColor:b&&b.textBackgroundColor||this.textBackgroundColor,textDecoration:b&&b.textDecoration||this.textDecoration,fontFamily:b&&b.fontFamily||this.fontFamily,fontWeight:b&&b.fontWeight||this.fontWeight,fontStyle:b&&b.fontStyle||this.fontStyle,stroke:b&&b.stroke||this.stroke,strokeWidth:b&&b.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(d,c){var b=this._getStyleDeclaration(d,c===0?0:c-1);return b&&b.fontSize?b.fontSize:this.fontSize},getCurrentCharColor:function(d,c){var b=this._getStyleDeclaration(d,c===0?0:c-1);return b&&b.fill?b.fill:this.cursorColor},_getCursorBoundaries:function(d,b){var f=Math.round(this._getLeftOffset()),e=this._getTopOffset(),c=this._getCursorBoundariesOffsets(d,b);return{left:f,top:e,leftOffset:c.left+c.lineLeft,topOffset:c.top}},_getCursorBoundariesOffsets:function(e,b){var g=0,j=0,h=0,d=0,f=0;for(var c=0;c<this.selectionStart;c++){if(e[c]==="\n"){f=0;d+=this._getHeightOfLine(this.ctx,j);j++;h=0}else{f+=this._getWidthOfChar(this.ctx,e[c],j,h);h++}g=this._getLineLeftOffset(this._getLineWidth(this.ctx,j))}if(b==="cursor"){d+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,j)/this.lineHeight-this.getCurrentCharFontSize(j,h)*(1-this._fontSizeFraction)}return{top:d,left:f,lineLeft:g}},renderCursor:function(c,b){var d=this.get2DCursorLocation(),h=d.lineIndex,g=d.charIndex,f=this.getCurrentCharFontSize(h,g),e=(h===0&&g===0)?this._getLineLeftOffset(this._getLineWidth(b,h)):c.leftOffset;b.fillStyle=this.getCurrentCharColor(h,g);b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;b.fillRect(c.left+e,c.top+c.topOffset,this.cursorWidth/this.scaleX,f)},renderSelection:function(n,c,r){r.fillStyle=this.selectionColor;var b=this.get2DCursorLocation(this.selectionStart),g=this.get2DCursorLocation(this.selectionEnd),p=b.lineIndex,d=g.lineIndex;for(var k=p;k<=d;k++){var f=this._getLineLeftOffset(this._getLineWidth(r,k))||0,o=this._getHeightOfLine(this.ctx,k),l=0,s=this._textLines[k];if(k===p){for(var h=0,m=s.length;h<m;h++){if(h>=b.charIndex&&(k!==d||h<g.charIndex)){l+=this._getWidthOfChar(r,s[h],k,h)}if(h<b.charIndex){f+=this._getWidthOfChar(r,s[h],k,h)}}}else{if(k>p&&k<d){l+=this._getLineWidth(r,k)||5}else{if(k===d){for(var q=0,e=g.charIndex;q<e;q++){l+=this._getWidthOfChar(r,s[q],k,q)}}}}r.fillRect(c.left+f,c.top+c.topOffset,l,o);c.topOffset+=o}},_renderChars:function(b,o,p,c,k,n,j){if(this.isEmptyStyles()){return this._renderCharsFast(b,o,p,c,k)}j=j||0;this.skipTextAlign=true;c-=this.textAlign==="center"?(this.width/2):(this.textAlign==="right")?this.width:0;var m=this._getHeightOfLine(o,n),e=this._getLineLeftOffset(this._getLineWidth(o,n)),l,h,f="";c+=e||0;o.save();k-=m/this.lineHeight*this._fontSizeFraction;for(var d=j,g=p.length+j;d<=g;d++){l=l||this.getCurrentCharStyle(n,d);h=this.getCurrentCharStyle(n,d+1);if(this._hasStyleChanged(l,h)||d===g){this._renderChar(b,o,n,d-1,f,c,k,m);f="";l=h}f+=p[d-j]}o.restore()},_renderCharsFast:function(f,c,b,e,d){this.skipTextAlign=false;if(f==="fillText"&&this.fill){this.callSuper("_renderChars",f,c,b,e,d)}if(f==="strokeText"&&((this.stroke&&this.strokeWidth>0)||this.skipFillStrokeCheck)){this.callSuper("_renderChars",f,c,b,e,d)}},_renderChar:function(b,p,o,g,n,d,k,m){var h,c,f,l,j=this._getStyleDeclaration(o,g),e,q;if(j){c=this._getHeightOfChar(p,n,o,g);l=j.stroke;f=j.fill;q=j.textDecoration}else{c=this.fontSize}l=(l||this.stroke)&&b==="strokeText";f=(f||this.fill)&&b==="fillText";j&&p.save();h=this._applyCharStylesGetWidth(p,n,o,g,j||{});q=q||this.textDecoration;if(j&&j.textBackgroundColor){this._removeShadow(p)}f&&p.fillText(n,d,k);l&&p.strokeText(n,d,k);if(q||q!==""){e=this._fontSizeFraction*m/this.lineHeight;this._renderCharDecoration(p,q,d,k,e,h,c)}j&&p.restore();p.translate(h,0)},_hasStyleChanged:function(b,c){return(b.fill!==c.fill||b.fontSize!==c.fontSize||b.textBackgroundColor!==c.textBackgroundColor||b.textDecoration!==c.textDecoration||b.fontFamily!==c.fontFamily||b.fontWeight!==c.fontWeight||b.fontStyle!==c.fontStyle||b.stroke!==c.stroke||b.strokeWidth!==c.strokeWidth)},_renderCharDecoration:function(m,n,d,k,e,j,b){if(!n){return}var h=b/15,g={underline:k+b/10,"line-through":k-b*(this._fontSizeFraction+this._fontSizeMult-1)+h,overline:k-(this._fontSizeMult-this._fontSizeFraction)*b},c=["underline","line-through","overline"],f,l;for(f=0;f<c.length;f++){l=c[f];if(n.indexOf(l)>-1){m.fillRect(d,g[l],j,h)}}},_renderTextLine:function(g,c,b,e,d,f){if(!this.isEmptyStyles()){d+=this.fontSize*(this._fontSizeFraction+0.03)}this.callSuper("_renderTextLine",g,c,b,e,d,f)},_renderTextDecoration:function(b){if(this.isEmptyStyles()){return this.callSuper("_renderTextDecoration",b)}},_renderTextLinesBackground:function(p){this.callSuper("_renderTextLinesBackground",p);var e=0,d,l,h,c=this._getLeftOffset(),k=this._getTopOffset(),q,n,b;for(var g=0,m=this._textLines.length;g<m;g++){d=this._getHeightOfLine(p,g);q=this._textLines[g];if(q===""||!this.styles||!this._getLineStyle(g)){e+=d;continue}l=this._getLineWidth(p,g);h=this._getLineLeftOffset(l);for(var f=0,o=q.length;f<o;f++){b=this._getStyleDeclaration(g,f);if(!b||!b.textBackgroundColor){continue}n=q[f];p.fillStyle=b.textBackgroundColor;p.fillRect(c+h+this._getWidthOfCharsAt(p,g,f),k+e,this._getWidthOfChar(p,n,g,f)+1,d/this.lineHeight)}e+=d}},_getCacheProp:function(b,c){return b+c.fontFamily+c.fontSize+c.fontWeight+c.fontStyle+c.shadow},_applyCharStylesGetWidth:function(k,h,j,b,g){var e=this._getStyleDeclaration(j,b),d=(g&&a(g))||a(e),c;this._applyFontStyles(d);var f=this._getCacheProp(h,d);if(!e&&this._charWidthsCache[f]&&this.caching){return this._charWidthsCache[f]}if(typeof d.shadow==="string"){d.shadow=new fabric.Shadow(d.shadow)}var i=d.fill||this.fill;k.fillStyle=i.toLive?i.toLive(k,this):i;if(d.stroke){k.strokeStyle=(d.stroke&&d.stroke.toLive)?d.stroke.toLive(k,this):d.stroke}k.lineWidth=d.strokeWidth||this.strokeWidth;k.font=this._getFontDeclaration.call(d);if(d.shadow){d.scaleX=this.scaleX;d.scaleY=this.scaleY;d.canvas=this.canvas;this._setShadow.call(d,k)}if(!this.caching||!this._charWidthsCache[f]){c=k.measureText(h).width;this.caching&&(this._charWidthsCache[f]=c);return c}return this._charWidthsCache[f]},_applyFontStyles:function(b){if(!b.fontFamily){b.fontFamily=this.fontFamily}if(!b.fontSize){b.fontSize=this.fontSize}if(!b.fontWeight){b.fontWeight=this.fontWeight}if(!b.fontStyle){b.fontStyle=this.fontStyle}},_getStyleDeclaration:function(d,c,b){if(b){return(this.styles[d]&&this.styles[d][c])?a(this.styles[d][c]):{}}return this.styles[d]&&this.styles[d][c]?this.styles[d][c]:null},_setStyleDeclaration:function(d,c,b){this.styles[d][c]=b},_deleteStyleDeclaration:function(c,b){delete this.styles[c][b]},_getLineStyle:function(b){return this.styles[b]},_setLineStyle:function(c,b){this.styles[c]=b},_deleteLineStyle:function(b){delete this.styles[b]},_getWidthOfChar:function(b,c,h,g){if(!this._isMeasuring&&this.textAlign==="justify"&&this._reSpacesAndTabs.test(c)){return this._getWidthOfSpace(b,h)}var f=this._getStyleDeclaration(h,g,true);this._applyFontStyles(f);var d=this._getCacheProp(c,f);if(this._charWidthsCache[d]&&this.caching){return this._charWidthsCache[d]}else{if(b){b.save();var e=this._applyCharStylesGetWidth(b,c,h,g);b.restore();return e}}},_getHeightOfChar:function(b,e,d){var c=this._getStyleDeclaration(e,d);return c&&c.fontSize?c.fontSize:this.fontSize},_getWidthOfCharsAt:function(b,g,f){var e=0,d,c;for(d=0;d<f;d++){c=this._textLines[g][d];e+=this._getWidthOfChar(b,c,g,d)}return e},_measureLine:function(b,d){this._isMeasuring=true;var c=this._getWidthOfCharsAt(b,d,this._textLines[d].length);this._isMeasuring=false;return c},_getWidthOfSpace:function(c,h){if(this.__widthOfSpace[h]){return this.__widthOfSpace[h]}var b=this._textLines[h],g=this._getWidthOfWords(c,b,h,0),f=this.width-g,d=b.length-b.replace(this._reSpacesAndTabs,"").length,e=Math.max(f/d,c.measureText(" ").width);this.__widthOfSpace[h]=e;return e},_getWidthOfWords:function(c,b,h,f){var e=0;for(var g=0;g<b.length;g++){var d=b[g];if(!d.match(/\s/)){e+=this._getWidthOfChar(c,d,h,g+f)}}return e},_getHeightOfLine:function(d,h){if(this.__lineHeights[h]){return this.__lineHeights[h]}var c=this._textLines[h],f=this._getHeightOfChar(d,h,0);for(var e=1,b=c.length;e<b;e++){var g=this._getHeightOfChar(d,h,e);if(g>f){f=g}}this.__lineHeights[h]=f*this.lineHeight*this._fontSizeMult;return this.__lineHeights[h]},_getTextHeight:function(d){var c=0;for(var e=0,b=this._textLines.length;e<b;e++){c+=this._getHeightOfLine(d,e)}return c},toObject:function(f){var e={},c,b,d;for(c in this.styles){d=this.styles[c];e[c]={};for(b in d){e[c][b]=a(d[b])}}return fabric.util.object.extend(this.callSuper("toObject",f),{styles:e})}});fabric.IText.fromObject=function(b){return new fabric.IText(b.text,a(b))}})();(function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var b=this;setTimeout(function(){b.selected=true},100)})},initAddedHandler:function(){var b=this;this.on("added",function(){if(this.canvas&&!this.canvas._hasITextHandlers){this.canvas._hasITextHandlers=true;this._initCanvasHandlers()}if(b.canvas){b.canvas._iTextInstances=b.canvas._iTextInstances||[];b.canvas._iTextInstances.push(b)}})},initRemovedHandler:function(){var b=this;this.on("removed",function(){if(b.canvas){b.canvas._iTextInstances=b.canvas._iTextInstances||[];fabric.util.removeFromArray(b.canvas._iTextInstances,b)}})},_initCanvasHandlers:function(){var b=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(b.canvas)});this.canvas.on("mouse:up",function(){if(b.canvas._iTextInstances){b.canvas._iTextInstances.forEach(function(c){c.__isMousedown=false})}});this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(b.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,c,d,f){var b;b={isAborted:false,abort:function(){this.isAborted=true},};e.animate("_currentCursorOpacity",c,{duration:d,onComplete:function(){if(!b.isAborted){e[f]()}},onChange:function(){if(e.canvas){e.canvas.clearContext(e.canvas.contextTop||e.ctx);e.renderCursorOrSelection()}},abort:function(){return b.isAborted}});return b},_onTickComplete:function(){var b=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1)}this._cursorTimeout1=setTimeout(function(){b._currentTickCompleteState=b._animateCursor(b,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(b){var d=this,c=b?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;if(this.canvas){this.canvas.clearContext(this.canvas.contextTop||this.ctx);this.renderCursorOrSelection()}if(this._cursorTimeout2){clearTimeout(this._cursorTimeout2)}this._cursorTimeout2=setTimeout(function(){d._tick()},c)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this.text.charAt(b))){while(this._reSpace.test(this.text.charAt(b))){d++;b--}}while(/\S/.test(this.text.charAt(b))&&b>-1){d++;b--}return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this.text.charAt(b))){while(this._reSpace.test(this.text.charAt(b))){d++;b++}}while(/\S/.test(this.text.charAt(b))&&b<this.text.length){d++;b++}return c+d},findLineBoundaryLeft:function(c){var d=0,b=c-1;while(!/\n/.test(this.text.charAt(b))&&b>-1){d++;b--}return c-d},findLineBoundaryRight:function(c){var d=0,b=c;while(!/\n/.test(this.text.charAt(b))&&b<this.text.length){d++;b++}return c+d},getNumNewLinesInSelectedText:function(){var e=this.getSelectedText(),d=0;for(var c=0,b=e.length;c<b;c++){if(e[c]==="\n"){d++}}return d},searchWordBoundary:function(e,f){var d=this._reSpace.test(this.text.charAt(e))?e-1:e,c=this.text.charAt(d),b=/[ \n\.,;!\?\-]/;while(!b.test(c)&&d>0&&d<this.text.length){d+=f;c=this.text.charAt(d)}if(b.test(c)&&c!=="\n"){d+=f===1?0:1}return d},selectWord:function(d){var b=this.searchWordBoundary(d,-1),c=this.searchWordBoundary(d,1);this.setSelectionStart(b);this.setSelectionEnd(c)},selectLine:function(d){var b=this.findLineBoundaryLeft(d),c=this.findLineBoundaryRight(d);this.setSelectionStart(b);this.setSelectionEnd(c)},enterEditing:function(b){if(this.isEditing||!this.editable){return}if(this.canvas){this.exitEditingOnOthers(this.canvas)}this.isEditing=true;this.initHiddenTextarea(b);this.hiddenTextarea.focus();this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire("editing:entered");if(!this.canvas){return this}this.canvas.renderAll();this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();return this},exitEditingOnOthers:function(b){if(b._iTextInstances){b._iTextInstances.forEach(function(c){c.selected=false;if(c.isEditing){c.exitEditing()}})}},initMouseMoveHandler:function(){var b=this;this.canvas.on("mouse:move",function(d){if(!b.__isMousedown||!b.isEditing){return}var c=b.getSelectionStartFromPointer(d.e);if(c>=b.__selectionStartOnMouseDown){b.setSelectionStart(b.__selectionStartOnMouseDown);b.setSelectionEnd(c)}else{b.setSelectionStart(c);b.setSelectionEnd(b.__selectionStartOnMouseDown)}})},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor="text"}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true},_updateTextarea:function(){if(!this.hiddenTextarea||this.inCompositionMode){return}this.hiddenTextarea.value=this.text;this.hiddenTextarea.selectionStart=this.selectionStart;this.hiddenTextarea.selectionEnd=this.selectionEnd;if(this.selectionStart===this.selectionEnd){var b=this._calcTextareaPosition();this.hiddenTextarea.style.left=b.x+"px";this.hiddenTextarea.style.top=b.y+"px"}},_calcTextareaPosition:function(){var h=this.text.split(""),e=this._getCursorBoundaries(h,"cursor"),i=this.get2DCursorLocation(),j=i.lineIndex,b=i.charIndex,f=this.getCurrentCharFontSize(j,b),d=(j===0&&b===0)?this._getLineLeftOffset(this._getLineWidth(this.ctx,j)):e.leftOffset,g=this.calcTransformMatrix(),c={x:e.left+d,y:e.top+e.topOffset+f};this.hiddenTextarea.style.fontSize=f+"px";return fabric.util.transformPoint(c,g)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.overCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor}},exitEditing:function(){var b=(this._textBeforeEdit!==this.text);this.selected=false;this.isEditing=false;this.selectable=true;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");b&&this.fire("modified");if(this.canvas){this.canvas.fire("text:editing:exited",{target:this});b&&this.canvas.fire("object:modified",{target:this})}return this},_removeExtraneousStyles:function(){for(var b in this.styles){if(!this._textLines[b]){delete this.styles[b]}}},_removeCharsFromTo:function(c,b){while(b!==c){this._removeSingleCharAndStyle(c+1);b--}this.setSelectionStart(c)},_removeSingleCharAndStyle:function(b){var c=this.text[b-1]==="\n",d=c?b:b-1;this.removeStyleObject(c,d);this.text=this.text.slice(0,b-1)+this.text.slice(b);this._textLines=this._splitTextIntoLines()},insertChars:function(d,c){var f;if(this.selectionEnd-this.selectionStart>1){this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart)}if(!c&&this.isEmptyStyles()){this.insertChar(d,false);return}for(var e=0,b=d.length;e<b;e++){if(c){f=fabric.copiedTextStyle[e]}this.insertChar(d[e],e<b-1,f)}},insertChar:function(c,e,b){var d=this.text[this.selectionStart]==="\n";this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(c,d,b);this.selectionStart+=c.length;this.selectionEnd=this.selectionStart;if(e){return}this._updateTextarea();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(g,f,d){this.shiftLineStyles(g,+1);if(!this.styles[g+1]){this.styles[g+1]={}}var b={},e={};if(this.styles[g]&&this.styles[g][f-1]){b=this.styles[g][f-1]}if(d){e[0]=a(b);this.styles[g+1]=e}else{for(var c in this.styles[g]){if(parseInt(c,10)>=f){e[parseInt(c,10)-f]=this.styles[g][c];delete this.styles[g][c]}}this.styles[g+1]=e}this._forceClearCache=true},insertCharStyleObject:function(h,g,e){var c=this.styles[h],f=a(c);if(g===0&&!e){g=1}for(var b in f){var d=parseInt(b,10);if(d>=g){c[d+1]=f[d];if(!f[d-1]){delete c[d]}}}this.styles[h][g]=e||a(c[g-1]);this._forceClearCache=true},insertStyleObjects:function(b,e,c){var d=this.get2DCursorLocation(),g=d.lineIndex,f=d.charIndex;if(!this._getLineStyle(g)){this._setLineStyle(g,{})}if(b==="\n"){this.insertNewlineStyleObject(g,f,e)}else{this.insertCharStyleObject(g,f,c)}},shiftLineStyles:function(f,e){var d=a(this.styles);for(var b in this.styles){var c=parseInt(b,10);if(c>f){this.styles[c+e]=d[c];if(!d[c-e]){delete this.styles[c]}}}},removeStyleObject:function(d,c){var b=this.get2DCursorLocation(c),f=b.lineIndex,e=b.charIndex;this._removeStyleObject(d,b,f,e)},_getTextOnPreviousLine:function(b){return this._textLines[b-1]},_removeStyleObject:function(d,j,l,b){if(d){var g=this._getTextOnPreviousLine(j.lineIndex),k=g?g.length:0;if(!this.styles[l-1]){this.styles[l-1]={}}for(b in this.styles[l]){this.styles[l-1][parseInt(b,10)+k]=this.styles[l][b]}this.shiftLineStyles(j.lineIndex,-1)}else{var h=this.styles[l];if(h){delete h[b]}var c=a(h);for(var f in c){var e=parseInt(f,10);if(e>=b&&e!==0){h[e-1]=c[e];delete h[e]}}}},insertNewline:function(){this.insertChars("\n")}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date();var b=this.canvas.getPointer(a.e);if(this.isTripleClick(b)){this.fire("tripleclick",a);this._stopEvent(a.e)}else{if(this.isDoubleClick(b)){this.fire("dblclick",a);this._stopEvent(a.e)}}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=b;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))});this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){if(!this.editable){return}var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x;this.__mousedownY=b.y;this.__isMousedown=true;if(this.hiddenTextarea&&this.canvas){this.canvas.wrapperEl.appendChild(this.hiddenTextarea)}if(this.selected){this.setCursorByClick(a.e)}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;this.initDelayedCursor(true)}})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=false;if(!this.editable||this._isObjectMoved(a.e)){return}if(this.__lastSelected&&!this.__corner){this.enterEditing(a.e);this.initDelayedCursor(true)}this.selected=true})},setCursorByClick:function(b){var a=this.getSelectionStartFromPointer(b);if(b.shiftKey){if(a<this.selectionStart){this.setSelectionEnd(this.selectionStart);this.setSelectionStart(a)}else{this.setSelectionEnd(a)}}else{this.setSelectionStart(a);this.setSelectionEnd(a)}},getSelectionStartFromPointer:function(m){var h=this.getLocalPointer(m),n=0,b=0,p=0,a=0,c,q;for(var g=0,l=this._textLines.length;g<l;g++){q=this._textLines[g];p+=this._getHeightOfLine(this.ctx,g)*this.scaleY;var f=this._getLineWidth(this.ctx,g),k=this._getLineLeftOffset(f);b=k*this.scaleX;for(var d=0,o=q.length;d<o;d++){n=b;b+=this._getWidthOfChar(this.ctx,q[d],g,this.flipX?o-d:d)*this.scaleX;if(p<=h.y||b<=h.x){a++;continue}return this._getNewSelectionStartFromOffset(h,n,b,a+g,o)}if(h.y<p){return this._getNewSelectionStartFromOffset(h,n,b,a+g-1,o)}}if(typeof c==="undefined"){return this.text.length}},_getNewSelectionStartFromOffset:function(d,g,a,f,i){var e=d.x-g,h=a-d.x,c=h>e?0:1,b=f+c;if(this.flipX){b=i-b}if(b>this.text.length){b=this.text.length}return b}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(b){var a;if(b&&this.canvas){a=this.canvas.getPointer(b)}else{this.oCoords||this.setCoords();a=this.oCoords.tl}this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: "+a.y+"px; left: "+a.x+"px; opacity: 0; width: 0px; height: 0px; z-index: -999;";if(this.canvas){this.canvas.lowerCanvasEl.parentNode.appendChild(this.hiddenTextarea)}else{fabric.document.body.appendChild(this.hiddenTextarea)}fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this));this._clickHandlerInitialized=true}},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(!this.isEditing){return}if(a.keyCode in this._keysMap){this[this._keysMap[a.keyCode]](a)}else{if((a.keyCode in this._ctrlKeysMapDown)&&(a.ctrlKey||a.metaKey)){this[this._ctrlKeysMapDown[a.keyCode]](a)}else{return}}a.stopImmediatePropagation();a.preventDefault();this.canvas&&this.canvas.renderAll()},onKeyUp:function(a){if(!this.isEditing||this._copyDone){this._copyDone=false;return}if((a.keyCode in this._ctrlKeysMapUp)&&(a.ctrlKey||a.metaKey)){this[this._ctrlKeysMapUp[a.keyCode]](a)}else{return}a.stopImmediatePropagation();a.preventDefault();this.canvas&&this.canvas.renderAll()},onInput:function(f){if(!this.isEditing||this.inCompositionMode){return}var h=this.selectionStart||0,g=this.selectionEnd||0,c=this.text.length,a=this.hiddenTextarea.value.length,d,b,i;if(a>c){i=this._selectionDirection==="left"?g:h;d=a-c;b=this.hiddenTextarea.value.slice(i,i+d)}else{d=a-c+g-h;b=this.hiddenTextarea.value.slice(h,h+d)}this.insertChars(b);f.stopPropagation()},onCompositionStart:function(){this.inCompositionMode=true;this.prevCompositionLength=0;this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=false},onCompositionUpdate:function(b){var a=b.data;this.selectionStart=this.compositionStart;this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd;this.insertChars(a,false);this.prevCompositionLength=a.length},forwardDelete:function(a){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length){return}this.moveCursorRight(a)}this.removeChars(a)},copy:function(a){if(this.selectionStart===this.selectionEnd){return}var c=this.getSelectedText(),b=this._getClipboardData(a);if(b){b.setData("text",c)}fabric.copiedText=c;fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd);a.stopImmediatePropagation();a.preventDefault();this._copyDone=true},paste:function(c){var b=null,d=this._getClipboardData(c),a=true;if(d){b=d.getData("text").replace(/\r/g,"");if(!fabric.copiedTextStyle||fabric.copiedText!==b){a=false}}else{b=fabric.copiedText}if(b){this.insertChars(b,a)}c.stopImmediatePropagation();c.preventDefault()},cut:function(a){if(this.selectionStart===this.selectionEnd){return}this.copy(a);this.removeChars(a)},_getClipboardData:function(a){return(a&&a.clipboardData)||fabric.window.clipboardData},getDownCursorOffset:function(j,n){var f=n?this.selectionEnd:this.selectionStart,m=this.get2DCursorLocation(f),o,g,q=m.lineIndex,k=this._textLines[q].slice(0,m.charIndex),l=this._textLines[q].slice(m.charIndex),b=this._textLines[q+1]||"";if(q===this._textLines.length-1||j.metaKey||j.keyCode===34){return this.text.length-f}var a=this._getLineWidth(this.ctx,q);g=this._getLineLeftOffset(a);var c=g;for(var d=0,h=k.length;d<h;d++){o=k[d];c+=this._getWidthOfChar(this.ctx,o,q,d)}var p=this._getIndexOnNextLine(m,b,c);return l.length+1+p},_getIndexOnNextLine:function(m,b,d){var r=m.lineIndex+1,f=this._getLineWidth(this.ctx,r),i=this._getLineLeftOffset(f),e=i,q=0,l;for(var g=0,p=b.length;g<p;g++){var o=b[g],k=this._getWidthOfChar(this.ctx,o,r,g);e+=k;if(e>d){l=true;var a=e-k,n=e,h=Math.abs(a-d),c=Math.abs(n-d);q=c<h?g+1:g;break}}if(!l){q=b.length}return q},moveCursorDown:function(a){this.abortCursorAnimation();this._currentCursorOpacity=1;var b=this.getDownCursorOffset(a,this._selectionDirection==="right");if(a.shiftKey){this.moveCursorDownWithShift(b)}else{this.moveCursorDownWithoutShift(b)}this.initDelayedCursor()},moveCursorDownWithoutShift:function(a){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+a);this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var a=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(a)},moveCursorDownWithShift:function(a){if(this.selectionEnd===this.selectionStart){this._selectionDirection="right"}if(this._selectionDirection==="right"){this.setSelectionEnd(this.selectionEnd+a)}else{this.setSelectionStart(this.selectionStart+a)}if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="left"){this.swapSelectionPoints();this._selectionDirection="right"}if(this.selectionEnd>this.text.length){this.setSelectionEnd(this.text.length)}},getUpCursorOffset:function(j,n){var d=n?this.selectionEnd:this.selectionStart,m=this.get2DCursorLocation(d),p=m.lineIndex;if(p===0||j.metaKey||j.keyCode===33){return d}var k=this._textLines[p].slice(0,m.charIndex),f=this._textLines[p-1]||"",o,a=this._getLineWidth(this.ctx,m.lineIndex),g=this._getLineLeftOffset(a),b=g;for(var c=0,h=k.length;c<h;c++){o=k[c];b+=this._getWidthOfChar(this.ctx,o,p,c)}var l=this._getIndexOnPrevLine(m,f,b);return f.length-l+k.length},_getIndexOnPrevLine:function(l,g,d){var r=l.lineIndex-1,q=this._getLineWidth(this.ctx,r),h=this._getLineLeftOffset(q),b=h,m=0,k;for(var e=0,p=g.length;e<p;e++){var o=g[e],i=this._getWidthOfChar(this.ctx,o,r,e);b+=i;if(b>d){k=true;var a=b-i,n=b,f=Math.abs(a-d),c=Math.abs(n-d);m=c<f?e:(e-1);break}}if(!k){m=g.length-1}return m},moveCursorUp:function(a){this.abortCursorAnimation();this._currentCursorOpacity=1;var b=this.getUpCursorOffset(a,this._selectionDirection==="right");if(a.shiftKey){this.moveCursorUpWithShift(b)}else{this.moveCursorUpWithoutShift(b)}this.initDelayedCursor()},moveCursorUpWithShift:function(a){if(this.selectionEnd===this.selectionStart){this._selectionDirection="left"}if(this._selectionDirection==="right"){this.setSelectionEnd(this.selectionEnd-a)}else{this.setSelectionStart(this.selectionStart-a)}if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="right"){this.swapSelectionPoints();this._selectionDirection="left"}},moveCursorUpWithoutShift:function(a){if(this.selectionStart===this.selectionEnd){this.setSelectionStart(this.selectionStart-a)}this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(a.shiftKey){this.moveCursorLeftWithShift(a)}else{this.moveCursorLeftWithoutShift(a)}this.initDelayedCursor()},_move:function(c,d,b){var a=(d==="selectionStart"?"setSelectionStart":"setSelectionEnd");if(c.altKey){this[a](this["findWordBoundary"+b](this[d]))}else{if(c.metaKey||c.keyCode===35||c.keyCode===36){this[a](this["findLineBoundary"+b](this[d]))}else{this[a](this[d]+(b==="Left"?-1:1))}}},_moveLeft:function(a,b){this._move(a,b,"Left")},_moveRight:function(a,b){this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){this._selectionDirection="left";if(this.selectionEnd===this.selectionStart){this._moveLeft(a,"selectionStart")}this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd){this._moveLeft(a,"selectionEnd")}else{this._selectionDirection="left";this._moveLeft(a,"selectionStart")}},moveCursorRight:function(a){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(a.shiftKey){this.moveCursorRightWithShift(a)}else{this.moveCursorRightWithoutShift(a)}this.initDelayedCursor()},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this._moveRight(a,"selectionStart")}else{this._selectionDirection="right";this._moveRight(a,"selectionEnd")}},moveCursorRightWithoutShift:function(a){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd){this._moveRight(a,"selectionStart");this.setSelectionEnd(this.selectionStart)}else{this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText());this.setSelectionStart(this.selectionEnd)}},removeChars:function(a){if(this.selectionStart===this.selectionEnd){this._removeCharsNearCursor(a)}else{this._removeCharsFromTo(this.selectionStart,this.selectionEnd)}this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(c){if(this.selectionStart===0){return}if(c.metaKey){var a=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(a,this.selectionStart);this.setSelectionStart(a)}else{if(c.altKey){var b=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(b,this.selectionStart);this.setSelectionStart(b)}else{this._removeSingleCharAndStyle(this.selectionStart);this.setSelectionStart(this.selectionStart-1)}}}});(function(){var a=fabric.util.toFixed,b=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(h,g,d,e,c,f){if(!this._getLineStyle(h)){fabric.Text.prototype._setSVGTextLineText.call(this,h,g,d,e,c)}else{this._setSVGTextLineChars(h,g,d,e,f)}},_setSVGTextLineChars:function(q,c,p,e,g){var m=this._textLines[q],n=0,j=this._getLineLeftOffset(this._getLineWidth(this.ctx,q))-this.width/2,f=this._getSVGLineTopOffset(q),d=this._getHeightOfLine(this.ctx,q);for(var h=0,k=m.length;h<k;h++){var o=this._getStyleDeclaration(q,h)||{};c.push(this._createTextCharSpan(m[h],o,j,f.lineTop+f.offset,n));var l=this._getWidthOfChar(this.ctx,m[h],q,h);if(o.textBackgroundColor){g.push(this._createTextCharBg(o,j,f.lineTop,d,l,n))}n+=l}},_getSVGLineTopOffset:function(f){var e=0,d=0;for(var c=0;c<f;c++){e+=this._getHeightOfLine(this.ctx,c)}d=this._getHeightOfLine(this.ctx,c);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(d,h,g,e,c,f){return['\t\t<rect fill="',d.textBackgroundColor,'" x="',a(h+f,b),'" y="',a(g-this.height/2,b),'" width="',a(c,b),'" height="',a(e/this.lineHeight,b),'"></rect>\n'].join("")},_createTextCharSpan:function(d,c,h,g,f){var e=this.getSvgStyles.call(fabric.util.object.extend({visible:true,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},c));return['\t\t\t<tspan x="',a(h+f,b),'" y="',a(g-this.height/2,b),'" ',(c.fontFamily?'font-family="'+c.fontFamily.replace(/"/g,"'")+'" ':""),(c.fontSize?'font-size="'+c.fontSize+'" ':""),(c.fontStyle?'font-style="'+c.fontStyle+'" ':""),(c.fontWeight?'font-weight="'+c.fontWeight+'" ':""),(c.textDecoration?'text-decoration="'+c.textDecoration+'" ':""),'style="',e,'">',fabric.util.string.escapeXml(d),"</tspan>\n"].join("")}})})();(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.clone;b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:0,__cachedLines:null,lockScalingY:true,lockScalingFlip:true,initialize:function(e,d){this.ctx=b.util.createCanvasElement().getContext("2d");this.callSuper("initialize",e,d);this.setControlsVisibility(b.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=true},_initDimensions:function(d){if(this.__skipDimension){return}if(!d){d=b.util.createCanvasElement().getContext("2d");this._setTextStyles(d)}this.dynamicMinWidth=0;this._textLines=this._splitTextIntoLines();if(this.dynamicMinWidth>this.width){this._set("width",this.dynamicMinWidth)}this._clearCache();this.height=this._getTextHeight(d)},_generateStyleMap:function(){var h=0,g=0,d=0,f={};for(var e=0;e<this._textLines.length;e++){if(this.text[d]==="\n"){g=0;d++;h++}else{if(this.text[d]===" "){g++;d++}}f[e]={line:h,offset:g};d+=this._textLines[e].length;g+=this._textLines[e].length}return f},_getStyleDeclaration:function(g,f,e){if(this._styleMap){var d=this._styleMap[g];if(!d){return e?{}:null}g=d.line;f=d.offset+f}return this.callSuper("_getStyleDeclaration",g,f,e)},_setStyleDeclaration:function(g,f,d){var e=this._styleMap[g];g=e.line;f=e.offset+f;this.styles[g][f]=d},_deleteStyleDeclaration:function(f,e){var d=this._styleMap[f];f=d.line;e=d.offset+e;delete this.styles[f][e]},_getLineStyle:function(e){var d=this._styleMap[e];return this.styles[d.line]},_setLineStyle:function(f,d){var e=this._styleMap[f];this.styles[e.line]=d},_deleteLineStyle:function(e){var d=this._styleMap[e];delete this.styles[d.line]},_wrapText:function(e,h){var d=h.split(this._reNewline),f=[],g;for(g=0;g<d.length;g++){f=f.concat(this._wrapLine(e,d[g],g))}return f},_measureText:function(e,k,j,h){var g=0;h=h||0;for(var f=0,d=k.length;f<d;f++){g+=this._getWidthOfChar(e,k[f],j,f+h)}return g},_wrapLine:function(p,n,o){var k=0,r=[],s="",m=n.split(" "),f="",h=0,l=" ",q=0,e=0,d=0,g=true;for(var j=0;j<m.length;j++){f=m[j];q=this._measureText(p,f,o,h);h+=f.length;k+=e+q;if(k>=this.width&&!g){r.push(s);s="";k=q;g=true}if(!g){s+=l}s+=f;e=this._measureText(p,l,o,h);h++;g=false;if(q>d){d=q}}j&&r.push(s);if(d>this.dynamicMinWidth){this.dynamicMinWidth=d}return r},_splitTextIntoLines:function(){var e=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var d=this._wrapText(this.ctx,this.text);this.textAlign=e;this.ctx.restore();this._textLines=d;this._styleMap=this._generateStyleMap();return d},setOnGroup:function(d,e){if(d==="scaleX"){this.set("scaleX",Math.abs(1/e));this.set("width",(this.get("width")*e)/(typeof this.__oldScaleX==="undefined"?1:this.__oldScaleX));this.__oldScaleX=e}},get2DCursorLocation:function(h){if(typeof h==="undefined"){h=this.selectionStart}var e=this._textLines.length,j=0;for(var f=0;f<e;f++){var d=this._textLines[f],g=d.length;if(h<=j+g){return{lineIndex:f,charIndex:h-j}}j+=g;if(this.text[j]==="\n"||this.text[j]===" "){j++}}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(j,d){var h=0,k=0,f=this.get2DCursorLocation(),e=this._textLines[f.lineIndex].split(""),l=this._getLineLeftOffset(this._getLineWidth(this.ctx,f.lineIndex));for(var g=0;g<f.charIndex;g++){k+=this._getWidthOfChar(this.ctx,e[g],f.lineIndex,g)}for(g=0;g<f.lineIndex;g++){h+=this._getHeightOfLine(this.ctx,g)}if(d==="cursor"){h+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,f.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(f.lineIndex,f.charIndex)*(1-this._fontSizeFraction)}return{top:h,left:k,lineLeft:l}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(d){return b.util.object.extend(this.callSuper("toObject",d),{minWidth:this.minWidth})}});b.Textbox.fromObject=function(d){return new b.Textbox(d.text,c(d))};b.Textbox.getTextboxControlVisibility=function(){return{tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true}};b.Textbox.instances=[]})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(i,d,g,e,f,c,h){var k=d.target;if(k instanceof fabric.Textbox){var j=k.width*((i.x/d.scaleX)/(k.width+k.strokeWidth));if(j>=k.getMinWidth()){k.set("width",j);return true}}else{return a.call(fabric.Canvas.prototype,i,d,g,e,f,c,h)}};fabric.Group.prototype._refreshControlsVisibility=function(){if(typeof fabric.Textbox==="undefined"){return}for(var c=this._objects.length;c--;){if(this._objects[c] instanceof fabric.Textbox){this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());return}}};var b=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var c in this._styleMap){if(!this._textLines[c]){delete this.styles[this._styleMap[c].line]}}},insertCharStyleObject:function(f,e,c){var d=this._styleMap[f];f=d.line;e=d.offset+e;fabric.IText.prototype.insertCharStyleObject.apply(this,[f,e,c])},insertNewlineStyleObject:function(f,e,c){var d=this._styleMap[f];f=d.line;e=d.offset+e;fabric.IText.prototype.insertNewlineStyleObject.apply(this,[f,e,c])},shiftLineStyles:function(h,g){var f=b(this.styles),e=this._styleMap[h];h=e.line;for(var c in this.styles){var d=parseInt(c,10);if(d>h){this.styles[d+g]=f[d];if(!f[d-g]){delete this.styles[d]}}}},_getTextOnPreviousLine:function(c){var d=this._textLines[c-1];while(this._styleMap[c-2]&&this._styleMap[c-2].line===this._styleMap[c-1].line){d=this._textLines[c-2]+d;c--}return d},removeStyleObject:function(e,d){var c=this.get2DCursorLocation(d),f=this._styleMap[c.lineIndex],h=f.line,g=f.offset+c.charIndex;this._removeStyleObject(e,c,h,g)}})})();(function(){var a=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(h,g,f,c,b){c=a.call(this,h,g,f,c,b);var e=0,j=0;for(var d=0;d<this._textLines.length;d++){e+=this._textLines[d].length;if(e+j>=c){break}if(this.text[e+j]==="\n"||this.text[e+j]===" "){j++}}return c-d+j}})();(function(){if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;function request(url,encoding,callback){var oURL=URL.parse(url);if(!oURL.port){oURL.port=(oURL.protocol.indexOf("https:")===0)?443:80}var reqHandler=(oURL.protocol.indexOf("https:")===0)?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";if(encoding){response.setEncoding(encoding)}response.on("end",function(){callback(body)});response.on("data",function(chunk){if(response.statusCode===200){body+=chunk}})});req.on("error",function(err){if(err.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port)}else{fabric.log(err.message)}callback(null)});req.end()}function requestFs(path,callback){var fs=require("fs");fs.readFile(path,function(err,data){if(err){fabric.log(err);throw err}else{callback(data)}})}fabric.util.loadImage=function(url,callback,context){function createImageAndCallBack(data){if(data){img.src=new Buffer(data,"binary");img._src=url;callback&&callback.call(context,img)}else{img=null;callback&&callback.call(context,null,true)}}var img=new Image();if(url&&(url instanceof Buffer||url.indexOf("data")===0)){img.src=img._src=url;callback&&callback.call(context,img)}else{if(url&&url.indexOf("http")!==0){requestFs(url,createImageAndCallBack)}else{if(url){request(url,"binary",createImageAndCallBack)}else{callback&&callback.call(context,url)}}}};fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();if(url.indexOf("http")!==0){requestFs(url,function(body){fabric.loadSVGFromString(body.toString(),callback,reviver)})}else{request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})}};fabric.loadSVGFromString=function(string,callback,reviver){var doc=new DOMParser().parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object.filters,function(filters){oImg.filters=filters||[];oImg._initFilters(object.resizeFilters,function(resizeFilters){oImg.resizeFilters=resizeFilters||[];callback&&callback(oImg)})})})};fabric.createCanvasForNode=function(width,height,options,nodeCanvasOptions){nodeCanvasOptions=nodeCanvasOptions||options;var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600,nodeCanvasOptions);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl,options);fabricCanvas.contextContainer=nodeCanvas.getContext("2d");fabricCanvas.nodeCanvas=nodeCanvas;fabricCanvas.Font=Canvas.Font;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width,options){origSetWidth.call(this,width,options);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height,options){origSetHeight.call(this,height,options);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();