AmCharts.AmFunnelChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(){AmCharts.AmFunnelChart.base.construct.call(this);this.startX=this.startY=0;this.baseWidth="100%";this.neckHeight=this.neckWidth=0;this.rotate=!1;this.valueRepresents="height";this.pullDistance=30;this.labelPosition="center";this.labelText="[[title]]: [[value]]";this.balloonText="[[title]]: [[value]]\n[[description]]"},drawChart:function(){AmCharts.AmFunnelChart.base.drawChart.call(this);var j=this.chartData;if(AmCharts.ifArray(j)){if(0<this.realWidth&&0<this.realHeight){var P=this.container,S=this.startDuration,X=this.rotate,J=this.updateWidth();this.realWidth=J;var aa=this.updateHeight();this.realHeight=aa;var U=AmCharts.toCoordinate,R=U(this.marginLeft,J),L=U(this.marginRight,J),af=U(this.marginTop,aa)+this.getTitleHeight(),U=U(this.marginBottom,aa),L=J-R-L,H=AmCharts.toCoordinate(this.baseWidth,L),T=AmCharts.toCoordinate(this.neckWidth,L),O=aa-U-af,G=AmCharts.toCoordinate(this.neckHeight,O),M=af+O-G;X&&(af=aa-U,M=af-O+G);this.firstSliceY=af;AmCharts.VML&&(this.startAlpha=1);for(var Z=L/2+R,N=(O-G)/((H-T)/2),o=H/2,H=(O-G)*(H+T)/2+T*G,G=af,I=0,K=0;K<j.length;K++){var ad=j[K];if(!0!==ad.hidden){var W=[],Y=[],ae;if("height"==this.valueRepresents){ae=O*ad.percents/100}else{var V=-H*ad.percents/100/2,i=o,ac=-1/(2*N);ae=Math.pow(i,2)-4*ac*V;0>ae&&(ae=0);ae=(Math.sqrt(ae)-i)/(2*ac);if(!X&&af>=M||X&&af<=M){ae=2*-V/T}else{if(!X&&af+ae>M||X&&af-ae<M){ac=X?Math.round(ae+(af-ae-M)):Math.round(ae-(af+ae-M)),ae=ac/N,ae=ac+2*(-V-(i-ae/2)*ac)/T}}}V=o-ae/N;i=!1;!X&&af+ae>M||X&&af-ae<M?(V=T/2,W.push(Z-o,Z+o,Z+V,Z+V,Z-V,Z-V),X?(ac=ae+(af-ae-M),Y.push(af,af,af-ac,af-ae,af-ae,af-ac,af)):(ac=ae-(af+ae-M),Y.push(af,af,af+ac,af+ae,af+ae,af+ac,af)),i=!0):(W.push(Z-o,Z+o,Z+V,Z-V),X?Y.push(af,af,af-ae,af-ae):Y.push(af,af,af+ae,af+ae));P.set();ac=P.set();W=AmCharts.polygon(P,W,Y,ad.color,ad.alpha,this.outlineThickness,this.outlineColor,this.outlineAlpha);ac.push(W);this.graphsSet.push(ac);ad.wedge=ac;ad.index=K;if(Y=this.gradientRatio){var Q=[],ab;for(ab=0;ab<Y.length;ab++){Q.push(AmCharts.adjustLuminosity(ad.color,Y[ab]))}0<Q.length&&W.gradient("linearGradient",Q)}0<S&&(W=this.startAlpha,this.chartCreated&&(W=ad.alpha),ac.setAttr("opacity",W));this.addEventListeners(ac,ad);this.labelsEnabled&&this.labelText&&ad.percents>=this.hideLabelsPercent&&(Y=this.formatString(this.labelText,ad),Q=ad.labelColor,Q||(Q=this.color),W=this.labelPosition,ab="left","center"==W&&(ab="middle"),"left"==W&&(ab="right"),Y=AmCharts.text(P,Y,Q,this.fontFamily,this.fontSize,ab),ac.push(Y),Q=Z,X?(ab=af-ae/2,ad.ty0=ab):(ab=af+ae/2,ad.ty0=ab,ab<G+I+5&&(ab=G+I+5),ab>aa-U&&(ab=aa-U)),"right"==W&&(Q=L+10+R,ad.tx0=Z+(o-ae/2/N),i&&(ad.tx0=Z+V)),"left"==W&&(ad.tx0=Z-(o-ae/2/N),i&&(ad.tx0=Z-V),Q=R),ad.label=Y,ad.labelX=Q,ad.labelY=ab,ad.labelHeight=Y.getBBox().height,ad.startX=AmCharts.toCoordinate(this.startX,J),ad.startY=AmCharts.toCoordinate(this.startY,aa),ad.pullX=AmCharts.toCoordinate(this.pullDistance,J),ad.pullY=0,ad.balloonX=Z,ad.balloonY=ad.ty0,Y.translate(Q,ab),(0===ad.alpha||0<S&&!this.chartCreated)&&ac.hide(),af=X?af-ae:af+ae,o=V,I=Y.getBBox().height,G=ab)}}this.arrangeLabels();this.initialStart();(j=this.legend)&&j.invalidateSize()}else{this.cleanChart()}}this.dispDUpd();this.chartCreated=!0},arrangeLabels:function(){var j=this.rotate,b;b=j?0:this.realHeight;for(var e=0,h=this.chartData,o=h.length,i,g=0;g<o;g++){i=h[o-g-1];var d=i.label,q=i.labelY,l=i.labelX,m=i.labelHeight,c=q;j?b+e+5>q&&(c=b+e+5):q+m+5>b&&(c=b-5-m);b=c;e=m;d.translate(l,c);i.labelY=c;i.tx=l;i.ty=c;i.tx2=l}this.drawTicks()}});