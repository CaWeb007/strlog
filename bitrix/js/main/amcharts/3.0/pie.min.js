AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(){AmCharts.AmPieChart.base.construct.call(this);this.pieAlpha=1;this.pieBrightnessStep=30;this.minRadius=10;this.depth3D=0;this.startAngle=90;this.angle=this.innerRadius=0;this.startRadius="500%";this.pullOutRadius="20%";this.labelRadius=30;this.labelText="[[title]]: [[percents]]%";this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]";this.previousScale=1},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var T=this.chartData;if(AmCharts.ifArray(T)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var R=this.startDuration,V=this.container,X=this.updateWidth();this.realWidth=X;var Q=this.updateHeight();this.realHeight=Q;var U=AmCharts.toCoordinate,P=U(this.marginLeft,X),W=U(this.marginRight,X),J=U(this.marginTop,Q)+this.getTitleHeight(),O=U(this.marginBottom,Q),C,o,S,G=AmCharts.toNumber(this.labelRadius),H=this.measureMaxLabel();this.labelText&&this.labelsEnabled||(G=H=0);C=void 0===this.pieX?(X-P-W)/2+P:U(this.pieX,this.realWidth);o=void 0===this.pieY?(Q-J-O)/2+J:U(this.pieY,Q);S=U(this.radius,X,Q);S||(X=0<=G?X-P-W-2*H:X-P-W,Q=Q-J-O,S=Math.min(X,Q),Q<X&&(S/=1-this.angle/90,S>X&&(S=X)),Q=AmCharts.toCoordinate(this.pullOutRadius,S),S=(0<=G?S-1.8*(G+Q):S-1.8*Q)/2);S<this.minRadius&&(S=this.minRadius);Q=U(this.pullOutRadius,S);J=AmCharts.toCoordinate(this.startRadius,S);U=U(this.innerRadius,S);U>=S&&(U=S-1);O=AmCharts.fitToBounds(this.startAngle,0,360);0<this.depth3D&&(O=270<=O?270:90);O-=90;X=S-S*this.angle/90;for(P=0;P<T.length;P++){if(W=T[P],!0!==W.hidden&&0<W.percents){var M=360*W.percents/100,H=Math.sin((O+M/2)/180*Math.PI),j=-Math.cos((O+M/2)/180*Math.PI)*(X/S),L={fill:W.color,stroke:this.outlineColor,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha};W.url&&(L.cursor="pointer");L=AmCharts.wedge(V,C,o,O,M,S,X,U,this.depth3D,L,this.gradientRatio);this.addEventListeners(L,W);W.startAngle=O;T[P].wedge=L;if(0<R){var F=this.startAlpha;this.chartCreated&&(F=W.alpha);L.setAttr("opacity",F)}W.ix=H;W.iy=j;W.wedge=L;W.index=P;if(this.labelsEnabled&&this.labelText&&W.percents>=this.hideLabelsPercent){var N=O+M/2,M=G;isNaN(W.labelRadius)||(M=W.labelRadius);var F=C+H*(S+M),E=o+j*(S+M),i,D=0;if(0<=M){var K;90>=N&&0<=N?(K=0,i="start",D=8):90<=N&&180>N?(K=1,i="start",D=8):180<=N&&270>N?(K=2,i="end",D=-8):270<=N&&360>N&&(K=3,i="end",D=-8);W.labelQuarter=K}else{i="middle"}var N=this.formatString(this.labelText,W),I=W.labelColor;I||(I=this.color);N=AmCharts.text(V,N,I,this.fontFamily,this.fontSize,i);N.translate(F+1.5*D,E);W.tx=F+1.5*D;W.ty=E;W.startX=Math.round(H*J);W.startY=Math.round(j*J);W.pullX=Math.round(H*Q);W.pullY=Math.round(j*Q);E=U+(S-U)/2;W.pulled&&(E+=this.pullOutRadiusReal);W.balloonX=H*E+C;W.balloonY=j*E+o;0<=M?L.push(N):this.freeLabelsSet.push(N);W.label=N;W.tx=F;W.tx2=F+D;W.tx0=C+H*S;W.ty0=o+j*S}this.graphsSet.push(L);(0===W.alpha||0<R&&!this.chartCreated)&&L.hide();O+=360*W.percents/100}}0<G&&!this.labelRadiusField&&this.arrangeLabels();this.pieXReal=C;this.pieYReal=o;this.radiusReal=S;this.innerRadiusReal=U;0<G&&this.drawTicks();this.initialStart();this.setDepths()}(T=this.legend)&&T.invalidateSize()}else{this.cleanChart()}this.dispDUpd();this.chartCreated=!0},setDepths:function(){var f=this.chartData,d;for(d=0;d<f.length;d++){var h=f[d],b=h.wedge,h=h.startAngle;0<=h&&180>h?b.toFront():180<=h&&b.toBack()}},arrangeLabels:function(){var f=this.chartData,d=f.length,h,b;for(b=d-1;0<=b;b--){h=f[b],0!==h.labelQuarter||h.hidden||this.checkOverlapping(b,h,0,!0,0)}for(b=0;b<d;b++){h=f[b],1!=h.labelQuarter||h.hidden||this.checkOverlapping(b,h,1,!1,0)}for(b=d-1;0<=b;b--){h=f[b],2!=h.labelQuarter||h.hidden||this.checkOverlapping(b,h,2,!0,0)}for(b=0;b<d;b++){h=f[b],3!=h.labelQuarter||h.hidden||this.checkOverlapping(b,h,3,!1,0)}},checkOverlapping:function(o,n,r,t,m){var p,j,s=this.chartData,f=s.length,i=n.label;if(i){if(!0===t){for(j=o+1;j<f;j++){s[j].labelQuarter==r&&(p=this.checkOverlappingReal(n,s[j],r))&&(j=f)}}else{for(j=o-1;0<=j;j--){s[j].labelQuarter==r&&(p=this.checkOverlappingReal(n,s[j],r))&&(j=0)}}!0===p&&100>m&&(p=n.ty+3*n.iy,n.ty=p,i.translate(n.tx2,p),this.checkOverlapping(o,n,r,t,m+1))}},checkOverlappingReal:function(j,i,l){var b=!1,f=j.label,k=i.label;j.labelQuarter!=l||j.hidden||i.hidden||!k||(f=f.getBBox(),l={},l.width=f.width,l.height=f.height,l.y=j.ty,l.x=j.tx,j=k.getBBox(),k={},k.width=j.width,k.height=j.height,k.y=i.ty,k.x=i.tx,AmCharts.hitTest(l,k)&&(b=!0));return b}});