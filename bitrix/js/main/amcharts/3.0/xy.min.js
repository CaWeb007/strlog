AmCharts.AmXYChart=AmCharts.Class({inherits:AmCharts.AmRectangularChart,construct:function(){AmCharts.AmXYChart.base.construct.call(this);this.createEvents("zoomed");this.maxZoomFactor=20;this.chartType="xy"},initChart:function(){AmCharts.AmXYChart.base.initChart.call(this);this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0);this.updateScrollbar=!0;this.drawChart();this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());var f=this.marginLeftReal,h=this.marginTopReal,e=this.plotAreaWidth,g=this.plotAreaHeight;this.graphsSet.clipRect(f,h,e,g);this.bulletSet.clipRect(f,h,e,g);this.trendLinesSet.clipRect(f,h,e,g)},createValueAxes:function(){var h=[],l=[];this.xAxes=h;this.yAxes=l;var g=this.valueAxes,k,j;for(j=0;j<g.length;j++){k=g[j];var i=k.position;if("top"==i||"bottom"==i){k.rotate=!0}k.setOrientation(k.rotate);i=k.orientation;"V"==i&&l.push(k);"H"==i&&h.push(k)}0===l.length&&(k=new AmCharts.ValueAxis,k.rotate=!1,k.setOrientation(!1),g.push(k),l.push(k));0===h.length&&(k=new AmCharts.ValueAxis,k.rotate=!0,k.setOrientation(!0),g.push(k),h.push(k));for(j=0;j<g.length;j++){this.processValueAxis(g[j],j)}h=this.graphs;for(j=0;j<h.length;j++){this.processGraph(h[j],j)}},drawChart:function(){AmCharts.AmXYChart.base.drawChart.call(this);AmCharts.ifArray(this.chartData)?(this.chartScrollbar&&this.updateScrollbars(),this.zoomChart()):this.cleanChart();if(this.hideXScrollbar){var b=this.scrollbarH;b&&(this.removeListener(b,"zoomed",this.handleHSBZoom),b.destroy());this.scrollbarH=null}if(this.hideYScrollbar){if(b=this.scrollbarV){this.removeListener(b,"zoomed",this.handleVSBZoom),b.destroy()}this.scrollbarV=null}if(!this.autoMargins||this.marginsUpdated){this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars()}},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton();this.zoomObjects(this.valueAxes);this.zoomObjects(this.graphs);this.zoomTrendLines();this.dispatchAxisZoom()},toggleZoomOutButton:function(){1==this.heightMultiplier&&1==this.widthMultiplier?this.showZB(!1):this.showZB(!0)},dispatchAxisZoom:function(){var h=this.valueAxes,l;for(l=0;l<h.length;l++){var g=h[l];if(!isNaN(g.min)&&!isNaN(g.max)){var k,j;"V"==g.orientation?(k=g.coordinateToValue(-this.verticalPosition),j=g.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(k=g.coordinateToValue(-this.horizontalPosition),j=g.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth));if(!isNaN(k)&&!isNaN(j)){if(k>j){var i=j;j=k;k=i}g.dispatchZoomEvent(k,j)}}}},zoomObjects:function(f){var h=f.length,e;for(e=0;e<h;e++){var g=f[e];this.updateObjectSize(g);g.zoom(0,this.chartData.length-1)}},updateData:function(){this.parseData();var r=this.chartData,p=r.length-1,q=this.graphs,o=this.dataProvider,n=0,l,j;for(l=0;l<q.length;l++){if(j=q[l],j.data=r,j.zoom(0,p),j=j.valueField){var i;for(i=0;i<o.length;i++){var h=o[i][j];h>n&&(n=h)}}}for(l=0;l<q.length;l++){j=q[l],j.maxValue=n}if(r=this.chartCursor){r.updateData(),r.type="crosshair",r.valueBalloonsEnabled=!1}},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0;this.heightMultiplier=this.widthMultiplier=1;this.zoomChart();this.zoomScrollbars()},processValueAxis:function(b){b.chart=this;b.minMaxField="H"==b.orientation?"x":"y";b.minTemp=NaN;b.maxTemp=NaN;this.listenTo(b,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(b){b.xAxis||(b.xAxis=this.xAxes[0]);b.yAxis||(b.yAxis=this.yAxes[0])},parseData:function(){AmCharts.AmXYChart.base.parseData.call(this);this.chartData=[];var B=this.dataProvider,z=this.valueAxes,A=this.graphs,y;for(y=0;y<B.length;y++){var x={axes:{},x:{},y:{}},w=B[y],v;for(v=0;v<z.length;v++){var t=z[v].id;x.axes[t]={};x.axes[t].graphs={};var r;for(r=0;r<A.length;r++){var s=A[r],i=s.id;if(s.xAxis.id==t||s.yAxis.id==t){var o={};o.serialDataItem=x;o.index=y;var j={},u=Number(w[s.valueField]);isNaN(u)||(j.value=u);u=Number(w[s.xField]);isNaN(u)||(j.x=u);u=Number(w[s.yField]);isNaN(u)||(j.y=u);u=Number(w[s.errorField]);isNaN(u)||(j.error=u);o.values=j;this.processFields(s,o,w);o.serialDataItem=x;o.graph=s;x.axes[t].graphs[i]=o}}}this.chartData[y]=x}},formatString:function(e,f){var d=f.graph.numberFormatter;d||(d=this.numberFormatter);e=AmCharts.formatValue(e,f.values,["value","x","y"],d);-1!=e.indexOf("[[")&&(e=AmCharts.formatDataContextValue(e,f.dataContext));return e=AmCharts.AmXYChart.base.formatString.call(this,e,f)},addChartScrollbar:function(e){AmCharts.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]);if(e){this.chartScrollbar=e;this.scrollbarHeight=e.scrollbarHeight;var f="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var d=new AmCharts.SimpleChartScrollbar;d.skipEvent=!0;d.chart=this;this.listenTo(d,"zoomed",this.handleVSBZoom);AmCharts.copyProperties(e,d,f);d.rotate=!0;this.scrollbarV=d}this.hideXScrollbar||(d=new AmCharts.SimpleChartScrollbar,d.skipEvent=!0,d.chart=this,this.listenTo(d,"zoomed",this.handleHSBZoom),AmCharts.copyProperties(e,d,f),d.rotate=!1,this.scrollbarH=d)}},updateTrendLines:function(){var e=this.trendLines,f;for(f=0;f<e.length;f++){var d=e[f];d.chart=this;d.valueAxis||(d.valueAxis=this.yAxes[0]);d.valueAxisX||(d.valueAxisX=this.xAxes[0])}},updateMargins:function(){AmCharts.AmXYChart.base.updateMargins.call(this);var b=this.scrollbarV;b&&(this.getScrollbarPosition(b,!0,this.yAxes[0].position),this.adjustMargins(b,!0));if(b=this.scrollbarH){this.getScrollbarPosition(b,!1,this.xAxes[0].position),this.adjustMargins(b,!1)}},updateScrollbars:function(){var b=this.scrollbarV;b&&(this.updateChartScrollbar(b,!0),b.draw());if(b=this.scrollbarH){this.updateChartScrollbar(b,!1),b.draw()}},zoomScrollbars:function(){var b=this.scrollbarH;b&&b.relativeZoom(this.widthMultiplier,-this.horizontalPosition/this.widthMultiplier);(b=this.scrollbarV)&&b.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(b){b>this.maxZoomFactor&&(b=this.maxZoomFactor);return b},handleHSBZoom:function(e){var f=this.fitMultiplier(e.multiplier);e=-e.position*f;var d=-(this.plotAreaWidth*f-this.plotAreaWidth);e<d&&(e=d);this.widthMultiplier=f;this.horizontalPosition=e;this.zoomChart()},handleVSBZoom:function(e){var f=this.fitMultiplier(e.multiplier);e=-e.position*f;var d=-(this.plotAreaHeight*f-this.plotAreaHeight);e<d&&(e=d);this.heightMultiplier=f;this.verticalPosition=e;this.zoomChart()},handleAxisSelfZoom:function(e){if("H"==e.valueAxis.orientation){var f=this.fitMultiplier(e.multiplier);e=-e.position*f;var d=-(this.plotAreaWidth*f-this.plotAreaWidth);e<d&&(e=d);this.horizontalPosition=e;this.widthMultiplier=f}else{f=this.fitMultiplier(e.multiplier),e=-e.position*f,d=-(this.plotAreaHeight*f-this.plotAreaHeight),e<d&&(e=d),this.verticalPosition=e,this.heightMultiplier=f}this.zoomChart();f=this.graphs;for(e=0;e<f.length;e++){f[e].setAnimationPlayed()}this.zoomScrollbars()},handleCursorZoom:function(e){var f=this.widthMultiplier*this.plotAreaWidth/e.selectionWidth,d=this.heightMultiplier*this.plotAreaHeight/e.selectionHeight,f=this.fitMultiplier(f),d=this.fitMultiplier(d);this.horizontalPosition=(this.horizontalPosition-e.selectionX)*f/this.widthMultiplier;this.verticalPosition=(this.verticalPosition-e.selectionY)*d/this.heightMultiplier;this.widthMultiplier=f;this.heightMultiplier=d;this.zoomChart();this.zoomScrollbars()},removeChartScrollbar:function(){AmCharts.callMethod("destroy",[this.scrollbarH,this.scrollbarV]);this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(b){AmCharts.AmXYChart.base.handleReleaseOutside.call(this,b);AmCharts.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])}});