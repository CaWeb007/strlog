AmCharts.addInitHandler(function(chart){if(undefined===chart.dataLoader||!isObject(chart.dataLoader)){chart.dataLoader={}}var version=chart.version.split(".");if((Number(version[0])<3)||(3==Number(version[0])&&(Number(version[1])<13))){return}var l=chart.dataLoader;l.remaining=0;var defaults={async:true,format:"json",showErrors:true,showCurtain:true,noStyles:false,reload:0,timestamp:false,delimiter:",",skip:0,useColumnNames:false,reverse:false,reloading:false};if("stock"===chart.type){setTimeout(function(){if(0>chart.panelsSettings.startDuration){l.startDuration=chart.panelsSettings.startDuration;chart.panelsSettings.startDuration=0}for(var x in chart.dataSets){var ds=chart.dataSets[x];if(undefined!==ds.dataLoader&&undefined!==ds.dataLoader.url){ds.dataProvider=[];applyDefaults(ds.dataLoader);loadFile(ds.dataLoader.url,ds,ds.dataLoader,"dataProvider")}if(undefined!==ds.eventDataLoader&&undefined!==ds.eventDataLoader.url){ds.events=[];applyDefaults(ds.eventDataLoader);loadFile(ds.eventDataLoader.url,ds,ds.eventDataLoader,"stockEvents")}}},100)}else{applyDefaults(l);if(undefined===l.url){return}if(undefined!==chart.startDuration&&(0<chart.startDuration)){l.startDuration=chart.startDuration;chart.startDuration=0}chart.dataProvider=[];loadFile(l.url,chart,l,"dataProvider")}function loadFile(url,holder,options,providerKey){if(undefined===providerKey){providerKey="dataProvider"}if(options.showCurtain){showCurtain(undefined,options.noStyles)}l.remaining++;if(window.XMLHttpRequest){var request=new XMLHttpRequest()}else{var request=new ActiveXObject("Microsoft.XMLHTTP")}request.onreadystatechange=function(){if(4==request.readyState&&404==request.status){raiseError(__("Error loading the file")+": "+url,false,options)}else{if(4==request.readyState&&200==request.status){if(undefined===options.format){options.format="json"}options.format=options.format.toLowerCase();switch(options.format){case"json":holder[providerKey]=postprocess(parseJSON(request.responseText,options),options);break;case"csv":holder[providerKey]=postprocess(parseCSV(request.responseText,options),options);break;default:raiseError(__("Unsupported data format")+": "+options.format,e,options.noStyles);break}l.remaining--;if(0===l.remaining){if(options.async){if("map"===chart.type){chart.validateNow(true)}else{chart.validateData();if(l.startDuration){if("stock"===chart.type){chart.panelsSettings.startDuration=l.startDuration;for(var x in chart.panels){chart.panels[x].startDuration=l.startDuration;chart.panels[x].animateAgain()}}else{chart.startDuration=l.startDuration;chart.animateAgain()}}}}if("stock"===chart.type&&!options.reloading){chart.periodSelector.setDefaultPeriod()}removeCurtain()}if(options.reload){if(options.timeout){clearTimeout(options.timeout)}options.timeout=setTimeout(loadFile,1000*options.reload,url,holder,options);options.reloading=true}}}};try{request.open("GET",options.timestamp?timestampUrl(url):url,options.async);request.send()}catch(e){raiseError(__("Error loading the file")+": "+url,e,options)}}function parseJSON(response,options){try{if(undefined!==JSON){return JSON.parse(response)}else{return eval(response)}}catch(e){raiseError(__("Error parsing JSON file")+": "+l.url,e,options);return[]}}function parseCSV(response,options){var data=CSVToArray(response,options.delimiter);var res=[];var cols=[];if(options.useColumnNames){cols=data.shift();if(0<options.skip){options.skip--}}for(var i=0;i<options.skip;i++){data.shift()}var row;while(row=options.reverse?data.pop():data.shift()){var dataPoint={};for(var i=0;i<row.length;i++){var col=undefined===cols[i]?"col"+i:cols[i];dataPoint[col]=row[i]}res.push(dataPoint)}return res}function postprocess(data,options){if(undefined!==options.postProcess&&isFunction(options.postProcess)){try{return options.postProcess.call(this,data,options)}catch(e){raiseError(__("Error loading file")+": "+options.url,false,options);return data}}else{return data}}function isArray(obj){return obj instanceof Array}function isObject(obj){return"object"===typeof(obj)}function isFunction(obj){return"function"===typeof(obj)}function applyDefaults(obj){for(var x in defaults){setDefault(obj,x,defaults[x])}}function setDefault(obj,key,value){if(undefined===obj[key]){obj[key]=value}}function raiseError(msg,error,options){if(options.showErrors){showCurtain(msg,options.noStyles)}else{removeCurtain();console.log(msg)}}function __(msg){if(undefined!==chart.language&&undefined!==AmCharts.translations.dataLoader[chart.language]&&undefined!==AmCharts.translations.dataLoader[chart.language][msg]){return AmCharts.translations.dataLoader[chart.language][msg]}else{return msg}}function showCurtain(msg,noStyles){removeCurtain();if(undefined===msg){msg=__("Loading data...")}var curtain=document.createElement("div");curtain.setAttribute("id",chart.div.id+"-curtain");curtain.className="amcharts-dataloader-curtain";if(true!==noStyles){curtain.style.position="absolute";curtain.style.top=0;curtain.style.left=0;curtain.style.width=(undefined!==chart.realWidth?chart.realWidth:chart.divRealWidth)+"px";curtain.style.height=(undefined!==chart.realHeight?chart.realHeight:chart.divRealHeight)+"px";curtain.style.textAlign="center";curtain.style.display="table";curtain.style.fontSize="20px";curtain.style.background="rgba(255, 255, 255, 0.3)";curtain.innerHTML='<div style="display: table-cell; vertical-align: middle;">'+msg+"</div>"}else{curtain.innerHTML=msg}chart.containerDiv.appendChild(curtain);l.curtain=curtain}function removeCurtain(){try{if(undefined!==l.curtain){chart.containerDiv.removeChild(l.curtain)}}catch(e){}l.curtain=undefined}function timestampUrl(url){var p=url.split("?");if(1===p.length){p[1]=new Date().getTime()}else{p[1]+="&"+new Date().getTime()}return p.join("?")}function CSVToArray(strData,strDelimiter){strDelimiter=(strDelimiter||",");var objPattern=new RegExp(("(\\"+strDelimiter+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+strDelimiter+"\\r\\n]*))"),"gi");var arrData=[[]];var arrMatches=null;while(arrMatches=objPattern.exec(strData)){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&(strMatchedDelimiter!=strDelimiter)){arrData.push([])}if(arrMatches[2]){var strMatchedValue=arrMatches[2].replace(new RegExp('""',"g"),'"')}else{var strMatchedValue=arrMatches[3]}arrData[arrData.length-1].push(strMatchedValue)}return(arrData)}},["pie","serial","xy","funnel","radar","gauge","stock","map"]);