AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(a){this.type="pie";AmCharts.AmPieChart.base.construct.call(this,a);this.cname="AmPieChart";this.pieBrightnessStep=30;this.minRadius=10;this.depth3D=0;this.startAngle=90;this.angle=this.innerRadius=0;this.startRadius="500%";this.pullOutRadius="20%";this.labelRadius=20;this.labelText="[[title]]: [[percents]]%";this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]";this.previousScale=1;AmCharts.applyTheme(this,a,this.cname)},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var T=this.chartData;if(AmCharts.ifArray(T)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var S=this.startDuration,V=this.container,W=this.updateWidth();this.realWidth=W;var P=this.updateHeight();this.realHeight=P;var U=AmCharts.toCoordinate,O=U(this.marginLeft,W),X=U(this.marginRight,W),E=U(this.marginTop,P)+this.getTitleHeight(),N=U(this.marginBottom,P),o,j,R,s=AmCharts.toNumber(this.labelRadius),J=this.measureMaxLabel();J>this.maxLabelWidth&&(J=this.maxLabelWidth);this.labelText&&this.labelsEnabled||(s=J=0);o=void 0===this.pieX?(W-O-X)/2+O:U(this.pieX,this.realWidth);j=void 0===this.pieY?(P-E-N)/2+E:U(this.pieY,P);R=U(this.radius,W,P);R||(W=0<=s?W-O-X-2*J:W-O-X,P=P-E-N,R=Math.min(W,P),P<W&&(R/=1-this.angle/90,R>W&&(R=W)),P=AmCharts.toCoordinate(this.pullOutRadius,R),R=(0<=s?R-1.8*(s+P):R-1.8*P)/2);R<this.minRadius&&(R=this.minRadius);P=U(this.pullOutRadius,R);E=AmCharts.toCoordinate(this.startRadius,R);U=U(this.innerRadius,R);U>=R&&(U=R-1);N=AmCharts.fitToBounds(this.startAngle,0,360);0<this.depth3D&&(N=270<=N?270:90);N-=90;W=R-R*this.angle/90;for(O=0;O<T.length;O++){if(X=T[O],!0!==X.hidden&&0<X.percents){var L=360*X.percents/100,J=Math.sin((N+L/2)/180*Math.PI),i=-Math.cos((N+L/2)/180*Math.PI)*(W/R),M=this.outlineColor;M||(M=X.color);var K=this.alpha;isNaN(X.alpha)||(K=X.alpha);M={fill:X.color,stroke:M,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":K};X.url&&(M.cursor="pointer");M=AmCharts.wedge(V,o,j,N,L,R,W,U,this.depth3D,M,this.gradientRatio,X.pattern);AmCharts.setCN(this,M,"pie-item");AmCharts.setCN(this,M.wedge,"pie-slice");AmCharts.setCN(this,M,X.className,!0);this.addEventListeners(M,X);X.startAngle=N;T[O].wedge=M;0<S&&(this.chartCreated||M.setAttr("opacity",this.startAlpha));X.ix=J;X.iy=i;X.wedge=M;X.index=O;if(this.labelsEnabled&&this.labelText&&X.percents>=this.hideLabelsPercent){var Q=N+L/2;360<Q&&(Q-=360);var H=s;isNaN(X.labelRadius)||(H=X.labelRadius);var L=o+J*(R+H),K=j+i*(R+H),I,D=0;if(0<=H){var G;90>=Q&&0<=Q?(G=0,I="start",D=8):90<=Q&&180>Q?(G=1,I="start",D=8):180<=Q&&270>Q?(G=2,I="end",D=-8):270<=Q&&360>Q&&(G=3,I="end",D=-8);X.labelQuarter=G}else{I="middle"}var Q=this.formatString(this.labelText,X),F=this.labelFunction;F&&(Q=F(X,Q));F=X.labelColor;F||(F=this.color);""!=Q&&(Q=AmCharts.wrappedText(V,Q,F,this.fontFamily,this.fontSize,I,!1,this.maxLabelWidth),AmCharts.setCN(this,Q,"pie-label"),AmCharts.setCN(this,Q,X.className,!0),Q.translate(L+1.5*D,K),Q.node.style.pointerEvents="none",X.tx=L+1.5*D,X.ty=K,0<=H?(H=Q.getBBox(),F=AmCharts.rect(V,H.width+5,H.height+5,"#FFFFFF",0.005),F.translate(L+1.5*D+H.x,K+H.y),X.hitRect=F,M.push(Q),M.push(F)):this.freeLabelsSet.push(Q),X.label=Q);X.tx=L;X.tx2=L+D;X.tx0=o+J*R;X.ty0=j+i*R}L=U+(R-U)/2;X.pulled&&(L+=this.pullOutRadiusReal);X.balloonX=J*L+o;X.balloonY=i*L+j;X.startX=Math.round(J*E);X.startY=Math.round(i*E);X.pullX=Math.round(J*P);X.pullY=Math.round(i*P);this.graphsSet.push(M);(0===X.alpha||0<S&&!this.chartCreated)&&M.hide();N+=360*X.percents/100}}0<s&&!this.labelRadiusField&&this.arrangeLabels();this.pieXReal=o;this.pieYReal=j;this.radiusReal=R;this.innerRadiusReal=U;0<s&&this.drawTicks();this.initialStart();this.setDepths()}(T=this.legend)&&T.invalidateSize()}else{this.cleanChart()}this.dispDUpd();this.chartCreated=!0},setDepths:function(){var g=this.chartData,d;for(d=0;d<g.length;d++){var h=g[d],a=h.wedge,h=h.startAngle;0<=h&&180>h?a.toFront():180<=h&&a.toBack()}},arrangeLabels:function(){var g=this.chartData,d=g.length,h,a;for(a=d-1;0<=a;a--){h=g[a],0!==h.labelQuarter||h.hidden||this.checkOverlapping(a,h,0,!0,0)}for(a=0;a<d;a++){h=g[a],1!=h.labelQuarter||h.hidden||this.checkOverlapping(a,h,1,!1,0)}for(a=d-1;0<=a;a--){h=g[a],2!=h.labelQuarter||h.hidden||this.checkOverlapping(a,h,2,!0,0)}for(a=0;a<d;a++){h=g[a],3!=h.labelQuarter||h.hidden||this.checkOverlapping(a,h,3,!1,0)}},checkOverlapping:function(n,j,p,q,i){var o,h,r=this.chartData,s=r.length,g=j.label;if(g){if(!0===q){for(h=n+1;h<s;h++){r[h].labelQuarter==p&&(o=this.checkOverlappingReal(j,r[h],p))&&(h=s)}}else{for(h=n-1;0<=h;h--){r[h].labelQuarter==p&&(o=this.checkOverlappingReal(j,r[h],p))&&(h=0)}}!0===o&&100>i&&(o=j.ty+3*j.iy,j.ty=o,g.translate(j.tx2,o),j.hitRect&&(g=g.getBBox(),j.hitRect.translate(j.tx2+g.x,o+g.y)),this.checkOverlapping(n,j,p,q,i+1))}},checkOverlappingReal:function(i,h,l){var a=!1,g=i.label,j=h.label;i.labelQuarter!=l||i.hidden||h.hidden||!j||(g=g.getBBox(),l={},l.width=g.width,l.height=g.height,l.y=i.ty,l.x=i.tx,i=j.getBBox(),j={},j.width=i.width,j.height=i.height,j.y=h.ty,j.x=h.tx,AmCharts.hitTest(l,j)&&(a=!0));return a}});