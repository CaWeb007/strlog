var phpVars;if(!phpVars){phpVars={ADMIN_THEME_ID:".default",LANGUAGE_ID:"en",FORMAT_DATE:"DD.MM.YYYY",FORMAT_DATETIME:"DD.MM.YYYY HH:MI:SS",opt_context_ctrl:false,cookiePrefix:"BITRIX_SM",titlePrefix:"",bitrix_sessid:"",messHideMenu:"",messShowMenu:"",messHideButtons:"",messShowButtons:"",messFilterInactive:"",messFilterActive:"",messFilterLess:"",messLoading:"Loading...",messMenuLoading:"",messMenuLoadingTitle:"",messNoData:"",messExpandTabs:"",messCollapseTabs:"",messPanelFixOn:"",messPanelFixOff:"",messPanelCollapse:"",messPanelExpand:""}}function JCAdminCalendar(){var c=this;this.mess={};this.floatDiv=null;this.content=null;this.dateInitial=new Date();this.dateCurrent=null;this.dateCreate=new Date();this.bTime=false;this.bFirst=true;this.menu=null;this.form=this.field=this.fieldFrom=this.fieldTo=null;var a=document.getElementsByTagName("HEAD");if(a){var b=document.createElement("LINK");b.rel="stylesheet";b.href="/bitrix/themes/"+top.phpVars.ADMIN_THEME_ID+"/calendar.css"+(top.jsUtils.IsOpera()?"":"?"+this.mess.css_ver);a[0].appendChild(b)}this.Show=function(j,n,l,h,e,g){if(this.floatDiv){this.Close()}this.form=top.jsUtils.FindParentObject(j,"form");if(!this.form){var o=document.getElementsByName(n);for(var k in o){if(o[k].form){this.form=o[k].form;break}}}this.field=n;this.fieldFrom=l;this.fieldTo=h;this.bTime=e;var f=g*1000-(this.dateCreate.valueOf()-this.dateCreate.getTimezoneOffset()*60000);this.dateCurrent=this.ParseDate(this.form.elements[this.field].value);if(this.dateCurrent){this.dateInitial.setTime(this.dateCurrent.valueOf())}else{if(this.bFirst){this.dateInitial.setTime((new Date()).valueOf()+f);this.dateInitial.setHours(0,0,0)}}var d=document.body.appendChild(document.createElement("DIV"));d.id="calendar_float_div";d.className="calendar-float";d.style.position="absolute";d.style.left="-1000px";d.style.top="-1000px";d.style.zIndex=BX&&BX.WindowManager&&BX.WindowManager.Get()?(BX.WindowManager.Get().zIndex+2):"1100";this.hoursSpin=new JCSpinner("hours");this.minutesSpin=new JCSpinner("minutes");this.secondsSpin=new JCSpinner("seconds");d.innerHTML='<div class="title"><table cellspacing="0" width="100%">	<tr>		<td width="100%" class="title-text" onmousedown="jsFloatDiv.StartDrag(arguments[0], document.getElementById(\'calendar_float_div\'));" id="calendar_float_title">'+this.mess.title+'</td><td width="0%"><a class="close" href="javascript:jsAdminCalendar.Close();" title="'+this.mess.close+'"></a></td></tr></table></div><div class="content"></div><div class="time" align="center" style="display:'+(this.bTime?"block":"none")+'"><form name="float_calendar_time"><table cellspacing="0">	<tr>		<td>'+this.mess.hour+'</td>		<td><input type="text" name="hours" value="'+this.Number(this.dateInitial.getHours())+'" size="2" title="'+this.mess.hour_title+'" onchange="jsAdminCalendar.TimeChange(this);" onblur="jsAdminCalendar.TimeChange(this);"></td>		<td>'+this.hoursSpin.Show("jsAdminCalendar.hoursSpin")+"</td>		<td>&nbsp;"+this.mess.minute+'</td>		<td><input type="text" name="minutes" value="'+this.Number(this.dateInitial.getMinutes())+'" size="2" title="'+this.mess.minute_title+'" onchange="jsAdminCalendar.TimeChange(this);" onblur="jsAdminCalendar.TimeChange(this);"></td>		<td>'+this.hoursSpin.Show("jsAdminCalendar.minutesSpin")+"</td>		<td>&nbsp;"+this.mess.second+'</td>		<td><input type="text" name="seconds" value="'+this.Number(this.dateInitial.getSeconds())+'" size="2" title="'+this.mess.second_title+'" onchange="jsAdminCalendar.TimeChange(this);" onblur="jsAdminCalendar.TimeChange(this);"></td>		<td>'+this.hoursSpin.Show("jsAdminCalendar.secondsSpin")+'</td>		<td>&nbsp;</td>		<td><a title="'+this.mess.set_time+'" href="javascript:jsAdminCalendar.CurrentTime('+f+');" class="time set-time"></a></td>		<td><a title="'+this.mess.clear_time+'" href="javascript:jsAdminCalendar.ClearTime();" class="time clear-time"></a></td>	</tr></table></form></div><table cellspacing="0" class="time-toolbar">	<tr>		<td align="center"><a id="calendar_time_button" hidefocus="true" tabindex="-1" title="'+(this.bTime?this.mess.time_hide:this.mess.time)+'" href="javascript:jsAdminCalendar.ToggleTime();" class="button '+(this.bTime?"arrow-up":"arrow-down")+'"></a></td>	</tr></table>';this.floatDiv=d;this.content=top.jsUtils.FindChildObject(this.floatDiv,"div","content");this.content.innerHTML=this.GetMonthPage();var m=top.jsUtils.GetRealPos(j);m.bottom+=2;m=top.jsUtils.AlignToPos(m,d.offsetWidth,d.offsetHeight);jsFloatDiv.Show(d,m.left,m.top,3);setTimeout(function(){top.jsUtils.addEvent(document,"click",c.CheckClick)},10);top.jsUtils.addEvent(document,"keypress",c.OnKeyPress);this.bFirst=false};this.GetMonthPage=function(){var v=[this.mess.jan,this.mess.feb,this.mess.mar,this.mess.apr,this.mess.may,this.mess.jun,this.mess.jul,this.mess.aug,this.mess.sep,this.mess.okt,this.mess.nov,this.mess.des];var g=this.dateInitial.getFullYear(),p=this.dateInitial.getMonth(),w=this.dateInitial.getDate();var r=new Date();r.setHours(this.dateInitial.getHours(),this.dateInitial.getMinutes(),this.dateInitial.getSeconds());var h=(r.getFullYear()==g&&r.getMonth()==p);document.getElementById("calendar_float_title").innerHTML=v[p]+", "+g;var x="";x+='<div style="width:100%;"><table cellspacing="0" class="toolbar"><tr><td><a title="'+this.mess.prev_mon+'" href="javascript:jsAdminCalendar.NavigateMonth('+(p-1)+');" class="button left"></a></td><td width="50%"></td><td><a title="'+(h?this.mess.curr_day:this.mess.curr)+'" href="javascript:'+(h?"jsAdminCalendar.InsertDate('"+r.valueOf()+"')":"jsAdminCalendar.NavigateToday()")+';" class="button today"></a></td><td><a title="'+this.mess.per_mon+'" href="javascript:jsAdminCalendar.InsertPeriod(\''+this.getMonthFirst().valueOf()+"', '"+this.getMonthLast().valueOf()+'\');" class="button menu">'+v[p]+'</a></td><td><a title="'+this.mess.month+'" href="javascript:void(0)" onclick="jsAdminCalendar.MenuMonth(this);" class="button arrow"></a></td><td><a title="'+this.mess.per_year+'" href="javascript:jsAdminCalendar.InsertPeriod(\''+this.getYearFirst().valueOf()+"', '"+this.getYearLast().valueOf()+'\');" class="button menu">'+g+'</a></td><td><a title="'+this.mess.year+'" href="javascript:void(0)" onclick="jsAdminCalendar.MenuYear(this);" class="button arrow"></a></td><td width="50%"></td><td><a title="'+this.mess.next_mon+'" href="javascript:jsAdminCalendar.NavigateMonth('+(p+1)+');" class="button right"></a></td></tr></table>';x+='<div class="calendar"><div style="width:100%;"><table cellspacing="0"><tr class="head"><td class="week">&nbsp;</td><td>'+this.mess.mo+"</td><td>"+this.mess.tu+"</td><td>"+this.mess.we+"</td><td>"+this.mess.th+"</td><td>"+this.mess.fr+"</td><td>"+this.mess.sa+"</td><td>"+this.mess.su+"</td></tr>";var e=new Date(g,p,1,this.dateInitial.getHours(),this.dateInitial.getMinutes(),this.dateInitial.getSeconds());var f=e.getDay()-1;if(f==-1){f=6}var l=new Date();var k=false;for(var o=0;o<6;o++){var u=o*7;l.setTime(e.valueOf());l.setDate(1-f+u);if(o>0&&l.getDate()==1){break}var t=this.WeekNumber(l);x+='<tr><td class="week"><a title="'+this.mess.per_week+'" href="javascript:jsAdminCalendar.InsertPeriod(\''+l.valueOf()+"', '";l.setTime(e.valueOf());l.setDate(1-f+u+6);x+=l.valueOf()+"');\">"+t+"</a></td>";for(var n=0;n<7;n++){l.setTime(e.valueOf());l.setDate(1-f+u+n);var q=l.getDate();if(o>0&&q==1){k=true}var m="";if(u+n+1>f&&!k){if(q==r.getDate()&&h){m+=" today"}if(this.dateCurrent&&q==this.dateCurrent.getDate()&&p==this.dateCurrent.getMonth()&&g==this.dateCurrent.getFullYear()){m+=" current"}}if(n==5||n==6){m+=" holiday"}if(!(u+n+1>f&&!k)){m+=" inactive"}x+="<td"+(m!=""?' class="'+m+'"':"")+">";x+='<a title="'+this.mess.date+'" href="javascript:jsAdminCalendar.InsertDate(\''+l.valueOf()+"')\">"+q+"</a>";x+="</td>"}x+="</tr>";if(k){break}}x+="</table></div></div></div>";return x};this.WeekNumber=function(f){var d=new Date(f.getFullYear(),0,1);var h=d.getDay()-1;if(h==-1){h=6}var g=Math.round((f.valueOf()-d.valueOf())/(24*60*60*1000));var e=(g-(7-h))/7+1;if(h<4){e++}if(e>52){d=new Date(f.getFullYear()+1,0,1);h=d.getDay()-1;if(h==-1){h=6}if(h<4){e=1}}return e};this.NavigateToday=function(){var f=this.dateInitial.getHours(),d=this.dateInitial.getMinutes(),e=this.dateInitial.getSeconds();this.dateInitial.setTime((new Date()).valueOf());this.dateInitial.setHours(f,d,e);this.content.innerHTML=jsAdminCalendar.GetMonthPage()};this.NavigateMonth=function(d){this.dateInitial.setMonth(d,1);this.content.innerHTML=jsAdminCalendar.GetMonthPage()};this.NavigateYear=function(d){this.dateInitial.setFullYear(d,this.dateInitial.getMonth(),1);this.content.innerHTML=jsAdminCalendar.GetMonthPage()};this.getMonthFirst=function(){var e=new Date();e.setTime(this.dateInitial.valueOf());e.setDate(1);return e};this.getMonthLast=function(){var e=new Date();e.setTime(this.dateInitial.valueOf());e.setMonth(e.getMonth()+1);e.setDate(0);return e};this.getYearFirst=function(){var e=new Date();e.setTime(this.dateInitial.valueOf());e.setMonth(0);e.setDate(1);return e};this.getYearLast=function(){var e=new Date();e.setTime(this.dateInitial.valueOf());e.setFullYear(e.getFullYear()+1);e.setMonth(0);e.setDate(0);return e};this.InsertDaysBack=function(e,g){if(g!=""){var f=new Date();if(g>0){f.setTime(f.valueOf()-g*24*60*60*1000)}e.value=this.FormatDate(f,top.phpVars.FORMAT_DATE);e.disabled=true}else{e.disabled=false;e.value=""}};this.ValueToString=function(f){var d=new Date();d.setTime(f);if(this.bTime){var e=document.forms.float_calendar_time;d.setHours(parseInt(e.hours.value,10));d.setMinutes(parseInt(e.minutes.value,10));d.setSeconds(parseInt(e.seconds.value,10))}return this.FormatDate(d)};this.CurrentTime=function(f){var e=new Date();e.setTime(e.valueOf()+f);var d=document.forms.float_calendar_time;d.hours.value=e.getHours();d.minutes.value=e.getMinutes();d.seconds.value=e.getSeconds();d.hours.onchange();d.minutes.onchange();d.seconds.onchange()};this.ClearTime=function(){var d=document.forms.float_calendar_time;d.hours.value=d.minutes.value=d.seconds.value="00"};this.InsertDate=function(d){this.form.elements[this.field].value=this.ValueToString(d);if(BX){BX.fireEvent(this.form.elements[this.field],"change")}this.Close()};this.InsertPeriod=function(e,d){if(this.fieldFrom!=""&&this.fieldTo!=""){this.form.elements[this.fieldFrom].value=this.ValueToString(e);this.form.elements[this.fieldTo].value=this.ValueToString(d)}else{this.form.elements[this.field].value=this.ValueToString(e)}this.Close()};this.Number=function(d){return(d<10?"0"+d:d)};this.FormatDate=function(e,g){var i;var h=(g?g:(this.bTime?top.phpVars.FORMAT_DATETIME:top.phpVars.FORMAT_DATE));h=h.replace(/YYYY/ig,e.getFullYear());h=h.replace(/MMMM/ig,this.Number(e.getMonth()+1));h=h.replace(/MM/ig,this.Number(e.getMonth()+1));h=h.replace(/MI/ig,this.Number(e.getMinutes()));h=h.replace(/M/ig,this.Number(e.getMonth()+1));h=h.replace(/DD/ig,this.Number(e.getDate()));h=h.replace(/GG/ig,this.Number(e.getHours()));h=h.replace(/HH/ig,this.Number(e.getHours()));if(BX.isAmPmMode()){var d=this.Number(e.getHours());var f="am";if(d>12){d=d-12;f="pm"}else{if(d==12){f="pm"}}h=h.replace(/G/ig,d);h=h.replace(/H/ig,d);h=h.replace(/TT/ig,f);h=h.replace(/T/ig,f)}h=h.replace(/SS/ig,this.Number(e.getSeconds()));return h};this.ParseDate=function(l){var e=l.split(/[^\w]/ig);var m=top.phpVars.FORMAT_DATE.split(/[^\w]/ig);if(e.length>m.length){m=top.phpVars.FORMAT_DATETIME.split(/[^\w]/ig)}var h,f;var g=[],j=[];for(h=0,f=e.length;h<f;h++){if(top.jsUtils.trim(e[h])!=""){g[g.length]=e[h]}}for(h=0,f=m.length;h<f;h++){if(top.jsUtils.trim(m[h])!=""){j[j.length]=m[h]}}var n={};for(h=0,f=j.length;h<f;h++){if(g[h]!=undefined&&g[h].match(/[a-z]/gi)!=null){n[j[h].toUpperCase()]=g[h]}else{n[j[h].toUpperCase()]=parseInt(g[h],10)}}if(n.MM==undefined&&(n.M!=undefined||n.MMMM!=undefined)){if(n.M!=undefined){if(typeof(n.M)=="string"){n.MM=BX.getNumMonth(n.M)}else{n.MM=n.M}}else{if(typeof(n.MMMM)=="string"){n.MM=BX.getNumMonth(n.MMMM)}else{n.MM=n.MMMM}}}if(n.DD>0&&n.MM>0&&n.YYYY>0){var k=new Date();k.setDate(1);k.setFullYear(n.YYYY);k.setMonth(n.MM-1);k.setDate(n.DD);k.setHours(0,0,0);if(n.HH==undefined&&(n.H!=undefined||n.G!=undefined||n.G!=undefined)){if(n.H!=undefined){n.HH=n.H}else{if(n.G!=undefined){n.HH=n.G}else{n.HH=n.GG}}if(n.TT!=undefined&&n.TT.toLowerCase()=="pm"){n.HH=n.HH+12}else{if(n.T!=undefined&&n.T.toLowerCase()=="pm"){n.HH=n.HH+12}}}if(!isNaN(n.HH)&&!isNaN(n.MI)&&!isNaN(n.SS)){this.bTime=true;k.setHours(n.HH,n.MI,n.SS)}return k}return null};this.MenuMonth=function(d){var h=[this.mess.jan,this.mess.feb,this.mess.mar,this.mess.apr,this.mess.may,this.mess.jun,this.mess.jul,this.mess.aug,this.mess.sep,this.mess.okt,this.mess.nov,this.mess.des];var e=[];var g=this.dateInitial.getMonth();for(var f in h){e[f]={ICONCLASS:(g==f?"checked":""),TEXT:h[f],ONCLICK:"jsAdminCalendar.NavigateMonth("+f+")",DEFAULT:((new Date()).getMonth()==f?true:false)}}this.ShowMenu(d,e)};this.MenuYear=function(d){var e=[];var g=this.dateInitial.getFullYear();for(var f=0;f<11;f++){item_year=g-5+f;e[f]={ICONCLASS:(g==item_year?"checked":""),TEXT:item_year,ONCLICK:"jsAdminCalendar.NavigateYear("+item_year+")",DEFAULT:((new Date()).getFullYear()==item_year?true:false)}}this.ShowMenu(d,e)};this.ShowMenu=function(d,e){if(!this.menu){this.menu=new PopupMenu("calendar_float_menu");this.menu.Create(parseInt(this.floatDiv.style.zIndex)+10,3);this.menu.OnClose=function(){setTimeout(function(){if(c.floatDiv){top.jsUtils.addEvent(document,"click",c.CheckClick)}},10);top.jsUtils.addEvent(document,"keypress",c.OnKeyPress)}}if(this.menu.IsVisible()){return}this.menu.SetItems(e);this.menu.BuildItems();var f=top.jsUtils.GetRealPos(d);f.bottom+=1;top.jsUtils.removeEvent(document,"click",c.CheckClick);top.jsUtils.removeEvent(document,"keypress",c.OnKeyPress);this.menu.PopupShow(f)};this.ToggleTime=function(){var e=top.jsUtils.FindChildObject(this.floatDiv,"div","time");var d=document.getElementById("calendar_time_button");if(e.style.display=="none"){e.style.display="block";d.className="button arrow-up";d.title=this.mess.time_hide}else{e.style.display="none";d.className="button arrow-down";d.title=this.mess.time}d.blur();jsFloatDiv.AdjustShadow(this.floatDiv)};this.TimeChange=function(d){this.bTime=true;var e=parseInt(d.value,10);if(isNaN(e)){e="00"}else{if(e<0){if(d.name=="hours"){e="23"}else{e="59"}}else{if(d.name=="hours"&&e>23||e>59){e="00"}else{e=this.Number(e)}}}d.value=e};this.Close=function(){top.jsUtils.removeEvent(document,"click",c.CheckClick);top.jsUtils.removeEvent(document,"keypress",c.OnKeyPress);jsFloatDiv.Close(this.floatDiv);this.floatDiv.parentNode.removeChild(this.floatDiv);this.floatDiv=null};this.OnKeyPress=function(d){if(!d){d=window.event}if(!d){return}if(d.keyCode==27){c.Close()}};this.CheckClick=function(h){var j=c.floatDiv;if(!j){return}var f=jsUtils.GetWindowSize();var d=h.clientX+f.scrollLeft;var i=h.clientY+f.scrollTop;var g=jsUtils.GetRealPos(j);if(d>=g.left&&d<=g.right&&i>=g.top&&i<=g.bottom){return}c.Close()}}var jsAdminCalendar=new JCAdminCalendar();function JCSpinner(a){var b=this;this.name=a;this.mousedown=false;this.Show=function(c){var d='<table cellspacing="0" class="spin">	<tr><td><a hidefocus="true" tabindex="-1" href="javascript:void(0);" onmousedown="'+c+'.Start(1);" class="spin spin-up"></a></td></tr>	<tr><td><a hidefocus="true" tabindex="-1" href="javascript:void(0);" onmousedown="'+c+'.Start(-1);" class="spin spin-down"></a></td></tr></table>';return d};this.Start=function(c){this.mousedown=true;top.jsUtils.addEvent(document,"mouseup",b.MouseUp);this.ChangeValue(c,true)};this.ChangeValue=function(e,d){if(!this.mousedown){return}var c=document.forms.float_calendar_time.elements[this.name];c.value=parseInt(c.value,10)+e;c.onchange();setTimeout(function(){b.ChangeValue(e,false)},(d?1000:150))};this.MouseUp=function(){b.mousedown=false;top.jsUtils.removeEvent(document,"mouseup",b.MouseUp)}};