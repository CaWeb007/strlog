(function(){if(BX.PhoneNumber){return}var ac;var z=null;var j=false;var r="/bitrix/js/main/phonenumber/metadata.json";var w="/bitrix/tools/phone_number.php";var ap={};var P;var ae=3;var T=2;var x=17;var H=250;var R="+";var I="0-9";var b="-";var ab="/";var q=".";var u="\\s";var f="()\\[\\]";var a="~";var N=";#";var ah=",";var h="["+R+I+"]";var v="[^"+I+N+ah+"]+$";var ao="["+I+"]{"+T+"}";var ai=b+ab+q+u+f+a+N+ah;var ag=I+R+N+ah;var au="["+R+"]{0,1}(?:["+ai+"]*["+I+"]){3,}["+ai+I+"]*";var aa="^(?:^"+ao+"$|^"+au+"$)$";var ad=function(){if(j){var av=new BX.Promise();av.fulfill({codeToCountries:P,metadata:ap});return av}else{if(z){return z}else{z=new BX.Promise();BX.ajax.load({url:r,type:"json",callback:function(aw){P=aw.codeToCountries;ap=aw.metadata;aw.metadata.forEach(function(ax){ap[ax.id]=ax});j=true;z.fulfill({codeToCountries:P,metadata:ap})}});return z}}};BX.PhoneNumber=function(){this.rawNumber=null;this.country=null;this.valid=false;this.countryCode=null;this.nationalNumber=null;this.numberType=null;this.extension=null;this.extensionSeparator=null;this.international=false;this.nationalPrefix=null;this.hasPlusChar=false};BX.PhoneNumber.Format={E164:"E.164",INTERNATIONAL:"International",NATIONAL:"National"};BX.PhoneNumber.getDefaultCountry=function(){return BX.message("phone_number_default_country")};BX.PhoneNumber.getUserDefaultCountry=function(){return BX.message("user_default_country")};BX.PhoneNumber.getIncompleteFormatter=function(aw){var av=new BX.Promise();if(j){av.fulfill(new BX.PhoneNumber.IncompleteFormatter(aw))}else{ad().then(function(){av.fulfill(new BX.PhoneNumber.IncompleteFormatter(aw))})}return av};BX.PhoneNumber.prototype.format=function(av){if(this.valid){if(!av){return BX.PhoneNumberFormatter.formatOriginal(this)}else{return BX.PhoneNumberFormatter.format(this,av)}}else{if(y.isApplicable(this.getRawNumber())){return y.format(this.getRawNumber())}else{return this.rawNumber}}};BX.PhoneNumber.prototype.getRawNumber=function(){return this.rawNumber};BX.PhoneNumber.prototype.setRawNumber=function(av){this.rawNumber=av};BX.PhoneNumber.prototype.getCountry=function(){return this.country};BX.PhoneNumber.prototype.setCountry=function(av){this.country=av};BX.PhoneNumber.prototype.isValid=function(){return this.valid};BX.PhoneNumber.prototype.setValid=function(av){this.valid=av};BX.PhoneNumber.prototype.getCountryCode=function(){return this.countryCode};BX.PhoneNumber.prototype.setCountryCode=function(av){this.countryCode=av};BX.PhoneNumber.prototype.getNationalNumber=function(){return this.nationalNumber};BX.PhoneNumber.prototype.setNationalNumber=function(av){this.nationalNumber=av};BX.PhoneNumber.prototype.getNumberType=function(){return this.numberType};BX.PhoneNumber.prototype.setNumberType=function(av){this.numberType=av};BX.PhoneNumber.prototype.hasExtension=function(){return !!this.extension};BX.PhoneNumber.prototype.getExtension=function(){return this.extension};BX.PhoneNumber.prototype.setExtension=function(av){this.extension=av};BX.PhoneNumber.prototype.getExtensionSeparator=function(){return this.extensionSeparator};BX.PhoneNumber.prototype.setExtensionSeparator=function(av){this.extensionSeparator=av};BX.PhoneNumber.prototype.isInternational=function(){return this.international};BX.PhoneNumber.prototype.setInternational=function(av){this.international=av};BX.PhoneNumber.prototype.getNationalPrefix=function(){return this.nationalPrefix};BX.PhoneNumber.prototype.setNationalPrefix=function(av){this.nationalPrefix=av};BX.PhoneNumber.prototype.hasPlus=function(){return this.hasPlusChar};BX.PhoneNumber.prototype.setHasPlus=function(av){this.hasPlusChar=av};BX.PhoneNumberParser=function(){};BX.PhoneNumberParser.getInstance=function(){if(!(ac instanceof BX.PhoneNumberParser)){ac=new BX.PhoneNumberParser()}return ac};BX.PhoneNumberParser.prototype.parse=function(ax,ay){var aw=this;var av=new BX.Promise();if(!ay){ay=BX.PhoneNumber.getDefaultCountry()}if(j){av.fulfill(aw._realParse(ax,ay))}else{ad().then(function(){av.fulfill(aw._realParse(ax,ay))})}return av};BX.PhoneNumberParser.prototype._realParse=function(aw,ax){var aC=new BX.PhoneNumber();aC.setRawNumber(aw);var az=C(aw);if(!D(az)){return aC}var aG=al(az);var ay=aG.extension;var aO=aG.extensionSeparator;az=aG.phoneNumber;var aM=c(az);if(aM===false){return aC}var aI;var av=aM.countryCode;var aK=aM.localNumber;var aN;var aH;var aA=false;if(av){aN=true;aA=true;aH=s(av);aI=null}else{if(!ax){return aC}else{aI=ax;aH=m(aI);if(!aH){return aC}av=aH.countryCode;var aJ=B(aK,aH);aN=(aJ!==aK);aK=aJ}}if(!aH){return aC}var aE=M(aK,aH);var aD=false;var aB="";if(aE!==aK){aD=Y(aE,aH);if(aD){aB=aK.substr(0,aK.length-aE.length);aK=aE}}if(aI===null){aI=i(av,aK);if(!aI){return aC}aH=m(aI)}if(aK.length>x){return aC}var aL=new RegExp("^(?:"+aH.generalDesc["nationalNumberPattern"]+")$");if(!aK.match(aL)){return aC}var aF=g(aK,aI);aC.setCountry(aI);aC.setCountryCode(av);aC.setNationalNumber(aK);aC.setNumberType(aF);aC.setInternational(aN);aC.setHasPlus(aA);aC.setNationalPrefix(aB);aC.setExtension(ay);aC.setExtensionSeparator(aO);aC.setValid(aF!==false);return aC};BX.PhoneNumberFormatter={};BX.PhoneNumberFormatter.format=function(az,aA){if(!(az instanceof BX.PhoneNumber)){throw new Error("number should be instance of BX.PhoneNumber")}if(!j){throw new Error("Metadata should be loaded prior to calling format")}if(!az.isValid()){return az.getRawNumber()}if(aA===BX.PhoneNumber.Format.E164){var av="+"+az.getCountryCode()+az.getNationalNumber()+(az.hasExtension()?az.getExtensionSeparator()+" "+az.getExtension():"");return av}var ax=m(az.getCountry());var ay=aA===BX.PhoneNumber.Format.INTERNATIONAL;var aB=this.selectFormatForNumber(az.getNationalNumber(),ay,ax);if(aB){var aw=this.formatNationalNumber(az.getNationalNumber(),ay,ax,aB)}else{aw=az.getNationalNumber()}if(az.hasExtension()){aw+=az.getExtensionSeparator()+" "+az.getExtension()}if(aA===BX.PhoneNumber.Format.INTERNATIONAL){return"+"+az.getCountryCode()+" "+aw}else{if(aA===BX.PhoneNumber.Format.NATIONAL){return aw}}return az.getRawNumber()};BX.PhoneNumberFormatter.formatOriginal=function(aw){if(!aw.isValid()){return aw.getRawNumber()}var ax=this.selectOriginalFormatForNumber(aw);if(!ax){return aw.getRawNumber()}var av=this.formatNationalNumberWithOriginalFormat(aw,ax);if(aw.hasExtension()){av+=aw.getExtensionSeparator()+" "+aw.getExtension()}if(aw.isInternational()){return(aw.hasPlus()?"+":"")+aw.getCountryCode()+" "+av}else{return av}};BX.PhoneNumberFormatter.selectFormatForNumber=function(av,aA,ay){var ax=at(ay);for(var az=0;az<ax.length;az++){var aB=ax[az];if(aA&&aB.hasOwnProperty("intlFormat")&&aB.intlFormat==="NA"){continue}if(aB.hasOwnProperty("leadingDigits")&&!J(av,aB.leadingDigits)){continue}var aw=new RegExp("^"+aB.pattern+"$");if(av.match(aw)){return aB}}return false};BX.PhoneNumberFormatter.selectOriginalFormatForNumber=function(ay){var ax=ay.getNationalNumber();var aw=ay.isInternational();var aB=ay.getNationalPrefix()!="";var aD=m(ay.getCountry());var aA=at(aD);for(var az=0;az<aA.length;az++){var aC=aA[az];if(aw){if(aC.hasOwnProperty("intlFormat")&&aC.intlFormat==="NA"){continue}}else{if(aB&&!O(aC,aD)){continue}}if(aC.hasOwnProperty("leadingDigits")&&!J(ax,aC.leadingDigits)){continue}var av=new RegExp("^"+aC.pattern+"$");if(ax.match(av)){return aC}}return false};BX.PhoneNumberFormatter.formatNationalNumber=function(av,ay,aw,aA){var ax=(aA.hasOwnProperty("intlFormat")&&ay)?aA.intlFormat:aA.format;var az=new RegExp(aA.pattern);if(!ay){var aB=l(aA,aw);if(aB!=""){aB=aB.replace("$NP",aw.nationalPrefix).replace("$FG","$1");ax=ax.replace(new RegExp("(\\$\\d)"),aB)}else{ax=aw.nationalPrefix+" "+ax}}return av.replace(az,ax)};BX.PhoneNumberFormatter.formatNationalNumberWithOriginalFormat=function(ax,aB){var av=ax.isInternational();var aC=(aB.hasOwnProperty("intlFormat")&&av)?aB.intlFormat:aB.format;var az=new RegExp(aB.pattern);var aw=ax.getNationalNumber();var aD=m(ax.getCountry());var ay=ax.getNationalPrefix()||"";var aA=ay!=="";if(!av&&aA){var aE=l(aB,aD);if(aE!=""){aE=aE.replace("$NP",ay).replace("$FG","$1");aC=aC.replace(new RegExp("(\\$\\d)"),aE)}else{aC=ay+" "+aC}}return aw.replace(az,aC)};BX.PhoneNumberFormatter.getNationalPrefixFormattingRule=function(aw,ax){var av=l(ax,aw);return av.replace("$NP",aw.nationalPrefix).replace("$FG","$1")};BX.PhoneNumberFormatter.getNationalPrefixOptional=function(av,aw){if(BX.type.isPlainObject(aw)&&aw.hasOwnProperty("nationalPrefixOptionalWhenFormatting")){return aw.nationalPrefixOptionalWhenFormatting}else{if(av.hasOwnProperty("nationalPrefixOptionalWhenFormatting")){return av.nationalPrefixOptionalWhenFormatting}else{return false}}};var t="9";var K=new RegExp(t,"g");var V=15;var am=p(t,V);var ak="x";var d=new RegExp(ak);var U=new RegExp(ak,"g");var o=new RegExp("\\[([^\\[\\]])*\\]","g");var Q=new RegExp("\\d(?=[^,}][^,}])","g");var L=new RegExp("^["+ai+"]*(\\$\\d["+ai+"]*)+$");const F=3;const W="["+R+"]{0,1}["+ai+I+"]*";const n=new RegExp("^"+W+"$","i");BX.PhoneNumber.IncompleteFormatter=function(av){if(!j){throw new Error("Metadata is not loaded yet. Do not construct this class directly, use BX.PhoneNumber.getIncompleteFormatter instead")}this.defaultCountry=av||BX.PhoneNumber.getDefaultCountry();this.rawInput="";this.country="";this.countryCode="";this.countryMetadata=null;this.nationalPrefix="";this.nationalNumber="";this.isInternational=false;this.hasNationalPrefix=false;this.hasPlusChar=false;this.formattedNumber=null;this.extension="";this.extensionSeparator=""};BX.PhoneNumber.IncompleteFormatter.prototype.format=function(aw){this.resetState();var ax=C(aw);if(!ax&&aw[0]===R){this.rawInput=aw;this.formattedNumber=aw;return aw}this.isInternational=ax[0]===R;var av=al(ax);ax=av.phoneNumber;this.extension=av.extension;this.extensionSeparator=av.extensionSeparator;ax=G(ax);this.rawInput=ax;if(this.isInternational){this.hasPlusChar=true;this.rawInput=R+ax}if(this.isInternational){this.extractCountryCode();if(!this.countryCode){return this.rawInput}this.findSuitableCountry()}else{if(!this.defaultCountry){return this.rawInput}else{this.country=this.defaultCountry;this.countryMetadata=m(this.country);if(!this.countryMetadata){return this.rawInput}this.nationalNumber=this.rawInput;this.extractNationalPrefix();if(!this.hasNationalPrefix){this.tryToStripCountryCode()}}}return this.getFormattedNumber()};BX.PhoneNumber.IncompleteFormatter.prototype.getFormattedNumber=function(){var aw=this.formatNationalNumber();var av=aw?aw:this.rawInput;if(this.extensionSeparator){av+=this.extensionSeparator+" "+this.extension}return av};BX.PhoneNumber.IncompleteFormatter.prototype.extractCountryCode=function(){var av=c(this.rawInput);if(av&&av.countryCode){this.countryCode=av.countryCode;this.nationalNumber=av.localNumber}};BX.PhoneNumber.IncompleteFormatter.prototype.tryToStripCountryCode=function(){var av=this.countryMetadata.countryCode;var aw;if(this.nationalNumber.indexOf(av)===0){aw=this.nationalNumber.substr(av.length);if(ar(aw,this.countryMetadata,true,false)){this.isInternational=true;this.countryCode=av;this.nationalNumber=aw}}};BX.PhoneNumber.IncompleteFormatter.prototype.extractNationalPrefix=function(){var av=M(this.nationalNumber,this.countryMetadata);if(av!==this.nationalNumber){if(!ar(av,this.countryMetadata,false,true)){return false}this.hasNationalPrefix=true;this.nationalPrefix=this.nationalNumber.substr(0,this.nationalNumber.length-av.length);this.nationalNumber=av;return true}return false};BX.PhoneNumber.IncompleteFormatter.prototype.resetState=function(){this.country=null;this.countryCode="";this.nationalPrefix="";this.nationalNumber=null;this.isInternational=false;this.hasNationalPrefix=false;this.hasPlusChar=false;this.selectedFormat=null;this.formattedNumber=null;this.formattingTemplate=null;this.extension="";this.extensionSeparator=""};BX.PhoneNumber.IncompleteFormatter.prototype.findSuitableCountry=function(){var av=i(this.countryCode,this.nationalNumber);if(av){this.country=av}else{this.country=X(this.countryCode)}this.countryMetadata=m(this.country)};BX.PhoneNumber.IncompleteFormatter.prototype.formatNationalNumber=function(){if(this.isCompleteNumber()){return this.formatCompleteNumber(this.nationalNumber)}if(!this.isInternational&&this.countryCode===""&&this.nationalPrefix===""&&y.isApplicable(this.rawInput)){return y.format(this.rawInput)}if(this.selectFormat()){this.formattedNumber=this.formatUsingTemplate();if(this.isInternational){return(this.hasPlusChar?R:"")+this.countryCode+" "+this.formattedNumber}else{return this.formattedNumber}}};BX.PhoneNumber.IncompleteFormatter.prototype.isCompleteNumber=function(){return g(this.nationalNumber,this.country)?true:false};BX.PhoneNumber.IncompleteFormatter.prototype.selectFormat=function(){var av=at(this.countryMetadata);for(var aw=0;aw<av.length;aw++){var ax=av[aw];if(!this.isFormatSuitable(ax)){continue}if(ax.hasOwnProperty("leadingDigits")&&!J(this.nationalNumber,ax.leadingDigits)){continue}if(!this.createFormattingTemplate(ax)){continue}this.selectedFormat=ax;return true}return false};BX.PhoneNumber.IncompleteFormatter.prototype.createFormattingTemplate=function(ax){var aw=ax.pattern;if(aw.indexOf("|")!==-1){return false}this.formattingTemplate="";var av=this.getFormattingTemplate(aw,ax);if(av){this.formattingTemplate=av;return true}return false};BX.PhoneNumber.IncompleteFormatter.prototype.getFormattingTemplate=function(ay,az){var av=S(az,this.isInternational);var ax=ay.replace(o,"\\d");ax=ax.replace(Q,"\\d");var aA=am.match(new RegExp(ax))[0];if(this.nationalNumber.length>aA.length){return false}if(this.hasNationalPrefix){var aB=l(az,this.countryMetadata);if(aB){aB=aB.replace("$NP",this.nationalPrefix).replace("$FG","$1");av=av.replace(new RegExp("(\\$\\d)"),aB)}else{av=this.nationalPrefix+" "+av}}var aw=aA.replace(new RegExp(ax,"g"),av);aw=aw.replace(K,ak);return aw};BX.PhoneNumber.IncompleteFormatter.prototype.formatUsingTemplate=function(){if(!this.formattingTemplate){return false}var av=this.formattingTemplate;var ax;for(var aw=0;aw<this.nationalNumber.length;aw++){ax=av.search(d);if(ax===-1){return false}av=av.replace(d,this.nationalNumber[aw])}av=this.closeLastBracket(av,ax+1);return av};BX.PhoneNumber.IncompleteFormatter.prototype.closeLastBracket=function(az,ay){var ax=az.substr(ay);var av=ax.indexOf("(");var aw=ax.indexOf(")");if(aw!==-1&&(av===-1||av>aw)){ay=ay+aw+1}return az.substr(0,ay).replace(U," ")};BX.PhoneNumber.IncompleteFormatter.prototype.formatCompleteNumber=function(){var av=new BX.PhoneNumber();av.setRawNumber(this.rawInput);av.setHasPlus(this.hasPlusChar);av.setInternational(this.isInternational);av.setNationalPrefix(this.nationalPrefix);av.setNationalNumber(this.nationalNumber);av.setCountry(this.country);av.setCountryCode(this.countryCode);var aw=BX.PhoneNumberFormatter.selectOriginalFormatForNumber(av);if(!aw){return false}var ax=BX.PhoneNumberFormatter.formatNationalNumberWithOriginalFormat(av,aw);if(this.isInternational){ax=(this.hasPlusChar?R:"")+this.countryCode+" "+ax}this.selectedFormat=aw;return ax};BX.PhoneNumber.IncompleteFormatter.prototype.isFormatSuitable=function(av){if(this.isInternational){return Z(av)?true:false}else{return !this.hasNationalPrefix||O(av,this.countryMetadata)}};BX.PhoneNumber.IncompleteFormatter.prototype.replaceCountry=function(av){this.isInternational=true;this.hasPlusChar=true;this.country=av;this.countryMetadata=m(this.country);this.countryCode=this.countryMetadata.countryCode;this.rawInput="+"+this.countryCode+this.nationalNumber;this.nationalPrefix=""};BX.PhoneNumber.Input=function(av){if(!BX.type.isDomNode(av.node)||av.node.nodeName!=="INPUT"||av.node.type!=="text"){throw new Error("params.node should be text input node")}this.inputNode=av.node;this.defaultCountry=av.defaultCountry||BX.PhoneNumber.getDefaultCountry();this.userDefaultCountry=BX.PhoneNumber.getUserDefaultCountry();this.forceLeadingPlus=av.forceLeadingPlus===true;this.flagNode=BX.type.isDomNode(av.flagNode)?av.flagNode:null;this.flagSize=([16,24,32].indexOf(av.flagSize)!==-1)?av.flagSize:16;this.flagNodeInitialClass="";this.countries=null;this.callbacks={initialize:BX.type.isFunction(av.onInitialize)?av.onInitialize:BX.DoNothing,change:BX.type.isFunction(av.onChange)?av.onChange:BX.DoNothing,countryChange:BX.type.isFunction(av.onCountryChange)?av.onCountryChange:BX.DoNothing};this.formatter=null;this.countrySelectPopup=null;this._lastCaretPosition=null;this._digitsToTheLeft=0;this._digitsToTheRight=0;this._digitsCount=0;this._selectedDigitsBeforeAction=0;this._countryBefore="";this.init();this.bindEvents()};BX.PhoneNumber.Input.prototype.init=function(){var av=this;if(this.flagNode){this.flagNodeInitialClass=this.flagNode.className;BX.adjust(this.flagNode,{style:{cursor:"pointer",display:"inline-block"}})}BX.PhoneNumber.getIncompleteFormatter(this.defaultCountry).then(function(aw){av.formatter=aw;if(av.inputNode.value){av.inputNode.value=av.formatter.format(av.inputNode.value)}else{if(av.userDefaultCountry!=""&&av.userDefaultCountry!==av.defaultCountry){av.formatter.replaceCountry(av.userDefaultCountry);av.inputNode.value=av.formatter.getFormattedNumber()}}av.drawCountryFlag();av.callbacks.initialize()})};BX.PhoneNumber.Input.prototype.bindEvents=function(){this.inputNode.addEventListener("keydown",this._onKeyDown.bind(this));this.inputNode.addEventListener("input",this._onInput.bind(this));if(this.flagNode){this.flagNode.addEventListener("click",this._onFlagClick.bind(this))}};BX.PhoneNumber.Input.prototype.getValue=function(){return aj(this.inputNode.value)};BX.PhoneNumber.Input.prototype.getFormattedValue=function(){return this.inputNode.value};BX.PhoneNumber.Input.prototype.getCountry=function(){return this.formatter.country||this.formatter.defaultCountry};BX.PhoneNumber.Input.prototype.getCountryCode=function(){var av=m(this.getCountry());return(av?av.countryCode:false)};BX.PhoneNumber.Input.prototype.drawCountryFlag=function(){if(!this.flagNode){return}var av=this.getCountry();if(!BX.type.isNotEmptyString(av)){return}av=av.toLowerCase();BX.adjust(this.flagNode,{props:{className:this.flagNodeInitialClass+" bx-flag-"+this.flagSize+" "+av}})};BX.PhoneNumber.Input.prototype._onKeyDown=function(ay){if(!ay.key){return}var aw=this.inputNode.selectionEnd-this.inputNode.selectionStart;if(ay.key===R){if(this.inputNode.selectionStart!==0){ay.preventDefault();ay.stopPropagation();return}}else{if(ay.key.length===1&&ay.key.search(/[\d,;#]/)!==0&&!ay.ctrlKey&&!ay.metaKey){ay.preventDefault();ay.stopPropagation();return}}var az=af(this.inputNode.value);this._lastCaretPosition=this.inputNode.selectionStart;this._digitsToTheLeft=k(ag,this.inputNode.value.substr(0,this._lastCaretPosition));this._digitsToTheRight=k(ag,this.inputNode.value.substr(this._lastCaretPosition));this._digitsCount=k(ag,this.inputNode.value);this._countryBefore=this.getCountry();if(aw>0){var ax=this.inputNode.value.substr(this.inputNode.selectionStart,aw);this._selectedDigitsBeforeAction=k(ag,ax)}else{this._selectedDigitsBeforeAction=0}var av=null;if(ay.key==="Backspace"&&aw===0){av=az[this._digitsToTheLeft-1]+1}if(ay.key==="Delete"&&aw===0&&this._digitsToTheRight>0){av=az[this._digitsToTheLeft]}if(av!==null){this.inputNode.setSelectionRange(av,av)}};BX.PhoneNumber.Input.prototype._onInput=function(az){var aB=null;if(this.formatter){var ax=this.formatter.format(this.inputNode.value);var aw=af(ax);var av=this._digitsCount;var aD=this._selectedDigitsBeforeAction;var aA=k(ag,ax);var ay=aA-av;var aC=ay+aD;if(this._lastCaretPosition!==null){switch(az.inputType){case"deleteContentBackward":if(ay==-1){aB=aw[this._digitsToTheLeft+ay-1]+1}else{aB=aw[this._digitsToTheLeft]}break;case"deleteContentForward":if(this._digitsToTheLeft===0){aB=aw[0]}else{aB=aw[this._digitsToTheLeft-1]+1}break;case"insertText":case"insertFromPaste":aB=aw[this._digitsToTheLeft-1+aC]+1;break}}this.inputNode.value=ax;if(aB!==null){this.inputNode.setSelectionRange(aB,aB)}this.callbacks.change({value:this.getValue(),formattedValue:this.getFormattedValue(),country:this.getCountry(),countryCode:this.getCountryCode()});if(this._countryBefore!==this.getCountry()){this.drawCountryFlag();this.callbacks.countryChange({country:this.getCountry(),countryCode:this.getCountryCode()})}}this._lastCaretPosition=null};BX.PhoneNumber.Input.prototype._onFlagClick=function(av){this.selectCountry({node:this.flagNode,onSelect:this._onCountrySelect.bind(this)})};BX.PhoneNumber.Input.prototype._onCountrySelect=function(av){var aw=av.country;if(aw===this.getCountry()){return false}this.formatter.replaceCountry(aw);this.inputNode.value=this.formatter.getFormattedNumber();this.drawCountryFlag();this.callbacks.change({value:this.getValue(),formattedValue:this.getFormattedValue(),country:this.getCountry(),countryCode:this.getCountryCode()});this.callbacks.countryChange({country:this.getCountry(),countryCode:this.getCountryCode()});BX.userOptions.save("main","phone_number","default_country",aw)};BX.PhoneNumber.Input.prototype.loadCountries=function(){var av=new BX.Promise();if(this.countries){av.fulfill();return av}var ax={sessid:BX.bitrix_sessid(),ACTION:"getCountries"};var aw=this;BX.ajax({url:w,method:"POST",dataType:"json",data:ax,onsuccess:function(ay){if(BX.type.isArray(ay)){aw.countries=ay;aw.countries.sort(function(aA,az){return aA.NAME.localeCompare(az.NAME)});av.fulfill()}}});return av};BX.PhoneNumber.Input.prototype.selectCountry=function(ay){var ax=BX.type.isFunction(ay.onSelect)?ay.onSelect:BX.DoNothing;var av=BX.create("span",{});var aw=this;this.loadCountries().then(function(){aw.countries.forEach(function(aA){var aB=aA.CODE;var az=aq(aB);if(!az){return}av.appendChild(BX.create("div",{props:{className:"main-phonenumber-country"},events:{click:function(){aw.countrySelectPopup.close();ax({country:aA.CODE})}},children:[BX.create("span",{props:{className:"main-phonenumber-country-flag bx-flag-16 "+aB.toLowerCase()}}),BX.create("span",{props:{className:"main-phonenumber-country-name"},text:aA.NAME+" (+"+az+")"})]}))});aw.countrySelectPopup=new BX.PopupWindow("phoneNumberInputSelectCountry",ay.node,{autoHide:true,zIndex:100,closeByEsc:true,bindOptions:{position:"top"},height:180,offsetRight:35,angle:{offset:33},overlay:{backgroundColor:"white",opacity:0},content:av,events:{onPopupClose:function(){aw.countrySelectPopup.destroy()},onPopupDestroy:function(){aw.countrySelectPopup=null}}});aw.countrySelectPopup.show()})};var y={templates:{3:"x-xx",4:"xx-xx",5:"x-xx-xx",6:"xx-xx-xx",7:"xxx-xx-xx"},format:function(ay){var aw=this.templates[ay.length];if(!aw){return ay}var av=0;var ax=new RegExp(aw.replace(/[^x]/g,"").replace(/x/g,"(\\d)"));var az=aw.replace(/x/g,function(){return"$"+ ++av});return ay.replace(ax,az)},isApplicable:function(av){return/^\d{3,7}$/.test(av)}};var C=function(ax){if(!ax||ax.length>H){return""}var aw=ax.search(new RegExp(h));if(aw<0){return""}var av=ax.substr(aw);av=av.replace(new RegExp(v),"");return av};var c=function(aw){aw=aj(aw);if(!aw){return false}if(aw[0]!==R){return{countryCode:"",localNumber:aw}}aw=aw.substr(1);if(aw[0]==="0"){return false}for(var ax=ae;ax>0;ax--){var av=aw.substr(0,ax);if(e(av)){return{countryCode:av,localNumber:aw.substr(ax)}}}return false};var D=function(av){return av.length>=T&&(av.search(new RegExp(aa))!==-1)};var al=function(av){var ay="";var aw="";var ax=av.search(new RegExp("["+N+"]"));if(ax>=0){aw=av[ax];ay=av.substr(ax);av=av.substr(0,ax)}return{extensionSeparator:aw,extension:an(ay,ah+I),phoneNumber:av}};var s=function(aw){if(!e(aw)){return false}var av=A(aw);return m(av[0])};var i=function(aw,aA){if(!aw||!aA){return false}var av=A(aw);var az;var ax;if(av.length===1){return av[0]}for(var ay=0;ay<av.length;ay++){az=av[ay];ax=m(az);if(ax.hasOwnProperty("leadingDigits")){if(aA.match(new RegExp(ax.leadingDigits))){return az}}else{if(g(aA,az)){return az}}}return false};var g=function(az,aA){var ax=m(aA);var aw;if(!ax){return false}if(!BX.type.isNotEmptyString(az)){return false}if((ax.generalDesc&&ax.generalDesc["nationalNumberPattern"])){if(!az.match(new RegExp("^(?:"+ax.generalDesc["nationalNumberPattern"]+")$"))){return false}}var av=["noInternationalDialling","areaCodeOptional","fixedLine","mobile","pager","tollFree","premiumRate","sharedCost","personalNumber","voip","uan","voicemail"];for(var ay=0;ay<av.length;ay++){aw=av[ay];if((ax[aw]&&ax[aw]["nationalNumberPattern"])){if(az.match(new RegExp("^"+ax[aw]["nationalNumberPattern"]+"$"))){return aw}}}return false};var M=function(ay,ax){var av=ax.hasOwnProperty("nationalPrefixForParsing")?ax.nationalPrefixForParsing:ax.nationalPrefix;if(ay==""||av==""){return ay}var aw="^(?:"+av+")";var aA=ay.match(new RegExp(aw));if(!aA){return ay}var aB=ax.nationalPrefixTransformRule;var az;if(aB&&aA.length>1){az=ay.replace(aw,aB)}else{az=ay.substr(aA[0].length)}return az};var Y=function(ax,aw){var av=new RegExp("^(?:"+aw.generalDesc["nationalNumberPattern"]+")$");if(ax.match(av,ax)){return true}else{return false}};var ar=function(aw,av,az,ay){if(!av.availableFormats){return true}for(var ax=0;ax<av.availableFormats.length;ax++){var aA=av.availableFormats[ax];if(az&&aA.intlFormat==="NA"){continue}if(ay){var aB=l(aA,av);if(aB&&aB.search(/\$NP/)===-1){continue}}if(aA.leadingDigits&&!J(aw,aA.leadingDigits)){continue}return true}return false};var B=function(ay,ax){var aw=ax.countryCode;if(ay.search(aw)!==0){return ay}var az=ay.substr(aw.length);var av=new RegExp("^(?:"+ax.generalDesc["nationalNumberPattern"]+")$");if(ay.match(av)&&!az.match(av)){return ay}return az};var e=function(av){av=av.toString();return P.hasOwnProperty(av)};var A=function(av){av=av.toString();return P.hasOwnProperty(av)?P[av]:[]};var X=function(av){av=av.toString();return P.hasOwnProperty(av)?P[av][0]:false};var m=function(av){av=av.toUpperCase();return ap.hasOwnProperty(av)?ap[av]:false};var aq=function(av){av=av.toUpperCase();return ap.hasOwnProperty(av)?ap[av]["countryCode"]:false};var Z=function(av){if(av.hasOwnProperty("intlFormat")){if(av.intlFormat==="NA"){return false}else{return av.intlFormat}}return av.format};var at=function(aw){if(BX.type.isArray(aw.availableFormats)){return aw.availableFormats}var av=aw.countryCode;var ay=A(av);var ax=ay[0];var az=m(ax);return BX.type.isArray(az.availableFormats)?az.availableFormats:[]};var l=function(az,aw){if(az.hasOwnProperty("nationalPrefixFormattingRule")){return az.nationalPrefixFormattingRule}else{var av=aw.countryCode;var ay=A(av);var ax=ay[0];var aA=m(ax);return aA.nationalPrefixFormattingRule||""}};var E=function(aw,av){if(aw.hasOwnProperty("nationalPrefixOptionalWhenFormatting")){return aw.nationalPrefixOptionalWhenFormatting}else{if(av.hasOwnProperty("nationalPrefixOptionalWhenFormatting")){return av.nationalPrefixOptionalWhenFormatting}else{return false}}};var O=function(aw,av){var ax=l(aw,av);return(!ax||ax.search(/\$NP/)!==-1)};var J=function(aw,av){var ay;var az;if(BX.type.isArray(av)){for(var ax=0;ax<av.length;ax++){ay=new RegExp("^"+av[ax]);az=aw.match(ay);if(az){return az}}}else{ay=new RegExp("^"+av);az=aw.match(ay);if(az){return az}}return false};var S=function(aw,av){if(av&&aw.hasOwnProperty("intlFormat")){return aw.intlFormat}else{return aw.format}};var G=function(av){return an(av,I)};var aj=function(av){return an(av,ag)};var an=function(aw,av){return aw.replace(new RegExp("[^"+av+"]","g"),"")};var k=function(ax,aw){var av=aw.match(ax instanceof RegExp?ax:new RegExp("["+ax+"]","g"));return av?av.length:0};var af=function(ay){var ax=new RegExp("["+ag+"]","g");var av=[];var aw;while((aw=ax.exec(ay))!==null){av.push(aw.index)}return av};function p(ay,ax){var av="";if(ax<=0){return""}for(var aw=0;aw<ax;aw++){av+=ay}return av}})();