(function(a){if(BX.PopupWindowManager){return}BX.PopupWindowManager={_popups:[],_currentPopup:null,create:function(h,e,i){var f=-1;if((f=this._getPopupIndex(h))!==-1){return this._popups[f]}var g=new BX.PopupWindow(h,e,i);BX.addCustomEvent(g,"onPopupShow",BX.delegate(this.onPopupShow,this));BX.addCustomEvent(g,"onPopupClose",BX.delegate(this.onPopupClose,this));return g},onPopupWindowIsInitialized:function(f,e){BX.addCustomEvent(e,"onPopupDestroy",BX.delegate(this.onPopupDestroy,this));this._popups.push(e)},onPopupShow:function(e){if(this._currentPopup!==null){this._currentPopup.close()}this._currentPopup=e},onPopupClose:function(e){this._currentPopup=null},onPopupDestroy:function(f){var e;if((e=this._getPopupIndex(f.uniquePopupId))!==-1){this._popups=BX.util.deleteFromArray(this._popups,e)}},getCurrentPopup:function(){return this._currentPopup},isPopupExists:function(e){return this._getPopupIndex(e)!==-1},_getPopupIndex:function(g){var e=-1;for(var f=0;f<this._popups.length;f++){if(this._popups[f].uniquePopupId===g){return f}}return e},getMaxZIndex:function(){var f=0,e;for(e=0;e<this._popups.length;e++){f=Math.max(f,this._popups[e].params.zIndex)}return f}};BX.addCustomEvent("onPopupWindowIsInitialized",BX.proxy(BX.PopupWindowManager.onPopupWindowIsInitialized,BX.PopupWindowManager));BX.PopupWindow=function(i,h,j){j=j||{};this.params=j;BX.onCustomEvent("onPopupWindowInit",[i,h,j]);this.uniquePopupId=i;this.params.zIndex=parseInt(j.zIndex);this.params.zIndex=isNaN(j.zIndex)?0:j.zIndex;this.buttons=j.buttons&&BX.type.isArray(j.buttons)?j.buttons:[];this.offsetTop=BX.PopupWindow.getOption("offsetTop");this.offsetLeft=BX.PopupWindow.getOption("offsetLeft");this.firstShow=false;this.bordersWidth=20;this.bindElementPos=null;this.closeIcon=null;this.resizeIcon=null;this.angle=null;this.overlay=null;this.titleBar=null;this.bindOptions=typeof(j.bindOptions)==="object"?j.bindOptions:{};this.autoHide=j.autoHide===true;this.isAutoHideBinded=false;this.closeByEsc=j.closeByEsc===true;this.isCloseByEscBinded=false;this.width=null;this.height=null;this.minWidth=0;this.minHeight=0;if(j.parentPopup instanceof BX.PopupWindow){this.parentPopup=j.parentPopup;this.appendContainer=j.parentPopup.contentContainer;j.offsetTop=(j.offsetTop?j.offsetTop:0)-(BX.PopupWindow.fullscreenStatus?0:this.parentPopup.popupContainer.offsetTop);j.offsetLeft=(j.offsetLeft?j.offsetLeft:0)-(BX.PopupWindow.fullscreenStatus?0:this.parentPopup.popupContainer.offsetLeft)}else{this.parentPopup=null;this.appendContainer=document.body}this.dragOptions={cursor:"",callback:BX.DoNothing,eventName:""};this.dragged=false;this.dragPageX=0;this.dragPageY=0;if(j.events){for(var g in j.events){BX.addCustomEvent(this,g,j.events[g])}}var f="popup-window";if(j.contentColor&&BX.type.isNotEmptyString(j.contentColor)){f+=" popup-window-content-"+j.contentColor}if(j.contentNoPaddings){f+=" popup-window-content-no-paddings"}if(j.noAllPaddings){f+=" popup-window-no-paddings"}if(j.titleBar){f+=" popup-window-with-titlebar"}if(j.className&&BX.type.isNotEmptyString(j.className)){f+=" "+j.className}if(j.darkMode){f+=" popup-window-dark"}this.popupContainer=document.createElement("div");var e="popup-window-titlebar-"+i;if(j.titleBar){this.titleBar=BX.create("div",{props:{className:"popup-window-titlebar",id:e}})}if(j.closeIcon){this.closeIcon=BX.create("span",{props:{className:"popup-window-close-icon"+(j.titleBar?" popup-window-titlebar-close-icon":"")},style:(typeof(j.closeIcon)==="object"?j.closeIcon:{}),events:{click:BX.proxy(this._onCloseIconClick,this)}});if(BX.browser.IsIE()){BX.adjust(this.closeIcon,{attrs:{hidefocus:"true"}})}}this.contentContainer=BX.create("div",{props:{id:"popup-window-content-"+i,className:"popup-window-content"}});BX.adjust(this.popupContainer,{props:{id:i,className:f},style:{zIndex:this.getZindex(),position:"absolute",display:"none",top:"0px",left:"0px"},children:[this.titleBar,this.contentContainer,this.closeIcon]});this.appendContainer.appendChild(this.popupContainer);this.buttonsContainer=null;if(j.angle){this.setAngle(j.angle)}if(j.overlay){this.setOverlay(j.overlay)}this.setOffset(j);this.setBindElement(h);this.setTitleBar(j.titleBar);this.setContent(j.content);this.setButtons(j.buttons);this.setWidth(j.width);this.setHeight(j.height);this.setResizeMode(j.resizable);if(j.bindOnResize!==false){BX.bind(a,"resize",BX.proxy(this._onResizeWindow,this))}BX.onCustomEvent("onPopupWindowIsInitialized",[i,this])};BX.PopupWindow.prototype.setContent=function(e){if(!this.contentContainer||!e){return}if(BX.type.isElementNode(e)){BX.cleanNode(this.contentContainer);this.contentContainer.appendChild(e.parentNode?e.parentNode.removeChild(e):e);e.style.display="block"}else{if(BX.type.isString(e)){this.contentContainer.innerHTML=e}else{this.contentContainer.innerHTML="&nbsp;"}}};BX.PopupWindow.prototype.setButtons=function(h){this.buttons=h&&BX.type.isArray(h)?h:[];if(this.buttonsContainer){BX.remove(this.buttonsContainer)}if(this.buttons.length>0&&this.contentContainer){var e=[];for(var g=0;g<this.buttons.length;g++){var f=this.buttons[g];if(f===null||!BX.is_subclass_of(f,BX.PopupWindowButton)){continue}f.popupWindow=this;e.push(f.render())}this.buttonsContainer=this.contentContainer.parentNode.appendChild(BX.create("div",{props:{className:"popup-window-buttons"},children:e}))}};BX.PopupWindow.prototype.getButtons=function(){return this.buttons};BX.PopupWindow.prototype.getButton=function(g){for(var f=0;f<this.buttons.length;f++){var e=this.buttons[f];if(e.getId()===g){return e}}return null};BX.PopupWindow.prototype.setBindElement=function(e){if(!e||typeof(e)!=="object"){return}if(BX.type.isDomNode(e)||(BX.type.isNumber(e.top)&&BX.type.isNumber(e.left))){this.bindElement=e}else{if(BX.type.isNumber(e.clientX)&&BX.type.isNumber(e.clientY)){BX.fixEventPageXY(e);this.bindElement={left:e.pageX,top:e.pageY,bottom:e.pageY}}}};BX.PopupWindow.prototype.getBindElementPos=function(e){if(BX.type.isDomNode(e)){return BX.pos(e,false)}else{if(e&&typeof(e)==="object"){if(!BX.type.isNumber(e.bottom)){e.bottom=e.top}return e}else{var f=BX.GetWindowInnerSize();var i=BX.GetWindowScrollPos();var g=this.popupContainer.offsetWidth;var h=this.popupContainer.offsetHeight;this.bindOptions.forceTop=true;return{left:f.innerWidth/2-g/2+i.scrollLeft,top:f.innerHeight/2-h/2+i.scrollTop,bottom:f.innerHeight/2-h/2+i.scrollTop,windowSize:f,windowScroll:i,popupWidth:g,popupHeight:h}}}};BX.PopupWindow.prototype.setAngle=function(f){if(f===false&&this.angle!==null){BX.remove(this.angle.element);this.angle=null;return}var k="popup-window-angly";if(this.angle===null){var h=this.bindOptions.position&&this.bindOptions.position==="top"?"bottom":"top";var m=BX.PopupWindow.getOption(h==="top"?"angleMinTop":"angleMinBottom");var i=BX.type.isNumber(f.offset)?f.offset:0;var l=BX.PopupWindow.getOption("angleLeftOffset",null);if(i>0&&BX.type.isNumber(l)){i+=l-BX.PopupWindow.defaultOptions.angleLeftOffset}this.angle={element:BX.create("div",{props:{className:k+" "+k+"-"+h}}),position:h,offset:0,defaultOffset:Math.max(i,m)};this.popupContainer.appendChild(this.angle.element)}if(typeof(f)==="object"&&f.position&&BX.util.in_array(f.position,["top","right","bottom","left","hide"])){BX.removeClass(this.angle.element,k+"-"+this.angle.position);BX.addClass(this.angle.element,k+"-"+f.position);this.angle.position=f.position}if(typeof(f)==="object"&&BX.type.isNumber(f.offset)){var g=f.offset;var j,e;if(this.angle.position==="top"){j=BX.PopupWindow.getOption("angleMinTop");e=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxTop");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.left=this.angle.offset+"px";this.angle.element.style.marginLeft=0}else{if(this.angle.position==="bottom"){j=BX.PopupWindow.getOption("angleMinBottom");e=this.popupContainer.offsetWidth-BX.PopupWindow.getOption("angleMaxBottom");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.marginLeft=this.angle.offset+"px";this.angle.element.style.left=0}else{if(this.angle.position==="right"){j=BX.PopupWindow.getOption("angleMinRight");e=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxRight");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.top=this.angle.offset+"px"}else{if(this.angle.position==="left"){j=BX.PopupWindow.getOption("angleMinLeft");e=this.popupContainer.offsetHeight-BX.PopupWindow.getOption("angleMaxLeft");e=e<j?Math.max(j,g):e;this.angle.offset=Math.min(Math.max(j,g),e);this.angle.element.style.top=this.angle.offset+"px"}}}}}};BX.PopupWindow.prototype.setWidth=function(e){if(BX.type.isNumber(e)&&e>=0){this.width=e;this.contentContainer.style.width=e+"px";this.contentContainer.style.overflowX="auto";if(this.titleBar){this.titleBar.style.width=e+"px"}}else{if(e===false){this.width=null;this.contentContainer.style.removeProperty("width");this.contentContainer.style.removeProperty("overflowX");if(this.titleBar){this.titleBar.style.removeProperty("width")}}}};BX.PopupWindow.prototype.setHeight=function(e){if(BX.type.isNumber(e)&&e>=0){this.height=e;this.contentContainer.style.height=e+"px";this.contentContainer.style.overflowY="auto"}else{if(e===false){this.height=null;this.contentContainer.style.removeProperty("height");this.contentContainer.style.removeProperty("overflowY")}}};BX.PopupWindow.prototype.setResizeMode=function(e){if(e===true||BX.type.isPlainObject(e)){if(!this.resizeIcon){this.resizeIcon=BX.create("div",{props:{className:"popup-window-resize"},events:{mousedown:BX.proxy(this.onResizeMouseDown,this)}});this.popupContainer.appendChild(this.resizeIcon)}if(BX.type.isNumber(e.minWidth)&&e.minWidth>0){this.minWidth=e.minWidth}if(BX.type.isNumber(e.minHeight)&&e.minHeight>0){this.minHeight=e.minHeight}}else{if(e===false&&this.resizeIcon){BX.remove(this.resizeIcon);this.resizeIcon=null}}};BX.PopupWindow.prototype.getWidth=function(){return this.width};BX.PopupWindow.prototype.getHeight=function(){return this.height};BX.PopupWindow.prototype.onTitleMouseDown=function(e){this._startDrag(e,{cursor:"move",callback:BX.proxy(this.move,this),eventName:"Drag"})};BX.PopupWindow.prototype.onResizeMouseDown=function(e){this._startDrag(e,{cursor:"nwse-resize",eventName:"Resize",callback:BX.proxy(this._resize,this)});this.resizeContentPos=BX.pos(this.contentContainer);this.resizeContentOffset=this.resizeContentPos.left-BX.pos(this.popupContainer).left};BX.PopupWindow.prototype._resize=function(f,k,j,h){var i=j-this.resizeContentPos.left;var e=h-this.resizeContentPos.top;var g=BX.GetWindowScrollSize().scrollWidth;if(this.resizeContentPos.left+i+this.resizeContentOffset>=g){i=g-this.resizeContentPos.left-this.resizeContentOffset}this.setWidth(Math.max(i,this.minWidth));this.setHeight(Math.max(e,this.minHeight))};BX.PopupWindow.prototype.isTopAngle=function(){return this.angle!==null&&this.angle.position==="top"};BX.PopupWindow.prototype.isBottomAngle=function(){return this.angle!==null&&this.angle.position==="bottom"};BX.PopupWindow.prototype.isTopOrBottomAngle=function(){return this.angle!==null&&BX.util.in_array(this.angle.position,["top","bottom"])};BX.PopupWindow.prototype.getAngleHeight=function(){return(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleTopOffset"):0)};BX.PopupWindow.prototype.setOffset=function(e){if(!BX.type.isPlainObject(e)){return}if(e.offsetLeft&&BX.type.isNumber(e.offsetLeft)){this.offsetLeft=e.offsetLeft+BX.PopupWindow.getOption("offsetLeft")}if(e.offsetTop&&BX.type.isNumber(e.offsetTop)){this.offsetTop=e.offsetTop+BX.PopupWindow.getOption("offsetTop")}};BX.PopupWindow.prototype.setTitleBar=function(e){if(!this.titleBar){return}if(typeof(e)==="object"&&BX.type.isDomNode(e.content)){this.titleBar.innerHTML="";this.titleBar.appendChild(e.content)}else{if(typeof(e)==="string"){this.titleBar.innerHTML="";this.titleBar.appendChild(BX.create("span",{props:{className:"popup-window-titlebar-text"},text:e}))}}if(this.params.draggable){this.titleBar.style.cursor="move";BX.bind(this.titleBar,"mousedown",BX.proxy(this.onTitleMouseDown,this))}};BX.PopupWindow.prototype.setClosingByEsc=function(e){e=BX.type.isBoolean(e)?e:true;if(e){this.closeByEsc=true;if(!this.isCloseByEscBinded){BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=true}}else{this.closeByEsc=false;if(this.isCloseByEscBinded){BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=false}}};BX.PopupWindow.prototype.setAutoHide=function(e){e=BX.type.isBoolean(e)?e:true;if(e){this.autoHide=true;if(this.isShown()){this.bindAutoHide()}}else{this.autoHide=false;this.unbindAutoHide()}};BX.PopupWindow.prototype.bindAutoHide=function(){if(!this.isAutoHideBinded){this.isAutoHideBinded=true;BX.bind(this.popupContainer,"click",this.cancelBubble);if(this.overlay&&this.overlay.element){BX.bind(this.overlay.element,"click",BX.proxy(this.close,this))}else{BX.bind(document,"click",BX.proxy(this.close,this))}}};BX.PopupWindow.prototype.unbindAutoHide=function(){if(this.isAutoHideBinded){this.isAutoHideBinded=false;BX.unbind(this.popupContainer,"click",this.cancelBubble);if(this.overlay&&this.overlay.element){BX.unbind(this.overlay.element,"click",BX.proxy(this.close,this))}else{BX.unbind(document,"click",BX.proxy(this.close,this))}}};BX.PopupWindow.prototype.setOverlay=function(e){if(this.overlay===null){this.overlay={element:BX.create("div",{props:{className:"popup-window-overlay",id:"popup-window-overlay-"+this.uniquePopupId}})};this.adjustOverlayZindex();this.resizeOverlay();this.appendContainer.appendChild(this.overlay.element)}if(e&&e.hasOwnProperty("opacity")&&BX.type.isNumber(e.opacity)&&e.opacity>=0&&e.opacity<=100){if(BX.browser.IsIE()&&!BX.browser.IsIE9()){this.overlay.element.style.filter="alpha(opacity="+e.opacity+")"}else{this.overlay.element.style.filter="none";this.overlay.element.style.opacity=parseFloat(e.opacity/100).toPrecision(3)}}if(e&&e.backgroundColor){this.overlay.element.style.backgroundColor=e.backgroundColor}};BX.PopupWindow.prototype.removeOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){BX.remove(this.overlay.element)}if(this.overlayTimeout){clearInterval(this.overlayTimeout);this.overlayTimeout=null}this.overlay=null};BX.PopupWindow.prototype.hideOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){if(this.overlayTimeout){clearInterval(this.overlayTimeout);this.overlayTimeout=null}this.overlay.element.style.display="none"}};BX.PopupWindow.prototype.showOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){this.overlay.element.style.display="block";var e=this.popupContainer.offsetHeight;this.overlayTimeout=setInterval(function(){if(e!==this.popupContainer.offsetHeight){this.resizeOverlay();e=this.popupContainer.offsetHeight}}.bind(this),1000)}};BX.PopupWindow.prototype.resizeOverlay=function(){if(this.overlay!==null&&this.overlay.element!==null){if(this.parentPopup){this.overlay.element.style.width=this.parentPopup.popupContainer.offsetWidth+"px";this.overlay.element.style.height=this.parentPopup.popupContainer.offsetHeight+"px"}else{var e=BX.GetWindowScrollSize();var f=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);this.overlay.element.style.width=e.scrollWidth+"px";this.overlay.element.style.height=f+"px"}}};BX.PopupWindow.prototype.getZindex=function(){if(this.overlay!==null){return BX.PopupWindow.getOption("popupOverlayZindex")+this.params.zIndex}else{return BX.PopupWindow.getOption("popupZindex")+this.params.zIndex}};BX.PopupWindow.prototype.adjustOverlayZindex=function(){if(this.overlay!==null&&this.overlay.element!==null){this.overlay.element.style.zIndex=parseInt(this.popupContainer.style.zIndex)-1}};BX.PopupWindow.prototype.show=function(){if(!this.firstShow){BX.onCustomEvent(this,"onPopupFirstShow",[this]);this.firstShow=true}BX.onCustomEvent(this,"onPopupShow",[this]);this.showOverlay();this.popupContainer.style.display="block";this.adjustPosition();BX.onCustomEvent(this,"onAfterPopupShow",[this]);if(this.closeByEsc&&!this.isCloseByEscBinded){BX.bind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=true}if(this.autoHide&&!this.isAutoHideBinded){setTimeout(BX.proxy(function(){if(this.isShown()){this.bindAutoHide()}},this),100)}};BX.PopupWindow.prototype.isShown=function(){return this.popupContainer.style.display==="block"};BX.PopupWindow.prototype.cancelBubble=function(e){e=e||a.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}};BX.PopupWindow.prototype.close=function(e){if(!this.isShown()){return}if(e&&!(BX.getEventButton(e)&BX.MSLEFT)){return true}BX.onCustomEvent(this,"onPopupClose",[this,e]);this.hideOverlay();this.popupContainer.style.display="none";if(this.isCloseByEscBinded){BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));this.isCloseByEscBinded=false}setTimeout(BX.proxy(this._close,this),0)};BX.PopupWindow.prototype._close=function(){if(this.autoHide){this.unbindAutoHide()}};BX.PopupWindow.prototype._onCloseIconClick=function(e){e=e||a.event;this.close(e);BX.PreventDefault(e)};BX.PopupWindow.prototype._onKeyUp=function(e){e=e||a.event;if(e.keyCode===27){b(this.getZindex(),BX.proxy(this.close,this))}};BX.PopupWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupDestroy",[this]);BX.unbindAll(this);BX.unbind(document,"keyup",BX.proxy(this._onKeyUp,this));BX.unbind(document,"click",BX.proxy(this.close,this));BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));BX.unbind(a,"resize",BX.proxy(this._onResizeWindow,this));BX.remove(this.popupContainer);this.removeOverlay()};BX.PopupWindow.prototype.enterFullScreen=function(){if(BX.PopupWindow.fullscreenStatus){if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}}else{if(BX.browser.IsChrome()||BX.browser.IsSafari()){this.contentContainer.webkitRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT);BX.bind(a,"webkitfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this))}else{if(BX.browser.IsFirefox()){this.contentContainer.mozRequestFullScreen(this.contentContainer.ALLOW_KEYBOARD_INPUT);BX.bind(a,"mozfullscreenchange",this.fullscreenBind=BX.proxy(this.eventFullScreen,this))}}}};BX.PopupWindow.prototype.eventFullScreen=function(e){if(BX.PopupWindow.fullscreenStatus){if(BX.browser.IsChrome()||BX.browser.IsSafari()){BX.unbind(a,"webkitfullscreenchange",this.fullscreenBind)}else{if(BX.browser.IsFirefox()){BX.unbind(a,"mozfullscreenchange",this.fullscreenBind)}}BX.removeClass(this.contentContainer,"popup-window-fullscreen",[this.contentContainer]);BX.PopupWindow.fullscreenStatus=false;BX.onCustomEvent(this,"onPopupFullscreenLeave");this.adjustPosition()}else{BX.addClass(this.contentContainer,"popup-window-fullscreen");BX.PopupWindow.fullscreenStatus=true;BX.onCustomEvent(this,"onPopupFullscreenEnter",[this.contentContainer]);this.adjustPosition()}};BX.PopupWindow.prototype.adjustPosition=function(m){if(m&&typeof(m)==="object"){this.bindOptions=m}var g=this.getBindElementPos(this.bindElement);if(!this.bindOptions.forceBindPosition&&this.bindElementPos!==null&&g.top===this.bindElementPos.top&&g.left===this.bindElementPos.left){return}this.bindElementPos=g;var k=g.windowSize?g.windowSize:BX.GetWindowInnerSize();var n=g.windowScroll?g.windowScroll:BX.GetWindowScrollPos();var j=g.popupWidth?g.popupWidth:this.popupContainer.offsetWidth;var h=g.popupHeight?g.popupHeight:this.popupContainer.offsetHeight;var l=BX.PopupWindow.getOption("angleTopOffset");var f=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?BX.PopupWindow.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&(f+j+this.bordersWidth)>=(k.innerWidth+n.scrollLeft)&&(k.innerWidth+n.scrollLeft-j-this.bordersWidth)>0){var e=f;f=k.innerWidth+n.scrollLeft-j-this.bordersWidth;if(this.isTopOrBottomAngle()){this.setAngle({offset:e-f+this.angle.defaultOffset})}}else{if(this.isTopOrBottomAngle()){this.setAngle({offset:this.angle.defaultOffset+(f<0?f:0)})}}if(f<0){f=0}var i=0;if(this.bindOptions.position&&this.bindOptions.position==="top"){i=this.bindElementPos.top-h-this.offsetTop-(this.isBottomAngle()?l:0);if(i<0||(!this.bindOptions.forceTop&&i<n.scrollTop)){i=this.bindElementPos.bottom+this.offsetTop;if(this.angle!==null){i+=l;this.setAngle({position:"top"})}}else{if(this.isTopAngle()){i=i-l+BX.PopupWindow.getOption("positionTopXOffset");this.setAngle({position:"bottom"})}else{i+=BX.PopupWindow.getOption("positionTopXOffset")}}}else{i=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight();if(!this.bindOptions.forceTop&&(i+h)>(k.innerHeight+n.scrollTop)&&(this.bindElementPos.top-h-this.getAngleHeight())>=0){i=this.bindElementPos.top-h;if(this.isTopOrBottomAngle()){i-=l;this.setAngle({position:"bottom"})}i+=BX.PopupWindow.getOption("positionTopXOffset")}else{if(this.isBottomAngle()){i+=l;this.setAngle({position:"top"})}}}if(!this.parentPopup&&i<0){i=0}BX.adjust(this.popupContainer,{style:{top:i+"px",left:f+"px",zIndex:this.getZindex()}});this.adjustOverlayZindex()};BX.PopupWindow.prototype._onResizeWindow=function(e){if(this.isShown()){this.adjustPosition();if(this.overlay!==null){this.resizeOverlay()}}};BX.PopupWindow.prototype.move=function(k,j,i,g){var f=parseInt(this.popupContainer.style.left)+k;var l=parseInt(this.popupContainer.style.top)+j;if(typeof(this.params.draggable)==="object"&&this.params.draggable.restrict){if(!this.parentPopup&&f<0){f=0}var e=BX.GetWindowScrollSize();var m=this.popupContainer.offsetWidth;var h=this.popupContainer.offsetHeight;if(f>(e.scrollWidth-m)){f=e.scrollWidth-m}if(l>(e.scrollHeight-h)){l=e.scrollHeight-h}if(!this.parentPopup&&l<0){l=0}}this.popupContainer.style.left=f+"px";this.popupContainer.style.top=l+"px"};BX.PopupWindow.prototype._startDrag=function(f,e){f=f||a.event;BX.fixEventPageXY(f);e=e||{};if(BX.type.isNotEmptyString(e.cursor)){this.dragOptions.cursor=e.cursor}if(BX.type.isNotEmptyString(e.eventName)){this.dragOptions.eventName=e.eventName}if(BX.type.isFunction(e.callback)){this.dragOptions.callback=e.callback}this.dragPageX=f.pageX;this.dragPageY=f.pageY;this.dragged=false;BX.bind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.bind(document,"mouseup",BX.proxy(this._stopDrag,this));if(document.body.setCapture){document.body.setCapture()}document.body.ondrag=BX.False;document.body.onselectstart=BX.False;document.body.style.cursor=this.dragOptions.cursor;document.body.style.MozUserSelect="none";this.popupContainer.style.MozUserSelect="none";return BX.PreventDefault(f)};BX.PopupWindow.prototype._moveDrag=function(e){e=e||a.event;BX.fixEventPageXY(e);if(this.dragPageX===e.pageX&&this.dragPageY===e.pageY){return}this.dragOptions.callback(e.pageX-this.dragPageX,e.pageY-this.dragPageY,e.pageX,e.pageY);this.dragPageX=e.pageX;this.dragPageY=e.pageY;if(!this.dragged){BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName+"Start",[this]);this.dragged=true}BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName,[this])};BX.PopupWindow.prototype._stopDrag=function(e){if(document.body.releaseCapture){document.body.releaseCapture()}BX.unbind(document,"mousemove",BX.proxy(this._moveDrag,this));BX.unbind(document,"mouseup",BX.proxy(this._stopDrag,this));document.body.ondrag=null;document.body.onselectstart=null;document.body.style.cursor="";document.body.style.MozUserSelect="";this.popupContainer.style.MozUserSelect="";BX.onCustomEvent(this,"onPopup"+this.dragOptions.eventName+"End",[this]);this.dragged=false;return BX.PreventDefault(e)};BX.PopupWindow.options={};BX.PopupWindow.defaultOptions={angleLeftOffset:40,positionTopXOffset:-11,angleTopOffset:10,popupZindex:1000,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:10,angleMinRight:10,angleMaxRight:10,angleMinBottom:23,angleMaxBottom:25,angleMinTop:23,angleMaxTop:25,offsetLeft:0,offsetTop:0};BX.PopupWindow.setOptions=function(e){if(!e||typeof(e)!=="object"){return}for(var f in e){BX.PopupWindow.options[f]=e[f]}};BX.PopupWindow.getOption=function(f,e){if(typeof(BX.PopupWindow.options[f])!=="undefined"){return BX.PopupWindow.options[f]}else{if(typeof(e)!=="undefined"){return e}else{return BX.PopupWindow.defaultOptions[f]}}};BX.PopupWindowButton=function(f){this.popupWindow=null;this.params=f||{};this.text=this.params.text||"";this.id=this.params.id||"";this.className=this.params.className||"";this.events=this.params.events||{};this.contextEvents={};for(var e in this.events){this.contextEvents[e]=BX.proxy(this.events[e],this)}this.buttonNode=BX.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})};BX.PopupWindowButton.prototype.render=function(){return this.buttonNode};BX.PopupWindowButton.prototype.getId=function(){return this.id};BX.PopupWindowButton.prototype.getName=function(){return this.name};BX.PopupWindowButton.prototype.getContainer=function(){return this.buttonNode};BX.PopupWindowButton.prototype.setName=function(e){this.text=e||"";if(this.buttonNode){BX.cleanNode(this.buttonNode);BX.adjust(this.buttonNode,{text:this.text})}};BX.PopupWindowButton.prototype.setClassName=function(e){if(this.buttonNode){if(BX.type.isString(this.className)&&(this.className!=="")){BX.removeClass(this.buttonNode,this.className)}BX.addClass(this.buttonNode,e)}this.className=e};BX.PopupWindowButton.prototype.addClassName=function(e){if(this.buttonNode){BX.addClass(this.buttonNode,e);this.className=this.buttonNode.className}};BX.PopupWindowButton.prototype.removeClassName=function(e){if(this.buttonNode){BX.removeClass(this.buttonNode,e);this.className=this.buttonNode.className}};BX.PopupWindowButtonLink=function(e){BX.PopupWindowButtonLink.superclass.constructor.apply(this,arguments);this.buttonNode=BX.create("span",{props:{className:"popup-window-button popup-window-button-link"+(this.className.length>0?" "+this.className:""),id:this.id},text:this.text,events:this.contextEvents})};BX.extend(BX.PopupWindowButtonLink,BX.PopupWindowButton);BX.PopupWindowCustomButton=function(e){BX.PopupWindowCustomButton.superclass.constructor.apply(this,arguments);this.buttonNode=BX.create("span",{props:{className:(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})};BX.extend(BX.PopupWindowCustomButton,BX.PopupWindowButton);BX.PopupMenu={Data:{},currentItem:null,show:function(h,e,f,g){if(this.currentItem!==null){this.currentItem.popupWindow.close()}this.currentItem=this.create(h,e,f,g);this.currentItem.popupWindow.show()},create:function(h,e,f,g){if(!this.Data[h]){this.Data[h]=new BX.PopupMenuWindow(h,e,f,g);BX.addCustomEvent(this.Data[h],"onPopupMenuDestroy",this.onPopupDestroy.bind(this))}return this.Data[h]},getCurrentMenu:function(){return this.currentItem},getMenuById:function(e){return this.Data[e]?this.Data[e]:null},onPopupDestroy:function(e){this.destroy(e.id)},destroy:function(f){var e=this.getMenuById(f);if(e){if(this.currentItem===e){this.currentItem=null}e.popupWindow.destroy();delete this.Data[f]}}};BX.PopupMenuWindow=function(j,e,g,h){this.id=j;this.bindElement=e;this.menuItems=[];this.itemsContainer=null;this.params=h&&typeof(h)==="object"?h:{};this.parentMenuWindow=null;this.parentMenuItem=null;if(g&&BX.type.isArray(g)){for(var f=0;f<g.length;f++){this.addMenuItemInternal(g[f],null)}}this.layout={menuContainer:null,itemsContainer:null};this.popupWindow=this.__createPopup()};BX.PopupMenuWindow.prototype.__createPopup=function(){var e=[];for(var h=0;h<this.menuItems.length;h++){var k=this.menuItems[h];var j=k.getLayout();e.push(j.item)}var g=new BX.PopupWindow("menu-popup-"+this.id,this.bindElement,{closeByEsc:typeof(this.params.closeByEsc)!=="undefined"?this.params.closeByEsc:false,bindOptions:typeof(this.params.bindOptions)==="object"?this.params.bindOptions:{},angle:typeof(this.params.angle)!=="undefined"?this.params.angle:false,zIndex:this.params.zIndex?this.params.zIndex:0,overlay:typeof(this.params.overlay)==="object"?this.params.overlay:null,autoHide:typeof(this.params.autoHide)!=="undefined"?this.params.autoHide:true,offsetTop:this.params.offsetTop?this.params.offsetTop:1,offsetLeft:this.params.offsetLeft?this.params.offsetLeft:0,className:BX.type.isNotEmptyString(this.params.className)?this.params.className:"",noAllPaddings:true,content:(this.layout.menuContainer=BX.create("div",{props:{className:"menu-popup"},children:[(this.layout.itemsContainer=this.itemsContainer=BX.create("div",{props:{className:"menu-popup-items"},children:e}))]})),events:{onPopupClose:this.onMenuWindowClose.bind(this),onPopupDestroy:this.onMenuWindowDestroy.bind(this)}});if(this.params&&this.params.events){for(var f in this.params.events){if(this.params.events.hasOwnProperty(f)){BX.addCustomEvent(g,f,this.params.events[f])}}}return g};BX.PopupMenuWindow.prototype.getPopupWindow=function(){return this.popupWindow};BX.PopupMenuWindow.prototype.show=function(){this.popupWindow.show()};BX.PopupMenuWindow.prototype.close=function(){this.popupWindow.close()};BX.PopupMenuWindow.prototype.destroy=function(){BX.onCustomEvent(this,"onPopupMenuDestroy",[this]);this.popupWindow.destroy()};BX.PopupMenuWindow.prototype.onMenuWindowClose=function(){for(var e=0;e<this.menuItems.length;e++){var f=this.menuItems[e];f.closeSubMenu()}};BX.PopupMenuWindow.prototype.onMenuWindowDestroy=function(){for(var e=0;e<this.menuItems.length;e++){var f=this.menuItems[e];f.destroySubMenu()}};BX.PopupMenuWindow.prototype.setParentMenuWindow=function(e){if(e instanceof BX.PopupMenuWindow){this.parentMenuWindow=e}};BX.PopupMenuWindow.prototype.getParentMenuWindow=function(){return this.parentMenuWindow};BX.PopupMenuWindow.prototype.setParentMenuItem=function(e){if(e instanceof BX.PopupMenuItem){this.parentMenuItem=e}};BX.PopupMenuWindow.prototype.getParentMenuItem=function(){return this.parentMenuItem};BX.PopupMenuWindow.prototype.addMenuItem=function(e,j){var g=this.addMenuItemInternal(e,j);if(!g){return null}var f=g.getLayout();var i=this.getMenuItem(j);if(i!==null){var h=i.getLayout();this.itemsContainer.insertBefore(f.item,h.item)}else{this.itemsContainer.appendChild(f.item)}return g};BX.PopupMenuWindow.prototype.addMenuItemInternal=function(f,h){if(!f||(!f.delimiter&&!BX.type.isNotEmptyString(f.text))||(f.id&&this.getMenuItem(f.id)!==null)){return null}if(BX.type.isNumber(this.params.menuShowDelay)){f.menuShowDelay=this.params.menuShowDelay}var g=new BX.PopupMenuItem(f);g.setMenuWindow(this);var e=this.getMenuItemPosition(h);if(e>=0){this.menuItems=BX.util.insertIntoArray(this.menuItems,e,g)}else{this.menuItems.push(g)}return g};BX.PopupMenuWindow.prototype.removeMenuItem=function(i){var h=this.getMenuItem(i);if(!h){return}for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e]===h){h.destroySubMenu();this.menuItems=BX.util.deleteFromArray(this.menuItems,e);break}}if(!this.menuItems.length){var g=h.getMenuWindow();if(g){var f=g.getParentMenuItem();if(f){f.destroySubMenu()}else{g.destroy()}}}h.layout.item.parentNode.removeChild(h.layout.item);h.layout={item:null,text:null}};BX.PopupMenuWindow.prototype.getMenuItem=function(f){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].id&&this.menuItems[e].id===f){return this.menuItems[e]}}return null};BX.PopupMenuWindow.prototype.getMenuItems=function(){return this.menuItems};BX.PopupMenuWindow.prototype.getMenuItemPosition=function(f){if(f){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].id&&this.menuItems[e].id===f){return e}}}return -1};BX.PopupMenuItem=function(f){f=f||{};this.options=f;this.id=f.id||BX.util.getRandomString().toLowerCase();this.text=BX.type.isNotEmptyString(f.text)?f.text:"";this.title=BX.type.isNotEmptyString(f.title)?f.title:"";this.delimiter=f.delimiter===true;this.href=BX.type.isNotEmptyString(f.href)?f.href:null;this.target=BX.type.isNotEmptyString(f.target)?f.target:null;this.dataset=BX.type.isPlainObject(f.dataset)?f.dataset:null;this.className=BX.type.isNotEmptyString(f.className)?f.className:null;this.menuShowDelay=BX.type.isNumber(f.menuShowDelay)?f.menuShowDelay:300;this.subMenuOffsetX=BX.type.isNumber(f.subMenuOffsetX)?f.subMenuOffsetX:4;this._items=BX.type.isArray(f.items)?f.items:[];this.onclick=BX.type.isNotEmptyString(f.onclick)||BX.type.isFunction(f.onclick)?f.onclick:null;if(BX.type.isPlainObject(f.events)){for(var e in f.events){BX.addCustomEvent(this,e,f.events[e])}}this.menuWindow=null;this.subMenuWindow=null;this.layout={item:null,text:null};this.getLayout();this.events={};this.items=[];for(var g in f){if(f.hasOwnProperty(g)&&typeof(this[g])==="undefined"){this[g]=f[g]}}};BX.PopupMenuItem.prototype={getLayout:function(){if(this.layout.item){return this.layout}if(this.delimiter){this.layout.item=BX.create("span",{props:{className:"popup-window-delimiter"}})}else{this.layout.item=BX.create(this.href?"a":"span",{props:{className:["menu-popup-item",(this.className?this.className:"menu-popup-no-icon"),(this.hasSubMenu()?"menu-popup-item-submenu":"")].join(" ")},attrs:{title:this.title,onclick:BX.type.isString(this.onclick)?this.onclick:"",target:this.target?this.target:""},dataset:this.dataset,events:BX.type.isFunction(this.onclick)?{click:BX.delegate(this.onItemClick,this)}:null,children:[BX.create("span",{props:{className:"menu-popup-item-icon"}}),(this.layout.text=BX.create("span",{props:{className:"menu-popup-item-text"},html:this.text}))]});if(this.href){this.layout.item.href=this.href}BX.bind(this.layout.item,"mouseenter",this.onItemMouseEnter.bind(this));BX.bind(this.layout.item,"mouseleave",this.onItemMouseLeave.bind(this))}return this.layout},onItemClick:function(e){this.onclick.call(this.menuWindow,e,this)},onItemMouseEnter:function(e){BX.onCustomEvent(this,"onMouseEnter");if(this.subMenuTimeout){clearTimeout(this.subMenuTimeout)}if(this.hasSubMenu()){this.subMenuTimeout=setTimeout(function(){this.showSubMenu()}.bind(this),this.menuShowDelay)}else{this.subMenuTimeout=setTimeout(function(){this.closeSiblings()}.bind(this),this.menuShowDelay)}},onItemMouseLeave:function(e){BX.onCustomEvent(this,"onMouseLeave");if(this.subMenuTimeout){clearTimeout(this.subMenuTimeout)}},hasSubMenu:function(){return this.subMenuWindow!==null||this._items.length},showSubMenu:function(){this.addSubMenu(this._items);if(this.subMenuWindow){BX.addClass(this.layout.item,"menu-popup-item-open");this.closeSiblings();this.closeChildren();var e=this.subMenuWindow.getPopupWindow();if(!e.isShown()){BX.onCustomEvent(this,"onSubMenuShow");e.show()}this.adjustSubMenu()}},addSubMenu:function(e){if(this.subMenuWindow!==null||!BX.type.isArray(e)||!e.length){return}this.subMenuWindow=new BX.PopupMenuWindow("popup-submenu-"+this.id,null,e,{autoHide:false,menuShowDelay:this.menuShowDelay,bindOptions:{forceTop:true,forceLeft:true,forceBindPosition:true}});this.subMenuWindow.setParentMenuWindow(this.menuWindow);this.subMenuWindow.setParentMenuItem(this);BX.addClass(this.layout.item,"menu-popup-item-submenu")},closeSubMenu:function(){if(this.subMenuWindow){BX.removeClass(this.layout.item,"menu-popup-item-open");this.closeChildren();var e=this.subMenuWindow.getPopupWindow();if(e.isShown()){BX.onCustomEvent(this,"onSubMenuClose");e.close()}this.subMenuWindow.close()}},closeSiblings:function(){var f=this.menuWindow.getMenuItems();for(var e=0;e<f.length;e++){if(f[e]!==this){f[e].closeSubMenu()}}},closeChildren:function(){if(this.subMenuWindow){var f=this.subMenuWindow.getMenuItems();for(var e=0;e<f.length;e++){f[e].closeSubMenu()}}},destroySubMenu:function(){if(this.subMenuWindow){BX.removeClass(this.layout.item,"menu-popup-item-open menu-popup-item-submenu");this.destroyChildren();this.subMenuWindow.destroy();this.subMenuWindow=null;this._items=[]}},destroyChildren:function(){if(this.subMenuWindow){var f=this.subMenuWindow.getMenuItems();for(var e=0;e<f.length;e++){f[e].destroySubMenu()}}},adjustSubMenu:function(){if(!this.subMenuWindow||!this.layout.item){return}var e=this.subMenuWindow.getPopupWindow();var k=BX.pos(this.layout.item);var g=k.width+this.subMenuOffsetX;var f="left";var i=e.popupContainer.offsetWidth;var j=document.documentElement.clientWidth;if((k.left+g+i)>j){var h=k.left-i-this.subMenuOffsetX;if(h>0){g=-i-this.subMenuOffsetX;f="right"}}e.setBindElement(this.layout.item);e.setOffset({offsetLeft:g,offsetTop:-(k.height+this.getPopupPadding())});e.setAngle({position:f,offset:((k.height/2)-this.getPopupPadding())});e.adjustPosition()},getPopupPadding:function(){if(!BX.type.isNumber(this.popupPadding)){if(this.subMenuWindow){var e=this.subMenuWindow.layout.menuContainer;this.popupPadding=parseInt(BX.style(e,"paddingTop"),10)}else{this.popupPadding=0}}return this.popupPadding},getSubMenu:function(){return this.subMenuWindow},getId:function(){return this.id},setMenuWindow:function(e){this.menuWindow=e},getMenuWindow:function(){return this.menuWindow},getMenuShowDelay:function(){return this.menuShowDelay}};a.BXInputPopup=function(e){this.id=e.id||"bx-inp-popup-"+Math.round(Math.random()*1000000);this.handler=e.handler||false;this.values=e.values||false;this.pInput=e.input;this.bValues=!!this.values;this.defaultValue=e.defaultValue||"";this.openTitle=e.openTitle||"";this.className=e.className||"";this.noMRclassName=e.noMRclassName||"ec-no-rm";this.emptyClassName=e.noMRclassName||"ec-label";var f=this;this.curInd=false;if(this.bValues){this.pInput.onfocus=this.pInput.onclick=function(g){if(this.value==f.defaultValue){this.value="";this.className=f.className}f.ShowPopup();return BX.PreventDefault(g)};this.pInput.onblur=function(){if(f.bShowed){setTimeout(function(){f.ClosePopup(true)},200)}f.OnChange()}}else{this.pInput.className=this.noMRclassName;this.pInput.onblur=BX.proxy(this.OnChange,this)}};BXInputPopup.prototype={ShowPopup:function(){if(this.bShowed){return}var j=this;if(!this.oPopup){var h,g=BX.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}});for(var f=0,e=this.values.length;f<e;f++){h=g.appendChild(BX.create("DIV",{props:{id:"bxecmr_"+f},text:this.values[f].NAME,events:{mouseover:function(){BX.addClass(this,"bxecplloc-over")},mouseout:function(){BX.removeClass(this,"bxecplloc-over")},click:function(){var i=this.id.substr("bxecmr_".length);j.pInput.value=j.values[i].NAME;j.curInd=i;j.OnChange();j.ClosePopup(true)}}}));if(this.values[f].DESCRIPTION){h.title=this.values[f].DESCRIPTION}if(this.values[f].CLASS_NAME){BX.addClass(h,this.values[f].CLASS_NAME)}if(this.values[f].URL){h.appendChild(BX.create("A",{props:{href:this.values[f].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}))}}this.oPopup=new BX.PopupWindow(this.id,this.pInput,{autoHide:true,offsetTop:1,offsetLeft:0,lightShadow:true,closeByEsc:true,content:g});BX.addCustomEvent(this.oPopup,"onPopupClose",BX.proxy(this.ClosePopup,this))}this.oPopup.show();this.pInput.select();this.bShowed=true;BX.onCustomEvent(this,"onInputPopupShow",[this])},ClosePopup:function(e){this.bShowed=false;if(this.pInput.value==""){this.OnChange()}BX.onCustomEvent(this,"onInputPopupClose",[this]);if(e===true){this.oPopup.close()}},OnChange:function(){var e=this.pInput.value;if(this.bValues){if(this.pInput.value==""||this.pInput.value==this.defaultValue){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName;e=""}else{this.pInput.className=""}}if(isNaN(parseInt(this.curInd))||this.curInd!==false&&e!=this.values[this.curInd].NAME){this.curInd=false}else{this.curInd=parseInt(this.curInd)}BX.onCustomEvent(this,"onInputPopupChanged",[this,this.curInd,e]);if(this.handler&&typeof this.handler=="function"){this.handler({ind:this.curInd,value:e})}},Set:function(f,g,e){this.curInd=f;if(this.curInd!==false){this.pInput.value=this.values[this.curInd].NAME}else{this.pInput.value=g}if(e!==false){this.OnChange()}},Get:function(e){var f=false;if(typeof e=="undefined"){e=this.curInd}if(e!==false&&this.values[e]){f=this.values[e].ID}return f},GetIndex:function(g){for(var f=0,e=this.values.length;f<e;f++){if(this.values[f].ID==g){return f}}return false},Deactivate:function(e){if(this.pInput.value==""||this.pInput.value==this.defaultValue){if(e){this.pInput.value="";this.pInput.className=this.noMRclassName}else{if(this.oEC.bUseMR){this.pInput.value=this.defaultValue;this.pInput.className=this.emptyClassName}}}this.pInput.disabled=e}};var d=-1,c=null;function b(g,f){if(g===false){if(c&&c.length>0){for(var e=0;e<c.length;e++){c[e]()}c=null;d=-1}}else{if(c===null){c=[];d=-1;BX.defer(b)(false)}if(g>d){d=g;c=[f]}else{if(g==d){c.push(f)}}}}})(window);