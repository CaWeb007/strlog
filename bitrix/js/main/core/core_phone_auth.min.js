(function(){var a=window.BX;if(a.PhoneAuth){return}a.PhoneAuth=function(b){this.containerId=b.containerId;this.errorContainerId=b.errorContainerId;this.data=b.data;this.interval=60;if(b.interval){this.interval=b.interval}if(b.onError){this.onError=b.onError}a.ready(a.delegate(this.createLink,this))};a.PhoneAuth.prototype.createLink=function(){var b=a(this.containerId);if(b){var c=a.message("phone_auth_resend").replace(/#INTERVAL#/,'<span id="'+this.containerId+'_counter">'+this.interval+"</span>");b.innerHTML='<div id="'+this.containerId+'_text">'+c+'</div>\n<div id="'+this.containerId+'_action" style="display:none"><a href="javascript:void(0)" id="'+this.containerId+'_link">'+a.message("phone_auth_resend_link")+"</a></div>";a(this.containerId+"_link").onclick=a.delegate(this.resendCode,this);this.startTimer()}};a.PhoneAuth.prototype.startTimer=function(){a(this.containerId+"_counter").textContent=this.interval;a(this.containerId+"_text").style.display="";a(this.containerId+"_action").style.display="none";a(this.errorContainerId).style.display="none";var b=setInterval(a.delegate(function(){var d=a(this.containerId+"_counter");var c=parseInt(d.textContent);if(c>0){c--}d.textContent=c},this),1000);setTimeout(a.delegate(function(){clearInterval(b);a(this.containerId+"_text").style.display="none";a(this.containerId+"_action").style.display=""},this),this.interval*1000)};a.PhoneAuth.prototype.resendCode=function(){a.ajax.runAction("main.phoneauth.resendCode",{data:this.data}).then(this.startTimer(),a.delegate(function(b){this.startTimer();if(this.onError){this.onError(b)}},this))}})();