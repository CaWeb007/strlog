(function(){if(window.BX.CViewer){return}BX.viewElementBind=function(i,h,g,f){var e=new BX.CViewer(h);if(!g){g=function(j){return BX.type.isElementNode(j)&&(j.getAttribute("data-bx-viewer")||j.tagName.toUpperCase()=="IMG")}}BX.ready(function(){d(i,g,f,e)});return e};var c=0;var a=null;function d(h,g,f,e){var h=BX(h);if(!!h){BX.bindDelegate(h,"click",g,function(o){if(BX.findParent(this,{tagName:"a",attribute:{target:"_blank"}},5)){return true}if(this.getAttribute("data-bx-viewer")=="folder"){return true}c++;if(c!==1){clearTimeout(a);c=0;return true}else{a=setTimeout(function(){c=0},1000)}var s=h;if(!!f){s=BX.findParent(this,f,h)||s}e.setList([]);var k=BX.findChildren(s,g,true);for(var m=0;m<k.length;m++){var q=k[m].getAttribute("data-bx-viewer");if(q=="image"||k[m].getAttribute("data-bx-image")){var p=new BX.CViewImageElement({src:k[m].getAttribute("data-bx-src")||k[m].getAttribute("data-bx-download")||k[m].getAttribute("data-bx-image"),width:k[m].getAttribute("data-bx-width"),height:k[m].getAttribute("data-bx-height"),title:k[m].getAttribute("data-bx-title")||k[m].alt||k[m].title,full:k[m].getAttribute("data-bx-full"),full_width:k[m].getAttribute("data-bx-full-width"),full_height:k[m].getAttribute("data-bx-full-height"),full_size:k[m].getAttribute("data-bx-full-size"),buttons:[]});p.buttons.push(p.getComplexSaveButton(e,{downloadUrl:k[m].getAttribute("data-bx-download")||k[m].getAttribute("data-bx-full")||k[m].getAttribute("data-bx-image")||k[m].getAttribute("data-bx-src")}));e.add(p)}else{if(q=="iframe-extlinks"){var r=new BX.CViewIframeExtLinksElement({title:k[m].getAttribute("data-bx-title"),src:k[m].getAttribute("data-bx-src"),viewerUrl:k[m].getAttribute("data-bx-viewerUrl"),buttons:[]});r.buttons.push(BX.create("a",{props:{className:"bx-viewer-btn",href:k[m].getAttribute("data-bx-src")},events:{click:BX.delegate(function(i){if(!this.loaded){var t=this;setTimeout(function(){e.show(t)},50)}BX.eventCancelBubble(i);return false},r)},text:BX.message("JS_CORE_VIEWER_DOWNLOAD")}));e.add(r)}else{if(q=="iframe"){var r=e.createElementByType(k[m]);e.add(r)}else{if(q=="ajax"){var n=e.createElementByType(k[m]);e.add(n)}else{if(q=="unknown"){var j=new BX.CViewUnknownElement({title:k[m].getAttribute("data-bx-title"),src:k[m].getAttribute("data-bx-src"),isFromUserLib:!!k[m].getAttribute("data-bx-isFromUserLib"),externalId:k[m].getAttribute("data-bx-externalId"),objectId:k[m].getAttribute("bx-attach-file-id"),relativePath:k[m].getAttribute("data-bx-relativePath"),editUrl:k[m].getAttribute("data-bx-edit"),fakeEditUrl:k[m].getAttribute("data-bx-fakeEdit"),owner:k[m].getAttribute("data-bx-owner"),size:k[m].getAttribute("data-bx-size"),dateModify:k[m].getAttribute("data-bx-dateModify"),tooBigSizeMsg:!!k[m].getAttribute("data-bx-tooBigSizeMsg"),buttons:[]});j.buttons.push(j.getLocalEditButton(e,{enableEdit:!!j.isFromUserLib||!!j.editUrl}));j.buttons.push(j.getComplexSaveButton(e,{downloadUrl:k[m].getAttribute("data-bx-src")}));e.add(j)}else{if(q=="onlyedit"){var l=e.createElementByType(k[m]);e.add(l)}else{if(q=="folder"){e.add(new BX.CViewFolderElement({title:k[m].getAttribute("data-bx-title"),src:k[m].getAttribute("data-bx-src"),owner:k[m].getAttribute("data-bx-owner"),dateModify:k[m].getAttribute("data-bx-dateModify"),buttons:[]}))}}}}}}}}BX.CViewer.objNowInShow=e;e.show(this.getAttribute("data-bx-image")||this.getAttribute("data-bx-src")||this.src);return BX.PreventDefault(o)});BX.bindDelegate(h,"dblclick",g,function(i){BX.PreventDefault(i)})}}BX.CViewCoreElement=function(e){e=e||{};this.baseElementId=e.baseElementId;this.id=e.id||e.src;this.title=e.title;this.text=e.text;this.width=e.width;this._minWidth=e._minWidth;this.height=e.height;this._minHeight=e._minHeight;this.domElement=null;this.titleDomElement=null;this.titleButtons=null;this.src=e.src;this.loaded=false;this.preventShow=false;this.listOfTimeoutIds=[];this.contentWrap=null;this.isProccessed=false;this.topPadding=0;this.buttons=e.buttons||[];this.showTitle=e.showTitle||true;this.isHistory=false;this.autoReduction=false;if(this._minWidth===undefined){this._minWidth=550}if(this._minHeight===undefined){this._minHeight=350}this.isFromUserLib=e.isFromUserLib||false;this.externalId=e.externalId||false;this.objectId=e.objectId||false;this.relativePath=e.relativePath||false;this.editUrl=e.editUrl||false;this.fakeEditUrl=e.fakeEditUrl||false};BX.CViewCoreElement.prototype.getDataForCommit=function(){return{}};BX.CViewCoreElement.prototype.setContentWrap=function(e){this.contentWrap=e};BX.CViewCoreElement.prototype.runAction=function(e,f){e=e.toLowerCase();switch(e){case"edit":if(!this.editUrl){return false}this.addTimeoutId(setTimeout(function(){BX.fireEvent(BX("bx-viewer-edit-btn"),"click")},100));break;case"localedit":case"forceedit":if(!f.obElementViewer){return false}if(BX.CViewer.enableInVersionDisk(2)&&!this.hasOwnProperty("image")){if(!BX.message("disk_document_service")){f.obElementViewer.openWindowForSelectDocumentService({viewInUf:!!BX.message.disk_render_uf});return}}this.localEditProcess(f.obElementViewer,f);break;case"localview":if(!f.obElementViewer){return false}this.localViewProcess(f.obElementViewer);break}return};BX.CViewCoreElement.prototype.localEditProcess=function(e,g){g=g||{};var f=this.editUrl;if(BX.CViewer.isEnableLocalEditInDesktop()){if(!this.isFromUserLib&&f){if(f.indexOf("/")===0){window.location.origin=window.location.origin||(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));f=window.location.origin+f}f=b.getUrlEditFile(f,"l");if(!!g.isCreate){BX.CViewer.goToBx("bx://createFile/url/"+encodeURIComponent(f)+"/name/"+encodeURIComponent(this.title))}else{f=BX.util.remove_url_param(f,"filename");BX.CViewer.goToBx("bx://editFile/externalId/"+(this.externalId?encodeURIComponent(this.externalId):"0")+"/objectId/"+(this.objectId?encodeURIComponent(this.objectId):"0")+"/url/"+encodeURIComponent(f)+"/name/"+encodeURIComponent(this.title))}}else{if(this.relativePath&&this.externalId){BX.CViewer.goToBx("bx://openFile/externalId/"+encodeURIComponent(this.externalId))}}e.close();return}return};BX.CViewCoreElement.prototype.localViewProcess=function(e){var f=this.downloadUrl;if(BX.CViewer.isEnableLocalEditInDesktop()){if(!this.isFromUserLib&&f){if(f.indexOf("/")===0){window.location.origin=window.location.origin||(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));f=window.location.origin+f}f=b.getUrlEditFile(f,"l");f=BX.util.remove_url_param(f,"filename");BX.CViewer.goToBx("bx://viewFile/externalId/"+(this.externalId?encodeURIComponent(this.externalId):"0")+"/objectId/"+(this.objectId?encodeURIComponent(this.objectId):"0")+"/url/"+encodeURIComponent(f)+"/name/"+encodeURIComponent(this.title))}else{if(this.relativePath&&this.externalId){BX.CViewer.goToBx("bx://openFile/externalId/"+encodeURIComponent(this.externalId))}}e.close();return}return};BX.CViewCoreElement.prototype.getTextForSave=function(){return""};BX.CViewCoreElement.prototype.getComplexEditButton=function(l,i,g){g=g||false;var e={editBtn:"bx-viewer-btn-split-text"};if(g){e={editBtn:"webform-small-button",serviceText:"bx-viewer-edit-service-txt"}}var m={click:BX.delegate(function(n){if(!h||!this.getCurrent().editUrl){return BX.PreventDefault(n)}var o=n.srcElement||n.target;var p=[{text:BX.message("JS_CORE_VIEWER_EDIT_IN_SERVICE").replace("#SERVICE#",this.getNameEditService("google")),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate(function(q){this.setEditService("google");BX.fireEvent(BX("bx-viewer-edit-btn"),"click");this.closeMenu();return BX.PreventDefault(q)},this)},(BX.CViewer.enableInVersionDisk(6)?{text:BX.message("JS_CORE_VIEWER_EDIT_IN_SERVICE").replace("#SERVICE#",this.getNameEditService("office365")),className:"bx-viewer-popup-item item-office365",href:"#",onclick:BX.delegate(function(q){this.setEditService("office365");BX.fireEvent(BX("bx-viewer-edit-btn"),"click");this.closeMenu();return BX.PreventDefault(q)},this)}:null),(BX.message("DISK_MYOFFICE")?{text:BX.message("JS_CORE_VIEWER_EDIT_IN_SERVICE").replace("#SERVICE#",this.getNameEditService("myoffice")),className:"bx-viewer-popup-item item-myoffice",href:"#",onclick:BX.delegate(function(q){this.setEditService("myoffice");BX.fireEvent(BX("bx-viewer-edit-btn"),"click");this.closeMenu();return BX.PreventDefault(q)},this)}:null),{text:BX.message("JS_CORE_VIEWER_EDIT_IN_SERVICE").replace("#SERVICE#",this.getNameEditService("skydrive")),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate(function(q){this.setEditService("skydrive");BX.fireEvent(BX("bx-viewer-edit-btn"),"click");this.closeMenu();return BX.PreventDefault(q)},this)}];if(this.getCurrent().editUrl&&!BX.CViewer.isDisabledLocalEdit){p.push({text:BX.message("JS_CORE_VIEWER_EDIT_IN_LOCAL_SERVICE").replace("#SERVICE#",this.getNameEditService("local")),className:"bx-viewer-popup-item item-local",href:"#",onclick:BX.delegate(function(q){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("local");BX.fireEvent(BX("bx-viewer-edit-btn"),"click")}else{l.helpDiskDialog()}this.closeMenu();return BX.PreventDefault(q)},this)})}this.openMenu("bx-viewer-popup-edit",BX(o),p,{offsetTop:0,offsetLeft:-9,zIndex:11400})},l)};var k="";var h=i.enableEdit||false;if(i.isLocked){h=false;k=BX.message("JS_CORE_VIEWER_DOCUMENT_IS_LOCKED_BY")}if(!i.enableEdit){k=BX.message("JS_CORE_VIEWER_DISABLE_EDIT_BY_PERM")}var f=l.initEditService();var j=BX.create("span",{props:{id:"bx-viewer-edit-btn",className:e.editBtn},events:{click:BX.delegate(function(n){if(!h||!this.editUrl){return BX.PreventDefault(n)}BX.PreventDefault(n);l.runActionByCurrentElement("forceEdit",{obElementViewer:l})},this)},children:[BX.create("i",{props:{id:"bx-viewer-edit-service-txt",className:e.serviceText||null},text:!BX.CViewer.isLocalEditService(f)?l.getNameEditService(f):l.getNameEditService()})]});j.insertBefore(document.createTextNode(BX.message(BX.CViewer.isLocalEditService(f)?"JS_CORE_VIEWER_EDIT_IN_LOCAL_SERVICE_SHORT":"JS_CORE_VIEWER_EDIT_IN_SERVICE").replace("#SERVICE#"," ")),j.firstChild);if(g){return BX.create("span",{props:{className:"bx-viewer-btn-split bx-viewer-btn-split-margin-top "+(h?"":"bx-viewer-btn-split-disable"),title:k},children:[BX.create("span",{props:{className:"webform-small-button-separate-wrap"},children:[j,BX.create("span",{props:{className:"webform-small-button-right-part"},events:m})]})]})}else{return BX.create("span",{props:{className:"bx-viewer-btn-split "+(h?"":"bx-viewer-btn-split-disable"),title:k},children:[BX.create("span",{props:{className:"bx-viewer-btn-split-l"},children:[j,BX.create("span",{props:{className:"bx-viewer-btn-split-bg"}})]}),BX.create("span",{props:{className:"bx-viewer-btn-split-r"},events:m,children:[BX.create("span",{props:{className:"bx-viewer-btn-split-bg"}})]})]})}};BX.CViewCoreElement.prototype.getLocalEditButton=function(f,h){var e=h.enableEdit||false;if(
/*!this.isFromUserLib || */
!this.editUrl||!BX.CViewer.isEnableLocalEditInDesktop()){return[]}var g=BX.create("span",{props:{id:"bx-viewer-edit-btn",className:"bx-viewer-btn-split-text"},events:{click:BX.delegate(function(i){if(!e){return BX.PreventDefault(i)}BX.PreventDefault(i);f.runActionByCurrentElement("localEdit",{obElementViewer:f})},this)},children:[BX.create("span",{props:{id:"bx-viewer-edit-service-txt"},text:f.getNameEditService("local")})]});g.insertBefore(document.createTextNode(BX.message("JS_CORE_VIEWER_EDIT_IN_LOCAL_SERVICE_SHORT").replace("#SERVICE#"," ")),g.firstChild);return BX.create("span",{props:{className:"bx-viewer-btn-split "+(e?"":"bx-viewer-btn-split-disable"),title:e?"":BX.message("JS_CORE_VIEWER_DISABLE_EDIT_BY_PERM")},children:[BX.create("span",{props:{className:"bx-viewer-btn-split-l"},children:[g,BX.create("span",{props:{className:"bx-viewer-btn-split-bg"}})]})]})};BX.CViewCoreElement.prototype.getComplexSaveButton=function(e,g){var f=g.downloadUrl;g.reloadAfterDownload=g.reloadAfterDownload||false;return(BX.create("a",{props:{className:"bx-viewer-btn bx-viewer-btn-save",href:f},events:{click:BX.delegate(function(h){var i=h.srcElement||h.target;e.openMenu("bx-viewer-popup-down",BX(i),[((BX.CViewer.isDisabledLocalEdit||!BX.message.disk_revision_api)?null:{text:BX.message("JS_CORE_VIEWER_SAVE_TO_OWN_FILES"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate(function(k){var j=this.addToLinkParam(BX.CViewer.enableInVersionDisk(2)?f:this.src,"saveToDisk",1);j=this.addToLinkParam(j,"toWDController",1);j=BX.util.remove_url_param(j,"showInViewer");j=BX.util.remove_url_param(j,"document_action");j=BX.util.remove_url_param(j,"primaryAction");j=b.getUrlCopyToMe(j);e.closeMenu();BX.CViewer.getWindowCopyToDisk({link:j,selfViewer:e,title:this.title,showEdit:g.showEdit});BX.PreventDefault(k);return false},this)}),{text:BX.message("JS_CORE_VIEWER_DOWNLOAD_TO_PC"),className:"bx-viewer-popup-item item-download",href:f,onclick:BX.delegate(function(j){e.closeMenu();if(g.reloadAfterDownload&&!this.loaded){setTimeout(BX.delegate(function(){e.show(this,true)},1000),this)}BX.eventCancelBubble(j);return false},this)}],{offsetTop:0,offsetLeft:-9});return BX.PreventDefault(h)},this)},text:BX.message("JS_CORE_VIEWER_SAVE")}))};BX.CViewCoreElement.prototype.getExtension=function(e){e=e||"";return e.split(".").pop()};BX.CViewCoreElement.prototype.getIconClassByName=function(e){var g=this.getExtension(e);var f="";switch(g.toLowerCase()){case"txt":f="bx-viewer-icon-txt";break;case"archive":case"gz":case"bz2":case"tar":f="bx-viewer-icon-archive";break;case"zip":f="bx-viewer-icon-zip";break;case"rar":f="bx-viewer-icon-rar";break;case"pdf":f="bx-viewer-icon-pdf";break;case"ppt":case"pptx":f="bx-viewer-icon-ppt";break;case"doc":case"docx":f="bx-viewer-icon-doc";break;case"xls":case"xlsx":f="bx-viewer-icon-xls";break;case"avi":case"wmv":case"mp4":case"mov":case"webm":case"flv":case"m4v":case"mkv":case"vob":case"3gp":case"ogv":f="bx-viewer-icon-video";break;default:f="bx-viewer-icon";break}return f};BX.CViewCoreElement.prototype.load=function(e,f){};BX.CViewCoreElement.prototype.preload=function(e){};BX.CViewCoreElement.prototype.hide=function(e){e=e||false;this.preventTimeout();this.preventShow=true};BX.CViewCoreElement.prototype.show=function(){this.preventShow=false};BX.CViewCoreElement.prototype.successLoad=function(e){};BX.CViewCoreElement.prototype.onLoad=function(){};BX.CViewCoreElement.prototype.getTitle=function(){return this.title};BX.CViewCoreElement.prototype.getSize=function(){return{width:this.width,height:this.height}};BX.CViewCoreElement.prototype.resize=function(e,f){this.width=e;this.height=f};BX.CViewCoreElement.prototype.addTimeoutId=function(e){this.listOfTimeoutIds.push(e)};BX.CViewCoreElement.prototype.preventTimeout=function(){if(!BX.type.isArray(this.listOfTimeoutIds)){return}for(var e in this.listOfTimeoutIds){if(this.listOfTimeoutIds.hasOwnProperty(e)){clearTimeout(this.listOfTimeoutIds[e])}}this.listOfTimeoutIds=[]};BX.CViewCoreElement.prototype.addToLinkSessid=function(e){return this.addToLinkParam(e,"sessid",BX.bitrix_sessid())};BX.CViewCoreElement.prototype.addToLinkParam=function(f,e,g){if(!f.length){return"?"+e+"="+g}f=BX.util.remove_url_param(f,e);if(f.indexOf("?")!=-1){return f+"&"+e+"="+g}return f+"?"+e+"="+g};BX.CViewCoreElement.prototype.getBottomHtml=function(){return""};BX.CViewImageElement=function(e){e=e||{};BX.CViewIframeElement.superclass.constructor.apply(this,arguments);this.image=null;this.width=e.width||200;this.height=e.height||200;this.full=e.full;this.full_width=e.full_width;this.full_height=e.full_height;this.full_size=e.full_size;this.topPadding=43;this.imageElement=true};BX.extend(BX.CViewImageElement,BX.CViewCoreElement);BX.CViewImageElement.prototype.setContentWrap=function(e){this.contentWrap=e};BX.CViewImageElement.prototype.load=function(e){e=e||BX.CViewImageElement.prototype.successLoad;if(!this.loaded){this.preload(function(f){e(f);f.contentWrap.appendChild(f.domElement)})}else{(function(f){e(f);f.contentWrap.appendChild(f.domElement)})(this)}};BX.CViewImageElement.prototype.preload=function(e){if(this.isProccessed){return false}this.successLoad=e||BX.CViewImageElement.prototype.successLoad;if(!this.loaded){this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block bx-viewer-file-center",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title}})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},style:{display:"none"},children:this.buttons});this.image=new Image();this.image.onload=BX.proxy(this.onLoad,this);this.image.src=this.src;this.image.className="bx-viewer-image";this.image.style.opacity=0;this.isProccessed=true;this.domElement=BX.create("div",{props:{className:"bx-viewer-cap-wrap"},children:[]})}return this.domElement};BX.CViewImageElement.prototype.hide=function(e){e=e||false;this.image.style.opacity=0;this.titleButtons.style.display="none";this.preventTimeout();this.preventShow=e?false:true};BX.CViewImageElement.prototype.show=function(){if(!this.domElement){return}var e=this.height;if(this.image&&this.image.style.height){e=parseInt(this.image.style.height)}if(e<this._minHeight){BX.adjust(this.domElement,{style:{paddingTop:(this._minHeight-e)/2+"px"}})}this.titleButtons.style.display="block";this.image.style.opacity=1;this.preventShow=false};BX.CViewImageElement.prototype.successLoad=function(e){};BX.CViewImageElement.prototype.onLoad=function(){this.isProccessed=false;setTimeout(BX.delegate(function(){this.loaded=true;this.height=this.image.height;this.width=this.image.width;this.image.style.maxWidth=this.width+"px";this.image.style.maxHeight=this.height+"px";this.domElement.appendChild(this.image);this.successLoad(this)},this),150)};BX.CViewImageElement.prototype.getBottomHtml=function(){if(!this.full){return""}var f=[];if(this.full_height&&this.full_width){f.push(this.full_width+"x"+this.full_height)}if(this.full_size){f.push(this.full_size)}var e='<a href="'+this.full+'" class="bx-viewer-full-link" target="_blank">'+BX.message("JS_CORE_IMAGE_FULL")+(f.length>0?(" ("+f.join(", ")+")"):"")+"</a>";return e};BX.CViewEditableElement=function(e){BX.CViewEditableElement.superclass.constructor.apply(this,arguments);this.askConvert=!!e.askConvert;this.editUrl=e.editUrl?this.addToLinkSessid(e.editUrl):"";this.lockedBy=e.lockedBy;this.fakeEditUrl=e.fakeEditUrl||false;this.historyPageUrl=e.historyPageUrl||"";this.downloadUrl=e.downloadUrl||"";this.dataForCommit={};this.urlToPost=e.urlToPost||"";this.idToPost=e.idToPost||"";this.isNowConverted=false;this.version=parseInt(e.version)||0;this.hideEdit=(e.hideEdit==1);this.dateModify=e.dateModify;this.currentModalWindow=e.currentModalWindow||false;this.editInProcess=false};BX.extend(BX.CViewEditableElement,BX.CViewCoreElement);BX.CViewEditableElement.prototype.runAction=function(e,f){this.editInProcess=false;e=e.toLowerCase();switch(e){case"discard":this.discardFile(f);break;case"edit":if(!this.editUrl){return false}this.addTimeoutId(setTimeout(function(){BX.fireEvent(BX("bx-viewer-edit-btn"),"click")},100));break;case"forceedit":if(!!BX.message("disk_document_service")&&BX.CViewer.isLocalEditService(BX.message("disk_document_service"))&&BX.CViewer.isEnableLocalEditInDesktop()){this.localEditProcess(f.obElementViewer);return}if(!this.editUrl||!f.obElementViewer){return false}if(BX.CViewer.enableInVersionDisk(2)&&!this.hasOwnProperty("imageElement")){if(!BX.message("disk_document_service")){return}}this.editFile(f.obElementViewer);break;case"localedit":this.localEditProcess(f.obElementViewer,f);break;case"localview":if(!f.obElementViewer){return false}this.localViewProcess(f.obElementViewer);break;case"commit":this.commitFile(f);break;case"create":if(!f.obElementViewer){return false}if(BX.CViewer.enableInVersionDisk(2)&&!this.hasOwnProperty("image")){if(!BX.message("disk_document_service")){f.obElementViewer.openWindowForSelectDocumentService({viewInUf:!!BX.message.disk_render_uf});return}}this.createFile(f.obElementViewer);break;case"saveas":case"save":if(!f.obElementViewer){return false}this.saveFile(f);break;case"pasteinform":this.pasteInForm(f);break;case"rename":this.renameFile(f);break;case"submit":this.submitAction(f);break}return};BX.CViewEditableElement.prototype.createFile=function(e){return};BX.CViewEditableElement.prototype.submitAction=function(e){return};BX.CViewEditableElement.prototype.renameFile=function(e){return};BX.CViewEditableElement.prototype.pasteInForm=function(e){return};BX.CViewEditableElement.prototype.discardFile=function(f){var g=f.uriToDoc||b.getUrlDiscardFile(this.editUrl);var e=f.idDoc||f.id;if(!g||!e){return false}BX.ajax({method:"POST",dataType:"json",url:g,data:{discard:1,editSessionId:f.editSessionId,id:e,sessid:BX.bitrix_sessid()},onsuccess:function(){}})};BX.CViewEditableElement.prototype.getTextForSave=function(){return BX.message("JS_CORE_VIEWER_IFRAME_PROCESS_SAVE_DOC")};BX.CViewEditableElement.prototype.isConverted=function(){if(this.isNowConverted){return true}return !!BX.CViewer._convertElementsMatch[this.src]};BX.CViewEditableElement.prototype.getExtensionAfterConvert=function(){var f=this.getExtension(this.title);var e="";switch(f.toLowerCase()){case"ppt":case"pptx":e="pptx";break;case"doc":case"docx":e="docx";break;case"xls":case"xlsx":e="xlsx";break}return e};BX.CViewEditableElement.prototype.editFile=function(e){this.editInProcess=true;if((
/*!this.isFromUserLib || */
!BX.CViewer.isLocalEditService(e.initEditService()))&&this.askConvert){var f=BX.create("div",{props:{className:"bx-viewer-confirm"},children:[BX.create("div",{props:{className:"bx-viewer-confirm-title"},text:BX.message("JS_CORE_VIEWER_CONVERT_TITLE").replace("#NEW_FORMAT#",this.getExtensionAfterConvert()),children:[]}),BX.create("div",{props:{className:"bx-viewer-confirm-text-wrap"},children:[BX.create("span",{props:{className:"bx-viewer-confirm-text-alignment"}}),BX.create("span",{props:{className:"bx-viewer-confirm-text"},text:BX.message("JS_CORE_VIEWER_IFRAME_CONVERT_TO_NEW_FORMAT_EX").replace("#NEW_FORMAT#",this.getExtensionAfterConvert()).replace("#OLD_FORMAT#",this.getExtension(this.title))})]})]});e.openConfirm(f,[new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_CONVERT_ACCEPT"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){this.editFileProcess(e)},this)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_CONVERT_DECLINE"),events:{click:BX.delegate(function(){this.closeConfirm();this.editInProcess=false},e)}})],true)}else{this.editFileProcess(e)}};BX.CViewEditableElement.prototype.getCurrentModalWindow=function(){return this.currentModalWindow};BX.CViewEditableElement.prototype.setCurrentModalWindow=function(e){this.currentModalWindow=e};BX.CViewEditableElement.prototype.openEditConfirm=function(e){var f=BX.create("div",{props:{className:"bx-viewer-confirm"},children:[BX.create("div",{props:{className:"bx-viewer-confirm-title"},text:BX.message("JS_CORE_VIEWER_NOW_EDITING_IN_SERVICE").replace("#SERVICE#",e.getNameEditService()),children:[]}),BX.create("div",{props:{className:"bx-viewer-confirm-text-wrap"},children:[BX.create("span",{props:{className:"bx-viewer-confirm-text-alignment"}}),BX.create("span",{props:{className:"bx-viewer-confirm-text"},text:BX.message("JS_CORE_VIEWER_IFRAME_DESCR_SAVE_DOC_F").replace("#SAVE_DOC#",BX.message("JS_CORE_VIEWER_IFRAME_SAVE_DOC"))})]})]});e.openConfirm(f,[new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_SAVE_DOC"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){window.onbeforeunload=null;this.showLoading({text:this.getCurrent().getTextForSave()});var g=this.getCurrent().getDataForCommit();g.obElementViewer=this;g.success=BX.delegate(function(j,i){if(this.bVisible&&this.isCurrent(j)){if(j.getLastVersionUri){BX.ajax({method:"POST",dataType:"json",url:j.getLastVersionUri,data:{sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(l){if(l.version){j.version=l.version}if(l.editUrl){j.editUrl=l.editUrl}if(l.src){j.src=l.src}if(j.iframeSrc){if(l.iframeSrc){j.iframeSrc=l.iframeSrc}var m=this.createIframeElementFromAjaxElement(j);m.setCurrentModalWindow(j.getCurrentModalWindow());this.getCurrent().hide();this.setCurrent(m);this.show()}else{this.show(j,true)}},this)})}else{if(j.iframeSrc){var k=this.createIframeElementFromAjaxElement(j);k.setCurrentModalWindow(j.getCurrentModalWindow());this.getCurrent().hide();this.setCurrent(k);this.show()}else{this.show(j,true)}}}},this);this.runActionByCurrentElement("commit",g);this.closeConfirm();try{this.getCurrent().getCurrentModalWindow().close()}catch(h){}},e)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_CANCEL"),events:{click:BX.delegate(function(){window.onbeforeunload=null;this.runActionByCurrentElement("discard",this.getCurrent().getDataForCommit());this.closeConfirm();try{this.getCurrent().getCurrentModalWindow().close()}catch(g){}},e)}})],true)};BX.CViewEditableElement.prototype.editFileProcess=function(e){var f=this.editUrl;if(BX.CViewer.temporaryServiceEditDoc){f=this.addToLinkParam(this.editUrl,"editIn",BX.CViewer.temporaryServiceEditDoc);if(BX.CViewer.isLocalEditService(BX.CViewer.temporaryServiceEditDoc)){this.localEditProcess(e,{});BX.CViewer.temporaryServiceEditDoc="";return false}f=b.getUrlEditFile(f,BX.CViewer.temporaryServiceEditDoc);BX.CViewer.temporaryServiceEditDoc=""}else{if(BX.CViewer.isLocalEditService(e.initEditService())){this.localEditProcess(e,{});return false}else{if(!this.isFromUserLib&&BX.CViewer.isLocalEditService(e.initEditService())){e.setEditService("g");f=this.addToLinkParam(this.editUrl,"editIn","g")}}}this.setCurrentModalWindow(e.openModal(f,this.title));window.onbeforeunload=BX.delegate(this.onUnload,this);this.openEditConfirm(e);return false};BX.CViewEditableElement.prototype.onUnload=function(){try{this.runAction("discard",this.getDataForCommit())}catch(f){}};BX.CViewEditableElement.prototype.setDataForCommit=function(f){if(f&&arguments.length==1){this.dataForCommit=f}else{if((BX.browser.IsIE()||BX.browser.IsIE11()||/Edge\/12./i.test(navigator.userAgent))){for(var e in arguments){if(!arguments.hasOwnProperty(e)){continue}switch(e){case 0:case"0":this.dataForCommit.iframeSrc=arguments[e];break;case 1:case"1":this.dataForCommit.uriToDoc=arguments[e];break;case 3:case"3":this.dataForCommit.editSessionId=arguments[e];break;case 4:case"4":this.dataForCommit.id=arguments[e];break;case 5:case"5":this.dataForCommit.link=arguments[e];break}}}}return};BX.CViewEditableElement.prototype.getDataForCommit=function(){return this.dataForCommit};BX.CViewEditableElement.prototype.commitFile=function(f){window.onbeforeunload=null;f=f||{};if(!f||!f.obElementViewer){return false}var g=f.uriToDoc||b.getUrlCommitFile(this.editUrl);var e=f.idDoc||f.id;if(!g||!e){return false}BX.ajax({method:"POST",dataType:"json",url:g,data:{commit:1,editSessionId:f.editSessionId,id:e,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(h){if(h.originalIsLocked){BX.CViewer.objNowInShow.close();BX.Disk.InformationPopups.showWarningLockedDocument({link:BX.Disk.getUrlToShowObjectInGrid(h.forkedObject.id)});return}var i=h.newName;var j=h.oldName;if(i){BX.CViewer._convertElementsMatch[this.src]={src:this.src.replace(j,i),editUrl:this.editUrl.replace(j,i),title:this.title.replace(j,i)};this.title=BX.CViewer._convertElementsMatch[this.src].title;this.editUrl=BX.CViewer._convertElementsMatch[this.src].editUrl;this.src=BX.CViewer._convertElementsMatch[this.src].src;this.isNowConverted=true}if(this.title.split(".").pop()=="xodt"&&BX.message.disk_document_service==="myoffice"){this.dateModify=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME")),new Date(),null)}if(BX.type.isFunction(f.success)){f.success(this,h)}BX.onCustomEvent(this,"onIframeElementConverted",[this,i,j])},this)});return false};BX.CViewBlankElement=function(e){BX.CViewBlankElement.superclass.constructor.apply(this,arguments);this.id="blank_file";this.editUrl=e.editUrl;this.fakeEditUrl=e.fakeEditUrl||false;this.renameUrl=e.renameUrl;this.docType=e.docType;this.elementId=false;this.sectionId=false;this.objectId=false;this.targetFolderId=e.targetFolderId||false;this.idDoc="";this.uriToDoc="";this.oldName="";this.newName="";this.docService="g";this.afterSuccessCreate=function(){}};BX.extend(BX.CViewBlankElement,BX.CViewEditableElement);BX.CViewBlankElement.prototype.discardFile=function(f){var g=f.editUrl;if(this.editUrl){g=b.getUrlDiscardFile(this.editUrl)}else{g=f.uriToDoc;if(!g){return false}g=this.addToLinkParam(g,"createDoc",1);g=this.addToLinkParam(g,"discard",1)}var e=f.idDoc||f.id;if(!g||!e){return false}BX.ajax({method:"POST",dataType:"json",url:g,data:{discard:1,editSessionId:f.editSessionId,id:e,sessid:BX.bitrix_sessid()},onsuccess:function(){}})};BX.CViewBlankElement.prototype.submitAction=function(e){if(BX("wd-btn-save-blank-with-new-name")){BX.fireEvent(BX("wd-btn-save-blank-with-new-name"),"click")}return};BX.CViewBlankElement.prototype.createFile=function(f){var g;this.docService=f.initEditService();if(this.editUrl){g=b.getUrlStartPublishBlank(this.editUrl,this.docService,this.docType);if(BX.CViewer.isLocalEditService(this.docService)){BX.ajax({method:"POST",dataType:"json",url:g,data:{targetFolderId:this.targetFolderId||"",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(i){if(!i){return}try{var j={status:"success",objectId:i.object.id,name:i.object.name,folderName:i.folderName,size:i.object.size,sizeInt:i.object.sizeInt,extension:i.object.extension,ext:i.object.extension,link:i.link}}catch(k){}this.title=i.object.name;this.editUrl=i.link;f.runActionByCurrentElement("localedit",{obElementViewer:f,isCreate:true});this.afterSuccessCreate(j)},this)});return}}else{g=this.addToLinkParam("/company/personal/user/"+BX.message("USER_ID")+"/files/lib/","createIn",f.initEditService());g=this.addToLinkParam(g,"toWDController",1);g=this.addToLinkParam(g,"type",this.docType);g=this.addToLinkParam(g,"createDoc","1");g=this.addToLinkSessid(g)}var h=f.openModal(g,this.title);var e=BX.create("div",{props:{className:"bx-viewer-confirm"},children:[BX.create("div",{props:{className:"bx-viewer-confirm-title"},text:BX.message("JS_CORE_VIEWER_NOW_CREATING_IN_SERVICE").replace("#SERVICE#",f.getNameEditService()),children:[]}),BX.create("div",{props:{className:"bx-viewer-confirm-text-wrap"},children:[BX.create("span",{props:{className:"bx-viewer-confirm-text-alignment"}}),BX.create("span",{props:{className:"bx-viewer-confirm-text"},text:BX.message("JS_CORE_VIEWER_CREATE_DESCR_SAVE_DOC_F").replace("#SAVE_AS_DOC#",BX.message("JS_CORE_VIEWER_SAVE_AS"))})]})]});BX.CViewer.lockScroll();f.openConfirm(e,[new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_SAVE_AS"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){BX.CViewer.showLoading(BX.findChild(e,{className:"bx-viewer-confirm-text-wrap"},true),{className:"bx-viewer-wrap-loading-modal",notAddClassLoadingToObj:true});if(BX.proxy_context&&BX.is_subclass_of(BX.proxy_context,BX.PopupWindowButton)){BX.proxy_context.setClassName("webform-button-accept webform-button-disable")}var k=BX.findChild(e,{className:"bx-viewer-confirm-title"},true);if(k){BX.adjust(k,{text:BX.message("JS_CORE_VIEWER_NOW_DOWNLOAD_FROM_SERVICE").replace("#SERVICE#",this.getNameEditService())})}var i=this.getCurrent().getDataForCommit();if(BX.CViewer.isEmptyObject(i)){this.closeConfirm();BX.CViewer.unlockScroll()}else{this.getCurrent().idDoc=i.idDoc||i.id;i.obElementViewer=this;i.success=BX.delegate(function(m,l){this.closeConfirm()},this);this.runActionByCurrentElement("saveAs",i)}try{h.close()}catch(j){}},f)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_CANCEL"),events:{click:BX.delegate(function(){this.runActionByCurrentElement("discard",this.getCurrent().getDataForCommit());this.closeConfirm();BX.CViewer.unlockScroll();try{h.close()}catch(i){}},f)}})],true);return false};BX.CViewBlankElement.prototype.saveFile=function(f){f=f||{};if(!f||!f.obElementViewer){return false}var g;var e=f.idDoc||f.id;if(this.editUrl){g=b.getUrlCommitBlank(this.editUrl,this.docType,this.targetFolderId)}else{g=BX.util.remove_url_param(f.uriToDoc,"editIn");if(!g||!e){return false}g=this.addToLinkParam(g,"proccess","1");g=this.addToLinkParam(g,"toWDController","1");g=this.addToLinkParam(g,"type",this.docType);g=this.addToLinkParam(g,"createIn",f.obElementViewer.initEditService());g=this.addToLinkParam(g,"createDoc","1");g=this.addToLinkParam(g,"commit","1");g=this.addToLinkParam(g,"id",e);g=this.addToLinkParam(g,"sessid",BX.bitrix_sessid())}BX.ajax({method:"POST",dataType:"json",url:g,data:{editSessionId:f.editSessionId,id:e,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(h){this.oldName=h.name;this.sectionId=h.sectionId;this.elementId=h.elementId;this.elementId=h.elementId;this.objectId=h.objectId;var i=BX.create("div",{props:{className:"bx-viewer-confirm"},children:[BX.create("div",{props:{className:"bx-viewer-confirm-title"},text:BX.message("JS_CORE_VIEWER_NOW_CREATING_IN_SERVICE").replace("#SERVICE#",f.obElementViewer.getNameEditService()),children:[]}),BX.create("div",{props:{className:"bx-viewer-confirm-text-wrap bx-viewer-confirm-center"},children:[BX.create("input",{props:{id:"wd-new-create-filename",className:"bx-viewer-inp",type:"text",value:h.nameWithoutExtension}}),BX.create("span",{props:{className:"bx-viewer-confirm-extension"},text:this.docType})]})]});BX.CViewer.lockScroll();f.obElementViewer.params.keyMap={13:"submitCurrentElement",27:"close"};f.obElementViewer._bindEvents();f.obElementViewer.openConfirm(i,[new BX.PopupWindowButton({id:"wd-btn-save-blank-with-new-name",text:BX.message("JS_CORE_VIEWER_SAVE"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){var j=BX("wd-new-create-filename").value;if(!j){BX.focus(BX("wd-new-create-filename"));return}BX.CViewer.showLoading(BX.findChild(i,{className:"bx-viewer-confirm-text-wrap"},true),{className:"bx-viewer-wrap-loading-modal",notAddClassLoadingToObj:true});this.runActionByCurrentElement("rename",{newName:j,data:h,success:BX.delegate(function(m,l){if(l&&l.newName&&l.newName!=m.name){m.name=l.newName;m.nameWithoutExtension=l.newName.split(".").pop()}this.runActionByCurrentElement("pasteInForm",{response:m});BX.CViewer.unlockScroll();f.obElementViewer._unbindEvents();this.closeConfirm()},this)});try{modalWindow.close()}catch(k){}},f.obElementViewer)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_CANCEL"),events:{click:BX.delegate(function(){this.runActionByCurrentElement("discard",this.getCurrent().getDataForCommit());BX.CViewer.unlockScroll();f.obElementViewer._unbindEvents();this.closeConfirm()},f.obElementViewer)}})],true)},this)});return false};BX.CViewBlankElement.prototype.renameFile=function(f){f=f||{};if(!f.newName||!this.oldName){return false}if(f.newName==this.oldName||f.newName+"."+this.docType==this.oldName){if(BX.type.isFunction(f.success)){f.success(f.data,{status:"success"})}return true}var e;if(this.renameUrl){e=b.getUrlRenameFile(this.renameUrl)}else{if(this.uriToDoc){e=this.addToLinkParam(this.uriToDoc,"action","rename")}else{e=this.addToLinkParam(f.data.link,"action","rename")}e=this.addToLinkParam(e,"proccess","1");e=this.addToLinkParam(e,"createDoc","1");e=this.addToLinkParam(e,"createIn",this.docService);e=this.addToLinkParam(e,"elementId",this.elementId);e=this.addToLinkParam(e,"sectionId",this.sectionId);e=this.addToLinkParam(e,"rename",1);e=this.addToLinkParam(e,"toWDController",1);e=this.addToLinkParam(e,"newName",f.newName+"."+this.docType);e=this.addToLinkParam(e,"sessid",BX.bitrix_sessid())}BX.ajax({method:"POST",dataType:"json",url:e,data:{objectId:this.objectId,newName:f.newName+"."+this.docType,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(g){if(BX.type.isFunction(f.success)){f.success(f.data,g)}},this)});return true};BX.CViewBlankElement.prototype.pasteInForm=function(e){e=e||{};this.afterSuccessCreate(e.response);return};BX.CViewIframeElement=function(e){BX.CViewIframeElement.superclass.constructor.apply(this,arguments);this.width=850;this._minWidth=850;this.height=700;this._minHeight=700;this.topPadding=43;this.viewerUrl="";this.autoReduction=true;this.autoReductionWidth=350;this.pdfFallback=e.pdfFallback;this.previewImage=e.previewImage;this.transformTimeout=e.transformTimeout||0;this.getLastVersionUri=e.getLastVersionUri};BX.extend(BX.CViewIframeElement,BX.CViewEditableElement);BX.CViewIframeElement.prototype.load=function(f,g){if(!this.loaded){var e=BX.proxy(function(){BX.ajax({method:"POST",dataType:"json",url:this.src,data:{sessid:BX.bitrix_sessid(),json:1},onsuccess:BX.delegate(function(i){BX.onCustomEvent(this,"onIframeElementLoadDataToView",[this,i]);if(i&&i.viewerType==="ajax"){BX.onCustomEvent(this,"onIframeElementCreateAjaxElement",[this,i.viewerParams]);return}if(i&&i.viewerType==="local"){BX.onCustomEvent(this,"onIframeElementPerformLocalAction",[this]);return}if(i&&(i.error||i.status==="error")){if(BX.type.isFunction(g)){g(this,i)}return}if(i&&i.status==="restriction"){return}if(i&&i.authUrlOpenerMode){BX.removeClass(this.contentWrap,"bx-viewer-wrap-loading");this.contentWrap.innerHTML='<div style="font-weight: bold;font-size: 17px;padding: 20px 25px;">'+BX.message("JS_CORE_VIEWER_SHOW_FILE_DIALOG_OAUTH_NOTICE").replace("#SERVICE#",i.serviceName)+"</div>";BX.bind(BX("bx-js-disk-run-oauth-modal"),"click",function(k){BX.util.popup(i.authUrlOpenerMode,1030,700);BX.PreventDefault(k);return false});BX.bind(window,"hashchange",BX.proxy(function(){var k=document.location.hash.match(/external-auth-(\w+)/);if(!k){return}BX.CViewer.objNowInShow.show(this,true)},this));return}var h=function(){};if(i.neededCheckView!==undefined&&i.neededCheckView){h=BX.delegate(function(){if(BX.localStorage.get("iframe_options_error")){BX.onCustomEvent(this,"onIframeDocError",[this]);return}if(BX.localStorage.get("iframe_options_error")!==null){return}BX.ajax({method:"POST",dataType:"json",url:b.getUrlCheckView(this.src),data:{extLink:i.file,sessid:BX.bitrix_sessid(),checkViewByGoogle:1,id:i.id},onsuccess:BX.delegate(function(k){if(!k||(k.viewed===undefined&&!k.viewByGoogle||k.viewByGoogle===undefined&&!k.viewed)){BX.onCustomEvent(this,"onIframeDocError",[this])}else{BX.onCustomEvent(this,"onIframeDocSuccess",[this])}},this)})},this)}if(BX.localStorage.get("iframe_options_error")){BX.onCustomEvent(this,"onIframeDocError",[this]);return}if(i.neededOpenWindow){window.open(i.viewUrl,"_blank");this.domElement=BX.create("span")}else{this.domElement=BX.create("iframe",{props:{className:"bx-viewer-image",src:i.viewUrl||i.viewerUrl},events:{load:!BX.CViewer.browserWithDeferredCheckIframeError()?BX.proxy(function(){BX.proxy(this.onLoad,this);h()},this):BX.proxy(this.onLoad,this)},style:{border:"none"}})}var j=BX.findChildByClassName(this.contentWrap,"bx-viewer-file-transformation-in-process-message");if(j){j.remove()}this.contentWrap.appendChild(this.domElement);this.viewUrl=i.viewUrl||i.viewerUrl;if(BX.localStorage.get("iframe_options_error")){BX.onCustomEvent(this,"onIframeDocError",[this])}else{if(BX.CViewer.browserWithDeferredCheckIframeError()&&BX.localStorage.get("iframe_options_error")===null){this.addTimeoutId(setTimeout(h,15000))}else{this.addTimeoutId(setTimeout(BX.proxy(function(){try{if(!!this.domElement.contentDocument&&this.domElement.contentDocument.URL=="about:blank"){BX.onCustomEvent(this,"onIframeDocError",[this])}}catch(k){}},this),15000))}}},this)})},this);if(this.transformTimeout>0){this.contentWrap.innerHTML='<div class="bx-viewer-file-transformation-in-process-message" style="text-align: center;margin-top: 50%;">'+BX.message("JS_CORE_VIEWER_TRANSFORMATION_IN_PROCESS")+"</div>";setTimeout(e,(this.transformTimeout*1000))}else{e()}this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title,alt:this.title},text:this.version?BX.message("JS_CORE_VIEWER_THROUGH_VERSION").replace("#NUMBER#",this.version>0?this.version:""):BX.message("JS_CORE_VIEWER_THROUGH_LAST_VERSION")})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},style:{},children:this.buttons});this.successLoad=f||BX.CViewIframeElement.prototype.successLoad;this.isProccessed=true}};BX.CViewIframeElement.prototype.preload=function(e){return false};BX.CViewIframeElement.prototype.onLoad=function(){if(this.loaded){return}this.loaded=true;this.successLoad(this)};BX.CViewIframeElement.prototype.show=function(){this.domElement.style.opacity=1;this.domElement.style.display="block";this.preventShow=false};BX.CViewIframeElement.prototype.hide=function(e){e=e||false;if(this.domElement){this.domElement.style.opacity=0;BX.unbind(this.domElement,"load",BX.proxy(this.onLoad,this))}this.preventTimeout();this.loaded=false;this.preventShow=false;this.isProccessed=false};BX.CViewAjaxElement=function(e){BX.CViewAjaxElement.superclass.constructor.apply(this,arguments);this.width=e.width||900;this._minWidth=e.width||900;this.height=e.height||700;this._minHeight=e.height||700;this.topPadding=43;this.viewerUrl="";this.autoReduction=true;this.autoReductionWidth=350;this.pdfFallback=e.pdfFallback;this.full=this.pdfFallback;this.iframeSrc=e.iframeSrc;this.transformTimeout=e.transformTimeout;this.wrapClassName="";this.image=null;this.getLastVersionUri=e.getLastVersionUri};BX.extend(BX.CViewAjaxElement,BX.CViewEditableElement);BX.CViewAjaxElement.prototype.load=function(f){var e=this;if(!this.loaded){BX.ajax({method:"GET",dataType:"json",url:e.src,data:{sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(j){if(!j||(!j.html)){j=j||{};if(!j.message||j.message.length==0){if(!!j.status&&j.status==="denied"){j.message=BX.message("JS_CORE_VIEWER_AJAX_ACCESS_DENIED")}else{if(j.errors&&BX.type.isArray(j.errors)){j.message="";for(var h in j.errors){j.message+=j.errors[h].message+" "}}}}this.errorMessage=j.message;BX.onCustomEvent(e,"onAjaxElementError",[this]);return}else{if(j.wrapClassName&&this.contentWrap.parentNode.parentNode){this.wrapClassName=j.wrapClassName;BX.addClass(this.contentWrap.parentNode.parentNode,j.wrapClassName)}var g=BX.processHTML(j.html);if(!!j.innerElementId){this.innerElementId=j.innerElementId;BX.addCustomEvent("onElementViewClose",BX.delegate(function(){var i;if((typeof videojs!=="undefined")&&(i=BX(this.innerElementId))){videojs(i.id).pause()}},this))}this.domElement=BX.create("div",{props:{className:"bx-viewer-image"},style:{border:"none"},html:g.HTML});this.contentWrap.appendChild(this.domElement);if(!!g.SCRIPT){BX.ajax.processScripts(g.SCRIPT)}}},this),onfailure:BX.delegate(function(){this.errorMessage=BX.message("JS_CORE_VIEWER_AJAX_CONNECTION_FAILED");BX.onCustomEvent(e,"onAjaxElementError",[e]);return},this)});this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title,alt:this.title},text:this.version?BX.message("JS_CORE_VIEWER_THROUGH_VERSION").replace("#NUMBER#",this.version>0?this.version:""):BX.message("JS_CORE_VIEWER_THROUGH_LAST_VERSION")})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},style:{},children:this.buttons});this.successLoad=f||BX.CViewIframeElement.prototype.successLoad;this.isProccessed=true}};BX.CViewAjaxElement.prototype.preload=function(e){return false};BX.CViewAjaxElement.prototype.onLoad=function(){if(this.loaded){return}this.loaded=true;this.successLoad(this)};BX.CViewAjaxElement.prototype.show=function(){this.domElement.style.opacity=1;this.domElement.style.display="block";this.preventShow=false};BX.CViewAjaxElement.prototype.hide=function(e){if(this.wrapClassName){BX.removeClass(this.contentWrap.parentNode.parentNode,this.wrapClassName)}e=e||false;if(this.domElement){this.domElement.style.opacity=0;BX.unbind(this.domElement,"load",BX.proxy(this.onLoad,this))}this.preventTimeout();this.loaded=false;this.preventShow=false;this.isProccessed=false};BX.CViewAjaxElement.prototype.getBottomHtml=function(){if(!this.full){return""}var e='<a href="'+this.full+'" class="bx-viewer-full-link" target="_blank">'+BX.message("JS_CORE_VIEWER_AJAX_OPEN_NEW_TAB")+"</a>";return e};BX.CViewWithoutPreviewEditableElement=function(e){BX.CViewWithoutPreviewEditableElement.superclass.constructor.apply(this,arguments);this.width=600;this._minWidth=600;this.height=350;this._minHeight=350;this.owner=e.owner;this.dateModify=e.dateModify;this.size=e.size;this.topPadding=43;this.tooBigSizeMsg=!!e.tooBigSizeMsg;this.autoReduction=true;this.autoReductionWidth=175};BX.extend(BX.CViewWithoutPreviewEditableElement,BX.CViewEditableElement);BX.CViewWithoutPreviewEditableElement.prototype.load=function(e){if(this.loaded){return}this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title,alt:this.title},text:this.version?BX.message("JS_CORE_VIEWER_THROUGH_VERSION").replace("#NUMBER#",this.version>0?this.version:""):BX.message("JS_CORE_VIEWER_THROUGH_LAST_VERSION")})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},children:this.buttons});var f=this.src;this.domElement=BX.create("div",{props:{className:"bx-viewer-cap-wrap bx-viewer-cap-file"},children:[(BX.create("div",{props:{},children:[(BX.create("div",{props:{className:"bx-viewer-icon "+this.getIconClassByName(this.title)}})),(BX.create("div",{props:{className:"bx-viewer-cap-text-block"},children:[(BX.create("div",{props:{className:"bx-viewer-cap-title",title:this.title},text:this.title})),(BX.create("div",{props:{className:"bx-viewer-too-big-title"},style:{display:this.tooBigSizeMsg?"":"none"},text:BX.message("JS_CORE_VIEWER_TOO_BIG_FOR_VIEW")})),(BX.create("div",{props:{className:"bx-viewer-cap-text"},html:'<span class="bx-viewer-cap-text-title">'+BX.message("JS_CORE_VIEWER_DESCR_AUTHOR")+": </span> "+BX.util.htmlspecialchars(this.owner)+'<br/><span class="bx-viewer-cap-text-title">'+BX.message("JS_CORE_VIEWER_DESCR_LAST_MODIFY")+": </span> "+BX.util.htmlspecialchars(this.dateModify)+"<br/>"+this.size})),(BX.create("span",{props:{className:"bx-viewer-btn"},events:{click:BX.delegate(function(g){document.location.href=this.downloadUrl;return false},this)},text:BX.message("JS_CORE_VIEWER_DOWNLOAD")}))]}))]}))]});this.successLoad=e||BX.CViewUnknownElement.prototype.successLoad;this.contentWrap.appendChild(this.domElement);this.loaded=true;this.successLoad(this)};BX.CViewWithoutPreviewEditableElement.prototype.preload=function(e){};BX.CViewWithoutPreviewEditableElement.prototype.onLoad=function(){};BX.CViewWithoutPreviewEditableElement.prototype.show=function(){this.domElement.style.opacity=1;this.domElement.style.display="block";this.titleButtons.style.display="block";this.preventShow=false};BX.CViewWithoutPreviewEditableElement.prototype.hide=function(e){e=e||false;this.domElement.style.opacity=0;this.titleButtons.style.display="none";this.preventTimeout();this.loaded=false;this.preventShow=false;this.isProccessed=false};BX.CViewIframeExtLinksElement=function(e){BX.CViewIframeExtLinksElement.superclass.constructor.apply(this,arguments);this.width=800;this._minWidth=800;this.height=600;this._minHeight=600;this.topPadding=43;this.viewerUrl=e.viewerUrl;this.askConvert=false;this.editUrl=false};BX.extend(BX.CViewIframeExtLinksElement,BX.CViewIframeElement);BX.CViewIframeExtLinksElement.prototype.load=function(g){var f=this;if(!this.loaded){var e=function(){if(BX.localStorage.get("iframe_options_error")){BX.onCustomEvent(f,"onIframeDocError",[f]);return}if(BX.localStorage.get("iframe_options_error")!==null){return}BX.ajax({method:"POST",dataType:"json",url:f.src,data:{sessid:BX.bitrix_sessid(),checkViewByGoogle:1},onsuccess:function(h){if(!h||!h.viewByGoogle){BX.onCustomEvent(f,"onIframeDocError",[f])}else{BX.onCustomEvent(f,"onIframeDocSuccess",[f])}}})};this.domElement=BX.create("iframe",{props:{className:"bx-viewer-image",src:this.viewerUrl},events:{load:!BX.CViewer.browserWithDeferredCheckIframeError()?BX.proxy(function(){BX.proxy(this.onLoad,this);e()},f):BX.proxy(f.onLoad,f)},style:{border:"none"}});this.contentWrap.appendChild(this.domElement);if(BX.localStorage.get("iframe_options_error")){BX.onCustomEvent(this,"onIframeDocError",[this])}else{if(BX.CViewer.browserWithDeferredCheckIframeError()&&BX.localStorage.get("iframe_options_error")===null){this.addTimeoutId(setTimeout(e,15000))}}this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title}})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},style:{},children:this.buttons});this.successLoad=g||BX.CViewIframeExtLinksElement.prototype.successLoad;this.isProccessed=true}};BX.CViewIframeExtLinksElement.prototype.commitFile=function(e){return false};BX.CViewErrorIframeElement=function(e){BX.CViewErrorIframeElement.superclass.constructor.apply(this,arguments);this.width=600;this._minWidth=600;this.height=350;this._minHeight=350;this.topPadding=43;this.buttonUrl=e.buttonUrl;this.autoReduction=true;this.autoReductionWidth=175;this.pdfFallback=e.pdfFallback;if(!e.errorDescription){this.errorDescription=(BX.create("div",{props:{className:"bx-viewer-cap-text-block"},children:[(BX.create("div",{props:{className:"bx-viewer-cap-title",title:this.title},text:BX.message("JS_CORE_VIEWER_IFRAME_ERROR_TITLE")})),BX.create("div",{props:{className:"bx-viewer-too-big-title"},text:BX.message("JS_CORE_VIEWER_SERVICE_LOCAL_INSTALL_DESKTOP")}),BX.create("a",{props:{className:"bx-viewer-btn"},events:{click:BX.delegate(function(f){document.location.href=(BX.browser.IsMac()?"http://dl.bitrix24.com/b24/bitrix24_desktop.dmg":"http://dl.bitrix24.com/b24/bitrix24_desktop.exe");return false},this)},text:BX.message("JS_CORE_VIEWER_DOWNLOAD_B24_DESKTOP_FULL")}),BX.create("span",{props:{className:"bx-viewer-btn"},events:{click:BX.delegate(function(f){document.location.href=this.downloadUrl;return false},this)},text:BX.message("JS_CORE_VIEWER_DOWNLOAD_DOCUMENT")})]}))}else{this.errorDescription=e.errorDescription}};BX.extend(BX.CViewErrorIframeElement,BX.CViewEditableElement);BX.CViewErrorIframeElement.prototype.load=function(e){this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title,alt:this.title},text:this.version?BX.message("JS_CORE_VIEWER_THROUGH_VERSION").replace("#NUMBER#",this.version>0?this.version:""):BX.message("JS_CORE_VIEWER_THROUGH_LAST_VERSION")})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},children:this.buttons});this.domElement=BX.create("div",{props:{className:"bx-viewer-cap-wrap bx-viewer-cap-file"},children:[(BX.create("div",{props:{},children:[(BX.create("div",{props:{className:"bx-viewer-icon "+this.getIconClassByName(this.title)}})),this.errorDescription]}))]});this.successLoad=e||BX.CViewUnknownElement.prototype.successLoad;this.contentWrap.appendChild(this.domElement);this.loaded=true;this.successLoad(this)};BX.CViewErrorIframeElement.prototype.show=function(){this.domElement.style.opacity=1;this.domElement.style.display="block";this.titleButtons.style.display="block";this.preventShow=false};BX.CViewErrorIframeElement.prototype.hide=function(){this.domElement.style.opacity=0;this.preventTimeout();this.loaded=false;this.preventShow=false;this.isProccessed=false};BX.CViewUnknownElement=function(e){BX.CViewUnknownElement.superclass.constructor.apply(this,arguments);this.width=600;this._minWidth=600;this.height=350;this._minHeight=350;this.owner=e.owner;this.dateModify=e.dateModify;this.size=e.size;this.topPadding=43;this.tooBigSizeMsg=!!e.tooBigSizeMsg};BX.extend(BX.CViewUnknownElement,BX.CViewCoreElement);BX.CViewUnknownElement.prototype.load=function(e){if(this.loaded){return}this.titleDomElement=BX.create("span",{props:{className:"bx-viewer-file-name-block bx-viewer-file-center",title:this.title},children:[BX.create("span",{props:{className:"bx-viewer-file-name",title:this.title},text:this.title}),BX.create("span",{props:{className:"bx-viewer-file-last-v",title:this.title}})]});this.titleButtons=BX.create("span",{props:{className:"bx-viewer-top-right"},children:this.buttons});var f=this.src;this.domElement=BX.create("div",{props:{className:"bx-viewer-cap-wrap bx-viewer-cap-file"},children:[(BX.create("div",{props:{},children:[(BX.create("div",{props:{className:"bx-viewer-icon "+this.getIconClassByName(this.title)}})),(BX.create("div",{props:{className:"bx-viewer-cap-text-block"},children:[(BX.create("div",{props:{className:"bx-viewer-cap-title",title:this.title},text:this.title})),(BX.create("div",{props:{className:"bx-viewer-too-big-title"},style:{display:this.tooBigSizeMsg?"":"none"},text:BX.message("JS_CORE_VIEWER_TOO_BIG_FOR_VIEW")})),(BX.create("div",{props:{className:"bx-viewer-cap-text"},html:'<span class="bx-viewer-cap-text-title">'+BX.message("JS_CORE_VIEWER_DESCR_AUTHOR")+": </span> "+BX.util.htmlspecialchars(this.owner)+'<br/><span class="bx-viewer-cap-text-title">'+BX.message("JS_CORE_VIEWER_DESCR_LAST_MODIFY")+": </span> "+BX.util.htmlspecialchars(this.dateModify)+"<br/>"+this.size})),(BX.create("span",{props:{className:"bx-viewer-btn"},events:{click:function(g){document.location.href=f;return false}},text:BX.message("JS_CORE_VIEWER_DOWNLOAD")}))]}))]}))]});this.successLoad=e||BX.CViewUnknownElement.prototype.successLoad;this.contentWrap.appendChild(this.domElement);this.loaded=true;this.successLoad(this)};BX.CViewUnknownElement.prototype.preload=function(e){};BX.CViewUnknownElement.prototype.onLoad=function(){};BX.CViewUnknownElement.prototype.show=function(){this.domElement.style.opacity=1;this.domElement.style.display="block";this.titleButtons.style.display="block";this.preventShow=false};BX.CViewUnknownElement.prototype.hide=function(e){e=e||false;if(this.loaded){this.domElement.style.opacity=0;this.titleButtons.style.display="none"}this.preventTimeout();this.loaded=false;this.preventShow=false;this.isProccessed=false};BX.CViewFolderElement=function(e){BX.CViewFolderElement.superclass.constructor.apply(this,arguments);this.width=600;this._minWidth=600;this.height=350;this._minHeight=350;this.owner=e.owner;this.dateModify=e.dateModify;this.size=e.size;this.topPadding=0;this.showTitle=false};BX.extend(BX.CViewFolderElement,BX.CViewCoreElement);BX.CViewFolderElement.prototype.load=function(e){if(this.loaded){return}this.titleDomElement=null;this.titleButtons=null;this.domElement=BX.create("div",{props:{className:"bx-viewer-cap-wrap bx-viewer-folder"},children:[(BX.create("div",{props:{className:"bx-viewer-cap"},children:[(BX.create("div",{props:{className:"bx-viewer-icon"}})),(BX.create("div",{props:{className:"bx-viewer-cap-text-block"},children:[(BX.create("div",{props:{className:"bx-viewer-cap-title",title:this.title},text:this.title})),(BX.create("div",{props:{className:"bx-viewer-cap-text"},html:BX.message("JS_CORE_VIEWER_DESCR_AUTHOR")+": "+BX.util.htmlspecialchars(this.owner)+"<br/>"+BX.message("JS_CORE_VIEWER_DESCR_LAST_MODIFY")+": "+BX.util.htmlspecialchars(this.dateModify)+"<br/>"}))]}))]}))]});this.contentWrap.appendChild(this.domElement);this.loaded=true};BX.CViewFolderElement.prototype.preload=function(e){};BX.CViewFolderElement.prototype.onLoad=function(){};BX.CViewFolderElement.prototype.show=function(){this.domElement.style.opacity=1;this.domElement.style.display="block";this.preventShow=false};BX.CViewFolderElement.prototype.hide=function(e){e=e||false;this.domElement.style.opacity=0;this.preventTimeout();this.loaded=false;this.preventShow=false;this.isProccessed=false};BX.CViewer=function(f){this.params=BX.clone(BX.CViewer.defaultSettings);for(var e in f){this.params[e]=f[e]}this.DIV=null;this.OVERLAY=null;this.CONTENT_WRAP=null;this.list=this.params.list;this._current=0;this._currentEl=null;this.FULL_TITLE=null;this.bVisible=false;this.createDoc=this.params.createDoc||false;this.preload=0;this.currentElement=null;this.popupConfirm=null;this.popupMenu=null};BX.CViewer.temporaryServiceEditDoc="";BX.CViewer._convertElementsMatch={};BX.CViewer.rightNowRunActionAfterShow="";BX.CViewer.objNowInShow=false;BX.CViewer.isDisabledLocalEdit=false;BX.CViewer.localChangeServiceEdit=false;BX.CViewer.listPopupId=[];BX.CViewer.defaultSettings={list:[],cycle:true,resize:"WH",resizeToggle:false,showTitle:true,preload:0,minMargin:20,minPadding:11,lockScroll:true,keyMap:{13:"submitCurrentElement",27:"close",33:"prev",37:"prev",38:"prev",34:"next",39:"next",40:"next",32:"next"}};BX.CViewer.goToBx=function(e){if(!!BX.desktopUtils){BX.desktopUtils.goToBx(e);return}location.href=e};BX.CViewer.browserWithDeferredCheckIframeError=function(){if(BX.browser.IsFirefox()){return false}if(BX.browser.IsChrome()&&window.navigator&&window.navigator.appVersion){return parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10)<28}return true};BX.CViewer.enableInVersionDesktop=function(e){return typeof(BXIM)!=="undefined"&&!BXIM.desktop.ready()&&BXIM.desktopVersion>=parseInt(e)};BX.CViewer.enableInVersionDisk=function(e){var f=BX.message.disk_revision_api;if(!f){f=0}f=parseInt(f,10);return f>=parseInt(e,10)};BX.CViewer.disableLocalEdit=function(){BX.CViewer.isDisabledLocalEdit=true};BX.CViewer.isEnableLocalEditInDesktop=function(){if(BX.CViewer.isDisabledLocalEdit){return false}return BX.CViewer.enableInVersionDesktop(21)&&(!!BX.message("wd_desktop_disk_is_installed")||(typeof(BXIM)!=="undefined"&&BXIM.desktopStatus))};BX.CViewer.hasLockScroll=function(){return BX.hasClass(document.body,"bx-viewer-lock-scroll")};BX.CViewer.lockScroll=function(){BX.addClass(document.body,"bx-viewer-lock-scroll")};BX.CViewer.unlockScroll=function(){BX.removeClass(document.body,"bx-viewer-lock-scroll")};BX.CViewer.getMsgAfterUploadNewVersionByUser=function(){var e=BX.message("wd_gender_current_user");switch(e){case"f":case"F":return BX.message("JS_CORE_VIEWER_IFRAME_UPLOAD_NEW_VERSION_IN_COMMENT_F");break;case"m":case"M":return BX.message("JS_CORE_VIEWER_IFRAME_UPLOAD_NEW_VERSION_IN_COMMENT_M");break}return BX.message("JS_CORE_VIEWER_IFRAME_UPLOAD_NEW_VERSION_IN_COMMENT")};BX.CViewer.getWindowCopyToDisk=function(h){var f=h.link;var e=BX.create("div",{props:{className:"bx-viewer-alert"},children:[BX.create("span",{props:{className:"bx-viewer-alert-icon"},children:[BX.create("img",{props:{src:"/bitrix/js/main/core/images/yell-waiter.gif"}})]}),BX.create("span",{props:{className:"bx-viewer-aligner"}}),BX.create("span",{props:{className:"bx-viewer-alert-text"},html:BX.message("JS_CORE_VIEWER_DESCR_PROCESS_SAVE_FILE_TO_OWN_FILES").replace("#NAME#",'<a href="#" class="bx-viewer-file-link">'+h.title+"</a>")}),BX.create("a",{props:{className:"bx-viewer-alert-close-icon",href:"#"},events:{click:function(j){if(h.selfViewer){h.selfViewer.closeConfirm()}else{BX.CViewer.unlockScroll();BX.PopupWindowManager.getCurrentPopup().destroy()}BX.PreventDefault(j);return false}}})]});BX.CViewer.lockScroll();if(h.selfViewer){h.selfViewer.openConfirm(e,[],true,null,{windowName:"-copy",className:"bx-viewer-alert-popup"})}else{var i={content:e,onPopupClose:function(){this.destroy()},closeByEsc:h.closeByEsc||false,autoHide:h.autoHide||false,overlay:true,zIndex:10200,className:"bx-viewer-alert-popup"};var g=BX.PopupWindowManager.create("bx-gedit-convert-confirm-copy",null,i);g.show()}BX.ajax.loadJSON(f,{sessid:BX.bitrix_sessid()},function(j){if(typeof(item)=="object"&&j.status!="success"){return}var l=BX.create("div",{props:{className:"bx-viewer-alert"},children:[BX.create("span",{props:{className:"bx-viewer-alert-icon"},children:[BX.create("img",{props:{src:"/bitrix/js/main/core/images/viewer-tick.png"}})]}),BX.create("span",{props:{className:"bx-viewer-aligner"}}),BX.create("span",{props:{className:"bx-viewer-alert-text"},html:BX.message("JS_CORE_VIEWER_DESCR_SAVE_FILE_TO_OWN_FILES").replace("#NAME#",'<a target="_blank" href="'+j.viewUrl+'" class="bx-viewer-file-link">'+h.title+"</a>")}),BX.create("div",{props:{className:"bx-viewer-alert-footer"},children:[BX.create("a",{props:{className:"bx-viewer-btn-link",target:"_blank",href:j.viewUrl},text:BX.message("JS_CORE_VIEWER_GO_TO_FILE")}),(h.showEdit?BX.create("a",{props:{className:"bx-viewer-btn-link",target:"_blank",href:j.runViewUrl?j.runViewUrl:(j.viewUrl+"#showInViewer")},text:BX.message("JS_CORE_VIEWER_EDIT")}):null)]}),BX.create("a",{props:{className:"bx-viewer-alert-close-icon",href:"#"},events:{click:function(o){if(h.selfViewer){h.selfViewer.closeConfirm()}else{BX.PopupWindowManager.getCurrentPopup().destroy()}BX.PreventDefault(o);return false}}})]});if(h.selfViewer){h.selfViewer.openConfirm(l,[],false,null,{windowName:"-copy",className:"bx-viewer-alert-popup"})}else{BX.CViewer.unlockScroll();var n={content:l,onPopupClose:function(){this.destroy()},closeByEsc:h.closeByEsc||false,autoHide:h.autoHide||false,zIndex:10200,className:"bx-viewer-alert-popup"};BX.PopupWindowManager.getCurrentPopup().destroy();var m=BX.PopupWindowManager.create("bx-gedit-convert-confirm-copy",null,n);m.show()}var k=setTimeout(function(){var o=BX.PopupWindowManager.getCurrentPopup();o.close();o.destroy()},3000);BX("bx-gedit-convert-confirm-copy").onmouseover=function(o){clearTimeout(k)};BX("bx-gedit-convert-confirm-copy").onmouseout=function(o){k=setTimeout(function(){var p=BX.PopupWindowManager.getCurrentPopup();p.close();p.destroy()},3000)}})};BX.CViewer.isEmptyObject=function(f){if(f==null){return true}if(f.length&&f.length>0){return false}if(f.length===0){return true}for(var e in f){if(hasOwnProperty.call(f,e)){return false}}return true};BX.CViewer.showLoading=function(e,f){f=f||{};f.notAddClassLoadingToObj=!!f.notAddClassLoadingToObj||false;if(!(e=BX(e))){return false}if(!f.notAddClassLoadingToObj){BX.addClass(e,"bx-viewer-wrap-loading")}BX.cleanNode(e);BX.adjust(e,{children:[BX.create("div",{style:{display:"table",width:"100%",height:"100%"},children:[BX.create("div",{style:{display:"table-cell",verticalAlign:"middle",textAlign:"center"},children:[BX.create("div",{props:{className:f.className||"bx-viewer-wrap-loading"}}),BX.create("span",{text:f.text||""})]})]})]});return true};BX.CViewer.prototype.initEventHandlersForElement=function(e){if(e.hasEventHandlers===true){return}e.hasEventHandlers=true;BX.addCustomEvent(e,"onIframeDocSuccess",BX.delegate(function(f){BX.localStorage.set("iframe_options_error",false,60)},this));BX.addCustomEvent(e,"onIframeElementPerformLocalAction",BX.delegate(function(f){if((!f.id||this.getCurrent().id!=f.id)&&this.getCurrent().src!=f.src){return}if(BX.CViewer.isLocalEditService(this.initEditService())){if(!f.editUrl&&f.fakeEditUrl){f.editUrl=f.fakeEditUrl}if(!f.editUrl){this.close();this.runActionByCurrentElement("localview",{obElementViewer:this})}else{this.close();this.runActionByCurrentElement("forceedit",{obElementViewer:this})}}},this));BX.addCustomEvent(e,"onIframeDocError",BX.delegate(function(f){if((!f.id||this.getCurrent().id!=f.id)&&this.getCurrent().src!=f.src){return}this.getCurrent().preventTimeout();this.getCurrent().hide();this.createPopupWindowFromErrorElement(f);BX.localStorage.set("iframe_options_error",true,60)},this));BX.addCustomEvent(e,"onAjaxElementError",BX.delegate(function(f){if((!f.id||this.getCurrent().id!=f.id)&&this.getCurrent().src!=f.src){return}this.getCurrent().preventTimeout();this.getCurrent().hide();this.createPopupWindowFromErrorElement(f)},this));BX.addCustomEvent(e,"onIframeElementCreateAjaxElement",BX.delegate(function(h,g){if((!h.id||this.getCurrent().id!=h.id)&&this.getCurrent().src!=h.src){return}var f=this.createAjaxElementFromIframeElement(h,g);f.setCurrentModalWindow(h.getCurrentModalWindow());this.getCurrent().hide();this.setCurrent(f);this.show()},this))};BX.CViewer.showError=function(e,f){f=f||{};if(!(e=BX(e))){return false}BX.cleanNode(e);BX.adjust(e,{children:[BX.create("div",{style:{display:"table",width:"100%",height:"100%"},children:[BX.create("div",{style:{display:"table-cell",verticalAlign:"middle",textAlign:"center"},children:[BX.create("div",{props:{}}),BX.create("span",{text:f.text||""})]})]})]});return true};BX.CViewer.prototype._create=function(){if(!this.DIV){var e=BX.browser.IsIE()&&!BX.browser.IsDoctype()?"A":"SPAN",g=e=="A"?"javascript:void(0)":null;this.OVERLAY=document.body.appendChild(BX.create("DIV",{props:{className:"bx-viewer-overlay"}}));this.OVERLAY.appendChild((this.PREV_LINK=BX.create(e,{props:{className:"bx-viewer-prev-outer",href:g},events:{click:BX.proxy(this.prev,this)},html:'<span class="bx-viewer-prev"></span>'})));this.OVERLAY.appendChild((this.NEXT_LINK=BX.create(e,{props:{className:"bx-viewer-next-outer",href:g},events:{click:BX.proxy(this.next,this)},html:'<span class="bx-viewer-next"></span>'})));this.DIV=this.OVERLAY.appendChild(BX.create("DIV",{props:{className:"bx-viewer-wrap-outer"},events:{click:BX.eventCancelBubble},children:[BX.create("DIV",{props:{className:"bx-viewer-wrap-inner"},children:[(this.CONTENT_WRAP=BX.create("DIV",{props:{className:"bx-viewer-wrap bx-viewer-cap"}}))]}),(this.CONTENT_TITLE=BX.create("DIV",{style:{bottom:"0"},props:{className:"bx-viewer-title"}})),(this.FULL_TITLE=BX.create("DIV",{style:{bottom:"-32px"},props:{className:"bx-viewer-full-title"}})),BX.create(e,{props:{className:"bx-viewer-close",href:g},events:{click:BX.proxy(this._hide,this)},html:'<span class="bx-viewer-close-inner"></span>'})]}));if(!!this.params.resizeToggle){this.CONTENT_WRAP.appendChild(BX.create("SPAN",{props:{className:"bx-viewer-size-toggle"},style:{right:this.params.minPadding+"px",bottom:this.params.minPadding+"px"},events:{click:BX.proxy(this._toggle_resize,this)}}))}}var f;if(this.params.topPadding){f=this.params.topPadding+"px "+this.params.minPadding+"px "+this.params.minPadding+"px"}else{f=this.params.minPadding+"px"}this.CONTENT_WRAP.parentNode.style.padding=f};BX.CViewer.prototype.setCurrent=function(e){if(!BX.is_subclass_of(e,BX.CViewCoreElement)){BX.debug("current element not instance of BX.CViewCoreElement");return}this.currentElement=e};BX.CViewer.prototype.isCurrent=function(e){if(typeof(e)=="object"){e=(e.id||e.image||e.thumb||e.src)}else{return false}var f=this.getCurrent();if(!f){return false}f=(f.id||f.image||f.thumb||f.src||false);if(!f){return false}return f==e};BX.CViewer.prototype.getCurrent=function(){if(!BX.is_subclass_of((this.currentElement||this.list[this._current]),BX.CViewCoreElement)){BX.debug("current element not instance of BX.CViewCoreElement");return false}else{this.initEventHandlersForElement(this.currentElement||this.list[this._current])}return(this.currentElement||this.list[this._current])};BX.CViewer.prototype._keypress=function(i){var g=(i||window.event).keyCode||(i||window.event).charCode;if(!!this.params.keyMap&&!!this.params.keyMap[g]&&!!this[this.params.keyMap[g]]){var h=this.getCurrent();if(h.wrapClassName&&h.wrapClassName==="bx-viewer-video"&&h.innerElementId&&g!=27){if(typeof BX.Fileman.PlayerManager!=="undefined"&&BX.Fileman.PlayerManager.getPlayerById){var f=BX.Fileman.PlayerManager.getPlayerById(h.innerElementId);if(f&&f.isReady()){f.onKeyDown(i);i.preventDefault();return}}}this[this.params.keyMap[g]].apply(this);return BX.PreventDefault(i)}};BX.CViewer.prototype._toggle_resize=function(){var e=this.params.resize;this.params.resize=this.params.resizeToggle;this.params.resizeToggle=e;if(this.params.resize!="WH"){this.params.lockScroll=true;this._lock_scroll()}else{this.params.lockScroll=false;this._unlock_scroll()}this.adjustSize();this.adjustPos()};BX.CViewer.prototype.adjustPos=function(){if(this.getCurrent().height>0&&this.getCurrent().width>0){this._adjustPosByElement()}else{if(!this.CONTENT_WRAP.style.height){this.CONTENT_WRAP.style.height="100px"}if(!this.CONTENT_WRAP.style.width){this.CONTENT_WRAP.style.width="100px"}this.getCurrent().addTimeoutId(setTimeout(BX.proxy(this._adjustPosByElement,this),250))}};BX.CViewer.prototype._adjustPosByElement=function(){if(this.bVisible){var e=BX.GetWindowSize(),g=parseInt((e.innerHeight-parseInt(this.CONTENT_WRAP.style.height)-2*this.params.minPadding-this.params.topPadding)/2),f=parseInt((e.innerWidth-parseInt(this.CONTENT_WRAP.style.width)-2*this.params.minPadding)/2);if(!this.params.lockScroll&&e.innerWidth<e.scrollHeight){f-=20}if(g<this.params.minMargin){g=this.params.minMargin}if(f<this.params.minMargin+Math.min(70,this.PREV_LINK.offsetWidth)){f=this.params.minMargin+Math.min(70,this.PREV_LINK.offsetWidth)}this.DIV.style.top=g+"px";this.DIV.style.left=f+"px"}};BX.CViewer.prototype.adjustSizeTitle=function(){if(!this.getCurrent().titleButtons||!this.getCurrent().titleDomElement){return false}var f=this.getCurrent().autoReduction;function g(i,n){i=BX(i);if(i.offsetWidth<n){BX.adjust(i,{style:{maxWidth:n+"px"}});return}if(!BX.hasClass(i,"bx-viewer-file-name")){i=BX.findChild(i,{className:"bx-viewer-file-name"},true)}var o=i.innerHTML;var m=o.lastIndexOf(".");var k=o.substring(m);var j=o.substring(0,m);var l=parseInt(n/10)-8;var h=o.substring(0,l)+"..."+j.substring(j.length-3)+k;if(h.length<o.length){i.innerHTML=h}}if(f){g(this.getCurrent().titleDomElement,this.getCurrent().autoReductionWidth);return}var e=BX.findChild(this.getCurrent().titleDomElement,{className:"bx-viewer-file-name"},true);if(!e){return false}if(this.getCurrent().titleButtons.offsetLeft+this.getCurrent().titleButtons.offsetWidth+10>this.getCurrent().titleDomElement.offsetLeft){BX.removeClass(this.getCurrent().titleDomElement,"bx-viewer-file-center");BX.addClass(this.getCurrent().titleDomElement,"bx-viewer-file-right");BX.adjust(e,{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginLeft:(this.getCurrent().titleButtons.offsetLeft+this.getCurrent().titleButtons.offsetWidth)+"px"}});return true}else{BX.removeClass(this.getCurrent().titleDomElement,"bx-viewer-file-right");BX.addClass(this.getCurrent().titleDomElement,"bx-viewer-file-center");BX.adjust(e,{style:{}})}return false};BX.CViewer.prototype.adjustSize=function(){var g=BX.GetWindowSize(),f=this.getCurrent();if(!!f.height&&!!f.width){if(!this.params.lockScroll&&g.innerWidth<g.scrollHeight){g.innerWidth-=20}g.innerWidth-=this.params.minMargin*2+this.params.minPadding*2+Math.min(140,this.PREV_LINK.offsetWidth+this.NEXT_LINK.offsetWidth);g.innerHeight-=this.params.topPadding+this.params.minMargin*2+this.params.minPadding*2;if(this.params.showTitle&&!!f.title){g.innerHeight-=40}var e=f.height,k=f.width,j=[1];if(this.params.resize){if(this.params.resize.indexOf("W")>=0){j.push(g.innerWidth/k)}if(this.params.resize.indexOf("H")>=0){j.push(g.innerHeight/e)}}j=Math.min.apply(window,j);e*=j;k*=j;if(f.image){f.image.style.height=parseInt(e)+"px";f.image.style.width=parseInt(k)+"px"}if(f._minWidth&&f._minWidth>k){k=f._minWidth}if(f._minHeight&&f._minHeight>e){e=f._minHeight}this.CONTENT_WRAP.style.height=parseInt(e)+"px";this.CONTENT_WRAP.style.width=parseInt(k)+"px";this.getCurrent().addTimeoutId(setTimeout(BX.proxy(this.adjustSizeTitle,this),300));if(BX.browser.IsIE()){var i=parseInt(this.CONTENT_WRAP.style.height)+this.params.minPadding*2;this.PREV_LINK.style.height=this.NEXT_LINK.style.height=i+"px";this.PREV_LINK.firstChild.style.top=this.NEXT_LINK.firstChild.style.top=parseInt(i/2-20)+"px"}}};BX.CViewer.prototype._lock_scroll=function(){if(this.params.lockScroll){BX.CViewer.lockScroll()}};BX.CViewer.prototype._unlock_scroll=function(){if(this.params.lockScroll){BX.CViewer.unlockScroll()}};BX.CViewer.prototype._unhide=function(){this.bVisible=true;this.DIV.style.display="block";this.OVERLAY.style.display="block";this.PREV_LINK.style.display=this.NEXT_LINK.style.display="none";if(this.list.length>1&&(this.params.cycle||this._current>0)){this.PREV_LINK.style.display="block";this.PREV_LINK.style.opacity="0.2"}if(this.list.length>1&&(this.params.cycle||this._current<this.list.length-1)){this.NEXT_LINK.style.display="block";this.NEXT_LINK.style.opacity="0.2"}this.adjustPos();this._unbindEvents();this._bindEvents();this._lock_scroll()};BX.CViewer.prototype._bindEvents=function(){BX.bind(document,"keydown",BX.proxy(this._keypress,this));BX.bind(window,"resize",BX.proxy(this.adjustSize,this));BX.bind(window,"resize",BX.proxy(this.adjustPos,this))};BX.CViewer.prototype._unbindEvents=function(){BX.unbind(document,"keydown",BX.proxy(this._keypress,this));BX.unbind(window,"resize",BX.proxy(this.adjustSize,this));BX.unbind(window,"resize",BX.proxy(this.adjustPos,this))};BX.CViewer.prototype._hide=function(){if(this.isOpenedConfirm()){return false}this.bVisible=false;if(!this.DIV){return}this.DIV.style.display="none";this.OVERLAY.style.display="none";this._unbindEvents();this._unlock_scroll();this.getCurrent().hide(true);this.currentElement=null;this.closeConfirm();this.destroyMenu();BX.onCustomEvent(this,"onElementViewClose",[this.getCurrent()])};BX.CViewer.prototype.add=function(e){if(!BX.util.in_array(e.src,this.list.map(function(f){return f.src}))){this.list.push(e)}};BX.CViewer.prototype.setList=function(f){this.list=[];if(!!f&&BX.type.isArray(f)){for(var e=0;e<f.length;e++){if(!BX.is_subclass_of(f[e],BX.CViewCoreElement)){this.add(new BX.CViewCoreElement(f[e]))}else{this.add(f[e])}}}if(this.bVisible){if(this.list.length>0){this.show()}else{this.close()}}};BX.CViewer.prototype.show=function(j,l){BX.CViewer.temporaryServiceEditDoc="";this.initEditService();this.closeConfirm();if(BX.PopupWindowManager.getCurrentPopup()){BX.PopupWindowManager.getCurrentPopup().destroy()}l=l||false;BX.browser.addGlobalClass();var k=this._current;var f=this;if(typeof(j)=="object"&&(!!j.image||!!j.thumb)){j=(j.id||j.image||j.thumb||j.src)}if(BX.type.isString(j)){for(var h=0;h<this.list.length;h++){if(this.list[h].image==j||this.list[h].thumb==j||this.list[h].src==j||this.list[h].id==j){k=h;break}}}if(!this.currentElement){var g=this.list[k];if(!g){return}this._current=k}else{var g=this.currentElement}this._currentEl=g;var e={};BX.onCustomEvent(this,"onBeforeElementShow",[this,g,e]);if(e&&e.prevent){this.close();return}if(BX.CViewer.enableInVersionDisk(2)&&!g.hasOwnProperty("image")){if(!BX.message("disk_document_service")){this.openWindowForSelectDocumentService({viewInUf:!!BX.message.disk_render_uf});this.close();return}else{if(BX.CViewer.isLocalEditService(this.initEditService())){if(!g.editUrl&&g.fakeEditUrl){g.editUrl=g.fakeEditUrl}if(!g.editUrl){this.runActionByCurrentElement("localview",{obElementViewer:this})}else{this.runActionByCurrentElement("forceedit",{obElementViewer:this})}return}else{}}}this.params.topPadding=0;if(g.showTitle&&g.title){this.params.topPadding=g.topPadding||0}this._create();g.setContentWrap(this.CONTENT_WRAP);BX.cleanNode(this.CONTENT_WRAP);this.adjustSize();if(l){g.hide();g.loaded=false;g.hide()}if(!g.loaded){BX.addClass(this.CONTENT_WRAP,"bx-viewer-wrap-loading");g.load(BX.delegate(function(i){BX.removeClass(this.CONTENT_WRAP,"bx-viewer-wrap-loading");i.show();this.adjustSize();this.adjustPos();this._preload()},this),BX.delegate(function(m,i){BX.removeClass(this.CONTENT_WRAP,"bx-viewer-wrap-loading");if(i&&i.error=="access_denied"){this.showError({text:i.message});if(m.titleButtons){BX.remove(m.titleButtons)}}else{if(i&&i.status==="error"){if(i.errors){this.showError({text:i.errors.shift().message})}}}},this));this.getCurrent().addTimeoutId(setTimeout(BX.proxy(this.adjustSizeTitle,this),300))}else{g.load(BX.delegate(function(i){BX.removeClass(this.CONTENT_WRAP,"bx-viewer-wrap-loading");this.adjustPos();i.addTimeoutId(setTimeout(BX.delegate(function(){i.show();this.adjustSize()},this),200));this._preload()},this));this.adjustSizeTitle()}if(BX.CViewer.rightNowRunActionAfterShow){this.runActionByCurrentElement(BX.CViewer.rightNowRunActionAfterShow);BX.CViewer.rightNowRunActionAfterShow=false}this.getCurrent().addTimeoutId(setTimeout(BX.proxy(this._check_title,this),10));this._unhide();BX.onCustomEvent(this,"onElementViewShow",[g]);if(BX.type.isDomNode(document.activeElement)){document.activeElement.blur()}BX.focus(window)};BX.CViewer.prototype.showLoading=function(e){this.getCurrent().hide();return BX.CViewer.showLoading(this.CONTENT_WRAP,e)};BX.CViewer.prototype.showError=function(e){this.getCurrent().hide();return BX.CViewer.showError(this.CONTENT_WRAP,e)};BX.CViewer.prototype._check_title=function(){BX.cleanNode(this.CONTENT_TITLE);BX.cleanNode(this.FULL_TITLE);if(this.params.showTitle){if(this.getCurrent().showTitle&&this.getCurrent().title){if(BX.type.isDomNode(this.getCurrent().titleDomElement)){if(BX.type.isDomNode(this.getCurrent().titleButtons)){this.CONTENT_TITLE.appendChild(this.getCurrent().titleButtons)}this.CONTENT_TITLE.appendChild(this.getCurrent().titleDomElement)}else{if(BX.type.isNotEmptyString(this.getCurrent().title)){BX.adjust(this.CONTENT_TITLE,{text:this.getCurrent().title})}else{this.CONTENT_TITLE.style.opacity="0";this.CONTENT_TITLE.style.bottom="0"}}}else{this.params.topPadding=0}if(this.getCurrent().full){BX.cleanNode(this.FULL_TITLE);var e=this.getCurrent().getBottomHtml();BX.adjust(this.FULL_TITLE,{style:{opacity:"1"},children:[BX.create("div",{props:{className:"bx-viewer-full-item "},html:e})]})}}else{this.CONTENT_TITLE.style.opacity="0";this.CONTENT_TITLE.style.bottom="0";BX.cleanNode(this.CONTENT_TITLE)}};BX.CViewer.prototype._preload=function(){if(this.params.preload>0){var g=Math.max(this._current-this.params.preload,this.params.cycle?-1000:0),h=Math.min(this._current+this.params.preload,this.params.cycle?this.list.length+1000:this.list.length-1);if(g<h){for(var f=h;f>=g;f--){var e=f;if(e<0){e+=this.list.length}else{if(e>=this.list.length){e-=this.list.length}}if(!this.list[e].isProccessed){this.list[e].preload()}}}}};BX.CViewer.prototype.next=function(){if(this.list.length>1){this.destroyMenu();this.getCurrent().hide();this.currentElement=null;this._current++;if(this._current>=this.list.length){if(!!this.params.cycle){this._current=0}else{this._current--}BX.onCustomEvent(this,"onElementViewFinishList",[this.getCurrent(),1])}this.getCurrent().preventShow=false;this.show()}};BX.CViewer.prototype.prev=function(){if(this.list.length>1){this.destroyMenu();this.getCurrent().hide();this.currentElement=null;this._current--;if(this._current<0){if(!!this.params.cycle){this._current=this.list.length-1}else{this._current++}BX.onCustomEvent(this,"onElementViewFinishList",[this.getCurrent(),-1])}this.getCurrent().preventShow=false;this.show()}};BX.CViewer.prototype.close=function(){this._hide()};BX.CViewer.prototype.submitCurrentElement=function(){this.runActionByCurrentElement("submit",{})};BX.CViewer.prototype.runActionByCurrentElement=function(e,f){f=f||{};if(this.getCurrent()){this.getCurrent().runAction(e,f)}};BX.CViewer.prototype.openModal=function(g,h,f,e){f=f||1030;e=e||700;var i=BX.util.popup(g,f,e);i.elementViewer=this;i.currentElement=this.getCurrent();window._ie_elementViewer=this;window._ie_currentElement=this.getCurrent();return i};BX.CViewer.prototype.isOpenedConfirm=function(){if(this.popupConfirm!=null){return this.popupConfirm.isShown()}return false};BX.CViewer.prototype.closeConfirm=function(){if(this.popupConfirm!=null){this.popupConfirm.close();this.popupConfirm.destroy()}};BX.CViewer.prototype.openConfirm=function(h,g,f,e,i){if(this.popupConfirm!=null){this.popupConfirm.destroy()}i=i||{};i.windowName=i.windowName||"";e=e||null;if(typeof(h)=="object"){}else{h=BX.create("div",{props:{className:"bx-gedit-convert-confirm-cont"},html:h})}f=f===true?true:false;g=typeof(g)=="object"?g:false;if(!i.autoHide){i.autoHide=g===false?true:false}i.closeByEsc=i.closeByEsc||false;i.zIndex=10200;if(i.overlay){i.overlay=i.overlay}else{i.overlay=f}i.content=h;i.buttons=g;i.events={onPopupClose:function(){this.destroy()}};if(i.shown){i.events.onPopupShow=i.shown}this.popupConfirm=BX.PopupWindowManager.create("bx-gedit-convert-confirm"+i.windowName,e,i);this.popupConfirm.show();BX.addCustomEvent(this.popupConfirm,"onPopupClose",BX.proxy(function(j){this.destroyMenu();if(BX.CViewer.hasLockScroll()){BX.CViewer.unlockScroll()}},this))};BX.CViewer.prototype.destroyMenu=function(){if(this.popupMenu!=null&&this.popupMenu.menu&&this.popupMenu.menu.popupWindow){this.popupMenu.menu.popupWindow.close();this.popupMenu.menu.popupWindow.destroy();if(!BX.type.isArray(BX.CViewer.listPopupId)){return}for(var e in BX.CViewer.listPopupId){if(BX.CViewer.listPopupId.hasOwnProperty(e)){if(BX.PopupMenu.Data[BX.CViewer.listPopupId[e]]&&BX.PopupMenu.Data[BX.CViewer.listPopupId[e]].popupWindow){BX.PopupMenu.Data[BX.CViewer.listPopupId[e]].popupWindow.destroy()}BX.PopupMenu.Data[BX.CViewer.listPopupId[e]]=undefined}}BX.CViewer.listPopupId=[]}};BX.CViewer.prototype.closeMenu=function(){if(this.popupMenu!=null&&this.popupMenu.menu&&this.popupMenu.menu.popupWindow){this.popupMenu.menu.popupWindow.close()}};BX.CViewer.prototype.openMenu=function(h,f,e,g){BX.CViewer.listPopupId.push(h);g=g||{};BX.PopupMenu.show(h,BX(f),e,{offsetTop:g.offsetTop,offsetLeft:g.offsetLeft,angle:{position:"top",offset:45},autoHide:g.autoHide||true,zIndex:g.zIndex||10000,overlay:{opacity:0.01}});this.popupMenu={id:h,menu:BX.PopupMenu.currentItem};return};BX.CViewer.prototype.initEditService=function(){var e;if(BX.CViewer.enableInVersionDisk(2)){e=BX.message("disk_document_service")}else{e=BX.message("wd_service_edit_doc_default")}if(BX.CViewer.localChangeServiceEdit&&BX.localStorage.get("wd_service_edit_doc_default")){e=BX.localStorage.get("wd_service_edit_doc_default")}if(!BX.CViewer.enableInVersionDisk(2)){e=e||"g"}this.setEditService(e);return e};BX.CViewer.prototype.getNameEditService=function(e){e=e||this.initEditService();e=b.normalizeServiceName(e);switch(e){case"gdrive":return BX.message("JS_CORE_VIEWER_SERVICE_GOOGLE_DRIVE");case"onedrive":return BX.message("JS_CORE_VIEWER_SERVICE_SKYDRIVE");case"office365":return BX.message("JS_CORE_VIEWER_SERVICE_OFFICE365");case"myoffice":return BX.message("JS_CORE_VIEWER_SERVICE_MYOFFICE");case"l":case"local":return BX.message("JS_CORE_VIEWER_SERVICE_LOCAL")}return""};BX.CViewer.prototype.setEditService=function(e){if(e&&BX.CViewer.enableInVersionDisk(2)){e=b.normalizeServiceName(e);if(e!=BX.message("disk_document_service")){BX.userOptions.save("disk","doc_service","default",e)}BX.message({disk_document_service:e});BX.userOptions.send(null);if(BX("bx-viewer-edit-service-txt")){BX.adjust(BX("bx-viewer-edit-service-txt"),{text:this.getNameEditService(e)})}BX.CViewer.temporaryServiceEditDoc=e;return true}else{if(!BX.CViewer.enableInVersionDisk(2)){e=b.normalizeServiceName(e);if(e){if(BX.CViewer.isLocalEditService(e)&&!BX.CViewer.isEnableLocalEditInDesktop()){e="g"}BX.userOptions.save("webdav","user_settings","service_edit_doc_default",e);BX.localStorage.set("wd_service_edit_doc_default",e,60*2);BX.CViewer.localChangeServiceEdit=true;BX.CViewer.temporaryServiceEditDoc=e;if(BX("bx-viewer-edit-service-txt")){BX.adjust(BX("bx-viewer-edit-service-txt"),{text:this.getNameEditService(e)})}return true}return false}}return false};BX.CViewer.isLocalEditService=function(e){e=e.toLowerCase();switch(e){case"l":case"local":return true}return false};BX.CViewer.prototype.openWindowForSelectDocumentService=function(e){if(!BX.Disk){return}BX.Disk.openWindowForSelectDocumentService({viewInUf:e.viewInUf||false,onSave:BX.delegate(function(f){if(f=="l"){if(!BX.CViewer.isEnableLocalEditInDesktop()){this.helpDiskDialog();return}BX.message({disk_document_service:"l"})}else{BX.message({disk_document_service:"gdrive"})}BX.userOptions.save("disk","doc_service","default",BX.message("disk_document_service"));BX.userOptions.send(null);BX.PopupWindowManager.getCurrentPopup().destroy();BX.CViewer.unlockScroll();if(this._currentEl){this.show(this._currentEl)}},this)})};BX.CViewer.prototype.helpDiskDialog=function(g,e,f){g=g||BX.message("JS_CORE_VIEWER_EDIT_IN_LOCAL_SERVICE");e=e||BX.message("JS_CORE_VIEWER_SERVICE_LOCAL_INSTALL_DESKTOP");var i=BX.create("div",{props:{className:"bx-viewer-confirm"},children:[BX.create("div",{props:{className:"bx-viewer-confirm-title"},text:g,children:[]}),BX.create("div",{props:{className:"bx-viewer-confirm-text-wrap"},children:[BX.create("span",{props:{className:"bx-viewer-confirm-text-alignment"}}),BX.create("span",{props:{className:"bx-viewer-confirm-text"},html:e})]})]});var h=BX.CViewer.hasLockScroll();BX.CViewer.lockScroll();this.openConfirm(i,[new BX.PopupWindowButton({text:(f?BX.message("JS_CORE_VIEWER_DOWNLOAD_B24_DESKTOP_FULL"):BX.message("JS_CORE_VIEWER_DOWNLOAD_B24_DESKTOP")),className:"popup-window-button-accept",events:{click:BX.delegate(function(){document.location.href=(BX.browser.IsMac()?"http://dl.bitrix24.com/b24/bitrix24_desktop.dmg":"http://dl.bitrix24.com/b24/bitrix24_desktop.exe")},this)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_IFRAME_CANCEL"),events:{click:BX.delegate(function(){this.closeConfirm();if(!h){BX.CViewer.unlockScroll()}},this)}}),(f?new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_DOWNLOAD_DOCUMENT"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){document.location.href=f},this)}}):null)],true)};BX.CViewer.prototype.createPopupWindowFromErrorElement=function(e){if(e.editInProcess&&e.editInProcess===true){return}var g=e.errorMessage;if(!g){g=BX.message("JS_CORE_VIEWER_IFRAME_ERROR_COULD_NOT_VIEW")}var f={content:BX.create("div",{props:{className:"popup-window-titlebar"},children:[BX.create("span",{props:{className:"popup-window-titlebar-text"},text:e.title}),BX.create("span",{props:{className:"popup-window-titlebar-text-version"},text:e.version?BX.message("JS_CORE_VIEWER_THROUGH_VERSION").replace("#NUMBER#",e.version>0?e.version:""):"("+BX.message("JS_CORE_VIEWER_THROUGH_LAST_VERSION").toLowerCase()+")"})]})};var h=BX.create("div",{props:{className:"bx-viewer-error-popup"},children:[BX.create("div",{props:{className:"bx-viewer-error-popup-file-icon-wrapper"},children:[BX.create("div",{props:{className:"bx-viewer-icon "+e.getIconClassByName(e.title)}})]}),BX.create("div",{props:{className:"bx-viewer-error-popup-right"},children:[BX.create("div",{props:{className:"bx-viewer-error-popup-title"},text:BX.message("JS_CORE_VIEWER_IFRAME_ERROR_TITLE")}),(g?BX.create("span",{props:{className:"bx-viewer-error-popup-text"},html:g}):null),(!BX.CViewer.isDisabledLocalEdit?BX.create("span",{props:{className:"bx-viewer-error-popup-text"},html:BX.message("JS_CORE_VIEWER_SERVICE_LOCAL_INSTALL_DESKTOP")}):null),(!BX.CViewer.isDisabledLocalEdit?BX.create("span",{props:{className:"popup-window-button"},events:{click:BX.delegate(function(){document.location.href=(BX.browser.IsMac()?"http://dl.bitrix24.com/b24/bitrix24_desktop.dmg":"http://dl.bitrix24.com/b24/bitrix24_desktop.exe")},this)},text:BX.message("JS_CORE_VIEWER_DOWNLOAD_B24_DESKTOP_FULL")}):null),(e.hideEdit?null:e.getComplexEditButton(this,{enableEdit:!!e.editUrl,isLocked:!!e.lockedBy&&e.lockedBy!=BX.message("USER_ID")},true))]})]});this.openConfirm(h,[(e.downloadUrl?new BX.PopupWindowButton({text:BX.message("JS_CORE_VIEWER_DOWNLOAD_DOCUMENT"),className:"popup-window-button-accept",events:{click:BX.delegate(function(){document.location.href=e.downloadUrl},this)}}):null),new BX.PopupWindowButton({className:"bx-viewer-error-popup-cancel",text:BX.message("JS_CORE_VIEWER_IFRAME_CONVERT_DECLINE"),events:{click:BX.delegate(function(){this.destroyMenu();this.closeConfirm();this.close()},this)}})],true,null,{titleBar:f,closeIcon:false,closeByEsc:false})};BX.CViewer.prototype.createElementByType=function(e,h){var f=e.getAttribute("data-bx-viewer");h=h||{};if(e.getAttribute("data-bx-title").split(".").pop()=="xodt"){var g=this.createErrorIframeElementFromEditable(this.createIframeElement(e,h));g.disableGoogleViewer=true;return g}switch(f){case"onlyedit":return this.createWithoutPreviewEditableElement(e,h);break;case"iframe":return this.createIframeElement(e,h);break;case"ajax":return this.createAjaxElement(e,h);break}};BX.CViewer.prototype.createErrorIframeElementFromEditable=function(f){var e=new BX.CViewErrorIframeElement({id:f.id,baseElementId:f.baseElementId,title:f.title,src:f.src,owner:f.owner,size:f.size,dateModify:f.dateModify,tooBigSizeMsg:f.tooBigSizeMsg,buttonUrl:f.viewerUrl||f.viewUrl,isFromUserLib:f.isFromUserLib,relativePath:f.relativePath,externalId:f.externalId,objectId:f.objectId,editUrl:f.editUrl,lockedBy:f.lockedBy,urlToPost:f.urlToPost,idToPost:f.idToPost,downloadUrl:f.downloadUrl,historyPageUrl:f.historyPageUrl,askConvert:f.askConvert,version:f.version,pdfFallback:f.pdfFallback,buttons:[]});e.buttons.push(e.getComplexEditButton(this,{enableEdit:!!e.editUrl,isLocked:!!e.lockedBy&&e.lockedBy!=BX.message("USER_ID")}));e.buttons.push(e.getComplexSaveButton(this,{downloadUrl:e.downloadUrl}));return e};BX.CViewer.prototype.createErrorIframeElementFromAjaxElement=function(f,g){f.errorMessage=f.errorMessage||BX.message("JS_CORE_VIEWER_AJAX_CONNECTION_FAILED");if(!g){g=(BX.create("div",{props:{className:"bx-viewer-cap-text-block"},children:[BX.create("div",{props:{className:"bx-viewer-cap-title",title:f.title},text:f.title}),BX.create("div",{props:{className:"bx-viewer-too-big-title"},text:f.errorMessage})]}))}var e=new BX.CViewErrorIframeElement({id:f.id,baseElementId:f.baseElementId,title:f.title,src:f.src,owner:f.owner,size:f.size,dateModify:f.dateModify,tooBigSizeMsg:f.tooBigSizeMsg,buttonUrl:f.viewerUrl||f.viewUrl,isFromUserLib:f.isFromUserLib,relativePath:f.relativePath,externalId:f.externalId,objectId:f.objectId,editUrl:f.editUrl,lockedBy:f.lockedBy,urlToPost:f.urlToPost,idToPost:f.idToPost,downloadUrl:f.downloadUrl,historyPageUrl:f.historyPageUrl,askConvert:f.askConvert,version:f.version,errorDescription:g,buttons:[]});if(!f.hideEdit){e.buttons.push(f.getComplexEditButton(this,{enableEdit:!!f.editUrl,isLocked:!!f.lockedBy&&f.lockedBy!=BX.message("USER_ID")}))}e.buttons.push(e.getComplexSaveButton(this,{downloadUrl:e.downloadUrl}));return e};BX.CViewer.prototype.createAjaxElementFromIframeElement=function(g,f){var e=new BX.CViewAjaxElement({src:f.src,width:f.width,height:f.height,hideEdit:f.hideEdit,pdfFallback:f["data-bx-pdfFallback"],transformTimeout:f.transformTimeout,baseElementId:g.baseElementId,title:g.title,dateModify:g.dateModify,isFromUserLib:g.isFromUserLib,externalId:g.externalId,objectId:g.objectId,relativePath:g.relativePath,editUrl:g.editUrl,lockedBy:g.lockedBy,fakeEditUrl:g.fakeEditUrl,urlToPost:g.urlToPost,idToPost:g.idToPost,downloadUrl:g.downloadUrl,historyPageUrl:g.historyPageUrl,askConvert:g.askConvert,version:g.version,iframeSrc:g.src,getLastVersionUri:g.getLastVersionUri});if(!e.hideEdit){e.buttons.push(e.getComplexEditButton(this,{enableEdit:!!e.editUrl,isLocked:!!e.lockedBy&&e.lockedBy!=BX.message("USER_ID")}))}e.buttons.push(e.getComplexSaveButton(this,{downloadUrl:e.downloadUrl,reloadAfterDownload:false,showEdit:true}));return e};BX.CViewer.prototype.createIframeElementFromAjaxElement=function(e){var f=new BX.CViewIframeElement({src:e.iframeSrc,width:e.width,height:e.height,hideEdit:e.hideEdit,pdfFallback:e.pdfFallback,transformTimeout:e.transformTimeout,baseElementId:e.baseElementId,title:e.title,dateModify:e.dateModify,isFromUserLib:e.isFromUserLib,externalId:e.externalId,objectId:e.objectId,relativePath:e.relativePath,editUrl:e.editUrl,lockedBy:e.lockedBy,fakeEditUrl:e.fakeEditUrl,urlToPost:e.urlToPost,idToPost:e.idToPost,downloadUrl:e.downloadUrl,historyPageUrl:e.historyPageUrl,askConvert:e.askConvert,version:e.version,getLastVersionUri:e.getLastVersionUri});if(!f.hideEdit){f.buttons.push(f.getComplexEditButton(this,{enableEdit:!!f.editUrl,isLocked:!!f.lockedBy&&f.lockedBy!=BX.message("USER_ID")}))}f.buttons.push(f.getComplexSaveButton(this,{downloadUrl:f.downloadUrl,reloadAfterDownload:true,showEdit:true}));return f};BX.CViewer.prototype.createBlankElementByParams=function(e){e.docType=e.docType||"docx";return new BX.CViewBlankElement(e)};BX.CViewer.prototype.createWithoutPreviewEditableElement=function(f,h){var g=new BX.CViewWithoutPreviewEditableElement({baseElementId:f.getAttribute("data-bx-baseElementId"),title:f.getAttribute("data-bx-title"),src:f.getAttribute("data-bx-src"),owner:f.getAttribute("data-bx-owner"),size:f.getAttribute("data-bx-size"),dateModify:f.getAttribute("data-bx-dateModify"),tooBigSizeMsg:!!f.getAttribute("data-bx-tooBigSizeMsg"),isFromUserLib:!!f.getAttribute("data-bx-isFromUserLib"),externalId:f.getAttribute("data-bx-externalId"),objectId:f.getAttribute("bx-attach-file-id"),relativePath:f.getAttribute("data-bx-relativePath"),editUrl:f.getAttribute("data-bx-edit"),lockedBy:f.getAttribute("data-bx-lockedBy"),fakeEditUrl:f.getAttribute("data-bx-fakeEdit"),urlToPost:f.getAttribute("data-bx-urlToPost"),idToPost:f.getAttribute("data-bx-idToPost"),downloadUrl:f.getAttribute("data-bx-download"),historyPageUrl:f.getAttribute("data-bx-historyPage"),askConvert:f.getAttribute("data-bx-askConvert"),version:h.version>=0?h.version:f.getAttribute("data-bx-version"),buttons:[]});if(g.isConverted()){var e=BX.CViewer._convertElementsMatch[g.src];g.src=e.src;g.title=e.title;g.editUrl=e.editUrl;g.askConvert=false}g.buttons.push(g.getComplexEditButton(this,{enableEdit:!!g.editUrl,isLocked:!!g.lockedBy&&g.lockedBy!=BX.message("USER_ID")}));g.buttons.push(g.getComplexSaveButton(this,{downloadUrl:g.downloadUrl}));return g};BX.CViewer.prototype.createIframeElement=function(f,g){var h=new BX.CViewIframeElement({baseElementId:f.getAttribute("data-bx-baseElementId"),title:f.getAttribute("data-bx-title"),dateModify:f.getAttribute("data-bx-dateModify"),isFromUserLib:!!f.getAttribute("data-bx-isFromUserLib"),externalId:f.getAttribute("data-bx-externalId"),objectId:f.getAttribute("bx-attach-file-id"),relativePath:f.getAttribute("data-bx-relativePath"),editUrl:f.getAttribute("data-bx-edit"),lockedBy:f.getAttribute("data-bx-lockedBy"),hideEdit:f.getAttribute("data-bx-hideEdit"),fakeEditUrl:f.getAttribute("data-bx-fakeEdit"),urlToPost:f.getAttribute("data-bx-urlToPost"),idToPost:f.getAttribute("data-bx-idToPost"),downloadUrl:f.getAttribute("data-bx-download"),historyPageUrl:f.getAttribute("data-bx-historyPage"),src:f.getAttribute("data-bx-src"),askConvert:f.getAttribute("data-bx-askConvert"),version:g.version>=0?g.version:f.getAttribute("data-bx-version"),pdfFallback:f.getAttribute("data-bx-pdfFallback"),previewImage:f.getAttribute("data-bx-previewImage"),transformTimeout:g.transformTimeout,getLastVersionUri:g.getLastVersionUri||f.getAttribute("data-bx-getLastVersionUri"),buttons:[]});if(h.isConverted()){var e=BX.CViewer._convertElementsMatch[h.src];h.src=e.src;h.title=e.title;h.editUrl=e.editUrl;h.askConvert=false}if(!h.hideEdit){h.buttons.push(h.getComplexEditButton(this,{enableEdit:!!h.editUrl,isLocked:!!h.lockedBy&&h.lockedBy!=BX.message("USER_ID")}))}h.buttons.push(h.getComplexSaveButton(this,{downloadUrl:h.downloadUrl,reloadAfterDownload:true,showEdit:true}));return h};BX.CViewer.prototype.createAjaxElement=function(f,g){var e=new BX.CViewAjaxElement({baseElementId:f.getAttribute("data-bx-baseElementId"),title:f.getAttribute("data-bx-title"),dateModify:f.getAttribute("data-bx-dateModify"),isFromUserLib:!!f.getAttribute("data-bx-isFromUserLib"),externalId:f.getAttribute("data-bx-externalId"),objectId:f.getAttribute("bx-attach-file-id"),relativePath:f.getAttribute("data-bx-relativePath"),editUrl:f.getAttribute("data-bx-edit"),lockedBy:f.getAttribute("data-bx-lockedBy"),fakeEditUrl:f.getAttribute("data-bx-fakeEdit"),urlToPost:f.getAttribute("data-bx-urlToPost"),idToPost:f.getAttribute("data-bx-idToPost"),downloadUrl:f.getAttribute("data-bx-download"),historyPageUrl:f.getAttribute("data-bx-historyPage"),src:f.getAttribute("data-bx-src"),askConvert:f.getAttribute("data-bx-askConvert"),version:g.version>=0?g.version:f.getAttribute("data-bx-version"),buttons:[],pdfFallback:f.getAttribute("data-bx-pdfFallback"),width:f.getAttribute("data-bx-width"),height:f.getAttribute("data-bx-height"),hideEdit:f.getAttribute("data-bx-hideEdit"),iframeSrc:f.getAttribute("data-bx-iframeSrc"),transformTimeout:f.getAttribute("data-bx-transformTimeout"),getLastVersionUri:f.getAttribute("data-bx-getLastVersionUri")});if(!e.hideEdit){e.buttons.push(e.getComplexEditButton(this,{enableEdit:!!e.editUrl,isLocked:!!e.lockedBy&&e.lockedBy!=BX.message("USER_ID")}))}e.buttons.push(e.getComplexSaveButton(this,{downloadUrl:e.downloadUrl,reloadAfterDownload:false,showEdit:true}));return e};var b={lastService:null,ajaxDocUrl:"/bitrix/tools/disk/document.php",ajaxUfDocUrl:"/bitrix/tools/disk/uf.php",normalizeServiceName:function(e){switch(e.toLowerCase()){case"g":case"google":case"gdrive":e="gdrive";break;case"s":case"skydrive":case"sky-drive":case"onedrive":e="onedrive";break;case"office365":e="office365";break;case"myoffice":e="myoffice";break;case"l":case"local":e="l";break;default:e="gdrive";break}return e},getUrlViewFile:function(e){e=this.addToLinkParam(e,"service","gvdrive");e=this.addToLinkParam(e,"document_action","show");return e},getUrlCheckView:function(e){e=this.addToLinkParam(e,"service","gvdrive");e=this.addToLinkParam(e,"document_action","checkView");return e},getUrlStartPublishBlank:function(f,e,g){e=this.normalizeServiceName(e);this.lastService=e;f=this.addToLinkParam(f,"service",e);f=this.addToLinkParam(f,"type",g);return f},getUrlCommitBlank:function(e,f,g){e=this.addToLinkParam(e,"service",this.lastService);e=this.addToLinkParam(e,"document_action","saveBlank");e=this.addToLinkParam(e,"type",f);if(g){e=this.addToLinkParam(e,"targetFolderId",g)}return e},getUrlRenameFile:function(e){e=this.addToLinkParam(e,"service",this.lastService);e=this.addToLinkParam(e,"document_action","rename");return e},getUrlCopyToMe:function(e){e=this.addToLinkParam(e,"action","copyToMe");return e},getUrlEditFile:function(f,e){e=this.normalizeServiceName(e);this.lastService=e;f=this.addToLinkParam(f,"service",e);return f},getUrlCommitFile:function(e){e=this.addToLinkParam(e,"service",this.lastService);e=this.addToLinkParam(e,"document_action","commit");return e},getUrlDiscardFile:function(e){e=this.addToLinkParam(e,"service",this.lastService);e=this.addToLinkParam(e,"document_action","discard");return e},addToLinkParam:function(f,e,g){if(!f.length){return"?"+e+"="+g}f=BX.util.remove_url_param(f,e);if(f.indexOf("?")!=-1){return f+"&"+e+"="+g}return f+"?"+e+"="+g}}})(window);