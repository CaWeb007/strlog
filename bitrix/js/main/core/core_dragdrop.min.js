(function(b){if(typeof(BX.DragDrop)!=="undefined"){return}BX.DragDrop=function(f){this.dragItemControlClassName=f.dragItemControlClassName||null;this.dragNodeList=document.body.querySelectorAll("."+f.dragItemClassName);this.dragStartCallback=f.dragStart||null;this.dragCallback=f.drag||null;this.dragOverCallback=f.dragOver||null;this.dragEnterCallback=f.dragEnter||null;this.dragLeaveCallback=f.dragLeave||null;this.dragDropCallback=f.dragDrop||null;this.dragEndCallback=f.dragEnd||null;this.dragActiveClass=f.dragActiveClass||null;this.activeDragElement=null;this.isDocDragover=false;this.isAutoScroll=false;this.scrollIntervalID=0;this.isScrollInterval=false;this.isSortable=false;this.isSortableActive=false;if(typeof(f.dropZoneList)=="string"){this.dropZoneNodeList=document.body.querySelectorAll("."+f.dropZoneList)}else{if(BX.type.isArray(f.dropZoneList)){this.dropZoneNodeList=f.dropZoneList}else{if(BX.type.isDomNode(f.dropZoneList)){this.dropZoneNodeList=[f.dropZoneList]}}}if(typeof f.sortable=="object"){var d=f.sortable.className?document.body.querySelectorAll("."+f.sortable.className):this.dragNodeList;var e=BX.convert.nodeListToArray(d);this.sortable={rootElem:f.sortable.rootElem,gagClass:f.sortable.gagClass,gagHtml:f.sortable.gagHtml||"",list:e,floating:/left|right|inline/.test(BX.style(e[0],"float")+BX.style(e[0],"display")),node:f.sortable.node||null,isNode:false};if(this.sortable.node){this.sortable.isNode=true}this.isSortable=true}this.dragEventX=0;this.dragEventY=0;this.scroll={edgeBottom:0,edgeTop:0,edgeLeft:0,edgeRight:0,height:0,width:0,visibleHeight:0,visibleWidth:0,speedX:10,speedY:10,prevPosDragEvY:-1,prevPosDragEvX:-1};this.isIE=(document.documentMode&&document.documentMode<=9)||false;this._bind()};BX.DragDrop.prototype={_bind:function(){if(this.dragNodeList&&this.dragNodeList.length>0){this.bindDragItem(this.dragNodeList)}if(this.dropZoneNodeList&&this.dropZoneNodeList.length>0){this.bindCatcher(this.dropZoneNodeList)}},bindDragItem:function(f){var g=this;var e=null;for(var d=f.length-1;d>=0;d--){e=null;if(this.dragItemControlClassName){e=f[d].querySelector("."+this.dragItemControlClassName);e=BX(e)}if(!e){e=f[d]}e.draggable=true;if(this.isIE){BX.bind(e,"selectstart",function(h){h=h||b.event;BX.PreventDefault(h);g.onSelect(h,this)})}BX.bind(e,"dragstart",BX.delegate(function(h){h=h||b.event;g.ondragStart(h,this)},f[d]));BX.bind(e,"drag",BX.proxy(this.ondrag,this));BX.bind(e,"dragend",BX.delegate(function(h){h=h||b.event;g.ondragEnd(h,this)},f[d]))}},bindCatcher:function(e){var f=this;for(var d=e.length-1;d>=0;d--){BX.bind(e[d],"dragover",function(g){if(f.isAutoScroll){g=g||b.event;f.dragEventX=g.clientX;f.dragEventY=g.clientY}BX.PreventDefault(g);g.dataTransfer.dropEffect="move";f.ondragOver(g,this)});BX.bind(e[d],"dragenter",function(g){g=g||b.event;BX.PreventDefault(g);f.ondragEnter(g,this)});BX.bind(e[d],"dragleave",function(g){g=g||b.event;BX.PreventDefault(g);f.ondragLeave(g,this)});BX.bind(e[d],"drop",function(g){g=g||b.event;BX.PreventDefault(g);f.ondragDrop(g,this)})}},addSortableItem:function(d){this.sortable.list.push(d)},removeSortableItem:function(e){for(var d=0;d<this.sortable.list.length;d++){if(this.sortable.list[d]==e){delete this.sortable.list[d]}}},addDragItem:function(d){this.bindDragItem(d)},addCatcher:function(d){this.dropZoneNodeList.push(d);this.bindCatcher([d])},removeCatcher:function(e){for(var d=this.dropZoneNodeList.length-1;d>=0;d--){if(this.dropZoneNodeList[d]==e){delete this.dropZoneNodeList[d]}}},onSelect:function(d,e){e.dragDrop();return false},ondragStart:function(d,e){d=d||b.event;d.dataTransfer.setData("text","");d.dataTransfer.effectAllowed="move";this.activeDragElement=e;if(document.body.scrollHeight>document.body.clientHeight||document.body.scrollWidth>document.body.clientWidth){this.setAutoScroll(d.clientX,d.clientY)}if(this.dragActiveClass){setTimeout(BX.proxy(function(){BX.addClass(this.activeDragElement,this.dragActiveClass)},this),10)}var f={dragElement:this.activeDragElement,sortableElement:(this.sortable&&this.sortable.node)?this.sortable.node:null,event:d};if(this.isSortable&&!this.isSortableActive){if(!this.sortable.isNode){this.sortable.node=this.activeDragElement;this.sortable.gagClass?setTimeout(BX.proxy(function(){BX.addClass(this.sortable.node,this.sortable.gagClass)},this),50):null}this.isSortableActive=true;this.sortableInterval=setInterval(BX.proxy(this.sortableMove,this),100)}if(typeof(this.dragStartCallback)=="function"){this.dragStartCallback(f)}},setAutoScroll:function(k,j){var h=BX.pos(this.activeDragElement),l=h.bottom,g=h.top,f=h.left,i=h.right,d=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.scrollLeft||document.body.scrollLeft;this.scroll.visibleHeight=document.body.clientHeight;this.scroll.visibleWidth=document.body.clientWidth;this.scroll.edgeBottom=this.scroll.visibleHeight+d-(l-j);this.scroll.edgeTop=d+(j-g);this.scroll.edgeLeft=e+(k-f);this.scroll.edgeRight=this.scroll.visibleWidth+e-(i-k);this.scroll.height=document.body.scrollHeight;this.scroll.width=document.body.scrollWidth;this.scroll.prevPosDragEvY=j;this.scroll.prevPosDragEvX=k;this.isAutoScroll=true},sortableMove:function(){var p=document.elementFromPoint(this.dragEventX,this.dragEventY);if(p===null){return}var l=this.sortable.node;while(p!==null&&p!=document.body){for(var g=this.sortable.list.length-1;g>=0;g--){if(p==this.sortable.list[g]){l=this.sortable.list[g];break}}p=p.parentNode}var h=false,k=false,e=l,d=l,f=c(l),q=l==this.sortable.node,o=l.getBoundingClientRect(),m=this.sortable.node.getBoundingClientRect(),j=0,n;while((e||d)&&!q){if(e){e=c(e)}if(d){d=a(d)}if(e==this.sortable.node||d==this.sortable.node){h=e==this.sortable.node;k=d==this.sortable.node;break}}if(!q&&k){if(this.sortable.floating){j=o.right-(m.right-m.left);n=this.dragEventX}else{j=o.bottom-(m.bottom-m.top);n=this.dragEventY}if(f&&n>j){this.sortable.rootElem.insertBefore(this.sortable.node,l.nextSibling)}else{if(!f&&n>j){this.sortable.rootElem.appendChild(this.sortable.node)}}}else{if(!q&&h){if(this.sortable.floating){j=o.left+(m.right-m.left);n=this.dragEventX}else{j=o.top+(m.bottom-m.top);n=this.dragEventY}if(f&&n<j){this.sortable.rootElem.insertBefore(this.sortable.node,l)}else{if(!f&&n<j){this.sortable.rootElem.appendChild(this.sortable.node)}}}}},ondrag:function(e){var d=e||b.event;var f=(d.clientY===0||d.clientX===0)||false;if(!this.isDocDragover&&f){BX.bind(document,"dragover",BX.proxy(this._ondrag,this));this.isDocDragover=true}else{if(d.clientY>0||d.clientX>0){this.dragEventX=d.clientX;this.dragEventY=d.clientY;if(!this.isScrollInterval){this.scrollIntervalID=setInterval(BX.proxy(this.autoScrollScroll,this),50);this.isScrollInterval=true}}}if(typeof(this.dragCallback)=="function"){setTimeout(BX.proxy(function(){if(f){d.clientFFX=this.dragEventX;d.clientFFY=this.dragEventY}this.dragCallback(this.activeDragElement,this.sortable?this.sortable.node:null,d)},this),0)}},_ondrag:function(d){this.dragEventX=d.clientX;this.dragEventY=d.clientY;if(!this.isScrollInterval&&this.isAutoScroll){this.scrollIntervalID=setInterval(BX.proxy(this.autoScrollScroll,this),50);this.isScrollInterval=true}},autoScrollScroll:function(){var h=document.documentElement.scrollTop||document.body.scrollTop;var i=document.documentElement.scrollLeft||document.body.scrollLeft;var g=this.scroll.prevPosDragEvX>=this.dragEventX||false;var f=this.scroll.prevPosDragEvX<=this.dragEventX||false;var e=this.scroll.prevPosDragEvY>=this.dragEventY||false;var d=this.scroll.prevPosDragEvY<=this.dragEventY||false;if(i>0&&this.dragEventX<=this.scroll.edgeLeft&&g){i-=this.scroll.speedX;b.scrollTo(i,h);if(this.scroll.speedX<100){this.scroll.speedX+=1}this.scroll.prevPosDragEvX=this.dragEventX}else{if((i+this.scroll.visibleWidth)<this.scroll.width&&this.dragEventX>=this.scroll.edgeRight&&f){i+=this.scroll.speedX;b.scrollTo(i,h);if(this.scroll.speedX<100){this.scroll.speedX+=1}this.scroll.prevPosDragEvX=this.dragEventX}else{this.scroll.speedX=15}}if(h>0&&this.dragEventY<=this.scroll.edgeTop&&e){h-=this.scroll.speedY;b.scrollTo(i,h);if(this.scroll.speedY<100){this.scroll.speedY+=1}this.scroll.prevPosDragEvY=this.dragEventY}else{if((h+this.scroll.visibleHeight)<this.scroll.height&&this.dragEventY>=this.scroll.edgeBottom&&d){h+=this.scroll.speedY;b.scrollTo(i,h);if(this.scroll.speedY<100){this.scroll.speedY+=1}this.scroll.prevPosDragEvY=this.dragEventY}else{this.scroll.speedY=10}}},ondragOver:function(d,e){if(typeof(this.dragOverCallback)=="function"){this.dragOverCallback(e,this.activeDragElement,d)}},ondragEnter:function(d,e){if(typeof(this.dragEnterCallback)=="function"){this.dragEnterCallback(e,this.activeDragElement,d)}},ondragLeave:function(d,e){if(typeof(this.dragLeaveCallback)=="function"){this.dragLeaveCallback(e,this.activeDragElement,d)}},ondragDrop:function(e,d){if(typeof(this.dragDropCallback)=="function"){this.dragDropCallback(d,this.activeDragElement,e)}},ondragEnd:function(d,e){clearInterval(this.scrollIntervalID);this.isScrollInterval=false;this.isSortableActive=false;if(this.sortable&&this.sortable.gagClass){BX.removeClass(this.sortable.node,this.sortable.gagClass)}BX.unbind(document,"dragover",BX.proxy(this._ondrag,this));this.isDocDragover=false;if(typeof(this.dragEndCallback)=="function"){this.dragEndCallback(e,this.sortable?this.sortable.node:null,d)}if(this.dragActiveClass){setTimeout(BX.proxy(function(){BX.removeClass(this.activeDragElement,this.dragActiveClass)},this),0)}clearInterval(this.sortableInterval)}};BX.DragDrop.create=function(d){return new BX.DragDrop(d)};function c(d){if(document.documentElement.nextElementSibling!==undefined){return d.nextElementSibling}else{var e=d.nextSibling;while(e&&e.nodeType!=1){e=e.nextSibling}return e}}function a(d){if(document.documentElement.previousElementSibling!==undefined){return d.previousElementSibling}else{var e=d.previousSibling;while(e&&e.nodeType!=1){e=e.previousSibling}return e}}})(window);