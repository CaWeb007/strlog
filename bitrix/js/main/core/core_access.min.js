(function(){var a=window.BX;if(a.Access){return}a.Access={bInit:false,waitDiv:null,waitPopup:null,bDialogLoaded:false,selectedProvider:"",obSelected:{},obCnt:{__providers_cnt:0},obAlreadySelected:{},obSelectedBind:{},showSelected:false,popup:null,callback:null,obProviderNames:{},arParams:{}};a.Access.Init=function(b){if(b){a.Access.arParams=b}if(a.Access.bInit){return}a.Access.bInit=true;a.ready(a.delegate(function(){a.Access.popup=a.PopupWindowManager.create("BXUserRights",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,draggable:{restrict:true},closeByEsc:true,titleBar:a.message("js_access_title"),contentColor:"white",contentNoPaddings:true,closeIcon:true,buttons:[new a.PopupWindowButton({text:a.message("js_access_select"),className:"popup-window-button-accept",events:{click:function(){a.Access.SaveLRU();a.Access.SaveSelected();if(a.Access.callback){a.Access.callback(a.Access.obSelected)}this.popupWindow.close()}}}),new a.PopupWindowButtonLink({text:a.message("js_access_close"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],content:'<div class="access-container"></div>',events:{onAfterPopupShow:function(){if(!a.Access.bDialogLoaded){a.Access.showWait(this.contentContainer);a.ajax.post("/bitrix/tools/access_dialog.php",{lang:a.message("LANGUAGE_ID"),site_id:a.message("SITE_ID")||"",arParams:a.Access.arParams},a.delegate(function(d){this.setContent(d);a.Access.closeWait();a.Access.bDialogLoaded=true;if(a.Access.showSelected){for(var e in a.Access.obAlreadySelected){if(typeof(a.Access.obAlreadySelected[e])=="object"){a.Access.AddSelection(a.Access.obAlreadySelected[e])}}}},this))}else{if(a.Access.showSelected){for(var c in a.Access.obAlreadySelected){if(typeof(a.Access.obAlreadySelected[c])=="object"){a.Access.AddSelection(a.Access.obAlreadySelected[c])}}}}a.onCustomEvent(a.Access,"onAfterPopupShow",[])},onPopupClose:function(){a.Access.ClearSelection()}}})},this))};a.Access.ShowForm=function(b){if(!b.bind){b.bind="bind"}a.Access.bind=b.bind;a.Access.showSelected=b.showSelected===true;if(a.Access.obSelectedBind[b.bind]){a.Access.obAlreadySelected=a.Access.obSelectedBind[b.bind]}else{a.Access.obAlreadySelected={}}a.Access.callback=b.callback;a.Access.popup.params.zIndex=(a.WindowManager?a.WindowManager.GetZIndex():0);a.Access.popup.show()};a.Access.showWait=function(d){a.Access.waitDiv=a.Access.waitDiv||d;d=a(d||a.Access.waitDiv);if(!a.Access.waitPopup){a.Access.waitPopup=new a.PopupWindow("ur_wait",d,{autoHide:true,lightShadow:true,zIndex:(a.WindowManager?a.WindowManager.GetZIndex():2),content:a.create("DIV",{props:{className:"ur-wait"}})})}else{a.Access.waitPopup.setBindElement(d)}var b=d.offsetHeight,c=d.offsetWidth;if(b>0&&c>0){a.Access.waitPopup.setOffset({offsetTop:-parseInt(b/2+15),offsetLeft:parseInt(c/2-15)});a.Access.waitPopup.show()}return a.Access.waitPopup};a.Access.closeWait=function(){if(a.Access.waitPopup){a.Access.waitPopup.close()}};a.Access.SelectProvider=function(b){if(a.Access.selectedProvider!=""){a("access_btn_"+a.Access.selectedProvider).className="access-provider-button";a("access_provider_"+a.Access.selectedProvider).style.display="none"}a("access_btn_"+b).className="access-provider-button access-provider-button-selected";a("access_provider_"+b).style.display="";a.Access.selectedProvider=b;a.onCustomEvent(a.Access,"onSelectProvider",[{provider:b}])};a.Access.AddSelection=function(b){if(!b.provider){return}if(!a.Access.obSelected[b.provider]){a.Access.obSelected[b.provider]={};a.Access.obCnt[b.provider]=0;a.Access.obCnt.__providers_cnt++}if(!a.Access.obSelected[b.provider][b.id]){a.Access.obSelected[b.provider][b.id]=a.clone(b);a.Access.obCnt[b.provider]++;a("access_selected_title").style.display="none";a("access_selected_provider_"+b.provider).style.display="";a("access_selected_items_"+b.provider).appendChild(a.create("div",{props:{className:"bx-finder-box-selected-item",id:"access_selected_item_"+b.id},html:'<a href="javascript:void(0);" onclick="BX.Access.RemoveSelection(\''+b.provider+"', '"+b.id+'\')" class="bx-finder-box-selected-item-icon"></a><span class="bx-finder-box-selected-item-text">'+b.name+"</span>"}));a("access_sel_count_"+b.provider).innerHTML="("+a.Access.obCnt[b.provider]+")"}};a.Access.RemoveSelection=function(c,d){delete a.Access.obSelected[c][d];a.Access.obCnt[c]--;var b=a("access_selected_item_"+d);b.parentNode.removeChild(b);if(a.Access.obCnt[c]==0){delete a.Access.obSelected[c];a.Access.obCnt.__providers_cnt--;a("access_selected_provider_"+c).style.display="none";if(a.Access.obCnt.__providers_cnt==0){a("access_selected_title").style.display=""}}else{a("access_sel_count_"+c).innerHTML="("+a.Access.obCnt[c]+")"}a.onCustomEvent(a.Access,"onDeleteItem",[{provider:c,id:d}])};a.Access.ClearSelection=function(){for(var b in a.Access.obSelected){for(var c in a.Access.obSelected[b]){a.Access.RemoveSelection(b,c)}}a.Access.obSelected={}};a.Access.SaveLRU=function(){a.ajax.post("/bitrix/tools/access_dialog.php",{LRU:a.Access.obSelected,mode:"save_lru",sessid:a.bitrix_sessid()})};a.Access.SaveSelected=function(){if(a.Access.showSelected||!a.Access.obSelectedBind[a.Access.bind]){a.Access.obSelectedBind[a.Access.bind]={}}for(var c in a.Access.obSelected){for(var b in a.Access.obSelected[c]){if(a.Access.showSelected){a.Access.obSelectedBind[a.Access.bind][b]={id:b,provider:c,name:a.Access.obSelected[c][b].name}}else{a.Access.obSelectedBind[a.Access.bind][b]=true}}}};a.Access.SetSelected=function(b,c){if(!c){c="bind"}a.Access.obSelectedBind[c]=b};a.Access.DeleteSelected=function(c,b){if(!b){b="bind"}if(a.Access.obSelectedBind[b]&&a.Access.obSelectedBind[b][c]){delete a.Access.obSelectedBind[b][c]}};a.Access.GetProviderName=function(b){if(a.Access.obProviderNames[b]){return a.Access.obProviderNames[b].name}return""};a.Access.GetProviderPrefix=function(e,f){if(a.Access.obProviderNames[e]){var c=a.Access.obProviderNames[e]["prefixes"];for(var b in c){var d=new RegExp(c[b]["pattern"]);if(d.test(f)){return c[b]["prefix"]}}return a.Access.obProviderNames[e].name}return""}})();