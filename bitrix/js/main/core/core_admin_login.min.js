(function(){if(window.BX.adminLogin){return}BX.adminLogin=function(a){BX.adminLogin=this;this.current_form=null;this.start_form=a.start_form;this.post_data=a.post_data;this.url=a.url||window.location.href;this.arForms={};this.error_block=null;this.animation_duration=a.animation_duration||500;this.form=a.form;this.login_wrapper=a.login_wrapper;this.window_wrapper=a.window_wrapper;this.popup_alignment=a.popup_alignment;this.auth_form_wrapper=a.auth_form_wrapper;this.login_variants=a.login_variants;BX.AUTHAGENT=this;BX.ready(BX.proxy(this.Init,this))};BX.adminLogin.prototype.registerForm=function(a){this.arForms[a.name]=a};BX.adminLogin.prototype.Init=function(){this.form=document.forms[this.form];this.login_wrapper=BX(this.login_wrapper);this.window_wrapper=BX(this.window_wrapper);this.popup_alignment=BX(this.popup_alignment);this.auth_form_wrapper=BX(this.auth_form_wrapper);this.login_variants=BX(this.login_variants);for(var a in this.arForms){if(this.arForms.hasOwnProperty(a)){this.arForms[a].Init(this.form)}}var b=window.location.hash;if(b.substring(0,1)=="#"){b=b.substring(1,b.length)}b=b.replace(/_message/g,"");if(!this.arForms[b]){b=this.start_form}if(b!=this.start_form){this.login_variants.appendChild(this.arForms[this.start_form].container);this.auth_form_wrapper.appendChild(this.arForms[b].container)}BX.bindDelegate(this.form,"keydown",{tagName:"INPUT"},BX.proxy(this.hideError,this));BX.bind(this.form,"submit",BX.proxy(this.hideError,this));this.toggleAuthForm(this.arForms[b]);this._listenerTimeout=setTimeout(BX.delegate(this._checkHash,this),1000)};BX.adminLogin.prototype._checkHash=function(){return;if(BX.browser.IsOpera()){return}var a=window.location.hash.replace("#","");a=a.replace(/_message/g,"");if(this.current_form&&a!=this.current_form.name){this.toggleAuthForm(a)}this._listenerTimeout=setTimeout(BX.delegate(this._checkHash,this),1000)};BX.adminLogin.prototype.toggleAuthForm=function(a){if(BX.type.isString(a)){a=this.arForms[a]}if(!a||a==this.current_form){return}this.hideError();if(!!this.current_form){this.removeAuthForm(this.current_form,BX.delegate(function(){this.addAuthForm(a)},this))}else{this.current_form=a;this.addAuthForm(a)}};BX.adminLogin.prototype.showAuthForm=function(a){this.current_form=a;BX.removeClass(document.body,"login-animate-popup2");BX.addClass(document.body,"login-animate-popup");BX.defer(a.onshow,a)();BX.bind(this.form,"submit",BX.proxy(a.validate,a));this._listenerTimeout=setTimeout(BX.delegate(this._checkHash,this),1000)};BX.adminLogin.prototype.addAuthForm=function(a){if(this._listenerTimeout){clearInterval(this._listenerTimeout)}window.location.hash=a.name;if(a.container!=this.auth_form_wrapper){this.auth_form_wrapper.appendChild(a.container)}BX.defer(this.showAuthForm,this)(a)};BX.adminLogin.prototype.removeAuthForm=function(b,a){BX.unbind(this.form,"submit",BX.proxy(b.validate,b));this.popup_alignment.style.display="table-cell";this.popup_alignment.style.textAlign="center";BX.removeClass(document.body,"login-animate-popup");BX.addClass(document.body,"login-animate-popup2");BX.defer(function(){this.login_variants.appendChild(b.container);if(a){a()}BX.defer(function(){BX.defer(b.onclose,b)()})()},this)()};BX.adminLogin.prototype._loadAdmin=function(c){if(BX.util.trim(c).length>0){var b=BX.GetWindowSize();if(b.scrollHeight<=b.innerHeight){document.body.style.overflow="hidden"}var a=this.window_wrapper;a.style.height=b.innerHeight+"px";BX.bind(window,"resize",function(){var d=BX.GetWindowSize();a.style.height=d.innerHeight+"px"});a.innerHTML=c;a.style.display="block";setTimeout(BX.delegate(function(){BX.removeClass(document.body,"login-animate");BX.addClass(document.body,"login-last-animate");BX.defer(BX.delegate(function(){var d=function(){if(b.scrollHeight<=b.innerHeight){document.body.style.overflow="auto"}if(this.parentNode){this.parentNode.removeChild(this)}BX.removeClass(document.body,"login-animate-popup2");BX.removeClass(document.body,"login-animate-popup");BX.removeClass(document.body,"login-last-animate");if(BX.adminLogin){BX.adminLogin.Destroy()}};BX.bind(document.body,"transitionend",BX.proxy(d,this.login_wrapper));setTimeout(BX.delegate(d,this.login_wrapper),700)},this))()},this),30)}};BX.adminLogin.prototype.setAuthResult=function(a){if(this.form.USER_PASSWORD){this.form.USER_PASSWORD.disabled=false}if(this.form.USER_CONFIRM_PASSWORD){this.form.USER_CONFIRM_PASSWORD.disabled=false}if(!!a){this.current_form.onerror(a)}else{BX.ajax({url:this.url,method:!!this.post_data?"POST":"GET",data:this.post_data,onsuccess:BX.delegate(this._loadAdmin,this),onfailure:function(){BX.debug(arguments);BX.reload()}})}};BX.adminLogin.prototype.showError=function(c,a,e,b){this.hideError();BX.addClass(this.current_form.container,"login-popup-error");c=this.form[c];var d=BX.pos(c);this.error_block=this.login_wrapper.appendChild(BX.create("DIV",{props:{className:"login-error-message-block"},style:{top:d.top+"px",left:d.right+"px"},html:'<div class="login-error-message" id="error-message">'+(a.TITLE||BX.message("admin_authorize_error"))+'<span class="login-error-red">'+a.MESSAGE+"</span></div>"}));this.error_block.style.display="block";this.error_block.style.opacity="1";BX.defer(function(){this.style.width=BX.firstChild(this).offsetWidth+"px"},this.error_block)();this.error_block._bxresizehandler=BX.defer(function(){var f=BX.pos(c);this.style.top=f.top+"px";this.style.left=f.right+"px"},this.error_block);BX.bind(window,"resize",this.error_block._bxresizehandler)};BX.adminLogin.prototype.hideError=function(){if(!!this.current_form){BX.removeClass(this.current_form.container,"login-popup-error")}if(this.error_block&&!!this.error_block.parentNode){this.error_block.parentNode.removeChild(this.error_block);BX.unbind(window,"resize",this.error_block._bxresizehandler);this.error_block._bxresizehandler=null}BX.defer(this.enableFields,this)()};BX.adminLogin.prototype.enableFields=function(){for(var a=0;a<this.form.elements.length;a++){if(this.form.elements[a].disabled){this.form.elements[a].disabled=false}}};BX.adminLogin.prototype.Destroy=function(){this.arForms=null;BX.adminLogin=null};BX.IAdminAuthForm=function(a,b){this.container=a;this.params=b;this.form=null};BX.IAdminAuthForm.prototype.Init=function(a){this.form=a;this.container=BX(this.container)};BX.IAdminAuthForm.prototype.validate=function(a){};BX.IAdminAuthForm.prototype.onshow=function(){this.form.action=this.params.url};BX.IAdminAuthForm.prototype.onclose=function(){};BX.IAdminAuthForm.prototype.onerror=function(a){alert(a.MESSAGE||a)};BX.IAdminAuthForm.prototype.fix=function(){var a=BX.pos(this.container);this.form.style.marginTop=(a.top-60)+"px";this.form.style.marginLeft=a.left+"px";BX("popup_alignment",true).style.textAlign="left";BX("popup_alignment",true).style.verticalAlign="top";BX.bind(window,"resize",BX.delegate(function(){var d=BX.GetWindowSize(),b=((d.innerHeight-this.offsetHeight)/2)-60,c=((d.innerWidth-this.offsetWidth)/2);if(b>=54&&d.innerHeight>=768){this.style.marginTop=b+"px"}else{this.style.marginTop=54+"px"}if(c>=115&&d.innerWidth>=716){this.style.marginLeft=c+"px"}else{this.style.marginLeft=115+"px"}},this.form))};BX.IAdminAuthForm.prototype.showCaptcha=function(a){if(!!a.CAPTCHA){this.fix();this.form.captcha_sid.value=a.CAPTCHA_CODE;this.form.captcha_word.disabled=false;BX("captcha_image").innerHTML='<img src="/bitrix/tools/captcha.php?captcha_sid='+a.CAPTCHA_CODE+'" width="180" height="40" alt="CAPTCHA" />';BX.addClass(this.container,"login-captcha-popup-wrap");this._setTabIndex()}};BX.authFormAuthorize=function(a,b){this.name="authorize";BX.authFormAuthorize.superclass.constructor.apply(this,arguments)};BX.extend(BX.authFormAuthorize,BX.IAdminAuthForm);BX.authFormAuthorize.prototype.validate=function(a){if(BX.util.trim(this.form.USER_LOGIN.value=="")){BX.defer(BX.focus)(this.form.USER_LOGIN);return BX.PreventDefault(a)}if(BX.util.trim(this.form.USER_PASSWORD.value=="")){BX.defer(BX.focus)(this.form.USER_PASSWORD);return BX.PreventDefault(a)}if(BX.hasClass(this.container,"login-captcha-popup-wrap")&&BX.util.trim(this.form.captcha_word.value=="")){BX.defer(BX.focus)(this.form.captcha_word);return BX.PreventDefault(a)}BX.addClass(this.container,"login-loading-active");return true};BX.authFormAuthorize.prototype._setTabIndex=function(){var b=["USER_LOGIN","USER_PASSWORD"];if(!!this.form.USER_REMEMBER){b.push("USER_REMEMBER")}if(!!this.form.captcha_sid.value){b.push("captcha_word")}else{this.form.captcha_word.disabled=true}b.push("Login");for(var a=0;a<b.length;a++){this.form[b[a]].tabIndex=a+1}};BX.authFormAuthorize.prototype.onshow=function(){BX.authFormAuthorize.superclass.onshow.apply(this,arguments);if(this.form.USER_LOGIN.value.length<=0){BX.defer(BX.focus)(this.form.USER_LOGIN)}else{BX.defer(BX.focus)(this.form.USER_PASSWORD)}this._setTabIndex()};BX.authFormAuthorize.prototype.onerror=function(a){if(a.MESSAGE===false){BX.adminLogin._lastError=a;BX.adminLogin.toggleAuthForm("otp")}else{BX.addClass(this.container,"login-popup-error-shake");setTimeout(BX.delegate(function(){BX.removeClass(this.container,"login-loading-active");BX.removeClass(this.container,"login-popup-error-shake");a.TITLE=BX.message("admin_authorize_error");BX.adminLogin.showError("USER_PASSWORD",a);this.showCaptcha(a)},this),400)}};BX.authFormOtp=function(a,b){this.name="otp";BX.authFormOtp.superclass.constructor.apply(this,arguments)};BX.extend(BX.authFormOtp,BX.IAdminAuthForm);BX.authFormOtp.prototype.onshow=function(){BX.authFormOtp.superclass.onshow.apply(this,arguments);if(!!BX.adminLogin._lastError){this.showCaptcha(BX.adminLogin._lastError);BX.adminLogin._lastError=null}BX.defer(BX.focus)(this.form.USER_OTP)};BX.authFormOtp.prototype.validate=function(a){if(BX.util.trim(this.form.USER_OTP.value=="")){BX.defer(BX.focus)(this.form.USER_OTP);return BX.PreventDefault(a)}if(BX.hasClass(this.container,"login-captcha-popup-wrap")&&BX.util.trim(this.form.captcha_word.value=="")){BX.defer(BX.focus)(this.form.captcha_word);return BX.PreventDefault(a)}BX.addClass(this.container,"login-loading-active");return true};BX.authFormOtp.prototype.onerror=function(a){BX.addClass(this.container,"login-popup-error-shake");setTimeout(BX.delegate(function(){BX.removeClass(this.container,"login-loading-active");BX.removeClass(this.container,"login-popup-error-shake");a.TITLE=BX.message("admin_authorize_error");BX.adminLogin.showError("USER_OTP",a);this.showCaptcha(a)},this),400)};BX.authFormForgotPassword=function(a,b){this.name="forgot_password";this.needCaptcha=b.needCaptcha;this.message=b.message;BX.authFormForgotPassword.superclass.constructor.apply(this,arguments)};BX.extend(BX.authFormForgotPassword,BX.IAdminAuthForm);BX.authFormForgotPassword.prototype.validate=function(a){if(BX.util.trim(this.form.USER_LOGIN.value=="")&&BX.util.trim(this.form.USER_EMAIL.value=="")){BX.defer(BX.focus)(this.form.USER_LOGIN);return BX.PreventDefault(a)}return true};BX.authFormForgotPassword.prototype.onshow=function(){BX.authFormForgotPassword.superclass.onshow.apply(this,arguments);BX.defer(BX.focus)(document.form_auth.USER_LOGIN)};BX.authFormForgotPassword.prototype.onerror=function(a){if(a.TYPE=="OK"){this.message.setContent(a.MESSAGE);BX.adminLogin.toggleAuthForm("forgot_password_message")}else{var b=this.needCaptcha&&!BX.hasClass(this.container,"login-captcha-popup-wrap");if(!b){BX.addClass(this.container,"login-popup-error-shake");setTimeout(BX.delegate(function(){BX.removeClass(this.container,"login-loading-active");BX.removeClass(this.container,"login-popup-error-shake");a.TITLE=BX.message("admin_forgot_password_error");BX.adminLogin.showError("USER_LOGIN",a);this.showCaptcha(a)},this),400)}else{this.showCaptcha(a)}}};BX.authFormForgotPasswordMessage=function(a,b){this.name="forgot_password_message";BX.authFormForgotPasswordMessage.superclass.constructor.apply(this,arguments)};BX.extend(BX.authFormForgotPasswordMessage,BX.IAdminAuthForm);BX.authFormForgotPasswordMessage.prototype.setContent=function(a){BX("forgot_password_message_inner",true).innerHTML='<div class="adm-info-message-title">'+BX.message("admin_authorize_info")+"</div>"+a+'<div class="adm-info-message-icon"></div>'};BX.authFormChangePassword=function(a,b){this.name="change_password";this.needCaptcha=b.needCaptcha;this.message=b.message;BX.authFormChangePassword.superclass.constructor.apply(this,arguments)};BX.extend(BX.authFormChangePassword,BX.IAdminAuthForm);BX.authFormChangePassword.prototype.validate=function(a){if(BX.util.trim(this.form.USER_LOGIN.value=="")){BX.defer(BX.focus)(this.form.USER_LOGIN);return BX.PreventDefault(a)}if(BX.util.trim(this.form.USER_CHECKWORD.value=="")){BX.defer(BX.focus)(this.form.USER_CHECKWORD);return BX.PreventDefault(a)}if(BX.util.trim(this.form.USER_PASSWORD.value=="")){BX.defer(BX.focus)(this.form.USER_PASSWORD);return BX.PreventDefault(a)}if(BX.util.trim(this.form.USER_CONFIRM_PASSWORD.value=="")){BX.defer(BX.focus)(this.form.USER_CONFIRM_PASSWORD);return BX.PreventDefault(a)}if(this.form.USER_PASSWORD.value!=this.form.USER_CONFIRM_PASSWORD.value){BX.adminLogin.showError("USER_CONFIRM_PASSWORD",{TITLE:BX.message("admin_change_password_error"),MESSAGE:BX.message("AUTH_NEW_PASSWORD_CONFIRM_WRONG")});BX.defer(BX.focus)(this.form.USER_PASSWORD);return BX.PreventDefault(a)}return true};BX.authFormChangePassword.prototype.onshow=function(){BX.authFormChangePassword.superclass.onshow.apply(this,arguments);if(this.form.USER_LOGIN.value!=""){if(this.form.USER_CHECKWORD!=""){BX.defer(BX.focus)(this.form.USER_CHECKWORD)}else{BX.defer(BX.focus)(this.form.USER_PASSWORD)}}else{BX.defer(BX.focus)(this.form.USER_LOGIN)}};BX.authFormChangePassword.prototype.onerror=function(a){if(a.TYPE=="OK"){this.message.setContent(a.MESSAGE);BX.adminLogin.toggleAuthForm("change_password_message")}else{var b=this.needCaptcha&&!BX.hasClass(this.container,"login-captcha-popup-wrap");if(!b){BX.addClass(this.container,"login-popup-error-shake");setTimeout(BX.delegate(function(){a.TITLE=BX.message("admin_change_password_error");BX.removeClass(this.container,"login-loading-active");BX.removeClass(this.container,"login-popup-error-shake");switch(a.FIELD){case"LOGIN":BX.adminLogin.showError("USER_LOGIN",a);break;case"CHECKWORD":BX.adminLogin.showError("USER_CHECKWORD",a);break;case"CHECKWORD_EXPIRE":this.fix();BX("change_password_forgot_link").style.display="inline-block";BX.adminLogin.showError("USER_CHECKWORD",a);break;default:BX.adminLogin.showError("USER_CONFIRM_PASSWORD",a)}this.showCaptcha(a)},this),400)}else{this.showCaptcha(a)}}};BX.authFormChangePasswordMessage=function(a,b){this.name="change_password_message";BX.authFormForgotPasswordMessage.superclass.constructor.apply(this,arguments)};BX.extend(BX.authFormChangePasswordMessage,BX.IAdminAuthForm);BX.authFormChangePasswordMessage.prototype.setContent=function(a){BX("change_password_message_inner",true).innerHTML='<div class="adm-info-message-title">'+BX.message("admin_authorize_info")+"</div>"+a+'<div class="adm-info-message-icon"></div>'}})();