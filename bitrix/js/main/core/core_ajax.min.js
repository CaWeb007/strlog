(function(e){if(e.BX.ajax){return}var b=e.BX,h={},d={method:"GET",dataType:"html",timeout:0,async:true,processData:true,scriptsRunFirst:false,emulateOnload:true,skipAuthCheck:false,start:true,cache:true,preparePost:true,headers:false,lsTimeout:30,lsForce:false},g=null,f={},l=[],a={url_utf:/[^\034-\254]+/g,script_self:/\/bitrix\/js\/main\/core\/core(_ajax)*.js$/i,script_self_window:/\/bitrix\/js\/main\/core\/core_window.js$/i,script_self_admin:/\/bitrix\/js\/main\/core\/core_admin.js$/i,script_onload:/window.onload/g};b.ajax=function(m){var n,p;if(!m||!m.url||!b.type.isString(m.url)){return false}for(var q in h){if(typeof(m[q])=="undefined"){m[q]=h[q]}}h={};for(q in d){if(typeof(m[q])=="undefined"){m[q]=d[q]}}m.method=m.method.toUpperCase();if(!b.localStorage){m.lsId=null}if(b.browser.IsIE()){var w=a.url_utf.exec(m.url);if(w){do{m.url=m.url.replace(w,b.util.urlencode(w));w=a.url_utf.exec(m.url)}while(w)}}if(m.dataType=="json"){m.emulateOnload=false}if(!m.cache&&m.method=="GET"){m.url=b.ajax._uncache(m.url)}if(m.method=="POST"&&m.preparePost){m.data=b.ajax.prepareData(m.data)}var u=true;if(m.lsId&&!m.lsForce){var t=b.localStorage.get("ajax-"+m.lsId);if(t!==null){u=false;var r=function(x){if(x.key=="ajax-"+m.lsId&&x.value!="BXAJAXWAIT"){var y=x.value,v=!!x.oldValue&&y==null;if(!v){b.ajax.__run(m,y)}else{if(m.onfailure){m.onfailure("timeout")}}b.removeCustomEvent("onLocalStorageChange",r)}};if(t=="BXAJAXWAIT"){b.addCustomEvent("onLocalStorageChange",r)}else{setTimeout(function(){r({key:"ajax-"+m.lsId,value:t})},10)}}}if(u){m.xhr=b.ajax.xhr();if(!m.xhr){return}if(m.lsId){b.localStorage.set("ajax-"+m.lsId,"BXAJAXWAIT",m.lsTimeout)}m.xhr.open(m.method,m.url,m.async);if(!m.skipBxHeader&&!b.ajax.isCrossDomain(m.url)){m.xhr.setRequestHeader("Bx-ajax","true")}if(m.method=="POST"&&m.preparePost){m.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}if(typeof(m.headers)=="object"){for(q=0;q<m.headers.length;q++){m.xhr.setRequestHeader(m.headers[q].name,m.headers[q].value)}}if(!!m.onprogress){b.bind(m.xhr,"progress",m.onprogress)}var o=false;var s=m.xhr.onreadystatechange=function(v){if(o){return}if(v==="timeout"){if(m.onfailure){m.onfailure("timeout")}b.onCustomEvent(m.xhr,"onAjaxFailure",["timeout","",m]);m.xhr.onreadystatechange=b.DoNothing;m.xhr.abort();if(m.async){m.xhr=null}}else{if(m.xhr.readyState==4||v=="run"){n=b.ajax.xhrSuccess(m.xhr)?"success":"error";o=true;m.xhr.onreadystatechange=b.DoNothing;if(n=="success"){var x=(!!m.skipAuthCheck||b.ajax.isCrossDomain(m.url))?false:m.xhr.getResponseHeader("X-Bitrix-Ajax-Status");if(!!x&&x=="Authorize"){if(m.onfailure){m.onfailure("auth",m.xhr.status)}b.onCustomEvent(m.xhr,"onAjaxFailure",["auth",m.xhr.status,m])}else{var y=m.xhr.responseText;if(m.lsId){b.localStorage.set("ajax-"+m.lsId,y,m.lsTimeout)}b.ajax.__run(m,y)}}else{if(m.onfailure){m.onfailure("status",m.xhr.status)}b.onCustomEvent(m.xhr,"onAjaxFailure",["status",m.xhr.status,m])}if(m.async){m.xhr=null}}}};if(m.async&&m.timeout>0){setTimeout(function(){if(m.xhr&&!o){s("timeout")}},m.timeout*1000)}if(m.start){m.xhr.send(m.data);if(!m.async){s("run")}}return m.xhr}};b.ajax.xhr=function(){if(e.XMLHttpRequest){try{return new XMLHttpRequest()}catch(m){}}else{if(e.ActiveXObject){try{return new e.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(m){}try{return new e.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(m){}try{return new e.ActiveXObject("Msxml2.XMLHTTP")}catch(m){}try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(m){}throw new Error("This browser does not support XMLHttpRequest.")}}return null};b.ajax.isCrossDomain=function(n,m){m=m||e.location;if(n.indexOf("//")===0){n=m.protocol+n}if(n.indexOf("http")!==0){return false}var o=e.document.createElement("a");o.href=n;return o.protocol!==m.protocol||o.hostname!==m.hostname||b.ajax.getHostPort(o.protocol,o.host)!==b.ajax.getHostPort(m.protocol,m.host)};b.ajax.getHostPort=function(o,n){var m=/:(\d+)$/.exec(n);if(m){return m[1]}else{if(o==="http:"){return"80"}else{if(o==="https:"){return"443"}}}return""};b.ajax.__prepareOnload=function(n){if(n.length>0){b.ajax["onload_"+g]=null;for(var o=0,m=n.length;o<m;o++){if(n[o].isInternal){n[o].JS=n[o].JS.replace(a.script_onload,"BX.ajax.onload_"+g)}}}b.CaptureEventsGet();b.CaptureEvents(e,"load")};b.ajax.__runOnload=function(){if(null!=b.ajax["onload_"+g]){b.ajax["onload_"+g].apply(e);b.ajax["onload_"+g]=null}var n=b.CaptureEventsGet();if(n){for(var m=0;m<n.length;m++){n[m].apply(e)}}};b.ajax.__run=function(m,n){if(!m.processData){if(m.onsuccess){m.onsuccess(n)}b.onCustomEvent(m.xhr,"onAjaxSuccess",[n,m])}else{n=b.ajax.processRequestData(n,m)}};b.ajax._onParseJSONFailure=function(m){this.jsonFailure=true;this.jsonResponse=m;this.jsonProactive=/^\[WAF\]/.test(m)};b.ajax.processRequestData=function(q,n){var v,p=[],u=[];switch(n.dataType.toUpperCase()){case"JSON":b.addCustomEvent(n.xhr,"onParseJSONFailure",b.proxy(b.ajax._onParseJSONFailure,n));v=b.parseJSON(q,n.xhr);b.removeCustomEvent(n.xhr,"onParseJSONFailure",b.proxy(b.ajax._onParseJSONFailure,n));if(!!v&&b.type.isArray(v.bxjs)){for(var r=0;r<v.bxjs.length;r++){if(b.type.isNotEmptyString(v.bxjs[r])){p.push({isInternal:false,JS:v.bxjs[r],bRunFirst:n.scriptsRunFirst})}else{p.push(v.bxjs[r])}}}if(!!v&&b.type.isArray(v.bxcss)){u=v.bxcss}break;case"SCRIPT":p.push({isInternal:true,JS:q,bRunFirst:n.scriptsRunFirst});v=q;break;default:var m=b.processHTML(q,n.scriptsRunFirst);v=m.HTML;p=m.SCRIPT;u=m.STYLE;break}var t=false;if(null==g){g=parseInt(Math.random()*1000000);t=true}if(u.length>0){b.loadCSS(u)}if(n.emulateOnload){b.ajax.__prepareOnload(p)}var o=b.DoNothing;if(n.emulateOnload||t){o=b.defer(function(){if(n.emulateOnload){b.ajax.__runOnload()}if(t){g=null}b.onCustomEvent(n.xhr,"onAjaxSuccessFinish",[n])})}try{if(!!n.jsonFailure){throw {type:"json_failure",data:n.jsonResponse,bProactive:n.jsonProactive}}n.scripts=p;b.ajax.processScripts(n.scripts,true);if(n.onsuccess){n.onsuccess(v)}b.onCustomEvent(n.xhr,"onAjaxSuccess",[v,n]);b.ajax.processScripts(n.scripts,false,o)}catch(s){if(n.onfailure){n.onfailure("processing",s)}b.onCustomEvent(n.xhr,"onAjaxFailure",["processing",s,n])}};b.ajax.processScripts=function(n,t,m){var r=[],o="";m=m||b.DoNothing;for(var p=0,s=n.length;p<s;p++){if(typeof t!="undefined"&&t!=!!n[p].bRunFirst){continue}if(n[p].isInternal){o+=";"+n[p].JS}else{r.push(n[p].JS)}}r=b.util.array_unique(r);var q=o.length>0?function(){b.evalGlobal(o)}:b.DoNothing;if(r.length>0){b.load(r,function(){q();m()})}else{q();m()}};b.ajax.prepareData=function(q,p){var o="";if(b.type.isString(q)){o=q}else{if(null!=q){for(var n in q){if(q.hasOwnProperty(n)){if(o.length>0){o+="&"}var m=b.util.urlencode(n);if(p){m=p+"["+m+"]"}if(typeof q[n]=="object"){o+=b.ajax.prepareData(q[n],m)}else{o+=m+"="+b.util.urlencode(q[n])}}}}}return o};b.ajax.xhrSuccess=function(m){return(m.status>=200&&m.status<300)||m.status===304||m.status===1223||m.status===0};b.ajax.Setup=function(m,o){o=!!o;for(var n in m){if(o){h[n]=m[n]}else{d[n]=m[n]}}};b.ajax.replaceLocalStorageValue=function(o,n,m){if(!!b.localStorage){b.localStorage.set("ajax-"+o,n,m)}};b.ajax._uncache=function(m){return m+((m.indexOf("?")!==-1?"&":"?")+"_="+(new Date()).getTime())};b.ajax.get=function(m,n,o){if(b.type.isFunction(n)){o=n;n=""}n=b.ajax.prepareData(n);if(n){m+=(m.indexOf("?")!==-1?"&":"?")+n;n=""}return b.ajax({method:"GET",dataType:"html",url:m,data:"",onsuccess:o})};b.ajax.getCaptcha=function(m){return b.ajax.loadJSON("/bitrix/tools/ajax_captcha.php",m)};b.ajax.insertToNode=function(o,p){p=b(p);if(!!p){var n={cancel:false};b.onCustomEvent("onAjaxInsertToNode",[{url:o,node:p,eventArgs:n}]);if(n.cancel===true){return}var m=null;if(!h.denyShowWait){m=b.showWait(p);delete h.denyShowWait}return b.ajax.get(o,function(q){p.innerHTML=q;b.closeWait(p,m)})}};b.ajax.post=function(m,n,o){n=b.ajax.prepareData(n);return b.ajax({method:"POST",dataType:"html",url:m,data:n,onsuccess:o})};b.ajax.promise=function(n){var m=new b.Promise();n.onsuccess=function(p){m.fulfill(p)};n.onfailure=function(q,p){m.reject({reason:q,data:p})};n.onprogress=function(p){if(p.position==0&&p.totalSize==0){m.reject({reason:"progress",data:p})}};var o=b.ajax(n);if(!o){m.reject({reason:"init",data:false})}return m};b.ajax.loadScriptAjax=function(p,r,q){if(b.type.isArray(p)){for(var o=0,n=p.length;o<n;o++){b.ajax.loadScriptAjax(p[o],r,q)}}else{var m=p.replace(/\.js\?.*/,".js");if(a.script_self.test(m)){return}if(a.script_self_window.test(m)&&b.CWindow){return}if(a.script_self_admin.test(m)&&b.admin){return}if(typeof f[m]=="undefined"){if(!!q){f[m]="";return b.loadScript(p)}else{return b.ajax({url:p,method:"GET",dataType:"script",processData:true,emulateOnload:false,scriptsRunFirst:true,async:false,start:true,onsuccess:function(s){f[m]=s;if(r){r(s)}}})}}else{if(r){r(f[m])}}}};b.ajax.loadJSON=function(n,o,p,m){if(b.type.isFunction(o)){m=p;p=o;o=""}o=b.ajax.prepareData(o);if(o){n+=(n.indexOf("?")!==-1?"&":"?")+o;o=""}return b.ajax({method:"GET",dataType:"json",url:n,onsuccess:p,onfailure:m})};var k=function(n){var m={};if(typeof n.analyticsLabel!=="undefined"){m.analyticsLabel=n.analyticsLabel}if(typeof n.mode!=="undefined"){m.mode=n.mode}if(n.navigation&&n.navigation.page){m.nav="page-"+n.navigation.page}return m};var c=function(m){m=b.type.isPlainObject(m)?m:{};if(m.data instanceof FormData){m.preparePost=false;m.data.append("sessid",b.bitrix_sessid());if(b.message.SITE_ID){m.data.append("SITE_ID",b.message.SITE_ID)}if(typeof m.signedParameters!=="undefined"){m.data.append("signedParameters",m.signedParameters)}}else{m.data=b.type.isPlainObject(m.data)?m.data:{};if(b.message.SITE_ID){m.data.SITE_ID=b.message.SITE_ID}m.data.sessid=b.bitrix_sessid();if(typeof m.signedParameters!=="undefined"){m.data.signedParameters=m.signedParameters}}if(!m.method){m.method="POST"}return m};var i=function(m,n){n=n||false;var p=b.clone(m);var o=b.ajax.promise(m);return o.then(function(q){if(!n&&b.type.isPlainObject(q)&&b.type.isArray(q.errors)){var r=false;q.errors.forEach(function(t){if(t.code==="invalid_csrf"&&t.customData.csrf){b.message({bitrix_sessid:t.customData.csrf});p.data.sessid=b.bitrix_sessid();r=true}});if(r){return i(p,true)}}if(!b.type.isPlainObject(q)||q.status!=="success"){var s=new b.Promise();s.reject(q);return s}return q})};b.ajax.runAction=function(p,o){o=c(o);var m=k(o);m.action=p;var n=b.util.add_url_param("/bitrix/services/main/ajax.php",m);return i({method:o.method,dataType:"json",url:n,data:o.data,timeout:o.timeout,preparePost:o.preparePost,headers:o.headers})};b.ajax.runComponentAction=function(p,q,o){o=c(o);o.mode=o.mode||"ajax";var m=k(o);m.c=p;m.action=q;var n=b.util.add_url_param("/bitrix/services/main/ajax.php",m);return i({method:o.method,dataType:"json",url:n,data:o.data,timeout:o.timeout,preparePost:o.preparePost,headers:o.headers})};b.ajax.load=function(p,r){if(!b.type.isArray(p)){p=[p]}var o=0;if(!b.type.isFunction(r)){r=b.DoNothing}var q=function(s){if(b.type.isFunction(this.callback)){this.callback(s)}if(++o>=m){r()}};for(var n=0,m=p.length;n<m;n++){switch(p[n].type.toUpperCase()){case"SCRIPT":b.loadScript([p[n].url],b.proxy(q,p[n]));break;case"CSS":b.loadCSS([p[n].url]);if(++o>=m){r()}break;case"JSON":b.ajax.loadJSON(p[n].url,b.proxy(q,p[n]));break;default:b.ajax.get(p[n].url,"",b.proxy(q,p[n]));break}}};b.ajax.submit=function(n,o){if(!n.target){if(null==n.BXFormTarget){var m="formTarget_"+Math.random();n.BXFormTarget=document.body.appendChild(b.create("IFRAME",{props:{name:m,id:m,src:"javascript:void(0)"},style:{display:"none"}}))}n.target=n.BXFormTarget.name}n.BXFormCallback=o;b.bind(n.BXFormTarget,"load",b.proxy(b.ajax._submit_callback,n));b.submit(n);return false};b.ajax.submitComponentForm=function(p,n,q){if(!p.target){if(null==p.BXFormTarget){var o="formTarget_"+Math.random();p.BXFormTarget=document.body.appendChild(b.create("IFRAME",{props:{name:o,id:o,src:"javascript:void(0)"},style:{display:"none"}}))}p.target=p.BXFormTarget.name}if(!!q){var m=b.showWait(n)}p.BXFormCallback=function(r){if(!!q){b.closeWait(m)}var s=function(){if(!!e.bxcompajaxframeonload){setTimeout(function(){e.bxcompajaxframeonload();e.bxcompajaxframeonload=null},10)}};b(n).innerHTML=r;b.onCustomEvent("onAjaxSuccess",[null,null,s])};b.bind(p.BXFormTarget,"load",b.proxy(b.ajax._submit_callback,p));return true};b.ajax._submit_callback=function(){try{if(this.BXFormTarget.contentWindow.location.href.indexOf("http")!=0){return}}catch(m){return}if(this.BXFormCallback){this.BXFormCallback.apply(this,[this.BXFormTarget.contentWindow.document.body.innerHTML])}b.unbindAll(this.BXFormTarget)};b.ajax.prepareForm=function(C,y){y=(!!y?y:{});var z,B,u,v=[],w=C.elements.length,o=0,t=0;if(!!C){for(z=0;z<w;z++){u=C.elements[z];if(u.disabled){continue}if(!u.type){continue}switch(u.type.toLowerCase()){case"text":case"textarea":case"password":case"number":case"hidden":case"select-one":v.push({name:u.name,value:u.value});t+=(u.name.length+u.value.length);break;case"file":if(!!u.files){for(B=0;B<u.files.length;B++){o++;v.push({name:u.name,value:u.files[B],file:true});t+=u.files[B].size}}break;case"radio":case"checkbox":if(u.checked){v.push({name:u.name,value:u.value});t+=(u.name.length+u.value.length)}break;case"select-multiple":for(var x=0;x<u.options.length;x++){if(u.options[x].selected){v.push({name:u.name,value:u.options[x].value});t+=(u.name.length+u.options[x].length)}}break;default:break}}z=0;t=0;var A=y,m,s,r;while(z<v.length){var q=v[z].name.indexOf("[");if(q==-1){A[v[z].name]=v[z].value;A=y;z++}else{m=v[z].name.substring(0,q);s=v[z].name.substring(q+1);r=s.indexOf("]");if(r==-1){if(!A[m]){A[m]=[]}A=y;z++}else{if(r==0){if(!A[m]){A[m]=[]}A=A[m];v[z].name=""+A.length}else{if(!A[m]){A[m]={}}A=A[m];v[z].name=s.substring(0,r)+s.substring(r+1)}}}}}return{data:y,filesCount:o,roughSize:t}};b.ajax.submitAjax=function(u,o){o=(o!==null&&typeof o=="object"?o:{});o.url=(o.url||u.getAttribute("action"));var n=(o.data||{});o.data=b.ajax.prepareForm(u).data;for(var s in n){if(n.hasOwnProperty(s)){o.data[s]=n[s]}}if(!e.FormData){b.ajax(o)}else{var r=function(w){var v=Object.prototype.toString.call(w);return(v=="[object File]"||v=="[object Blob]")},p=function(w,v,y){if(!!y&&typeof y=="object"&&!r(y)){for(var x in y){if(y.hasOwnProperty(x)){p(w,(v==""?x:v+"["+x+"]"),y[x])}}}else{w.append(v,(!!y?y:""))}},q=function(y){var x={};if(null!=y){if(typeof y=="object"){for(var w in y){if(y.hasOwnProperty(w)){var v=b.util.urlencode(w);if(typeof y[w]=="object"&&y[w]["file"]!==true){x[v]=q(y[w])}else{if(y[w]["file"]===true){x[v]=y[w]["value"]}else{x[v]=b.util.urlencode(y[w])}}}}}else{x=b.util.urlencode(y)}}return x},m=new e.FormData();if(o.method!=="POST"){o.data=b.ajax.prepareData(o.data);if(o.data){o.url+=(o.url.indexOf("?")!==-1?"&":"?")+o.data;o.data=""}}else{if(o.preparePost===true){o.data=q(o.data)}p(m,"",o.data);o.data=m}o.preparePost=false;o.start=false;var t=b.ajax(o);if(!!o.onprogress){t.upload.addEventListener("progress",function(w){var v=null;if(w.lengthComputable&&(w.total||w.totalSize)){v=w.loaded*100/(w.total||w.totalSize)}o.onprogress(w,v)})}t.send(m)}};b.ajax.UpdatePageData=function(o){if(o.TITLE){b.ajax.UpdatePageTitle(o.TITLE)}if(o.WINDOW_TITLE||o.TITLE){b.ajax.UpdateWindowTitle(o.WINDOW_TITLE||o.TITLE)}if(o.NAV_CHAIN){b.ajax.UpdatePageNavChain(o.NAV_CHAIN)}if(o.CSS&&o.CSS.length>0){b.loadCSS(o.CSS)}if(o.SCRIPTS&&o.SCRIPTS.length>0){var n=function(q,s,p){if(!!s&&b.type.isArray(s.scripts)){for(var t=0,r=o.SCRIPTS.length;t<r;t++){s.scripts.push({isInternal:false,JS:o.SCRIPTS[t]})}}else{b.loadScript(o.SCRIPTS,p)}b.removeCustomEvent("onAjaxSuccess",n)};b.addCustomEvent("onAjaxSuccess",n)}else{var m=function(q,r,p){if(b.type.isFunction(p)){p()}b.removeCustomEvent("onAjaxSuccess",m)};b.addCustomEvent("onAjaxSuccess",m)}};b.ajax.UpdatePageTitle=function(n){var m=b("pagetitle");if(m){m.removeChild(m.firstChild);if(!m.firstChild){m.appendChild(document.createTextNode(n))}else{m.insertBefore(document.createTextNode(n),m.firstChild)}}};b.ajax.UpdateWindowTitle=function(m){document.title=m};b.ajax.UpdatePageNavChain=function(m){var n=b("navigation");if(n){n.innerHTML=m}};b.userOptions={options:null,bSend:false,delay:5000,path:"/bitrix/admin/user_options.php?"};b.userOptions.setAjaxPath=function(m){b.userOptions.path=m.indexOf("?")==-1?m+"?":m+"&"};b.userOptions.save=function(q,r,p,n,o){if(null==b.userOptions.options){b.userOptions.options={}}o=!!o;b.userOptions.options[q+"."+r+"."+p]=[q,r,p,n,o];var m=b.userOptions.__get();if(m!=""){document.cookie=b.message("COOKIE_PREFIX")+"_LAST_SETTINGS="+encodeURIComponent(m)+"&sessid="+b.bitrix_sessid()+"; expires=Thu, 31 Dec 2020 23:59:59 GMT; path=/;"}if(!b.userOptions.bSend){b.userOptions.bSend=true;setTimeout(function(){b.userOptions.send(null)},b.userOptions.delay)}};b.userOptions.send=function(n){var m=b.userOptions.__get();b.userOptions.options=null;b.userOptions.bSend=false;if(m!=""){document.cookie=b.message("COOKIE_PREFIX")+"_LAST_SETTINGS=; path=/;";b.ajax({method:"GET",dataType:"html",processData:false,cache:false,url:b.userOptions.path+m+"&sessid="+b.bitrix_sessid(),onsuccess:n})}};b.userOptions.del=function(n,o,m,p){b.ajax.get(b.userOptions.path+"action=delete&c="+n+"&n="+o+(m==true?"&common=Y":"")+"&sessid="+b.bitrix_sessid(),p)};b.userOptions.__get=function(){if(!b.userOptions.options){return""}var m="",t=-1,s="",p,o;for(o in b.userOptions.options){if(b.userOptions.options.hasOwnProperty(o)){p=b.userOptions.options[o];if(s!=p[0]+"."+p[1]){t++;m+="&p["+t+"][c]="+b.util.urlencode(p[0]);m+="&p["+t+"][n]="+b.util.urlencode(p[1]);if(p[4]==true){m+="&p["+t+"][d]=Y"}s=p[0]+"."+p[1]}var r=p[2];var q=p[3];if(r===null){m+="&p["+t+"][v]="+b.util.urlencode(q)}else{m+="&p["+t+"][v]["+b.util.urlencode(r)+"]="+b.util.urlencode(q)}}}return m.substr(1)};b.ajax.history={expected_hash:"",obParams:null,obFrame:null,obImage:null,obTimer:null,bInited:false,bHashCollision:false,bPushState:!!(history.pushState&&b.type.isFunction(history.pushState)),startState:null,init:function(m){if(b.ajax.history.bInited){return}this.obParams=m;var n=this.obParams.getState();if(b.ajax.history.bPushState){b.ajax.history.expected_hash=e.location.pathname;if(e.location.search){b.ajax.history.expected_hash+=e.location.search}b.ajax.history.put(n,b.ajax.history.expected_hash,"",true);setTimeout(function(){b.bind(e,"popstate",b.ajax.history.__hashListener)},500)}else{b.ajax.history.expected_hash=e.location.hash;if(!b.ajax.history.expected_hash||b.ajax.history.expected_hash=="#"){b.ajax.history.expected_hash="__bx_no_hash__"}j.put(b.ajax.history.expected_hash,n);b.ajax.history.obTimer=setTimeout(b.ajax.history.__hashListener,500);if(b.browser.IsIE()){b.ajax.history.obFrame=document.createElement("IFRAME");b.hide_object(b.ajax.history.obFrame);document.body.appendChild(b.ajax.history.obFrame);b.ajax.history.obFrame.contentWindow.document.open();b.ajax.history.obFrame.contentWindow.document.write(b.ajax.history.expected_hash);b.ajax.history.obFrame.contentWindow.document.close()}else{if(b.browser.IsOpera()){b.ajax.history.obImage=document.createElement("IMG");b.hide_object(b.ajax.history.obImage);document.body.appendChild(b.ajax.history.obImage);b.ajax.history.obImage.setAttribute("src","javascript:location.href = 'javascript:BX.ajax.history.__hashListener();';")}}}b.ajax.history.bInited=true},__hashListener:function(o){o=o||e.event||{state:false};if(b.ajax.history.bPushState){b.ajax.history.obParams.setState(o.state||b.ajax.history.startState)}else{if(b.ajax.history.obTimer){e.clearTimeout(b.ajax.history.obTimer);b.ajax.history.obTimer=null}var p;if(null!=b.ajax.history.obFrame){p=b.ajax.history.obFrame.contentWindow.document.body.innerText}else{p=e.location.hash}if(!p||p=="#"){p="__bx_no_hash__"}if(p.indexOf("#")==0){p=p.substring(1)}if(p!=b.ajax.history.expected_hash){var n=j.get(p);if(n){b.ajax.history.obParams.setState(n);b.ajax.history.expected_hash=p;if(null!=b.ajax.history.obFrame){var m=p=="__bx_no_hash__"?"":p;if(e.location.hash!=m&&e.location.hash!="#"+m){e.location.hash=m}}}}b.ajax.history.obTimer=setTimeout(b.ajax.history.__hashListener,500)}},put:function(p,m,o,n){if(this.bPushState){if(!n){history.pushState(p,"",m)}else{b.ajax.history.startState=p}}else{if(typeof o!="undefined"){m=o}else{m="view"+m}j.put(m,p);b.ajax.history.expected_hash=m;e.location.hash=b.util.urlencode(m);if(null!=b.ajax.history.obFrame){b.ajax.history.obFrame.contentWindow.document.open();b.ajax.history.obFrame.contentWindow.document.write(m);b.ajax.history.obFrame.contentWindow.document.close()}}},checkRedirectStart:function(m,o){var n=e.location.hash;if(n.substring(0,1)=="#"){n=n.substring(1)}var p=n.substring(0,5);if(p=="view/"||p=="view%"){b.ajax.history.bHashCollision=true;document.write('<div id="__ajax_hash_collision_'+o+'" style="display: none;">')}},checkRedirectFinish:function(m,o){document.write("</div>");var n=e.location.hash;if(n.substring(0,1)=="#"){n=n.substring(1)}b.ready(function(){var s=n.substring(0,5);if(s=="view/"||s=="view%"){var q=b("__ajax_hash_collision_"+o);var r=q.firstChild;b.cleanNode(r);q.style.display="block";if(s!="view%"){n=b.util.urlencode(n)}n+=(n.indexOf("%3F")==-1?"%3F":"%26")+m+"="+o;var p="/bitrix/tools/ajax_redirector.php?hash="+n;b.ajax.insertToNode(p,r)}})}};b.ajax.component=function(m){this.node=m};b.ajax.component.prototype.getState=function(){var m={node:this.node,title:e.document.title,data:b(this.node).innerHTML};var n=b("navigation");if(null!=n){m.nav_chain=n.innerHTML}b.onCustomEvent(b(m.node),"onComponentAjaxHistoryGetState",[m]);return m};b.ajax.component.prototype.setState=function(m){b(m.node).innerHTML=m.data;b.ajax.UpdatePageTitle(m.title);if(m.nav_chain){b.ajax.UpdatePageNavChain(m.nav_chain)}b.onCustomEvent(b(m.node),"onComponentAjaxHistorySetState",[m])};var j={arHistory:{},put:function(n,m){this.arHistory[n]=m},get:function(m){return this.arHistory[m]}};b.ajax.FormData=function(){this.elements=[];this.files=[];this.features={};this.isSupported();this.log("BX FormData init")};b.ajax.FormData.isSupported=function(){var n=new b.ajax.FormData();var m=n.features.supported;n=null;return m};b.ajax.FormData.prototype.log=function(n){if(false){try{if(b.browser.IsIE()){n=JSON.stringify(n)}console.log(n)}catch(m){}}};b.ajax.FormData.prototype.isSupported=function(){var m={};m.fileReader=(e.FileReader&&e.FileReader.prototype.readAsBinaryString);m.readFormData=m.sendFormData=!!(e.FormData);m.supported=!!(m.readFormData&&m.sendFormData);this.features=m;this.log("features:");this.log(m);return m.supported};b.ajax.FormData.prototype.append=function(m,n){if(typeof(n)==="object"){this.files.push({name:m,value:n})}else{this.elements.push({name:m,value:n})}};b.ajax.FormData.prototype.send=function(n,m,q,r){this.log("FD send");this.xhr=b.ajax({method:"POST",dataType:"html",url:n,onsuccess:m,onfailure:r,start:false,preparePost:false});if(q){this.xhr.upload.addEventListener("progress",function(s){if(s.lengthComputable){q(s.loaded/(s.total||s.totalSize))}},false)}if(this.features.readFormData&&this.features.sendFormData){var p=new FormData();this.log("use browser formdata");for(var o in this.elements){if(this.elements.hasOwnProperty(o)){p.append(this.elements[o].name,this.elements[o].value)}}for(o in this.files){if(this.files.hasOwnProperty(o)){p.append(this.files[o].name,this.files[o].value)}}this.xhr.send(p)}return this.xhr};b.addCustomEvent("onAjaxFailure",b.debug)})(window);