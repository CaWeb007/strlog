if(!BXRL){var BXRL={};var BXRLW=null;var lastVoteRepo={};var BXRLParams={pathToUserProfile:null}}RatingLike=function(c,h,e,b,g,f,j,d,i){this.enabled=true;this.likeId=c;this.entityTypeId=h;this.entityId=e;this.available=(b=="Y");this.userId=g;this.localize=f;this.template=j;this.pathToUserProfile=d;this.pathToAjax=typeof(i)=="string"?i:"/bitrix/components/bitrix/rating.vote/vote.ajax.php";this.box=BX("bx-ilike-button-"+c);if(this.box===null){this.enabled=false;return false}this.button=BX.findChild(this.box,{className:"bx-ilike-left-wrap"},true,false);this.buttonText=BX.findChild(this.button,{className:"bx-ilike-text"},true,false);this.count=BX.findChild(this.box,{tagName:"span",className:"bx-ilike-right-wrap"},true,false);this.countText=BX.findChild(this.count,{tagName:"span",className:"bx-ilike-right"},true,false);this.popup=null;this.popupId=null;this.popupOpenId=null;this.popupTimeoutId=null;this.popupContent=BX.findChild(BX("bx-ilike-popup-cont-"+c),{tagName:"span",className:"bx-ilike-popup"},true,false);this.popupContentPage=1;this.popupListProcess=false;this.popupTimeout=false;this.likeTimeout=false;if(typeof lastVoteRepo[h+"_"+e]!="undefined"){this.lastVote=lastVoteRepo[h+"_"+e];var a=(j=="standart"?this.button:this.count);if(this.lastVote=="plus"){BX.addClass(a,"bx-you-like")}else{BX.removeClass(a,"bx-you-like")}}else{this.lastVote=BX.hasClass(j=="standart"?this.button:this.count,"bx-you-like")?"plus":"cancel";lastVoteRepo[h+"_"+e]=this.lastVote}};RatingLike.LiveUpdate=function(c){if(c.USER_ID==BX.message("USER_ID")){return false}for(var b in BXRL){if(BXRL.hasOwnProperty(b)){if(BXRL[b].entityTypeId==c.ENTITY_TYPE_ID&&BXRL[b].entityId==c.ENTITY_ID){var a=BXRL[b];a.countText.innerHTML=parseInt(c.TOTAL_POSITIVE_VOTES);a.count.insertBefore(BX.create("span",{props:{className:"bx-ilike-plus-one"},style:{width:(a.countText.clientWidth-8)+"px",height:(a.countText.clientHeight-8)+"px"},html:(c.TYPE=="ADD"?"+1":"-1")}),a.count.firstChild);if(a.popup){a.popup.close();a.popupContentPage=1}}}}};RatingLike.Set=function(c,h,e,a,g,f,j,d,i){if(j===undefined){j="standart"}if(BXRLParams.pathToUserProfile){d=BXRLParams.pathToUserProfile}if(!BXRL[c]||BXRL[c].tryToSet<=5){var b=BXRL[c]&&BXRL[c].tryToSet?BXRL[c].tryToSet:1;BXRL[c]=new RatingLike(c,h,e,a,g,f,j,d,i);if(BXRL[c].enabled){RatingLike.Init(c)}else{setTimeout(function(){BXRL[c].tryToSet=b+1;RatingLike.Set(c,h,e,a,g,f,j,d,i)},500)}}};RatingLike.Init=function(a){if(BXRL[a].available){BX.bind(BXRL[a].template=="standart"?BXRL[a].button:BXRL[a].buttonText,"click",function(h){var b=null,c=null,f=null;clearTimeout(BXRL[a].likeTimeout);var g=BX.hasClass(BXRL[a].template=="standart"?this:BXRL[a].count,"bx-you-like");if(g){BXRL[a].buttonText.innerHTML=BXRL[a].localize.LIKE_N;BXRL[a].countText.innerHTML=parseInt(BXRL[a].countText.innerHTML)-1;BX.removeClass(BXRL[a].template=="standart"?this:BXRL[a].count,"bx-you-like");BXRL[a].likeTimeout=setTimeout(function(){if(BXRL[a].lastVote!="cancel"){RatingLike.Vote(a,"cancel")}},1000)}else{BXRL[a].buttonText.innerHTML=BXRL[a].localize.LIKE_Y;BXRL[a].countText.innerHTML=parseInt(BXRL[a].countText.innerHTML)+1;BX.addClass(BXRL[a].template=="standart"?this:BXRL[a].count,"bx-you-like");BXRL[a].likeTimeout=setTimeout(function(){if(BXRL[a].lastVote!="plus"){RatingLike.Vote(a,"plus")}},1000)}if(BXRL[a].template=="light"){b=BXRL[a].box;c=b.cloneNode(true);c.id="like_anim";var d=(BX.findParent(b,{className:"feed-com-informers"})?"comment":"post");BX.removeClass(c,"bx-ilike-button-hover");BX.addClass(c,"bx-like-anim");BX.adjust(b.parentNode,{style:{position:"relative"}});BX.adjust(c,{style:{position:"absolute",whiteSpace:"nowrap",top:(d=="comment"?-1:1)+"px"}});BX.adjust(b,{style:{visibility:"hidden"}});BX.prepend(c,b.parentNode);new BX.easing({duration:140,start:{scale:100},finish:{scale:(d=="comment"?110:115)},transition:BX.easing.transitions.quad,step:function(e){c.style.transform="scale("+e.scale/100+")"},complete:function(){f=BX.create("SPAN",{props:{className:(g?"bx-ilike-icon":"bx-ilike-icon bx-ilike-icon-orange")}});BX.adjust(f,{style:{position:"absolute",whiteSpace:"nowrap"}});BX.prepend(f,b.parentNode);new BX.easing({duration:140,start:{scale:(d=="comment"?110:115)},finish:{scale:100},transition:BX.easing.transitions.quad,step:function(e){c.style.transform="scale("+e.scale/100+")"},complete:function(){}}).animate();new BX.easing({duration:200,start:{opacity:100,scale:(d=="comment"?110:115),left:-5,top:0},finish:{opacity:0,scale:200,left:-13,top:(d=="comment"?-3:-2)},transition:BX.easing.transitions.linear,step:function(e){f.style.transform="scale("+e.scale/100+")";f.style.opacity=e.opacity/100;f.style.left=e.left+"px";f.style.top=e.top+"px"},complete:function(){c.parentNode.removeChild(c);f.parentNode.removeChild(f);BX.adjust(b.parentNode,{style:{position:"static"}});BX.adjust(b,{style:{visibility:"visible"}})}}).animate()}}).animate()}BX.removeClass(this.box,"bx-ilike-button-hover");BX.PreventDefault(h)});BX.bind(BXRL[a].box,"mouseover",function(){BX.addClass(this,"bx-ilike-button-hover")});BX.bind(BXRL[a].box,"mouseout",function(){BX.removeClass(this,"bx-ilike-button-hover")})}else{if(BXRL[a].buttonText!=undefined){BXRL[a].buttonText.innerHTML=BXRL[a].localize.LIKE_D}}BX.bind(BXRL[a].count,"mouseover",function(){clearTimeout(BXRL[a].popupTimeoutId);BXRL[a].popupTimeoutId=setTimeout(function(){if(BXRLW==a){return false}if(BXRL[a].popupContentPage==1){RatingLike.List(a,1)}BXRL[a].popupTimeoutId=setTimeout(function(){RatingLike.OpenWindow(a)},400)},400)});BX.bind(BXRL[a].count,"mouseout",function(){clearTimeout(BXRL[a].popupTimeoutId)});BX.bind(BXRL[a].count,"click",function(){clearTimeout(BXRL[a].popupTimeoutId);if(BXRL[a].popupContentPage==1){RatingLike.List(a,1)}RatingLike.OpenWindow(a)});BX.bind(BXRL[a].box,"mouseout",function(){clearTimeout(BXRL[a].popupTimeout);BXRL[a].popupTimeout=setTimeout(function(){if(BXRL[a].popup!==null){BXRL[a].popup.close();BXRLW=null}},1000)});BX.bind(BXRL[a].box,"mouseover",function(){clearTimeout(BXRL[a].popupTimeout)})};RatingLike.OpenWindow=function(a){if(parseInt(BXRL[a].countText.innerHTML)==0){return false}if(BXRL[a].popup==null){BXRL[a].popup=new BX.PopupWindow("ilike-popup-"+a,(BXRL[a].template=="standart"?BXRL[a].count:BXRL[a].box),{lightShadow:true,offsetLeft:5,autoHide:true,closeByEsc:true,zIndex:2005,bindOptions:{position:"top"},events:{onPopupClose:function(){BXRLW=null},onPopupDestroy:function(){}},content:BX("bx-ilike-popup-cont-"+a)});BXRL[a].popup.setAngle({});BX.bind(BX("ilike-popup-"+a),"mouseout",function(){clearTimeout(BXRL[a].popupTimeout);BXRL[a].popupTimeout=setTimeout(function(){BXRL[a].popup.close()},1000)});BX.bind(BX("ilike-popup-"+a),"mouseover",function(){clearTimeout(BXRL[a].popupTimeout)})}if(BXRLW!=null){BXRL[BXRLW].popup.close()}BXRLW=a;BXRL[a].popup.show();RatingLike.AdjustWindow(a)};RatingLike.Vote=function(b,a){BX.ajax({url:BXRL[b].pathToAjax,method:"POST",dataType:"json",data:{RATING_VOTE:"Y",RATING_VOTE_TYPE_ID:BXRL[b].entityTypeId,RATING_VOTE_ENTITY_ID:BXRL[b].entityId,RATING_VOTE_ACTION:a,sessid:BX.bitrix_sessid()},onsuccess:function(c){BXRL[b].lastVote=c.action;lastVoteRepo[BXRL[b].entityTypeId+"_"+BXRL[b].entityId]=c.action;BXRL[b].countText.innerHTML=c.items_all;BXRL[b].popupContentPage=1;BXRL[b].popupContent.innerHTML="";spanTag0=document.createElement("span");spanTag0.className="bx-ilike-wait";BXRL[b].popupContent.appendChild(spanTag0);RatingLike.AdjustWindow(b);if(BX("ilike-popup-"+b)&&BX("ilike-popup-"+b).style.display=="block"){RatingLike.List(b,null)}},onfailure:function(c){}});return false};RatingLike.List=function(b,a){if(parseInt(BXRL[b].countText.innerHTML)==0){return false}if(a==null){a=BXRL[b].popupContentPage}BXRL[b].popupListProcess=true;BX.ajax({url:BXRL[b].pathToAjax,method:"POST",dataType:"json",data:{RATING_VOTE_LIST:"Y",RATING_VOTE_TYPE_ID:BXRL[b].entityTypeId,RATING_VOTE_ENTITY_ID:BXRL[b].entityId,RATING_VOTE_LIST_PAGE:a,PATH_TO_USER_PROFILE:BXRL[b].pathToUserProfile,sessid:BX.bitrix_sessid()},onsuccess:function(e){BXRL[b].countText.innerHTML=e.items_all;if(parseInt(e.items_page)==0){return false}if(a==1){BXRL[b].popupContent.innerHTML="";spanTag0=document.createElement("span");spanTag0.className="bx-ilike-bottom_scroll";BXRL[b].popupContent.appendChild(spanTag0)}BXRL[b].popupContentPage+=1;var c=null;for(var d=0;d<e.items.length;d++){if(e.items[d]["PHOTO_SRC"].length>0){c=BX.create("IMG",{attrs:{src:e.items[d]["PHOTO_SRC"]},props:{className:"bx-ilike-popup-avatar-img"}})}else{c=BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"bx-ilike-popup-avatar-img bx-ilike-popup-avatar-img-default"}})}BXRL[b].popupContent.appendChild(BX.create("A",{attrs:{href:e.items[d]["URL"],target:"_blank"},props:{className:"bx-ilike-popup-img"+(!!e.items[d]["USER_TYPE"]?" bx-ilike-popup-img-"+e.items[d]["USER_TYPE"]:"")},children:[BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-new"},children:[c,BX.create("SPAN",{props:{className:"bx-ilike-popup-avatar-status-icon"}})]}),BX.create("SPAN",{props:{className:"bx-ilike-popup-name-new"},html:e.items[d]["FULL_NAME"]})]}))}RatingLike.AdjustWindow(b);RatingLike.PopupScroll(b);BXRL[b].popupListProcess=false},onfailure:function(c){}});return false};RatingLike.AdjustWindow=function(a){if(BXRL[a].popup!=null){BXRL[a].popup.bindOptions.forceBindPosition=true;BXRL[a].popup.adjustPosition();BXRL[a].popup.bindOptions.forceBindPosition=false}};RatingLike.PopupScroll=function(a){BX.bind(BXRL[a].popupContent,"scroll",function(){if(this.scrollTop>(this.scrollHeight-this.offsetHeight)/1.5){RatingLike.List(a,null);BX.unbindAll(this)}})};RatingLike.setParams=function(a){if(typeof a!="undefined"){if(typeof a.pathToUserProfile!="undefined"){BXRLParams.pathToUserProfile=a.pathToUserProfile}}};