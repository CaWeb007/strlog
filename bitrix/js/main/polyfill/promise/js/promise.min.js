(function(h){if(typeof h.Promise==="undefined"||h.Promise.toString().indexOf("[native code]")===-1){var b="[[PromiseStatus]]";var k="[[PromiseValue]]";var a="pending";var l="internal pending";var e="resolved";var g="rejected";var d=function(p,o){if(p[b]===l){p=p[k]}if(p[b]===a){p.deferreds.push(o)}else{p.handled=true;setTimeout(function(){var r=p[b]===e?o.onFulfilled:o.onRejected;if(r){try{m(o.promise,r(p[k]))}catch(q){n(o.promise,q)}}else{if(p[b]===e){m(o.promise,p[k])}else{n(o.promise,p[k])}}},0)}};var m=function(q,p){if(p===q){throw new TypeError("A promise cannot be resolved with it promise.")}try{if(p&&(typeof p==="object"||typeof p==="function")){if(p instanceof j){q[b]=l;q[k]=p;f(q);return}else{if(typeof p.then==="function"){c(p.then.bind(p),q);return}}}q[b]=e;q[k]=p;f(q)}catch(o){n(q,o)}};var n=function(p,o){p[b]=g;p[k]=o;f(p)};var f=function(o){if(o[b]===g&&o.deferreds.length===0){setTimeout(function(){if(!o.handled){console.error("Unhandled Promise Rejection: "+o[k])}},0)}o.deferreds.forEach(function(p){d(o,p)});o.deferreds=null};var c=function(t,s){var o=false;try{t(p,r)}catch(q){if(!o){o=true;n(s,q)}}function p(u){if(!o){o=true;m(s,u)}}function r(u){if(!o){o=true;n(s,u)}}};var i=function(q,o,p){this.onFulfilled=typeof q==="function"?q:null;this.onRejected=typeof o==="function"?o:null;this.promise=p};var j=function(o){this[b]=a;this[k]=null;this.handled=false;this.deferreds=[];c(o,this)};j.prototype["catch"]=function(o){return this.then(null,o)};j.prototype.then=function(q,o){var p=new j(function(){});d(this,new i(q,o,p));return p};j.all=function(p){var o=[].slice.call(p);return new j(function(u,t){if(o.length===0){u(o)}else{var s=o.length;var r=function(w,x){try{if(x&&(typeof x==="object"||typeof x==="function")){if(typeof x.then==="function"){x.then.call(x,function(y){r(w,y)},t);return}}o[w]=x;if(--s===0){u(o)}}catch(v){t(v)}};for(var q=0;q<o.length;q++){r(q,o[q])}}})};j.resolve=function(o){if(o&&typeof o==="object"&&o.constructor===j){return o}return new j(function(p){p(o)})};j.reject=function(o){return new j(function(q,p){p(o)})};j.race=function(o){return new j(function(s,r){for(var q=0,p=o.length;q<p;q++){o[q].then(s,r)}})};h.Promise=j}})(window);