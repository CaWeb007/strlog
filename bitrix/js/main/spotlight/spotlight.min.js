(function(){BX.SpotLight=function(a){this.container=null;this.popup=null;this.id="spotlight-"+BX.util.getRandomString().toLowerCase();this.options={};this.targetElement=null;this.targetElementRect=null;this.targetVertex="top-left";this.content=null;this.top=0;this.left=0;this.lightMode=false;this.autoSave=false;this.zIndex=null;this.observerTimeoutId=null;this.observerTimeout=1000;this.setOptions(a);if(!this.targetElement){throw new Error("BX.SpotLight: 'targetElement' is not a DOMNode.")}this.handlePageResize=this.handlePageResize.bind(this)};BX.SpotLight.prototype={setOptions:function(a){a=BX.type.isPlainObject(a)?a:{};this.options=a;this.setTargetElement(a.renderTo);this.setTargetElement(a.targetElement);this.setTargetVertex(a.targetVertex);this.setZindex(a.zIndex);this.setLightMode(a.lightMode);this.setContent(a.content);this.setOffsetLeft(a.left);this.setOffsetTop(a.top);this.setAutoSave(a.autoSave);this.setObserverTimeout(a.observerTimeout);this.setId(a.id)},bindEvents:function(c){if(!BX.type.isPlainObject(c)){return}for(var b in c){var a=BX.type.isFunction(c[b])?c[b]:BX.getClass(c[b]);if(a){BX.addCustomEvent(this,this.getFullEventName(b),a)}}},unbindEvents:function(c){if(!BX.type.isPlainObject(c)){return}for(var b in c){var a=BX.type.isFunction(c[b])?c[b]:BX.getClass(c[b]);if(a){BX.removeCustomEvent(this,this.getFullEventName(b),a)}}},getOptions:function(){return this.options},getId:function(){return this.id},setId:function(a){if(BX.type.isNotEmptyString(a)){this.id=a}},getZindex:function(){if(this.zIndex!==null){return this.zIndex}return this.getGlobalIndex(this.getTargetElement())+1},getGlobalIndex:function(b){var a=0;do{a=BX.type.stringToInt(BX.style(b,"z-index"));b=b.offsetParent}while(b&&b.tagName!=="BODY");return a},setZindex:function(a){if(BX.type.isNumber(a)||a===null){this.zIndex=a}},getContent:function(){return this.content},setContent:function(a){if(BX.type.isNotEmptyString(a)||BX.type.isDomNode(a)||a===null){this.content=a}},getTargetElement:function(){return this.targetElement},setTargetElement:function(a){if(BX.type.isNotEmptyString(a)){a=document.querySelector(a)||BX(a)}if(BX.type.isDomNode(a)){this.targetElement=a;this.renderTo=a}},getOffsetLeft:function(){return this.left},setOffsetLeft:function(a){if(BX.type.isNumber(a)){this.left=a}},getOffsetTop:function(){return this.top},setOffsetTop:function(a){if(BX.type.isNumber(a)){this.top=a}},getLightMode:function(){return this.lightMode},setLightMode:function(a){if(BX.type.isBoolean(a)){this.lightMode=a}},getAutoSave:function(){return this.autoSave},setAutoSave:function(a){if(BX.type.isBoolean(a)){this.autoSave=a}},getObserverTimeout:function(){return this.observerTimeout},setObserverTimeout:function(a){if(BX.type.isNumber(a)&&a>=0){this.observerTimeout=a}},getTargetVertex:function(){return this.targetVertex},setTargetVertex:function(a){if(BX.type.isNotEmptyString(a)){this.targetVertex=a}},getPopup:function(){if(this.popup){return this.popup}this.popup=new BX.PopupWindow("spotlight-"+BX.util.getRandomString(),this.container,{className:"main-spot-light-popup",angle:{position:"top",offset:41},closeByEsc:true,overlay:true,content:this.getContent(),events:{onPopupShow:function(){this.fireEvent("onPopupShow")}.bind(this),onPopupClose:function(){this.close();this.fireEvent("onPopupClose")}.bind(this)},buttons:[new BX.PopupWindowCustomButton({text:BX.message("MAIN_SPOTLIGHT_UNDERSTAND"),className:"webform-small-button webform-small-button-blue",events:{click:function(){this.close();this.fireEvent("onPopupAccept");BX.onCustomEvent(this,"spotLightOk",[this.getTargetElement(),this])}.bind(this)}})]});return this.popup},getTargetContainer:function(){if(this.container){return this.container}this.container=BX.create("div",{attrs:{className:this.getLightMode()?"main-spot-light main-spot-light-white":"main-spot-light"},events:{mouseenter:this.handleTargetMouseEnter.bind(this),mouseleave:this.handleTargetMouseLeave.bind(this)}});return this.container},adjustPosition:function(){this.targetElementRect=BX.pos(this.getTargetElement());var b=this.getTargetElement();var a=Boolean(b.offsetWidth||b.offsetHeight||b.getClientRects().length);if(!a){this.container.hidden=true;return}var e=0;var d=0;var c=this.getTargetVertex();switch(c){case"top-left":default:e=this.targetElementRect.left;d=this.targetElementRect.top;break;case"top-center":e=this.targetElementRect.left+this.targetElementRect.width/2;d=this.targetElementRect.top;break;case"top-right":e=this.targetElementRect.right;d=this.targetElementRect.top;break;case"middle-left":e=this.targetElementRect.left;d=this.targetElementRect.top+this.targetElementRect.height/2;break;case"middle-center":e=this.targetElementRect.left+this.targetElementRect.width/2;d=this.targetElementRect.top+this.targetElementRect.height/2;break;case"middle-right":e=this.targetElementRect.right;d=this.targetElementRect.top+this.targetElementRect.height/2;break;case"bottom-left":e=this.targetElementRect.left;d=this.targetElementRect.bottom;break;case"bottom-center":e=this.targetElementRect.left+this.targetElementRect.width/2;d=this.targetElementRect.bottom;break;case"bottom-right":e=this.targetElementRect.right;d=this.targetElementRect.bottom;break}this.container.hidden=false;this.container.style.left=e+this.getOffsetLeft()+"px";this.container.style.top=d+this.getOffsetTop()+"px";this.container.style.zIndex=this.getZindex()},handlePageResize:function(){this.adjustPosition()},handleTargetMouseEnter:function(){this.fireEvent("onTargetEnter");if(this.getContent()){this.getPopup().show()}if(this.getAutoSave()){this.save()}},handleTargetMouseLeave:function(){this.fireEvent("onTargetLeave")},handleTargetElementResize:function(){var a=BX.pos(this.getTargetElement());if(a.left!==this.targetElementRect.left||a.right!==this.targetElementRect.right||a.top!==this.targetElementRect.top||a.bottom!==this.targetElementRect.bottom){this.adjustPosition()}},show:function(){if(!this.getTargetContainer().parentNode){BX.bind(window,"resize",this.handlePageResize);BX.bind(window,"load",this.handlePageResize);BX.addCustomEvent("onFrameDataProcessed",this.handlePageResize);this.bindEvents(this.getOptions().events);document.body.appendChild(this.getTargetContainer());if(this.getObserverTimeout()){this.observerTimeoutId=setInterval(this.handleTargetElementResize.bind(this),this.getObserverTimeout())}}this.fireEvent("onShow");this.adjustPosition()},close:function(){this.fireEvent("onClose");if(this.popup){this.popup.destroy();this.popup=null}if(this.observerTimeoutId){clearInterval(this.observerTimeoutId);this.observerTimeoutId=null}BX.unbind(window,"resize",this.handlePageResize);BX.unbind(window,"load",this.handlePageResize);BX.removeCustomEvent("onFrameDataProcessed",this.handlePageResize);this.unbindEvents(this.getOptions().events);BX.remove(this.container);this.container=null},save:function(){var a="view_date_"+this.getId();BX.userOptions.save("spotlight",a,null,Math.floor(Date.now()/1000));BX.userOptions.send(null)},fireEvent:function(a){if(BX.type.isNotEmptyString(a)){BX.onCustomEvent(this,this.getFullEventName(a),[this])}},getFullEventName:function(a){return"BX.SpotLight:"+a}};BX.SpotLight.Manager={spotlights:{},create:function(b){b=BX.type.isPlainObject(b)?b:{};var c=b.id;if(!BX.type.isNotEmptyString(c)){throw new Error("'id' parameter is required.")}if(this.get(c)){throw new Error("The spotlight instance with the same 'id' already exists.")}var a=new BX.SpotLight(b);this.spotlights[c]=a;return a},get:function(a){return a in this.spotlights?this.spotlights[a]:null},remove:function(a){delete this.spotlights[a]}}})();