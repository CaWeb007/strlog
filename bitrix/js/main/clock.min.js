(function(){if(window.JCClock){return}function a(b){if(typeof(BX)!="undefined"){BX.onCustomEvent("onJCClockInit",[b])}this.config=b;this.config.AmPmMode=BX.isAmPmMode();this.config.AmPm="";this.deltaHour=0;this.MESS=this.config.MESS;this.bCreated=false;this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"))}a.prototype={Create:function(b){this.bCreated=true;this.pInput=document.getElementById(this.config.inputId);this.pIcon=document.getElementById(this.config.iconId);if(b&&(b=document.getElementById(b))){this.bInline=true;this.oDiv=b;this.oDiv.className="bx-clock-div bx-clock-div-inline"+(this.config.AmPmMode?"_am_pm":"");this.oDiv.style.position="relative"}else{var d=150;if(typeof(this.config.zIndex)!="undefined"){d=parseInt(this.config.zIndex);if(d<=0){d=150}}this.oDiv=BX(this.config.inputId+"_div");if(this.oDiv){BX.cleanNode(this.oDiv,true)}this.oDiv=BX.create("DIV",{props:{className:"bx-clock-div",id:this.config.inputId+"_div"},style:{zIndex:d}});document.body.appendChild(this.oDiv)}var c=BX.create("DIV",{props:{className:"bxc-clock-cont bxc-iconkit-c"}});this.arrowsContDiv=BX.create("DIV",{props:{className:"bxc-arrows-cont h0 m0"}});this.MACDiv=this.arrowsContDiv.appendChild(BX.create("DIV",{props:{className:"bxc-mouse-control-cont"}}));this.arrowsContDiv.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxc-min-arr-cont bxc-iconkit-a"}}));this.arrowsContDiv.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxc-hour-arr-cont bxc-iconkit-a"}}));c.appendChild(this.arrowsContDiv);this.oDiv.appendChild(c);this.CreateControls();this.InitMouseArrowControl()},CreateControls:function(){this.ControlsCont=BX.create("DIV",{props:{className:"bxc-controls-cont"}});var d,b=[],f=[],e=this;if(this.config.AmPmMode){for(d=0;d<12;d++){b.push(this.Hour2Str(d,true))}}else{for(d=0;d<24;d++){b.push(this.Int2Str(d))}}for(d=0;d<60;d+=this.config.step){f[d]=(this.Int2Str(d))}var j=this.CreateSelect(b,1,this.MESS.Hours);this.hourSelect=j.pSelect;var g=this.CreateSelect(f,this.config.step,this.MESS.Minutes);this.minSelect=g.pSelect;this.hourSelect.onchange=function(){if(!this.value||isNaN(this.value)){this.value=0}e.SetTime(this.value,e.curMin,true)};this.minSelect.onchange=function(){if(!this.value||isNaN(this.value)){this.value=0}e.SetTime(e.curHour,this.value,true)};this.minSelect.onfocus=function(){e.lastArrow="min"};this.hourSelect.onfocus=function(){e.lastArrow="hour"};if(!this.bInline){var c=BX.create("INPUT",{props:{type:"button",value:this.MESS.Insert}});c.onclick=function(){e.Submit()};var k=BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxc-close bxc-iconkit-c",title:this.MESS.Close}});k.onclick=function(){e.Close()}}var h=BX.create("SPAN",{props:{className:"double-dot"}});h.innerHTML=":";j.pWnd.style.marginLeft="11px";this.ControlsCont.appendChild(j.pWnd);this.ControlsCont.appendChild(h);this.ControlsCont.appendChild(g.pWnd);if(this.config.AmPmMode){this.AmPm=BX.create("SPAN",{props:{className:"bxc-am-pm",title:"a.m."}});this.AmPm.innerHTML="am";this.AmPm.onclick=function(){if(this.title=="a.m."){this.title="p.m.";this.innerHTML="pm";e.config.AmPm=" pm"}else{this.title="a.m.";this.innerHTML="am";e.config.AmPm=" am"}e.SetTime(e.curHour,e.curMin,true)};this.ControlsCont.appendChild(this.AmPm)}if(!this.bInline){this.ControlsCont.appendChild(c);this.ControlsCont.appendChild(k);this.pTitle=this.ControlsCont.appendChild(BX.create("DIV",{props:{className:"bxc-title"}}));this.pTitle.onmousedown=function(i){jsFloatDiv.StartDrag(i,e.oDiv);e.bRecalculateCoordinates=true}}this.oDiv.appendChild(this.ControlsCont)},CalculateCoordinates:function(){var p=BX.pos(this.oDiv);this.top=p.top;this.left=p.left;this.centerX=p.left+(this.bInline?a.getOption("centerXInline",55):a.getOption("centerX",55));this.centerY=p.top+(this.bInline?a.getOption("centerYInline",55):a.getOption("centerY",71));var j=this,e=a.getOption("minuteLength",32),d=a.getOption("hourLength",25),r=this.centerX,q=this.centerY,h,c,n,f,o,m,g,k,b,l,s=a.getOption("inaccuracy",8);this.arHourCoords=[];this.bJumpByMinArrow30=false;for(h=0;h<12;h++){c=(h*30)*Math.PI/180;n=Math.round(d*Math.sin(c));f=Math.round(d*Math.cos(c));o=r+n;m=q-f;g=Math.round(16*Math.sin(c));k=Math.round(16*Math.cos(c));b=r+g;l=q-k;this.arHourCoords[h]={x:o,y:m,x_min:o-s,x_max:o+s,y_min:m-s,y_max:m+s,x_min1:b-s,x_max1:b+s,y_min1:l-s,y_max1:l+s}}this.arMinCoords={};for(h=0;h<12;h++){c=(h*30)*Math.PI/180;n=Math.round(e*Math.sin(c));f=Math.round(e*Math.cos(c));o=r+n;m=q-f;g=Math.round(18*Math.sin(c));k=Math.round(18*Math.cos(c));b=r+g;l=q-k;this.arMinCoords[h*5]={x:o,y:m,x_min:o-s,x_max:o+s,y_min:m-s,y_max:m+s,x_min1:b-s,x_max1:b+s,y_min1:l-s,y_max1:l+s}}this.bRecalculateCoordinates=false},Show:function(b){if(!this.bCreated){this.Create(b)}this.lastArrow="min";var c=this.pInput.value.toString();if(c.indexOf(":")==-1){if(this.config.initTime.length<=0||this.config.initTime.indexOf(":")==-1){c=new Date().getHours()+":"+new Date().getMinutes()}else{c=this.config.initTime}}c=this.parseTime(c);this.SetTime(c.h,c.m);if(this.bInline){this.oDiv.style.display="block"}else{var d=this.pIcon||this.pInput;var f=this.AlignToPos(BX.pos(d));this.top=f.top;this.left=f.left;jsFloatDiv.Show(this.oDiv,this.left,this.top);this.oDiv.style.display="block";jsFloatDiv.AdjustShadow(this.oDiv)}var e=this;setTimeout(function(){e.CalculateCoordinates()},20);window["_bxc_onmousedown"+this.config.inputId]=function(g){e.CheckClick(g)};window["_bxc_onkeypress"+this.config.inputId]=function(g){e.OnKeyDown(g)};setTimeout(function(){BX.bind(document,"mousedown",window["_bxc_onmousedown"+e.config.inputId])},10);BX.bind(document,"keypress",window["_bxc_onkeypress"+this.config.inputId])},AlignToPos:function(f){var d=a.getOption("popupHeight",250),c=f.left,e=f.top-d,b=BX.GetWindowScrollPos();if(b.scrollTop>e||e<0){e=f.top+40}return{left:c,top:e}},Close:function(){if(this.bInline){return}BX.unbind(document,"mousedown",window["_bxc_onmousedown"+this.config.inputId]);BX.unbind(document,"keypress",window["_bxc_onkeypress"+this.config.inputId]);jsFloatDiv.Close(this.oDiv);this.oDiv.style.display="none"},Submit:function(){var b=this.config.AmPmMode?this.config.AmPm:"";this.pInput.value=this.Hour2Str(this.curHour,this.config.AmPmMode)+":"+this.Int2Str(this.curMin)+b;BX.fireEvent(this.pInput,"change");if(!this.bInline){this.Close()}},SetTime:function(e,b,d,c){e=parseInt(e,10);if(this.config.AmPmMode){if(e>=12){if(e>12){e=e-12}if(this.config.AmPm==""){this.config.AmPm=" pm"}}else{if(this.config.AmPm==""){this.config.AmPm=" am"}}if(e<1||e>12){e=12;this.config.AmPm=" am"}}else{if(e<0||e>23){e=0}}b=parseInt(b,10);var f=this.config.step;if(Math.round(b/f)!=b/f){b=Math.round(b/f)*f}if(b<0||b>59){b=0}if(!c){this.deltaHour=e>=12?12:0}this.curMin=b;this.curHour=e;if(this.pTitle){this.pTitle.innerHTML=this.Hour2Str(e,this.config.AmPmMode)+":"+this.Int2Str(b)}this.SetTimeAn(e,b);if(!d){this.SetTimeDig(e,b)}if(this.bInline){this.Submit()}},SetTimeAnH:function(c,b){if(c==0){if(this.curHour<12&&this.curHour>6){this.deltaHour=12}if(this.curHour<24&&this.curHour>18){this.deltaHour=0}}if(this.curHour==0&&c==11){c=23;this.deltaHour=12}else{if(this.curHour==12&&c==11){c=11;this.deltaHour=0}else{c+=this.deltaHour}}this.SetTime(c,b,false,true)},SetTimeAnM:function(c,b){b=parseInt(b,10);var d=this.config.step;if(Math.round(b/d)!=b/d){b=Math.round(b/d)*d}if(b<0||b>59){b=0}if(b==30){this.bJumpByMinArrow30=true}else{if(this.bJumpByMinArrow30&&b==0){if(this.curMin>30&&this.curMin<59){this.bJumpByMinArrow30=false;this.SetTime(++c,b);return}if(this.curMin>0&&this.curMin<30){this.bJumpByMinArrow30=false;if(c==0){c=24}this.SetTime(--c,b);return}}}this.SetTime(c,b)},SetTimeAn:function(c,b){c=parseInt(c,10);if(isNaN(c)){c=0}b=parseInt(b,10);if(isNaN(b)){b=0}if(c>=12){c-=12}var d="bxc-arrows-cont";if(c*5==b){d+=" hideh hm"+c}else{d+=" h"+c+" m"+b}this.arrowsContDiv.className=d},CreateSelect:function(h,d,j){var k=!!this.config.AmPmMode;var l=BX.create("INPUT",{props:{type:"text",className:"bxc-cus-sel",size:"1",title:j}});var m=function(c){l._bxmousedown=false;if(window.bxinterval){clearTimeout(window.bxinterval)}};var e=function(n){if(!l._bxmousedown){m();return}var c=parseInt(l.value,10);if(isNaN(c)){c=0}c=c+n;if(c>=h.length){c=0}else{if(c<0){c=h.length-1}}if(typeof h[c]=="undefined"){c-=n;l.value=c-(n>0?1:-1);e(n);return}else{if(l.value=="11"&&h[c]=="00"||l.value=="01"&&h[c]=="00"&&k){l.value="12"}else{if(l.value=="12"&&h[c]=="00"){l.value="01"}else{l.value=h[c]}}l.onchange()}if(window.bxinterval){clearTimeout(window.bxinterval)}window.bxinterval=setTimeout(function(){e(n)},100)};var f=function(c){if(window.bxinterval){m()}l._bxmousedown=true;BX.bind(document,"mouseup",m);e(c);if(window.bxinterval){clearTimeout(window.bxinterval)}window.bxinterval=setTimeout(function(){e(c)},800)};l.onkeydown=function(c){if(!c){c=window.event}if(!c){return}if(c.keyCode==38){f(d);m()}else{if(c.keyCode==40){f(-d);m()}}};var g=BX.create("TABLE",{props:{className:"bxc-cus-sel-tbl"}}),b=g.insertRow(-1),i=b.insertCell(-1);i.rowSpan=2;i.appendChild(l);i=b.insertCell(-1);i.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxc-slide-up bxc-iconkit-c"}}));i.title=this.MESS.Up;i.className="bxc-pointer";i.onmousedown=function(){f(d)};i=g.insertRow(-1).insertCell(-1);i.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxc-slide-down bxc-iconkit-c"}}));i.title=this.MESS.Down;i.className="bxc-pointer";i.onmousedown=function(){f(-d)};return{pSelect:l,pWnd:g}},SetTimeDig:function(c,b){this.hourSelect.value=this.Hour2Str(c,this.config.AmPmMode);this.minSelect.value=this.Int2Str(b);if(this.config.AmPmMode){if(this.config.AmPm==" pm"){this.AmPm.title="p.m.";this.AmPm.innerHTML="pm"}else{this.AmPm.title="a.m.";this.AmPm.innerHTML="am"}}if(this.bInline){this.Submit()}},InitMouseArrowControl:function(){var b=this;this.MACDiv.onmousedown=function(c){b.MACMouseDown(c)};this.MACDiv.ondrag=BX.False;this.MACDiv.onselectstart=BX.False;this.MACDiv.style.MozUserSelect="none"},MACMouseDown:function(k){if(this.bRecalculateCoordinates){this.CalculateCoordinates()}if(!k){k=window.event}var j=this,f,m=BX.GetWindowSize(),d=k.clientX+m.scrollLeft,c=k.clientY+m.scrollTop;this.ddMode=false;f=this.arMinCoords[this.curMin];if((d>f.x_min&&d<f.x_max&&c>f.y_min&&c<f.y_max)||(d>f.x_min1&&d<f.x_max1&&c>f.y_min1&&c<f.y_max1)){this.ddMode="min";this.lastArrow="min"}if(!this.ddMode){f=this.arHourCoords[this.curHour>=12?this.curHour-12:this.curHour];if((d>f.x_min&&d<f.x_max&&c>f.y_min&&c<f.y_max)||(d>f.x_min1&&d<f.x_max1&&c>f.y_min1&&c<f.y_max1)){this.ddMode="hour";this.lastArrow="hour"}}if(this.ddMode===false){var h,l,g=1000,b=0;if(this.lastArrow=="hour"){for(h=0;h<12;h++){l=this.GetDistance(this.arHourCoords[h].x,this.arHourCoords[h].y,d,c);if(l<=g){g=l;b=h}}this.SetTimeAnH(b,this.curMin)}else{if(this.lastArrow=="min"){for(h=0;h<12;h++){l=this.GetDistance(this.arMinCoords[h*5].x,this.arMinCoords[h*5].y,d,c);if(l<=g){g=l;b=h}}this.SetTimeAnM(this.curHour,b*5)}}return}this.ControlsCont.style.zIndex="145";this.MACDiv.onmousemove=function(i){j.MACMouseMove(i)};this.MACDiv.onmouseup=function(i){j.MACMouseUp(i)}},MACMouseMove:function(j){if(!this.ddMode){this.StopDD();return}if(!j){j=window.event}var h,k,g=1000,f=0,c=BX.GetWindowSize(),d=j.clientX+c.scrollLeft,b=j.clientY+c.scrollTop;if(this.ddMode=="hour"){for(h=0;h<12;h++){k=this.GetDistance(this.arHourCoords[h].x,this.arHourCoords[h].y,d,b);if(k<=g){g=k;f=h}}this.SetTimeAnH(f,this.curMin)}else{if(this.ddMode=="min"){for(h=0;h<12;h++){k=this.GetDistance(this.arMinCoords[h*5].x,this.arMinCoords[h*5].y,d,b);if(k<=g){g=k;f=h}}this.SetTimeAnM(this.curHour,f*5)}}},GetDistance:function(c,e,b,d){return Math.round(Math.sqrt((Math.pow(c-b,2)+Math.pow(e-d,2))))},MACMouseUp:function(b){this.StopDD()},StopDD:function(){this.ddMode=false;this.ControlsCont.style.zIndex="156";this.MACDiv.onmousemove=null;this.MACDiv.onmouseup=null;return false},Int2Str:function(b){b=parseInt(b,10);if(isNaN(b)){b=0}return b<10?"0"+b.toString():b.toString()},Hour2Str:function(c,b){c=parseInt(c,10);if(isNaN(c)){c=0}return c<10&&!b?"0"+c.toString():c.toString()},CheckClick:function(c){if(this.bRecalculateCoordinates||this.bInline){return}if(!c){c=window.event}if(!c){return}var b;if(c.target){b=c.target}else{if(c.srcElement){b=c.srcElement}}if(b.nodeType==3){b=b.parentNode}if(b!=this.oDiv&&!BX.findParent(b,{attribute:{id:this.oDiv.id}})){this.Close()}},OnKeyDown:function(b){if(!b){b=window.event}if(!b){return}if(b.keyCode==27){this.Close()}},parseTime:function(c){var b=this.parseDate(BX.date.format(this.DATE_FORMAT,new Date())+" "+c,false);return b?{h:b.getHours(),m:b.getMinutes()}:b},parseDate:function(l,t,e){var q,p,o,f,u=false;if(!t){t=BX.message("FORMAT_DATETIME")}l=BX.util.trim(l);if(e!==false){t=t.replace(":SS","")}if(BX.type.isNotEmptyString(l)){f="";for(q=1;q<=12;q++){f=f+"|"+BX.message("MON_"+q)}var c=new RegExp("([0-9]+|[a-z]+"+f+")","ig"),x=l.match(c),g=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/ig),r=[],j=[],b={};if(!x){return null}if(x.length>g.length){g=t.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/ig)}for(q=0,p=x.length;q<p;q++){if(BX.util.trim(x[q])!=""){r[r.length]=x[q]}}for(q=0,p=g.length;q<p;q++){if(BX.util.trim(g[q])!=""){j[j.length]=g[q]}}var n=BX.util.array_search("MMMM",j);if(n>0){r[n]=BX.getNumMonth(r[n]);j[n]="MM"}else{n=BX.util.array_search("M",j);if(n>0){r[n]=BX.getNumMonth(r[n]);j[n]="MM"}}for(q=0,p=j.length;q<p;q++){o=j[q].toUpperCase();b[o]=o=="T"||o=="TT"?r[q]:parseInt(r[q],10)}if(b.DD>0&&b.MM>0&&b.YYYY>0){var w=new Date();if(u){w.setUTCDate(1);w.setUTCFullYear(b.YYYY);w.setUTCMonth(b.MM-1);w.setUTCDate(b.DD);w.setUTCHours(0,0,0)}else{w.setDate(1);w.setFullYear(b.YYYY);w.setMonth(b.MM-1);w.setDate(b.DD);w.setHours(0,0,0)}if((!isNaN(b.HH)||!isNaN(b.GG)||!isNaN(b.H)||!isNaN(b.G))&&!isNaN(b.MI)){if(!isNaN(b.H)||!isNaN(b.G)){var v=(b.T||b.TT||"am").toUpperCase()=="PM";var s=parseInt(b.H||b.G||0,10);if(v){b.HH=s+(s==12?0:12)}else{b.HH=s<12?s:0}}else{b.HH=parseInt(b.HH||b.GG||0,10)}if(isNaN(b.SS)){b.SS=0}if(u){w.setUTCHours(b.HH,b.MI,b.SS)}else{w.setHours(b.HH,b.MI,b.SS)}}return w}}return null},};a.options={};a.setOptions=function(b){if(!b||typeof(b)!="object"){return}for(var c in b){a.options[c]=b[c]}};a.getOption=function(c,b){if(typeof(a.options[c])!="undefined"){return a.options[c]}else{return b}};window.JCClock=a})();