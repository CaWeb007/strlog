(function(){BX.namespace("BX.Kanban");BX.Kanban.DropZone=function(a){a=a||{};if(!BX.Kanban.Utils.isValidId(a.id)){throw new Error("BX.Kanban.DropZone: 'id' parameter is not valid.")}this.id=a.id;this.name=null;this.color=null;this.data=Object.create(null);this.dropZoneArea=null;this.setOptions(a);this.layout={container:null,name:null,bg:null,cancel:null};this.droppedItem=null;this.captureTimeout=null};BX.Kanban.DropZone.DEFAULT_COLOR="1eae43";BX.Kanban.DropZone.prototype={getId:function(){return this.id},setOptions:function(a){if(!a){return}this.setName(a.name);this.setColor(a.color);this.setData(a.data)},setName:function(a){if(BX.type.isNotEmptyString(a)){this.name=a}},getName:function(){return this.name},setColor:function(a){if(BX.Kanban.Utils.isValidColor(a)){this.color=a.toLowerCase()}},getColor:function(){return this.color!==null?this.color:BX.Kanban.DropZone.DEFAULT_COLOR},getData:function(){return this.data},setData:function(a){if(BX.type.isPlainObject(a)){this.data=a}},getGridData:function(){return this.getGrid().getData()},setDropZoneArea:function(a){this.dropZoneArea=a},getDropZoneArea:function(){return this.dropZoneArea},getGrid:function(){return this.getDropZoneArea().getGrid()},makeDroppable:function(){var a=this.getContainer();a.onbxdestdraghover=BX.delegate(this.onDragEnter,this);a.onbxdestdraghout=BX.delegate(this.onDragLeave,this);a.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);jsDD.registerDest(a,10)},setActive:function(){this.getContainer().classList.add("main-kanban-dropzone-active")},unsetActive:function(){this.getContainer().classList.remove("main-kanban-dropzone-active")},setCaptured:function(){this.getContainer().classList.add("main-kanban-dropzone-captured")},unsetCaptured:function(){this.getContainer().classList.remove("main-kanban-dropzone-captured")},onDragEnter:function(c,a,b){this.setActive();this.getDropZoneArea().setActive()},onDragLeave:function(c,a,b){this.unsetActive();this.getDropZoneArea().unsetActive()},onDragDrop:function(d,b,c){var a=this.getGrid().getItemByElement(d);this.captureItem(a);this.getDropZoneArea().unsetActive()},captureItem:function(b){var a=new BX.Kanban.DropZoneEvent();a.setItem(b);a.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemCaptured",[a]);if(!a.isActionAllowed()){return}this.empty();this.droppedItem=b;this.getDropZoneArea().show();this.setCaptured();this.unsetActive();this.getGrid().hideItem(b);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemCaptured",[b,this]);this.captureTimeout=setTimeout(function(){this.empty();this.getDropZoneArea().hide()}.bind(this),this.getDropZoneArea().getDropZoneTimeout())},restore:function(){if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}var a=new BX.Kanban.DropZoneEvent();a.setItem(this.droppedItem);a.setDropZone(this);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onBeforeItemRestored",[a]);if(!a.isActionAllowed()){return}this.unsetActive();this.unsetCaptured();this.getGrid().unhideItem(this.droppedItem);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemRestored",[this.droppedItem,this]);this.droppedItem=null},empty:function(){if(this.captureTimeout){clearTimeout(this.captureTimeout)}if(this.droppedItem===null){return}this.unsetActive();this.unsetCaptured();this.getGrid().removeItem(this.droppedItem);BX.onCustomEvent(this.getGrid(),"Kanban.DropZone:onItemEmptied",[this.droppedItem,this]);this.droppedItem=null},getContainer:function(){if(this.layout.container!==null){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:"main-kanban-dropzone","data-id":this.getId()},children:[this.getNameContainer(),this.getCancelLink(),this.getBgContainer()]});this.makeDroppable();return this.layout.container},getNameContainer:function(){if(!this.layout.name){var a=BX.Kanban.Utils.isDarkColor(this.getColor());this.layout.name=BX.create("div",{attrs:{className:a?"main-kanban-dropzone-title":"main-kanban-dropzone-title main-kanban-dropzone-title-light"}})}return this.layout.name},getCancelLink:function(){if(!this.layout.cancel){this.layout.cancel=BX.create("div",{attrs:{className:"main-kanban-dropzone-cancel"},children:[BX.create("span",{attrs:{className:"main-kanban-dropzone-cancel-link"},events:{click:this.handleCancelClick.bind(this)},html:this.getGrid().getMessage("DROPZONE_CANCEL")})]})}return this.layout.cancel},handleCancelClick:function(a){this.restore();this.getDropZoneArea().hide()},getBgContainer:function(){if(!this.layout.bg){this.layout.bg=BX.create("div",{attrs:{className:"main-kanban-dropzone-bg"}})}return this.layout.bg},render:function(){this.getNameContainer().innerHTML=this.getName();this.getBgContainer().style.backgroundColor="#"+this.getColor();return this.getContainer()}};BX.Kanban.DropZoneEvent=function(a){a=BX.type.isPlainObject(a)||{};this.action=BX.type.isBoolean(a.action)?a.action:true;this.item=null;this.dropZone=null};BX.Kanban.DropZoneEvent.prototype={allowAction:function(){this.action=true},denyAction:function(){this.action=false},isActionAllowed:function(){return this.action},setItem:function(a){this.item=a},getItem:function(){return this.item},setDropZone:function(a){this.dropZone=a},getDropZone:function(){return this.dropZone}}})();