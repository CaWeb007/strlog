(function(){BX.namespace("BX.Kanban");BX.Kanban.Column=function(a){a=a||{};if(!BX.Kanban.Utils.isValidId(a.id)){throw new Error("BX.Kanban.Column: 'id' parameter is not valid.")}this.id=a.id;this.name=null;this.color=null;this.data=Object.create(null);this.total=null;this.isTotalFrozen=false;this.canEdit=null;this.canSort=null;this.canRemove=null;this.canAddItem=null;this.droppable=true;this.setOptions(a);this.items=[];this.draftItem=null;this.grid=null;this.page=1;this.layout={container:null,items:null,dragTarget:null,title:null,subTitle:null,subTitleAddButton:null,total:null,name:null,titleArrow:null,color:null,editForm:null,fillColorButton:null,titleTextBox:null,addColumnButton:null,editButton:null,removeButton:null};this.rectArea=null;this.dragColumnOffset=null;this.dragColumnIndex=null;this.dragTargetColumn=null;this.confirmDialog=null;this.textBoxTimeout=null;this.colorChanged=false;this.pagination=new BX.Kanban.Pagination(this)};BX.Kanban.Column.DEFAULT_COLOR="ace9fb";BX.Kanban.Column.prototype={getId:function(){return this.id},setOptions:function(a){if(!a){return}this.setName(a.name);this.setTotal(a.total);this.setColor(a.color);this.setData(a.data);var b=["canEdit","canSort","canRemove","canAddItem","droppable"];b.forEach(function(c){if(BX.type.isBoolean(a[c])){this[c]=a[c]}},this)},setColor:function(a){if(BX.Kanban.Utils.isValidColor(a)){this.color=a.toLowerCase()}},getColor:function(){return this.color!==null?this.color:BX.Kanban.Column.DEFAULT_COLOR},setGrid:function(a){this.grid=a;BX.onCustomEvent(this,"Kanban.Column:onAddedToGrid",[this])},getGrid:function(){return this.grid},getPagination:function(){return this.pagination},addItem:function(c,b){if(!(c instanceof BX.Kanban.Item)){throw new Error("item must be an instance of BX.Kanban.Item")}c.setColumnId(this.getId());var a=BX.util.array_search(b,this.items);if(a>=0){this.items.splice(a,0,c)}else{this.items.push(c)}if(c.isCountable()){this.incrementTotal()}if(this.getGrid().isRendered()){this.render()}},getItems:function(){return this.items},getItemsCount:function(){return this.items.reduce(function(b,a){return a.isCountable()&&a.isVisible()?b+1:b},0)},getFirstItem:function(c){var a=this.getItems();for(var b=0;b<a.length;b++){var d=a[b];if(d.isVisible()||c===false){return d}}return null},getLastItem:function(c){var a=this.getItems();for(var b=a.length-1;b>=0;b--){var d=a[b];if(d.isVisible()||c===false){return d}}return null},getNextItemSibling:function(c,e){c=this.getGrid().getItem(c);var a=this.getItems();var d=BX.util.array_search(c,a);if(d===-1||!a[d+1]){return null}for(var b=d+1;b<a.length;b++){var f=a[b];if(f.isVisible()||e===false){return f}}return null},getPreviousItemSibling:function(c,e){c=this.getGrid().getItem(c);var a=this.getItems();var d=BX.util.array_search(c,a);if(d===-1||!a[d-1]){return null}for(var b=d-1;b>=0;b--){var f=a[b];if(f.isVisible()||e===false){return f}}return null},removeItem:function(b){var a=false;this.items=this.items.filter(function(c){if(c===b){a=true;return false}return true});if(a){if(b.isCountable()&&b.isVisible()){this.decrementTotal()}if(this.getGrid().isRendered()){this.render()}}},removeItems:function(){this.items=[];this.total=null;BX.cleanNode(this.layout.items);this.render()},setName:function(a){if(BX.type.isNotEmptyString(a)){this.name=a}},getName:function(){return this.name},getData:function(){return this.data},setData:function(a){if(BX.type.isPlainObject(a)){this.data=a}},getGridData:function(){return this.getGrid().getData()},isEditable:function(){return this.canEdit!==null?this.canEdit:this.getGrid().canEditColumns()},isSortable:function(){return this.canSort!==null?this.canSort:this.getGrid().canSortColumns()},isRemovable:function(){return this.canRemove!==null?this.canRemove:this.getGrid().canRemoveColumns()},canAddItems:function(){return this.canAddItem!==null?this.canAddItem:this.getGrid().canAddItems()},getTotal:function(){return this.total!==null?this.total:this.getItemsCount()},incrementTotal:function(a){if(this.total!==null&&this.getGrid().isRendered()&&!this.isTotalFrozen){a=BX.type.isNumber(a)?a:1;this.total=Math.max(this.total+a,this.getItemsCount())}},decrementTotal:function(a){if(this.total!==null&&this.getGrid().isRendered()&&!this.isTotalFrozen){a=BX.type.isNumber(a)?a:1;this.total=Math.max(this.total-a,this.getItemsCount())}},freezeTotal:function(){this.isTotalFrozen=true},unfreezeTotal:function(){this.isTotalFrozen=false},setTotal:function(a){if(BX.type.isNumber(a)&&a>=0){this.total=a}},refreshTotal:function(){if(this.total!==null&&this.total<this.getItemsCount()){this.total=this.getItemsCount();this.renderTitle()}},hasLoading:function(){return this.total!==null&&this.total>this.getItemsCount()},getIndex:function(){return this.getGrid().getColumnIndex(this)},render:function(){var h=this.getTitleContainer();BX.cleanNode(h);h.appendChild(this.renderTitle());if(this.getGrid().canAddColumns()){h.appendChild(this.getAddColumnButton())}var g=this.getSubTitle();BX.cleanNode(g);var c=this.renderSubTitle();if(c!==null){g.appendChild(c)}BX.cleanNode(this.layout.items);var f=true;var b=document.createDocumentFragment();for(var d=0;d<this.items.length;d++){var e=this.items[d];if(e.isVisible()){f=false;b.appendChild(e.renderLayout())}}if(!f){this.layout.items.appendChild(b)}var a=this.getContainer();a.classList[f?"add":"remove"]("main-kanban-column-empty");a.classList[this.isDroppable()?"add":"remove"]("main-kanban-column-droppable");if(this.getGrid().isRendered()){this.getPagination().adjust();this.getGrid().adjustEmptyStub()}return a},renderTitle:function(){var a=this.getDefaultTitleLayout();var b=BX.Kanban.Utils.isDarkColor(this.getColor());a.classList[b?"add":"remove"]("main-kanban-column-title-dark");this.layout.nameInner.textContent=this.getName();this.layout.total.textContent=this.getTotal();this.layout.color.style.backgroundColor="#"+this.getColor();this.layout.titleArrow.style.background="transparent url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2213%22%20height%3D%2232%22%20viewBox%3D%220%200%2013%2032%22%3E%3Cpath%20fill%3D%22%23"+this.getColor()+"%22%20fill-opacity%3D%221%22%20d%3D%22M0%200h3c2.8%200%204%203%204%203l6%2013-6%2013s-1.06%203-4%203H0V0z%22/%3E%3C/svg%3E) no-repeat";return a},getDefaultTitleLayout:function(){if(this.layout.titleBody){return this.layout.titleBody}var a=this.getCustomTitleButtons();if(BX.type.isDomNode(a)){a=[a]}else{if(!BX.type.isArray(a)){a=[]}}this.layout.titleBody=BX.create("div",{attrs:{className:"main-kanban-column-title-wrapper"},children:[this.layout.color=BX.create("div",{attrs:{className:"main-kanban-column-title-bg",style:"background: #"+this.getColor()}}),this.layout.info=BX.create("div",{attrs:{className:"main-kanban-column-title-info"},children:[this.layout.name=BX.create("div",{attrs:{className:"main-kanban-column-title-text"},children:[this.getColumnTitle(),this.getTotalItem()]}),this.isEditable()?this.getEditButton():null].concat(a)}),this.isEditable()?this.getEditForm():null,this.layout.titleArrow=BX.create("span",{attrs:{className:"main-kanban-column-title-right"}})]});return this.layout.titleBody},getColumnTitle:function(){return this.layout.nameInner=BX.create("div",{attrs:{className:"main-kanban-column-title-text-inner"}})},getTotalItem:function(){return this.layout.total=BX.create("div",{attrs:{className:"main-kanban-column-total-item"}})},getEditButton:function(){if(this.layout.editButton){return this.layout.editButton}this.layout.editButton=BX.create("div",{attrs:{className:"main-kanban-column-edit"},events:{click:this.switchToEditMode.bind(this)}});return this.layout.editButton},getCustomTitleButtons:function(){return null},getRemoveButton:function(){if(this.layout.removeButton){return this.layout.removeButton}this.layout.removeButton=BX.create("div",{attrs:{className:"main-kanban-column-remove-button"},events:{click:this.handleRemoveButtonClick.bind(this)}});return this.layout.removeButton},getEditForm:function(){if(this.layout.editForm){return this.layout.editForm}this.layout.editForm=BX.create("div",{attrs:{className:"main-kanban-column-title-block-edit"},children:[this.getTitleTextBox(),this.getFillColorButton(),this.isRemovable()?this.getRemoveButton():null]});return this.layout.editForm},getTitleTextBox:function(){if(this.layout.titleTextBox){return this.layout.titleTextBox}this.layout.titleTextBox=BX.create("input",{attrs:{className:"main-kanban-column-title-input-edit",type:"text",placeholder:this.getGrid().getMessage("COLUMN_TITLE_PLACEHOLDER")},events:{blur:this.handleTextBoxBlur.bind(this),keydown:this.handleTextBoxKeyDown.bind(this)}});return this.layout.titleTextBox},getFillColorButton:function(){if(this.layout.fillColorButton){return this.layout.fillColorButton}this.layout.fillColorButton=BX.create("div",{attrs:{className:"main-kanban-column-color"},events:{click:this.showColorPicker.bind(this)}});return this.layout.fillColorButton},switchToEditMode:function(){this.disableDragging();this.getContainer().classList.add("main-kanban-column-edit-mode");this.getTitleTextBox().value=this.getName();this.focusTextBox()},applyEditMode:function(){var b=BX.util.trim(this.getTitleTextBox().value);var a=false;if(b.length>0&&this.getName()!==b){a=true}if(a||this.colorChanged){if(a){this.setName(b)}BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnUpdated",[this]);this.render()}this.colorChanged=false;this.enableDragging();this.getContainer().classList.remove("main-kanban-column-edit-mode")},handleTextBoxBlur:function(a){this.textBoxTimeout=setTimeout(function(){this.applyEditMode();this.textBoxTimeout=null}.bind(this),250)},stopTextBoxBlur:function(){if(this.textBoxTimeout){clearTimeout(this.textBoxTimeout)}},focusTextBox:function(){this.getTitleTextBox().focus()},handleTextBoxKeyDown:function(a){if(a.keyCode===13){this.applyEditMode()}},handleRemoveButtonClick:function(a){this.showRemoveConfirmDialog()},showColorPicker:function(){this.stopTextBoxBlur();this.getColorPicker().open()},getColorPicker:function(){if(this.colorPicker){return this.colorPicker}this.colorPicker=new BX.ColorPicker({bindElement:this.getFillColorButton(),onColorSelected:this.onColorSelected.bind(this),popupOptions:{events:{onPopupClose:this.focusTextBox.bind(this)}}});return this.colorPicker},onColorSelected:function(a){this.setColor(a.substr(1));this.colorChanged=true;this.render()},getConfirmDialog:function(){if(this.confirmDialog){return this.confirmDialog}this.confirmDialog=new BX.PopupWindow("main-kanban-confirm-"+BX.util.getRandomString(5),null,{titleBar:this.getGrid().getMessage("REMOVE_COLUMN_CONFIRM_TITLE"),content:this.getGrid().getMessage("REMOVE_COLUMN_CONFIRM_DESC"),width:400,autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},buttons:[new BX.PopupWindowButton({text:this.getGrid().getMessage("REMOVE_BUTTON"),id:"main-kanban-confirm-remove-button",className:"popup-window-button-create",events:{click:this.handleConfirmButtonClick.bind(this)}}),new BX.PopupWindowButtonLink({text:this.getGrid().getMessage("CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})],events:{onPopupClose:function(){this.focusTextBox();this.confirmDialog.destroy();this.confirmDialog=null}.bind(this)}});return this.confirmDialog},handleConfirmButtonClick:function(){var b=this.getConfirmDialog();var a=b.getButton("main-kanban-confirm-remove-button");if(a.getContainer().classList.contains("popup-window-button-wait")){return}a.addClassName("popup-window-button-wait");var c=this.getGrid().getEventPromise("Kanban.Grid:onColumnRemovedAsync",null,function(d){this.getGrid().removeColumn(this);a.removeClassName("popup-window-button-wait");b.close()}.bind(this),function(d){b.setContent(d);a.getContainer().style.display="none"}.bind(this));c.fulfill(this)},showRemoveConfirmDialog:function(){this.stopTextBoxBlur();var a=this.getConfirmDialog();a.show()},handleAddColumnButtonClick:function(b){var a=this.getGrid().addColumn({id:"kanban-new-column-"+BX.util.getRandomString(5),type:"BX.Kanban.DraftColumn",canSort:false,canAddItem:false,droppable:false,targetId:this.getGrid().getNextColumnSibling(this)});a.switchToEditMode()},renderSubTitle:function(){if(this.layout.subTitleAddButton){return this.layout.subTitleAddButton}this.layout.subTitleAddButton=BX.create("div",{attrs:{className:"main-kanban-column-subtitle-box"},children:[this.canAddItems()?BX.create("div",{attrs:{className:"main-kanban-column-add-item-button"},events:{click:this.handleAddItemButtonClick.bind(this)}}):null]});return this.layout.subTitleAddButton},handleAddItemButtonClick:function(a){this.addDraftItem(this.getFirstItem(false))},getDraftItem:function(){return this.draftItem},addDraftItem:function(b){var c="kanban-new-item-"+this.getId();if(this.getGrid().getItem(c)){return null}var a=null;if(b instanceof BX.Kanban.Item&&b.getColumn()===this){a=b}this.draftItem=this.getGrid().addItem({id:c,type:"BX.Kanban.DraftItem",columnId:this.getId(),draggable:false,droppable:false,countable:false,targetId:a});if(this.draftItem){this.draftItem.focusDraftTextArea()}return this.draftItem},removeDraftItem:function(){if(this.draftItem!==null){this.getGrid().removeItem(this.draftItem);this.draftItem=null}},getContainer:function(){if(this.layout.container!==null){return this.layout.container}this.layout.container=BX.create("div",{attrs:{className:"main-kanban-column"},children:[this.getHeader(),this.getBody()]});this.makeDraggable();this.makeDroppable();return this.layout.container},getHeader:function(){if(this.layout.header){return this.layout.header}this.layout.header=BX.create("div",{attrs:{className:"main-kanban-column-header"},children:[this.getTitleContainer(),this.getSubTitle()]});return this.layout.header},getBody:function(){if(this.layout.body){return this.layout.body}this.layout.body=BX.create("div",{attrs:{className:"main-kanban-column-body","data-id":this.getId(),"data-type":"column"},events:{wheel:BX.delegate(this.blockPageScroll,this)},children:[this.getItemsContainer(),this.getDragTarget()]});return this.layout.body},getTitleContainer:function(){if(this.layout.title){return this.layout.title}this.layout.title=BX.create("div",{attrs:{className:"main-kanban-column-title"}});return this.layout.title},getSubTitle:function(){if(!this.layout.subTitle){this.layout.subTitle=BX.create("div",{attrs:{className:"main-kanban-column-subtitle"}})}return this.layout.subTitle},getAddColumnButton:function(){if(this.layout.addColumnButton){return this.layout.addColumnButton}this.layout.addColumnButton=BX.create("div",{attrs:{className:"main-kanban-column-title-add-column"},events:{click:this.handleAddColumnButtonClick.bind(this)}});return this.layout.addColumnButton},getItemsContainer:function(){if(!this.layout.items){this.layout.items=BX.create("div",{attrs:{className:"main-kanban-column-items"}})}return this.layout.items},getDragTarget:function(){if(!this.layout.dragTarget){this.layout.dragTarget=BX.create("div",{attrs:{className:"main-kanban-column-drag-target"}})}return this.layout.dragTarget},blockPageScroll:function(a){var c=this.getBody();if(c.scrollHeight>c.offsetHeight){var b=a.deltaY||a.detail||a.wheelDelta;if(b<0&&c.scrollTop===0){a.preventDefault()}if(b>0&&c.scrollHeight-c.clientHeight-c.scrollTop<=1){a.preventDefault()}}},makeDraggable:function(){if(!this.isSortable()){return}var a=this.getTitleContainer();a.onbxdragstart=BX.delegate(this.onColumnDragStart,this);a.onbxdrag=BX.delegate(this.onColumnDrag,this);a.onbxdragstop=BX.delegate(this.onColumnDragStop,this);this.enableDragging()},makeDroppable:function(){if(!this.isDroppable()){return}var a=this.getBody();a.onbxdestdraghover=BX.delegate(this.onDragEnter,this);a.onbxdestdraghout=BX.delegate(this.onDragLeave,this);a.onbxdestdragfinish=BX.delegate(this.onDragDrop,this);a.onbxdestdragstop=BX.delegate(this.onItemDragEnd,this);jsDD.registerDest(a,40);this.disableDropping()},disableDragging:function(){if(this.isSortable()){jsDD.unregisterObject(this.getTitleContainer())}},enableDragging:function(){if(this.isSortable()){jsDD.registerObject(this.getTitleContainer())}},disableDropping:function(){if(this.isDroppable()){jsDD.disableDest(this.getBody())}},enableDropping:function(){if(this.isDroppable()){jsDD.enableDest(this.getBody())}},isDraggable:function(){return this.isSortable()},isDroppable:function(){return this.droppable},onDragEnter:function(d,b,c){var a=this.getGrid().getItemByElement(d);this.showDragTarget(a.getBodyContainer().offsetHeight)},onDragLeave:function(c,a,b){this.hideDragTarget()},onDragDrop:function(f,b,e){this.hideDragTarget();var a=this.getGrid().getItemByElement(f);var c=new BX.Kanban.DragEvent();c.setItem(a);c.setTargetColumn(this);BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onBeforeItemMoved",[c]);if(!c.isActionAllowed()){return}var d=this.getGrid().moveItem(a,this);if(d){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onItemMoved",[a,this,null])}},onItemDragEnd:function(c,a,b){this.disableDropping()},onColumnDragStart:function(){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnDragStart",[this]);this.getContainer().classList.add("main-kanban-column-draggable");this.dragColumnOffset=jsDD.start_x-this.getRectArea().left;this.dragColumnIndex=this.getIndex();this.dragTargetColumn=this.dragTargetColumn||this},onColumnDrag:function(i,f){this.getContainer().style.transform="translateX("+(i-this.dragColumnOffset-this.getRectArea().left)+"px)";var c=this.getGrid().getColumns();var a=this.getRectArea().width;for(var e in c){var b=c[e];if(b===this||!b.isSortable()){continue}var j=b.getContainer();var h=b.getRectArea();var g=h.middle;if(i>g&&e>this.dragColumnIndex&&j.style.transform!=="translateX("+(-a)+"px)"){j.style.transition="300ms";j.style.transform="translateX("+(-a)+"px)";this.dragTargetColumn=this.getGrid().getNextColumnSibling(b);b.resetRectArea()}if(i<g&&e<this.dragColumnIndex&&j.style.transform!=="translateX("+(a)+"px)"){j.style.transition="300ms";j.style.transform="translateX("+a+"px)";this.dragTargetColumn=b;b.resetRectArea()}var d=i<g&&e>this.dragColumnIndex&&j.style.transform!==""&&j.style.transform!=="translateX(0px)";var k=i>g&&e<this.dragColumnIndex&&j.style.transform!==""&&j.style.transform!=="translateX(0px)";if(k||d){j.style.transition="300ms";j.style.transform="translateX(0px)";this.dragTargetColumn=d?b:this.getGrid().getNextColumnSibling(b);b.resetRectArea()}}},onColumnDragStop:function(a,g){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnDragStop",[this]);var f=this.getGrid().moveColumn(this,this.dragTargetColumn);if(f){BX.onCustomEvent(this.getGrid(),"Kanban.Grid:onColumnMoved",[this,this.getGrid().getNextColumnSibling(this)])}this.getContainer().classList.remove("main-kanban-column-draggable");var c=this.getGrid().getColumns();for(var e in c){var d=c[e];var b=d.getContainer();d.resetRectArea();b.style.removeProperty("transition");b.style.removeProperty("transform")}this.getGrid().adjustEars()},getRectArea:function(){if(!this.rectArea){this.rectArea=BX.pos(this.getContainer());this.rectArea.middle=this.rectArea.left+this.rectArea.width/2}return this.rectArea},resetRectArea:function(){this.rectArea=null},showDragTarget:function(a){this.getContainer().classList.add("main-kanban-column-target-shown");this.getDragTarget().style.height=a+"px"},hideDragTarget:function(){this.getContainer().classList.remove("main-kanban-column-target-shown");this.getDragTarget().style.removeProperty("height")}};BX.Kanban.DraftColumn=function(a){BX.Kanban.Column.apply(this,arguments);this.asyncEventStarted=false;BX.addCustomEvent(this,"Kanban.Column:onAddedToGrid",this.onAddedToGrid.bind(this))};BX.Kanban.DraftColumn.lastColorIndex=-1;BX.Kanban.DraftColumn.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.Kanban.DraftColumn,applyEditMode:function(){if(this.asyncEventStarted){return}var b=BX.util.trim(this.getTitleTextBox().value);if(!b.length){b=this.getGrid().getMessage("COLUMN_TITLE_PLACEHOLDER")}this.setName(b);this.getContainer().classList.add("main-kanban-column-disabled");this.getTitleTextBox().disabled=true;this.asyncEventStarted=true;var a=this.getGrid().getEventPromise("Kanban.Grid:onColumnAddedAsync",null,function(c){if(!BX.Kanban.Utils.isValidId(c.targetId)){var d=this.getGrid().getNextColumnSibling(this);if(d){c.targetId=d.getId()}}this.getGrid().removeColumn(this);this.getGrid().addColumn(c)}.bind(this),function(c){this.getGrid().removeColumn(this)}.bind(this));a.fulfill(this)},handleRemoveButtonClick:function(a){this.stopTextBoxBlur();this.getGrid().removeColumn(this)},onAddedToGrid:function(){this.setColor(this.getNextColor())},getNextColor:function(){var e=BX.Kanban.Utils.getDefaultColors();if(!e.length){return null}if(BX.Kanban.DraftColumn.lastColorIndex===-1){var c=this.getGrid().getColumns();for(var b=c.length-1;b>=0;b--){var d=c[b];var a=BX.util.array_search(d.getColor(),e);if(a!==-1){BX.Kanban.DraftColumn.lastColorIndex=a;break}}}BX.Kanban.DraftColumn.lastColorIndex=e[BX.Kanban.DraftColumn.lastColorIndex+1]?BX.Kanban.DraftColumn.lastColorIndex+1:0;return e[BX.Kanban.DraftColumn.lastColorIndex]}};BX.Kanban.Pagination=function(a){this.column=a;this.timer=null;this.page=1;this.loadingInProgress=false;this.layout={topButton:null,bottomButton:null,loader:null};BX.addCustomEvent(a,"Kanban.Column:onAddedToGrid",this.init.bind(this))};BX.Kanban.Pagination.prototype={init:function(){var b=this.getColumn();var a=b.getContainer();var d=b.getBody();a.appendChild(this.getTopButton());a.appendChild(this.getBottomButton());d.appendChild(this.getLoader());var c=BX.delegate(this.adjust,this);BX.bind(d,"scroll",BX.throttle(c,150));BX.bind(window,"scroll",BX.throttle(c,150));BX.addCustomEvent("Kanban.Grid:onFirstRender",c)},adjust:function(){var c=this.getColumn();var g=c.getContainer();var e=c.getBody();var h=e.scrollHeight;var b=e.offsetHeight;var a=e.scrollTop;var i=e.scrollTop>0;var d=h>b+a;g.classList[i?"add":"remove"]("main-kanban-column-top-button-shown");g.classList[d?"add":"remove"]("main-kanban-column-bottom-button-shown");if(g.classList.contains("main-kanban-column-top-button-shown")){this.getTopButton().style.top=this.getColumn().getBody().offsetTop+"px"}jsDD.refreshDestArea();var f=this.getLoader();if(!this.loadingInProgress&&c.hasLoading()&&f.offsetTop<a+b){this.showLoader();this.loadItems()}},loadItems:function(){this.loadingInProgress=true;var a=this.getColumn().getGrid().getEventPromise("Kanban.Grid:onColumnLoadAsync",null,this.onPromiseFulfilled.bind(this),this.onPromiseRejected.bind(this));a.fulfill(this.getColumn())},onPromiseFulfilled:function(a){this.hideLoader();this.processPromiseResult(a)},onPromiseRejected:function(a){this.hideLoader()},processPromiseResult:function(a){if(!BX.type.isArray(a)||!a.length){return}var c=this.getColumn();c.freezeTotal();c.getGrid().setRenderStatus(false);var e=c.getBody().scrollTop;for(var b=0;b<a.length;b++){var d=a[b];c.getGrid().addItem(d)}c.render();c.getBody().scrollTop=e;c.getGrid().setRenderStatus(true);c.unfreezeTotal();c.refreshTotal();this.page++;this.loadingInProgress=false;this.adjust()},getColumn:function(){return this.column},getPage:function(){return this.page},getTopButton:function(){if(this.layout.topButton){return this.layout.topButton}this.layout.topButton=BX.create("div",{attrs:{className:"main-kanban-column-top-button"},events:{mouseenter:BX.delegate(this.scrollUp,this),mouseleave:BX.delegate(this.stopScroll,this)}});return this.layout.topButton},getBottomButton:function(){if(this.layout.bottomButton){return this.layout.bottomButton}this.layout.bottomButton=BX.create("div",{attrs:{className:"main-kanban-column-bottom-button"},events:{mouseenter:BX.delegate(this.scrollDown,this),mouseleave:BX.delegate(this.stopScroll,this)}});return this.layout.bottomButton},getLoader:function(){if(this.layout.loader){return this.layout.loader}this.layout.loader=BX.create("div",{attrs:{className:"main-kanban-loader"},html:'<div class="main-kanban-loader-outer"><div class="main-kanban-loader-inner"><svg class="main-kanban-loader-circle" viewBox="25 25 50 50"><circle class="main-kanban-loader-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/></svg></div></div>'});return this.layout.loader},showLoader:function(){this.getLoader().classList.add("main-kanban-loader-shown")},hideLoader:function(){this.getLoader().classList.remove("main-kanban-loader-shown")},scrollUp:function(){if(this.getColumn().getGrid().getDragMode()!==BX.Kanban.DragMode.ITEM){return}this.timer=setInterval(BX.delegate(function(){this.getColumn().getBody().scrollTop-=10},this),20)},scrollDown:function(){if(this.getColumn().getGrid().getDragMode()!==BX.Kanban.DragMode.ITEM){return}this.timer=setInterval(BX.delegate(function(){this.getColumn().getBody().scrollTop+=10},this),20)},stopScroll:function(){clearInterval(this.timer)}}})();