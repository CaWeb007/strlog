function BXDialogTree(){}BXDialogTree.prototype={Init:function(){this.arIconList={folder:"/bitrix/images/main/file_dialog/icons/folder.gif",folderopen:"/bitrix/images/main/file_dialog/icons/folderopen.gif",plus:"/bitrix/images/main/file_dialog/icons/plus.gif",minus:"/bitrix/images/main/file_dialog/icons/minus.gif",dot:"/bitrix/images/main/file_dialog/icons/dot.gif"};this.arDirConts={}},DisplayTree:function(){if(!this.oCont){this.oCont=BX("__bx_treeContainer")}BXFDCleanNode(this.oCont);var d=arFDDirs["/"],b=jsUtils.CreateElement("TABLE",{className:"bxfd-tree-tbl"}),a=d.length,c;for(c=0;c<a;c++){this.DisplayElement(d[c],b.insertRow(-1).insertCell(-1))}this.oCont.appendChild(b)},oPlusOnClick:function(a){this.OpenTreeSection(a.parentNode.parentNode.getAttribute("__bxpath"),"check")},oElementOnClick:function(a){oBXFileDialog.SetFocus("tree");this.SelectElement(a.parentNode.parentNode.getAttribute("__bxpath"))},SelectElement:function(f,d,c){if(this.curSelectedItem&&this.curSelectedItem.path==f){return true}var a=this.arDirConts[f];if(a&&a.firstChild){var e=a.firstChild.getElementsByTagName("SPAN"),b=e[0];if(this.curSelectedItem&&this.curSelectedItem.oTitle){this.UnHighlightElement(this.curSelectedItem.oTitle)}this.HighlightElement(b);if(d!==false){this.OpenTreeSection(f,true)}oBXDialogControls.dirPath.Set(f);if(c!==false){oBXDialogWindow.LoadFolderContent(f)}this.curSelectedItem={path:f,oTitle:b}}},HighlightElement:function(a){a.id="__bx_SelectedTitle";a.className="bxfd-tree-item-sel"},UnHighlightElement:function(a){a.id="";a.className="bxfd-tree-item"},DisplayElement:function(b,a){this.arDirConts[b.path]=a;var c='<table><tr __bxpath="'+b.path+'" __bx_bOpen=0><td class="tree-node-folding" >';if(b.empty){c+='<img onclick="oBXDialogTree.oElementOnClick(this);" src="'+this.arIconList.dot+'" />'}else{c+='<img onclick="oBXDialogTree.oPlusOnClick(this);" src="'+this.arIconList.plus+'" />'}c+='</td><td class="tree-node-icon" ><img onclick="oBXDialogTree.oElementOnClick(this);" src="'+this.arIconList.folder+'" /></td><td class="tree-node-name" ><span onclick="oBXDialogTree.oElementOnClick(this);" class="bxfd-tree-item" unselectable="on">'+b.name+"</span></td></tr></table>";a.innerHTML=c},LoadTree:function(d,a,b){var c=new JCHttpRequest();c.Action=function(f){oWaitWindow.Hide();var h=oBXFileDialog.CheckReqLostSessid(f);if(h!==true){if(b){return alert("0"+FD_MESS.FD_SESS_EXPIRED)}oBXFileDialog.sessid=h;return oBXDialogTree.LoadTree(d,a,true)}var g=0;var e=setInterval(function(){g++;if(window.action_warning!==false){clearInterval(e);if(!oBXDialogWindow.lastCorrectPath){oBXDialogWindow.lastCorrectPath="/"}oBXDialogTree.SetPath(oBXDialogWindow.lastCorrectPath);return alert(window.action_warning)}else{if(!window.load_items_correct){clearInterval(e);return alert(FD_MESS.FD_ERROR)}}if(arFDDirs[d]||arFDFiles[d]||g>20){clearInterval(e);if(oBXDialogTree.bRedisplayTree){oBXDialogTree.DisplayTree()}oBXDialogTree.bRedisplayTree=false;if(a===false){return oBXDialogTree.SetPath(d)}if(a==="timeout"){return oBXDialogTree.SetPath(d,false)}if(typeof arFDDirs[d]=="object"&&arFDDirs[d].length>0){oBXDialogTree.DisplaySubTree(a,arFDDirs[d])}if(oBXDialogWindow.reloadWindowPath){oBXDialogWindow.LoadFolderContent(d)}oBXDialogWindow.reloadWindowPath=true}},5)};oWaitWindow.Show();window.action_warning=false;window.load_items_correct=false;this.curLoadingPath=d;c.Send(oBXFileDialog.GetRequestUrl(getSite())+"&action=load&path="+jsUtils.urlencode(d)+"&add_to_menu="+(oBXFileDialog.oConfig.operation=="S"?"1":"")+"&rec="+(a===false?"2":"0"))},focusOnSelectedElment:function(){if(!this.curSelectedItem){return true}var b=this.curSelectedItem.oTitle,a=this.oCont.scrollTop;this.tmpFocusInp=jsUtils.CreateElement("INPUT",{size:1,id:"bx_fd_tmp_focus_inp"});b.parentNode.insertBefore(this.tmpFocusInp,b);setTimeout(function(){var d=(oBXDialogTree.tmpFocusInp&&oBXDialogTree.tmpFocusInp.parentNode)?oBXDialogTree.tmpFocusInp:BX("bx_fd_tmp_focus_inp");if(d){d.focus();var c=oBXDialogTree.oCont.scrollTop;if(a<c){oBXDialogTree.oCont.scrollTop+=120}d.parentNode.removeChild(d);d=null}},10)},OpenTreeSection:function(i,c){var h=this.arDirConts[i];if(!h){return}var d=h.getElementsByTagName("TABLE"),j=d[0].rows[0],g=j.getAttribute("__bx_bOpen"),a=d[0].getElementsByTagName("IMG"),b=a[0],e=a[1];if(b.src.indexOf("dot.gif")!=-1){return}if(c=="check"){c=(g!=1)}if(c){j.setAttribute("__bx_bOpen",1);b.src=this.arIconList.minus;e.src=this.arIconList.folderopen;if(!window.arFDDirs[i]){this.LoadTree(i,h)}else{this.DisplaySubTree(h,window.arFDDirs[i])}oBXDialogControls.dirPath.Set(i)}else{var f=d[1];if(!f){return}e.src=this.arIconList.folder;b.src=this.arIconList.plus;f.style.display="none";j.setAttribute("__bx_bOpen",0)}},HighlightPath:function(m){try{if(m==""||m=="/"){if(this.curSelectedItem&&this.curSelectedItem.oTitle){this.UnHighlightElement(this.curSelectedItem.oTitle)}this.oCont.scrollTop=0;return}m=m.replace(/\\/ig,"/");var a=m.split("/"),j="",b,d,c=a.length;for(d=0;d<c;d++){b=a[d];if(b!=""){j+="/"+b;this.OpenTreeSection(j,true)}}var h=this.arDirConts[j],k=h.firstChild.getElementsByTagName("SPAN"),g=k[0];if(this.curSelectedItem&&this.curSelectedItem.oTitle){this.UnHighlightElement(this.curSelectedItem.oTitle)}this.HighlightElement(g);this.curSelectedItem={path:j,oTitle:g}}catch(f){setTimeout(function(){oBXDialogTree.HighlightPath(m)},100)}oBXDialogTree.focusOnSelectedElment()},SetPath:function(b,a){b=b.replace(/\\/ig,"/");b=b.replace(/[\/]+$/g,"");b=BX.util.trim(b);if(b==""||b.indexOf("..")!=-1||b=="/"||b=="./"||b=="/."||b=="."){b="/"}if(!window.arFDDirs[b]&&!window.arFDFiles[b]){return this.LoadTree(b,false)}if(a!==false){oBXDialogTree.HighlightPath(b)}oBXDialogControls.dirPath.Set(b);if(arFDDirs[b]&&arFDFiles[b]){return oBXDialogWindow.DisplayFolderContent(b)}},DisplaySubTree:function(e,h,g){if(!e||h===false){return}var c=e.getElementsByTagName("TABLE");if(g&&c[1]){c[1].parentNode.removeChild(c[1])}if(c[1]&&!g){c[1].style.display="block"}else{var b=jsUtils.CreateElement("TABLE",{},{marginLeft:"15px"}),a=h.length,d,f;for(f=0;f<a;f++){d=b.insertRow(-1).insertCell(-1);this.DisplayElement(h[f],d)}e.appendChild(b)}},Append:function(){var d=oBXFileDialog.oConfig.path;if(d!="/"&&d.substr(d.length-1)=="/"){d=d.substr(0,d.length-1)}this.Init();this.DisplayTree();this.HighlightPath(d);var a=0,c=20;var b=setInterval(function(){a++;if(arFDDirs[d]||arFDFiles[d]||a>c){clearInterval(b);if(a<c+1){oBXDialogWindow.DisplayFolderContent(d)}}},5);oBXDialogControls.dirPath.Set(d,false)},OnKeyDown:function(n){if(!this.curSelectedItem){return}var t=this.curSelectedItem.path,a=false,b,r,s,k,q;switch(n.keyCode){case 37:if(this.SectionIsOpened(t)){this.OpenTreeSection(t,false);break}b=t.lastIndexOf("/");r=b==0?"/":t.substr(0,b);s=arFDDirs[r];a=r=="/"?s[0].path:r;break;case 38:b=t.lastIndexOf("/");r=b==0?"/":t.substr(0,b);s=arFDDirs[r];l=s.length;if(l>0){for(k=0;k<l;k++){if(s[k].path==t){q=k;break}}}if(q==0&&r=="/"){break}if(q==0){a=r;break}var p=s[q-1];if(this.SectionIsOpened(p.path)){var d=arFDDirs[p.path].length;if(d>0){a=arFDDirs[p.path][d-1].path}}else{a=p.path}break;case 39:b=t.lastIndexOf("/");r=b==0?"/":t.substr(0,b);s=arFDDirs[r];l=s.length;if(l>0){for(k=0;k<l;k++){if(s[k].path==t){q=k;break}}}if(!s[q].empty){if(this.SectionIsOpened(t)&&arFDDirs[t]&&arFDDirs[t][0]){a=arFDDirs[t][0].path}else{this.OpenTreeSection(t,true)}}break;case 40:b=t.lastIndexOf("/");r=b==0?"/":t.substr(0,b);s=arFDDirs[r];l=s.length;if(this.SectionIsOpened(t)&&arFDDirs[t]&&arFDDirs[t][0]){a=arFDDirs[t][0].path;break}if(l>0){for(k=0;k<l;k++){if(s[k].path==t){q=k;break}}}if(q+1<l){var o=s[q+1];a=o.path}else{if(r=="/"){break}var f=r.lastIndexOf("/"),c=f==0?"/":r.substr(0,f),j=arFDDirs[c],g=j.length,h,m;if(g){for(h=0;h<g;h++){if(j[h].path==r){m=h;break}}if(m<g-1){a=j[m+1].path}}}break;case 8:b=t.lastIndexOf("/");r=b==0?"/":t.substr(0,b);s=arFDDirs[r];a=r=="/"?s[0].path:r;break}if(a!==false){this.TimeoutSelectElement(a);return BX.PreventDefault(n)}},TimeoutSelectElement:function(a){if(this.selectTimeout){clearTimeout(this.selectTimeout)}this.SelectElement(a,false,false);this.selectTimeout=setTimeout(function(){if(oBXDialogTree.curSelectedItem.path==a){oBXDialogWindow.LoadFolderContent(a,false,true);oBXDialogTree.focusOnSelectedElment()}},500)},SectionIsOpened:function(b){try{return this.arDirConts[b].firstChild.rows[0].getAttribute("__bx_bOpen")==1}catch(a){return false}}};function BXDialogWindow(){this.Init()}BXDialogWindow.prototype={Init:function(){this.pWnd=BX("__bx_windowContainer");this.view=oBXFileDialog.UserConfig.view;this.lastCorrectPath="";this.sort=oBXFileDialog.UserConfig.sort;this.sort_order=oBXFileDialog.UserConfig.sort_order;this.filter=oBXDialogControls.Filter.curentFilter;this.arFiles={};oBXDialogControls.ViewSelector.Set(this.view,false);oBXDialogControls.SortSelector.Set(this.sort,this.sort_order);var a=BX("BX_file_dialog_title");this.cancelRename_innerHTML="";if(oBXFileDialog.oConfig.operation=="S"){a.innerHTML=FD_MESS.FD_SAVE_TAB_TITLE}else{if(oBXFileDialog.oConfig.operation=="O"&&oBXFileDialog.oConfig.select=="D"){a.innerHTML=FD_MESS.FD_OPEN_DIR}else{a.innerHTML=FD_MESS.FD_OPEN_TAB_TITLE}}BX("BX_file_dialog_close").title=FD_MESS.FD_CLOSE;this.iconsPath="/bitrix/images/main/file_dialog/icons/types/";this.arIcons={css:{small:"css.gif",big:"css_big.gif",type:"CSS "+FD_MESS.FD_FILE},csv:{small:"csv.gif",big:"csv_big.gif",type:"CSV "+FD_MESS.FD_FILE},file:{small:"file.gif",big:"file_big.gif",type:FD_MESS.FD_FILE},flash:{small:"flash.gif",big:"flash_big.gif",type:"Adobe Macromedia Flash "+FD_MESS.FD_FILE},folder:{small:"folder.gif",big:"folder_big.gif",type:FD_MESS.FD_FOLDER},gif:{small:"gif.gif",big:"gif_big.gif",type:FD_MESS.FD_IMAGE+" GIF"},htaccess:{small:"htaccess.gif",big:"htaccess_big.gif",type:"htaccess "+FD_MESS.FD_FILE},html:{small:"html.gif",big:"html_big.gif",type:"HTML "+FD_MESS.FD_FILE},jpg:{small:"jpeg.gif",big:"jpeg_big.gif",type:FD_MESS.FD_IMAGE+" JPG"},jpeg:{small:"jpeg.gif",big:"jpeg_big.gif",type:FD_MESS.FD_IMAGE+" JPEG"},js:{small:"js.gif",big:"js_big.gif",type:"Javascript "+FD_MESS.FD_FILE},php:{small:"php.gif",big:"php_big.gif",type:"PHP "+FD_MESS.FD_FILE},png:{small:"png.gif",big:"png_big.gif",type:FD_MESS.FD_IMAGE+" PNG"},txt:{small:"txt.gif",big:"txt_big.gif",type:"Text "+FD_MESS.FD_FILE},xml:{small:"xml.gif",big:"xml_big.gif",type:"XML "+FD_MESS.FD_FILE}};this.oCM=new BXFDContextMenu();this.oSorter=new BXFDSorter()},LoadFolderContent:function(b,c,a){if(b.indexOf("..")!=-1){b="/"}if(c===true){arFDDirs[b]=false;arFDFiles[b]=false}if(arFDDirs[b]&&arFDFiles[b]&&c!==true){return this.DisplayFolderContent(b)}if(oBXDialogTree.curLoadingPath!=b){oBXDialogTree.LoadTree(b,a===true?"timeout":false)}},DisplayFolderContent:function(b){if(b==""){b="/"}var a=window.arFDPermission[b];if(oBXFileDialog.oConfig.operation=="O"&&oBXFileDialog.oConfig.showUploadTab&&a){oBXDialogTabs.DisableTab("tab2",!a.upload)}if(arFDDirs[b]&&arFDFiles[b]){oBXDialogWindow.DisplayElementsList(arFDDirs[b],arFDFiles[b],oBXDialogWindow.view,oBXDialogWindow.filter,oBXDialogWindow.sort,oBXDialogWindow.sort_order)}this.reloadWindowPath=b;this.lastCorrectPath=b;oBXDialogControls.Preview.Clear();if(oBXFileDialog.oConfig.operation=="O"){oBXDialogControls.filePath.Set("")}if(oBXFileDialog.oConfig.operation=="S"&&oBXFileDialog.oConfig.showAddToMenuTab){oBXMenuHandling.ChangeMenuType()}},DisplayElementsList:function(t,b,h,g,x,r){if(t===false&&b===false){return}if(typeof t!="object"||typeof b!="object"){return}oBXDialogWindow.view=h;var q=this,e=t.length,d=b.length,a=[],k=(g===""||g===false)?"*":oBXDialogControls.Filter.arFilters[g],f,n,o,c,v,u,p,s,m;for(u=0;u<e;u++){f=t[u];a.push({name:f.name,icon:"folder",path:f.path,permission:f.permission,date:f.date,timestamp:f.timestamp,size:f.size})}if(oBXFileDialog.bSelectFiles){for(u=0;u<d;u++){m=false;n=b[u];c=n.name.substr(n.name.lastIndexOf(".")+1).toLowerCase();v=(!this.arIcons[c])?"file":c;if(k!="*"){p=k.length;for(s=0;s<p;s++){if(c==k[s]){m=true;break}}}else{m=true}if(m){a.push({name:n.name,icon:v,ext:c,path:n.path,permission:n.permission,date:n.date,timestamp:n.timestamp,size:n.size,tmb:n.tmb_src||""})}}}oWaitWindow.Show();setTimeout(function(){oBXDialogWindow.oNameInput=false;oBXDialogWindow.oSorter.Sort(a);q.arElIndex=[];q["DisplayElList_"+h](a);oBXDialogControls.NewDirButtonChange();oWaitWindow.Hide()},3)},DisplayElList_list:function(a){var g=function(m,k){var j=parseInt(m.style.width||m.offsetWidth);if(isNaN(j)){j=0}var i=220;var n=k.insertCell(-1);m.style.width=(j+i)+"px";n.className="bx-valign-top";n.style.width=i+"px";return n};var f=BX("__bx_oSubContTable");if(f){f.parentNode.removeChild(f)}f=this.pWnd.appendChild(jsUtils.CreateElement("TABLE",{id:"__bx_oSubContTable"},{height:"228px",width:"0px"}));var d=f.insertRow(-1);var b=a.length,e,h,c;if(b==0){c=g(f,d);h=c.appendChild(jsUtils.CreateElement("TABLE",{},{width:"100%"}))}else{for(e=0;e<b;e++){if(e%12==0){c=g(f,d);h=c.appendChild(jsUtils.CreateElement("TABLE",{},{width:"100%"}))}this.AddElementToList("list",h,a[e],e)}}this.Last_ElList_len=b},DisplayElList_detail:function(c){var e=BX("__bx_oSubContTable");if(e){e.parentNode.removeChild(e)}e=document.createElement("TABLE");e.id="__bx_oSubContTable";this.pWnd.appendChild(e);e.style.height="0%";e.style.width="100%";var a=e.insertRow(-1);a.className="bxfd-det-view-head";var b=function(){n.innerHTML=FD_MESS.FD_SORT_NAME;d.innerHTML=FD_MESS.FD_SORT_SIZE;k.innerHTML=FD_MESS.FD_SORT_TYPE;m.innerHTML=FD_MESS.FD_SORT_DATE};var j=a.insertCell(-1),n=a.insertCell(-1),d=a.insertCell(-1),k=a.insertCell(-1),m=a.insertCell(-1);n.style.width="45%";j.style.width="15px";b();var g="<img src='/bitrix/images/main/file_dialog/arrow_"+(oBXDialogWindow.sort_order=="asc"?"up":"down")+".gif'>";switch(oBXDialogWindow.sort){case"name":n.innerHTML+="&nbsp;"+g;n.setAttribute("sort_order",oBXDialogWindow.sort_order);break;case"size":d.innerHTML+="&nbsp;"+g;d.setAttribute("sort_order",oBXDialogWindow.sort_order);break;case"type":k.innerHTML+="&nbsp;"+g;k.setAttribute("sort_order",oBXDialogWindow.sort_order);break;case"date":m.innerHTML+="&nbsp;"+g;m.setAttribute("sort_order",oBXDialogWindow.sort_order);break}var o=function(r,p){b();if(oBXDialogWindow.sort!=r){oBXDialogWindow.sort=r;var q="asc"}else{q=(p.getAttribute("sort_order")=="asc")?"des":"asc"}p.setAttribute("sort_order",q);oBXDialogWindow.sort_order=q;var i="<img src='/bitrix/images/main/file_dialog/arrow_"+(oBXDialogWindow.sort_order=="asc"?"up":"down")+".gif'>";p.innerHTML+="&nbsp;"+i;oWaitWindow.Show();setTimeout(function(){oBXDialogControls.SortSelector.Set(r,q);oBXDialogWindow.oSorter.Sort(c);oBXDialogWindow.DisplayElList_detail(c);oWaitWindow.Hide()},5)};n.onclick=function(){o("name",n)};d.onclick=function(){o("size",d)};k.onclick=function(){o("type",k)};m.onclick=function(){o("date",m)};for(var h=0,f=c.length;h<f;h++){this.AddElementToList("detail",e,c[h],h)}},DisplayElList_preview:function(a){var e=BX("__bx_oSubContTable");if(e){e.parentNode.removeChild(e)}e=this.pWnd.appendChild(jsUtils.CreateElement("TABLE",{id:"__bx_oSubContTable"},{height:"0%",width:"100%"}));var c=e.insertRow(-1).insertCell(-1),d,b=a.length;for(d=0;d<b;d++){this.AddElementToList("preview",c,a[d],d)}},AddElementToList:function(j,s,n,g){if(!n){return}this.arElIndex[g]=n;var c=(n.icon!="folder")?getFileSize(n.size):"",k=(jsUtils.IsIE())?(n.name+(n.icon!="folder"?"\n"+FD_MESS.FD_SORT_SIZE+": "+c:"")+"\n"+FD_MESS.FD_SORT_DATE+": "+n.date):(n.name),p,f;if(j=="list"){a=s.insertRow(-1);p=a.insertCell(-1);var b=a.insertCell(-1);f=oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons[n.icon].small;p.innerHTML='<img src="'+f+'" title="'+k+'" />';p.style.width="0%";b.unselectable="on";b.title=k;b.className="bxfd-win-item";b.innerHTML="<span class='title'>"+oBXDialogWindow.checkNameLength(n.name,210)+"</span>"}else{if(j=="detail"){a=s.insertRow(-1);a.className="bxfd-det-list-row";p=a.insertCell(-1);var m=a.insertCell(-1),d=a.insertCell(-1),t=a.insertCell(-1),h=a.insertCell(-1),r=oBXDialogWindow.arIcons[n.icon].type,i=n.date;f=oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons[n.icon].small;p.innerHTML='<img src="'+f+'" title="'+k+'" />';p.style.width="10px";m.unselectable="on";m.style.cursor="default";m.style.textAlign="left";m.title=k;m.innerHTML="<span class='title'>"+oBXDialogWindow.checkNameLength(n.name,210)+"</span>";m.className="bxfd-win-item";d.style.textAlign="right";d.style.paddingRight="5px";d.innerHTML=c;t.innerHTML=r;h.innerHTML=i}else{if(j=="preview"){var a=s.appendChild(jsUtils.CreateElement("DIV",{className:"bxfd-prev-cont",title:k})),q=a.appendChild(jsUtils.CreateElement("TABLE",{},{width:"100%",height:"100%"})),o=q.insertRow(-1).insertCell(-1),e=q.insertRow(-1).insertCell(-1);f=(oBXFileDialog.oConfig.genThumb&&n.tmb)?n.tmb:oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons[n.icon].big;o.align="center";o.unselectable="on";o.valign="middle";o.style.height="110px";o.appendChild(jsUtils.CreateElement("IMG",{src:f}));e.align="center";e.unselectable="on";e.style.cursor="default";e.innerHTML=oBXDialogWindow.checkNameLength(n.name,170)+(c!=""?"<br />"+c:"")}}}oBXDialogWindow.AddElementsEventHandlers(a,n)},AddElementsEventHandlers:function(b,a){if(!a._winCont){a._winCont={}}a._winCont[this.view]=b;this.arFiles[a.path]=a;b.setAttribute("__bxpath",a.path);if(a.icon=="folder"){b.onclick=function(f){oBXFileDialog.SetFocus("window");var d=this.getAttribute("__bxpath");var c=false;if(oBXFileDialog.bSelectDirs){c=getFileName(d)}oBXDialogWindow.SelectElement(this,d,c)};b.ondblclick=function(c){oBXFileDialog.SetFocus("window");oBXDialogTree.SetPath(this.getAttribute("__bxpath"))}}else{b.onclick=function(d){if(!oBXFileDialog.bSelectFiles){return}oBXFileDialog.SetFocus("window");var c=this.getAttribute("__bxpath");oBXDialogWindow.SelectElement(this,c,getFileName(c))};b.ondblclick=function(d){var c=this.getAttribute("__bxpath");oBXDialogWindow.SelectElement(this,c,getFileName(c));oBXFileDialog.SubmitFileDialog()}}b.oncontextmenu=oBXDialogWindow.OnContextMenu},checkNameLength:function(b,c,d){if(b.length<=12){return b}if(!d){d=false}oDiv=document.createElement("DIV");oDiv.style.position="absolute";oDiv.innerHTML=b;document.body.appendChild(oDiv);w=oDiv.offsetWidth;document.body.removeChild(oDiv);if(w<c&&!d){return b}var a=b.length;name_base=b.substr(0,b.length-7);name_end=b.substr(b.length-7);if(w>=c){b=this.checkNameLength(name_base.substr(0,name_base.length-3)+name_end,c,true)}else{if(d){b=name_base+"..."+name_end}}return b},SelectElement:function(b,f,a){this.curSelectedItem={cont:b,path:f};if(this.view=="preview"){var e=BX("bxfd_selected_element_preview");if(e){e.id=""}if(b){b.id="bxfd_selected_element_preview"}}else{var d=BX("bxfd_selected_element_icon"),c=BX("bxfd_selected_element_title");if(d){d.id=""}if(c){c.id=""}if(b){this.HighlightElement(b.cells[0],b.cells[1])}}if(a){oBXDialogControls.filePath.Set(a);oBXDialogControls.Preview.Display(f)}},HighlightElement:function(b,a){if(b){b.id="bxfd_selected_element_icon"}a.id="bxfd_selected_element_title"},AddNewElement:function(){oBXDialogWindow.oNameInput=false;switch(oBXDialogWindow.view){case"list":this.AddNewElement_list();break;case"detail":this.AddNewElement_detail();break;case"preview":this.AddNewElement_preview();break}},AddNewElement_list:function(){var d=function(h,g){var f=220;h.style.width=(parseInt(h.style.width)+f)+"px";var i=g.insertCell(-1);i.className="bx-valign-top";i.style.width=f+"px";return i};var b=function(f,g){oR=f.insertRow(-1);var j=oR.insertCell(-1);var i=oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons.folder.small;j.innerHTML='<img src="'+i+'"/>';j.style.width="0%";oTitleCell=oR.insertCell(-1);oTitleCell.unselectable="on";oTitleCell.style.cursor="default";oTitleCell.style.width="100%";oTitleCell.style.textAlign="left";var h=oTitleCell.appendChild(jsUtils.CreateElement("INPUT",{type:"text",value:oBXDialogControls.DefaultDirName,id:"__edited_element",__bx_mode:"new"},{width:"100%"}));oBXDialogWindow.oNameInput=h;oBXDialogWindow.SelectInput(h);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.addEvent(h,"blur",oBXDialogWindow.OnElementBlur)};var c=BX("__bx_oSubContTable"),a=c.rows[0],e=a.cells[a.cells.length-1].childNodes[0];if(this.Last_ElList_len%12==0&&this.Last_ElList_len>0){oSubCont=d(c,a);e=oSubCont.appendChild(document.createElement("TABLE"));e.style.width="100%"}b(e)},AddNewElement_detail:function(){var a=function(i){var j=i.insertRow(-1);var d=j.insertCell(-1);var c=oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons.folder.small;d.innerHTML='<img src="'+c+'" />';d.style.width="10px";var g=j.insertCell(-1);g.className="bxfd-win-item";var k=j.insertCell(-1);var e=j.insertCell(-1);var f=j.insertCell(-1);var h=g.appendChild(jsUtils.CreateElement("INPUT",{type:"text",value:oBXDialogControls.DefaultDirName,id:"__edited_element",__bx_mode:"new"},{width:"100%"}));oBXDialogWindow.oNameInput=h;oBXDialogWindow.SelectInput(h);jsUtils.addEvent(document,"keydown",oBXDialogWindow.OnElementKeyPress);jsUtils.addEvent(h,"blur",oBXDialogWindow.OnElementBlur)};var b=BX("__bx_oSubContTable");a(b)},AddNewElement_preview:function(){var c=function(e){var d=e.appendChild(jsUtils.CreateElement("DIV",{className:"bxfd-prev-cont"}));var g=d.appendChild(jsUtils.CreateElement("TABLE",{},{width:"100%",height:"100%"}));var f=g.insertRow(-1).insertCell(-1);f.align="center";f.unselectable="on";f.valign="middle";f.style.height="110px";var i=g.insertRow(-1).insertCell(-1);f.appendChild(jsUtils.CreateElement("IMG",{src:oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons.folder.big}));var h=i.appendChild(jsUtils.CreateElement("INPUT",{type:"text",value:oBXDialogControls.DefaultDirName,id:"__edited_element",__bx_mode:"new"},{width:"100%"}));oBXDialogWindow.oNameInput=h;oBXDialogWindow.oNameInput=h;oBXDialogWindow.SelectInput(h);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.addEvent(h,"blur",oBXDialogWindow.OnElementBlur)};var b=BX("__bx_oSubContTable");var a=b.rows[0].cells[0];c(a)},RenameElement:function(a){var d=a.getAttribute("__bxpath"),b=oBXDialogWindow.arFiles[d],c;oBXFileDialog.SetFocus("");oBXDialogWindow.oNameInput=false;if(a.nodeName.toUpperCase()=="TABLE"){c=a.cells[1]}else{c=a.getElementsByTagName("TD")[1]}oBXDialogWindow.cancelRename_innerHTML=c.innerHTML;c.innerHTML="";var e=c.appendChild(jsUtils.CreateElement("INPUT",{type:"text",value:b.name,id:"__edited_element",__bx_mode:"rename",__bx_old_name:b.name},{width:"100%"}));oBXDialogWindow.oNameInput=e;oBXDialogWindow.SelectInput(e);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.addEvent(e,"blur",oBXDialogWindow.OnElementBlur)},OnElementKeyPress:function(d){try{if(!d){d=window.event}if(!d){return}var a=(d.keyCode==27);var g=(d.keyCode==13);if(a||g){var c=BX("__edited_element");jsUtils.removeEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.removeEvent(c,"blur",oBXDialogWindow.OnElementBlur);var f=c.getAttribute("__bx_mode");if(f=="new"){oBXDialogWindow.NewDir((a)?oBXDialogControls.DefaultDirName:c.value)}else{if(f=="rename"){var b=c.getAttribute("__bx_old_name");if(a){oBXDialogWindow.CancelRename()}else{oBXDialogWindow.Rename(b,c.value)}}}}}catch(d){}},OnElementBlur:function(c){var b=BX("__edited_element");if(!b){return}jsUtils.removeEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.removeEvent(b,"blur",oBXDialogWindow.OnElementBlur);var d=b.getAttribute("__bx_mode");if(d=="new"){oBXDialogWindow.NewDir(b.value)}else{if(d=="rename"){var a=b.getAttribute("__bx_old_name");oBXDialogWindow.Rename(a,b.value)}}},NewDir:function(a,b){var c=oBXDialogControls.dirPath.Get();setTimeout(function(){var d=new JCHttpRequest();window.action_warning="";d.Action=function(f){setTimeout(function(){oWaitWindow.Hide();var n=oBXFileDialog.CheckReqLostSessid(f);if(n!==true){if(b){return alert(FD_MESS.FD_SESS_EXPIRED)}oBXFileDialog.sessid=n;return oBXDialogWindow.NewDir(a,true)}if(!window.action_status){if(window.action_warning.length>0){alert(window.action_warning)}var k=BX("__edited_element");if(k){oBXDialogWindow.SelectInput(k);jsUtils.addEvent(k,"blur",oBXDialogWindow.OnElementBlur);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress)}}else{if(window.action_status===true){arFDDirs[c+"/"+a]=[];arFDFiles[c+"/"+a]=[];oBXDialogWindow.DisplayFolderContent(c);var h=c.lastIndexOf("/"),o=h==0?"/":c.substr(0,h),m=arFDDirs[o],g=m.length,j;for(j=0;j<g;j++){if(m[j].path==c){m[j].empty=false;break}}oBXDialogTree.DisplaySubTree(oBXDialogTree.arDirConts[o],window.arFDDirs[o],true);oBXDialogTree.HighlightPath(c);setTimeout(function(){var p;if(c=="/"){p="/"+a}else{p=c+"/"+a}var i=oBXDialogWindow.arFiles[p];if(i&&i._winCont&&i._winCont[oBXDialogWindow.view]){oBXDialogWindow.SelectElement(i._winCont[oBXDialogWindow.view],a)}if(c=="/"){oBXDialogTree.DisplayTree()}else{oBXDialogTree.DisplaySubTree(oBXDialogTree.arDirConts[c],window.arFDDirs[c],true)}},50)}}},5)};var e=oBXDialogWindow.ClientSideCheck(c,a,false,true);if(e!==true){setTimeout(function(){if(!window.oBXFileDialog){return}alert(e);var f=BX("__edited_element");if(f){oBXDialogWindow.SelectInput(f);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.addEvent(f,"blur",oBXDialogWindow.OnElementBlur)}},250)}else{oWaitWindow.Show();oBXFileDialog.RequestUrl=oBXFileDialog.GetRequestUrl(getSite());d.Send(oBXFileDialog.RequestUrl+"&action=new_dir&path="+jsUtils.urlencode(c)+"&name="+jsUtils.urlencode(a)+"&add_to_menu="+(oBXFileDialog.oConfig.operation=="S"?"1":""))}},5)},Remove:function(d,c,b){var a=new JCHttpRequest();window.action_warning="";a.Action=function(e){setTimeout(function(){oWaitWindow.Hide();var h=oBXFileDialog.CheckReqLostSessid(e);if(h!==true){if(b){return alert(FD_MESS.FD_SESS_EXPIRED)}oBXFileDialog.sessid=h;return oBXDialogWindow.Remove(d,c,true)}if(!window.action_status){if(window.action_warning.length>0){return alert(window.action_warning)}}else{if(window.action_status===true){var o=d.lastIndexOf("/");if(o!=-1){var g,j=d.length;for(g in window.arFDDirs){if(g.substr(0,j)==d){window.arFDDirs[g]=false}}for(g in window.arFDFiles){if(g.substr(0,j)==d){window.arFDFiles[g]=false}}var q=o==0?"/":d.substr(0,o);oBXDialogWindow.DisplayFolderContent(q);if(c){var m=q,r=arFDDirs[q];if(r.length==0){var n=q.lastIndexOf("/"),f=q.substr(0,n),k;if(arFDDirs[f]&&arFDDirs[f].length){for(k=0;k<arFDDirs[f].length;k++){if(arFDDirs[f][k]&&arFDDirs[f][k].path==q){arFDDirs[f][k].empty=true;break}}}m=f}oBXDialogTree.DisplaySubTree(oBXDialogTree.arDirConts[m],window.arFDDirs[m],true);oBXDialogTree.HighlightPath(q)}}}}},5)};oWaitWindow.Show();oBXFileDialog.RequestUrl=oBXFileDialog.GetRequestUrl(getSite());a.Send(oBXFileDialog.RequestUrl+"&action=remove&path="+jsUtils.urlencode(d)+"&add_to_menu="+(oBXFileDialog.oConfig.operation=="S"?"1":""))},Rename:function(a,c,d){if(a==c){return oBXDialogWindow.CancelRename()}var g=oBXDialogControls.dirPath.Get(),b=oBXDialogWindow.arFiles[(g=="/"?"":g)+"/"+a],e=b.icon=="folder",h=oBXDialogWindow.ClientSideCheck(g,c,!e,e);if(h!==true){setTimeout(function(){if(!window.oBXFileDialog){return}alert(h);var i=BX("__edited_element");if(i){i.value=a;oBXDialogWindow.SelectInput(i);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress);jsUtils.addEvent(i,"blur",oBXDialogWindow.OnElementBlur)}},100)}else{var f=new JCHttpRequest();window.action_warning="";f.Action=function(i){if(!window.oBXFileDialog){return}setTimeout(function(){oWaitWindow.Hide();var m=oBXFileDialog.CheckReqLostSessid(i);if(m!==true){if(d){return alert(FD_MESS.FD_SESS_EXPIRED)}oBXFileDialog.sessid=m;return oBXDialogWindow.Rename(a,c,true)}if(!window.action_status){if(window.action_warning.length>0){alert(window.action_warning)}var k=BX("__edited_element");if(k){oBXDialogWindow.SelectInput(k);jsUtils.addEvent(k,"blur",oBXDialogWindow.OnElementBlur);jsUtils.addEvent(document,"keypress",oBXDialogWindow.OnElementKeyPress)}}else{if(window.action_status===true){oBXDialogWindow.DisplayFolderContent(g);var j=oBXDialogTree.arDirConts[g];if(j){oBXDialogTree.DisplaySubTree(j,window.arFDDirs[g],true)}}}},5)};oWaitWindow.Show();oBXFileDialog.RequestUrl=oBXFileDialog.GetRequestUrl(getSite());f.Send(oBXFileDialog.RequestUrl+"&action=rename&path="+jsUtils.urlencode(g)+"&add_to_menu="+(oBXFileDialog.oConfig.operation=="S"?"1":"")+"&name="+jsUtils.urlencode(c)+"&old_name="+jsUtils.urlencode(a))}},CancelRename:function(){var a=BX("__edited_element");if(a){a.parentNode.innerHTML=oBXDialogWindow.cancelRename_innerHTML}oBXDialogWindow.oNameInput=false},ClientSideCheck:function(f,b,c,a){if(b.length<=0){return FD_MESS.FD_EMPTY_NAME}var e,d=b.replace(/[\\\/:*?\"\'<>|]/i,"");if(b!==d){return FD_MESS.FD_INCORRECT_NAME}if(c&&oBXFileDialog.bSelectFiles){for(e in arFDFiles[f]){if(arFDFiles[f][e].name==b){return FD_MESS.FD_NEWFILE_EXISTS}}}if(a){for(e in arFDDirs[f]){if(arFDDirs[f][e].name==b){return FD_MESS.FD_NEWFOLDER_EXISTS}}}return true},SelectInput:function(a,b){if(!b){b=oBXDialogControls.DefaultDirName}if(!a){a=BX("__edited_element")}if(!a){return}a.select();a.focus()},OnContextMenu:function(f){var a=this,d=a.getAttribute("__bxpath"),b=oBXDialogWindow.arFiles[d];if(!f){f=window.event}if(!f||!b){return}oBXFileDialog.SetFocus("window");oBXDialogWindow.SelectElement(a,d);if(b.permission.del||b.permission.ren){if(f.pageX||f.pageY){f.realX=f.pageX;f.realY=f.pageY}else{if(f.clientX||f.clientY){f.realX=f.clientX+document.body.scrollLeft;f.realY=f.clientY+document.body.scrollTop}}var c=[];if(b.permission.ren){c.push({id:"rename",src:"/bitrix/images/main/file_dialog/rename.gif",name:FD_MESS.FD_RENAME,title:FD_MESS.FD_RENAME_TITLE,handler:function(){oBXDialogWindow.RenameElement(a)}})}if(b.permission.del){if(c.length>0){c.push("separator")}c.push({id:"delete",src:"/bitrix/images/main/file_dialog/delete.gif",name:FD_MESS.FD_DELETE,title:FD_MESS.FD_DELETE_TITLE,handler:function(){if(confirm(b.icon=="folder"?FD_MESS.FD_CONFIRM_DEL_DIR:FD_MESS.FD_CONFIRM_DEL_FILE)){oBXDialogWindow.Remove(d,b.icon=="folder")}}})}oBXDialogWindow.oCM.Show(3500,0,{left:f.realX,top:f.realY},c)}else{if(oBXDialogWindow.oCM){oBXDialogWindow.oCM.menu.PopupHide()}}return BX.PreventDefault(f)},OnKeyDown:function(g){if(oBXDialogWindow.oNameInput!==false){return true}var b=false,c,a,f;switch(g.keyCode){case 37:if(this.view!="detail"){c=this.GetCurIndex(this.curSelectedItem.path);if(this.view=="list"){b=c-12}else{b=c-1}if(b<0){b=0}break}case 38:c=this.GetCurIndex(this.curSelectedItem.path);if(c===false||c<=0){return}if(this.view=="preview"){b=(c>2)?c-3:0}else{b=c-1}break;case 39:if(this.view!="detail"){c=this.GetCurIndex(this.curSelectedItem.path);a=this.arElIndex.length;if(c===false||c==a-1){return}if(this.view=="list"){b=c+12}else{b=c+1}if(b>a-1){b=a-1}break}case 40:c=this.GetCurIndex(this.curSelectedItem.path);a=this.arElIndex.length;if(c===false||c>=a-1){return}if(this.view=="preview"){b=(c<a-4)?c+3:a-1}else{b=c+1}break;case 46:f=this.arElIndex[this.GetCurIndex(this.curSelectedItem.path)];if(f){if(f.permission.del&&confirm(f.icon=="folder"?FD_MESS.FD_CONFIRM_DEL_DIR:FD_MESS.FD_CONFIRM_DEL_FILE)){oBXDialogWindow.Remove(this.curSelectedItem.path,f.icon=="folder")}return BX.PreventDefault(g)}break;case 113:f=this.arElIndex[this.GetCurIndex(this.curSelectedItem.path)];if(f){if(f.permission.ren){oBXDialogWindow.RenameElement(this.curSelectedItem.cont)}return BX.PreventDefault(g)}break;case 13:f=this.arElIndex[this.GetCurIndex(this.curSelectedItem.path)];if(f){f=this.arElIndex[this.GetCurIndex(this.curSelectedItem.path)];if(f.icon=="folder"){oBXDialogTree.SetPath(this.curSelectedItem.path)}else{oBXFileDialog.SubmitFileDialog()}return BX.PreventDefault(g)}}if(b!==false){var h=this.arElIndex[b];var d=false;if(h.icon=="folder"&&oBXFileDialog.bSelectDirs||h.icon!="folder"&&oBXFileDialog.bSelectFiles){d=h.name}this.SelectElement(h._winCont[this.view],h.path,d);return BX.PreventDefault(g)}},GetCurIndex:function(c){for(var b=0,a=this.arElIndex.length;b<a;b++){if(this.arElIndex[b].path==c){return b}}return false}};function BXDialogTabs(){this.Init()}BXDialogTabs.prototype={Init:function(){this.contTable=BX("__bx_tab_cont");this.arTabs={};this.tabsCount=0;this.activeTabName=""},AddTab:function(a,c,d,b){this.arTabs[a]={name:a,title:c,func:d,active:b,disable:false};if(b){if(this.activeTabName!=""&&this.activeTabName!=a){this.arTabs[this.activeTabName].active=false}this.activeTabName=a}this.tabsCount++},DisplayTabs:function(){this.contTable.innerHTML="";if(this.tabsCount<2){return}var g=this;var d=function(n,p,o){var m="background-image: url(/bitrix/images/main/file_dialog/tabs/tab_icons.gif);";n.innerHTML='<img class=" '+o+'" src="/bitrix/images/1.gif" height="27px" width="'+p+'px" style="'+m+'"/>'};var i=function(n,m,r,q,o,p){n.innerHTML="<span style='white-space: nowrap !important; margin: 0 5px;'>"+r+"</span>";n.style.cursor="default";if(o){n.className="fd_tabs_a"}else{if(p){n.className="fd_tabs_pd"}else{n.className="fd_tabs_p"}}if(!p){n.onclick=function(s){g.SetActive(m,!o)}}n.title=q};var h=0,c,j,f,e,b,k=this.contTable.appendChild(document.createElement("TABLE"));k.className="tab-content-table";var a=k.insertRow(-1);for(b in this.arTabs){h++;c=this.arTabs[b];oCell_1=a.insertCell(-1);oCell_1.style.width="0%";oCell_2=a.insertCell(-1);oCell_2.style.width="0%";if(h==1){if(c.active){d(oCell_1,6,"fd_tabs_0a")}else{d(oCell_1,6,"fd_tabs_0p")}i(oCell_2,c.name,c.title,_ReplaceNbspBySpace(c.title),c.active,c.disable)}else{if(this.tabsCount==h){oCell_3=a.insertCell(-1);if(c.active){d(oCell_1,11,"fd_tabs_pa");i(oCell_2,c.name,c.title,_ReplaceNbspBySpace(c.title),c.active,c.disable);d(oCell_3,9,"fd_tabs_a0")}else{d(oCell_1,11,"fd_tabs_ap");i(oCell_2,c.name,c.title,_ReplaceNbspBySpace(c.title),c.active,c.disable);d(oCell_3,9,"fd_tabs_p0")}}}}lastCell=a.insertCell(-1);lastCell.style.width="100%";lastCell.className="fd_tabs_0"},SetActive:function(b,c){var d=this.arTabs[b];if(d.active){return}for(var a in this.arTabs){this.arTabs[a].active=false}d.active=true;if(d.func){d.func()}this.DisplayTabs()},DisableTab:function(c,d){if(!this.arTabs[c]||this.arTabs[c].disable==d){return}var b=false;for(var a in this.arTabs){this.arTabs[a].active=false;if(a==c||b){continue}this.arTabs[a].active=true;this.arTabs[a].func();b=true}this.arTabs[c].disable=d;this.DisplayTabs()}};function BXDialogControls(){var d=this;this.DefaultDirName="New Folder";this.dirPath=new __DirPathBar();this.filePath=new __FilePathBar();this.Preview=new __Preview();this.ViewSelector=new __ViewSelector();this.SortSelector=new __SortSelector();this.Uploader=new __Uploader();this.Filter=new __FileFilter();this.History=new __History();this.currentSite=BXSite;window.fd_view_list.BuildItems();this.fd_view_list_frame=document.body.appendChild(jsUtils.CreateElement("IFRAME",{id:"fd_view_list_frame",src:"javascript:''",className:"bxfd-sys-frame"}));if(window.fd_site_list){window.fd_site_list.BuildItems();this.fd_site_list_frame=document.body.appendChild(jsUtils.CreateElement("IFRAME",{id:"fd_site_list_frame",src:"javascript:''",className:"bxfd-sys-frame"}))}var c=BX("__bx_fd_submit_but");if(oBXFileDialog.oConfig.operation=="O"){c.value=FD_MESS.FD_BUT_OPEN;c.onclick=SubmitFileDialog}else{if(oBXFileDialog.oConfig.operation=="S"){c.value=FD_MESS.FD_BUT_SAVE;c.onclick=SubmitFileDialog;if(oBXFileDialog.oConfig.showAddToMenuTab){var a=BX("__bx_fd_submit_but2");a.value=FD_MESS.FD_BUT_SAVE;a.onclick=SubmitFileDialog}}}if(oBXFileDialog.oConfig.operation=="S"&&oBXFileDialog.oConfig.showAddToMenuTab){BX("__bx_page_title_cont").style.display="block";this.PageTitle1=BX("__bx_page_title1");this.PageTitle2=BX("__bx_page_title2");this.PageTitle1.onchange=function(f){d.PageTitle2.value=this.value};this.PageTitle2.onchange=function(f){d.PageTitle1.value=this.value};this.PageTitle={};this.PageTitle.Get=function(){return d.PageTitle1.value};this.PageTitle.Set=function(e){d.PageTitle1.value=d.PageTitle2.value=e};var b=BX("title");if(b){this.PageTitle.Set(b.value)}else{this.PageTitle.Set("Title")}}this.GoButton=BX("__bx_dir_path_go");this.GoButton.onclick=function(f){oBXDialogTree.SetPath(oBXDialogControls.dirPath.Get(true))};this.UpButton=BX("__bx_dir_path_up");this.UpButton.onclick=function(g){var f=oBXDialogControls.dirPath.Get(true);if(f!="/"){oBXDialogTree.SetPath(f.substr(0,f.lastIndexOf("/")))}};this.RootButton=BX("__bx_dir_path_root");this.RootButton.onclick=function(f){if(oBXDialogControls.dirPath.Get(true)!="/"){oBXDialogTree.SetPath("/")}};this.NewDirButton=BX("__bx_new_dir");this.NewDirButton.onclick=function(f){oBXDialogWindow.AddNewElement()};this.NewDirButtonActive=true;this.NewDirButtonChange=function(){var f=oBXDialogControls.dirPath.Get();if(f==""){f="/"}var e=window.arFDPermission[f];if(e){if(e.new_folder&&!this.NewDirButtonActive){this.NewDirButton.className="fd_iconkit new_dir";this.NewDirButtonActive=true}else{if(!e.new_folder&&this.NewDirButtonActive){this.NewDirButton.className="fd_iconkit new_dir_dis";this.NewDirButtonActive=false}}}}}BXDialogControls.prototype.RefreshOnclick=function(){arFDDirs={};arFDFiles={};arFDPermission={};BXDialogWindow.arFiles={};oBXDialogTree.bRedisplayTree=true;var a=oBXDialogControls.dirPath.Get()||"/";oBXDialogTree.SetPath(a)};BXDialogControls.prototype.SiteSelectorOnChange=function(a){if(this.currentSite!=a){if(!window.bx_fd_site_selector){window.bx_fd_site_selector=BX("__bx_site_selector")}window.bx_fd_site_selector.innerHTML="<span>"+a+'</span><span class="fd_iconkit site_selector_div_arrow">&nbsp;&nbsp;</span>';this.currentSite=a;oBXDialogControls.dirPath.Set("/");this.RefreshOnclick();fd_site_list.SetItemIcon(window.bx_fd_site_selector.getAttribute("bxvalue"),"");fd_site_list.SetItemIcon(a,"checked");window.bx_fd_site_selector.setAttribute("bxvalue",a)}window.fd_site_list.PopupHide()};BXDialogControls.prototype.SiteSelectorOnClick=function(a){var b=jsUtils.GetRealPos(a);b.left+=2;setTimeout(function(){window.fd_site_list.PopupShow(b)},5)};function BXFDSorter(){}BXFDSorter.prototype={name:function(d,c){var e=oBXDialogWindow.oSorter;if((d.icon=="folder"&&c.icon=="folder")||(d.icon!="folder"&&c.icon!="folder")){return e.common_sort(d.name,c.name)}else{if(d.icon=="folder"&&c.icon!="folder"){return(e.order=="des"?1:-1)}else{return(e.order=="des"?-1:1)}}},size:function(d,c){return oBXDialogWindow.oSorter.common_sort(parseInt(d.size),parseInt(c.size))},type:function(d,c){var e=oBXDialogWindow.oSorter;if((d.icon=="folder"&&c.icon=="folder")||(d.ext==c.ext)){return e.common_sort(d.name,c.name)}else{if(d.icon!="folder"&&c.icon!="folder"){return e.common_sort(d.ext,c.ext)}else{if(d.icon=="folder"&&c.icon!="folder"){return(e.order=="des"?1:-1)}else{return(e.order=="des"?-1:1)}}}},date:function(d,c){var g=oBXDialogWindow.oSorter,f=parseInt(d.timestamp),e=parseInt(c.timestamp);if((d.icon=="folder"&&c.icon=="folder")||(d.icon!="folder"&&c.icon!="folder")){return g.common_sort(f,e)}else{if(d.icon=="folder"&&c.icon!="folder"){return(g.order=="des"?1:-1)}else{return(g.order=="des"?-1:1)}}},common_sort:function(d,c){var f=oBXDialogWindow.oSorter,e=1;if(d<c){e=-1}else{if(d==c){e=0}}if(f.order=="des"){e=-e}return e},Sort:function(a){this.order=oBXDialogWindow.sort_order;a.sort(this[oBXDialogWindow.sort||"name"]);return a}};function __DirPathBar(){this.oInput=BX("__bx_dir_path_bar");this.oInput.onclick=function(a){oBXFileDialog.SetFocus("name")};this.value=this.oInput.value;this.butBack=BX("__bx_dir_path_back");this.butForward=BX("__bx_dir_path_forward");this.butBack.onclick=function(b){var a=oBXDialogControls.History.Back();if(a!==false){oBXDialogTree.SetPath(a)}};this.butForward.onclick=function(b){var a=oBXDialogControls.History.Forward();if(a!==false){oBXDialogTree.SetPath(a)}};__DirPathBar.prototype.Set=function(b,a){if(!b||b==""){b="/"}b=b.replace(/\/\//ig,"/");if(this.value!=b){this.oInput.value=this.value=b;this.OnChange(a)}else{this.oInput.value=this.value=b}};__DirPathBar.prototype.Get=function(b){var a=this.oInput.value;a=a.replace(/\\/ig,"/");a=a.replace(/\/\//ig,"/");if(a.substr(a.length-1)=="/"){a=a.substr(0,a.length-1)}if(a==""){a="/"}return a};__DirPathBar.prototype.OnChange=function(b){var a=this.Get();oBXDialogControls.UpButton.className="fd_iconkit "+(a==""?"dir_path_up_dis":"dir_path_up");oBXFileDialog.UserConfig.path=a;oBXDialogControls.History.Push(a)}}function __FilePathBar(){__FilePathBar.prototype.Init=function(){this.oInput=BX("__bx_file_path_bar");if(oBXFileDialog.oConfig.operation=="S"){var a=BX("filename");if(a&&a.value.length>0){this.defaultName=a.value}else{var b=oBXFileDialog.oConfig.fileFilter,c;if(b.length>0){var d=b.indexOf(",");c=(d>0)?b.substr(0,d):b}else{c="php"}this.defaultName="untitled."+c}}this.oInput.onclick=function(){this.focus();oBXFileDialog.SetFocus("name")}};__FilePathBar.prototype.Set=function(a){this.oInput.value=a};__FilePathBar.prototype.Get=function(){return this.oInput.value};this.Init()}function __Preview(){this.Init()}__Preview.prototype={Init:function(){this.oDiv=BX("bxfd_previewContainer");this.addInfoCont=BX("bxfd_addInfoContainer");if(oBXFileDialog.oConfig.select=="D"){this.oDiv.parentNode.style.visibility="hidden"}},Display:function(a){this.Clear();if(!oBXDialogWindow.arFiles[a]){return}if(BXFDIsImage(a)){this.DisplayImage(a)}else{if(getExtension(a)=="swf"){this.DisplayFlash(a)}else{this.DisplayBigIcon(a)}}},DisplayImage:function(a){var b=oBXDialogWindow.arFiles[a],f=this,d;if(oBXFileDialog.oConfig.genThumb&&b.tmb){return f._DisplayImage(b)}var e=BX("__bx_get_real_size_cont");BXFDCleanNode(e);var c=e.appendChild(jsUtils.CreateElement("IMG",{src:a}));c.onload=function(){f._DisplayImage(b,this.offsetWidth||100,this.offsetHeight||100)}},_DisplayImage:function(f,n,g){var c,k,d=f.date.substr(0,f.date.lastIndexOf(":")),e=f.tmb||f.path;this.addInfoCont.innerHTML=getFileSize(f.size)+"  "+d;if(n&&g){var m=100,j=130;c=n+"px";k=g+"px";if(m/j>g/n){if(n>j){c=j+"px";k=Math.round(g*j/n)+"px"}}else{if(g>m){k=m+"px";c=Math.round(n*m/g)+"px"}}e=f.path}var i=this.oDiv.appendChild(jsUtils.CreateElement("IMG",{src:e,align:"middle"}));if(c&&k){i.style.width=c;i.style.height=k}this.oDiv.className=""},DisplayFlash:function(a){var c=oBXDialogWindow.arFiles[a],b=c.date.substr(0,c.date.lastIndexOf(":")),d=this.oDiv.appendChild(jsUtils.CreateElement("IFRAME",{id:"bxfd_ifrm_flash",frameborder:"0"}));this.addInfoCont.innerHTML=getFileSize(c.size)+" "+b;d.setAttribute("src",oBXFileDialog.GetRequestUrl(getSite())+"&action=flash&path="+jsUtils.urlencode(a));this.oDiv.className=""},DisplayBigIcon:function(a){var c=oBXDialogWindow.arFiles[a];if(c.icon=="folder"){return}var b=c.date.substr(0,c.date.lastIndexOf(":")),d=oBXDialogWindow.iconsPath+oBXDialogWindow.arIcons[c.icon].big;this.addInfoCont.innerHTML=getFileSize(c.size)+" "+b;this.oDiv.appendChild(jsUtils.CreateElement("IMG",{src:d},{width:"25px",height:"25px"}));this.oDiv.className="bxfd-prev-big-icon"},Clear:function(){this.oDiv.innerHTML="";this.oDiv.className="";this.addInfoCont.innerHTML=""}};function __ViewSelector(){this.oSel=BX("__bx_view_selector");this.value="";__ViewSelector.prototype.OnClick=function(){var a=jsUtils.GetRealPos(this.oSel);a.left+=7;a.top+=6;setTimeout(function(){window.fd_view_list.PopupShow(a);if(BX("fd_view_list")){BX("fd_view_list").style.zIndex=3510}},5)};__ViewSelector.prototype.OnChange=function(a){oWaitWindow.Show();setTimeout(function(){var b=oBXDialogControls.dirPath.Get(true);oBXDialogWindow.DisplayElementsList(arFDDirs[b],arFDFiles[b],a,oBXDialogWindow.filter,oBXDialogWindow.sort,oBXDialogWindow.sort_order);oWaitWindow.Hide();oBXDialogControls.ViewSelector.Set(a,true)},3)};__ViewSelector.prototype.Set=function(b,c){var a=this.oSel.getAttribute("bxvalue")||"";fd_view_list.SetItemIcon(a,"");fd_view_list.SetItemIcon(b,"checked");this.oSel.setAttribute("bxvalue",b);this.value=b;window.fd_view_list.PopupHide();oBXFileDialog.UserConfig.view=b};__ViewSelector.prototype.Get=function(){return this.value}}function __SortSelector(){var a=this;this.oSel=BX("__bx_sort_selector");this.oCheck=BX("__bx_sort_order");this.oSel.onchange=function(){if(oBXDialogWindow.sort==this.value){return}oWaitWindow.Show();oBXDialogControls.SortSelector.OnChange();oBXDialogWindow.sort=this.value;setTimeout(function(){var b=oBXDialogControls.dirPath.Get(true);oBXDialogWindow.DisplayElementsList(arFDDirs[b],arFDFiles[b],oBXDialogWindow.view,oBXDialogWindow.filter,oBXDialogWindow.sort,oBXDialogWindow.sort_order);oWaitWindow.Hide()},3)};this.oCheck.onclick=function(){var b=(oBXDialogControls.SortSelector.SortOrderGet()=="asc"?"des":"asc");oBXDialogControls.SortSelector.SortOrderSet(b);oBXDialogWindow.sort_order=b;oWaitWindow.Show();oBXDialogControls.SortSelector.OnChange();setTimeout(function(){var c=oBXDialogControls.dirPath.Get(true);oBXDialogWindow.DisplayElementsList(arFDDirs[c],arFDFiles[c],oBXDialogWindow.view,oBXDialogWindow.filter,oBXDialogWindow.sort,oBXDialogWindow.sort_order);oWaitWindow.Hide()},3)};__SortSelector.prototype.Set=function(c,b){this.oSel.value=c;this.SortOrderSet(b);if(window.oBXDialogWindow){oBXDialogWindow.sort=c;oBXDialogWindow.sort_order=b}this.OnChange()};__SortSelector.prototype.Get=function(){return{sort:this.oSel.value,sort_order:this.SortOrderGet()}};__SortSelector.prototype.SortOrderSet=function(b){this.oCheck.setAttribute("__bx_value",b);this.oCheck.className="fd_iconkit "+((b=="asc")?"sort_up":"sort_down")};__SortSelector.prototype.SortOrderGet=function(){return this.oCheck.getAttribute("__bx_value")};__SortSelector.prototype.OnChange=function(){var b=this.Get();oBXFileDialog.UserConfig.sort=b.sort;oBXFileDialog.UserConfig.sort_order=b.sort_order}}function __FileFilter(){__FileFilter.prototype.Init=function(){var b=oBXFileDialog.oConfig.fileFilter;this.curentFilter=false;this.arFilters=[];var g=this;this.oSel=BX("__bx_file_filter");if(!oBXFileDialog.bSelectFiles){this.oSel.style.display="none";return}this.oSel.options.length=0;this.oSel.onchange=function(m){g.curentFilter=oBXDialogWindow.filter=this.value;var i=oBXDialogControls.dirPath.Get(true);oWaitWindow.Show();oBXDialogWindow.DisplayElementsList(arFDDirs[i],arFDFiles[i],oBXDialogWindow.view,oBXDialogWindow.filter,oBXDialogWindow.sort,oBXDialogWindow.sort_order);oWaitWindow.Hide()};var j=function(m,i,e){oOpt=document.createElement("OPTION");oOpt.value=g.arFilters.length;g.arFilters.push(m);oOpt.innerHTML=e+" ("+i+")";g.oSel.appendChild(oOpt);oOpt=null};if(b==""){j("*","*.*",FD_MESS.FD_ALL_FILES);return}this.oSel.style.display="block";var a,c,k,d;if(typeof(b)=="object"){try{for(var f=0;f<b.length;f++){d=b[f];if(typeof(d.ext)=="string"){d.ext=d.ext.split(",")}c="*."+d.ext.join(",*.");j(d.ext,c,d.title)}}catch(h){a=b;c="*."+a.join(",*.");k="";j(a,c,k)}}else{if(b=="image"){a=["jpeg","jpg","gif","png","bmp"];c="*.jpeg,*.jpg,*.gif,*.png,*.bmp";k=FD_MESS.FD_ALL_IMAGES;j(a,c,k)}else{a=b.split(",");c="*."+a.join(",*.");k="";j(a,c,k)}}if(oBXFileDialog.oConfig.allowAllFiles){j("*","*.*",FD_MESS.FD_ALL_FILES)}this.oSel.options[0].selected="selected";this.curentFilter=0};this.Init()}function __Uploader(){this.Init()}__Uploader.prototype={Init:function(){this.oCont=BX("bxfd_upload_container");this.oIfrm=BX("bxfd_iframe_upload");this.oIfrm.src=oBXFileDialog.GetRequestUrl(getSite())+"&action=uploader&lang="+BXLang;var a=this;if(jsUtils.IsIE()){this.oIfrm.onreadystatechange=function(){a.OnLoad()}}else{this.oIfrm.onload=function(){a.OnLoad()}}},OnLoad:function(){var a=this.oIfrm.contentDocument||this.oIfrm.contentWindow.document,c=this,b=a.getElementById("__bx_fd_load_file");if(b){b.onchange=function(){var d=c.oIfrm.contentDocument||c.oIfrm.contentWindow.document;c.pFilename=d.getElementById("__bx_fd_server_file_name");c.pFilename.value=getFileName(this.value.replace(/\\/ig,"/"))}}},OnSubmit:function(){this.pFrameDoc=this.oIfrm.contentDocument||this.oIfrm.contentWindow.document;var d=this.pFrameDoc.getElementById("__bx_fd_server_file_name").value,i=oBXDialogControls.dirPath.Get(),f=oBXDialogWindow.ClientSideCheck(i,d,false,false),b,a=false;if(f!==true){alert(f);return false}try{if(!oBXFileDialog.oConfig.allowAllFiles){a=oBXDialogControls.Filter.arFilters[oBXDialogWindow.filter]}}catch(g){a=false}if(a!==false){if(typeof(a)=="object"&&a.length>0){var j=(d.lastIndexOf(".")!=-1)?d.substr(d.lastIndexOf(".")+1):"";var h=false;for(var c=0;c<a.length;c++){if(a[c]==j){h=true;break}}if(!h){alert(FD_MESS.FD_INCORRECT_EXT);return false}}}for(b in arFDFiles[i]){if(arFDFiles[i][b].name==d){if(!confirm(FD_MESS.FD_LOAD_EXIST_CONFIRM)){return false}this.pFrameDoc.getElementById("__bx_fd_rewrite").value="Y"}}this.pFrameDoc.getElementById("__bx_fd_upload_fname").value=d;this.pFrameDoc.getElementById("__bx_fd_upload_path").value=i;this.pFrameDoc.getElementById("__bx_fd_server_site").value=getSite();oWaitWindow.Show()},OnAfterUpload:function(b,a){oWaitWindow.Hide();oBXDialogControls.filePath.Set(b);if(a){oBXDialogControls.filePath.Set(b);oBXFileDialog.SubmitFileDialog()}else{oBXDialogWindow.LoadFolderContent(window.oBXDialogControls.dirPath.Get(),true)}}};function __History(){__History.prototype.Init=function(){this.arHistoryPath=[];this.currentPos=-1};__History.prototype.Push=function(b){var a=this.arHistoryPath.length;this.currentPos++;if(a==0||(this.arHistoryPath.length>this.currentPos-1&&this.arHistoryPath[this.currentPos-1]!=b)){this.arHistoryPath[this.currentPos]=b;if(a>0){this.ButBackDisable(false)}}else{this.currentPos--}};__History.prototype.RemoveLast=function(){this.arHistoryPath.splice(2,1);this.currentPos--;if(this.currentPos==this.arHistoryPath.length-1){this.ButForwardDisable(true)}};__History.prototype.Back=function(){if(this.currentPos<=0||!this.CheckButBack()){return false}this.currentPos--;var a=this.arHistoryPath[this.currentPos];if(a){if(this.currentPos==0){this.ButBackDisable(true)}this.ButForwardDisable(false);return a}return false};__History.prototype.Forward=function(){var a=this.arHistoryPath.length;if(!this.CheckButForward()||(this.currentPos>a-2)){return false}this.currentPos++;var b=this.arHistoryPath[this.currentPos];if(b){if(this.currentPos==a-1){this.ButForwardDisable(true)}this.ButBackDisable(false);return b}return false};__History.prototype.CheckButBack=function(){return(oBXDialogControls.dirPath.butBack.getAttribute("__bx_disable")!="Y")};__History.prototype.ButBackDisable=function(a){if(a){oBXDialogControls.dirPath.butBack.setAttribute("__bx_disable","Y");oBXDialogControls.dirPath.butBack.className="fd_iconkit path_back_dis"}else{oBXDialogControls.dirPath.butBack.setAttribute("__bx_disable","N");oBXDialogControls.dirPath.butBack.className="fd_iconkit path_back"}};__History.prototype.CheckButForward=function(){return(oBXDialogControls.dirPath.butForward.getAttribute("__bx_disable")!="Y")};__History.prototype.ButForwardDisable=function(a){if(a){oBXDialogControls.dirPath.butForward.setAttribute("__bx_disable","Y");oBXDialogControls.dirPath.butForward.className="fd_iconkit path_forward_dis"}else{oBXDialogControls.dirPath.butForward.setAttribute("__bx_disable","N");oBXDialogControls.dirPath.butForward.className="fd_iconkit path_forward"}};this.Init()}function SubmitFileDialog(){var a=oBXDialogControls.filePath.Get(),i=oBXDialogControls.dirPath.Get(),b=getSite();if(a==""&&!oBXFileDialog.bSelectDirs){return alert(FD_MESS.FD_EMPTY_FILENAME)}if(oBXFileDialog.oConfig.operation=="S"&&!oBXFileDialog.bSelectDirs&&a){var f=a,d="";if(a.indexOf(".")!==-1){f=a.substr(0,a.indexOf("."));d=a.substr(a.indexOf("."))}if(d==""&&oBXDialogControls.Filter){if(oBXDialogControls.Filter.arFilters&&oBXDialogControls.Filter.arFilters.length>0){var c=oBXDialogControls.Filter.arFilters[oBXDialogControls.Filter.curentFilter];if(c!="*"){if(typeof c=="object"){c=c[0]}a=f+"."+c.toLowerCase()}}}}if(oBXFileDialog.oConfig.operation=="O"){window[oBXFileDialog.oConfig.submitFuncName](a,i,b)}else{if(oBXFileDialog.oConfig.operation=="S"){var h,g={type:false};if(oBXFileDialog.oConfig.showAddToMenuTab){h=oBXDialogControls.PageTitle.Get();var e=BX("__bx_fd_add_to_menu");if(e.checked){g={};g.type=BX("__bx_fd_menutype").value;if(BX("__bx_fd_itemtype_n").checked){g.menu_add_new=true;g.menu_add_name=BX("__bx_fd_newp").value;g.menu_add_pos=BX("__bx_fd_newppos").value;if(g.menu_add_name==""){alert(FD_MESS.FD_INPUT_NEW_PUNKT_NAME);return}}else{g.menu_add_new=false;g.menu_add_pos=BX("__bx_fd_menuitem").value}}}window[oBXFileDialog.oConfig.submitFuncName](a,i,b,h,g)}}oBXFileDialog.Close()}function BXFDIsImage(a){return BXFDIsUserExt(a,["gif","jpg","jpeg","png","jpe","bmp"])}function _IsPHP(a){return BXFDIsUserExt(a,["php"])}function BXFDIsUserExt(e,d){var c=getExtension(e),a=d.length,b;for(b=0;b<a;b++){if(d[b]==c){return true}}return false}function _ReplaceSpaceByNbsp(a){if(typeof(a)!="string"){return a}a=a.replace(/\s/g,"&nbsp;");return a}function _ReplaceNbspBySpace(a){if(typeof(a)!="string"){return a}a=a.replace(/&nbsp;/g," ");return a}function _Show_tab_OPEN(){try{BX("__bx_fd_preview_and_panel").style.display="block";BX("__bx_fd_load").style.display="none";BX("__bx_fd_container_add2menu").style.display="none"}catch(a){}}function _Show_tab_LOAD(){try{BX("__bx_fd_preview_and_panel").style.display="none";BX("__bx_fd_load").style.display="block";BX("__bx_fd_container_add2menu").style.display="none"}catch(a){}}function _Show_tab_SAVE(){try{BX("__bx_fd_top_controls_container").style.display="block";BX("__bx_fd_tree_and_window").style.display="block";BX("__bx_fd_preview_and_panel").style.display="block";BX("__bx_fd_load").style.display="none";BX("__bx_fd_container_add2menu").style.display="none"}catch(a){}}function _Show_tab_MENU(){try{if(!oBXMenuHandling.Add2MenuCheckbox.checked){oBXMenuHandling.Add2MenuCheckbox.checked=true;oBXMenuHandling.Add2MenuCheckbox.onclick()}BX("__bx_fd_top_controls_container").style.display="none";BX("__bx_fd_tree_and_window").style.display="none";BX("__bx_fd_preview_and_panel").style.display="none";BX("__bx_fd_load").style.display="none";BX("__bx_fd_container_add2menu").style.display="block";BX("__bx_fd_file_name").innerHTML=oBXDialogControls.filePath.Get()}catch(a){}}function BXMenuHandling(){var b=this;this.Add2MenuCheckbox=BX("__bx_fd_add_to_menu");this.Add2MenuCheckbox.onclick=function(c){oBXMenuHandling.Show(this.checked)};this.MenuTypeSelect=BX("__bx_fd_menutype");this.MenuTypeSelect.onchange=function(){oBXMenuHandling.ChangeMenuType()};this.NewItemOpt=BX("__bx_fd_itemtype_n");this.ExsItemOpt=BX("__bx_fd_itemtype_e");var a=function(){if(b.NewItemOpt.checked){b._displayRow("__bx_fd_e1",true);b._displayRow("__bx_fd_e2",true);b._displayRow("__bx_fd_e3",false)}else{b._displayRow("__bx_fd_e1",false);b._displayRow("__bx_fd_e2",false);b._displayRow("__bx_fd_e3",true)}};this.NewItemOpt.onclick=this.ExsItemOpt.onclick=a;BXMenuHandling.prototype.Show=function(c){if(c){BX("add2menuTable").style.display="block"}else{BX("add2menuTable").style.display="none"}};BXMenuHandling.prototype.ChangeMenuType=function(){var h=oBXDialogControls.dirPath.Get();if(!window.arFDMenuTypes[h]){return}var g=arFDMenuTypes[h].types,e=arFDMenuTypes[h].items,j=this.MenuTypeSelect.value,c;for(c=0;c<g.length;c++){if(j==g[c]){break}}var d=e[c];if(d.length==0){this.NewItemOpt.checked=true;this.ExsItemOpt.disabled="disabled";this._displayRow("__bx_fd_e1",true);this._displayRow("__bx_fd_e2",false);this._displayRow("__bx_fd_e3",false)}else{if(this.NewItemOpt.checked){this.ExsItemOpt.disabled=false;this._displayRow("__bx_fd_e1",true);this._displayRow("__bx_fd_e2",true);this._displayRow("__bx_fd_e3",false)}}var f=BX("__bx_fd_menuitem");f.options.length=0;for(c=0;c<d.length;c++){f.options.add(new Option(d[c],c+1,false,false))}f=BX("__bx_fd_newppos");f.options.length=0;for(c=0;c<d.length;c++){f.options.add(new Option(d[c],c+1,false,false))}f.options.add(new Option(FD_MESS.FD_LAST_POINT,0,true,true))};BXMenuHandling.prototype._displayRow=function(f,c){var g=BX(f);if(c){try{g.style.display="table-row"}catch(d){g.style.display="block"}}else{g.style.display="none"}}}function BXWaitWindow(){}BXWaitWindow.prototype={Show:function(){if(!this.oDiv){var a=BX("BX_file_dialog");if(!a){return}this.oDiv=document.createElement("DIV");this.oDiv.id="__bx_wait_window";this.oDiv.className="waitwindow";this.oDiv.style.position="absolute";this.oDiv.innerHTML=FD_MESS.FD_LOADIND;this.oDiv.style.zIndex="3000";this.oDiv.width="150px";this.oDiv.style.left="320px";this.oDiv.style.top="200px";a.appendChild(this.oDiv)}this.oDiv.style.display="block"},Hide:function(){if(!this.oDiv){this.oDiv=BX("__bx_wait_window")}if(this.oDiv){this.oDiv.style.display="none"}}};function BXFDContextMenu(){this.Init()}BXFDContextMenu.prototype={Init:function(){this.oDiv=document.body.appendChild(jsUtils.CreateElement("DIV",{id:"__BXFDContextMenu"}));this.oDiv.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td class="popupmenu"><table id="__BXFDContextMenu_items" cellpadding="0" cellspacing="0"><tr><td></td></tr></table></td></tr></table>';this.menu=new PopupMenu("__BXFDContextMenu")},Show:function(d,a,b,c){if(!c){return}this.menu.PopupHide();this.AddItems(c);if(!isNaN(d)){this.oDiv.style.zIndex=d}if(!isNaN(a)){this.menu.dxShadow=a}b.right=b.left+this.oDiv.offsetWidth;b.bottom=b.top;this.menu.PopupShow(b)},AddItems:function(c){var f=BX(this.menu.menu_id+"_items");while(f.rows.length>0){f.deleteRow(0)}var g,a,e,b,d,h=c.length;for(e=0;e<h;e++){g=f.insertRow(-1);a=g.insertCell(-1);if(c[e]=="separator"){a.innerHTML='<table cellpadding="0" cellspacing="0" border="0" class="popupseparator"><tr><td><div class="empty"></div></td></tr></table>'}else{b=c[e];a.innerHTML='<table cellpadding="0" cellspacing="0" class="popupitem" onMouseOver="this.className=\'popupitem popupitemover\';" onMouseOut="this.className=\'popupitem\';" __bx_i="'+e+'">\n	<tr>\n		<td class="gutter"><div style="background-image:url('+b.src+')"></div></td>\n		<td class="item" title="'+((b.title)?b.title:b.name)+'">'+b.name+"</td>\n	</tr>\n</table>";d=a.firstChild;d.onclick=function(i){c[this.getAttribute("__bx_i")].handler();oBXDialogWindow.oCM.menu.PopupHide()};d.id=null}}this.oDiv.style.width=f.parentNode.offsetWidth}};function BXFDCleanNode(a){var b;while(b=a.lastChild){a.removeChild(b)}}function BXFDCompareObj(c,b){for(var a in c){if(c[a]!=b[a]){return false}}return true}function BXFDCopyObj(c){var a={},b;for(b in c){a[b]=c[b]}return a}function getFileName(a){a=a.replace(/\\/ig,"/");return a.substr(a.lastIndexOf("/")+1)}function getExtension(b){var a=b.lastIndexOf(".");if(a>0){return a>0?b.substr(a+1).toLowerCase():""}}function getFileSize(a){if(a<1024){return a+" "+FD_MESS.FD_BYTE}a=Math.round(a/1024);if(a<1024){return a+" K"+FD_MESS.FD_BYTE}a=Math.round(a/1024);if(a<1024){return a+" M"+FD_MESS.FD_BYTE}}function getSite(){if(window.oBXDialogControls&&window.oBXDialogControls.currentSite){return window.oBXDialogControls.currentSite}return BXSite};