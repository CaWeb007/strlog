BX.namespace("BX.Admin.DraggableTab");BX.Admin.DraggableTab=(function(){var a=function(e){if(typeof e!=="object"){return}this.moduleId=e.moduleId;this.tabId=e.tabId;this.optionName=e.optionName;this.hidden=e.hidden;this.dragObjects=BX(this.tabId).querySelectorAll('[data-role="dragObj"]');if(typeof this.dragObjects!=="object"){return}BX.loadScript("/bitrix/js/main/dd.js");for(var d=0;d<this.dragObjects.length;d++){if(!this.dragObjects[d].hasAttribute("data-onlydest")){var c=BX.findChild(this.dragObjects[d],{className:"draggable"},true,false);c.onbxdragstart=BX.proxy(this.sectionDragStart,this);c.onbxdrag=BX.proxy(this.sectionDragMove,this);c.onbxdragstop=BX.proxy(this.sectionDragStop,this);c.onbxdraghover=BX.proxy(this.sectionDragHover,this);jsDD.registerObject(c);var b=this.dragObjects[d].querySelector('[data-role="toggleObj"]');BX.bind(b,"click",BX.proxy(function(){this.self.toggleHandler(this.dragObj)},{self:this,dragObj:this.dragObjects[d]}))}jsDD.registerDest(this.dragObjects[d],200)}};a.prototype.sectionDragStart=function(){var b=BX.proxy_context.parentNode.parentNode.parentNode;this.bxSectParent=b.parentNode;this.bxSectParentHeight=b.parentNode.offsetHeight;this.bxSectParent.style.height=this.bxSectParentHeight+"px";this.objSectHeight=b.offsetHeight;var d=getComputedStyle(b);var c=d.marginTop;c=c.replace("px","");var e=d.marginBottom;e=e.replace("px","");this.objSectMarginHeight=Number(this.objSectHeight)+Number(c)+Number(e);this.bxSectBlank=this.bxSectParent.insertBefore(BX.create("DIV",{style:{height:"0px"}}),b);this.bxSectBlank1=BX.create("DIV",{style:{height:this.objSectMarginHeight+"px"}});jsDD.disableDest(this.bxSectParent);this.bxSectBlock=BX.create("DIV",{style:{position:"absolute",zIndex:"100",height:this.objSectHeight+"px",width:b.offsetWidth+"px"},children:[b]});this.bxSectPos=BX.pos(this.bxSectParent);this.bxSectParent.appendChild(this.bxSectBlock)};a.prototype.sectionDragMove=function(b,c){c-=this.bxSectPos.top;if(c<0){c=0}if(c>this.bxSectParentHeight-this.objSectHeight){c=this.bxSectParentHeight-this.objSectHeight}this.bxSectBlock.style.top=c+"px"};a.prototype.sectionDragHover=function(d,b,e){var c=BX.proxy_context.parentNode.parentNode.parentNode;if(d==c){this.bxSectParent.insertBefore(this.bxSectBlank1,this.bxSectBlank)}else{if(d.parentNode==this.bxSectParent){if(d.nextSibling){this.bxSectParent.insertBefore(this.bxSectBlank1,d.nextSibling)}else{this.bxSectParent.appendChild(this.bxSectBlank1)}}}};a.prototype.sectionDragStop=function(){var b=BX.proxy_context.parentNode.parentNode.parentNode;if(this.bxSectBlank1&&this.bxSectBlank1.parentNode==this.bxSectParent){this.bxSectParent.replaceChild(b,this.bxSectBlank1)}else{this.bxSectParent.replaceChild(b,this.bxSectBlank)}this.bxSectParent.style.height="";BX.remove(this.bxSectBlock);BX.remove(this.bxSectBlank);BX.remove(this.bxSectBlank1);jsDD.enableDest(b);var c=this.bxSectParent.querySelectorAll('[data-role="dragObj"]');var e=[];for(var d=0;d<c.length;d++){if(!c[d].hasAttribute("data-onlydest")){if(c[d].hasAttribute("data-id")){e.push(c[d].getAttribute("data-id"))}}}this.dragHandler(e);this.bxSectBlock=null;this.bxSectBlank=null;this.bxSectBlank1=null;this.bxSectParent=null;this.objSectHeight=0;jsDD.refreshDestArea()};a.prototype.dragHandler=function(b){BX.userOptions.save(this.moduleId,this.optionName,"order",b)};a.prototype.toggleHandler=function(e){var b=e.getAttribute("data-id");var f=[];if(BX.hasClass(e,"hidden")){BX.removeClass(e,"hidden");for(var c in this.hidden){if(this.hidden[c]!=b){f.push(this.hidden[c])}else{delete this.hidden[c]}}}else{BX.addClass(e,"hidden");var d=false;for(var c in this.hidden){if(this.hidden[c]==b){d=true;break}}if(!d){this.hidden.push(b)}f=this.hidden}BX.userOptions.save(this.moduleId,this.optionName,"hidden",f)};return a})();