function encodeContentForLCA(q){_$arComponents={};_$compLength=0;var f=[];var m=0,s,l,u,j,y,e,o,t=0,h=0;while((m=q.indexOf("<?",m))>=0){t=0;s=m+2;l=false;u=false;while(s<q.length-1){s++;j=q.substr(s,1);if(!u){if(j=="/"&&s+1<q.length){y=q.indexOf("?>",s);if(y==-1){m=q.length;break}y+=2;e=0;if(q.substr(s+1,1)=="*"&&(e=q.indexOf("*/",s+2))>=0){e+=2}else{if(q.substr(s+1,1)=="/"&&(e=q.indexOf("\n",s+2))>=0){e+=1}}if(e>0){if(e>y&&q.substr(s+1,1)!="*"){f.push([m,y,q.substr(m,y-m)]);m=y;break}else{s=e-1}}continue}if(j=="?"&&s+1<q.length&&q.substr(s+1,1)==">"){s=s+2;f.push([m,s,q.substr(m,s-m)]);m=s+1;break}}if(u&&j=="\\"){l=true;continue}if(j=='"'||j=="'"){if(u){if(!l&&o==j){u=false}}else{u=true;o=j}}l=false}if(s>=q.length){break}m=s}if(f.length>0){var d="";var k=0,a=[],c,x,v,b,r;var n="<?$APPLICATION->INCLUDECOMPONENT";var g=n.length;for(s=0;s<f.length;s++){v=f[s];r=false;if(v[2].substr(0,g).toUpperCase()==n){var w=str_pad_left(++_$compLength,4,"0");_$arComponents[w]=v[2];d+=q.substr(k,v[0]-k)+"#COMPONENT"+String(w)+"#"}else{d+=q.substr(k,v[0]-k)+v[2]}k=v[1]}q=d+q.substr(k)}return q}function decodeContentFromLCA(b){var a=function(e,d){var c=_$arComponents[d];if(!c){return""}return c};b=b.replace(/#COMPONENT(\d{4})#/ig,a);return b}function str_pad_left(b,g,d){b=String(b);if(d.length>0){var a="";var e=0;g=parseInt(g);for(var c=0,f=g-b.length;c<f;c++){a+=d}b=a+b}return b}function preview_template(b,d,c){if(window.GLOBAL_pMainObj){var a=GLOBAL_pMainObj.CONTENT;if(a){a.SaveContent()}}var e=BX("bxed_CONTENT").value;if(e.indexOf("#WORK_AREA#")==-1){alert(messErrorWA);return}BX.showWait();BX.ajax.post("/bitrix/admin/template_create_preview.php?ID="+b,{CONTENT:decodeContentFromLCA(e),STYLES:BX("__STYLES").value,TEMPLATE_STYLES:BX("__TEMPLATE_STYLES").value,sessid:d},function(){BX.closeWait();setTimeout(function(){if(window.__status){window.open("/?bitrix_preview_site_template="+c+"&bx_template_preview_mode=Y")}else{if(window.strWarning){alert(window.strWarning)}}},10)})};