(function(){BX.namespace("BX.SidePanel");var a=null;Object.defineProperty(BX.SidePanel,"Instance",{enumerable:false,get:function(){if(window.top!==window){return window.top.BX.SidePanel.Instance}if(a===null){a=new BX.SidePanel.Manager({})}return a}});BX.SidePanel.Manager=function(c){this.anchorRules=[];this.anchorHandler=null;this.openSliders=[];this.lastOpenSlider=null;this.opened=false;this.hidden=false;this.hacksApplied=false;this.pageUrl=this.getCurrentUrl();this.handleDocumentKeyDown=this.handleDocumentKeyDown.bind(this);this.handleWindowResize=BX.throttle(this.handleWindowResize,300,this);this.handleWindowScroll=this.handleWindowScroll.bind(this);this.handleTouchMove=this.handleTouchMove.bind(this);this.handleSliderOpen=this.handleSliderOpen.bind(this);this.handleSliderOpenComplete=this.handleSliderOpenComplete.bind(this);this.handleSliderClose=this.handleSliderClose.bind(this);this.handleSliderCloseComplete=this.handleSliderCloseComplete.bind(this);this.handleSliderLoad=this.handleSliderLoad.bind(this);this.handleSliderDestroy=this.handleSliderDestroy.bind(this);BX.addCustomEvent("SidePanel:open",this.open.bind(this));BX.addCustomEvent("SidePanel:close",this.close.bind(this));BX.addCustomEvent("SidePanel:closeAll",this.closeAll.bind(this));BX.addCustomEvent("SidePanel:destroy",this.destroy.bind(this));BX.addCustomEvent("SidePanel:hide",this.hide.bind(this));BX.addCustomEvent("SidePanel:unhide",this.unhide.bind(this));BX.addCustomEvent("SidePanel:postMessage",this.postMessage.bind(this));BX.addCustomEvent("SidePanel:postMessageAll",this.postMessageAll.bind(this));BX.addCustomEvent("SidePanel:postMessageTop",this.postMessageTop.bind(this));BX.addCustomEvent("BX.Bitrix24.PageSlider:close",this.close.bind(this));BX.addCustomEvent("Bitrix24.Slider:postMessage",this.handlePostMessageCompatible.bind(this))};var b=null;BX.SidePanel.Manager.registerSliderClass=function(c){if(BX.type.isNotEmptyString(c)){b=c}};BX.SidePanel.Manager.getSliderClass=function(){var c=b!==null?BX.getClass(b):null;return c!==null?c:BX.SidePanel.Slider};BX.SidePanel.Manager.prototype={open:function(e,d){if(!BX.type.isNotEmptyString(e)){return false}e=this.refineUrl(e);if(this.isHidden()){this.unhide()}var c=this.getTopSlider();if(c){if(c.isOpen()&&c.getUrl()===e){return false}}var f=null;if(this.getLastOpenSlider()&&this.getLastOpenSlider().getUrl()===e){f=this.getLastOpenSlider()}else{var g=BX.SidePanel.Manager.getSliderClass();f=new g(e,d);var j=c?c.getZindex()+1:f.getZindex();var i=c?Math.min(c.getOffset()+this.getMinOffset(),this.getMaxOffset()):0;f.setZindex(j);f.setOffset(i);BX.addCustomEvent(f,"SidePanel.Slider:onOpen",this.handleSliderOpen);BX.addCustomEvent(f,"SidePanel.Slider:onBeforeOpenComplete",this.handleSliderOpenComplete);BX.addCustomEvent(f,"SidePanel.Slider:onClose",this.handleSliderClose);BX.addCustomEvent(f,"SidePanel.Slider:onBeforeCloseComplete",this.handleSliderCloseComplete);BX.addCustomEvent(f,"SidePanel.Slider:onLoad",this.handleSliderLoad);BX.addCustomEvent(f,"SidePanel.Slider:onDestroy",this.handleSliderDestroy)}if(!this.isOpen()){this.applyHacks(f)}var h=f.open();if(!h){this.resetHacks(f)}return h},isOpen:function(){return this.opened},close:function(d,e){var c=this.getTopSlider();if(c){c.close(d,e)}},closeAll:function(c){var g=this.getOpenSliders();for(var d=g.length-1;d>=0;d--){var e=g[d];var f=e.close(c);if(!f){break}}},hide:function(){if(this.hidden){return false}var c=this.getTopSlider();this.getOpenSliders().forEach(function(d){d.hide()});this.hidden=true;this.resetHacks(c);return true},unhide:function(){if(!this.hidden){return false}this.getOpenSliders().forEach(function(c){c.unhide()});this.hidden=false;setTimeout(function(){this.applyHacks(this.getTopSlider())}.bind(this),0);return true},isHidden:function(){return this.hidden},destroy:function(c){if(!BX.type.isNotEmptyString(c)){return}c=this.refineUrl(c);var f=this.getSlider(c);if(this.getLastOpenSlider()&&(f||this.getLastOpenSlider().getUrl()===c)){this.getLastOpenSlider().destroy()}if(f!==null){var g=this.getOpenSliders();for(var d=g.length-1;d>=0;d--){var e=g[d];e.destroy();if(e===f){break}}}},getTopSlider:function(){var c=this.openSliders.length;return this.openSliders[c-1]?this.openSliders[c-1]:null},getPreviousSlider:function(f){var c=null;var g=this.getOpenSliders();f=f||this.getTopSlider();for(var d=g.length-1;d>=0;d--){var e=g[d];if(e===f){c=g[d-1]?g[d-1]:null;break}}return c},getSlider:function(c){c=this.refineUrl(c);var f=this.getOpenSliders();for(var d=0;d<f.length;d++){var e=f[d];if(e.getUrl()===c){return e}}return null},getSliderByWindow:function(e){var f=this.getOpenSliders();for(var c=0;c<f.length;c++){var d=f[c];if(d.getFrameWindow()===e){return d}}return null},getOpenSliders:function(){return this.openSliders},getOpenSlidersCount:function(){return this.openSliders.length},addOpenSlider:function(c){if(!(c instanceof BX.SidePanel.Slider)){throw new Error("Slider is not an instance of BX.SidePanel.Slider")}this.openSliders.push(c)},removeOpenSlider:function(e){var f=this.getOpenSliders();for(var c=0;c<f.length;c++){var d=f[c];if(d===e){this.openSliders.splice(c,1);return true}}return false},getLastOpenSlider:function(){return this.lastOpenSlider},setLastOpenSlider:function(c){if(this.lastOpenSlider!==c){if(this.lastOpenSlider){this.lastOpenSlider.destroy()}this.lastOpenSlider=c}},resetLastOpenSlider:function(){if(this.lastOpenSlider&&this.getTopSlider()!==this.lastOpenSlider){this.lastOpenSlider.destroy()}this.lastOpenSlider=null},adjustLayout:function(){this.getOpenSliders().forEach(function(c){c.adjustLayout()})},refineUrl:function(c){return BX.util.remove_url_param(c,["IFRAME","IFRAME_TYPE"])},getPageUrl:function(){return this.pageUrl},getCurrentUrl:function(){return window.location.pathname+window.location.search+window.location.hash},postMessage:function(d,e,h){var j=this.getSliderFromSource(d);if(!j){return}var l=null;var c=this.getOpenSliders();for(var k=c.length-1;k>=0;k--){var g=c[k];if(g===j){l=c[k-1]?c[k-1]:null;break}}var m=l&&l.getWindow()||window;m.BX.onCustomEvent("Bitrix24.Slider:onMessage",[g,h]);var f=new BX.SidePanel.MessageEvent({sender:j,slider:l?l:null,data:h,eventId:e});if(l){l.firePageEvent(f);l.fireFrameEvent(f)}else{BX.onCustomEvent(window,f.getFullName(),[f])}},postMessageAll:function(j,e,h){var d=this.getSliderFromSource(j);if(!d){return}var g=null;var k=this.getOpenSliders();for(var c=k.length-1;c>=0;c--){var f=k[c];if(f===d){continue}g=new BX.SidePanel.MessageEvent({sender:d,slider:f,data:h,eventId:e});f.firePageEvent(g);f.fireFrameEvent(g)}g=new BX.SidePanel.MessageEvent({sender:d,slider:null,data:h,eventId:e});BX.onCustomEvent(window,g.getFullName(),[g])},postMessageTop:function(g,d,f){var c=this.getSliderFromSource(g);if(!c){return}var e=new BX.SidePanel.MessageEvent({sender:c,slider:null,data:f,eventId:d});BX.onCustomEvent(window,e.getFullName(),[e])},getMinOffset:function(){return 63},getMaxOffset:function(){return this.getMinOffset()*3},bindAnchors:function(c){c=c||{};if(BX.type.isArray(c.rules)){this.anchorRules=this.anchorRules.concat(c.rules)}if(!this.anchorHandler){this.anchorHandler=this.handleAnchorClick.bind(this);window.document.addEventListener("click",this.anchorHandler,true)}},handleSliderOpen:function(d){if(!d.isActionAllowed()){return}var c=d.getSlider();if(this.getTopSlider()){this.getTopSlider().hideOverlay();this.getTopSlider().hideCloseBtn();this.getTopSlider().hidePrintBtn()}else{c.setOverlayAnimation(true)}this.addOpenSlider(c);this.losePageFocus();if(!this.opened){this.pageUrl=this.getCurrentUrl()}this.opened=true;this.resetLastOpenSlider()},handleSliderOpenComplete:function(c){this.setBrowserHistory(c.getSlider())},handleSliderClose:function(e){var d=this.getPreviousSlider();var c=this.getTopSlider();if(d){d.unhideOverlay();c&&c.hideOverlay()}},handleSliderCloseComplete:function(d){var c=d.getSlider();if(c===this.getTopSlider()){this.setLastOpenSlider(c)}this.cleanUpClosedSlider(c)},handleSliderDestroy:function(d){var c=d.getSlider();BX.removeCustomEvent(c,"SidePanel.Slider:onOpen",this.handleSliderOpen);BX.removeCustomEvent(c,"SidePanel.Slider:onBeforeOpenComplete",this.handleSliderOpenComplete);BX.removeCustomEvent(c,"SidePanel.Slider:onBeforeCloseComplete",this.handleSliderCloseComplete);BX.removeCustomEvent(c,"SidePanel.Slider:onLoad",this.handleSliderLoad);BX.removeCustomEvent(c,"SidePanel.Slider:onDestroy",this.handleSliderDestroy);if(c===this.getLastOpenSlider()){this.lastOpenSlider=null}this.cleanUpClosedSlider(c)},cleanUpClosedSlider:function(c){this.removeOpenSlider(c);c.unhideOverlay();if(this.getTopSlider()){this.getTopSlider().showCloseBtn();if(this.getTopSlider().isPrintable()){this.getTopSlider().showPrintBtn()}this.getTopSlider().focus()}else{window.focus()}if(!this.getOpenSlidersCount()){this.resetHacks(c);this.opened=false}this.resetBrowserHistory()},handleSliderLoad:function(c){var d=c.getSlider().getFrameWindow();if(d){d.document.addEventListener("click",this.handleAnchorClick.bind(this),true)}this.setBrowserHistory(c.getSlider())},handlePostMessageCompatible:function(d,c){this.postMessage(d,"",c)},getSliderFromSource:function(c){if(c instanceof BX.SidePanel.Slider){return c}else{if(BX.type.isNotEmptyString(c)){return this.getSlider(c)}else{if(c!==null&&c===c.window&&window!==c){return this.getSliderByWindow(c)}}}return null},applyHacks:function(c){if(this.hacksApplied){return false}c&&c.applyHacks();this.disablePageScrollbar();this.bindEvents();c&&c.applyPostHacks();this.hacksApplied=true;return true},resetHacks:function(c){if(!this.hacksApplied){return false}c&&c.resetPostHacks();this.enablePageScrollbar();this.unbindEvents();c&&c.resetHacks();this.hacksApplied=false;return true},bindEvents:function(){BX.bind(document,"keydown",this.handleDocumentKeyDown);BX.bind(window,"resize",this.handleWindowResize);BX.bind(window,"scroll",this.handleWindowScroll);if(BX.browser.IsMobile()){BX.bind(document.body,"touchmove",this.handleTouchMove)}},unbindEvents:function(){BX.unbind(document,"keydown",this.handleDocumentKeyDown);BX.unbind(window,"resize",this.handleWindowResize);BX.unbind(window,"scroll",this.handleWindowScroll);if(BX.browser.IsMobile()){BX.unbind(document.body,"touchmove",this.handleTouchMove)}},disablePageScrollbar:function(){var c=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight=c+"px";BX.addClass(document.body,"side-panel-disable-scrollbar")},enablePageScrollbar:function(){document.body.style.removeProperty("padding-right");BX.removeClass(document.body,"side-panel-disable-scrollbar")},losePageFocus:function(){if(BX.type.isDomNode(document.activeElement)){document.activeElement.blur()}},handleDocumentKeyDown:function(c){if(c.keyCode!==27){return}c.preventDefault();if(this.isOnTop()&&this.getTopSlider()){if(this.getTopSlider().canCloseByEsc()){this.getTopSlider().close()}}},handleWindowResize:function(){this.adjustLayout()},handleWindowScroll:function(){this.adjustLayout()},handleTouchMove:function(c){c.preventDefault()},isOnTop:function(){var e=document.documentElement.clientWidth/2;var d=document.documentElement.clientHeight/2;var c=document.elementFromPoint(e,d);return BX.hasClass(c,"side-panel")||BX.findParent(c,{className:"side-panel"})!==null},extractLinkFromEvent:function(e){e=e||window.event;var f=e.target;if(e.which!==1||!BX.type.isDomNode(f)||e.ctrlKey||e.metaKey){return null}var c=f;if(f.nodeName!=="A"){c=BX.findParent(f,{tag:"A"},1)}if(!BX.type.isDomNode(c)){return null}var d=c.getAttribute("href");if(d){return{url:d,anchor:c,target:c.getAttribute("target")}}return null},handleAnchorClick:function(e){var d=this.extractLinkFromEvent(e);if(!d||BX.data(d.anchor,"slider-ignore-autobinding")){return}var f=this.getUrlRule(d.url,d);if(!f){return}if(f.allowCrossDomain!==true&&BX.ajax.isCrossDomain(d.url)){return}if(f.mobileFriendly!==true&&BX.browser.IsMobile()){return}var g=BX.type.isFunction(f.validate)?f.validate(d):this.isValidLink(d);if(!g){return}if(BX.type.isFunction(f.handler)){f.handler(e,d)}else{e.preventDefault();var c=BX.type.isPlainObject(f.options)?f.options:{};if(!BX.type.isNotEmptyString(c.loader)&&BX.type.isNotEmptyString(f.loader)){c.loader=f.loader}this.open(d.url,c)}},getUrlRule:function(e,f){if(!BX.type.isNotEmptyString(e)){return null}for(var d=0;d<this.anchorRules.length;d++){var h=this.anchorRules[d];if(!BX.type.isArray(h.condition)){continue}for(var c=0;c<h.condition.length;c++){if(BX.type.isString(h.condition[c])){h.condition[c]=new RegExp(h.condition[c],"i")}var g=e.match(h.condition[c]);if(g&&!this.hasStopParams(e,h.stopParameters)){if(f){f.matches=g}return h}}}return null},isValidLink:function(c){return true},setBrowserHistory:function(c){if(!(c instanceof BX.SidePanel.Slider)){return}if(c.canChangeHistory()&&c.isOpen()&&c.isLoaded()){window.history.replaceState({},"",c.getUrl())}},resetBrowserHistory:function(){var c=null;var g=this.getOpenSliders();for(var e=g.length-1;e>=0;e--){var f=g[e];if(f.canChangeHistory()&&f.isOpen()&&f.isLoaded()){c=f;break}}var d=c?c.getUrl():this.getPageUrl();if(d){window.history.replaceState({},"",d)}},hasStopParams:function(d,h){if(!h||!BX.type.isArray(h)||!BX.type.isNotEmptyString(d)){return false}var c=d.indexOf("?");if(c===-1){return false}var f=d.substring(c);for(var e=0;e<h.length;e++){var g=h[e];if(f.match(new RegExp("[?&]"+g+"=","i"))){return true}}return false},getLastOpenPage:function(){return this.getLastOpenSlider()},getCurrentPage:function(){return this.getTopSlider()}}})();