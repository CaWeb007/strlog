(function(){BX.namespace("BX.ColorPicker");BX.ColorPicker=function(a){a=BX.type.isPlainObject(a)?a:{};this.popupWindow=null;this.popupOptions={angle:true,autoHide:true,closeByEsc:true,noAllPaddings:true};this.layout={preview:null,customColor:null,defaultColor:null,actions:null,customColorInput:null,customColorTextBox:null};if(BX.type.isPlainObject(a.popupOptions)){BX.mergeEx(this.popupOptions,a.popupOptions)}this.bindElement=null;this.colors=[];this.selectedColor=null;this.defaultColor=null;this.allowCustomColor=true;this.colorPreview=true;this.onColorSelected=null;this.setOptions(a)};BX.ColorPicker.prototype={open:function(b){this.setOptions(b);var a=this.getPopupWindow();a.setContent(this.getPopupContent());this.getPopupWindow().show()},close:function(){this.getPopupWindow().close()},setOptions:function(a){if(!BX.type.isPlainObject(a)){return}if(BX.type.isArray(a.colors)){this.setColors(a.colors)}if("bindElement" in a){this.bindElement=a.bindElement;this.getPopupWindow().setBindElement(this.bindElement)}if(BX.type.isFunction(a.onColorSelected)){this.onColorSelected=a.onColorSelected}this.setSelectedColor(a.selectedColor);this.setDefaultColor(a.defaultColor);if(BX.type.isBoolean(a.allowCustomColor)){this.allowCustomColor=a.allowCustomColor}if(BX.type.isBoolean(a.colorPreview)){this.colorPreview=a.colorPreview}},getPopupWindow:function(){if(this.popupWindow){return this.popupWindow}var a="main-color-picker-"+BX.util.getRandomString(5);this.popupWindow=new BX.PopupWindow(a,this.bindElement,this.popupOptions);return this.popupWindow},setColors:function(a){if(!BX.type.isArray(a)){return}this.colors=[];a.forEach(function(b){if(!BX.type.isArray(b)){return}var c=[];b.forEach(function(d){d=this.getFullColorCode(d);if(d!==null){c.push(d)}},this);if(c.length){this.colors.push(c)}},this)},getColors:function(){return this.colors.length?this.colors:this.getDefaultColors()},getDefaultColors:function(){return[["#aae9fc","#bbecf1","#98e1dc","#e3f299","#ffee95","#ffdd93","#dfd3b6","#e3c6bb","#ffad97","#ffbdbb","#ffcbd8","#ffc4e4","#c4baed","#dbdde0","#bfc5cd","#a2a8b0"],["#ffffff","#2eceff","#10e5fc","#a5de00","#eec200","#ffa801","#ad8f47","#b57051","#ff5b55","#ef3000","#f968b6","#6b52cc","#06bab1","#5cd1df","#a1a6ac","#949da9"],["#ffb79f","#ffbf99","#f3e27c","#e7d35d","#00ff00","#00a64c","#48dfdf","#b02fb0","#ff00ff","#ef008b","#0000ff","#ebebeb","#acacac","#898989","#555555","#000000"],["#f89675","#fdad7e","#fec788","#fff893","#c5e099","#a3d49b","#8ed1a8","#7ecb9c","#78cdca","#67cef9","#7aa5da","#887fc0","#a284bf","#bd8bc0","#f69ac1","#f6989c"],["#f26b47","#f78d4d","#fdb051","#fff55a","#abd46c","#7bc56f","#00bbb4","#00bef6","#00bdb5","#3fb2cd","#3f8bcd","#5471b9","#865daa","#a861ab","#f16ca8","#f26b7b"],["#f11716","#f36509","#f99500","#fff300","#8ec82f","#2fb644","#00a74c","#00a99d","#00adf2","#0070bf","#0052a7","#2e2d93","#662793","#922091","#f0008c","#f10057"],["#9e0502","#a34100","#a46200","#aba100","#578520","#107c2c","#007333","#00736a","#0075a6","#004982","#003172","#1c0d64","#460663","#630060","#a0005c","#9f0037"]]},getPopupContent:function(){var b=BX.create("div",{props:{className:"main-color-picker-container"},events:{click:this.handleContainerClick.bind(this)}});var a=BX.create("div",{props:{className:"main-color-picker-palette"},events:{click:this.handleBoxClick.bind(this),mouseover:this.isPreviewVisible()?this.handleBoxOver.bind(this):null}});this.getColors().forEach(function(d){var e=BX.create("div",{props:{className:"main-color-picker-row"}});a.appendChild(e);d.forEach(function(f){if(!BX.type.isNotEmptyString(f)){return}f=f.toLowerCase();var g=BX.create("div",{attrs:{className:"main-color-picker-box","data-color":f},style:{backgroundColor:f}});if(this.getSelectedColor()===f){g.classList.add("main-color-picker-box-selected")}if(f==="#ffffff"){g.classList.add("main-color-picker-box-white")}e.appendChild(g)},this)},this);b.appendChild(a);var c=this.getActions();if(c){b.appendChild(c)}return b},getActions:function(){this.layout.customColor=null;this.layout.defaultColor=null;this.layout.preview=null;this.layout.actions=null;if(!this.isPreviewVisible()){return null}var a=!this.isCustomColorAllowed()||this.getDefaultColor()===null;this.layout.actions=BX.create("div",{props:{className:"main-color-picker-actions"+(a?" main-color-picker-single-action":"")},children:[this.layout.preview=BX.create("div",{props:{className:"main-color-picker-preview"}})]});if(this.isCustomColorAllowed()){this.layout.customColor=BX.create("div",{props:{className:"main-color-picker-custom"},children:[BX.create("span",{props:{className:"main-color-picker-custom-action"},text:BX.message("MAIN_COLORPICKER_SPECIFY_HEX_COLOR"),events:{click:this.handleCustomColorClick.bind(this)}}),BX.create("span",{props:{className:"main-color-picker-custom-form"},children:[BX.create("span",{props:{className:"main-color-picker-custom-label"},text:BX.message("MAIN_COLORPICKER_HEX_COLOR")+":"}),this.layout.customColorTextBox=BX.create("span",{props:{className:"main-color-picker-custom-textbox"},children:[this.layout.customColorInput=BX.create("input",{props:{className:"main-color-picker-custom-input"},attrs:{maxlength:6},events:{keypress:this.handleCustomInputKeyPress.bind(this),keyup:this.handleCustomInputKeyUp.bind(this),paste:this.handleCustomInputPaste.bind(this)}})]}),BX.create("span",{props:{className:"main-color-picker-custom-button"},events:{click:this.applyEditMode.bind(this)}})]})]});this.layout.actions.appendChild(this.layout.customColor)}if(this.getDefaultColor()!==null){this.layout.defaultColor=BX.create("div",{props:{className:"main-color-picker-default"},children:[BX.create("span",{props:{className:"main-color-picker-default-action"},text:BX.message("MAIN_COLORPICKER_BY_DEFAULT"),events:{click:this.handleDefaultActionClick.bind(this)}})]});this.layout.actions.appendChild(this.layout.defaultColor)}return this.layout.actions},isCustomColorAllowed:function(){return this.allowCustomColor},isPreviewVisible:function(){return this.colorPreview||this.getDefaultColor()!==null||this.isCustomColorAllowed()},getSelectedColor:function(){return this.selectedColor},setSelectedColor:function(a){if(this.isValidColor(a)){this.selectedColor=this.getFullColorCode(a.toLowerCase())}else{if(a===null){this.selectedColor=null}}},getDefaultColor:function(){return this.defaultColor},setDefaultColor:function(a){if(this.isValidColor(a)){this.defaultColor=this.getFullColorCode(a.toLowerCase())}else{if(a===null){this.defaultColor=null}}},handleContainerClick:function(b){if(this.isEditMode()&&b.target!==this.layout.customColorInput){var a=BX.util.trim(this.layout.customColorInput.value);if(!a.length){this.resetEditMode();this.resetError()}}},handleCustomColorClick:function(a){this.switchToEditMode();a.stopPropagation()},handleBoxClick:function(b){var c=b.target;if(!BX.type.isDomNode(c)||!c.dataset.color){return}var a=c.dataset.color;c.classList.add("main-color-picker-box-selected");this.applyColor(a)},applyColor:function(a){if(this.isValidColor(a)){this.setSelectedColor(a);if(this.onColorSelected){this.onColorSelected(this.getSelectedColor(),this)}}this.close()},handleDefaultActionClick:function(b){var a=this.getDefaultColor();this.applyColor(a)},handleBoxOver:function(a){var b=a.target;if(!BX.type.isDomNode(b)||!b.dataset.color){return}this.previewColor(b.dataset.color)},handleCustomInputKeyPress:function(a){if(!a.key.match("[A-Fa-f0-9]")&&!a.ctrlKey&&!a.metaKey){a.preventDefault()}this.resetError();if(a.keyCode===13){this.applyEditMode()}},handleCustomInputKeyUp:function(a){this.previewColor("#"+this.layout.customColorInput.value)},handleCustomInputPaste:function(b){var d=b.clipboardData||window.clipboardData||null;if(d){var c=d.getData("text");var a=BX.util.trim(c).replace(/#/g,"");if(this.isValidColor("#"+a)){this.layout.customColorInput.value=a}b.preventDefault()}},switchToEditMode:function(){if(this.layout.actions){this.layout.actions.classList.add("main-color-picker-edit-mode")}this.focusCustomInput()},resetEditMode:function(){if(this.layout.actions){this.layout.actions.classList.remove("main-color-picker-edit-mode")}},isEditMode:function(){return this.layout.actions&&this.layout.actions.classList.contains("main-color-picker-edit-mode")},applyEditMode:function(){var a=BX.util.trim(this.layout.customColorInput.value);a=a.replace(/#/g,"");a="#"+a;if(!this.isValidColor(a)){this.highlightError();this.focusCustomInput();return}this.applyColor(a)},previewColor:function(a){if(this.layout.preview&&this.isValidColor(a)){this.layout.preview.style.backgroundColor=a}},focusCustomInput:function(){if(this.layout.customColorInput){this.layout.customColorInput.focus()}},highlightError:function(){if(this.layout.customColorTextBox){this.layout.customColorTextBox.classList.add("main-color-picker-custom-textbox-error")}},resetError:function(){if(this.layout.customColorTextBox){this.layout.customColorTextBox.classList.remove("main-color-picker-custom-textbox-error")}},isValidColor:function(a){return BX.type.isNotEmptyString(a)&&a.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)},getFullColorCode:function(a){if(!this.isValidColor(a)){return null}if(a.length===4){return a.replace(/([a-f0-9])/gi,"$1$1")}return a}}})();