(function(){BX.namespace("BX.Currency");var c=null,d={CURRENCY:"",NAME:"",FORMAT_STRING:"#",DEC_POINT:".",THOUSANDS_VARIANT:null,THOUSANDS_SEP:" ",DECIMALS:2,HIDE_ZERO:"N",BASE:"N",SEPARATOR:" "};function b(){if(c===null){c=BX.message("CURRENCY")}return c}function a(e){var f=b();if(typeof f[e]!=="undefined"){return f[e]}return d}BX.Currency.Editor=function(e){this.input=e.input;this.callback=e.callback;this.currency=e.currency;this.value=e.value||"";BX.ready(BX.delegate(this.init,this))};BX.Currency.Editor.prototype.init=function(){BX.bind(this.input,"bxchange",BX.proxy(this.valueEdit,this));BX.unbind(this.input,"change",BX.proxy(this.valueEdit,this))};BX.Currency.Editor.prototype.clean=function(){BX.unbind(this.input,"bxchange",BX.proxy(this.valueEdit,this));this.input=null};BX.Currency.Editor.prototype.valueEdit=function(){this.formatValue()};BX.Currency.Editor.prototype.setCurrency=function(e){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.currency=e;this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.formatValue=function(){var f=BX.getCaretPosition(this.input),e=this.input.value;this.changeValue();if(this.input.value.length>0){BX.setCaretPosition(this.input,f-e.length+this.input.value.length)}};BX.Currency.Editor.prototype.changeValue=function(){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.callValueChangeCallback=function(){if(!!this.callback){this.callback.apply(this,[this.value])}BX.onCustomEvent(this,"Currency::Editor::change",[this.value])};BX.Currency.Editor.getBaseCurrencyId=function(){var f=b();for(var e in f){if(!f.hasOwnProperty(e)){continue}if(BX.prop.getString(f[e],"BASE","N")==="Y"){return e}}return""};BX.Currency.Editor.trimTrailingZeros=function(g,e){var h=a(e),f;f=BX.prop.getString(h,"DEC_POINT","");return f!==""?g.replace(new RegExp("\\"+f+"0+$"),""):g};BX.Currency.Editor.escapeRegExp=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};BX.Currency.Editor.getUnFormattedValue=function(f,e){var g=a(e);if(g.SEPARATOR.length===1){return f.replace(new RegExp("["+g.SEPARATOR+"]","g"),"").replace(g.DEC_POINT,".")}else{if(g.SEPARATOR.length>1){return f.replace(new RegExp(this.escapeRegExp(g.SEPARATOR),"g"),"").replace(g.DEC_POINT,".")}else{return f.replace(g.DEC_POINT,".")}}};BX.Currency.Editor.getFormattedValue=function(e,o){var p=e.length,k="",g=a(o),n,f,l,j;if(p>0){e=e.replace(/^0+/,"");if(e.length<=0){e="0"}else{if(e.charAt(0)==="."){e="0"+e}}p=e.length}if(g.SEPARATOR===","||g.SEPARATOR==="."){n=new RegExp("[.,]")}else{n=new RegExp("["+g.DEC_POINT+",.]")}f=e.match(n);f=f===null?e.length:f.index;l=0;for(j=0;j<e.length;j++){var q=e.length-1-j;var h=e.charAt(q);var m=("0123456789".indexOf(h)>=0);if(m){l++}if(q===f){l=0}if(q>=f){if(g.DEC_POINT==="."&&h===","){h=g.DEC_POINT}if(g.DEC_POINT===","&&h==="."){h=g.DEC_POINT}if(m||(q===f&&h===g.DEC_POINT)){k=h+k}else{if(p>q){p--}}}else{if(m){k=h+k}else{if(p>q){p--}}if(m&&l%3===0&&l!==0&&q!==0){k=g.SEPARATOR+k;if(p>=q){p++}}}}if(g.DECIMALS>0){f=k.match(new RegExp("["+g.DEC_POINT+"]"));f=f===null?k.length:f.index;while(k.length-1-f>g.DECIMALS){if(p>=k.length-1){p--}k=k.substr(0,k.length-1)}}return k}})();