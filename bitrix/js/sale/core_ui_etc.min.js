(function(){if(typeof BX.ui!="object"){BX.ui={}}BX.ui.loader=function(a,b){this.parentConstruct(BX.ui.loader,a);BX.merge(this,{opts:{timeout:100},sys:{code:"loader"}});this.handleInitStack(b,BX.ui.loader,a)};BX.extend(BX.ui.loader,BX.ui.widget);BX.merge(BX.ui.loader.prototype,{init:function(){},show:function(){var b=this;var a=this.vars;a.timer=setTimeout(function(){b.fireEvent("toggle",[true]);a.timer=null},this.opts.timeout)},hide:function(){clearTimeout(this.vars.timer);if(this.vars.timer==null){this.fireEvent("toggle",[false])}}});BX.ui.scrollPaneNative=function(a,b){this.parentConstruct(BX.ui.scrollPaneNative,a);BX.merge(this,{opts:{eventTimeout:150,scrollError:30},vars:{prevScrollTop:0,atBottom:false},sys:{code:"scrollpanenative"}});this.handleInitStack(b,BX.ui.scrollPaneNative,a)};BX.extend(BX.ui.scrollPaneNative,BX.ui.widget);BX.merge(BX.ui.scrollPaneNative.prototype,{init:function(){this.ctrls.container=this.getControl("container");this.pushFuncStack("bindEvents",BX.ui.scrollPaneNative)},bindEvents:function(){var a=this,b=this.ctrls;BX.bind(b.container,"scroll",function(){a.checkScrollState()});BX.bind(b.container,"mousewheel",function(i){var f=BX.getWheelData(i);var c=false;var h=a.ctrls.container.scrollTop;var g=a.ctrls.container.scrollHeight;var d=a.ctrls.container.clientHeight;if(f>0&&h==0){c=true}if(f<0&&(h>=g-d)){c=true}if(c){BX.PreventDefault(i);BX.eventCancelBubble(i);return false}});BX.bind(window,"resize",function(){a.checkScrollState()});BX(function(){a.checkScrollState()})},informContentChanged:function(){this.vars.prevScrollTop=this.ctrls.container.scrollTop;this.vars.atBottom=false;this.checkScrollState()},dropScrollTop:function(){this.ctrls.container.scrollTop=0;this.checkScrollState()},scrollTo:function(b){var a=false;if(typeof b.y=="number"){a=b.y}else{if(typeof b.dy=="number"){a=this.ctrls.container.scrollTop+b.dy}}if(a!==false){this.ctrls.container.scrollTop=a}},checkFreeBottomSpace:function(){var a=this.ctrls;return a.container.scrollHeight<=a.container.clientHeight},checkScrolledToEnd:function(){var e=this.ctrls,a=this.vars,d=this.opts;var b=e.container.scrollTop;if(a.prevScrollTop==b){return}var c=e.container.scrollTop>=e.container.scrollHeight-e.container.clientHeight-d.scrollError;if(c==a.atBottom){return}a.atBottom=c;return a.atBottom},checkScrollState:function(){var a=this;if(!BX.type.isFunction(this.vars.checkFn)){this.vars.checkFn=BX.throttle(function(){if(a.checkFreeBottomSpace()){a.fireEvent("has-free-space")}if(a.checkScrolledToEnd()){a.fireEvent("scroll-to-end")}},a.opts.eventTimeout,a)}this.vars.checkFn()}});BX.ui.networkIOWidget=function(a,b){this.parentConstruct(BX.ui.networkIOWidget,a);BX.merge(this,{opts:{source:"/somewhere.php",pageSize:5,paginatedRequest:true},vars:{lastPage:0,loader:{show:BX.DoNothing,hide:BX.DoNothing}},ctrls:{},sys:{code:"network-io-widget"}});this.handleInitStack(b,BX.ui.networkIOWidget,a)};BX.extend(BX.ui.networkIOWidget,BX.ui.widget);BX.merge(BX.ui.networkIOWidget.prototype,{init:function(){},downloadBundle:function(c){var d=this.opts,b=this.vars,e=this.ctrls,a=this;b.loader.show(c.options);BX.ajax({url:d.source,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:BX.merge(a.refineRequest(c.request,c.options),a.getNavParams(c.options)),onsuccess:function(f){b.loader.hide(c.options);if(f.result){f.data=a.refineResponce(f.data,c.request,c.options);if(typeof f.data=="undefined"){f.data=[]}if(BX.type.isFunction(c.callbacks.onLoad)){c.callbacks.onLoad.apply(a,[f.data])}}else{a.showError({errors:f.errors,type:"server-logic",options:c.options})}if(BX.type.isFunction(c.callbacks.onComplete)){c.callbacks.onComplete.call(a)}},onfailure:function(f,g){b.loader.hide(c.options);a.showError({errors:[g.message],type:f,options:c.options,exception:g});if(BX.type.isFunction(c.callbacks.onComplete)){c.callbacks.onComplete.call(a)}if(BX.type.isFunction(c.callbacks.onError)){c.callbacks.onError.apply(a,[f,g])}}})},getNavParams:function(a){return this.opts.paginatedRequest?{PAGE_SIZE:this.opts.pageSize,PAGE:this.vars.lastPage}:{}},showError:function(a){BX.debug(a)},refineRequest:function(b,a){return b},refineResponce:function(b,c,a){return b}});BX.deferred=function(a){this.timer=null;this.actions={done:[],fail:[]};this.result=null;this.done=function(b){if(BX.type.isFunction(b)){this.actions.done.push(b)}};this.fail=function(b){if(BX.type.isFunction(b)){this.actions.fail.push(b)}};this.resolve=function(){if(this.result===false){return}this.result=true;this.callActions("done",arguments)};this.reject=function(){if(this.result===true){return}this.result=false;this.callActions("fail",arguments)};this.startRace=function(d,b){var c=this;this.timer=setTimeout(function(){b?c.resolve():c.reject()},d||300)};this.stopRace=function(){clearTimeout(this.timer)};this.callActions=function(d,c){for(var b in this.actions[d]){if(this.actions[d].hasOwnProperty(b)){this.actions[d][b].apply(this,c)}}};return this};BX.semaphore=function(d,a,b){var c=false;return function(){a=a||this;if(c){return}c=true;d.apply(a,arguments);c=false}};BX.util.wrapSubstring=function(j,g,e,b){if(j.length==0){return""}if(b){j=BX.util.htmlspecialchars(j);e=BX.util.htmlspecialchars(e)}if(g.length==0){return j}var n="";var m="";var c={};for(var d in g){if(!g.hasOwnProperty(d)){continue}m=g[d].toString().toLowerCase();n=j.toLowerCase();if(typeof c[m]!="undefined"){continue}var f=n.indexOf(m);if(f>=0){var a=j.slice(0,f);var l=j.slice(f,f+m.length);var h=j.slice(f+m.length,j.length);j=a+"#A#"+l+"#B#"+h}c[m]=true}return j.replace(/#A#/g,"<"+e+">").replace(/#B#/g,"</"+e+">")};BX.util.getObjectLength=function(c){if(typeof c!="object"){return 0}if("length" in c){return c.length}var b=0;for(var a in c){if(c.hasOwnProperty(a)){b++}}return b}})();