BX.namespace("BX.Sale.Delivery.Request");(function(a){BX.Sale.Delivery.Request={ajaxUrl:"/bitrix/admin/sale_delivery_request_ajax.php",timeout:120,showShipmentContent:function(e,c){var d=new BX.CDialog({title:BX.message("SALE_DELIVERY_REQ_DIALOG_CONTENT")+' "'+c+'"',content_url:this.ajaxUrl,content_post:"requestId="+e+"&shipmentId="+c+"&action=getShipmentContent&lang="+BX.message("LANGUAGE_ID")+"&sessid="+BX.bitrix_sessid(),width:500,height:550});var b=[{title:BX.message("SALE_DELIVERY_REQ_DIALOG_CLOSE"),id:"close",name:"close",action:function(){this.parentWindow.Close()}}];d.ClearButtons();d.SetButtons(b);d.Show()},processRequest:function(d,c){ShowWaitWindow();var b=d;b.sessid=BX.bitrix_sessid();b.lang=BX.message("LANGUAGE_ID");BX.ajax({timeout:this.timeout,method:"POST",dataType:"json",url:this.ajaxUrl,data:b,onsuccess:function(e){CloseWaitWindow();if(e){if(e.RESULT!="ERROR"){if(e.FILE_NAME&&e.FILE_PATH){a.location.href=BX.Sale.Delivery.Request.ajaxUrl+"?action=downloadFile&fileName="+encodeURI(e.FILE_NAME)+"&filePath="+encodeURI(e.FILE_PATH)+"&sessid="+BX.bitrix_sessid()}else{if(e.DAILOG_PARAMS){BX.Sale.Delivery.Request.showRequestDialog(e.DAILOG_PARAMS,c)}}}else{var g=BX.message("SALE_DELIVERY_REQ_ERROR")+"\n";if(e.ERRORS){for(var f in e.ERRORS){if(e.ERRORS.hasOwnProperty(f)){g+=e.ERRORS[f]+"\n"}}}alert(g)}if(e.WARNINGS&&e.WARNINGS.length>0){g+="\n"+BX.message("SALE_DELIVERY_REQ_WARNING")+"\n";for(f in e.WARNINGS){if(e.WARNINGS.hasOwnProperty(f)){g+=e.WARNINGS[f]+"\n"}}}if(e.MESSAGES&&e.MESSAGES.length>0){for(f in e.MESSAGES){if(e.MESSAGES.hasOwnProperty(f)){g+=e.MESSAGES[f]+"\n"}}}}else{alert(BX.message("SALE_DELIVERY_REQ_ERROR_RECEIVING"))}},onfailure:function(){CloseWaitWindow();alert(BX.message("SALE_DELIVERY_REQ_ERROR_PROCESSING"))}})},showRequestDialog:function(e,d){var b=new BX.CDialog({title:e.TITLE,content:'<form id="dailogContentForm">'+e.CONTENT+"</form>",width:500,height:550});var c=[{title:BX.message("SALE_DELIVERY_REQ_DIALOG_CLOSE"),id:"close",name:"close",action:function(){if(d){a.location.reload(true)}this.parentWindow.Close()}}];if(e.IS_FINAL!=true){c.push({title:BX.message("SALE_DELIVERY_REQ_DIALOG_NEXT"),id:"next",name:"next",action:function(){var j=BX("dailogContentForm"),k={},h=/\[\]$/g;for(var g=0,f=j.elements.length;g<f;g++){var m=j.elements[g].name;if(m.search(h)==-1){k[m]=j.elements[g].value}else{m=m.replace(h,"");if(typeof k[m]=="undefined"){k[m]=[]}k[m].push(j.elements[g].value)}}BX.Sale.Delivery.Request.processRequest(k,d);this.parentWindow.Close()}})}BX.addCustomEvent(b,"onWindowClose",function(f){f.DIV.parentNode.removeChild(f.DIV);BX.proxy(function(){this.Register()},this)});b.ClearButtons();b.SetButtons(c);b.Show();b.adjustSizeEx()}}})(window);