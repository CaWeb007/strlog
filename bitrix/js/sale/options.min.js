(function(a){if(!BX.Sale){BX.Sale={}}if(BX.Sale.Options){return}BX.Sale.Options={lang:null,reqTimeIntervalId:null,reqDelay:1000,countryPrf:"sales_zone_countries_",regionPrf:"sales_zone_regions_",cityPrf:"sales_zone_cities_",onCountrySelect:function(c){if(BX.Sale.Options.reqTimeIntervalId){a.clearInterval(BX.Sale.Options.reqTimeIntervalId)}var c=c||a.event;var e=c.target||c.srcElement;var d=e.id.replace(BX.Sale.Options.countryPrf,"");var b=BX.Sale.Options.getValuesFromMultiselect(e);BX.Sale.Options.reqTimeIntervalId=a.setInterval(function(){ShowWaitWindow();BX.selectUtils.deleteAllOptions(BX(BX.Sale.Options.regionPrf+d));BX.selectUtils.deleteAllOptions(BX(BX.Sale.Options.cityPrf+d));BX.Sale.Options.getLocationRegions(b,d)},BX.Sale.Options.reqDelay)},setLocationRegions:function(e,d){if(!d){return false}var c=BX(BX.Sale.Options.regionPrf+d);if(!c){return false}BX.selectUtils.addNewOption(c,"",BX.message("SMO_LOCATION_ALL"),false,false);BX.selectUtils.addNewOption(c,"NULL",BX.message("SMO_LOCATION_NO_REGION"),false,false);BX.selectUtils.addNewOption(BX(BX.Sale.Options.cityPrf+d),"",BX.message("SMO_LOCATION_ALL"),false,false);for(var b in e){if(e.hasOwnProperty(b)){BX.selectUtils.addNewOption(c,b,e[b],false,false)}}},getLocationRegions:function(d,e){a.clearInterval(BX.Sale.Options.reqTimeIntervalId);var c="/bitrix/services/ajax/sale/location/index.php";var b={action:"getRegionList",countryIds:d,lang:BX.Sale.Options.lang,sessid:BX.bitrix_sessid()};BX.ajax({timeout:30,method:"POST",dataType:"json",url:c,data:b,onsuccess:function(f){CloseWaitWindow();if(f&&f.DATA&&!f.ERROR){BX.Sale.Options.setLocationRegions(f.DATA,e)}else{if(f&&f.ERROR){alert(BX.message("SMO_LOCATION_JS_GET_DATA_ERROR")+": "+f.ERROR)}else{alert(BX.message("SMO_LOCATION_JS_GET_DATA_ERROR"))}}},onfailure:function(){CloseWaitWindow();alert(BX.message("SMO_LOCATION_JS_GET_DATA_ERROR"))}})},getValuesFromMultiselect:function(d){var b=[];for(var c=0;c<d.options.length;c++){if(d.options[c].selected==true){b.push(d.options[c].value)}}return b},onRegionSelect:function(c){if(BX.Sale.Options.reqTimeIntervalId){a.clearInterval(BX.Sale.Options.reqTimeIntervalId)}var c=c||a.event;var e=c.target||c.srcElement;var d=e.id.replace(BX.Sale.Options.regionPrf,"");var f=BX.Sale.Options.getValuesFromMultiselect(e);var b=BX.Sale.Options.getValuesFromMultiselect(BX(BX.Sale.Options.countryPrf+d));BX.Sale.Options.reqTimeIntervalId=a.setInterval(function(){ShowWaitWindow();BX.selectUtils.deleteAllOptions(BX(BX.Sale.Options.cityPrf+d));BX.Sale.Options.getLocationCities(b,f,d)},BX.Sale.Options.reqDelay)},getLocationCities:function(e,d,f){a.clearInterval(BX.Sale.Options.reqTimeIntervalId);var c="/bitrix/services/ajax/sale/location/index.php";var b={action:"getCityList",regionIds:d,countryIds:e,lang:BX.Sale.Options.lang,sessid:BX.bitrix_sessid()};BX.ajax({timeout:30,method:"POST",dataType:"json",url:c,data:b,onsuccess:function(g){CloseWaitWindow();if(g&&g.DATA&&!g.ERROR){BX.Sale.Options.setLocationCities(g.DATA,f)}else{if(g&&g.ERROR){alert(BX.message("SMO_LOCATION_JS_GET_DATA_ERROR")+": "+g.ERROR)}else{alert(BX.message("SMO_LOCATION_JS_GET_DATA_ERROR"))}}},onfailure:function(){CloseWaitWindow();alert(BX.message("SMO_LOCATION_JS_GET_DATA_ERROR"))}})},setLocationCities:function(c,d){if(!d){return false}var e=BX(BX.Sale.Options.cityPrf+d);if(!e){return false}BX.selectUtils.deleteAllOptions(e);BX.selectUtils.addNewOption(e,"",BX.message("SMO_LOCATION_ALL"),false,false);for(var b in c){if(c.hasOwnProperty(b)){BX.selectUtils.addNewOption(e,b,c[b],false,false)}}}}})(window);