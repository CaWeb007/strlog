this.BX=this.BX||{};this.BX.Sale=this.BX.Sale||{};this.BX.Sale.Admin=this.BX.Sale.Admin||{};(function(k,m,i){var l=function(){function q(){babelHelpers.classCallCheck(this,q)}babelHelpers.createClass(q,null,[{key:"createWidget",value:function r(u){var t=u.items.slice(0,u.rowsCount);return new m.Widget({rowData:q._createBarcodeWidgetRows(t,u.isSupportedMarkingCode),headData:q._createBarcodeWidgetHead(u.isSupportedMarkingCode,u.useStoreControl),rowsCount:u.rowsCount,orderId:u.orderId,basketId:u.basketId,storeId:u.storeId,isBarcodeMulti:u.isBarcodeMulti,readonly:u.readonly})}},{key:"_createBarcodeWidgetHead",value:function s(v,u){var t={};if(u){t.barcode={title:BX.message("SALE_JS_ADMIN_ORDER_CONF_BARCODE")}}if(v){t.markingCode={title:BX.message("SALE_JS_ADMIN_ORDER_CONF_MARKING_CODE")}}return t}},{key:"_createBarcodeWidgetRows",value:function p(u,v){var t=[];u.forEach(function(x){var w={id:x.id};w.barcode=x.barcode;if(v){w.markingCode=x.markingCode}t.push(w)});return t}}]);return q}();function g(){var q=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="sale-shipment-basket-barcodes-dialog">\n\t\t\t\t<div class="sale-shipment-basket-barcodes-dialog-product-name">',"</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>"]);p=function p(){return q};return q}function e(){var q=babelHelpers.taggedTemplateLiteral(['<div class="sale-shipment-basket-barcodes-dialog-store-name">',"</div>"]);p=function p(){return q};return q}var n=function(){function s(u){babelHelpers.classCallCheck(this,s);this._onClose=u.onClose||null;this._columnsCount=u.columnsCount;this._dialog=this._create(u.widget,u.productName,u.storeName)}babelHelpers.createClass(s,[{key:"show",value:function r(){this._dialog.Show();this._dialog.adjustSizeEx()}},{key:"_getWidth",value:function q(){return this._columnsCount===1?280:400}},{key:"_createStoreRow",value:function p(v){var u="";if(v.length>0){u=i.Tag.render(e(),BX.util.htmlspecialchars(v))}return u}},{key:"_create",value:function t(z,x,u){var A=this;var w=i.Tag.render(g(),BX.util.htmlspecialchars(x),this._createStoreRow(u),z.render());var v=new BX.CDialog({content:w,title:BX.message("SALE_JS_ADMIN_ORDER_CONF_INPUT_BARCODES"),width:this._getWidth(),height:400,resizable:false,buttons:[new BX.CWindowButton({title:BX.message("SALE_JS_ADMIN_ORDER_CONF_CLOSE"),action:function y(){if(A._onClose){A._onClose(z)}BX.WindowManager.Get().Close()},className:"btnCloseBarcodeDialog"})]});BX.addCustomEvent(v,"onWindowClose",function(B){B.DIV.parentNode.removeChild(B.DIV)});return v}}]);return s}();function b(){var p=babelHelpers.taggedTemplateLiteral(["",""]);q=function q(){return p};return p}function c(){var p=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t<div>\t\t\t\t\t\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>"]);q=function q(){return p};return p}function d(){var q=babelHelpers.taggedTemplateLiteral(['<span style="cursor: pointer; border-bottom: 1px dashed;" onclick="','">',"</span>"]);p=function p(){return q};return q}function f(){var q=babelHelpers.taggedTemplateLiteral(['<input type="button" value="','" onclick="','">']);p=function p(){return q};return q}function a(){var q=babelHelpers.taggedTemplateLiteral(["<div>","","</div>"]);a=function p(){return q};return q}function o(){var q=babelHelpers.taggedTemplateLiteral(["<div></div>"]);o=function p(){return q};return q}var h=function(){function u(F){babelHelpers.classCallCheck(this,u);this._basketId=F.basketId;this._product=F.product;this._index=F.index;this._orderId=F.orderId;this._type=F.type;this._useStoreControl=F.useStoreControl;this._dataFieldTemplate=F.dataFieldTemplate||"";this._itemNode=null;this._hiddensContainer=null;this._initialStoreId=0;var E=[];if(this._product.BARCODE_INFO){var D=Object.keys(this._product.BARCODE_INFO);this._initialStoreId=D[this._index-1];if(this._initialStoreId){E=this._product.BARCODE_INFO[this._initialStoreId]}}this._items=this._initItems(E)}babelHelpers.createClass(u,[{key:"_initItems",value:function y(E){if(E.length<=0){return[]}var D=[];if(this._isSupportedMarkingCode()||this._isBarcodeMulti()){E.forEach(function(G){D.push({id:G.ID,barcode:G.BARCODE,markingCode:G.MARKING_CODE})})}else{var F=E[0];D=[{id:F.ID,barcode:F.BARCODE,markingCode:F.MARKING_CODE}]}return D}},{key:"render",value:function q(){this._itemNode=this._renderItemNode();this._hiddensContainer=i.Tag.render(o());this._renderHiddens();return i.Tag.render(a(),this._itemNode,this._hiddensContainer)}},{key:"_renderItemNode",value:function z(){var D=null;if(this._type===u.TYPE_BUTTON){D=i.Tag.render(f(),BX.message("SALE_JS_ADMIN_ORDER_CONF_BARCODES"),this._onClick.bind(this))}else{if(this._type===u.TYPE_LINK){D=i.Tag.render(d(),this._onClick.bind(this),BX.message("SALE_JS_ADMIN_ORDER_CONF_BARCODE"))}else{if(this._type===u.TYPE_INPUT){var E=this._createWidget(1);D=E.render()}else{throw new Error("Wrong BarcodeView type")}}}return D}},{key:"_getActualBarcodesQuantity",value:function B(){return this._items.length}},{key:"_getActualStoreId",value:function v(){return this._initialStoreId}},{key:"_onClick",value:function x(){var D=new n({widget:this._createWidget(),productName:this._product.NAME,storeName:this._getStoreName(this._getActualStoreId()),columnsCount:this._getColumnsCount()});D.show()}},{key:"_getColumnsCount",value:function w(){return this._isSupportedMarkingCode()&&this._useStoreControl?2:1}},{key:"_getStoreName",value:function t(F){if(this._product.STORES&&Array.isArray(this._product.STORES)){var E=this._product.STORES;for(var G=0,D=E.length;G<D;G++){if(parseInt(E[G].STORE_ID)===parseInt(F)){return E[G].STORE_NAME}}}return""}},{key:"_isBarcodeMulti",value:function C(){return this._product.BARCODE_MULTI==="Y"}},{key:"_isSupportedMarkingCode",value:function r(){return this._product.IS_SUPPORTED_MARKING_CODE==="Y"}},{key:"_createWidget",value:function A(D){return l.createWidget({items:this._items,rowsCount:D,orderId:this._orderId,basketId:this._basketId,readonly:true,useStoreControl:this._useStoreControl,storeId:this._getActualStoreId(),isBarcodeMulti:this._isBarcodeMulti(),isSupportedMarkingCode:this._isSupportedMarkingCode()})}},{key:"_renderHiddens",value:function p(){var E=this;if(!this._dataFieldTemplate){return}this._hiddensContainer.innerHTML="";var D=0;this._items.forEach(function(F){E._hiddensContainer.appendChild(i.Tag.render(c(),E._createHiddenInput("VALUE",D,F.barcode),E._createHiddenInput("ID",D,F.id),E._createHiddenInput("MARKING_CODE",D,F.markingCode)));D++})}},{key:"_createHiddenInput",value:function s(E,G,H){var F=this._dataFieldTemplate.replace("#ITERATOR#",G).replace("#DATA_TYPE#",E).replace("#DATA_TYPE_LOWER#",E.toLowerCase());var D=i.Tag.render(b(),F);D.setAttribute("value",H);return D}}]);return u}();babelHelpers.defineProperty(h,"TYPE_BUTTON","button");babelHelpers.defineProperty(h,"TYPE_LINK","link");babelHelpers.defineProperty(h,"TYPE_INPUT","input");var j=function(t){babelHelpers.inherits(r,t);function r(y){var z;babelHelpers.classCallCheck(this,r);z=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this,y));z._dataFieldTemplate=y.dataFieldTemplate;z._useStoreControl=y.useStoreControl;z._getActualBarcodeQuantityMethod=y.getActualBarcodeQuantityMethod;z._getActualStoreIdByIndexMethod=y.getActualStoreIdByIndexMethod;return z}babelHelpers.createClass(r,[{key:"_getActualBarcodesQuantity",value:function w(){var y=1;if(this._isBarcodeMulti()||this._isSupportedMarkingCode()){y=this._getActualBarcodeQuantityMethod(this._basketId,this._index)}return y}},{key:"_getActualStoreId",value:function s(){return this._getActualStoreIdByIndexMethod(this._basketId,this._index)}},{key:"_onClick",value:function u(){var y=new n({widget:this._createWidget(this._getActualBarcodesQuantity()),productName:this._product.NAME,storeName:this._getStoreName(this._getActualStoreId()),onClose:this._onDialogClose.bind(this),columnsCount:this._getColumnsCount()});y.show()}},{key:"_createWidget",value:function v(y){var z=l.createWidget({items:this._items,rowsCount:y,orderId:this._orderId,basketId:this._basketId,readonly:false,useStoreControl:this._useStoreControl,storeId:this._getActualStoreId(),isBarcodeMulti:this._isBarcodeMulti(),isSupportedMarkingCode:this._isSupportedMarkingCode()});z.onChangeSubscribe(this._onWidgetChanged.bind(this));return z}},{key:"_onWidgetChanged",value:function p(y){var z=y.data;this._getWidgetData(z)}},{key:"_getWidgetData",value:function x(z){var y=this;this._items=[];z.getItemsData().forEach(function(A){y._items.push({id:A.id,barcode:A.barcode.value,markingCode:A.markingCode.value})});this._renderHiddens(this._items)}},{key:"_onDialogClose",value:function q(y){this._getWidgetData(y)}}]);return r}(h);k.ShipmentBasketBarcodeView=h;k.ShipmentBasketBarcodeEdit=j}((this.BX.Sale.Admin.Order=this.BX.Sale.Admin.Order||{}),BX.Sale.Barcode,BX));