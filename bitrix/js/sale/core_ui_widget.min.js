(function(){if(typeof BX.ui!="object"){BX.ui={}}BX.ui.widget=function(a){BX.merge(this,{opts:{scope:false,useSpawn:false,messages:{},controls:{},bindEvents:{},removeTemplates:true,initializeByGlobalEvent:false,globalEventScope:"document"},vars:{},ctrls:{},tmpls:{},sys:{stack:{init:[]},code:"widget",initialized:false}});this.pushFuncStack("init",BX.ui.widget);this.isUIWidget=true};BX.merge(BX.ui.widget.prototype,{preInit:function(){var a=this,c=this.opts,d=this.ctrls,b=this.sys.code;d.scope=null;if(!("querySelector" in document)){throw new Error("Your browser does not support querySelector")}if(!b.match(/^[a-zA-Z0-9-_]+$/)){throw new Error('Only letters, digitis, "-" and "_" allowed in code')}},init:function(){var a=this,f=this.ctrls,e=this.opts,d=this.sys.code;if(e.scope!==false){f.scope=BX.type.isNotEmptyString(e.scope)?BX(e.scope):e.scope;if(!BX.type.isElementNode(f.scope)){throw new Error("Invalid node passed")}if(e.useSpawn&&f.scope){a.tmpls.scope=f.scope.outerHTML}var c=f.scope.querySelectorAll('script[type="text/html"]');for(var b=0;b<c.length;b++){var g=BX.data(c[b],"template-id");if(typeof g=="string"&&g.length>0&&g.search("bx-ui-"+d)==0){g=g.replace("bx-ui-"+d+"-","");a.tmpls[g]=c[b].innerHTML;if(this.opts.removeTemplates){BX.remove(c[b])}}}}if(typeof e.bindEvents=="object"){for(var b in e.bindEvents){if(e.bindEvents.hasOwnProperty(b)){if(BX.type.isFunction(e.bindEvents[b])){this.bindEvent(b,e.bindEvents[b])}}}}e.bindEvents=null},remove:function(){if(BX.type.isDomNode(this.ctrls.scope)){this.ctrls.scope.innerHTML=""}BX.unbindAll(this)},getControlClassName:function(a){return"bx-ui-"+this.sys.code+"-"+a},getControl:function(i,b,d,a){if(!BX.type.isNotEmptyString(i)){return null}if(BX.type.isElementNode(this.opts.controls[i])){return this.opts.controls[i]}if(!this.ctrls.scope&&!searchWholeDoc){return null}var h=this.ctrls.scope;if(BX.type.isElementNode(d)){h=d}var c=function(e){return(!a&&e!==null)||(a&&e.length>0)};try{var f=h[a?"querySelectorAll":"querySelector"]('[data-bx-ui-id="'+this.sys.code+"-"+i+'"]');if(c(f)){return f}}catch(g){}try{var f=h[a?"querySelectorAll":"querySelector"]("."+this.getControlClassName(i));if(c(f)){return f}}catch(g){}try{var f=h[a?"querySelectorAll":"querySelector"]("."+i);if(c(f)){return f}}catch(g){}try{var f=h[a?"querySelectorAll":"querySelector"](i);if(c(f)){return f}}catch(g){}if(f===null&&!b){throw new Error("Requested control node can not be found ("+i+")")}return f},setOption:function(a,b){this.opts[a]=b},getOption:function(a){return this.opts[a]},getSysCode:function(){return this.sys.code},template:function(b,a){if(typeof a=="undefined"){return this.tmpls[b]}else{if(!BX.type.isString(a)){throw new TypeError("Bad template html")}this.tmpls[b]=a}},getHTMLByTemplate:function(d,e){var c=this.tmpls[d];if(!BX.type.isNotEmptyString(c)){BX.debug("template not found: "+d);return""}for(var b in e){if(!e.hasOwnProperty(b)){continue}if(typeof e[b]!="undefined"&&e.hasOwnProperty(b)){var a="";if(b.toString().indexOf("=")==0){a=e[b].toString();b=b.toString().substr(1)}else{a=BX.util.htmlspecialchars(e[b]).toString()}var f="{{"+b.toString().toLowerCase()+"}}";if(a.search(f)>=0){a=""}while(c.search(f)>=0){c=c.replace(f,a)}}}return c},createNodesByTemplate:function(b,c,g){var f=this.getHTMLByTemplate(b,c);var i=this.tmpls[b];if(!BX.type.isNotEmptyString(i)){return null}i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var h=false;var e=false;if(i.search(/^<\s*(tr|th)[^<]*>/)>=0){h=true}else{if(i.search(/^<\s*td[^<]*>/)>=0){e=true}}var j=document.createElement("div");if(h||e){if(h){j.innerHTML="<table><tbody>"+f+"</tbody></table>";j=j.childNodes[0].childNodes[0]}else{j.innerHTML="<table><tbody><tr>"+f+"</tr></tbody></table>";j=j.childNodes[0].childNodes[0].childNodes[0]}}else{j.innerHTML=f}if(g){var a=j.childNodes;var l=[];for(var d=0;d<a.length;d++){if(BX.type.isElementNode(a[d])){l.push(a[d])}}return l}else{return Array.prototype.slice.call(j.childNodes)}},replaceTemplate:function(b,a){this.tmpls[b]=a},parentConstruct:function(a,b){var d=a.superclass;if(typeof d=="object"){d.constructor.apply(this,[b,true])}},handleInitStack:function(d,a,c){this.pushFuncStack("init",a);if(!d){BX.merge(this.opts,c);BX.ui.widget.prototype.preInit.call(this);var e=function(){if(this.sys.initialized){return}this.resolveFuncStack("init");for(var f in this.sys.stack){if(this.sys.stack.hasOwnProperty(f)){if(f!="init"){this.resolveFuncStack(f,true)}}}this.sys.initialized=true;this.fireEvent("init",[this])};if(BX.type.isString(this.opts.initializeByGlobalEvent)&&this.opts.initializeByGlobalEvent.length>0){var b=this.opts.globalEventScope=="window"?window:document;BX.addCustomEvent(b,this.opts.initializeByGlobalEvent,BX.proxy(e,this))}else{e.call(this)}}},pushFuncStack:function(b,a){if(BX.type.isFunction(a.prototype[b])){if(typeof this.sys.stack[b]=="undefined"){this.sys.stack[b]=[]}this.sys.stack[b].push({owner:a,f:a.prototype[b]})}},disableInFuncStack:function(d,b){var a=this.sys.stack[d];if(typeof a=="undefined"){return}for(var c=0;c<a.length;c++){if(a[c].owner==b){a[c].f=BX.DoNothing}}},resolveFuncStack:function(d,c){var a=this.sys.stack[d];if(typeof a=="undefined"){return}for(var b=0;b<a.length;b++){a[b].f.call(this)}if(c){this.fireEvent(d,[this],document)}this.sys.stack[d]=null},fireEvent:function(a,b,c){c=c||this;b=b||[];BX.onCustomEvent(c,"bx-ui-"+this.sys.code+"-"+a,b)},bindEvent:function(a,b){BX.addCustomEvent(this,"bx-ui-"+this.sys.code+"-"+a,b)},setCSSState:function(b,a){this.changeCSSState(b,a,true)},dropCSSState:function(b,a){this.changeCSSState(b,a,false)},changeCSSState:function(c,b,a){b=b||this.ctrls.scope;if(typeof c!="string"||c.length==0){return}BX[a?"addClass":"removeClass"](b,"bx-ui-state-"+c)},spawn:function(b,c){if(this.opts.useSpawn){BX.html(b,this.tmpls.scope)}var a=BX.clone(this.opts);a.scope=b;if(BX.type.isFunction(c)){c.apply(this,[a,b])}return new this.constructor(a)},getRandom:function(){return"bx"+this.sys.code+Math.floor((Math.random()*1000)+1)+Math.floor((Math.random()*1000)+1)}})})();