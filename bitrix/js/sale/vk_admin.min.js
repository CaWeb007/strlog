(function(a){if(!BX.Sale){BX.Sale={}}if(!BX.Sale.VkAdmin){BX.Sale.VkAdmin={}}BX.Sale.VkAdmin={ajaxUrl:"/bitrix/admin/sale_vk_ajax.php",startFeed:function(c,e,d){BX.Sale.VkAdmin.exportProcessProlog();if(d){BX.cleanNode(BX("vk_export_notify__progress"))}BX.showWait();var b={action:"startFeed",type:c,exportId:e,firstRun:d,sessid:BX.bitrix_sessid()};BX.ajax({timeout:120,method:"POST",dataType:"json",url:BX.Sale.VkAdmin.ajaxUrl,data:b,onsuccess:function(f){if(f&&f.ERRORS_CRITICAL){BX.closeWait();BX.adjust(BX("vk_export_notify__error_critical"),{style:{display:"block"}});BX.adjust(BX("vk_export_notify__error_critical"),{html:f.ERRORS_CRITICAL});if(f.PROGRESS.length>0){BX.adjust(BX("vk_export_notify__progress"),{html:f.PROGRESS})}BX.Sale.VkAdmin.exportProcessEpilog()}else{if(f&&f.CONTINUE){BX.closeWait();BX.Sale.VkAdmin.startFeed(f.TYPE,e,false)}else{BX.closeWait();BX.Sale.VkAdmin.exportProcessEpilog()}if(f.PROGRESS.length>0){BX.adjust(BX("vk_export_notify__progress"),{html:f.PROGRESS})}if(typeof(f.STATS_ALBUMS)!="undefined"&&f.STATS_ALBUMS.length>0){BX.adjust(BX("vk_export_statistic__albums"),{html:f.STATS_ALBUMS})}if(typeof(f.STATS_PRODUCTS)!="undefined"&&f.STATS_PRODUCTS.length>0){BX.adjust(BX("vk_export_statistic__products"),{html:f.STATS_PRODUCTS})}if(typeof(f.ERRORS_NORMAL)!="undefined"&&f.ERRORS_NORMAL.length>0){BX.adjust(BX("vk_export_notify__error_normal"),{style:{display:"block"}});BX.adjust(BX("vk_export_notify__error_normal__msg"),{html:f.ERRORS_NORMAL})}}},onfailure:function(){BX.closeWait();BX.Sale.VkAdmin.exportProcessEpilog();BX.debug("Feed failure!");location.reload()}})},exportProcessProlog:function(){BX.adjust(BX("vk_export_button__startFeed_all"),{props:{disabled:true}});var c=document.getElementsByClassName("adm-btn-menu");for(var b=0;b<c.length;b++){BX.adjust(c[b],{style:{display:"none"}});BX.addClass(c[b],"adm-btn-disabled")}BX.adjust(BX("vk_export_button__save"),{props:{disabled:true}});BX.adjust(BX("vk_export_button__apply"),{props:{disabled:true}});BX.adjust(BX("vk_export_button__cancel"),{props:{disabled:true}})},exportProcessEpilog:function(){BX.adjust(BX("vk_export_button__startFeed_all"),{props:{disabled:false}});var c=document.getElementsByClassName("adm-btn-menu");for(var b=0;b<c.length;b++){BX.adjust(c[b],{style:{display:"inline-block"}});BX.removeClass(c[b],"adm-btn-disabled")}BX.adjust(BX("vk_export_button__save"),{props:{disabled:false}});BX.adjust(BX("vk_export_button__apply"),{props:{disabled:false}});BX.adjust(BX("vk_export_button__cancel"),{props:{disabled:false}})},stopProcess:function(c){BX.showWait();var b={action:"stopProcess",exportId:c,sessid:BX.bitrix_sessid()};BX.ajax({timeout:120,method:"POST",dataType:"json",url:BX.Sale.VkAdmin.ajaxUrl,data:b,onsuccess:function(d){BX.closeWait();if(d&&d.COMPLETED){}else{alert(d.ERROR)}BX.Sale.VkAdmin.exportProcessEpilog()},onfailure:function(){BX.debug("Feed SALE_VK_SETTINGS_RESET_ERROR")}})},clearErrorLog:function(c){BX.showWait();var b={action:"clearErrorLog",exportId:c,sessid:BX.bitrix_sessid()};BX.ajax({timeout:120,method:"POST",dataType:"json",url:BX.Sale.VkAdmin.ajaxUrl,data:b,onsuccess:function(d){BX.closeWait();if(d&&d.COMPLETED){BX.adjust(BX("vk_export_notify__error_normal"),{style:{display:"none"}});BX.adjust(BX("vk_export_notify__error_critical"),{style:{display:"none"}})}else{alert(d.MESSAGE)}},onfailure:function(){BX.closeWait();BX.debug("Feed SALE_VK_SETTINGS_RESET_ERROR")}})},loadExportMapOk:false,loadExportMap:function(c){if(!BX.Sale.VkAdmin.loadExportMapOk){BX.showWait();var b={action:"loadExportMap",exportId:c,sessid:BX.bitrix_sessid()};BX.ajax({timeout:120,method:"POST",dataType:"json",url:BX.Sale.VkAdmin.ajaxUrl,data:b,onsuccess:function(d){BX.closeWait();if(d&&d.COMPLETED){BX.adjust(BX("vk_export_map_edit_table__content"),{html:d.MAP});BX.Sale.VkAdmin.loadExportMapOk=true}},onfailure:function(){BX.closeWait();BX.debug("LOAD EXPORT MAP ERROR")}})}},changeVkGroupLink:function(){BX("vk_export_groupselector__link").href="https://vk.com/club"+BX("vk_export_groupselector").value}}})(window);