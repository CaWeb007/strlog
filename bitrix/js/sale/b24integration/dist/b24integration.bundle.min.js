this.BX=this.BX||{};(function(a){var b=function(){function w(){var z=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,w);this.ownerId=!!z.ownerId?z.ownerId:0;this.ownerTypeId=!!z.ownerTypeId?z.ownerTypeId:0}babelHelpers.createClass(w,[{key:"progress",value:function i(A){var C=this;var z=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var B=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(!A||A.length<=0){throw new Error("list must be defined")}w.isSuccess=true;this.batchFetch(A,z,B).then(function(D){C.activityAdds(D).then(function(){return C.clientAdds(D).then(function(){return C.dealUpdateContacts(C.ownerId,D).then(function(){return w.getFulfillPromise()},function(){throw new Error("batchFetch dealUpdateContacts Error")})},function(){throw new Error("batchFetch clientAdds Error")})},function(E){return C.continueProcess(E)}).then(function(){return C.nextBatch(D).then(function(){},function(){return w.labelFinish(D)})},function(){throw new Error("progress Error")})},function(){throw new Error("batchFetch Error")})}},{key:"continueProcess",value:function x(z){var A=!!z.errors?z.errors:{};if(Object.values(A).length>0){throw new Error("continueProcess Error")}else{return w.getFulfillPromise()}}},{key:"batchFetch",value:function m(A,z,B){return BX.ajax.runAction("sale.integration.stepper.activityBatch",{data:{list:A,total:z,start:B}})}},{key:"activityAdds",value:function l(z){var A=!!z.data?z.data:{};w.progressBar(A);w.messageBar(A);if(!!A.process){if(Object.values(A.process.items).length>0){return BX.ajax.runAction("sale.integration.scenarios.activityAddsFromOrderList",{data:{params:A.process.items}})}else{if(Object.values(A.process.list).length>0){return w.getRejectPromise()}else{if(!!A.error&&A.error.length>0){return w.getRejectPromise()}}}}throw new Error("activityAdds Error")}},{key:"prepareContactFields",value:function p(z){if(!!z.status&&z.status==="success"){var A=!!z.data?z.data:{};if(!!A.process&&Object.values(A.process.items).length>0){return BX.ajax.runAction("sale.integration.scenarios.resolveContactFieldsValuesFromOrderList",{data:{params:A.process.items}})}}throw new Error("clientAdds Error")}},{key:"clientAdds",value:function d(z){var A=this;return this.prepareContactFields(z).then(function(B){return A.contactRelationVoid(B).then(function(C){return A.contactAdds(C).then(function(){return w.getFulfillPromise()},function(){throw new Error("clientAdds contactAdds Error")})},function(){throw new Error("clientAdds contactRelationVoid Error")})},function(){throw new Error("clientAdds prepareContactFields Error")})}},{key:"contactRelationVoid",value:function r(A){if(!!A.status&&A.status==="success"){var z=!!A.data?A.data:{};if(!!z.result&&Object.values(z.result).length>0){return BX.ajax.runAction("sale.integration.scenarios.resolveUserTypeIAfterComparingRemotelyRelationFromOrderList",{data:{params:z.result}})}else{return w.getFulfillPromise(A)}}throw new Error("contactRelationVoid Error")}},{key:"contactAdds",value:function j(A){if(!!A.status&&A.status==="success"){var z=!!A.data?A.data:{};if(!!z.result&&Object.values(z.result).length>0){return BX.ajax.runAction("sale.integration.scenarios.contactAddsFromOrderList",{data:{params:z.result}})}else{return w.getFulfillPromise()}}throw new Error("contactAdds Error")}},{key:"dealUpdateContacts",value:function o(B,z){var A=this;return this.prepareContactFields(z).then(function(C){return A.dealContactItemsUpdate(B,C)},function(){throw new Error("dealUpdateContacts prepareContactFields Error")})}},{key:"dealContactItemsUpdate",value:function h(A,C){var z=this;if(!!C.status&&C.status==="success"){var B=!!C.data?C.data:{};if(!!B.result&&Object.values(B.result).length>0){return this.dealContactItemsGet(A).then(function(D){return z.dealContactAdds(A,{list:C,items:D})},function(){throw new Error("dealUpdateContacts dealContactAdds Error")})}else{return w.getFulfillPromise()}}throw new Error("dealUpdateContacts dealContactItemsUpdate Error")}},{key:"dealContactAdds",value:function g(B,D){var E=!!D.list?D.list:{};var C=!!D.items?D.items:{};if(!!E.status&&E.status==="success"&&!!C.status&&C.status==="success"){var z=!!E.data?E.data:{};var A=!!C.data?C.data:{};if(!!z.result&&!!A.result){if(Object.values(A.result).length>0){return BX.ajax.runAction("sale.integration.scenarios.dealContactUpdates",{data:{id:B,items:z.result,contacts:A.result}})}else{return BX.ajax.runAction("sale.integration.scenarios.dealContactAdds",{data:{id:B,items:z.result}})}}}throw new Error("dealContactAdds Error")}},{key:"dealContactItemsGet",value:function t(z){return BX.ajax.runAction("sale.integration.scenarios.dealContactItemsGet",{data:{id:z}})}},{key:"dealUpdate",value:function v(z){if(!!z.status&&z.status==="success"){var A=!!z.data?z.data:{};if(!!A.process&&A.process.items.length>0){return BX.ajax.runAction("sale.integration.scenarios.dealupdatecontacts",{data:{id:this.ownerId,params:A.process.items}})}}throw new Error("dealUpdate Error")}},{key:"nextBatch",value:function s(z){if(!!z.status&&z.status==="success"){var A=!!z.data?z.data:{};if(!!A.process&&!!A.process.list&&!!A.process.items&&!!A.process.total&&!!A.process.start){if(Object.values(A.process.items).length>0&&Object.values(A.process.list).length>0){this.progress(A.process.list,A.process.total,A.process.start);return w.getFulfillPromise()}if(Object.values(A.process.items).length===0&&Object.values(A.process.list).length>0){this.progress(A.process.list,A.process.total,A.process.start);return w.getFulfillPromise()}else{if(Object.values(A.process.list).length<=0){return w.getRejectPromise()}}}}throw new Error("nextBatch Error")}}],[{key:"progressBar",value:function q(z){if(!!z.progress){BX.ajax.runAction("sale.integration.stepper.progressbar",{data:{value:z.progress}}).then(function(A){return w.render("progress",A.data)},function(){throw new Error("ProgressBar failure!")})}}},{key:"labelFinish",value:function e(z){var A=!!z.data?z.data:{};if(!!A.finish){BX.ajax.runAction("sale.integration.stepper.messageOK",{}).then(function(B){w.render("finish",B.data);if(w.isSuccess){w.closeApplication()}},function(){throw new Error("MessagebyType OK failure!")})}}},{key:"messageBar",value:function u(z){if(!!z.error){w.isSuccess=false;BX.ajax.runAction("sale.integration.stepper.messagebytype",{data:{message:z.error,type:"ERROR"}}).then(function(A){var B=BX.create("DIV");B.innerHTML=A.data;BX("progress_error").appendChild(B)},function(){throw new Error("MessagebyType ERROR failure!")})}}},{key:"render",value:function y(A,z){BX.adjust(BX(A),{html:z})}},{key:"getFulfillPromise",value:function f(){var A=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var z=new BX.Promise();z.fulfill(A);return z}},{key:"getFulfillPromise_setTimeout",value:function c(){var z=this;var A=new BX.Promise();setTimeout(function(){A.fulfill(z)},2000);return A}},{key:"getRejectPromise",value:function k(){var z=new BX.Promise();z.reject(this);return z}},{key:"closeApplication",value:function n(){setTimeout(function(){BX24.closeApplication()},500)}}]);return w}();a.Stepper=b}((this.BX.Sale=this.BX.Sale||{})));