(function(a){if(!BX.Sale){BX.Sale={}}if(BX.Sale.CashboxReport){return}BX.Sale.CashboxReport={ajaxUrl:"/bitrix/admin/sale_order_ajax.php",onClearFilter:function(){var b=BX("filter_cashbox_id");if(b!==undefined&&b!==null){var c=b.children;if(c[0]!==undefined&&c[0]!==null){c[0].selected=true}}this.changeCashboxBlocks()},changeCashboxBlocks:function(){var b=BX("filter_cashbox_id");if(b!==undefined&&b!==null){var c={sessid:BX.bitrix_sessid(),cashboxId:b.value,action:"loadCashboxCheckInfo"};BX.proxy(BX.ajax({method:"post",dataType:"json",url:this.ajaxUrl,data:c,onsuccess:BX.proxy(function(d){if(d.ERROR&&d.ERROR.length>0){alert(d.ERROR)}else{if(d.CASH){cashNow=BX("adm-zreport-cash-now");if(cashNow){cashNow.innerHTML=d.CASH.FORMATED_SUM}cashReturn=BX("adm-zreport-cash-return");if(cashReturn){cashReturn.innerHTML=d.CASH.FORMATED_RETURN_SUM}}if(d.CASHLESS){cashlessNow=BX("adm-zreport-cashless-now");if(cashlessNow){cashlessNow.innerHTML=d.CASHLESS.FORMATED_SUM}cashlessReturn=BX("adm-zreport-cashless-return");if(cashlessReturn){cashlessReturn.innerHTML=d.CASHLESS.FORMATED_RETURN_SUM}}if(d.CUMULATIVE){cumulative=BX("adm-zreport-cumulative");if(cumulative){cumulative.innerHTML=d.CUMULATIVE.FORMATED_SUM}}}},this),onfailure:function(){BX.debug("Set filter error. Can't reload cashbox info")}}),this)}},createZReport:function(){var c=BX("filter_cashbox_id");if(c==undefined||c==null){return}var e=c.children;var b="<div class='adm-info-message'>"+BX.message("CASHBOX_CREATE_ZREPORT_WINDOW_INFO")+"</div>";b+="<table><tbody><tr><td><label>"+BX.message("SALE_F_CASHBOX")+":</label></td><td>";b+="<select id='cashboxListAddReport' class='sale-discount-bus-select'>";for(option in e){if(e[option].value!=undefined){b+="<option value='"+e[option].value+"'>"+e[option].innerHTML+"</option>"}}b+="</select></td></tr></tbody></table>";var d=new BX.CAdminDialog({title:BX.message("CASHBOX_CREATE_ZREPORT_WINDOW_TITLE"),content:b,resizable:false,draggable:true,height:"170",width:"387",buttons:[{title:BX.message("JS_CORE_WINDOW_SAVE"),id:"saveCheckBtn",name:"savebtn",className:top.BX.browser.IsIE()&&top.BX.browser.IsDoctype()&&!top.BX.browser.IsIE10()?"":"adm-btn-save"},{title:top.BX.message("JS_CORE_WINDOW_CANCEL"),id:"cancelCheckBtn",name:"cancel"}]});BX.bind(BX("cancelCheckBtn"),"click",BX.delegate(function(){d.Close();d.DIV.parentNode.removeChild(d.DIV)}),this);BX.bind(BX("saveCheckBtn"),"click",BX.delegate(function(){var f={sessid:BX.bitrix_sessid(),cashboxId:BX("cashboxListAddReport").value,action:"addZReport"};BX.ajax({method:"post",dataType:"json",url:BX.Sale.CashboxReport.ajaxUrl,data:f,onsuccess:function(g){if(g.ERROR&&g.ERROR.length>0){alert(g.ERROR)}else{d.Close();location.reload()}},onfailure:function(){BX.debug("Select params error")}})}),this);d.Show()}};BX.addCustomEvent(a,"onBeforeAdminFilterSet",function(){BX.Sale.CashboxReport.changeCashboxBlocks()});BX.addCustomEvent(a,"onBeforeAdminFilterClear",function(){BX.Sale.CashboxReport.onClearFilter()})})(window);