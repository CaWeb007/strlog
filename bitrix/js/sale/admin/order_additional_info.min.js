BX.namespace("BX.Sale.Admin.OrderAdditionalInfo");BX.Sale.Admin.OrderAdditionalInfo={choosePerson:function(b,a){window.open("/bitrix/admin/user_search.php?lang="+a+"&FN="+b+"&FC=RESPONSIBLE_ID","","scrollbars=yes,resizable=yes,width=840,height=500,top="+Math.floor((screen.height-560)/2-14)+",left="+Math.floor((screen.width-840)/2-5))},changePerson:function(){var b=BX("order_additional_info_responsible"),a=BX("RESPONSIBLE_ID").value;if(b){b.href="/bitrix/admin/user_edit.php?lang="+BX.Sale.Admin.OrderEditPage.languageId+"&ID="+a}var c={action:"changeResponsibleUser",userId:a,siteId:BX.Sale.Admin.OrderEditPage.siteId,callback:function(d){BX.Sale.Admin.OrderAdditionalInfo.setResponsible(d.RESPONSIBLE);BX.Sale.Admin.OrderAdditionalInfo.setEmpResponsible(d.EMP_RESPONSIBLE);BX.Sale.Admin.OrderAdditionalInfo.setDateResponsible(d.DATE_RESPONSIBLE)}};BX.Sale.Admin.OrderAjaxer.sendRequest(c)},setResponsible:function(b){var a=BX("order_additional_info_responsible");if(b){b=BX.util.htmlspecialchars(b)}if(a){BX.html(a,b)}},setEmpResponsible:function(a){var b=BX("order_additional_info_emp_responsible");if(a){a=BX.util.htmlspecialchars(a)}if(b){BX.html(b,a)}},setDateResponsible:function(b){var a=BX("order_additional_info_date_responsible");if(b){b=BX.util.htmlspecialchars(b)}if(a){BX.html(a,b)}},showCommentsDialog:function(a,b){var d=b.innerHTML.replace(new RegExp("<br>","g"),"");var c=new BX.CDialog({content:'<textarea style="width:710px;height:260px;" name="COMMENTS" id="COMMENTS">'+d+"</textarea>",title:BX.message("SALE_ORDER_ADDITIONAL_INFO_COMMENT_EDIT"),width:750,height:300,resizable:true});c.ClearButtons();c.SetButtons([{title:BX.message("SALE_ORDER_ADDITIONAL_INFO_COMMENT_SAVE"),action:function(){var e=BX("COMMENTS");if(e){d=e.value}else{if(d==BX.message("SALE_ORDER_ADDITIONAL_INFO_NO_COMMENT")){d=""}}BX.Sale.Admin.OrderAdditionalInfo.saveComment(d,a,b);this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);BX.addCustomEvent(c,"onWindowClose",function(e){e.DIV.parentNode.removeChild(e.DIV)});c.Show()},saveComment:function(c,a,b){BX.Sale.Admin.OrderAjaxer.sendRequest({action:"saveComments",comments:c,orderId:a,callback:function(d){if(d&&typeof d.COMMENTS!=="undefined"&&b){b.innerHTML=d.COMMENTS.replace(new RegExp("\n","g"),"<br>\n")}}})}};