BX.namespace("BX.Sale.Admin.StepOperations");BX.Sale.Admin.StepOperations.StepOperationsFilter=(function(){var a=function(b){this.useFilter=false;this.filter=[];this.filterFields=[];this.filterValues={};if(!!b.filter&&BX.type.isArray(b.filter)){this.filterFields=b.filter}this.useFilter=this.filterFields.length>0;this.emptyOrders=null;a.superclass.constructor.apply(this,arguments)};BX.extend(a,BX.Catalog.StepOperations);a.prototype.init=function(){var b,c;a.superclass.init.apply(this,arguments);if(this.errorCode===0&&this.useFilter){for(b=0;b<this.filterFields.length;b++){c=BX(this.filterFields[b]);if(!!c){this.filter[this.filter.length]=c}}this.useFilter=this.filter.length>0;if(this.useFilter){for(b=0;b<this.filter.length;b++){switch(this.filter[b].type.toLowerCase()){case"text":case"select-one":BX.bind(this.filter[b],"change",BX.proxy(this.getFilterCounter,this));break}}}this.getFilterCounter();if(BX.type.isNotEmptyString(this.visual.emptyOrdersId)){this.emptyOrders=BX(this.visual.emptyOrdersId)}}};a.prototype.nextStep=function(){if(this.useFilter){this.getFilterValues();this.ajaxParams.filter=this.filterValues}a.superclass.nextStep.apply(this,arguments)};a.prototype.finishOperation=function(){a.superclass.finishOperation.apply(this,arguments);BX.ajax.get(this.url,{sessid:BX.bitrix_sessid(),clearTags:"Y"})};a.prototype.getFilterCounter=function(){var b={sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID"),getCount:"Y"};if(this.useFilter){this.getFilterValues();b.filter=this.filterValues;BX.showWait();this.disableFilterFields();BX.ajax.loadJSON(this.url,b,BX.proxy(this.getFilterCounterResult,this))}};a.prototype.getFilterCounterResult=function(b){BX.closeWait();this.enableFilterFields();if(typeof b==="object"){this.currentState.allCounter=parseInt(b.counter,10);if(isNaN(this.currentState.allCounter)){this.currentState.allCounter=0}this.buttons.start.disabled=(this.currentState.allCounter<=0);if(BX.type.isElementNode(this.emptyOrders)){BX.style(this.emptyOrders,"display",(this.currentState.allCounter<=0?"block":"none"))}}};a.prototype.getFilterValues=function(){var b;if(!this.useFilter){return}this.filterValues={};for(b=0;b<this.filter.length;b++){switch(this.filter[b].type.toLowerCase()){case"text":case"select-one":this.filterValues[this.filter[b].name]=this.filter[b].value;break;default:break}}};a.prototype.enableFilterFields=function(){if(!this.useFilter){return}var b;for(b=0;b<this.filter.length;b++){this.filter[b].disabled=false}};a.prototype.disableFilterFields=function(){if(!this.useFilter){return}var b;for(b=0;b<this.filter.length;b++){this.filter[b].disabled=false}};return a})();