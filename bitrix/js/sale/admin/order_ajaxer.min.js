BX.namespace("BX.Sale.Admin.OrderAjaxer");BX.Sale.Admin.OrderAjaxer={ajaxUrl:"/bitrix/admin/sale_order_ajax.php",sendRequest:function(c,b,e){if(!c){return}if(!b){BX.Sale.Admin.OrderEditPage.blockForm()}var a=c,f=c.callback?c.callback:null;if(a.callback){delete a.callback}if(e){a=this.refreshOrderData.modifyParams(a)}a.sessid=BX.bitrix_sessid();var d={timeout:60,method:"POST",dataType:"json",url:this.ajaxUrl,data:a,onsuccess:function(g){if(g){if(g.NEED_CONFIRM&&g.NEED_CONFIRM==="Y"){BX.Sale.Admin.OrderEditPage.showConfirmDialog(g.CONFIRM.TEXT,g.CONFIRM.TITLE,function(){a.confirmed="Y";d.data=a;BX.ajax(d)})}else{if(f&&typeof f==="function"){f.call(null,g)}}}else{BX.debug("Admin order ajaxer error! Can't receive the result.")}if(g&&g.ERROR){BX.debug("Admin order ajaxer recieved error: "+g.ERROR)}if(g&&g.WARNING){BX.debug("Admin order ajaxer recieved warning: "+g.WARNING)}if(e){BX.Sale.Admin.OrderAjaxer.refreshOrderData.callback(g)}if(!b){BX.Sale.Admin.OrderEditPage.unBlockForm()}},onfailure:function(g){if(!b){BX.Sale.Admin.OrderEditPage.unBlockForm()}if(e){BX.Sale.Admin.OrderAjaxer.refreshOrderData.setFlag(false)}BX.debug("ajax onfailure");BX.debug("status: "+g)}};BX.ajax(d)},refreshOrderData:{flag:false,callback:function(a){if(a){if(a.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(a.ERROR);BX.Sale.Admin.OrderEditPage.rollBack()}else{if(a.ORDER_DATA){BX.Sale.Admin.OrderEditPage.resetRollbackMethods();BX.Sale.Admin.OrderEditPage.callFieldsUpdaters(a.ORDER_DATA)}}}else{BX.debug("Error receiving order data!")}BX.Sale.Admin.OrderAjaxer.refreshOrderData.setFlag(false)},modifyParams:function(a){BX.Sale.Admin.OrderAjaxer.refreshOrderData.setFlag(true);a.formData=BX.Sale.Admin.OrderEditPage.getAllFormData();a.refreshOrderData="Y";return a},setFlag:function(a){BX.Sale.Admin.OrderAjaxer.refreshOrderData.flag=!!a},getFlag:function(){return BX.Sale.Admin.OrderAjaxer.refreshOrderData.flag}}};