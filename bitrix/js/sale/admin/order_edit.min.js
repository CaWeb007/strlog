BX.namespace("BX.Sale.Admin.OrderEditPage");BX.Sale.Admin.OrderEditPage={formId:"",fieldsUpdaters:{},fieldsUpdatersContexts:{},statusesNames:{},orderId:0,languageId:"",siteId:"",currency:"",currencyLang:"",form:null,adminTabControlId:"",discountRefreshTimeoutId:0,autoPriceChange:true,runningCheckTimeout:{},tailsLoaded:false,rollbackMethods:[],getForm:function(){if(!BX.Sale.Admin.OrderEditPage.form){BX.Sale.Admin.OrderEditPage.form=BX(BX.Sale.Admin.OrderEditPage.formId)}return BX.Sale.Admin.OrderEditPage.form},toggleFix:function(a,b){var e=BX(b),c=BX(a);if(!e||!c){return}var d=!BX.hasClass(e,"adm-detail-tabs-block-pin");if(d){BX.addClass(e,"adm-detail-tabs-block-pin");c.title=BX.message("SALE_ORDEREDIT_FIX");BX.UnFix(e)}else{BX.removeClass(e,"adm-detail-tabs-block-pin");c.title=BX.message("SALE_ORDEREDIT_UNFIX");BX.Fix(e,{type:"top"})}d=!d;BX.userOptions.save("sale_admin","sale_order_edit","fix_"+b,(d?"Y":"N"))},setFixHashCorrection:function(){BX.bind(window,"hashchange",function(){var a=0;if(BX.adminPanel&&BX.adminPanel.isFixed()){var b=BX.pos(BX.adminPanel.panel.parentElement);a+=b.height}if(BX.FixOffsets&&BX.FixOffsets.top){a+=BX.FixOffsets.top}if(a>0){window.scrollBy(0,-a)}})},disableSavingButtons:function(a){var c,b,d=["apply","save"];for(c in d){if(!d.hasOwnProperty(c)){continue}b=BX.findChild(document,{attr:{name:d[c]}},true);if(b){b.disabled=a}}},showDialog:function(c,b){var a=new BX.PopupWindow("adm-sale-order-alert-dialog",null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:true,titleBar:b||BX.message("SALE_ORDEREDIT_MESSAGE"),contentColor:"white",content:BX.create("span",{html:c,style:{backgroundColor:"white"}})});a.setButtons([new BX.PopupWindowButton({text:BX.message("SALE_ORDEREDIT_CLOSE"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(function(){a.close();a.destroy()},a)}})]);a.show()},showConfirmDialog:function(e,d,b,c){var a=new BX.PopupWindow("adm-sale-order-alert-dialog",null,{autoHide:false,draggable:true,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:true,titleBar:d||BX.message("SALE_ORDEREDIT_CONFIRM"),contentColor:"white",content:BX.create("span",{html:e,style:{backgroundColor:"white"}})});a.setButtons([new BX.PopupWindowButton({text:BX.message("SALE_ORDEREDIT_CONFIRM_CONTINUE"),className:"popup-window-button-accept",events:{click:function(){if(b&&typeof b=="function"){b.call(null)}a.close();a.destroy()}}}),new BX.PopupWindowButton({text:BX.message("SALE_ORDEREDIT_CONFIRM_ABORT"),className:"popup-window-button-decline",events:{click:function(){if(c&&typeof c=="function"){c.call(null)}a.close();a.destroy()}}})]);a.show()},onSaveStatusButton:function(a,b){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.saveStatus(a,b))},onCancelStatusButton:function(b,a){this.toggleCancelDialog();BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.cancelOrder(b,a,BX("FORM_REASON_CANCELED").value))},getElementValue:function(a){var b=BX(a);if(b&&typeof b.value!="undefined"){return b.value}return""},getAllFormData:function(){var a=this.getForm();if(!a){return{}}var b=BX.ajax.prepareForm(a);return !!b&&b.data?b.data:{}},unRegisterFieldUpdater:function(c,b){if(!this.fieldsUpdaters[c]){return}for(var a=this.fieldsUpdaters[c].length-1;a>=0;a--){if(this.fieldsUpdaters[c][a]==b){delete (this.fieldsUpdaters[c][a])}}},unRegisterProductFieldsUpdaters:function(b){for(var a in this.fieldsUpdaters){if(this.fieldsUpdaters.hasOwnProperty(a)){if(a.indexOf("PRODUCT["+b+"]")!=-1){delete (this.fieldsUpdaters[a])}}}},unRegisterFieldsUpdaters:function(b){for(var a in b){if(b.hasOwnProperty(a)){if(this.fieldsUpdaters[b[a]]){delete (this.fieldsUpdaters[b[a]])}}}},registerFieldsUpdaters:function(b){for(var a in b){if(!b.hasOwnProperty(a)){continue}if(typeof this.fieldsUpdaters[a]=="undefined"){this.fieldsUpdaters[a]=[]}this.fieldsUpdaters[a].push(b[a])}},callFieldsUpdaters:function(d){var b=["DISCOUNTS_LIST","DELIVERY_PRICE","PROPERTIES_ARRAY","BUYER_PROFILES_LIST","BUYER_PROFILES_DATA"],f={};for(var c=0,a=b.length-1;c<=a;c++){var e=b[c];if(typeof d[e]!=="undefined"){this.callConcreteFieldUpdater(e,d[e])}f[e]=true}for(c in d){if(!d.hasOwnProperty(c)){continue}if(f[c]){continue}this.callConcreteFieldUpdater(c,d[c])}},callConcreteFieldUpdater:function(a,c){var d=null,f=null;for(var b in this.fieldsUpdaters[a]){if(!this.fieldsUpdaters[a].hasOwnProperty(b)){continue}var e=this.fieldsUpdaters[a][b];if(e.context&&e.callback){d=e.context;f=e.callback}else{d=null;f=this.fieldsUpdaters[a][b]}if(f&&typeof f=="function"){f.call(d,c)}}},currencyFormat:function(b,a){if(BX.Currency&&BX.Currency.currencyFormat){b=BX.Currency.currencyFormat(b,this.currency,a?false:true)}return b},restoreFormData:function(b){var a=this.getForm();if(!a){BX.debug("BX.Sale.Admin.OrderEditPage:restoreFormData() can't find form");return false}for(var c in b){if(b.hasOwnProperty(c)){if(typeof(a.elements[c])!="undefined"){a.elements[c].value=b[c]}}}return true},createFormBlocker:function(){var c=document.documentElement.scrollHeight,b=document.documentElement.clientHeight,a=Math.max(c,b);return BX.create("div",{props:{className:"bx-core-dialog-overlay",id:"sale-adm-order-form-blocker"},style:{zIndex:"10001",width:"100%",height:a+"px",backgroundColor:"rgba(57,60,67,0.1)"},children:[BX.create("span",{style:{zIndex:"10002",top:"5%",left:"85%",position:"fixed",background:'url("/bitrix/panel/main/images/submenu-bg.png") repeat 0 0',padding:"15px",borderRadius:"5px",fontSize:"14px",border:"4px solid rgb(230, 230, 230)"},html:BX.message("SALE_ORDEREDIT_REFRESHING_DATA")})]})},blockForm:function(){if(BX("sale-adm-order-form-blocker")){return}document.body.appendChild(this.createFormBlocker())},unBlockForm:function(){var a=BX("sale-adm-order-form-blocker");if(a){a.parentNode.removeChild(a)}},toggleCancelDialog:function(){var a=BX("sale-adm-status-cancel-dialog");if(a){BX.toggleClass(a,"active")}},setStatus:function(b){var a=BX("STATUS_ID");if(a){a.value=b}},desktopMakeCall:function(b){var a=BX.browser.IsMobile();BX.Sale.Admin.OrderEditPage.desktopRunningCheck(function(){location.href="bx://callto/phone/"+encodeURIComponent(b)},function(){location.href=(a?"tel:":"callto:")+encodeURIComponent(b)})},desktopRunningCheck:function(b,e){if(typeof(b)=="undefined"){return false}if(typeof(e)=="undefined"){e=function(){}}var d=(+new Date());var a="http://127.0.0.1:20141/";var c=BX.create("img",{attrs:{src:a+"icon.png?"+d,"data-id":d,style:"position:absolute; left: -100px; opacity: 0; width: 1px; height: 1px"},props:{className:"bx-messenger-out-of-view"},events:{error:function(){var f=this.getAttribute("data-id");e(false,f);clearTimeout(BX.Sale.Admin.OrderEditPage.runningCheckTimeout[f]);BX.remove(this)},load:function(){var f=this.getAttribute("data-id");b(true,f);clearTimeout(BX.Sale.Admin.OrderEditPage.runningCheckTimeout[f]);BX.remove(this)}}});document.body.appendChild(c);BX.Sale.Admin.OrderEditPage.runningCheckTimeout[d]=setTimeout(function(){e(false,d);clearTimeout(BX.Sale.Admin.OrderEditPage.runningCheckTimeout[d]);BX.remove(this)},500);return true},changeCancelBlock:function(a,f){var e=BX("sale-adm-status-cancel-blocktext"),d=BX("FORM_REASON_CANCELED"),b=BX("sale-adm-status-cancel-dialog-btn"),c="";if(f.CANCELED=="Y"){c='<div class="adm-s-select-popup-element-selected-bad"><span>'+BX.message("SALE_ORDER_STATUS_CANCELED")+"</span>"+f.DATE_CANCELED+'<a href="/bitrix/admin/user_edit.php?lang='+BX.Sale.Admin.OrderEditPage.languageId+"&ID="+f.EMP_CANCELED_ID+'">'+BX.util.htmlspecialchars(f.EMP_CANCELED_NAME)+"</a></div>";e.style.textAlign="start";d.disabled=true;b.innerHTML=BX.message("SALE_ORDER_STATUS_CANCEL_CANCEL");b.onclick=function(){BX.Sale.Admin.OrderEditPage.onCancelStatusButton(a,"Y")}}else{c='<a href="javascript:void(0);" onclick="BX.Sale.Admin.OrderEditPage.toggleCancelDialog();">'+BX.message("SALE_ORDER_STATUS_CANCELING")+"</a>";e.style.textAlign="center";d.disabled=false;b.innerHTML=BX.message("SALE_ORDER_STATUS_CANCEL");b.onclick=function(){BX.Sale.Admin.OrderEditPage.onCancelStatusButton(a,"N")}}e.innerHTML=c},onRefreshOrderDataAndSave:function(){BX.Sale.Admin.OrderEditPage.blockForm();var a=this.getForm();a.appendChild(BX.create("input",{props:{name:"refresh_data_and_save",type:"hidden",value:"Y"}}));if(BX.Sale.Admin.OrderEditPage.tailsLoaded){a.submit()}else{BX.addCustomEvent("onAfterSaleOrderTailsLoaded",function(){a.submit()})}},onOrderCopy:function(b){BX.Sale.Admin.OrderEditPage.blockForm();var a=this.getForm();a.action=b;a.submit()},createDiscountsNode:function(a,h,d,j,f){var g=null,e,c,b;if(d&&j&&j.DISCOUNT_LIST){c=d.length;if(c>0){g=BX.create("table");for(e=0,c;e<c;e++){if(!d[e]){continue}b=d[e].DISCOUNT_ID;if(j.DISCOUNT_LIST[b]){this.addDiscountItemRow(a,h,d[e],j.DISCOUNT_LIST[b],g,f)}}}}else{g=BX.create("span",{html:"&nbsp;"})}return BX.create("div",{children:[g]})},addDiscountItemRow:function(a,h,k,c,l,g){var m=l.insertRow(-1),d={"data-discount-id":c.DISCOUNT_ID},b,f;if(h=="DISCOUNT_LIST"){d["data-discount"]="Y";d["data-use-coupons"]=(c.USE_COUPONS)}if(h==="BASKET"||h==="DELIVERY"){d["data-coupon-id"]=(k.COUPON_ID?k.COUPON_ID:"-");d["data-discount-target"]="Y"}b="DISCOUNTS["+h+"]"+(a!=""?"["+a+"]":"")+"["+c.DISCOUNT_ID+"]";f=BX.create("input",{props:{type:"checkbox",name:b,checked:k.APPLY=="Y",value:"Y",disabled:(g=="VIEW")},attrs:d});m.appendChild(BX.create("td",{children:[BX.create("input",{props:{type:"hidden",name:b,value:"N"}}),f]}));if(g=="EDIT"){BX.bind(f,"click",function(i){BX.Sale.Admin.OrderEditPage.setDiscountCheckbox(i);BX.Sale.Admin.OrderEditPage.refreshDiscounts()})}var j="";if(typeof k.DESCR=="object"){if(k.DESCR){for(var e in k.DESCR){if(k.DESCR.hasOwnProperty(e)){j+=k.DESCR[e]}}}else{j=BX.message("SALE_ORDEREDIT_DISCOUNT_UNKNOWN")+" %"}}else{j=k.DESCR}m.appendChild(BX.create("td",{html:"<strong>"+j+"</strong>"}));if(c.EDIT_PAGE_URL){m.appendChild(BX.create("td",{children:[BX.create("a",{props:{href:c.EDIT_PAGE_URL,className:"adm-s-detail-content-sale-link"},html:BX.util.htmlspecialchars(c.NAME)})]}))}else{m.appendChild(BX.create("td",{children:[BX.create("span",{html:BX.util.htmlspecialchars(c.NAME)})]}))}return m},setDiscountCheckbox:function(g){var f=g.target,c,b,d,a;if(!!f&&f.hasAttribute("data-discount-id")){if(f.hasAttribute("data-coupon")){c=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":f.getAttribute("data-discount-id"),"data-coupon-id":f.getAttribute("data-discount-coupon")}},true,true);if(c.length>0){for(b=0;b<c.length;b++){c[b].checked=f.checked}}d=false;c=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":f.getAttribute("data-discount-id"),"data-coupon":"Y"}},true,true);if(c.length>0){for(b=0;b<c.length;b++){if(c[b].checked){d=true}}}c=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":f.getAttribute("data-discount-id"),"data-discount":"Y","data-use-coupons":"Y"}},true,false);if(c){c.checked=d}c=null}else{if(f.hasAttribute("data-discount")){c=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":f.getAttribute("data-discount-id")}},true,true);if(c.length>0){for(b=0;b<c.length;b++){c[b].checked=f.checked}}c=null}else{if(f.hasAttribute("data-discount-target")){if(f.checked){c=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":f.getAttribute("data-discount-id"),"data-discount":"Y"}},true,false);if(c){c.checked=true}if(f.hasAttribute("data-coupon-id")){a=f.getAttribute("data-coupon-id");if(a!=""&&a!="-"){c=BX.findChild(BX.Sale.Admin.OrderEditPage.getForm(),{attribute:{"data-discount-id":f.getAttribute("data-discount-id"),"data-discount-coupon":a}},true,false);if(c){c.checked=true}}}c=null}}}}}},onProblemCloseClick:function(a,b){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.unmarkOrder(a,b))},onMarkerCloseClick:function(e,a,c,d,b){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.deleteMarker(e,a,c,d,b))},onMarkerFixErrorClick:function(e,a,c,d,b){BX.Sale.Admin.OrderAjaxer.sendRequest(this.ajaxRequests.fixMarker(e,a,c,d,b))},refreshDiscounts:function(){if(this.discountRefreshTimeoutId>0){return}this.discountRefreshTimeoutId=setInterval(function(){BX.Sale.Admin.OrderAjaxer.sendRequest(BX.Sale.Admin.OrderEditPage.ajaxRequests.refreshOrderData({operation:"DISCOUNTS_REFRESH"}));clearInterval(BX.Sale.Admin.OrderEditPage.discountRefreshTimeoutId);BX.Sale.Admin.OrderEditPage.discountRefreshTimeoutId=0},500)},rollBack:function(){for(var a in BX.Sale.Admin.OrderEditPage.rollbackMethods){if(!BX.Sale.Admin.OrderEditPage.rollbackMethods.hasOwnProperty(a)){continue}var b=BX.Sale.Admin.OrderEditPage.rollbackMethods[a];if(typeof b!=="function"){continue}b.call(b);delete BX.Sale.Admin.OrderEditPage.rollbackMethods[a]}},addRollbackMethod:function(a){BX.Sale.Admin.OrderEditPage.rollbackMethods.push(a)},resetRollbackMethods:function(){BX.Sale.Admin.OrderEditPage.rollbackMethods=[]},enableFormButtons:function(c){var a=BX.findChild(BX(c),{tag:"input",attribute:{name:"apply",type:"submit"}},true),b=BX.findChild(BX(c),{tag:"input",attribute:{name:"save",type:"submit"}},true);if(a){a.disabled=false}if(b){b.disabled=false}},ajaxRequests:{addProductToBasket:function(e,f,b,c,d){var a={action:"addProductToBasket",productId:e,quantity:f,replaceBasketCode:b?b:"",columns:c,callback:BX.Sale.Admin.OrderAjaxer.refreshOrderData.callback};if(d!==false){a.customPrice=d}return BX.Sale.Admin.OrderAjaxer.refreshOrderData.modifyParams(a)},getProductIdBySkuProps:function(a){return{action:"getProductIdBySkuProps",productId:a.productId,iBlockId:a.iBlockId,skuProps:a.skuProps,skuOrder:a.skuOrder,changedSkuId:a.changedSkuId,callback:a.callback}},cancelOrder:function(b,a,c){return{action:"cancelOrder",orderId:b,canceled:a,comment:c,callback:function(d){BX.Sale.Admin.OrderEditPage.unBlockForm();if(d&&!d.ERROR){BX.Sale.Admin.OrderEditPage.changeCancelBlock(b,d)}else{if(d&&d.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDER_STATUS_CANCEL_ERROR")+": "+d.ERROR)}else{BX.debug(BX.message("SALE_ORDER_STATUS_CANCEL_ERROR"))}}}}},saveStatus:function(b,c){var a=BX(c);if(!a){BX.debug("Error getting select object with id: "+c)}if(typeof a.value=="undefined"){BX.debug("Error getting select value id: "+c)}BX("save_status_result_ok").style.display="none";return{action:"saveStatus",orderId:b,statusId:a.value,callback:function(d){var e;d.CAN_USER_EDIT="Y";if(d&&d.CAN_USER_EDIT&&!d.ERROR){BX.Sale.Admin.OrderEditPage.callFieldsUpdaters({STATUS_ID:a.value});BX.Sale.Admin.OrderEditPage.disableSavingButtons(d.CAN_USER_EDIT!="Y");BX("save_status_result_ok").style.display=""}else{if(d&&d.ERROR){e=BX.message("SALE_ORDER_STATUS_CHANGE_ERROR")+": "+d.ERROR}else{e=BX.message("SALE_ORDER_STATUS_CHANGE_ERROR")}}if(e){BX.Sale.Admin.OrderEditPage.showDialog(e)}}}},getOrderFields:function(b,a){return{action:"getOrderFields",givenFields:b.givenFields,demandFields:b.demandFields,callback:function(c){if(c&&c.RESULT_FIELDS&&!c.ERROR){BX.Sale.Admin.OrderEditPage.callFieldsUpdaters(c.RESULT_FIELDS);if(a){BX.Sale.Admin.OrderAjaxer.sendRequest(BX.Sale.Admin.OrderEditPage.ajaxRequests.refreshOrderData())}}else{if(c&&c.ERROR){BX.debug("Error receiving fields: "+c.ERROR)}else{BX.debug("Error receiving fields!")}}}}},refreshOrderData:function(a){if(!BX.Sale.Admin.OrderAjaxer.refreshOrderData.getFlag()){return BX.Sale.Admin.OrderAjaxer.refreshOrderData.modifyParams({action:"refreshOrderData",additional:a,callback:BX.Sale.Admin.OrderAjaxer.refreshOrderData.callback})}},unmarkOrder:function(a,b){return{action:"unmarkOrder",orderId:a,callback:function(c){BX.Sale.Admin.OrderEditPage.unBlockForm();if(c&&!c.ERROR){BX(b).style.display="none"}else{if(c&&c.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDEREDIT_UNMARK_ERROR")+": "+c.ERROR)}else{BX.debug(BX.message("SALE_ORDEREDIT_UNMARK_ERROR"))}}}}},getOrderTails:function(a,c,b){return{action:"getOrderTails",orderId:a,formType:c,idPrefix:b,callback:function(d){if(d&&!d.ERROR){BX.Sale.Admin.OrderEditPage.callFieldsUpdaters(d);var f;if(typeof d.ANALYSIS!="undefined"){f=BX("sale-adm-order-analysis-content");if(f){f.innerHTML=d.ANALYSIS}}if(typeof d.SHIPMENTS!="undefined"){f=BX("sale-adm-order-shipments-content");if(f){var g=BX.processHTML(d.SHIPMENTS);BX.loadCSS(g.STYLE);f.innerHTML=g.HTML;for(var e in g.SCRIPT){BX.evalGlobal(g.SCRIPT[e]["JS"])}}}}else{if(d&&d.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(d.ERROR)}else{BX.debug("Can't order view tails")}}BX.Sale.Admin.OrderEditPage.tailsLoaded=true;BX.onCustomEvent("onAfterSaleOrderTailsLoaded",[d])}}},deleteMarker:function(e,a,c,d,b){return{action:"deleteMarker",markerId:e,orderId:a,entityId:d,forEntity:b?"Y":"N",callback:function(f){BX.Sale.Admin.OrderEditPage.unBlockForm();if(f&&!f.ERROR){if(f.WARNING&&f.WARNING.length>0){BX.Sale.Admin.OrderEditPage.showDialog(f.WARNING)}else{BX(c).style.display="none"}if(typeof f.MARKERS!="undefined"){var g=BX("sale-adm-order-problem-block");if(g){g.innerHTML=f.MARKERS}}}else{if(f&&f.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDEREDIT_UNMARK_ERROR")+": "+f.ERROR)}else{BX.debug(BX.message("SALE_ORDEREDIT_UNMARK_ERROR"))}}}}},fixMarker:function(e,a,c,d,b){return{action:"fixMarker",markerId:e,orderId:a,entityId:d,forEntity:b?"Y":"N",callback:function(f){BX.Sale.Admin.OrderEditPage.unBlockForm();if(f&&!f.ERROR){if(f.WARNING&&f.WARNING.length>0){BX.Sale.Admin.OrderEditPage.showDialog(f.WARNING)}else{BX(c).style.display="none"}if(typeof f.MARKERS!="undefined"){var g=BX("sale-adm-order-problem-block");if(g){g.innerHTML=f.MARKERS}}}else{if(f&&f.ERROR){BX.Sale.Admin.OrderEditPage.showDialog(BX.message("SALE_ORDEREDIT_UNMARK_ERROR")+": "+f.ERROR)}else{BX.debug(BX.message("SALE_ORDEREDIT_UNMARK_ERROR"))}}}}}},fastNavigation:{lastMarkedItemId:null,onClickItem:function(formId,tabId,locationHash){eval(formId+".SelectTab('"+tabId+"')");setTimeout(function(){window.location.hash=locationHash},600)},markItem:function(){if(!BX.Sale.Admin.OrderEditPage.fastNavigation.isFixed()){return}var b=100;var e=BX.GetWindowScrollPos().scrollTop+BX.FixOffsets.top+b,d=BX.findChildren(BX("adm-workarea"),{className:"adm-sale-fastnav-anchor"},true),a=false;for(var c in d){if(!d.hasOwnProperty(c)){continue}var f=BX.pos(d[c].nextElementSibling);if(f.top<=e&&f.bottom>=e){if(this.lastMarkedItemId!=d[c].id){BX.addClass(BX("nav_"+d[c].id),"selected");this.lastMarkedItemId=d[c].id;a=true}}else{if(a||this.lastMarkedItemId==d[c].id){BX.removeClass(BX("nav_"+d[c].id),"selected");if(this.lastMarkedItemId==d[c].id){this.lastMarkedItemId=null}}}}},isFixed:function(){return !BX.hasClass("sale-order-edit-block-fast-nav","adm-detail-tabs-block-pin")}}};