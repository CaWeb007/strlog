BX.namespace("BX.Sale.Admin.OrderBasket.SettingsDialog");BX.Sale.Admin.OrderBasket.SettingsDialog=function(a){this.basket=a.basket;this.idPrefix=this.basket.idPrefix||"sale_order_basket";this.formId=this.idPrefix+"_settings_dialog_form";this.contentId=this.idPrefix+"columns_form";this.dialog=this.create();this.form=null;this.columnsLimit=21};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getForm=function(){if(!this.form){this.form=BX(this.formId)}return this.form};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.unselectExcessFields=function(d){if(!d||!d.options||d.options.length<=this.columnsLimit){return false}var b=this.columnsLimit-d.form.columns.options.length;var e=0;for(var c=0,a=d.options.length;c<a;c++){if(!d.options[c].selected){continue}d.options[c].selected=(b>=e++)}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.unselectUnRemovableFields=function(d){if(this.basket.unRemovableFields.length<=0){return false}for(var c=0,b=d.options.length;c<b;c++){if(!d.options[c].selected){continue}for(var e=0,a=this.basket.unRemovableFields.length;e<a;e++){if(d.options[c].value==this.basket.unRemovableFields[e]){d.options[c].selected=false}}}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.isUnRemovableFieldSelected=function(d){if(this.basket.unRemovableFields.length<=0){return false}for(var c=0,b=d.options.length;c<b;c++){if(!d.options[c].selected){continue}for(var e=0,a=this.basket.unRemovableFields.length;e<a;e++){if(d.options[c].value==this.basket.unRemovableFields[e]){return true}}}return false};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onSelectedChange=function(a){if(a.selectedIndex==-1){a.form.up_btn.disabled=true;a.form.down_btn.disabled=true;a.form.del_btn.disabled=true}else{this.unselectUnRemovableFields(a);a.form.up_btn.disabled=false;a.form.down_btn.disabled=false;a.form.del_btn.disabled=false}};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onAvailableChange=function(a){if(a.selectedIndex==-1){a.form.add_btn.disabled=true}else{this.unselectExcessFields(a);a.form.add_btn.disabled=false}};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.create=function(){var a=new BX.CDialog({content:'<form id="'+this.formId+'" name="'+this.formId+'"></form>',title:BX.message("SALE_ORDER_BASKET_JS_SETTINGS_TITLE"),width:850,height:350,resizable:false});this.setButtons(a);var c=BX(this.formId),b=BX(this.contentId);if(c&&b){c.appendChild(b)}return a};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.show=function(){var a=BX("adm-sale-basket-sett-all-cols"),b;BX.bind(a,"mousedown",function(){b=BX.GetWindowScrollPos()});BX.bind(a,"focus",function(){window.scrollTo(b.scrollLeft,b.scrollTop)});this.dialog.Show()};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.setButtons=function(a){var b=this;a.ClearButtons();a.SetButtons([{title:BX.message("SALE_ORDER_BASKET_JS_SETTINGS_APPLY"),name:"apply",action:function(){BX.showWait();b.save(b.getVisibleColumns());this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel])};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.changeColumns=function(){console.log("changeColumns");BX.closeWait()};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.onAddColumn=function(){console.log("addColumn");jsSelectUtils.addSelectedOptions(this.form.allColumns,this.form.columns,false);jsSelectUtils.deleteSelectedOptions(this.form.allColumns)};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.save=function(a){BX.Sale.Admin.OrderEditPage.blockForm();BX.Sale.Admin.OrderAjaxer.sendRequest({action:"saveBasketVisibleColumns",columns:a,idPrefix:this.idPrefix,callback:function(b){if(b&&b.RESULT&&b.RESULT=="OK"){var c=BX.Sale.Admin.OrderEditPage.getForm();c.submit()}else{if(b&&b.ERROR){BX.debug("Error saving settings: "+b.ERROR)}else{BX.debug("Error saving settings!")}}}})};BX.Sale.Admin.OrderBasket.SettingsDialog.prototype.getVisibleColumns=function(){var e=this.getForm(),b=[],a=e.elements.columns;for(var d=0,c=a.options.length;d<c;d++){b.push(a.options[d].value)}return b};