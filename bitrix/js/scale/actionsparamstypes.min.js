(function(a){if(BX.Scale.ActionsParamsTypes){return}BX.Scale.ActionsParamsTypes={};BX.Scale.ActionsParamsTypes.Proto={init:function(b,c){this.id=b;this.domNodeId="action_user_param_"+b;this.domNode=null;this.name=c.NAME;this.defaultValue=c.DEFAULT_VALUE;this.required=c.REQUIRED;this.type=c.TYPE;this.title=c.TITLE?c.TITLE:"";this.pattern=c.PATTERN?c.PATTERN:""},createDomNode:function(){},getDomNode:function(){return this.domNode},getValue:function(){var b=false;if(this.domNode&&this.domNode.value!==undefined){b=this.domNode.value}return b}};BX.Scale.ActionsParamsTypes.String=function(b,c){this.init(b,c);this.createDomNode=function(){var e=this.type=="PASSWORD"?"password":"text",f=this;this.domNode=BX.create("INPUT",{props:{id:this.domNodeId,name:this.domNodeId,type:e}});if(this.title){this.domNode.title=this.title}if(this.pattern){var d=new RegExp(this.pattern);BX.bind(this.domNode,"keypress",function(h){var g=h.which||h.keyCode;if(!d.test(String.fromCharCode(g))){if(h.preventDefault){h.preventDefault()}else{h.returnValue=false}}})}if(this.defaultValue!==undefined){this.domNode.value=this.defaultValue}if(this.required!==undefined&&this.required=="Y"){this.domNode.onkeyup=this.domNode.oninput=this.domNode.onpaste=this.domNode.oncut=this.domNode.onblur=function(h){var g=f.isEmpty();BX.onCustomEvent("BXScaleActionParamKeyUp",[{paramId:f.id,empty:g}])}}};this.isEmpty=function(){return(this.domNode.value.length<=0)};this.createDomNode()};BX.Scale.ActionsParamsTypes.String.prototype=BX.Scale.ActionsParamsTypes.Proto;BX.Scale.ActionsParamsTypes.Checkbox=function(b,c){this.init(b,c);this.checked=c.CHECKED=="Y"||this.defaultValue=="Y";this.string=c.STRING||"";this.createDomNode=function(){this.domNode=BX.create("INPUT",{props:{id:this.domNodeId,name:this.domNodeId,type:"checkbox",checked:this.checked}})};this.getValue=function(){var e=BX(this.domNodeId),d=false;if(e&&e.checked!==undefined){d=e.checked?this.string:""}return d};this.createDomNode()};BX.Scale.ActionsParamsTypes.Checkbox.prototype=BX.Scale.ActionsParamsTypes.Proto;BX.Scale.ActionsParamsTypes.Dropdown=function(b,c){this.init(b,c);this.values=c.VALUES;this.createDomNode=function(){this.domNode=BX.create("SELECT",{props:{id:this.domNodeId,name:this.domNodeId}});for(var d in this.values){var e=BX.create("OPTION");e.appendChild(document.createTextNode(this.values[d]));e.setAttribute("value",d);if(this.defaultValue){e.defaultSelected=true;e.selected=true}this.domNode.appendChild(e)}};this.getValue=function(){var d=false;if(this.domNode.selectedIndex!=-1){d=this.domNode.options[this.domNode.selectedIndex].value}return d};this.createDomNode()};BX.Scale.ActionsParamsTypes.Dropdown.prototype=BX.Scale.ActionsParamsTypes.Proto;BX.Scale.ActionsParamsTypes.Text=function(b,c){this.init(b,c);this.createDomNode=function(){this.domNode=BX.create("DIV");this.textNode=BX.create("SPAN",{html:this.defaultValue});this.inputNode=BX.create("INPUT",{props:{id:this.domNodeId,name:this.domNodeId,type:"hidden"}});if(this.defaultValue!==undefined){this.inputNode.value=this.defaultValue}this.domNode.appendChild(this.inputNode);this.domNode.appendChild(this.textNode)};this.getValue=function(){var d=false;if(this.inputNode&&this.inputNode.value!==undefined){d=this.inputNode.value}return d};this.createDomNode()};BX.Scale.ActionsParamsTypes.Text.prototype=BX.Scale.ActionsParamsTypes.Proto;BX.Scale.ActionsParamsTypes.File=function(b,c){this.remotePaths=[];this.init(b,c);this.createDomNode=function(){this.domNode=BX.create("INPUT",{props:{id:this.domNodeId,name:this.domNodeId,type:"file"}});var d=this;BX.bind(this.domNode,"change",function(){var f=d.domNode.files,g=new FormData();for(var e=0;e<f.length;e++){g.append(d.name,f[e],f[e].name)}g.append("params[operation]","upload_files");g.append("sessid",BX.bitrix_sessid());var h=new XMLHttpRequest();h.open("POST","/bitrix/admin/scale_ajax.php",true);h.onload=function(){if(h.status===200){if(h.response){var k=JSON.parse(h.response);if(k){if(k.RESULT&&k.RESULT=="OK"){d.remotePaths=[];if(k.FILES&&k.FILES.length){for(var m=0,j=k.FILES.length;m<j;m++){d.remotePaths.push(k.FILES[m])}BX.onCustomEvent(d.domNode,"BXScaleActionFileGetRemotePaths",[{id:d.id,remotePaths:d.remotePaths}])}}else{if(k.ERROR){BX.Scale.AdminFrame.alert(k.ERROR,"File uploading error")}}}else{BX.Scale.AdminFrame.alert("Can't parse server answer to json: "+h.response,"Json parsing error")}}}else{BX.Scale.AdminFrame.alert("Can't upload file(s). Status = "+h.status+" ("+h.statusText+")")}};h.send(g)})};this.isEmpty=function(){return(this.domNode.value.length<=0)};this.getValue=function(){return this.remotePaths};this.createDomNode()};BX.Scale.ActionsParamsTypes.File.prototype=BX.Scale.ActionsParamsTypes.Proto;BX.Scale.ActionsParamsTypes.RemoteAndLocalPath=function(b,c){this.init(b,c);this.createDomNode=function(){this.remotePath=new BX.Scale.ActionsParamsTypes.String(b,c);this.localFile=new BX.Scale.ActionsParamsTypes.File(b+"_lf",c);BX.addCustomEvent(this.localFile.domNode,"BXScaleActionFileGetRemotePaths",BX.proxy(function(d){if(d.remotePaths&&d.remotePaths.length){this.remotePath.domNode.value=d.remotePaths.pop()}},this));this.domNode=BX.create("SPAN",{props:{id:b}});this.domNode.appendChild(this.remotePath.domNode);this.domNode.appendChild(BX.create("SPAN",{html:"&nbsp;"}));this.domNode.appendChild(this.modifyFileInput(this.localFile.domNode));if(this.defaultValue!==undefined){this.remotePath.value=this.defaultValue}};this.modifyFileInput=function(e){var d=BX.adminFormTools.modifyFile(e);d.firstChild.innerHTML=BX.message("SCALE_PANEL_JS_LOAD_FILE");d.style.marginLeft="10px";return d};this.getValue=function(){return this.remotePath.getValue()};this.createDomNode()};BX.Scale.ActionsParamsTypes.RemoteAndLocalPath.prototype=BX.Scale.ActionsParamsTypes.Proto})(window);