(function(a){if(BX.Scale.ActionParamsDialog){return}BX.Scale.ActionParamsDialog=function(b){this.title=b.title;this.userParams=b.userParams;this.serverHostname=b.serverHostname;this.callback=b.callback;this.context=b.context;this.dialogWindow=null;this.params={};this.requiredParamsEmptyty={};this.startButtonId="butt_action_start";this.startButtonDisabled=false;this.confirmParams={}};BX.Scale.ActionParamsDialog.prototype.show=function(){var b=this.buildContent();BX.Scale.currentActionDialogContext=this;this.dialogWindow=new BX.CDialog({title:this.title,content:b,resizable:true,buttons:[{title:BX.message("SCALE_PANEL_JS_APD_BUT_START"),id:this.startButtonId,name:this.startButtonId,className:"adm-btn-save",action:BX.proxy(this.returnParamsValues,BX.Scale.currentActionDialogContext)},BX.CAdminDialog.btnCancel]});BX.addCustomEvent(this.dialogWindow,"onWindowClose",function(c){c.DIV.parentNode.removeChild(c.DIV)});if(!BX.Scale.isObjEmpty(this.requiredParamsEmptyty)){this.disableStartButton()}this.dialogWindow.adjustSizeEx();this.dialogWindow.Show()};BX.Scale.ActionParamsDialog.prototype.buildContent=function(){var g=BX.create("DIV"),b=BX.create("form",{props:{id:"action_params_dialog_form"}}),c=BX.create("table");for(var e in this.userParams){if(!this.userParams.hasOwnProperty(e)){continue}switch(this.userParams[e].TYPE){case"STRING":case"PASSWORD":this.params[e]=new BX.Scale.ActionsParamsTypes.String(e,this.userParams[e]);if(this.userParams[e].VERIFY_TWICE=="Y"){var d={};for(var f in this.userParams[e]){d[f]=this.userParams[e][f]}d.NAME+=" ("+BX.message("SCALE_PANEL_JS_APD_2_CONFIRM")+")";this.confirmParams[e]=new BX.Scale.ActionsParamsTypes.String(e+"_confirm",d)}break;case"CHECKBOX":this.params[e]=new BX.Scale.ActionsParamsTypes.Checkbox(e,this.userParams[e]);break;case"DROPDOWN":this.params[e]=new BX.Scale.ActionsParamsTypes.Dropdown(e,this.userParams[e]);break;case"TEXT":this.params[e]=new BX.Scale.ActionsParamsTypes.Text(e,this.userParams[e]);break;case"FILE":this.params[e]=new BX.Scale.ActionsParamsTypes.File(e,this.userParams[e]);break;case"REMOTE_AND_LOCAL_PATH":this.params[e]=new BX.Scale.ActionsParamsTypes.RemoteAndLocalPath(e,this.userParams[e]);break}if(this.params[e]){c.appendChild(this.createParamNodeRaw(this.params[e]))}if(this.confirmParams[e]){c.appendChild(this.createParamNodeRaw(this.confirmParams[e]))}}b.appendChild(c);g.appendChild(b);BX.addCustomEvent("BXScaleActionParamKeyUp",BX.proxy(this.onParamFieldKeyUp,this));return g};BX.Scale.ActionParamsDialog.prototype.createParamNodeRaw=function(b){if(!BX.type.isElementNode(b.domNode)){return false}var d=BX.create("tr"),c=BX.create("span",{props:{innerHTML:b.name+": "}});if(b.required!==undefined&&b.required=="Y"){BX.addClass(c,"adm-required-field");if(!b.defaultValue||b.defaultValue.length<=0){this.requiredParamsEmptyty[b.id]=true}else{this.requiredParamsEmptyty[b.id]=false}}var e=b.domNode;if(b.domNode.type=="file"){e=BX.adminFormTools.modifyFile(e)}var f=BX.create("td",{style:{textAlign:"right",width:"40%"}});f.appendChild(c);d.appendChild(f);f=BX.create("td",{style:{textAlign:"left",width:"60%"}});f.appendChild(e);d.appendChild(f);return d};BX.Scale.ActionParamsDialog.prototype.isAllRequiredParamsFilled=function(){var b=true;for(var c in this.requiredParamsEmptyty){if(this.requiredParamsEmptyty[c]){b=false;break}}return b};BX.Scale.ActionParamsDialog.prototype.enableStartButton=function(){this.disableStartButton(true)};BX.Scale.ActionParamsDialog.prototype.disableStartButton=function(d){var b=BX(this.startButtonId);if(b&&b.disabled!==undefined){var c=!(d);b.disabled=c;this.startButtonDisabled=c}};BX.Scale.ActionParamsDialog.prototype.onParamFieldKeyUp=function(b){if(this.requiredParamsEmptyty[b.paramId]!==undefined){this.requiredParamsEmptyty[b.paramId]=b.empty;if(this.isAllRequiredParamsFilled()==this.startButtonDisabled){this.disableStartButton(this.startButtonDisabled)}}this.addSitePatch(b)};BX.Scale.ActionParamsDialog.prototype.returnParamsValues=function(){var e={},f,c;for(var b in this.params){if(!this.params.hasOwnProperty(b)){continue}f=this.params[b].getValue();if(this.confirmParams[b]){c=this.confirmParams[b].getValue();if(f!=c){var d=BX.message("SCALE_PANEL_JS_APD_2_NOT_CONCIDE");d=d.replace("##FIELD1##",this.params[b].name);d=d.replace("##FIELD2##",this.confirmParams[b].name);BX.Scale.AdminFrame.alert(d,BX.message("SCALE_PANEL_JS_WARNING"));return false}}e[b]=f}this.dialogWindow.Close();if(typeof this.callback=="function"){this.callback.call(this.context,{userParams:e,serverHostname:this.serverHostname})}return e};BX.Scale.ActionParamsDialog.prototype.addSitePatch=function(c){if(c.paramId!=="SITE_NAME"){return}var b=BX("action_user_param_SITE_NAME").value;BX("action_user_param_SITE_PATH").value=b}})(window);