function JCIBlockGenerator(a){if(!a){return}this.intERROR=0;this.intIMAGE_ROW_ID=0;this.PREFIX=a.PREFIX;this.PREFIX_TR=this.PREFIX+"ROW_";this.PROP_COUNT_ID=a.PROP_COUNT_ID;this.TABLE_PROP_ID=a.TABLE_PROP_ID;this.AR_ALL_PROPERTIES=a.AR_ALL_PROPERTIES;this.AR_FILE_PROPERTIES=a.AR_FILE_PROPERTIES;this.IMAGE_TABLE_ID=a.IMAGE_TABLE_ID;this.CELLS=[];this.CELL_CENT=[];this.PROPERTY_MAP=[];this.CHECKED_MAP=[];this.SELECTED_PROPERTIES=[];this.lockProperties=false;BX.ready(BX.proxy(this.Init,this))}JCIBlockGenerator.prototype.Init=function(){var b,c,a;this.PROP_TBL=BX(this.TABLE_PROP_ID);if(!this.PROP_TBL){this.intERROR=-1;return}this.PROP_COUNT=BX(this.PROP_COUNT_ID);if(!this.PROP_COUNT){this.intERROR=-1;return}for(b=0;b<this.AR_ALL_PROPERTIES.length;b++){c=[];if(this.AR_ALL_PROPERTIES[b].hasOwnProperty("VALUE")){for(a=0;a<this.AR_ALL_PROPERTIES[b]["VALUE"].length;a++){c[this.AR_ALL_PROPERTIES[b]["VALUE"][a]["ID"]]=(this.AR_ALL_PROPERTIES[b]["VALUE"][a]["VALUE"])}}this.PROPERTY_MAP[this.AR_ALL_PROPERTIES[b]["ID"]]=(c);this.CHECKED_MAP[this.AR_ALL_PROPERTIES[b]["ID"]]=[]}};JCIBlockGenerator.prototype.addPropertyTable=function(d){if(0>this.intERROR||BX("property_table"+d)){return}this.PROP_TBL=BX(this.TABLE_PROP_ID);var b=Number(BX("generator_property_table_max_id").value);if(b&&b<this.AR_ALL_PROPERTIES.length&&b>0){this.PROP_TBL.appendChild(BX.create("div",{props:{id:"property_separator_"+d,className:"adm-shop-table-increase"}}))}var c=BX.create("div",{props:{id:"property_td_"+d,className:"adm-shop-table-wrap"},style:{verticalAlign:"top"},children:[BX.create("table",{props:{className:"adm-shop-table",id:"property_table"+d},children:[BX.create("tr",{props:{className:"adm-shop-table-title"},children:[BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("span",{text:this.AR_ALL_PROPERTIES[d]["NAME"]})]}),BX.create("td",{props:{className:"adm-shop-table-cell"}}),BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("span",{props:{className:"adm-shop-del-btn"},events:{click:(function(e){return function(){e.deleteTd(d)}})(this)}})]})]}),BX.create("tr",{props:{className:"adm-shop-table-header"},children:[BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("span",{text:BX.message("IB_SEG_TITLE")})]}),BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("span",{text:BX.message("IB_SEG_SORT")})]}),BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("input",{props:{type:"checkbox",id:"checked_all_"+d,checked:false,className:"adm-designed-checkbox"},events:{click:(function(e){return function(){e.checkboxManage(this,d)}})(this)}}),BX.create("label",{props:{className:"adm-designed-checkbox-label",htmlFor:"checked_all_"+d}})]})]})]})]});this.PROP_TBL.appendChild(c);BX("generator_property_table_max_id").value=Number(BX("generator_property_table_max_id").value)+1;this.AR_ALL_PROPERTIES[d]["USE"]="N";this.CHECKED_MAP[this.AR_ALL_PROPERTIES[d]["ID"]]=[];if(BX("property_table"+d)&&this.AR_ALL_PROPERTIES[d]["VALUE"]){for(var a=0;a<this.AR_ALL_PROPERTIES[d]["VALUE"].length;a++){BX("property_table"+d).appendChild(BX.create("tr",{children:[BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("span",{text:this.AR_ALL_PROPERTIES[d]["VALUE"][a]["VALUE"]}),BX.create("input",{props:{type:"hidden",id:"property_value_"+d,name:"PROPERTY_VALUE["+this.AR_ALL_PROPERTIES[d]["VALUE"][a]["PROPERTY_ID"]+"]["+this.AR_ALL_PROPERTIES[d]["VALUE"][a]["ID"]+"]",value:this.AR_ALL_PROPERTIES[d]["VALUE"][a]["ID"]}})]}),BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("span",{text:this.AR_ALL_PROPERTIES[d]["VALUE"][a]["SORT"]})]}),BX.create("td",{props:{className:"adm-shop-table-cell"},children:[BX.create("input",{props:{type:"checkbox",id:"PROPERTY_CHECK_"+this.AR_ALL_PROPERTIES[d]["VALUE"][a]["PROPERTY_ID"]+"_"+a,checked:false,name:"PROPERTY_CHECK["+this.AR_ALL_PROPERTIES[d]["VALUE"][a]["PROPERTY_ID"]+"]["+this.AR_ALL_PROPERTIES[d]["VALUE"][a]["ID"]+"]",className:"adm-designed-checkbox property_value_checkbox"+d},events:{change:(function(e){return function(){e.checkboxMapManage(this)}})(this)}}),BX.create("label",{props:{className:"adm-designed-checkbox-label",htmlFor:"PROPERTY_CHECK_"+this.AR_ALL_PROPERTIES[d]["VALUE"][a]["PROPERTY_ID"]+"_"+a}})]})]}))}}};JCIBlockGenerator.prototype.deleteTd=function(f){var e=BX("property_td_"+f),b=BX("property_table"+f).parentNode.previousSibling,c=BX("property_table"+f).parentNode.nextSibling;if(b){var a=BX("property_table"+f).parentNode.previousSibling.className=="adm-shop-table-increase"}if(c){var d=BX("property_table"+f).parentNode.nextSibling.className=="adm-shop-table-increase"}if(e){this.AR_ALL_PROPERTIES[f]["USE"]="N";delete this.CHECKED_MAP[this.AR_ALL_PROPERTIES[f]["ID"]];if(a){b.parentNode.removeChild(b)}else{if(d){c.parentNode.removeChild(c)}}e.parentNode.removeChild(e);BX("generator_property_table_max_id").value=Number(BX("generator_property_table_max_id").value)-1}};JCIBlockGenerator.prototype.loadAllProperties=function(){var d,a;if(!this.lockProperties){for(var c=0;c<this.AR_ALL_PROPERTIES.length;c++){if(d=BX("property_table"+c)){for(var b=0;b<d.children.length;b++){a=d.children[b].getElementsByTagName("input")}}this.addPropertyTable(c)}}};JCIBlockGenerator.prototype.checkboxManage=function(c,d){var b=document.getElementsByClassName("property_value_checkbox"+d),a;this.AR_ALL_PROPERTIES[d]["USE"]=(c.checked?"Y":"N");if(b){for(a=0;a<b.length;a++){b[a].checked=c.checked;this.checkboxMapManage(b[a])}}};JCIBlockGenerator.prototype.checkboxMapManage=function(j){var m=j.name;var l=j.className;var k=document.getElementsByClassName(l);var b=/\[([0-9a-zA-Z]+)\]/g;var f=/([0-9]+)/g;var a=m.match(b)[0].match(/[0-9a-zA-Z]+/g)[0];var d=m.match(b)[1].match(/[0-9a-zA-Z]+/g)[0];var c=l.match(f);var h=0;if(j.checked){this.CHECKED_MAP[a][d]="Y";this.AR_ALL_PROPERTIES[c]["USE"]="Y"}else{for(var g in k){if(k.hasOwnProperty(g)){if(k[g].type=="checkbox"&&!k[g].checked){h++}}}if(h==k.length){this.AR_ALL_PROPERTIES[c]["USE"]="N"}delete this.CHECKED_MAP[a][d]}};JCIBlockGenerator.prototype.addPropertyImages=function(){this.disableControls();var a={PROPERTY_CHECK:this.CHECKED_MAP,PROPERTY_VALUE:this.PROPERTY_MAP,AJAX_MODE:"Y",sessid:BX.bitrix_sessid()};BX.showWait("ib_seg_add_images_button");BX.ajax.post("/bitrix/admin/iblock_subelement_generator.php",a,BX.proxy(this.fPropertyImagesResult,this))};JCIBlockGenerator.prototype.fPropertyImagesResult=function(result){BX.closeWait();if(result.length>0){if(!BX("image_table_thead")){this.addImageTableHead()}else{BX("image_table_thead").style.display="table-row"}var objMap=eval(result);this.addImageTableRow(objMap)}};JCIBlockGenerator.prototype.addImageTableHead=function(){var e=BX(this.IMAGE_TABLE_ID),f=e.appendChild(BX.create("tr",{props:{id:"image_table_thead",className:"heading"},children:[BX.create("td")]})),a=[];for(var c=0;c<this.AR_ALL_PROPERTIES.length;c++){if(this.AR_ALL_PROPERTIES[c].hasOwnProperty("VALUE")&&(typeof this.AR_ALL_PROPERTIES[c]=="object")&&(this.AR_ALL_PROPERTIES[c]!==null)&&(this.AR_ALL_PROPERTIES[c]["USE"]!=="N")){f.appendChild(BX.create("td",{text:this.AR_ALL_PROPERTIES[c]["NAME"]}))}}for(var b in this.SELECTED_PROPERTIES){if(!this.SELECTED_PROPERTIES.hasOwnProperty(b)){continue}if(BX.util.in_array(this.SELECTED_PROPERTIES[b],a)){continue}if(this.SELECTED_PROPERTIES[b]=="DETAIL"){f.appendChild(BX.create("td",{text:BX.message("IB_SEG_DETAIL")}))}if(this.SELECTED_PROPERTIES[b]=="ANNOUNCE"){f.appendChild(BX.create("td",{text:BX.message("IB_SEG_ANNOUNCE")}))}for(var d in this.AR_FILE_PROPERTIES){if(this.AR_FILE_PROPERTIES.hasOwnProperty(d)){if(this.AR_FILE_PROPERTIES[d]["ID"]==this.SELECTED_PROPERTIES[b]){f.appendChild(BX.create("td",{text:this.AR_FILE_PROPERTIES[d]["NAME"]}))}}}a[a.length]=this.SELECTED_PROPERTIES[b]}};JCIBlockGenerator.prototype.addImageTableRow=function(a){var h=BX(this.IMAGE_TABLE_ID),e,b=[],g,c;for(g in a){if(a.hasOwnProperty(g)){c=a[g]}}this.intIMAGE_ROW_ID=0;if(BX("ib_seg_max_image_row_id")){this.intIMAGE_ROW_ID=BX("ib_seg_max_image_row_id").value;BX("ib_seg_max_image_row_id").value=Number(BX("ib_seg_max_image_row_id").value)+1}if(BX("image_table_tbody")){e=BX("image_table_tbody")}else{e=h.appendChild(BX.create("tbody",{props:{id:"image_table_tbody"}}))}var k=e.appendChild(BX.create("tr",{props:{id:"ib_seg_image_row_"+this.intIMAGE_ROW_ID,className:"ib_seg_image_row"}}));k.appendChild(BX.create("td",{children:[BX.create("div",{props:{className:"adm-shop-del-btn"},style:{marginLeft:"5px"},events:{click:(function(){return function(){var n=this.parentNode.parentNode;n.style.display="none";n.className+="_hidden";var l=n.getElementsByTagName("select");for(var i in l){if(l.hasOwnProperty(i)&&!isNaN(i)){l[i].appendChild(BX.create("OPTION",{props:{value:-2},text:"-2"}));l[i].value=-2}}var m=BX("image_table_tbody").querySelectorAll("tr.ib_seg_image_row");if(m.length==0&&BX("image_table_thead")){BX("image_table_thead").style.display="none"}}})()}})]}));for(var d=0;d<this.AR_ALL_PROPERTIES.length;d++){if(this.AR_ALL_PROPERTIES[d].hasOwnProperty("VALUE")&&(typeof this.AR_ALL_PROPERTIES[d]=="object")&&(this.AR_ALL_PROPERTIES[d]!==null)&&(this.AR_ALL_PROPERTIES[d]["USE"]!=="N")){g=this.AR_ALL_PROPERTIES[d].ID;if(typeof(c[g])!=="undefined"){var j=[BX.create("OPTION",{props:{value:-1},text:BX.message("IB_SEG_FOR_ALL")})];for(var f in c[g]){if(c[g].hasOwnProperty(f)){j[j.length]=BX.create("OPTION",{props:{value:f},text:c[g][f]})}}k.appendChild(BX.create("td",{children:[BX.create("span",{props:{className:"adm-select-wrap"},children:[BX.create("select",{props:{className:"adm-select",name:"PROP["+g+"]["+this.intIMAGE_ROW_ID+"]",id:"PROP["+g+"]["+this.intIMAGE_ROW_ID+"]"},style:{width:"130px"},children:j})]})]}))}}}for(g in this.SELECTED_PROPERTIES){if(!this.SELECTED_PROPERTIES.hasOwnProperty(g)){continue}if(BX.util.in_array(this.SELECTED_PROPERTIES[g],b)){continue}this.fIblockInputGet(this.SELECTED_PROPERTIES[g]);b[b.length]=this.SELECTED_PROPERTIES[g]}};JCIBlockGenerator.prototype.fIblockInputResult=function(a){var b=Math.random();var c=BX("ib_seg_image_row_"+this.intIMAGE_ROW_ID).appendChild(BX.create("td",{props:{id:"ib_seg_image_td_"+this.intIMAGE_ROW_ID+"_"+b}}));c.innerHTML=a;if(BX("ib_seg_image_td_"+this.intIMAGE_ROW_ID+"_"+b).firstChild){BX.bind(BX("ib_seg_image_td_"+this.intIMAGE_ROW_ID+"_"+b).firstChild,"click",BX.proxy(function(d){BX("bx_admin_form").parentNode.scrollTop+=60},this))}};JCIBlockGenerator.prototype.fIblockInputGet=function(b){var a=[];a.AJAX_MODE="Y";a.sessid=BX.bitrix_sessid();a.GET_INPUT="Y";a.PROPERTY_ID=b;a.ROW_ID=this.intIMAGE_ROW_ID;BX.ajax({method:"POST",dataType:"html",url:"/bitrix/admin/iblock_sub_generator.ajax.php",data:BX.ajax.prepareData(a),async:false,onsuccess:BX.proxy(this.fIblockInputResult,this)})};JCIBlockGenerator.prototype.disableControls=function(){var e;this.lockProperties=true;for(var c=0;c<this.AR_ALL_PROPERTIES.length;c++){if(BX("checked_all_"+c)){BX("checked_all_"+c).onclick=function(){return false}}e=document.getElementsByClassName("property_value_checkbox"+c);var f=e.length;for(var b=0;b<f;b++){if(e[b]){e[b].onclick=function(){return false};if(e[b].nextSibling.className=="adm-designed-checkbox-label"){if(e[b].checked){e[b].nextSibling.style.backgroundPosition="0 -3459px"}else{e[b].nextSibling.style.backgroundPosition="0 -1350px"}}}}}var g=BX("ib_seg_select_prop_bar").querySelectorAll("select");[].forEach.call(g,function d(h){h.disabled=true});var a=BX(this.TABLE_PROP_ID).querySelectorAll("span.adm-shop-del-btn");[].forEach.call(a,function d(h){h.parentNode.innerHTML+=" "});if(BX("ib_seg_property_add_button_span_click")){BX("ib_seg_property_add_button_span_click").parentNode.innerHTML=""}if(BX("mnu_ADD_PROPERTY")){BX("mnu_ADD_PROPERTY").parentNode.innerHTML+=" "}};JCIBlockGenerator.prototype.addPropertyInTitle=function(a){var b=BX("IB_SEG_TITLE");if(b){b.value+=" "+a}};