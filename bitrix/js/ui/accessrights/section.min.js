(function(){BX.namespace("BX.UI");BX.UI.AccessRights.Section=function(a){this.id=a.id?a.id:null;this.headSection=a.headSection?a.headSection:null;this.title=a.title;this.rights=a.rights?a.rights:[];this.userGroups=a.userGroups?a.userGroups:[];this.grid=a.grid?a.grid:null;this.layout={title:null,headColumn:null,columns:null,content:null,earLeft:null,earRight:null};this.scroll=0;this.earTimer=null;this.earLeftTimer=null;this.earRightTimer=null;this.columns=[];this.bindEvents()};BX.UI.AccessRights.Section.prototype={bindEvents:function(){BX.addCustomEvent("AccessRights.Section:scrollLeft",function(a){if(this.title!==a.title){this.getColumnsContainer().scrollLeft=a.getScroll()}a.adjustEars();BX.PopupMenu.destroy("ui-access-rights-column-item-popup-variables")}.bind(this));BX.addCustomEvent("AccessRights.Section:scrollRight",function(a){if(this.title!==a.title){this.getColumnsContainer().scrollLeft=a.getScroll()}a.adjustEars();BX.PopupMenu.destroy("ui-access-rights-column-item-popup-variables")}.bind(this));BX.bind(window,"resize",this.adjustEars.bind(this))},addColumn:function(c){if(!c){return}var a=Object.assign({},c);a.userGroup=c;var b=this.getColumn(a);this.layout.columns.appendChild(b.render());this.columns.push(b)},removeColumn:function(b){if(!b){return}for(var a=0;a<this.columns.length;a++){if(b.userGroup===this.columns[a].userGroup){this.columns[a].remove();break}}},getColumn:function(b){var a=[];this.rights.map(function(c){a.push({type:c.type,title:c.type==="variables"?c.title:null,hint:c.hint,variables:c.type==="variables"?c.variables:[],access:c})}.bind(this));return new BX.UI.AccessRights.Column({items:a,userGroup:b.userGroup?b.userGroup:null,section:this,headSection:b.headSection,grid:this.grid,newColumn:b.newColumn?b.newColumn:null})},addHeadColumn:function(){var b=[];if(!this.headSection){this.rights.map(function(c){b.push({id:c.id,type:"title",title:c.title,hint:c.hint})}.bind(this))}if(this.headSection){b=[{type:"userGroupTitle",title:BX.message("JS_UI_ACCESSRIGHTS_ROLES"),controller:true},{type:"userGroupTitle",title:BX.message("JS_UI_ACCESSRIGHTS_EMPLOYEES_AND_DEPARTMENTS"),controller:false}]}var a=new BX.UI.AccessRights.Column({items:b,section:this,grid:this.grid});this.layout.headColumn.appendChild(a.render())},getTitle:function(){return BX.create("div",{props:{className:"ui-access-rights-section-title"},text:this.title})},getMainContainer:function(){return BX.create("div",{props:{className:"ui-access-rights-section-container"},children:[this.layout.headColumn=BX.create("div",{props:{className:"ui-access-rights-section-head"}}),this.getContentContainer()]})},getColumnsContainer:function(){if(!this.layout.columns){this.layout.columns=BX.create("div",{props:{className:"ui-access-rights-section-wrapper"},events:{scroll:this.adjustScroll.bind(this)}})}return this.layout.columns},getContentContainer:function(){if(!this.layout.content){this.layout.content=BX.create("div",{props:{className:"ui-access-rights-section-content"},children:[this.getColumnsContainer(),this.getEarLeft(),this.getEarRight()]})}return this.layout.content},getEarLeft:function(){var a=this;if(!this.layout.earLeft){this.layout.earLeft=BX.create("div",{props:{className:"ui-access-rights-section-ear-left"},events:{mouseenter:function(){a.stopAutoScroll();a.earLeftTimer=setTimeout(function(){a.scrollToLeft()},110)},mouseleave:function(){clearTimeout(a.earLeftTimer);a.stopAutoScroll()}}})}return this.layout.earLeft},getEarRight:function(){var a=this;if(!this.layout.earRight){this.layout.earRight=BX.create("div",{props:{className:"ui-access-rights-section-ear-right"},events:{mouseenter:function(){a.stopAutoScroll();a.earRightTimer=setTimeout(function(){a.scrollToRight()},110)},mouseleave:function(){clearTimeout(a.earRightTimer);a.stopAutoScroll()}}})}return this.layout.earRight},adjustEars:function(){var d=this.getColumnsContainer();var b=d.scrollLeft;var c=b>0;var a=d.scrollWidth>(Math.round(b+d.offsetWidth));this.getContentContainer().classList[c?"add":"remove"]("ui-access-rights-section-ear-left-shown");this.getContentContainer().classList[a?"add":"remove"]("ui-access-rights-section-ear-right-shown")},scrollToRight:function(c,b){var a=20;c?a=2:null;this.earTimer=setInterval(function(){this.getColumnsContainer().scrollLeft+=10;if(c){c<=this.getColumnsContainer().scrollLeft?this.stopAutoScroll():null}}.bind(this),a);if(b==="stop"){setTimeout(function(){clearTimeout(this.earTimer)}.bind(this),c*2)}},scrollToLeft:function(){this.earTimer=setInterval(function(){this.getColumnsContainer().scrollLeft-=10}.bind(this),20)},stopAutoScroll:function(){clearInterval(this.earTimer)},adjustScroll:function(){if(this.scroll<this.getColumnsContainer().scrollLeft){this.scroll=this.getColumnsContainer().scrollLeft;BX.onCustomEvent("AccessRights.Section:scrollRight",[this])}if(this.scroll>this.getColumnsContainer().scrollLeft){this.scroll=this.getColumnsContainer().scrollLeft;BX.onCustomEvent("AccessRights.Section:scrollLeft",[this])}},getScroll:function(){return this.scroll},render:function(){var d=BX.create("div",{props:{className:"ui-access-rights-section"},children:[this.title?this.getTitle():null,this.getMainContainer()]});this.addHeadColumn();var a=document.createDocumentFragment();for(var b=0;b<this.grid.getUserGroups().length;b++){var c=this.getColumn({headSection:this.headSection?this.headSection:null,userGroup:this.grid.getUserGroups()[b]});this.columns.push(c);a.appendChild(c.render())}this.getColumnsContainer().appendChild(a);return d}}})();