(function(){BX.namespace("BX.UI.Notification");var a={INIT:0,OPENING:1,OPEN:2,CLOSING:3,CLOSED:4,PAUSED:5,QUEUED:6};BX.UI.Notification.State=a;BX.UI.Notification.Balloon=function(c){c=BX.type.isPlainObject(c)?c:Object.create(null);if(!(c.stack instanceof BX.UI.Notification.Stack)){throw new Error("BX.UI.Notification.Balloon: 'stack' parameter is required.")}this.id=BX.type.isNotEmptyString(c.id)?c.id:BX.util.getRandomString(8).toLowerCase();this.stack=c.stack;this.state=a.INIT;this.container=null;this.content=null;this.actions=[];this.animationClassName="ui-notification-balloon-animate";this.customRender=null;this.category=null;this.autoHide=true;this.autoHideDelay=8000;this.autoHideTimeout=null;this.data={};this.zIndex=3200;this.width=400;this.closeButton=null;this.closeButtonVisibility=true;if(BX.type.isPlainObject(c.events)){for(var b in c.events){this.addEvent(b,c.events[b])}}this.setOptions(c)};BX.UI.Notification.Balloon.prototype={show:function(){if(this.getState()===a.OPENING){return}if(this.getState()===a.OPEN){this.activateAutoHide();return}var b=false;if(!this.getContainer().parentNode){b=true;document.body.appendChild(this.getContainer());this.getStack().add(this);if(this.getState()===a.QUEUED){return}}var c=this.getState()===a.PAUSED;this.setState(a.OPENING);this.adjustPosition();this.animateIn(function(){this.setState(a.OPEN);if(b){this.fireEvent("onOpen")}if(!c){this.activateAutoHide()}}.bind(this))},setOptions:function(b){if(!BX.type.isPlainObject(b)){return}this.setContent(b.content);this.setWidth(b.width);this.setZIndex(b.zIndex);this.setData(b.data);this.setCloseButtonVisibility(b.closeButton);this.setActions(b.actions);this.setCategory(b.category);this.setAutoHide(b.autoHide);this.setCustomRender(b.render);this.setAutoHideDelay(b.autoHideDelay)},update:function(b){this.setOptions(b);BX.cleanNode(this.getContainer());this.getContainer().style.zIndex=this.getZIndex();this.getContainer().appendChild(this.render());this.deactivateAutoHide();this.activateAutoHide()},close:function(){if(this.getState()===a.CLOSING||this.getState()===a.CLOSED){return}this.setState(a.CLOSING);this.deactivateAutoHide();this.animateOut(function(){if(this.getState()!==a.CLOSING){return}this.setState(a.CLOSED);BX.remove(this.getContainer());this.container=null;this.fireEvent("onClose")}.bind(this))},blink:function(){var b=this;this.animateOut(function(){setTimeout(function(){b.update(null);b.animateIn(function(){})},200)})},adjustPosition:function(){if(this.getStack().isNewestOnTop()){this.getStack().adjustPosition()}else{this.getStack().adjustPosition(this)}},getId:function(){return this.id},getCloseButton:function(){if(this.closeButton!==null){return this.closeButton}this.closeButton=BX.create("div",{props:{className:"ui-notification-balloon-close-btn"},events:{click:this.handleCloseBtnClick.bind(this)}});return this.closeButton},setCloseButtonVisibility:function(b){this.closeButtonVisibility=b!==false},isCloseButtonVisible:function(){return this.closeButtonVisibility},getContent:function(){return this.content},setContent:function(b){if(BX.type.isString(b)||BX.type.isDomNode(b)){this.content=b}},getWidth:function(){return this.width},setWidth:function(b){if(BX.type.isNumber(b)||b==="auto"){this.width=b}},getZIndex:function(){return this.zIndex},setZIndex:function(b){if(BX.type.isNumber(b)){this.zIndex=b}},getHeight:function(){return this.getContainer().offsetHeight},getCategory:function(){return this.category},setCategory:function(b){if(BX.type.isNotEmptyString(b)||b===null){this.category=b}},setActions:function(b){if(BX.type.isArray(b)){this.actions=[];b.forEach(function(c){this.actions.push(new BX.UI.Notification.Action(this,c))},this)}else{if(b===null){this.actions=[]}}},getActions:function(){return this.actions},getAction:function(d){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(c.getId()===d){return c}}return null},getContainer:function(){if(this.container!==null){return this.container}this.container=BX.create("div",{props:{className:"ui-notification-balloon"},style:{zIndex:this.getZIndex()},children:[this.render()],events:{mouseenter:this.handleMouseEnter.bind(this),mouseleave:this.handleMouseLeave.bind(this)}});return this.container},render:function(){if(this.getCustomRender()!==null){return this.getCustomRender().apply(this,[this])}var d=this.getActions().map(function(e){return e.getContainer()});var c=this.getContent();var b=this.getWidth();return BX.create("div",{props:{className:"ui-notification-balloon-content"},style:{width:BX.type.isNumber(b)?(b+"px"):b},children:[BX.create("div",{props:{className:"ui-notification-balloon-message"},html:BX.type.isDomNode(c)?null:c,children:BX.type.isDomNode(c)?[c]:[]}),BX.create("div",{props:{className:"ui-notification-balloon-actions"},children:d}),this.isCloseButtonVisible()?this.getCloseButton():null]})},setCustomRender:function(b){if(BX.type.isFunction(b)){this.customRender=b}},getCustomRender:function(){return this.customRender},getStack:function(){return this.stack},setState:function(c){var b=this.getStateCode(c);if(b!==null){this.state=c}},getState:function(){return this.state},getStateCode:function(c){for(var b in a){if(a[b]===c){return b}}return null},activateAutoHide:function(){if(!this.getAutoHide()){return}this.deactivateAutoHide();this.autoHideTimeout=setTimeout(function(){this.close()}.bind(this),this.getAutoHideDelay())},deactivateAutoHide:function(){clearTimeout(this.autoHideTimeout);this.autoHideTimeout=null},setAutoHide:function(b){this.autoHide=b!==false},getAutoHide:function(){return this.autoHide},setAutoHideDelay:function(b){if(BX.type.isNumber(b)&&b>0){this.autoHideDelay=b}},getAutoHideDelay:function(){return this.autoHideDelay},animateIn:function(c){if(!this.getContainer().classList.contains(this.getAnimationClassName())){this.getContainer().addEventListener("transitionend",function b(){this.removeEventListener("transitionend",b);c()});this.getContainer().classList.add(this.getAnimationClassName())}else{c()}},animateOut:function(c){if(this.getContainer().classList.contains(this.getAnimationClassName())){this.getContainer().addEventListener("transitionend",function b(){this.removeEventListener("transitionend",b);c()});this.getContainer().classList.remove(this.getAnimationClassName())}else{c()}},getAnimationClassName:function(){return this.animationClassName},handleCloseBtnClick:function(){this.close()},handleMouseEnter:function(){this.fireEvent("onMouseEnter");this.deactivateAutoHide();this.setState(a.PAUSED);this.show()},handleMouseLeave:function(){this.fireEvent("onMouseLeave");this.activateAutoHide()},fireEvent:function(b){var c=this.getEvent(b);BX.onCustomEvent(this,c.getFullName(),[c]);return c},addEvent:function(b,c){if(BX.type.isFunction(c)){BX.addCustomEvent(this,BX.UI.Notification.Event.getFullName(b),c)}},removeEvent:function(b,c){if(BX.type.isFunction(c)){BX.removeCustomEvent(this,BX.UI.Notification.Event.getFullName(b),c)}},getEvent:function(b){var c=new BX.UI.Notification.Event();c.setBalloon(this);c.setName(b);return c},getData:function(){return this.data},setData:function(b){if(BX.type.isPlainObject(b)){this.data=b}}};BX.UI.Notification.Event=function(){this.balloon=null;this.name=null};BX.UI.Notification.Event.getFullName=function(b){return"UI.Notification.Balloon:"+b};BX.UI.Notification.Event.prototype={getBalloon:function(){return this.balloon},setBalloon:function(b){if(b instanceof BX.UI.Notification.Balloon){this.balloon=b}},getName:function(){return this.name},setName:function(b){if(BX.type.isNotEmptyString(b)){this.name=b}},getFullName:function(){return BX.UI.Notification.Event.getFullName(this.getName())}};BX.UI.Notification.Action=function(e,c){c=BX.type.isPlainObject(c)?c:Object.create(null);this.balloon=e;this.id=BX.type.isNotEmptyString(c.id)?c.id:BX.util.getRandomString(8).toLowerCase();this.container=null;this.href=BX.type.isNotEmptyString(c.href)?c.href:null;this.title=BX.type.isNotEmptyString(c.title)?c.title:null;this.window=window;this.events={};if(BX.type.isPlainObject(c.events)){for(var b in c.events){var d=c.events[b];if(!BX.type.isFunction(d)){continue}this.events[b]=(function(f,g){return function(h){f.call(h.target,h,g.getBalloon(),g)}})(d,this)}}};BX.UI.Notification.Action.prototype={getBalloon:function(){return this.balloon},getId:function(){return this.id},getTitle:function(){return this.title},getHref:function(){return this.href},getContainer:function(){if(this.container===null){this.container=BX.create(this.getHref()?"a":"span",{props:{href:this.getHref(),className:"ui-notification-balloon-action"},events:this.events,text:this.getTitle()})}return this.container},getWindow:function(){return this.window}}})();