(function(){BX.namespace("BX.TileGrid");BX.TileGrid.Grid=function(b){this.options=b;this.id=b.id;this.tileMargin=b.tileMargin;this.sizeRatio=b.sizeRatio;this.tileSize=b.tileSize;this.itemHeight=b.itemHeight;this.itemMinWidth=b.itemMinWidth;this.checkBoxing=b.checkBoxing;this.items=[];this.renderTo=b.container;this.multiSelectMode=null;this.style=null;this.containerWidth=null;this.countItemsPerRow=null;this.layout={container:null,content:null};this.emptyBlock=null;this.loader=null;this.dragger=new BX.TileGrid.DragDrop(this);this.gridTile=null;this.backspaceButton=null;this.deleteButton=null;this.enterButton=null;this.currentItem=null;this.firstCurrentItem=null;this.currentItem=null;this.itemType=this.getItemType(b.itemType);this.loadData(b);this.bindEvents();this.pressedShiftKey=null;this.pressedDeleteKey=null;this.pressedSelectAllKeys=null;this.pressedArrowTopMultipleKey=null;this.pressedArrowRightMultipleKey=null;this.pressedArrowBottomMultipleKey=null;this.pressedArrowLeftMultipleKey=null;this.pressedArrowTopKey=null;this.pressedArrowRightKey=null;this.pressedArrowBottomKey=null;this.pressedArrowLeftKey=null;this.pressedEscapeKey=null;this.pressedControlKey=null;BX.onCustomEvent("BX.TileGrid.Grid::ready",[this])};BX.TileGrid.Grid.prototype={getId:function(){return this.id},getTileMargin:function(b){if(!this.tileMargin){this.tileMargin=9}return this.tileMargin},getSizeRatio:function(b){if(!this.sizeRatio){return false}return this.sizeRatio},bindEvents:function(){BX.bind(window,"resize",this.setStyle.bind(this));BX.bind(window,"keydown",function(b){this.defineEscapeKey(b);if(this.isKeyPressedEscape()){this.resetSelection();return}this.defineShiftKey(b);this.defineDeleteKey(b);this.defineSelectAllKeys(b);this.defineArrowMultipleKey(b);this.defineArrowSingleKey(b);this.defineControlKey(b);if(this.isKeyPressedSelectAll()&&this.isFocusOnTile()){this.selectAllItems()}this.setBackspaceButton(b);this.setEnterButton(b);this.processButtonSelection();if(this.isKeyPressedDelete()&&!this.isKeyPressedShift()&&!this.isKeyControlKey()){this.removeSelectedItems(b)}else{if(this.backspaceButton&&this.isFocusOnTile()){this.handleBackspace()}}if(this.isFocusOnTile()){this.handleEnter(b)}}.bind(this));BX.bind(window,"keyup",function(b){this.resetShiftKey(b);this.resetDeleteKey(b);this.resetSelectAllKeys(b);this.resetArrowKey(b);this.resetEscapeKey(b);this.resetControlKey(b);this.resetBackspaceButton();this.resetEnterButton()}.bind(this));BX.bind(window,"click",function(b){if(this.checkParent(b.target)){return}this.resetSelection();this.resetSetMultiSelectMode()}.bind(this))},handleEnter:function(){if(!this.enterButton||!this.currentItem){return}this.currentItem.handleEnter()},handleBackspace:function(){},checkParent:function(b){var c=BX.findParent(b,{className:"ui-grid-tile-item"});if(!c){c=BX.findParent(b,{attr:{"data-tile-grid":"tile-grid-stop-close"}})}return c},appendItem:function(b){this.addItem(b);var c=this.items[this.items.length-1].render();BX.addClass(c,"ui-grid-tile-item-inserted");this.container.appendChild(c);this.items[this.items.length-1].afterRender()},addItem:function(b){var d=this.getItemType(b.itemType);var c=new d(b);c.gridTile=this;this.items.push(c)},_deleteItem:function(c,d){c.removeNode();for(var b=0;b<this.items.length;b++){if(this.items[b].id===c.id){if(BX.type.isFunction(d)){d(c)}delete this.items[b];this.items.splice(b,1);if(this.items.length===0){this.setMinHeightContainer();this.appendEmptyBlock()}return}}},removeItem:function(b){this._deleteItem(b,function(c){BX.onCustomEvent(this,"TileGrid.Grid:onItemRemove",[c,this])}.bind(this))},moveItem:function(c,b){this._deleteItem(c,function(d){BX.onCustomEvent(this,"TileGrid.Grid:onItemMove",[d,b,this])}.bind(this))},getSelectedItems:function(){return this.items.filter(function(b){return b.selected})},removeSelectedItems:function(){var b;this.getSelectedItems().forEach(function(c){b=this.items.indexOf(c);this.removeItem(c);if(b===this.items.length){b=this.items.length-1}},this);this.currentItem=this.items[b];this.firstCurrentItem=this.items[b];this.resetSetMultiSelectMode();this.selectItem(this.currentItem)},selectAllItems:function(){this.items.forEach(function(b){this.selectItem(b);this.checkItem(b)},this);this.currentItem=null;this.firstCurrentItem=null;if(this.isKeyPressedSelectAll()){BX.PreventDefault()}BX.onCustomEvent("BX.TileGrid.Grid:selectAllItems",[this])},loadData:function(b){b.items.forEach(function(c){this.addItem(c)},this)},countItems:function(){return this.items.length},getItem:function(c){for(var b=0;b<this.items.length;b++){if(this.items[b].id.toString()===c.toString()){return this.items[b]}}},changeTileSize:function(b){this.tileSize=b;this.setStyle()},setStyle:function(){if(this.calculateCountItemsPerRow()===this.countItemsPerRow){return}var b=document.head;var d="#"+this.getId()+" .ui-grid-tile-item { width: calc("+(100/this.calculateCountItemsPerRow())+"% - "+this.getTileMargin()*2+"px); } ";if(this.sizeRatio){var c="#"+this.getId()+" .ui-grid-tile-item:before { padding-top: "+this.getSizeRatio()+"} ";d=d+c}if(!this.style){this.getStyleNode()}BX.cleanNode(this.style);d=document.createTextNode(d);this.style.appendChild(d);b.appendChild(this.style);this.countItemsPerRow=this.calculateCountItemsPerRow()},getItemType:function(c){var b=this.getClass(c);if(BX.type.isFunction(b)){return b}return this.itemType||BX.TileGrid.Item},getClass:function(d){if(!BX.type.isNotEmptyString(d)){return null}var b=null;var f=window;var g=d.split(".");for(var c=0;c<g.length;c++){var e=g[c];if(!f[e]){return null}f=f[e];b=f}return b},getStyleNode:function(){this.style=BX.create("style",{attrs:{type:"text/css"}})},calculateCountItemsPerRow:function(){if(this.tileSize==="xl"){return this.calculateCountItemsPerRowXL()}if(!this.itemMinWidth){return this.calculateCountItemsPerRowM()}var c=-1;var b=0;var d=this.itemMinWidth+(this.tileMargin*2);while(b<this.getContainerWidth()){b=b+d;c++}return c},calculateCountItemsPerRowM:function(){if(this.itemMinWidth){return Math.round(this.getContainerWidth()/(this.itemMinWidth+this.itemMinWidth/5))}switch(true){case this.getContainerWidth()<=720:return 3;case this.getContainerWidth()<=990:return 4;case this.getContainerWidth()<=1100:return 5;case this.getContainerWidth()>1100:return 6}},calculateCountItemsPerRowXL:function(){switch(true){case this.getContainerWidth()<=990:return 2;case this.getContainerWidth()<=1200:return 3;case this.getContainerWidth()>1200:return 4}},getContainerWidth:function(){this.containerWidth=this.renderTo.offsetWidth;return this.containerWidth},getContainer:function(){return this.container},getWrapper:function(){if(this.container){return}this.container=BX.create("div",{attrs:{id:this.getId(),className:"ui-grid-tile"},style:{margin:"0 -"+this.getTileMargin()+"px"}});return this.container},setMinHeightContainer:function(){var c=BX.findParent(this.container);this.container.style.height="0";BX.cleanNode(this.container);for(var b=0;c.offsetHeight<=0;b++){c=BX.findParent(c)}this.container.style.minHeight=c.offsetHeight+"px"},unSetMinHeightContainer:function(){this.container.style.minHeight=""},setHeightContainer:function(){this.container.style.height=this.container.offsetHeight},unSetHeightContainer:function(){this.container.style.height=""},setFadeContainer:function(){BX.addClass(this.container,"ui-grid-tile-fade")},unSetFadeContainer:function(){BX.removeClass(this.container,"ui-grid-tile-fade")},getLoader:function(){if(this.loader===null){this.loader=new BX.Loader({target:this.container})}return this.loader},showLoader:function(){this.loader.show();if(this.container.getBoundingClientRect().top<0){var b=this.container.getBoundingClientRect().top*-1+BX.pos(this.container).top;this.loader.layout.style.top=(b+100)+"px";this.loader.layout.style.transform="translateY(0)";return}if(this.loader.layout.getBoundingClientRect().top<window.innerHeight){this.loader.layout.style.top="100px";this.loader.layout.style.transform="translateY(0)"}},redraw:function(b){BX.onCustomEvent("BX.TileGrid.Grid:beforeRedraw",[this]);this.items.forEach(function(c){c.removeNode(false)},this);this.items=[];this.loadData({items:b});this.draw();this.resetSelection();BX.onCustomEvent("BX.TileGrid.Grid:redraw",[this])},draw:function(){this.getWrapper();this.setStyle(this.getContainerWidth());for(var b=0,d;b<this.items.length;b++){d=this.items[b];this.container.appendChild(d.render())}this.renderTo.appendChild(this.container);for(var c=0;c<this.items.length;c++){this.items[c].afterRender()}if(this.items.length===0){this.setMinHeightContainer();this.appendEmptyBlock();return}this.removeEmptyBlock();this.unSetMinHeightContainer()},buildEmptyBlock:function(){if(BX.type.isFunction(this.options.generatorEmptyBlock)){this.emptyBlock=this.options.generatorEmptyBlock.call(this);return}this.emptyBlock=BX.create("div",{props:{className:"ui-grid-tile-no-data-inner"},children:[BX.create("div",{props:{className:"ui-grid-tile-no-data-image"}})]})},appendEmptyBlock:function(){if(!this.emptyBlock){this.buildEmptyBlock()}this.container.appendChild(this.emptyBlock)},removeEmptyBlock:function(){if(!this.emptyBlock){return}this.container.removeChild(this.emptyBlock);this.emptyBlock=null},setBackspaceButton:function(b){b.key==="Backspace"?this.backspaceButton="Backspace":null},resetBackspaceButton:function(){this.backspaceButton=null},setEnterButton:function(b){if(b.key!=="Enter"){return}this.enterButton="Enter"},resetEnterButton:function(){this.enterButton=null},processButtonSelection:function(){var c,b;if(this.isFocusOnTile()&&!this.currentItem&&this.items.length>0){this.setCurrentItem(this.items[0])}if(!this.currentItem){return}if(this.isKeyMultipleArrowRight()){this.selectFromToItems(this.firstCurrentItem,this.items[this.selectNextItemNumber(this.currentItem)])}if(this.isKeyArrowRight()){this.resetSelectAllItems();this.selectItem(this.items[this.selectNextItemNumber(this.currentItem)]);b=this.items[this.items.indexOf(this.currentItem)+1];if(b&&!b.isVisibleItem()){a(b.getContainer().getBoundingClientRect().height)}return}if(this.isKeyMultipleArrowLeft()){this.selectFromToItems(this.firstCurrentItem,this.items[this.selectPreviousItemNumber(this.currentItem)])}if(this.isKeyArrowLeft()){this.resetSelectAllItems();this.selectItem(this.items[this.selectPreviousItemNumber(this.currentItem)]);b=this.items[this.items.indexOf(this.currentItem)-1];if(b&&!b.isVisibleItem()){a(-b.getContainer().getBoundingClientRect().height)}return}if(this.isKeyMultipleArrowTop()){c=this.items[this.items.indexOf(this.currentItem)-this.countItemsPerRow];c?this.currentItem=c:this.currentItem=this.items[0];this.selectFromToItems(this.firstCurrentItem,this.currentItem)}if(this.isKeyArrowTop()){c=this.items[this.items.indexOf(this.currentItem)-this.countItemsPerRow];c?this.currentItem=c:this.currentItem=this.items[0];this.resetSelectAllItems();this.selectItem(this.currentItem);b=this.items[this.items.indexOf(this.currentItem)-this.countItemsPerRow];if(b&&!b.isVisibleItem()){a(-b.getContainer().getBoundingClientRect().height)}return}if(this.isKeyMultipleArrowBottom()){c=this.items[this.items.indexOf(this.currentItem)+this.countItemsPerRow];c?this.currentItem=c:this.currentItem=this.items[this.items.length-1];this.selectFromToItems(this.firstCurrentItem,this.currentItem)}if(this.isKeyArrowBottom()){c=this.items[this.items.indexOf(this.currentItem)+this.countItemsPerRow];c?this.currentItem=c:this.currentItem=this.items[this.items.length-1];this.resetSelectAllItems();this.selectItem(this.currentItem);b=this.items[this.items.indexOf(this.currentItem)+this.countItemsPerRow];if(b&&!b.isVisibleItem()){a(b.getContainer().getBoundingClientRect().height)}}},selectNextItemNumber:function(b){if(!b){return}var c=this.items.indexOf(b);if(c+1===this.items.length){this.setCurrentItem(this.items[this.items.length-1]);return this.items.length-1}this.setCurrentItem(this.items[c+1]);return c+1},selectPreviousItemNumber:function(b){if(!b){return}var c=this.items.indexOf(b);if(c-1<0){this.setCurrentItem(this.items[0]);return 0}this.setCurrentItem(this.items[c-1]);return c-1},selectFromToItems:function(d,f){if(!d||!f){return}this.resetSelectAllItems();this.setMultiSelectMode();var b=this.items.indexOf(d);var c=this.items.indexOf(f);if(b>c){b=this.items.indexOf(f);c=this.items.indexOf(d)}for(var e=b;e<=c;e++){this.selectItem(this.items[e]);this.checkItem(this.items[e])}},setCheckbox:function(b){BX.addClass(b.layout.checkbox,"ui-grid-tile-item-checkbox-checked")},resetFromToItems:function(){this.firstCurrentItem=null;this.currentItem=null},resetSelection:function(){this.resetSetMultiSelectMode();this.resetSelectAllItems();this.resetFromToItems()},defineArrowMultipleKey:function(b){if(b.shiftKey&&b.code==="ArrowUp"){this.pressedArrowTopMultipleKey=true}if(b.shiftKey&&b.code==="ArrowRight"){this.pressedArrowRightMultipleKey=true}if(b.shiftKey&&b.code==="ArrowDown"){this.pressedArrowBottomMultipleKey=true}if(b.shiftKey&&b.code==="ArrowLeft"){this.pressedArrowLeftMultipleKey=true}},defineArrowSingleKey:function(b){if(!b.shiftKey&&b.code==="ArrowUp"){this.pressedArrowTopKey=true}if(!b.shiftKey&&b.code==="ArrowRight"){this.pressedArrowRightKey=true}if(!b.shiftKey&&b.code==="ArrowDown"){this.pressedArrowBottomKey=true}if(!b.shiftKey&&b.code==="ArrowLeft"){this.pressedArrowLeftKey=true}},isKeyMultipleArrowTop:function(){return this.pressedArrowTopMultipleKey},isKeyMultipleArrowRight:function(){return this.pressedArrowRightMultipleKey},isKeyMultipleArrowBottom:function(){return this.pressedArrowBottomMultipleKey},isKeyMultipleArrowLeft:function(){return this.pressedArrowLeftMultipleKey},isKeyArrowTop:function(){return this.pressedArrowTopKey},isKeyArrowRight:function(){return this.pressedArrowRightKey},isKeyArrowBottom:function(){return this.pressedArrowBottomKey},isKeyArrowLeft:function(){return this.pressedArrowLeftKey},resetArrowKey:function(b){if(b.code==="ArrowUp"||b.code==="ArrowRight"||b.code==="ArrowDown"||b.code==="ArrowLeft"){this.pressedArrowTopMultipleKey=null;this.pressedArrowRightMultipleKey=null;this.pressedArrowBottomMultipleKey=null;this.pressedArrowLeftMultipleKey=null;this.pressedArrowTopKey=null;this.pressedArrowRightKey=null;this.pressedArrowBottomKey=null;this.pressedArrowLeftKey=null}},defineSelectAllKeys:function(b){if((b.metaKey||b.ctrlKey)&&b.code==="KeyA"){this.pressedSelectAllKeys=true}},resetSelectAllKeys:function(b){if(b.key==="Control"||b.key==="Meta"){this.pressedSelectAllKeys=null}},isKeyPressedSelectAll:function(){return this.pressedSelectAllKeys},defineDeleteKey:function(b){if(b.key==="Delete"){this.pressedDeleteKey=true;return}if(b.key==="Backspace"&&b.metaKey){this.pressedDeleteKey=true}},resetDeleteKey:function(b){if(b.key==="Delete"){this.pressedDeleteKey=null;return}if(b.key==="Backspace"||b.key==="Meta"){this.pressedDeleteKey=null}},isKeyPressedDelete:function(){return this.pressedDeleteKey},defineEscapeKey:function(b){if(b.key==="Escape"){this.pressedEscapeKey=true;BX.onCustomEvent("BX.TileGrid.Grid:defineEscapeKey",[this])}},resetEscapeKey:function(b){if(b.key==="Escape"){this.pressedEscapeKey=null}},isKeyPressedEscape:function(){return this.pressedEscapeKey},defineControlKey:function(b){if(b.key==="Meta"||b.key==="Control"){this.pressedControlKey=true}},resetControlKey:function(b){if(b.key==="Meta"||b.key==="Control"){this.pressedControlKey=null}},isKeyControlKey:function(){return this.pressedControlKey},defineShiftKey:function(b){if(b.key==="Shift"){this.pressedShiftKey=true}},resetShiftKey:function(b){if(b.key==="Shift"){this.pressedShiftKey=null}},isKeyPressedShift:function(){return this.pressedShiftKey},setCurrentItem:function(b){if(this.currentItem!==b){this.currentItem=b}},getCurrentItem:function(){return this.currentItem},resetCurrentItem:function(){this.currentItem=null},isFocusOnTile:function(){if(BX.getClass("BX.UI.Viewer.Instance")&&BX.UI.Viewer.Instance.isOpen()){return false}if(!document.activeElement){return true}var b=document.activeElement.tagName.toLowerCase();if(b==="body"){return true}if(b==="input"||b==="select"||b==="textarea"){return false}return !!BX.findParent(document.activeElement,{className:"ui-grid-tile"})},setFirstCurrentItem:function(b){if(this.firstCurrentItem!==b){this.firstCurrentItem=b}},getFirstCurrentItem:function(){return this.firstCurrentItem},resetFirstCurrentItem:function(){this.firstCurrentItem=null},selectItem:function(b){if(!b){return}BX.addClass(b.layout.container,"ui-grid-tile-item-selected");b.selected=true;if(this.isLastSelectedItem()){this.resetSetMultiSelectMode()}BX.onCustomEvent("BX.TileGrid.Grid:selectItem",[b,this])},unSelectItem:function(b){if(!b){return}BX.removeClass(b.layout.container,"ui-grid-tile-item-selected");b.selected=false;if(this.isLastSelectedItem()){this.resetSetMultiSelectMode()}BX.onCustomEvent("BX.TileGrid.Grid:unSelectItem",[b,this])},isLastSelectedItem:function(){for(var b=0;b<this.items.length;b++){if(this.items[b].selected){return false}}BX.onCustomEvent("BX.TileGrid.Grid:lastSelectedItem");return true},checkItem:function(b){if(!b){return}BX.addClass(b.layout.checkbox,"ui-grid-tile-item-checkbox-checked");b.checked=true;if(!this.isMultiSelectMode()){this.setMultiSelectMode()}BX.onCustomEvent("BX.TileGrid.Grid:checkItem",[b,this])},unCheckItem:function(b){BX.removeClass(b.layout.checkbox,"ui-grid-tile-item-checkbox-checked");b.checked=false;BX.onCustomEvent("BX.TileGrid.Grid:unCheckItem",[b,this])},setMultiSelectMode:function(){BX.addClass(this.container,"ui-grid-tile-multi-select-mode");this.multiSelectMode=true;BX.onCustomEvent("BX.TileGrid.Grid:multiSelectModeOn",[this])},resetSetMultiSelectMode:function(){BX.removeClass(this.container,"ui-grid-tile-multi-select-mode");this.multiSelectMode=null;BX.onCustomEvent("BX.TileGrid.Grid:multiSelectModeOff",[this])},isMultiSelectMode:function(){return this.multiSelectMode},resetSelectAllItems:function(){if(this.isMultiSelectMode()){this.resetSetMultiSelectMode()}BX.onCustomEvent("BX.TileGrid.Grid:resetSelectAllItems",[this]);for(var b=0;b<this.items.length;b++){this.items[b].selected=false;this.items[b].checked=false;BX.removeClass(this.items[b].layout.checkbox,"ui-grid-tile-item-checkbox-checked");BX.removeClass(this.items[b].layout.container,"ui-grid-tile-item-selected")}BX.onCustomEvent("BX.TileGrid.Grid:afterResetSelectAllItems",[this])}};var a=function(b){var c=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;var d=new BX.easing({duration:300,start:{scrollY:c},finish:{scrollY:c+b},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){window.scrollTo(0,e.scrollY)}});d.animate()}})();