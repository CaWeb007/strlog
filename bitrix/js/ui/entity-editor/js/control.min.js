BX.namespace("BX.UI");if(typeof BX.UI.EntityEditorControl==="undefined"){BX.UI.EntityEditorControl=function(){this._id="";this._settings={};this._editor=null;this._parent=null;this._mode=BX.UI.EntityEditorMode.intermediate;this._modeOptions=BX.UI.EntityEditorModeOptions.none;this._model=null;this._schemeElement=null;this._container=null;this._wrapper=null;this._dragButton=null;this._dragItem=null;this._hasLayout=false;this._isValidLayout=false;this._isVisible=true;this._isActive=false;this._isChanged=false;this._isSchemeChanged=false;this._changeHandler=BX.delegate(this.onChange,this);this._contextMenuButton=null;this._isContextMenuOpened=false;this._modeChangeNotifier=null;this._configurationFieldManager=null;this._draggableContextId=""};BX.UI.EntityEditorControl.prototype={initialize:function(c,a){this._id=BX.type.isNotEmptyString(c)?c:BX.util.getRandomString(4);this._settings=a?a:{};this._editor=BX.prop.get(this._settings,"editor",null);this._parent=BX.prop.get(this._settings,"parent",null);this._model=BX.prop.get(this._settings,"model",null);this._schemeElement=BX.prop.get(this._settings,"schemeElement",null);this._container=BX.prop.getElementNode(this._settings,"container",null);var b=BX.prop.getInteger(this._settings,"mode",BX.UI.EntityEditorMode.view);if(b===BX.UI.EntityEditorMode.edit&&this._schemeElement&&!this._schemeElement.isEditable()){b=BX.UI.EntityEditorMode.view}this._mode=b;this.doInitialize();this.bindModel();this.initializeManagers()},doInitialize:function(){},bindModel:function(){},unbindModel:function(){},getMessage:function(b){var a=BX.UI.EntityEditorControl.messages;return a.hasOwnProperty(b)?a[b]:b},getId:function(){return this._id},getEditor:function(){return this._editor},setEditor:function(a){this._editor=a},getParentPosition:function(){var a=this.getParent();return(a?a.getPosition():{top:0,right:0,bottom:0,left:0,width:0,height:0})},getParent:function(){return this._parent},setParent:function(a){this._parent=a},getSiblingByIndex:function(a){return this._editor?this._editor.getControlByIndex(a):null},getChildCount:function(){return 0},getChildById:function(a){return null},editChild:function(a){},removeChild:function(a){},getChildren:function(){return[]},editChildConfiguration:function(a){},areAttributesEnabled:function(){return this._schemeElement&&this._schemeElement.areAttributesEnabled()},getType:function(){return this._schemeElement?this._schemeElement.getType():""},getName:function(){return this._schemeElement?this._schemeElement.getName():""},getTitle:function(){if(!this._schemeElement){return""}var a=this._schemeElement.getTitle();if(a===""){a=this._schemeElement.getName()}return a},setTitle:function(a){if(!this._schemeElement){return}this._schemeElement.setTitle(a);this.refreshTitleLayout()},getOptionFlags:function(){return(this._schemeElement?this._schemeElement.getOptionFlags():BX.UI.EntityEditorControlOptions.none)},setOptionFlags:function(a){if(this._schemeElement){this._schemeElement.setOptionFlags(a)}},toggleOptionFlag:function(b){var a=this.getOptionFlags();if(BX.UI.EntityEditorControlOptions.check(a,b)){a&=~b}else{a|=b}this.setOptionFlags(a)},checkOptionFlag:function(a){return BX.UI.EntityEditorControlOptions.check(this.getOptionFlags(),a)},getData:function(){return this._schemeElement?this._schemeElement.getData():{}},isVisible:function(){if(!this._isVisible){return false}if(this.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){return true}return BX.UI.EntityEditorVisibilityPolicy.checkVisibility(this)},setVisible:function(a){a=!!a;if(this._isVisible===a){return}this._isVisible=a;if(this._hasLayout){this._wrapper.style.display=this._isVisible?"":"none"}},isActive:function(){return this._isActive},setActive:function(a){a=!!a;if(this._isActive===a){return}this._isActive=a;this.doSetActive()},doSetActive:function(){},isEditable:function(){return this._schemeElement&&this._schemeElement.isEditable()},isRequired:function(){return this._schemeElement&&this._schemeElement.isRequired()},isRequiredConditionally:function(){return this._schemeElement&&this._schemeElement.isRequiredConditionally()},isRequiredByAttribute:function(){return this._schemeElement&&this._schemeElement.isRequiredByAttribute()},isHeading:function(){return this._schemeElement&&this._schemeElement.isHeading()},getCreationPlaceholder:function(){return this._schemeElement?this._schemeElement.getCreationPlaceholder():""},getChangePlaceholder:function(){return this._schemeElement?this._schemeElement.getChangePlaceholder():""},isReadOnly:function(){return this._editor&&this._editor.isReadOnly()},isEditInViewEnabled:function(){return(this._editor&&this._editor.isEditInViewEnabled()&&this.getDataBooleanParam("enableEditInView",false))},getVisibilityPolicy:function(){if(this._editor&&!this._editor.isVisibilityPolicyEnabled()){return BX.UI.EntityEditorVisibilityPolicy.always}return this._schemeElement&&this._schemeElement.getVisibilityPolicy()},getEditPriority:function(){return BX.UI.EntityEditorPriority.normal},getPosition:function(){return BX.pos(this._wrapper)},focus:function(){},save:function(){},validate:function(a){return true},rollback:function(){},getMode:function(){return this._mode},setMode:function(c,a){if(!this.canChangeMode(c)){return}var b=BX.prop.getInteger(a,"options",BX.UI.EntityEditorModeOptions.none);if(this._mode===c&&this._modeOptions===b){return}this.onBeforeModeChange();this._mode=c;this._modeOptions=b;this.doSetMode(this._mode);this.onAfterModeChange();if(BX.prop.getBoolean(a,"notify",false)){if(this._parent){this._parent.processChildControlModeChange(this)}else{if(this._editor){this._editor.processControlModeChange(this)}}}this._isSchemeChanged=false;this._isChanged=false;if(this._hasLayout){this._isValidLayout=false}},onBeforeModeChange:function(){},doSetMode:function(a){},onAfterModeChange:function(){if(this._modeChangeNotifier){this._modeChangeNotifier.notify()}},getModeChangeNotifier:function(){return this._modeChangeNotifier},canChangeMode:function(a){if(a===BX.UI.EntityEditorMode.edit){return this.isEditable()}return true},isModeToggleEnabled:function(){return this._editor.isModeToggleEnabled()},toggleMode:function(b,a){if(!this.isModeToggleEnabled()){return false}this.setMode(this._mode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view,{notify:b});if(BX.prop.getBoolean(a,"refreshLayout",true)){this.refreshLayout()}return true},isSingleEditEnabled:function(){return(this.isModeToggleEnabled()&&this.isEditable()&&!this.getDataBooleanParam("enableEditInView",false)&&this.getDataBooleanParam("enableSingleEdit",true))},isEditInViewEnabled:function(){return(this._editor&&this._editor.isEditInViewEnabled()&&this.getDataBooleanParam("enableEditInView",false))},isInSingleEditMode:function(){if(!this.isInEditMode()){return false}return(this.checkModeOption(BX.UI.EntityEditorModeOptions.exclusive)||this.checkModeOption(BX.UI.EntityEditorModeOptions.individual))},isInEditMode:function(){return this._mode===BX.UI.EntityEditorMode.edit},isInViewMode:function(){return this._mode===BX.UI.EntityEditorMode.view},checkModeOption:function(a){return BX.UI.EntityEditorModeOptions.check(this._modeOptions,a)},getContextId:function(){return this._editor?this._editor.getContextId():""},getExternalContextId:function(){return this._editor?this._editor.getExternalContextId():""},processSchemeChange:function(){},processAvailableSchemeElementsChange:function(){},processChildControlModeChange:function(a){},processChildControlChange:function(a,b){},isChanged:function(){return this._isChanged},markAsChanged:function(b){if(typeof(b)==="undefined"){b={}}var a=BX.prop.get(b,"control",null);if(!(a&&a instanceof BX.UI.EntityEditorControl)){a=b.control=this}if(!a.isInEditMode()){return}if(!this._isChanged){this._isChanged=true}this.notifyChanged(b)},isSchemeChanged:function(){return this._isSchemeChanged},markSchemeAsChanged:function(){if(this._isSchemeChanged){return}var a=this.getParent();if(a){a.markSchemeAsChanged()}this._isSchemeChanged=true},saveScheme:function(){if(!this._isSchemeChanged){return}var a=this.getParent();if(a&&a.isSchemeChanged()){return a.saveScheme()}this.commitSchemeChanges();return this._editor.saveScheme()},commitSchemeChanges:function(){if(!this._isSchemeChanged){return}this._editor.updateSchemeElement(this._schemeElement);this._isSchemeChanged=false},getRootContainer:function(){return this._editor?this._editor.getContainer():null},getRootContainerPosition:function(){return BX.pos(this.getRootContainer())},getContainer:function(){return this._container},setContainer:function(a){this._container=a;if(this._hasLayout){this._hasLayout=false}},getWrapper:function(){return this._wrapper},enablePointerEvents:function(a){if(this._wrapper){this._wrapper.style.pointerEvents=a?"":"none"}},getModel:function(){return this._model},getSchemeElement:function(){return this._schemeElement},hasScheme:function(){return !!this._schemeElement},getDataBooleanParam:function(b,a){return(this._schemeElement?this._schemeElement.getDataBooleanParam(b,a):a)},hasLayout:function(){return this._hasLayout},layout:function(a){},registerLayout:function(b){if(!this._wrapper){return}this._wrapper.setAttribute("data-cid",this.getId());if(this.isInViewMode()&&this._parent&&this._parent.isInEditMode()){BX.addClass(this._wrapper,"ui-entity-editor-content-block-field-readonly")}else{BX.removeClass(this._wrapper,"ui-entity-editor-content-block-field-readonly")}if(typeof b==="undefined"){b={}}if(!BX.prop.getBoolean(b,"preservePosition",false)){var a=BX.prop.getElementNode(b,"anchor",null);if(a){BX.addClass(this._wrapper,"ui-entity-card-content-hide");this._container.insertBefore(this._wrapper,a);setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"ui-entity-card-content-hide");BX.addClass(this._wrapper,"ui-entity-card-content-show")},this),1);setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"ui-entity-card-content-show")},this),310)}else{this._container.appendChild(this._wrapper)}}this._isValidLayout=true;this.doRegisterLayout()},doRegisterLayout:function(){},refreshLayout:function(a){if(!this._hasLayout){return}this.clearLayout({preservePosition:true});if(!BX.type.isPlainObject(a)){a={}}if(BX.prop.getBoolean(a,"reset",false)){this.reset()}a.preservePosition=true;this.layout(a)},clearLayout:function(a){},refreshTitleLayout:function(){},releaseLayout:function(){this._wrapper=null},release:function(){},reset:function(){},onHideButtonClick:function(a){this.hide()},createHideButton:function(){var a=!this.isRequired()&&!this.isRequiredByAttribute()&&!this.isRequiredConditionally();var b=BX.create("div",{props:{className:"ui-entity-widget-content-block-hide-btn",title:this.getHideButtonHint(a)}});if(a){BX.bind(b,"click",BX.delegate(this.onHideButtonClick,this))}return b},hide:function(){if(this.isRequired()||this.isRequiredByAttribute()||this.isRequiredConditionally()){return}if(this._parent){BX.addClass(this._wrapper,"ui-entity-card-content-hide");setTimeout(BX.delegate(function(){this._parent.removeChild(this)},this),350)}else{this.clearLayout()}},showMessageDialog:function(c,b,a){if(this._editor){this._editor.showMessageDialog(c,b,a)}},prepareSaveData:function(a){},onBeforeSubmit:function(){},onChange:function(a){this.markAsChanged()},notifyChanged:function(a){if(typeof(a)==="undefined"){a={}}if(this._parent){this._parent.processChildControlChange(this,a)}else{if(this._editor){this._editor.processControlChange(this,a)}}BX.onCustomEvent(this._editor,"onControlChanged",[this,a])},scrollIntoView:function(){var a=this.getWrapper();setTimeout(function(){var c=BX.GetDocElement(document);var d=BX.pos(a);var b=null;if(c.scrollTop>d.top-10){b=d.top-10}else{if(c.scrollTop+window.innerHeight<d.bottom+10){b=d.bottom-window.innerHeight+10}}if(BX.type.isNumber(b)){(new BX.easing({duration:150,start:{position:c.scrollTop},finish:{position:b},step:function(e){c.scrollTop=e.position}})).animate()}},300)},isDragEnabled:function(){if(!this._editor){return false}if(!this._editor.canChangeScheme()){return false}if(!this._schemeElement.isDragEnabled()){return false}return BX.prop.getBoolean(BX.prop.getObject(this._editor.getDragConfig(this.getDragObjectType()),"modes",{}),BX.UI.EntityEditorMode.getName(this._mode),false)},getDragObjectType:function(){return BX.UI.EditorDragObjectType.intermediate},getChildDragObjectType:function(){return BX.UI.EditorDragObjectType.intermediate},getDragScope:function(){if(this._parent){return this._parent.getChildDragScope()}if(!this._editor){return BX.UI.EditorDragScope.getDefault()}return BX.prop.getInteger(this._editor.getDragConfig(this.getDragObjectType()),"scope",BX.UI.EditorDragScope.getDefault())},getChildDragScope:function(){if(!this._editor){return BX.UI.EditorDragScope.getDefault()}return BX.prop.getInteger(this._editor.getDragConfig(this.getChildDragObjectType()),"scope",BX.UI.EditorDragScope.getDefault())},getDraggableContextId:function(){return this._draggableContextId},setDraggableContextId:function(a){this._draggableContextId=a},createDragButton:function(){return this._dragButton},isContextMenuEnabled:function(){if(this._editor&&!(this._editor.isFieldsContextMenuEnabled()&&this._editor.canChangeScheme())){return false}return this._schemeElement?this._schemeElement.isContextMenuEnabled():false},onContextMenuShow:function(){this._isContextMenuOpened=true},onContextMenuClose:function(){BX.PopupMenu.destroy(this._id);this._isContextMenuOpened=false},createContextMenuButton:function(){this._contextMenuButton=BX.create("div",{props:{className:"ui-entity-editor-block-context-menu"},events:{click:BX.delegate(this.onContextButtonClick,this)}});return this._contextMenuButton},onContextButtonClick:function(a){if(!this._isContextMenuOpened){this.openContextMenu()}else{this.closeContextMenu()}},openContextMenu:function(){if(this._isContextMenuOpened){return}var d=this.prepareContextMenuItems();if(BX.type.isArray(d)&&d.length>0){var b=BX.delegate(this.onContextMenuItemSelect,this);for(var a=0,c=d.length;a<c;a++){if(typeof d[a]["onclick"]==="undefined"){d[a]["onclick"]=b}}BX.PopupMenu.show(this._id,this._contextMenuButton,d,{angle:false,events:{onPopupShow:BX.delegate(this.onContextMenuShow,this),onPopupClose:BX.delegate(this.onContextMenuClose,this)}})}},closeContextMenu:function(){var a=BX.PopupMenu.getMenuById(this._id);if(a){a.popupWindow.close()}},onContextMenuItemSelect:function(b,a){this.processContextMenuCommand(b,BX.prop.getString(a,"value"))},prepareContextMenuItems:function(){return[]},processContextMenuCommand:function(a,b){},isWaitingForInput:function(){return false},initializeManagers:function(){var a={id:this.getId(),editor:this.getEditor(),type:this.getType(),configurationFieldManager:this._configurationFieldManager,};BX.onCustomEvent(window,"BX.UI.EntityConfigurationManager:onInitialize",[this,a]);if(a.configurationFieldManager){this._configurationFieldManager=a.configurationFieldManager}},getConfigurationFieldManager:function(){if(this._configurationFieldManager){return this._configurationFieldManager}return this.getEditor().getConfigurationFieldManager()},createGhostNode:function(){return null},getHideButtonHint:function(a){return""}};if(typeof(BX.UI.EntityEditorControl.messages)==="undefined"){BX.UI.EntityEditorControl.messages={}}}if(typeof BX.UI.EntityEditorField==="undefined"){BX.UI.EntityEditorField=function(){BX.UI.EntityEditorField.superclass.constructor.apply(this);this._titleWrapper=null;this._singleEditButton=null;this._singleEditController=null;this._singleEditTimeoutHandle=0;this._viewController=null;this._singleEditButtonHandler=BX.delegate(this.onSingleEditBtnClick,this);this._validators=null;this._hasError=false;this._errorContainer=null;this._layoutAttributes=null;this._spotlight=null;this._dragObjectType=BX.UI.EditorDragObjectType.field;this.eventsNamespace="BX.UI.EntityEditorField"};BX.extend(BX.UI.EntityEditorField,BX.UI.EntityEditorControl);BX.UI.EntityEditorField.prototype.isNewEntity=function(){return this._editor&&this._editor.isNew()};BX.UI.EntityEditorField.prototype.configure=function(){if(this._parent){this._parent.editChildConfiguration(this)}};BX.UI.EntityEditorField.prototype.hasAttributeConfiguration=function(a){return this._schemeElement.hasAttributeConfiguration(a)};BX.UI.EntityEditorField.prototype.getAttributeConfiguration=function(a){return this._schemeElement.getAttributeConfiguration(a)};BX.UI.EntityEditorField.prototype.setAttributeConfiguration=function(a){return this._schemeElement.setAttributeConfiguration(a)};BX.UI.EntityEditorField.prototype.removeAttributeConfiguration=function(a){return this._schemeElement.removeAttributeConfiguration(a)};BX.UI.EntityEditorField.prototype.setVisibilityConfiguration=function(a){return this._schemeElement.setVisibilityConfiguration(a)};BX.UI.EntityEditorField.prototype.removeVisibilityConfiguration=function(a){return this._schemeElement.removeVisibilityConfiguration(a)};BX.UI.EntityEditorField.prototype.getDuplicateControlConfig=function(){return this._schemeElement?this._schemeElement.getDataObjectParam("duplicateControl",null):null};BX.UI.EntityEditorField.prototype.markAsChanged=function(d){BX.UI.EntityEditorField.superclass.markAsChanged.apply(this,arguments);if(this.hasError()){this.clearError()}var a=this.getValidators();for(var b=0,c=a.length;b<c;b++){a[b].processFieldChange(this)}};BX.UI.EntityEditorField.prototype.bindModel=function(){this._model.addChangeListener(BX.delegate(this.onModelChange,this));this._model.addLockListener(BX.delegate(this.onModelLock,this))};BX.UI.EntityEditorField.prototype.onBeforeModeChange=function(){this._layoutAttributes=null;if(this.isInEditMode()){this._layoutAttributes={animate:"show"}}};BX.UI.EntityEditorField.prototype.onModelChange=function(a,b){this.processModelChange(b)};BX.UI.EntityEditorField.prototype.onModelLock=function(a,b){this.processModelLock(b)};BX.UI.EntityEditorField.prototype.processModelChange=function(a){};BX.UI.EntityEditorField.prototype.processModelLock=function(a){};BX.UI.EntityEditorField.prototype.getMessage=function(b){var a=BX.UI.EntityEditorField.messages;return(a.hasOwnProperty(b)?a[b]:BX.UI.EntityEditorField.superclass.getMessage.apply(this,arguments))};BX.UI.EntityEditorField.prototype.hasContentWrapper=function(){return this.getContentWrapper()!==null};BX.UI.EntityEditorField.prototype.getHideButtonHint=function(a){return this.getMessage(a?"hideButtonHint":"hideButtonDisabledHint")};BX.UI.EntityEditorField.prototype.getEditButton=function(){return this._singleEditButton};BX.UI.EntityEditorField.prototype.getContentWrapper=function(){return null};BX.UI.EntityEditorField.prototype.ensureWrapperCreated=function(d){if(!this._wrapper){this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}})}this.createAdditionalWrapperBlock();var c=BX.prop.getArray(d,"classNames",[]);for(var a=0,b=c.length;a<b;a++){BX.addClass(this._wrapper,c[a])}return this._wrapper};BX.UI.EntityEditorField.prototype.createAdditionalWrapperBlock=function(){if(!this._wrapper){return}var a=BX.create("div",{props:{className:"ui-entity-editor-block-before-action"},attrs:{"data-field-tag":this.getId()}});this._wrapper.appendChild(a)};BX.UI.EntityEditorField.prototype.adjustWrapper=function(){if(!this._wrapper){return}if(this.isInEditMode()&&(this.checkModeOption(BX.UI.EntityEditorModeOptions.exclusive)||this.checkModeOption(BX.UI.EntityEditorModeOptions.individual))){BX.addClass(this._wrapper,"ui-entity-editor-content-block-edit")}else{BX.removeClass(this._wrapper,"ui-entity-editor-content-block-edit")}if(this._layoutAttributes){for(var a in this._layoutAttributes){if(this._layoutAttributes.hasOwnProperty(a)){this._wrapper.setAttribute("data-"+a,this._layoutAttributes[a])}}this._layoutAttributes=null}};BX.UI.EntityEditorField.prototype.needShowTitle=function(){return this._schemeElement?this._schemeElement.needShowTitle():true};BX.UI.EntityEditorField.prototype.isVirtual=function(){return this._schemeElement?this._schemeElement.isVirtual():false};BX.UI.EntityEditorField.prototype.createTitleNode=function(a){this._titleWrapper=BX.create("div",{attrs:{className:"ui-entity-editor-block-title"}});this.prepareTitleLayout(BX.type.isNotEmptyString(a)?a:this.getTitle());return this._titleWrapper};BX.UI.EntityEditorField.prototype.prepareTitleLayout=function(g){if(!this._titleWrapper){return}var f=BX.create("label",{attrs:{className:"ui-entity-editor-block-title-text"},text:g});if(this._mode===BX.UI.EntityEditorMode.edit){BX.addClass(this._titleWrapper,"ui-entity-widget-content-block-title-edit")}var h=this.getFocusInputID();if(h!==""){BX.adjust(f,{attrs:{"for":h}})}var a=this.createTitleMarker();if(a){f.appendChild(a)}this._titleWrapper.appendChild(f);var b=this.createTitleActionControls();if(b.length>0){var d=BX.create("span",{attrs:{className:"ui-entity-editor-block-title-actions"}});this._titleWrapper.appendChild(d);for(var c=0,e=b.length;c<e;c++){d.appendChild(b[c])}}};BX.UI.EntityEditorField.prototype.refreshTitleLayout=function(){if(!this._titleWrapper){return}BX.cleanNode(this._titleWrapper);this.prepareTitleLayout(this.getTitle())};BX.UI.EntityEditorField.prototype.createTitleMarker=function(){if(this._mode===BX.UI.EntityEditorMode.view){return null}if(this.isRequired()||this.isRequiredByAttribute()){return BX.create("span",{style:{color:"#f00"},text:"*"})}else{if(this.isRequiredConditionally()){return BX.create("span",{text:"*"})}}return null};BX.UI.EntityEditorField.prototype.createTitleActionControls=function(){return[]};BX.UI.EntityEditorField.prototype.clearLayout=function(a){if(!this._hasLayout){return}this.releaseLightingAbilities();BX.UI.EntityEditorField.superclass.clearLayout.apply(this,arguments);if(!BX.type.isPlainObject(a)){a={}}this.releaseDragDropAbilities();this.releaseSwitchingAbilities();if(!BX.prop.getBoolean(a,"preservePosition",false)){this._wrapper=BX.remove(this._wrapper)}else{BX.removeClass(this._wrapper,"ui-entity-editor-content-block-click-editable");BX.removeClass(this._wrapper,"ui-entity-editor-content-block-click-empty");this._wrapper=BX.cleanNode(this._wrapper);if(this.hasError()){this.clearError()}}if(this._singleEditButton){this._singleEditButton=null}this.doClearLayout(a);this._hasLayout=false};BX.UI.EntityEditorField.prototype.doClearLayout=function(a){};BX.UI.EntityEditorField.prototype.registerLayout=function(b){var a=this.isVisible();var d=this.isNeedToDisplay();this._wrapper.style.display=(a&&d)?"":"none";this.initializeSwitchingAbilities();if(this.isInEditMode()&&this.checkModeOption(BX.UI.EntityEditorModeOptions.individual)){window.setTimeout(BX.delegate(this.focus,this),0)}BX.UI.EntityEditorField.superclass.registerLayout.apply(this,arguments);var c=BX.prop.getObject(b,"lighting",null);if(c){window.setTimeout(function(){this.initializeLightingAbilities(c)}.bind(this),1000)}if(!d&&BX.prop.getBoolean(b,"notifyIfNotDisplayed",false)){BX.UI.Notification.Center.notify({content:BX.message("UI_ENTITY_EDITOR_FIELD_HIDDEN_IN_VIEW_MODE").replace(/#TITLE#/gi,this.getTitle()),position:"top-center",autoHideDelay:5000})}};BX.UI.EntityEditorField.prototype.raiseLayoutEvent=function(){BX.onCustomEvent(window,this.eventsNamespace+":onLayout",[this])};BX.UI.EntityEditorField.prototype.hasContentToDisplay=function(){return this.hasValue()};BX.UI.EntityEditorField.prototype.isNeedToDisplay=function(a){if(this._mode===BX.UI.EntityEditorMode.edit||this.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)||this._schemeElement.isShownAlways()){return true}if(this._editor&&BX.prop.getBoolean(a,"enableLayoutResolvers",true)){return BX.prop.getBoolean(this._editor.prepareFieldLayoutOptions(this),"isNeedToDisplay",true)}return this.hasContentToDisplay()};BX.UI.EntityEditorField.prototype.isWaitingForInput=function(){return this.isInEditMode()&&(this.isRequired()||this.isRequiredByAttribute())&&!this.hasValue()};BX.UI.EntityEditorField.prototype.hide=function(){if(!(this.isRequired()||this.isRequiredConditionally()||this.isRequiredByAttribute())){BX.UI.EntityEditorField.superclass.hide.apply(this,arguments)}else{this.showMessageDialog("operationDenied",BX.message("UI_ENTITY_EDITOR_HIDE_TITLE"),BX.message("UI_ENTITY_EDITOR_HIDE_DENIED"))}};BX.UI.EntityEditorField.prototype.getEditPriority=function(){var a=this.hasValue();if(!a&&(this.isRequired()||this.isRequiredByAttribute()||this.isRequiredConditionally())){return BX.UI.EntityEditorPriority.high}if(!this._editor.isNew()){return BX.UI.EntityEditorPriority.normal}return a?BX.UI.EntityEditorPriority.high:this.doGetEditPriority()};BX.UI.EntityEditorField.prototype.doGetEditPriority=function(){return BX.UI.EntityEditorPriority.normal};BX.UI.EntityEditorField.prototype.checkIfNotEmpty=function(a){if(BX.type.isString(a)){return a.trim()!==""}return(a!==null&&a!==undefined)};BX.UI.EntityEditorField.prototype.setupFromModel=function(b,a){if(!b){b=this._model}if(!b){return}var c=this.getRelatedModelData(b);this._model.updateData(c,a)};BX.UI.EntityEditorField.prototype.getRelatedModelData=function(a){if(!a){a=this._model}if(!a){return{}}var f={};var e=this.getRelatedDataKeys();for(var c=0,d=e.length;c<d;c++){var b=e[c];if(b!==""){f[b]=a.getField(b,null)}}return f};BX.UI.EntityEditorField.prototype.getRelatedDataKeys=function(){return[this.getDataKey()]};BX.UI.EntityEditorField.prototype.hasValue=function(){return this.checkIfNotEmpty(this.getValue())};BX.UI.EntityEditorField.prototype.getValue=function(a){if(!this._model){return""}return(this._model.getField(this.getDataKey(),(a!==undefined?a:"")))};BX.UI.EntityEditorField.prototype.getStringValue=function(a){return this._model?this._model.getStringField(this.getName(),a):""};BX.UI.EntityEditorField.prototype.getRuntimeValue=function(){return""};BX.UI.EntityEditorField.prototype.getDataKey=function(){return this.getName()};BX.UI.EntityEditorField.prototype.prepareSaveData=function(a){a[this.getDataKey()]=this.getValue()};BX.UI.EntityEditorField.prototype.findValidatorIndex=function(b){if(!this._validators){return -1}for(var a=0,c=this._validators.length;a<c;a++){if(this._validators[a]===b){return a}}return -1};BX.UI.EntityEditorField.prototype.addValidator=function(a){if(a&&this.findValidatorIndex(a)<0){if(!this._validators){this._validators=[]}this._validators.push(a)}};BX.UI.EntityEditorField.prototype.removeValidator=function(b){if(!this._validators||!b){return}var a=this.findValidatorIndex(b);if(a>=0){this._validators.splice(a,1)}};BX.UI.EntityEditorField.prototype.getValidators=function(){return this._validators?this._validators:[]};BX.UI.EntityEditorField.prototype.hasValidators=function(){return this._validators&&this._validators.length>0};BX.UI.EntityEditorField.prototype.executeValidators=function(a){if(!this._validators){return true}var d=true;for(var b=0,c=this._validators.length;b<c;b++){if(!this._validators[b].validate(a)){d=false}}return d};BX.UI.EntityEditorField.prototype.hasError=function(){return this._hasError};BX.UI.EntityEditorField.prototype.showError=function(b,a){if(!this._errorContainer){this._errorContainer=BX.create("div",{attrs:{className:"ui-entity-editor-field-error-text"}})}this._errorContainer.innerHTML=BX.util.htmlspecialchars(b);if(this._wrapper){this._wrapper.appendChild(this._errorContainer);BX.addClass(this._wrapper,"ui-entity-editor-field-error")}this._hasError=true};BX.UI.EntityEditorField.prototype.showRequiredFieldError=function(a){this.showError(BX.message("UI_ENTITY_EDITOR_REQUIRED_FIELD_ERROR"),a)};BX.UI.EntityEditorField.prototype.clearError=function(){if(!this._hasError){return}if(this._errorContainer&&this._errorContainer.parentNode){this._errorContainer.parentNode.removeChild(this._errorContainer)}BX.removeClass(this._wrapper,"ui-entity-editor-field-error");this._hasError=false};BX.UI.EntityEditorField.prototype.isContentWrapperOnScreen=function(){if(this.hasContentWrapper()){var a=BX.GetDocElement(document);var b=BX.pos(this.getContentWrapper());if(a.scrollTop<=b.top&&a.scrollTop+window.innerHeight>=b.bottom){return true}}return false};BX.UI.EntityEditorField.prototype.focus=function(){if(!this.isContentWrapperOnScreen()){this.scrollAnimate()}};BX.UI.EntityEditorField.prototype.scrollAnimate=function(){var b=BX.GetDocElement(document);var a=this._wrapper;window.setTimeout(function(){(new BX.easing({duration:300,start:{position:b.scrollTop},finish:{position:BX.pos(a).top-10},step:function(c){b.scrollTop=c.position}})).animate()},0)};BX.UI.EntityEditorField.prototype.createDragButton=function(){if(!this._dragButton){this._dragButton=BX.create("div",{props:{className:"ui-entity-editor-block-draggable-btn-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-draggable-btn"}})]})}return this._dragButton};BX.UI.EntityEditorField.prototype.createGhostNode=function(){if(!this._wrapper){return null}var b=BX.pos(this._wrapper);var a=BX.create("div",{props:{className:"ui-entity-field-grabbing"},children:[this._wrapper.cloneNode(true)]});a.style.width=b.width+"px";a.style.height=b.height+"px";return a};BX.UI.EntityEditorField.prototype.setDragObjectType=function(a){this._dragObjectType=a};BX.UI.EntityEditorField.prototype.getDragObjectType=function(){return this._dragObjectType};BX.UI.EntityEditorField.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.UI.EditorDragItemController.create("field_"+this.getId(),{charge:BX.UI.EditorFieldDragItem.create({control:this,contextId:this._draggableContextId,scope:this.getDragScope()}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.UI.EntityEditorField.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.UI.EntityEditorField.prototype.prepareContextMenuItems=function(){var b=[];b.push({value:"hide",text:BX.message("UI_ENTITY_EDITOR_HIDE")});b.push({value:"configure",text:BX.message("UI_ENTITY_EDITOR_CONFIGURE")});if(this._parent&&this._parent.hasAdditionalMenu()){var c=this._parent.getAdditionalMenu();for(var a=0;a<c.length;a++){b.push(c[a])}}b.push({value:"showAlways",text:'<label class="ui-entity-card-context-menu-item-hide-empty-wrap"><input type="checkbox"'+(this.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)?' checked = "true"':"")+' class="ui-entity-card-context-menu-item-hide-empty-input"><span class="ui-entity-card-context-menu-item-hide-empty-text">'+BX.message("UI_ENTITY_EDITOR_SHOW_ALWAYS")+"</span></label>"});this.doPrepareContextMenuItems(b);return b};BX.UI.EntityEditorField.prototype.doPrepareContextMenuItems=function(a){};BX.UI.EntityEditorField.prototype.processContextMenuCommand=function(b,c){if(c==="showAlways"){var a=BX.getEventTarget(b);if(a&&a.tagName==="INPUT"){this.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways);if(this._parent){this._parent.processChildControlSchemeChange(this)}if(!this.isNeedToDisplay()){window.setTimeout(BX.delegate(this.clearLayout,this),500);BX.UI.Notification.Center.notify({content:BX.message("UI_ENTITY_EDITOR_FIELD_HIDDEN_DUE_TO_SHOW_ALWAYS_CHANGED").replace(/#TITLE#/gi,this.getTitle()),position:"top-center",autoHideDelay:5000});this.closeContextMenu()}}return}if(c==="hide"){window.setTimeout(BX.delegate(this.hide,this),500)}else{if(c==="configure"){this.configure()}else{if(this._parent&&this._parent.hasAdditionalMenu()){this._parent.processChildAdditionalMenuCommand(this,c)}}}this.closeContextMenu()};BX.UI.EntityEditorField.prototype.initializeSwitchingAbilities=function(){if(this.isInViewMode()){if(this.isSingleEditEnabled()){BX.addClass(this._wrapper,"ui-entity-editor-content-block-click-editable");if(!this.hasContentToDisplay()){BX.addClass(this._wrapper,"ui-entity-editor-content-block-click-empty")}if(this._singleEditButton){BX.bind(this._singleEditButton,"click",this._singleEditButtonHandler)}}if(this.hasContentWrapper()&&BX.UI.EntityEditorModeSwitchType.check(this.getModeSwitchType(BX.UI.EntityEditorMode.edit),BX.UI.EntityEditorModeSwitchType.content)){this._viewController=BX.UI.EditorFieldViewController.create(this._id,{field:this,wrapper:this.getContentWrapper()})}}else{if(this.checkModeOption(BX.UI.EntityEditorModeOptions.exclusive)){this._singleEditController=BX.UI.EditorFieldSingleEditController.create(this._id,{field:this})}}};BX.UI.EntityEditorField.prototype.releaseSwitchingAbilities=function(){if(this._singleEditButton){BX.unbind(this._singleEditButton,"click",this._singleEditButtonHandler)}if(this._viewController){this._viewController.release();this._viewController=null}if(this._singleEditController){this._singleEditController.release();this._singleEditController=null}};BX.UI.EntityEditorField.prototype.initializeLightingAbilities=function(d){var c=BX.prop.getString(d,"text","");if(!BX.type.isNotEmptyString(c)){return}var e=this.getContentWrapper();if(!e){return}this._spotlight=new BX.SpotLight({id:BX.prop.getString(d,"id",""),targetElement:e,autoSave:true,content:c,targetVertex:"middle-left",zIndex:200});this._spotlight.show();var b=BX.prop.getObject(d,"events",{});for(var a in b){if(b.hasOwnProperty(a)){BX.addCustomEvent(this._spotlight,a,b[a])}}};BX.UI.EntityEditorField.prototype.releaseLightingAbilities=function(){if(this._spotlight){this._spotlight.close();this._spotlight=null}};BX.UI.EntityEditorField.prototype.getFocusInputID=function(){return""};BX.UI.EntityEditorField.prototype.onSingleEditBtnClick=function(a){if(!(this.isSingleEditEnabled()&&this._editor)){return}if(this._singleEditTimeoutHandle>0){window.clearTimeout(this._singleEditTimeoutHandle);this._singleEditTimeoutHandle=0}this._singleEditTimeoutHandle=window.setTimeout(BX.delegate(this.switchToSingleEditMode,this),250);BX.eventCancelBubble(a)};BX.UI.EntityEditorField.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button}return a};BX.UI.EntityEditorField.prototype.switchToSingleEditMode=function(){if(!(this.isSingleEditEnabled()&&this._editor)){return}this._singleEditTimeoutHandle=0;if(this._editor){this._editor.switchControlMode(this,BX.UI.EntityEditorMode.edit,BX.UI.EntityEditorModeOptions.individual)}};if(typeof(BX.UI.EntityEditorField.messages)==="undefined"){BX.UI.EntityEditorField.messages={}}}if(typeof BX.UI.EntityEditorSectionContentStub==="undefined"){BX.UI.EntityEditorSectionContentStub=function(){this._settings=null;this._owner=null;this._container=null;this._wrapper=null;this._clickHandler=BX.delegate(this.onClick,this)};BX.UI.EntityEditorSectionContentStub.prototype={initialize:function(a){this._settings=a?a:{};this._owner=BX.prop.get(this._settings,"owner",null);this._container=BX.prop.getElementNode(this._settings,"container",null)},layout:function(){this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-card-content-nothing-selected"},children:[BX.create("div",{props:{className:"ui-entity-card-content-nothing-selected-text"},text:BX.message("UI_ENTITY_EDITOR_NOTHING_SELECTED")})]})]});BX.bind(this._wrapper,"click",this._clickHandler);if(this._container.children.length>0){this._container.insertBefore(this._wrapper,this._container.children[0])}else{this._container.appendChild(this._wrapper)}},clearLayout:function(){BX.unbind(this._wrapper,"click",this._clickHandler);this._wrapper=BX.remove(this._wrapper)},onStubClick:function(a){if(this._owner&&this._owner.isModeToggleEnabled()){this._owner.toggle()}}};BX.UI.EntityEditorSectionContentStub.create=function(c,b){var a=new BX.UI.EntityEditorSectionContentStub();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorColumn==="undefined"){BX.UI.EntityEditorColumn=function(){BX.UI.EntityEditorColumn.superclass.constructor.apply(this);this._sections=null;this._width=0;this._draggableContextId="";this._dragContainerController=null;this._dragPlaceHolder=null;this._dropHandler=BX.delegate(this.onDrop,this)};BX.extend(BX.UI.EntityEditorColumn,BX.UI.EntityEditorControl);BX.UI.EntityEditorColumn.prototype.doSetActive=function(){for(var b=0,a=this._sections.length;b<a;b++){this._sections[b].setActive(this._isActive)}};BX.UI.EntityEditorColumn.prototype.initialize=function(b,a){BX.UI.EntityEditorColumn.superclass.initialize.call(this,b,a);this.initializeFromModel();this._width=this._schemeElement.getDataIntegerParam("width",0)};BX.UI.EntityEditorColumn.prototype.initializeFromModel=function(){var b,c;if(this._sections){for(b=0,c=this._sections.length;b<c;b++){this._sections[b].release()}}this._sections=[];var d=this._schemeElement.getElements();for(b=0,c=d.length;b<c;b++){var a=d[b];var e=this._editor.createControl(a.getType(),a.getName(),{schemeElement:a,model:this._model,parent:this});if(!e){continue}a.setParent(this._schemeElement);e.setMode(this._mode,{notify:false});this._sections.push(e)}};BX.UI.EntityEditorColumn.prototype.layout=function(d){this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-column-content"},style:this._width?{flex:this._width}:null});this._container.appendChild(this._wrapper);if(!BX.type.isPlainObject(d)){d={}}var c=BX.prop.getBoolean(d,"reset",false);var b=d;if(b.hasOwnProperty("anchor")){delete b.anchor}for(var e=0,a=this._sections.length;e<a;e++){var f=this._sections[e];f.setContainer(this._wrapper);f.releaseLayout();if(c){f.reset()}f.layout(b)}if(this.isDragEnabled()){this._dragContainerController=BX.UI.EditorDragContainerController.create("column_"+this.getId(),{charge:BX.UI.EditorSectionDragContainer.create({editor:this._editor,column:this}),node:this._wrapper});this._dragContainerController.addDragFinishListener(this._dropHandler)}this._hasLayout=true};BX.UI.EntityEditorColumn.prototype.clearLayout=function(){if(!this._hasLayout){return}for(var a=0,b=this._sections.length;a<b;a++){var c=this._sections[a];c.clearLayout();c.setContainer(null)}this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.UI.EntityEditorColumn.prototype.refreshLayout=function(a){a=BX.type.isPlainObject(a)?BX.mergeEx({},a):{};var b=BX.prop.getFunction(a,"callback",null);delete a.callback;delete a.anchor;if(this._wrapper&&this._wrapper.nextSibling){a.anchor=this._wrapper.nextSibling}this.clearLayout();this.layout(a);if(b){b()}};BX.UI.EntityEditorColumn.prototype.onStubClick=function(a){this.toggle()};BX.UI.EntityEditorColumn.prototype.processChildControlChange=function(b,a){if(typeof(a)==="undefined"){a={}}if(!BX.prop.get(a,"control",null)){a.control=b}if(!b.isInEditMode()&&!a.control.isInEditMode()){return}this.markAsChanged(a);this.enableToggling(false)};BX.UI.EntityEditorColumn.prototype.enableToggling=function(a){a=!!a;if(this._enableToggling===a){return}this._enableToggling=a};BX.UI.EntityEditorColumn.prototype.toggle=function(){if(this._enableToggling&&this._editor){this._editor.switchControlMode(this,this._mode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view)}};BX.UI.EntityEditorColumn.prototype.onToggleBtnClick=function(a){this.toggle()};BX.UI.EntityEditorColumn.prototype.onBeforeModeChange=function(){};BX.UI.EntityEditorColumn.prototype.doSetMode=function(c){for(var b=0,a=this._sections.length;b<a;b++){this._sections[b].setMode(c,{notify:false})}};BX.UI.EntityEditorColumn.prototype.processAvailableSchemeElementsChange=function(){};BX.UI.EntityEditorColumn.prototype.validate=function(a){if(this._mode!==BX.UI.EntityEditorMode.edit){return true}var c=BX.UI.EntityAsyncValidator.create();for(var b=0,d=this._sections.length;b<d;b++){var e=this._sections[b];if(e.getMode()!==BX.UI.EntityEditorMode.edit){continue}c.addResult(e.validate(a))}return c.validate()};BX.UI.EntityEditorColumn.prototype.commitSchemeChanges=function(){if(this._isSchemeChanged){var d=[];for(var b=0,c=this._sections.length;b<c;b++){this._sections[b].commitSchemeChanges();var a=this._sections[b].getSchemeElement();if(a){d.push(a)}}this._schemeElement.setElements(d)}return BX.UI.EntityEditorColumn.superclass.commitSchemeChanges.call(this)};BX.UI.EntityEditorColumn.prototype.save=function(){for(var a=0,b=this._sections.length;a<b;a++){this._sections[a].save()}};BX.UI.EntityEditorColumn.prototype.rollback=function(){for(var b=0,a=this._sections.length;b<a;b++){this._sections[b].rollback()}if(this._isChanged){this.initializeFromModel();this._isChanged=false}};BX.UI.EntityEditorColumn.prototype.onBeforeSubmit=function(){for(var a=0,b=this._sections.length;a<b;a++){this._sections[a].onBeforeSubmit()}};BX.UI.EntityEditorColumn.prototype.getChildIndex=function(c){for(var b=0,a=this._sections.length;b<a;b++){if(this._sections[b]===c){return b}}return -1};BX.UI.EntityEditorColumn.prototype.addChild=function(e,b){if(!BX.type.isPlainObject(b)){b={}}var d=null;var a=BX.prop.getInteger(b,"index",-1);if(a>=0){this._sections.splice(a,0,e);if(a<(this._sections.length-1)){d=this._sections[a+1]}}else{this._sections.push(e);d=BX.prop.get(b,"related",null)}if(e.getParent()!==this){e.setParent(this)}if(e.hasScheme()){e.getSchemeElement().setParent(this._schemeElement)}e.setActive(this._isActive);if(this._hasLayout){e.setContainer(this._wrapper);var c=BX.prop.getObject(b,"layout",{});if(d){c.anchor=d.getWrapper()}e.layout(c)}if(e.hasScheme()){this._editor.processControlAdd(e);this.markSchemeAsChanged();if(BX.prop.getBoolean(b,"enableSaving",true)){this.saveScheme()}}};BX.UI.EntityEditorColumn.prototype.removeChild=function(d,b){if(!BX.type.isPlainObject(b)){b={}}var a=this.getChildIndex(d);if(a<0){return}if(d.isActive()){d.setActive(false)}this._sections.splice(a,1);var c=d.hasScheme();if(c){d.getSchemeElement().setParent(null)}if(this._hasLayout){d.clearLayout();d.setContainer(null)}if(c){this._editor.processControlRemove(d);this.markSchemeAsChanged();if(BX.prop.getBoolean(b,"enableSaving",true)){this.saveScheme()}}};BX.UI.EntityEditorColumn.prototype.moveChild=function(g,d,c){if(!BX.type.isPlainObject(c)){c={}}var f=this.getChildCount();var e=f-1;if(d<0||d>f){d=e}var a=this.getChildIndex(g);if(a<0||a===d){return false}if(this._hasLayout){g.clearLayout()}this._sections.splice(a,1);f--;var b=null;if(this._hasLayout){b=d<f?this._sections[d].getWrapper():null}if(d<f){this._sections.splice(d,0,g)}else{this._sections.push(g)}if(this._hasLayout){if(b){g.layout({anchor:b})}else{g.layout()}}this._editor.processControlMove(g);this.markSchemeAsChanged();if(BX.prop.getBoolean(c,"enableSaving",true)){this.saveScheme()}return true};BX.UI.EntityEditorColumn.prototype.editChild=function(d){if(this._mode===BX.UI.EntityEditorMode.edit){d.focus()}else{if(!this.isReadOnly()){var a=true;for(var b=0,c=this._sections.length;b<c;b++){if(this._sections[b].getMode()!==this._mode){a=false;break}}if(a){this.setMode(BX.UI.EntityEditorMode.edit,{notify:true});this.refreshLayout({callback:function(){d.focus()}})}}}};BX.UI.EntityEditorColumn.prototype.getChildById=function(d){for(var a=0,b=this._sections.length;a<b;a++){var c=this._sections[a];if(c.getId()===d){return c}var e=c.getChildById(d);if(e){return e}}return null};BX.UI.EntityEditorColumn.prototype.getChildCount=function(){return this._sections.length};BX.UI.EntityEditorColumn.prototype.getChildren=function(){return this._sections};BX.UI.EntityEditorColumn.prototype.processChildControlModeChange=function(a){if(!this.isActive()&&this._editor){this._editor.processControlModeChange(a)}};BX.UI.EntityEditorColumn.prototype.hasAdditionalMenu=function(){return false};BX.UI.EntityEditorColumn.prototype.getAdditionalMenu=function(){return[]};BX.UI.EntityEditorColumn.prototype.isWaitingForInput=function(){for(var b=0,a=this._sections.length;b<a;b++){if(this._sections[b].isWaitingForInput()){return true}}return false};BX.UI.EntityEditorColumn.prototype.isRequired=function(){for(var b=0,a=this._sections.length;b<a;b++){if(this._sections[b].isRequired()){return true}}return false};BX.UI.EntityEditorColumn.prototype.isRequiredConditionally=function(){for(var b=0,a=this._sections.length;b<a;b++){if(this._sections[b].isRequiredConditionally()){return true}}return false};BX.UI.EntityEditorColumn.prototype.getDragObjectType=function(){return BX.UI.EditorDragObjectType.section};BX.UI.EntityEditorColumn.prototype.getChildDragObjectType=function(){return BX.UI.EditorDragObjectType.field};BX.UI.EntityEditorColumn.prototype.hasPlaceHolder=function(){return !!this._dragPlaceHolder};BX.UI.EntityEditorColumn.prototype.createPlaceHolder=function(a){var b=this._sections.length;if(a<0||a>b){a=b>0?b:0}if(this._dragPlaceHolder){if(this._dragPlaceHolder.getIndex()===a){return this._dragPlaceHolder}this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}this._dragPlaceHolder=BX.UI.EditorDragSectionPlaceholder.create({container:this._wrapper,anchor:(a<b)?this._sections[a].getWrapper():null,index:a});this._dragPlaceHolder.layout();return this._dragPlaceHolder};BX.UI.EntityEditorColumn.prototype.getPlaceHolder=function(){return this._dragPlaceHolder};BX.UI.EntityEditorColumn.prototype.removePlaceHolder=function(){if(this._dragPlaceHolder){this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}};BX.UI.EntityEditorColumn.prototype.processDraggedItemDrop=function(d,g){var e=d.getCharge();if(!((e instanceof BX.UI.EditorSectionDragContainer)&&e.getColumn()===this)){return}var c=g.getContextData();var f=BX.type.isNotEmptyString(c.contextId)?c.contextId:"";if(f!==BX.UI.EditorSectionDragItem.contextId){return}var l=this.getPlaceHolder();var k=l?l.getIndex():-1;if(k<0){return}var n=typeof(c.charge)!=="undefined"?c.charge:null;if(!(n instanceof BX.UI.EditorSectionDragItem)){return}var a=n.getControl();if(!a){return}var b=a.getParent();if(b===this){var j=this.getChildIndex(a);if(j<0){return}var h=k<=j?k:(k-1);if(h===j){return}this.moveChild(a,h,{enableSaving:false});this._editor.saveSchemeChanges()}else{var m=a.getSchemeElement();if(a.getMode()===BX.UI.EntityEditorMode.edit){this._editor.unregisterActiveControl(a)}b.removeChild(a,{enableSaving:false});var i=this._editor.createControl(m.getType(),m.getName(),{schemeElement:m,model:this._model,parent:this,mode:a.getMode()});this.addChild(i,{index:k});this._editor.processControlModeChange(i);this._editor.saveSchemeChanges()}};BX.UI.EntityEditorColumn.prototype.onDrop=function(a){this.processDraggedItemDrop(a.data.dropContainer,a.data.draggedItem)};BX.UI.EntityEditorColumn.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.UI.EditorDragItemController.create("section_"+this.getId(),{charge:BX.UI.EditorSectionDragItem.create({control:this}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.UI.EntityEditorColumn.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.UI.EntityEditorColumn.create=function(c,b){var a=new BX.UI.EntityEditorColumn();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorSection==="undefined"){BX.UI.EntityEditorSection=function(){BX.UI.EntityEditorSection.superclass.constructor.apply(this);this._fields=null;this._fieldConfigurator=null;this._mandatoryConfigurator=null;this._visibilityConfigurator=null;this._titleEditButton=null;this._titleEditHandler=BX.delegate(this.onTitleEditButtonClick,this);this._headerContainer=null;this._titleContainer=null;this._titleView=null;this._titleInput=null;this._titleActions=null;this._titleMode=BX.UI.EntityEditorMode.intermediate;this._titleInputKeyHandler=BX.delegate(this.onTitleInputKeyPress,this);this._documentClickHandler=BX.delegate(this.onExternalClick,this);this._detetionConfirmDlgId="section_deletion_confirm";this._enableToggling=true;this._toggleButton=null;this._addChildButton=null;this._buttonPanelBlockLeft=null;this._buttonPanelBlockRight=null;this._createChildButton=null;this._childSelectMenu=null;this._buttonPanelWrapper=null;this._deleteButton=null;this._deleteButtonHandler=BX.delegate(this.onDeleteSectionBtnClick,this);this._draggableContextId="";this._dragContainerController=null;this._dragPlaceHolder=null;this._dropHandler=BX.delegate(this.onDrop,this);this._fieldSelector=null;this._fieldTypeSelectMenu=null;this._stub=null;this._detailButton=null;this.eventsNamespace="BX.UI.EntityEditorSection"};BX.extend(BX.UI.EntityEditorSection,BX.UI.EntityEditorControl);BX.UI.EntityEditorSection.prototype.doSetActive=function(){for(var b=0,a=this._fields.length;b<a;b++){this._fields[b].setActive(this._isActive)}};BX.UI.EntityEditorSection.prototype.initialize=function(b,a){BX.UI.EntityEditorSection.superclass.initialize.call(this,b,a);this._draggableContextId=BX.UI.EditorFieldDragItem.contextId;if(this.getChildDragScope()===BX.UI.EditorDragScope.parent){this._draggableContextId+="_"+this.getId()}this.initializeFromModel()};BX.UI.EntityEditorSection.prototype.initializeFromModel=function(){var b,c;if(this._fields){for(b=0,c=this._fields.length;b<c;b++){this._fields[b].release()}}this._fields=[];var d=this._schemeElement.getElements();for(b=0,c=d.length;b<c;b++){var a=d[b];var e=this._editor.createControl(a.getType(),a.getName(),{schemeElement:a,model:this._model,parent:this});if(!e){continue}a.setParent(this._schemeElement);e.setMode(this._mode,{notify:false});this._fields.push(e)}};BX.UI.EntityEditorSection.prototype.registerLayout=function(a){this._wrapper.style.display=this.isVisible()?"":"none";BX.UI.EntityEditorField.superclass.registerLayout.apply(this,arguments)};BX.UI.EntityEditorSection.prototype.layout=function(d){var z=this._schemeElement.getTitle();this._contentContainer=BX.create("div",{props:{className:"ui-entity-editor-section-content"}});var x=this._mode===BX.UI.EntityEditorMode.view;var s=x?"ui-entity-editor-section":"ui-entity-editor-section-edit";this._enableToggling=this.isModeToggleEnabled()&&this._schemeElement.getDataBooleanParam("enableToggling",true);this._toggleButton=BX.create("span",{attrs:{className:"ui-entity-editor-header-edit-lnk"},events:{click:BX.delegate(this.onToggleBtnClick,this)},text:BX.message(x?"UI_ENTITY_EDITOR_CHANGE":"UI_ENTITY_EDITOR_CANCEL")});if(!this._enableToggling){this._toggleButton.style.display="none"}var y=this.getEditor().getControlByIndex(0);var f=BX.prop.getString(this.getEditor()._settings,"entityDetailsUrl","");if(this.getEditor().isEmbedded()&&f.length){var w=null;if(y){w=y.getChildren().indexOf(this)}if(w===0){this._detailButton=BX.create("a",{attrs:{className:"ui-entity-editor-detail-btn",href:f},text:BX.message("UI_ENTITY_EDITOR_SECTION_OPEN_DETAILS")})}}this._titleMode=BX.UI.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:s}});if(this._schemeElement.isTitleEnabled()){this._headerContainer=BX.create("div",{props:{className:"ui-entity-editor-section-header"}});if(this.isDragEnabled()){this._headerContainer.appendChild(this.createDragButton())}this._titleEditButton=BX.create("span",{props:{className:"ui-entity-editor-header-title-edit-icon"},events:{click:this._titleEditHandler}});if(!this._editor.isSectionEditEnabled()||!this._editor.canChangeScheme()){this._titleEditButton.style.display="none"}this._titleView=BX.create("span",{props:{className:"ui-entity-editor-header-title-text"},text:z});this._titleInput=BX.create("input",{props:{className:"ui-entity-editor-header-title-text"},style:{display:"none"}});this._titleActions=BX.create("div",{props:{className:"ui-entity-editor-header-actions"},children:[this._toggleButton]});if(this._detailButton){this._titleActions.appendChild(this._detailButton)}this._titleContainer=BX.create("div",{props:{className:"ui-entity-editor-header-title"},children:[this._titleView,this._titleInput,this._titleEditButton]});this._headerContainer.appendChild(this._titleContainer);this._headerContainer.appendChild(this._titleActions);this._wrapper.appendChild(this._headerContainer)}this._wrapper.appendChild(this._contentContainer);if(!BX.type.isPlainObject(d)){d={}}var h=BX.prop.getElementNode(d,"anchor",null);if(h){this._container.insertBefore(this._wrapper,h)}else{this._container.appendChild(this._wrapper)}if(x&&this._fields.length===0){this._stub=BX.UI.EntityEditorSectionContentStub.create({owner:this,container:this._contentContainer});this._stub.layout()}var q=BX.prop.getBoolean(d,"reset",false);var e=BX.prop.get(d,"userFieldLoader",null);if(!e){e=BX.UI.EntityUserFieldLayoutLoader.create(this._id,{mode:this._mode,enableBatchMode:true,owner:this})}var o=BX.prop.getBoolean(d,"enableFocusGain",true);var a=BX.prop.getObject(d,"lighting",null);var m=false;var p=false;for(var v=0,t=this._fields.length;v<t;v++){var b=this._fields[v];b.setContainer(this._contentContainer);b.setDraggableContextId(this._draggableContextId);b.releaseLayout();if(q){b.reset()}var k={userFieldLoader:e};if(!m&&a&&b.isVisible()&&b.isNeedToDisplay()){k.lighting=a;m=true}b.layout(k);if(o&&!x&&b.isHeading()){b.focus()}if(!p&&b.isContextMenuEnabled()){p=true}}if(p){BX.addClass(this._contentContainer,"ui-entity-editor-section-content-padding-right")}if(e.getOwner()===this){e.runBatch()}this._addChildButton=this._createChildButton=this._deleteButton=null;if(this._editor.canChangeScheme()&&this._schemeElement.getDataBooleanParam("showButtonPanel",true)){this.showButtonPanel()}if(this.isDragEnabled()){this._dragContainerController=BX.UI.EditorDragContainerController.create("section_"+this.getId(),{charge:BX.UI.EditorFieldDragContainer.create({section:this,context:this._draggableContextId}),node:this._wrapper});this._dragContainerController.addDragFinishListener(this._dropHandler);this.initializeDragDropAbilities()}var g=null;if(y){g=y.getChildren().indexOf(this)}var n={id:this._id,customNodes:[],visible:true,serialNumber:g};BX.onCustomEvent(window,this.eventsNamespace+":onLayout",[this,n]);if(this._titleActions&&BX.type.isArray(n.customNodes)){for(var u=0,c=n.customNodes.length;u<c;u++){var r=n.customNodes[u];if(BX.type.isElementNode(r)){this._titleActions.appendChild(r)}}}if("visible" in n&&BX.type.isBoolean(n.visible)){this.setVisible(n.visible)}this.registerLayout(d);this._hasLayout=true};BX.UI.EntityEditorSection.prototype.clearLayout=function(){if(!this._hasLayout){return}if(this._dragContainerController){this._dragContainerController.removeDragFinishListener(this._dropHandler);this._dragContainerController.release();this._dragContainerController=null}this.releaseDragDropAbilities();if(this._stub!==null){this._stub.clearLayout();this._stub=null}for(var a=0,b=this._fields.length;a<b;a++){var c=this._fields[a];c.clearLayout();c.setContainer(null)}this._buttonPanelWrapper=BX.remove(this._buttonPanelWrapper);this._stub=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.UI.EntityEditorSection.prototype.refreshLayout=function(a){a=BX.type.isPlainObject(a)?BX.mergeEx({},a):{};var b=BX.prop.getFunction(a,"callback",null);delete a.callback;delete a.anchor;if(this._wrapper&&this._wrapper.nextSibling){a.anchor=this._wrapper.nextSibling}this.clearLayout();this.layout(a);if(b){b()}};BX.UI.EntityEditorSection.prototype.onStubClick=function(a){this.toggle()};BX.UI.EntityEditorSection.prototype.adjustButtons=function(){var a=this._editor.hasAvailableSchemeElements();var b=this._editor.hasTransferableElements([this.getName()]);if(this._addChildButton){this._addChildButton.style.display=(a||b)?"":"none"}};BX.UI.EntityEditorSection.prototype.processChildAdditionalMenuCommand=function(b,a){};BX.UI.EntityEditorSection.prototype.ensureButtonPanelCreated=function(){if(!this._buttonPanelWrapper){this._buttonPanelWrapper=BX.create("div",{props:{className:"ui-entity-card-content-actions-container"}});this._contentContainer.appendChild(this._buttonPanelWrapper);this._buttonPanelBlockLeft=BX.create("div",{props:{className:"ui-entity-card-content-actions-block"}});this._buttonPanelWrapper.appendChild(this._buttonPanelBlockLeft);this._buttonPanelBlockRight=BX.create("div",{props:{className:"ui-entity-card-content-actions-block"}});this._buttonPanelWrapper.appendChild(this._buttonPanelBlockRight)}};BX.UI.EntityEditorSection.prototype.showButtonPanel=function(){this.ensureButtonPanelCreated();if(this._schemeElement.getDataBooleanParam("isChangeable",true)){if(this.getConfigurationFieldManager().isSelectionEnabled()){this._addChildButton=BX.create("span",{props:{className:"ui-entity-editor-content-add-lnk"},text:BX.message("UI_ENTITY_EDITOR_SELECT_FIELD"),events:{click:BX.delegate(this.onAddChildBtnClick,this)}});this.addButtonElement(this._addChildButton,{position:"left"})}if(this.getConfigurationFieldManager().isCreationEnabled()){this._createChildButton=BX.create("span",{props:{className:"ui-entity-editor-content-create-lnk"},text:BX.message("UI_ENTITY_EDITOR_CREATE_FIELD"),events:{click:BX.delegate(this.onCreateFieldBtnClick,this)}});this.addButtonElement(this._createChildButton,{position:"left"})}}if(this._schemeElement.getDataBooleanParam("isRemovable",true)){var a="ui-entity-editor-content-remove-lnk";if(this.isRequired()||this.isRequiredByAttribute()||this.isRequiredConditionally()){a="ui-entity-editor-content-remove-lnk-disabled"}this._deleteButton=BX.create("span",{props:{className:a},text:BX.message("UI_ENTITY_EDITOR_DELETE_SECTION")});this.addButtonElement(this._deleteButton,{position:"right"});BX.bind(this._deleteButton,"click",this._deleteButtonHandler)}this._contentContainer.appendChild(this._buttonPanelWrapper);this.adjustButtons()};BX.UI.EntityEditorSection.prototype.addButtonElement=function(b,a){this.ensureButtonPanelCreated();if(BX.prop.getString(a,"position","")==="left"){this._buttonPanelBlockLeft.appendChild(b)}else{this._buttonPanelBlockRight.appendChild(b)}};BX.UI.EntityEditorSection.prototype.setTitleMode=function(b){if(this._titleMode===b){return}this._titleMode=b;if(!this._schemeElement.isTitleEnabled()){return}if(this._titleMode===BX.UI.EntityEditorMode.view){this._titleView.style.display="";this._titleInput.style.display="none";this._titleEditButton.style.display="";var a=this._titleInput.value;this._titleView.innerHTML=BX.util.htmlspecialchars(a);this._schemeElement.setTitle(a);this.markSchemeAsChanged();this.saveScheme();BX.unbind(this._titleInput,"keyup",this._titleInputKeyHandler);BX.unbind(window.document,"click",this._documentClickHandler)}else{this._titleView.style.display="none";this._titleInput.style.display="";this._titleEditButton.style.display="none";this._titleInput.value=this._schemeElement.getTitle();BX.bind(this._titleInput,"keyup",this._titleInputKeyHandler);this._titleInput.focus();window.setTimeout(BX.delegate(function(){BX.bind(window.document,"click",this._documentClickHandler)},this),100)}};BX.UI.EntityEditorSection.prototype.toggleTitleMode=function(){this.setTitleMode(this._titleMode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view)};BX.UI.EntityEditorSection.prototype.onTitleEditButtonClick=function(a){if(this._editor.isSectionEditEnabled()){this.toggleTitleMode()}};BX.UI.EntityEditorSection.prototype.onTitleInputKeyPress=function(a){if(!a){a=window.event}if(a.keyCode===13){this.toggleTitleMode()}};BX.UI.EntityEditorSection.prototype.onExternalClick=function(a){if(!a){a=window.event}if(this._titleInput!==BX.getEventTarget(a)){this.toggleTitleMode()}};BX.UI.EntityEditorSection.prototype.enableToggling=function(a){a=!!a;if(this._enableToggling===a){return}this._enableToggling=a;if(this._hasLayout){this._toggleButton.style.display=this._enableToggling?"":"none"}};BX.UI.EntityEditorSection.prototype.toggle=function(){if(this._enableToggling&&this._editor){this._editor.switchControlMode(this,this._mode===BX.UI.EntityEditorMode.view?BX.UI.EntityEditorMode.edit:BX.UI.EntityEditorMode.view)}};BX.UI.EntityEditorSection.prototype.onToggleBtnClick=function(a){this.toggle()};BX.UI.EntityEditorSection.prototype.onBeforeModeChange=function(){};BX.UI.EntityEditorSection.prototype.doSetMode=function(c){if(this._titleMode===BX.UI.EntityEditorMode.edit){this.toggleTitleMode()}for(var b=0,a=this._fields.length;b<a;b++){this._fields[b].setMode(c,{notify:false})}};BX.UI.EntityEditorSection.prototype.processAvailableSchemeElementsChange=function(){};BX.UI.EntityEditorSection.prototype.validate=function(a){if(this._mode!==BX.UI.EntityEditorMode.edit){return true}var c=BX.UI.EntityAsyncValidator.create();for(var b=0,d=this._fields.length;b<d;b++){var e=this._fields[b];if(e.getMode()!==BX.UI.EntityEditorMode.edit){continue}c.addResult(e.validate(a))}return c.validate()};BX.UI.EntityEditorSection.prototype.commitSchemeChanges=function(){if(this._isSchemeChanged){var d=[];for(var b=0,c=this._fields.length;b<c;b++){var a=this._fields[b].getSchemeElement();if(a){d.push(a)}}this._schemeElement.setElements(d)}return BX.UI.EntityEditorSection.superclass.commitSchemeChanges.call(this)};BX.UI.EntityEditorSection.prototype.save=function(){for(var a=0,b=this._fields.length;a<b;a++){this._fields[a].save()}};BX.UI.EntityEditorSection.prototype.rollback=function(){for(var b=0,a=this._fields.length;b<a;b++){this._fields[b].rollback()}if(this._isChanged){this.initializeFromModel();this._isChanged=false}};BX.UI.EntityEditorSection.prototype.onBeforeSubmit=function(){for(var a=0,b=this._fields.length;a<b;a++){this._fields[a].onBeforeSubmit()}};BX.UI.EntityEditorSection.prototype.getChildIndex=function(c){for(var b=0,a=this._fields.length;b<a;b++){if(this._fields[b]===c){return b}}return -1};BX.UI.EntityEditorSection.prototype.addChild=function(f,b){if(!BX.type.isPlainObject(b)){b={}}var d=null;var a=BX.prop.getInteger(b,"index",-1);if(a>=0){this._fields.splice(a,0,f);if(a<(this._fields.length-1)){d=this._fields[a+1]}}else{this._fields.push(f);d=BX.prop.get(b,"related",null)}if(f.getParent()!==this){f.setParent(this)}if(f.hasScheme()){f.getSchemeElement().setParent(this._schemeElement)}f.setActive(this._isActive);if(this._hasLayout){if(this._stub!==null){this._stub.clearLayout();this._stub=null}f.setContainer(this._contentContainer);var c=BX.prop.getObject(b,"layout",{});if(d){c.anchor=d.getWrapper()}else{c.anchor=this._buttonPanelWrapper}if(BX.prop.getBoolean(c,"forceDisplay",false)&&!f.isNeedToDisplay()&&!f.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){f.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}f.layout(c);if(!BX.hasClass(this._contentContainer,"ui-entity-editor-section-content-padding-right")&&f.isContextMenuEnabled()){BX.addClass(this._contentContainer,"ui-entity-editor-section-content-padding-right")}}var e=BX.prop.getBoolean(b,"scrollIntoView",false);if(e){f.scrollIntoView()}if(f.hasScheme()){this._editor.processControlAdd(f);this.markSchemeAsChanged();if(BX.prop.getBoolean(b,"enableSaving",true)){this.saveScheme()}}};BX.UI.EntityEditorSection.prototype.removeChild=function(d,b){if(!BX.type.isPlainObject(b)){b={}}var a=this.getChildIndex(d);if(a<0){return}if(d.isActive()){d.setActive(false)}this._fields.splice(a,1);var c=d.hasScheme();if(c){d.getSchemeElement().setParent(null)}if(this._hasLayout){d.clearLayout();d.setContainer(null);if(this.isInViewMode()){if(this._fields.length>0){if(this._stub!==null){this._stub.clearLayout();this._stub=null}}else{if(this._stub===null){this._stub=BX.UI.EntityEditorSectionContentStub.create({owner:this,container:this._contentContainer})}this._stub.layout()}}}if(c){this._editor.processControlRemove(d);this.markSchemeAsChanged();if(BX.prop.getBoolean(b,"enableSaving",true)){this.saveScheme()}}};BX.UI.EntityEditorSection.prototype.moveChild=function(g,d,c){if(!BX.type.isPlainObject(c)){c={}}var f=this.getChildCount();var e=f-1;if(d<0||d>f){d=e}var a=this.getChildIndex(g);if(a<0||a===d){return false}if(this._hasLayout){g.clearLayout()}this._fields.splice(a,1);f--;var b=null;if(this._hasLayout){b=d<f?this._fields[d].getWrapper():this._buttonPanelWrapper}if(d<f){this._fields.splice(d,0,g)}else{this._fields.push(g)}if(this._hasLayout){if(b){g.layout({anchor:b})}else{g.layout()}}this._editor.processControlMove(g);this.markSchemeAsChanged();if(BX.prop.getBoolean(c,"enableSaving",true)){this.saveScheme()}return true};BX.UI.EntityEditorSection.prototype.editChild=function(d){if(this._mode===BX.UI.EntityEditorMode.edit){d.focus()}else{if(!this.isReadOnly()){var a=true;for(var b=0,c=this._fields.length;b<c;b++){if(this._fields[b].getMode()!==this._mode){a=false;break}}if(a){this.setMode(BX.UI.EntityEditorMode.edit,{notify:true});this.refreshLayout({callback:function(){d.focus()}})}}}};BX.UI.EntityEditorSection.prototype.getChildById=function(d){for(var a=0,b=this._fields.length;a<b;a++){var c=this._fields[a];if(c.getId()===d){return c}}return null};BX.UI.EntityEditorSection.prototype.getChildCount=function(){return this._fields.length};BX.UI.EntityEditorSection.prototype.getChildren=function(){return this._fields};BX.UI.EntityEditorSection.prototype.editChildConfiguration=function(a){this.removeFieldConfigurator();this.createFieldConfigurator({field:a,enableMandatoryControl:this.getConfigurationFieldManager().isMandatoryControlEnabled()})};BX.UI.EntityEditorSection.prototype.processChildControlModeChange=function(a){if(!this.isActive()&&this._editor){this._editor.processControlModeChange(a)}};BX.UI.EntityEditorSection.prototype.processChildControlSchemeChange=function(a){this.markSchemeAsChanged();this.saveScheme()};BX.UI.EntityEditorSection.prototype.processSchemeChange=function(){this.adjustButtons()};BX.UI.EntityEditorSection.prototype.onAddChildBtnClick=function(a){this.openAddChildMenu()};BX.UI.EntityEditorSection.prototype.openAddChildMenu=function(){var f=this._editor.getAvailableSchemeElements();var e=f.length;var d=[];for(var c=0;c<e;c++){var b=f[c];d.push({text:b.getTitle(),value:b.getName()})}if(this._editor.hasTransferableElements([this.getName()])){if(e>0){d.push({delimiter:true})}d.push({text:BX.message("UI_ENTITY_EDITOR_SELECT_FIELD_FROM_OTHER_SECTION"),value:"ACTION.TRANSFER"})}var a={id:this._id,menuItems:d,button:this._addChildButton,cancel:false};BX.onCustomEvent(window,this.eventsNamespace+":onOpenChildMenu",[this,a]);if(a.cancel){return}if(this._childSelectMenu){this._childSelectMenu.setupItems(d)}else{this._childSelectMenu=BX.UI.SelectorMenu.create(this._id,{items:d});this._childSelectMenu.addOnSelectListener(BX.delegate(this.onChildSelect,this))}this._childSelectMenu.open(this._addChildButton)};BX.UI.EntityEditorSection.prototype.processChildControlChange=function(b,a){if(!b.isInEditMode()){return}if(typeof(a)==="undefined"){a={}}if(!BX.prop.get(a,"control",null)){a.control=b}this.markAsChanged(a);this.enableToggling(false)};BX.UI.EntityEditorSection.prototype.onChildSelect=function(e){var d=e.data.item;var b={id:this._id,item:d,button:this._addChildButton,cancel:false};BX.onCustomEvent(window,this.eventsNamespace+":onChildMenuItemSelect",[this,b]);if(b.cancel){return}var a=d.getValue();if(a==="ACTION.TRANSFER"){this.openTransferDialog();return}var c=this._editor.getAvailableSchemeElementByName(a);if(!c){return}var f=this._editor.createControl(c.getType(),c.getName(),{schemeElement:c,model:this._model,parent:this,mode:this._mode});if(f){this.addChild(f,{layout:{forceDisplay:true}})}};BX.UI.EntityEditorSection.prototype.openTransferDialog=function(){if(!this._fieldSelector){this._fieldSelector=BX.UI.EntityEditorFieldSelector.create(this._id,{scheme:this._editor.getScheme(),excludedNames:[this.getSchemeElement().getName()],title:BX.message("UI_ENTITY_EDITOR_FIELD_TRANSFER_DIALOG_TITLE")});this._fieldSelector.addClosingListener(BX.delegate(this.onTransferFieldSelect,this))}this._fieldSelector.open()};BX.UI.EntityEditorSection.prototype.onTransferFieldSelect=function(a){if(a.data.isCanceled){return}var g=BX.prop.getArray(a.data,"items");if(g.length===0){return}for(var e=0,b=g.length;e<b;e++){var l=g[e];var c=BX.prop.getString(l,"sectionName","");var k=BX.prop.getString(l,"fieldName","");var f=this._editor.getControlById(c);if(!f){continue}var h=f.getChildById(k);if(!h){continue}var j=h.getSchemeElement();f.removeChild(h,{enableSaving:false});var d=this._editor.createControl(j.getType(),j.getName(),{schemeElement:j,model:this._model,parent:this,mode:this._mode});this.addChild(d,{layout:{forceDisplay:true},enableSaving:false})}this._editor.saveSchemeChanges()};BX.UI.EntityEditorSection.prototype.createFieldConfigurator=function(b){if(!BX.type.isPlainObject(b)){throw"EntityEditorSection: The 'params' argument must be object."}b.mandatoryConfigurator=null;var c=BX.prop.get(b,"field",null);var a=this._editor.getAttributeManager();if(a){b.mandatoryConfigurator=a.createFieldConfigurator(c,BX.UI.EntityFieldAttributeType.required)}this._fieldConfigurator=this.getConfigurationFieldManager().createFieldConfigurator(b,this);this.addChild(this._fieldConfigurator,{related:c,scrollIntoView:true});if(this._fieldConfigurator instanceof BX.UI.EntityEditorUserFieldConfigurator){this._mandatoryConfigurator=b.mandatoryConfigurator;BX.addCustomEvent(this._fieldConfigurator,"onSave",BX.delegate(this.onUserFieldConfigurationSave,this));BX.addCustomEvent(this._fieldConfigurator,"onCancel",BX.delegate(this.onFieldConfigurationCancel,this))}else{BX.addCustomEvent(this._fieldConfigurator,"onSave",BX.delegate(this.onFieldConfigurationSave,this));BX.addCustomEvent(this._fieldConfigurator,"onCancel",BX.delegate(this.onFieldConfigurationCancel,this))}};BX.UI.EntityEditorSection.prototype.removeFieldConfigurator=function(){if(this._fieldConfigurator){var a=this._fieldConfigurator.getField();if(a){a.setVisible(true)}this.removeChild(this._fieldConfigurator);this._fieldConfigurator=null}};BX.UI.EntityEditorSection.prototype.onFieldConfigurationSave=function(b,e){if(b!==this._fieldConfigurator){return}var d=BX.prop.get(e,"field",null);if(!d){BX.onCustomEvent(this._editor,this._editor.eventsNamespace+":onFieldCreate",[this,e]);this.removeFieldConfigurator();return}var a=BX.prop.getString(e,"label","");var c=BX.prop.getBoolean(e,"showAlways",null);if(a===""&&c===null){this.removeFieldConfigurator();this._mandatoryConfigurator=null;this._visibilityConfigurator=null;return}this._fieldConfigurator.setLocked(true);d.getSchemeElement().setTitle(a);if(c!==null&&c!==d.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){d.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}BX.onCustomEvent(this._editor,this._editor.eventsNamespace+":onFieldModify",[this,e]);this.markSchemeAsChanged();this.saveScheme().then(BX.delegate(function(){if(this._mandatoryConfigurator){if(this._mandatoryConfigurator.isPermitted()&&d.areAttributesEnabled()&&!d.isRequired()){if(this._mandatoryConfigurator.isEnabled()){if(this._mandatoryConfigurator.isChanged()){this._mandatoryConfigurator.acceptChanges()}var g=this._mandatoryConfigurator.getConfiguration();this._editor.getAttributeManager().saveConfiguration(g,d.getName());d.setAttributeConfiguration(g)}else{var f=this._mandatoryConfigurator.getTypeId();this._editor.getAttributeManager().removeConfiguration(f,d.getName());d.removeAttributeConfiguration(f)}}this._mandatoryConfigurator=null;this._visibilityConfigurator=null}this.removeFieldConfigurator();d.setTitle(a)},this))};BX.UI.EntityEditorSection.prototype.onFieldConfigurationCancel=function(a,b){if(a!==this._fieldConfigurator){return}this.removeFieldConfigurator();this._mandatoryConfigurator=null;this._visibilityConfigurator=null};BX.UI.EntityEditorSection.prototype.enablePointerEvents=function(a){if(!this._fields){return}a=!!a;for(var b=0,c=this._fields.length;b<c;b++){this._fields[b].enablePointerEvents(a)}};BX.UI.EntityEditorSection.prototype.onCreateFieldBtnClick=function(f){if(!this._fieldTypeSelectMenu){var g=this.getConfigurationFieldManager().getTypeInfos();var a=[];for(var b=0,c=g.length;b<c;b++){var d=g[b];a.push({value:d.name,text:d.title,legend:d.legend})}this._fieldTypeSelectMenu=BX.UI.UserFieldTypeMenu.create(this._id,{items:a,callback:BX.delegate(this.onFieldTypeSelect,this)})}this._fieldTypeSelectMenu.open(this._createChildButton)};BX.UI.EntityEditorSection.prototype.getCreationConfigurator=function(a){return this.createFieldConfigurator({typeId:a,enableMandatoryControl:this.getConfigurationFieldManager().isMandatoryControlEnabled()})};BX.UI.EntityEditorSection.prototype.onFieldTypeSelect=function(a,c){this._fieldTypeSelectMenu.close();var b=c.getValue();if(b===""){return}if(this.getConfigurationFieldManager().hasExternalForm(b)){this.getConfigurationFieldManager().openCreationPageUrl(b)}else{this.removeFieldConfigurator();this.getCreationConfigurator(b)}};BX.UI.EntityEditorSection.prototype.onUserFieldConfigurationSave=function(g,e){if(g!==this._fieldConfigurator){return}this._fieldConfigurator.setLocked(true);var a=BX.prop.getString(e,"typeId");if(a===BX.UI.EntityUserFieldType.datetime&&!BX.prop.getBoolean(e,"enableTime",false)){a=BX.UI.EntityUserFieldType.date}var c={USER_TYPE_ID:a};if(this._mandatoryConfigurator&&this._mandatoryConfigurator.isPermitted()&&this._mandatoryConfigurator.isEnabled()&&this._mandatoryConfigurator.isCustomized()){if(this._mandatoryConfigurator.isChanged()){this._mandatoryConfigurator.acceptChanges()}c.MANDATORY="N"}else{c.MANDATORY=BX.prop.getBoolean(e,"mandatory",false)?"Y":"N"}var d=BX.prop.get(e,"settings",null);if(d){c.SETTINGS=d}var f=BX.prop.getBoolean(e,"showAlways",null);var i=BX.prop.getString(e,"label","");var h=BX.prop.get(e,"field",null);if(h){var b=h.getTitle();if(i!==""||f!==null){h.setTitle(i);if(f!==null&&f!==h.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){h.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.markSchemeAsChanged();this.saveScheme()}c.FIELD=h.getName();c.ENTITY_VALUE_ID=h.getEntityValueId();if(this._editor.getConfigScope()===BX.UI.EntityConfigScope.common&&i!==""&&b!==i){c.EDIT_FORM_LABEL=c.LIST_COLUMN_LABEL=c.LIST_FILTER_LABEL=i}c.VALUE=h.getFieldValue();if(a===BX.UI.EntityUserFieldType.enumeration){c.ENUM=BX.prop.getArray(e,"enumeration",[])}h.adjustFieldParams(c,false);this._editor.getUserFieldManager().updateField(c,h.getMode()).then(BX.delegate(this.onUserFieldUpdate,this))}else{if(f!==null){this._editor.setOption("show_always",f?"Y":"N")}c.EDIT_FORM_LABEL=c.LIST_COLUMN_LABEL=c.LIST_FILTER_LABEL=BX.prop.getString(e,"label");c.MULTIPLE=BX.prop.getBoolean(e,"multiple",false)?"Y":"N";if(a===BX.UI.EntityUserFieldType.enumeration){c.ENUM=BX.prop.getArray(e,"enumeration",[])}this._editor.getUserFieldManager().createField(c,this._mode).then(BX.delegate(this.onUserFieldCreate,this))}};BX.UI.EntityEditorSection.prototype.onUserFieldCreate=function(j){if(!BX.type.isPlainObject(j)){return}this.removeFieldConfigurator();var d=this._editor.getUserFieldManager();for(var i in j){if(!j.hasOwnProperty(i)){continue}var f=j[i];var a=BX.prop.getObject(f,"FIELD",null);if(!a){continue}var g=d.createSchemeElement(a);if(!g){continue}this._model.registerNewField(g.getName(),{VALUE:"",SIGNATURE:BX.prop.getString(a,"SIGNATURE","")});var h=this._editor.createControl(g.getType(),g.getName(),{schemeElement:g,model:this._model,parent:this,mode:this._mode});if(this._mandatoryConfigurator&&this._mandatoryConfigurator.isPermitted()&&this._mandatoryConfigurator.isEnabled()&&this._mandatoryConfigurator.isCustomized()){var c=this._mandatoryConfigurator.getConfiguration();this._editor.getAttributeManager().saveConfiguration(c,g.getName());h.setAttributeConfiguration(c)}if(this._visibilityConfigurator){var b={accessCodes:this._visibilityConfigurator.formatAccessCodesFromConfig(this._visibilityConfigurator.getItems())};this._visibilityConfigurator.onUserFieldConfigurationSave(g.getName(),this._editor.getEntityTypeId());h.setVisibilityConfiguration(b)}var e=this._editor.getOption("show_always","Y")==="Y";if(e!==h.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){h.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.addChild(h,{layout:{notifyIfNotDisplayed:true,html:BX.prop.getString(f,"HTML","")}});break}this._mandatoryConfigurator=null;this._visibilityConfigurator=null};BX.UI.EntityEditorSection.prototype.onUserFieldUpdate=function(l){if(!BX.type.isPlainObject(l)){return}this.removeFieldConfigurator();var e=this._editor.getUserFieldManager();for(var j in l){if(!l.hasOwnProperty(j)){continue}var f=l[j];var b=BX.prop.getObject(f,"FIELD",null);if(!b){continue}var i=this.getChildById(j);if(!i){continue}var g=i.getSchemeElement();if(!g){continue}if(this._mandatoryConfigurator&&this._mandatoryConfigurator.isPermitted()){if(this._mandatoryConfigurator.isEnabled()&&this._mandatoryConfigurator.isCustomized()){var d=this._mandatoryConfigurator.getConfiguration();this._editor.getAttributeManager().saveConfiguration(d,g.getName());i.setAttributeConfiguration(d)}else{var a=this._mandatoryConfigurator.getTypeId();this._editor.getAttributeManager().removeConfiguration(a,g.getName());i.removeAttributeConfiguration(a)}}if(this._visibilityConfigurator){var c={accessCodes:this._visibilityConfigurator.formatAccessCodesFromConfig(this._visibilityConfigurator.getItems())};this._visibilityConfigurator.onUserFieldConfigurationSave(g.getName(),this._editor.getEntityTypeId());i.setVisibilityConfiguration(c)}e.updateSchemeElement(g,b);var k={};var h=BX.prop.getString(f,"HTML","");if(h!==""){k.html=h}i.refreshLayout(k);break}this._mandatoryConfigurator=null;this._visibilityConfigurator=null};BX.UI.EntityEditorSection.prototype.onDeleteConfirm=function(a){if(BX.prop.getBoolean(a,"cancel",true)){return}if(this.getParent()){this.getParent().removeChild(this)}else{this._editor.removeSchemeElement(this.getSchemeElement());this._editor.removeControl(this);this._editor.saveScheme()}};BX.UI.EntityEditorSection.prototype.onDeleteSectionBtnClick=function(a){if(this.isRequired()||this.isRequiredByAttribute()||this.isRequiredConditionally()){this.showMessageDialog("operationDenied",BX.message("UI_ENTITY_EDITOR_DELETE_SECTION"),BX.message("UI_ENTITY_EDITOR_DELETE_SECTION_DENIED"));return}var b=BX.UI.ConfirmationDialog.get(this._detetionConfirmDlgId);if(!b){b=BX.UI.ConfirmationDialog.create(this._detetionConfirmDlgId,{title:BX.message("UI_ENTITY_EDITOR_DELETE_SECTION"),content:BX.message("UI_ENTITY_EDITOR_DELETE_SECTION_CONFIRM")})}b.open().then(BX.delegate(this.onDeleteConfirm,this))};BX.UI.EntityEditorSection.prototype.createDragButton=function(){if(!this._dragButton){this._dragButton=BX.create("div",{props:{className:"ui-entity-editor-header-draggable-btn-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-draggable-btn"}})]})}return this._dragButton};BX.UI.EntityEditorSection.prototype.createGhostNode=function(){if(!this._wrapper){return null}var b=BX.pos(this._wrapper);var a=BX.create("div",{props:{className:"ui-entity-section-grabbing"},children:[BX.create("div",{props:{className:"ui-entity-editor-section-header"},children:[BX.create("div",{props:{className:"ui-entity-editor-header-draggable-btn-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-draggable-btn"}})]}),BX.create("div",{props:{className:"ui-entity-editor-header-title"},children:[BX.create("span",{props:{className:"ui-entity-editor-header-title-text"},text:this._schemeElement.getTitle()})]})]})]});BX.addClass(a,"ui-entity-card-card-drag");a.style.width=b.width+"px";return a};BX.UI.EntityEditorSection.prototype.getDragObjectType=function(){return BX.UI.EditorDragObjectType.section};BX.UI.EntityEditorSection.prototype.getChildDragObjectType=function(){return BX.UI.EditorDragObjectType.field};BX.UI.EntityEditorSection.prototype.hasPlaceHolder=function(){return !!this._dragPlaceHolder};BX.UI.EntityEditorSection.prototype.createPlaceHolder=function(a){this.enablePointerEvents(false);if(this._stub!==null){this._stub.clearLayout();this._stub=null}var b=this.getChildCount();if(a<0||a>b){a=b>0?b:0}if(this._dragPlaceHolder){if(this._dragPlaceHolder.getIndex()===a){return this._dragPlaceHolder}this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}this._dragPlaceHolder=BX.UI.EditorDragFieldPlaceholder.create({container:this._contentContainer,anchor:(a<b)?this._fields[a].getWrapper():this._buttonPanelWrapper,index:a});this._dragPlaceHolder.layout();return this._dragPlaceHolder};BX.UI.EntityEditorSection.prototype.getPlaceHolder=function(){return this._dragPlaceHolder};BX.UI.EntityEditorSection.prototype.removePlaceHolder=function(){this.enablePointerEvents(true);if(this.isInViewMode()&&this.getChildCount()===0&&this._stub==null){this._stub=BX.UI.EntityEditorSectionContentStub.create({owner:this,container:this._contentContainer});this._stub.layout()}if(this._dragPlaceHolder){this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}};BX.UI.EntityEditorSection.prototype.processDraggedItemDrop=function(d,g){var e=d.getCharge();if(!((e instanceof BX.UI.EditorFieldDragContainer)&&e.getSection()===this)){return}var c=g.getContextData();var f=BX.type.isNotEmptyString(c.contextId)?c.contextId:"";if(f!==this.getDraggableContextId()){return}var l=this.getPlaceHolder();var k=l?l.getIndex():-1;if(k<0){return}var n=typeof(c.charge)!=="undefined"?c.charge:null;if(!(n instanceof BX.UI.EditorFieldDragItem)){return}var a=n.getControl();if(!a){return}var b=a.getParent();if(b===this){var j=this.getChildIndex(a);if(j<0){return}var h=k<=j?k:(k-1);if(h===j){return}this.moveChild(a,h,{enableSaving:false});this._editor.saveSchemeChanges()}else{var m=a.getSchemeElement();b.removeChild(a,{enableSaving:false});var i=this._editor.createControl(m.getType(),m.getName(),{schemeElement:m,model:this._model,parent:this,mode:this._mode});if(this._mode===BX.UI.EntityEditorMode.view&&!i.hasContentToDisplay()&&!i.checkOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)){i.toggleOptionFlag(BX.UI.EntityEditorControlOptions.showAlways)}this.addChild(i,{index:k,enableSaving:false});this._editor.saveSchemeChanges()}};BX.UI.EntityEditorSection.prototype.onDrop=function(a){this.processDraggedItemDrop(a.data.dropContainer,a.data.draggedItem)};BX.UI.EntityEditorSection.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.UI.EditorDragItemController.create("section_"+this.getId(),{charge:BX.UI.EditorSectionDragItem.create({control:this}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.UI.EntityEditorSection.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.UI.EntityEditorSection.prototype.hasAdditionalMenu=function(){return false};BX.UI.EntityEditorSection.prototype.getAdditionalMenu=function(){return[]};BX.UI.EntityEditorSection.prototype.isWaitingForInput=function(){for(var b=0,a=this._fields.length;b<a;b++){if(this._fields[b].isWaitingForInput()){return true}}return false};BX.UI.EntityEditorSection.prototype.isRequired=function(){for(var b=0,a=this._fields.length;b<a;b++){if(this._fields[b].isRequired()){return true}}return false};BX.UI.EntityEditorSection.prototype.isRequiredConditionally=function(){for(var b=0,a=this._fields.length;b<a;b++){if(this._fields[b].isRequiredConditionally()){return true}}return false};BX.UI.EntityEditorSection.prototype.isRequiredByAttribute=function(){for(var b=0,a=this._fields.length;b<a;b++){if(this._fields[b].isRequiredByAttribute()){return true}}return false};BX.UI.EntityEditorSection.prototype.ensureButtonPanelWrapperCreated=function(){if(!this._hasLayout){throw"EntityEditorSection: Control does not have layout."}if(!this._buttonPanelWrapper){this._buttonPanelWrapper=BX.create("div",{props:{className:"ui-entity-card-content-actions-container"}});this._contentContainer.appendChild(this._buttonPanelWrapper)}return this._buttonPanelWrapper};BX.UI.EntityEditorSection.create=function(c,b){var a=new BX.UI.EntityEditorSection();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorIncludedArea==="undefined"){BX.UI.EntityEditorIncludedArea=function(){this._settings=null;this._owner=null;this._container=null;this._wrapper=null;this._loadedHtml=null;this._hasLayout=false};BX.extend(BX.UI.EntityEditorIncludedArea,BX.UI.EntityEditorSection);BX.UI.EntityEditorIncludedArea.prototype.layout=function(){if(this._hasLayout){return}if(!this._wrapper){this._wrapper=BX.create("div",{props:{className:"ui-entity-editor-included-area"},attrs:{"data-name":this.getName()}})}this._includedAreaContainer=BX.create("div",{attrs:{className:"ui-entity-editor-included-area-container"},children:[BX.create("div",{attrs:{className:"ui-entity-editor-included-area-container-loader"}})]});this._contentContainer=BX.create("div",{attrs:{className:"ui-entity-editor-included-area-content-block"},children:[this._includedAreaContainer]});this._wrapper.appendChild(this._contentContainer);this._container.appendChild(this._wrapper);this.loadArea();if(this._editor.canChangeScheme()&&this._schemeElement.getDataBooleanParam("showButtonPanel",true)){this.showButtonPanel()}this._hasLayout=true};BX.UI.EntityEditorIncludedArea.prototype.clearLayout=function(){this._buttonPanelWrapper=BX.remove(this._buttonPanelWrapper);this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.UI.EntityEditorIncludedArea.prototype.loadArea=function(){if(this._includedAreaContainer&&this._loadedHtml){BX.html(this._includedAreaContainer,this._loadedHtml);return}var c=this._schemeElement.getDataStringParam("action");if(!BX.type.isNotEmptyString(c)){return}var b=this.prepareConfigForAction();BX.onCustomEvent(window,"BX.UI.EntityEditorIncludedArea:onBeforeLoad",[this,b]);if(this._schemeElement.getDataStringParam("type","")==="component"){var a=this._schemeElement.getDataStringParam("componentName","");if(!BX.type.isNotEmptyString(a)){return}b.mode=this._schemeElement.getDataStringParam("mode","ajax");BX.ajax.runComponentAction(a,c,b).then(this.onLoadAreaSuccess.bind(this))}else{BX.ajax.runAction(c,b).then(this.onLoadAreaSuccess.bind(this))}};BX.UI.EntityEditorIncludedArea.prototype.prepareConfigForAction=function(){var c={};var a=this._schemeElement.getDataStringParam("dataName","");if(BX.type.isNotEmptyString(a)){var d=this._model.getField(a,{});if(BX.type.isPlainObject(d)){c.data=d}}var e=this._schemeElement.getDataStringParam("signedParametersName","");if(BX.type.isNotEmptyString(e)){var b=this._model.getField(e,"");if(BX.type.isNotEmptyString(b)){c.signedParameters=b}}return c};BX.UI.EntityEditorIncludedArea.prototype.onLoadAreaSuccess=function(a){this._loadedHtml=BX.prop.getString(BX.prop.getObject(a,"data",{}),"html",null);BX.html(this._includedAreaContainer,this._loadedHtml);BX.onCustomEvent(window,"BX.UI.EntityEditorIncludedArea:onAfterLoad",[this])};BX.UI.EntityEditorIncludedArea.create=function(c,b){var a=new BX.UI.EntityEditorIncludedArea();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorText==="undefined"){BX.UI.EntityEditorText=function(){BX.UI.EntityEditorText.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorText,BX.UI.EntityEditorField);BX.UI.EntityEditorText.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorText.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorText.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.UI.EntityEditorText.prototype.getLineCount=function(){return this._schemeElement.getDataIntegerParam("lineCount",1)};BX.UI.EntityEditorText.prototype.layout=function(a){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(a);this._hasLayout=true;return}var c=this.getTitle();var b=this.getValue();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(c));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:this.getEditModeHtmlNodes()})}else{this._wrapper.appendChild(this.createTitleNode(c));if(this.hasContentToDisplay()){if(this.getLineCount()>1){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},html:BX.util.nl2br(BX.util.htmlspecialchars(b))})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:b})]})}}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(a);this._hasLayout=true};BX.UI.EntityEditorText.prototype.getEditModeHtmlNodes=function(){var b=this.getValue();var a=this.getLineCount();this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});if(a>1){this._input=BX.create("textarea",{props:{className:"ui-entity-editor-field-textarea",rows:a,value:b}})}else{this._input=BX.create("input",{attrs:{className:"ui-ctl-element",type:"text",value:b,id:this._id.toLowerCase()+"_text"}})}if(!this.isVirtual()){this._input.name=this.getName()}this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var c=this.getCreationPlaceholder();if(c!==""){this._input.setAttribute("placeholder",c)}}BX.bind(this._input,"input",this._changeHandler);return[this._input]};BX.UI.EntityEditorText.prototype.doClearLayout=function(a){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorText.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorText.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else{if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=BX.util.htmlspecialchars(this.getValue())}}};BX.UI.EntityEditorText.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):"")};BX.UI.EntityEditorText.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorText. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return b};BX.UI.EntityEditorText.prototype.showError=function(b,a){BX.UI.EntityEditorText.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorText.prototype.clearError=function(){BX.UI.EntityEditorText.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorText.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.UI.EntityEditorText.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorText.prototype.getFocusInputID=function(){return this._id.toLowerCase()+"_text"};BX.UI.EntityEditorText.create=function(c,b){var a=new BX.UI.EntityEditorText();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorMultiText==="undefined"){BX.UI.EntityEditorMultiText=function(){BX.UI.EntityEditorMultiText.superclass.constructor.apply(this);this._items=null;this._input=null;this._select=null;this._inputValue=[];this._addInputHandler=BX.delegate(this.addInputField,this);this._innerWrapper=null;this._isOpened=false};BX.extend(BX.UI.EntityEditorMultiText,BX.UI.EntityEditorField);BX.UI.EntityEditorMultiText.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorMultiText.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorMultiText.prototype.hasContentToDisplay=function(){var a=this.getValue();if(!BX.type.isArray(a)||a.length===0){return false}var b=a.filter(function(c){return BX.type.isNotEmptyString(""+c)});return(b.length>0)};BX.UI.EntityEditorMultiText.prototype.getLineCount=function(){return this._schemeElement.getDataIntegerParam("lineCount",1)};BX.UI.EntityEditorMultiText.prototype.createSingleInput=function(a){var b=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});if(this.getLineCount()>1){b.appendChild(BX.create("textarea",{props:{className:"ui-ctl-element ui-entity-editor-field-textarea",name:this.getName()+"[]",rows:this.getLineCount(),value:a||""},events:{input:this._changeHandler}}))}else{b.appendChild(BX.create("input",{attrs:{name:this.getName()+"[]",className:"ui-ctl-element",type:"text",value:a||""},events:{input:this._changeHandler}}))}return b};BX.UI.EntityEditorMultiText.prototype.getCloneButton=function(){return BX.create("input",{attrs:{type:"button",value:BX.message("UI_ENTITY_EDITOR_ADD"),},events:{click:this._addInputHandler}})};BX.UI.EntityEditorMultiText.prototype.addInputField=function(b){if(BX.type.isDomNode(this._inputContainer)){var a=this.createSingleInput();this._inputContainer.appendChild(a);a.querySelector(".ui-ctl-element").focus()}};BX.UI.EntityEditorMultiText.prototype.onChange=function(c){this._inputValue=[];for(var a=0;a<this._inputContainer.children.length;a++){var b=this._inputContainer.children[a].querySelector("input");if(BX.type.isDomNode(b)&&b.value!==""){this._inputValue.push(b.value)}}this.markAsChanged()};BX.UI.EntityEditorMultiText.prototype.layout=function(e){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-multitext"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(e);this._hasLayout=true;return}var h=this.getTitle();var c=this.getValue();this._inputValue=c;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(h));this._inputContainer=BX.create("div");if(c.length>0){for(var f=0,b=c.length;f<b;f++){this._inputContainer.appendChild(this.createSingleInput(c[f]))}}else{var d=this.createSingleInput();this._inputContainer.appendChild(d);if(this.isNewEntity()){var g=this.getCreationPlaceholder();if(g!==""){this._input.setAttribute("placeholder",g)}}}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer,this.getCloneButton()]})}else{this._wrapper.appendChild(this.createTitleNode(h));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this.getViewInnerLayout()]})}this._wrapper.appendChild(this._innerWrapper);if(d){var a=d.querySelector(".ui-ctl-element");if(a){a.focus()}}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(e);this._hasLayout=true};BX.UI.EntityEditorMultiText.prototype.getViewInnerLayout=function(){var a=BX.create("div",{props:{className:"ui-entity-editor-content-block-text"}});if(!this.hasContentToDisplay()){a.innerHTML=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}else{var b=this.getValue();for(var c=0;c<b.length;c++){a.appendChild(this.getSingleViewItem(b[c]))}}return a};BX.UI.EntityEditorMultiText.prototype.getSingleViewItem=function(a){return BX.create("p",{text:a})};BX.UI.EntityEditorMultiText.prototype.doClearLayout=function(a){this._select=null;this._innerWrapper=null};BX.UI.EntityEditorMultiText.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorMultiText.superclass.refreshLayout.apply(this,arguments);return}var b=this.getValue();if(this._mode===BX.UI.EntityEditorMode.edit&&this._inputContainer){for(var c=0,a=b.length;c<a;c++){this._inputContainer.appendChild(this.createSingleInput(b[c]))}}else{if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML="";this._innerWrapper.appendChild(this.getViewInnerLayout())}}};BX.UI.EntityEditorMultiText.prototype.validate=function(a){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorMultiText. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var e=true;if(this._inputContainer){var b=this._inputContainer.querySelectorAll("input");for(var c=0;c<b.length;c++){if(BX.util.trim(b[c].value)!==""){e=false}}}var d=!this.isRequired()||!e;if(!d){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return d};BX.UI.EntityEditorMultiText.prototype.showError=function(b,a){BX.UI.EntityEditorMultiText.superclass.showError.apply(this,arguments);if(this._inputContainer){for(var c=0;this._inputContainer.children.length<c;c++){BX.addClass(this._inputContainer.children[c],"ui-ctl-danger")}}};BX.UI.EntityEditorMultiText.prototype.clearError=function(){BX.UI.EntityEditorMultiText.superclass.clearError.apply(this);for(var a=0;this._inputContainer.children.length<a;a++){BX.removeClass(this._inputContainer.children[a],"ui-ctl-danger")}};BX.UI.EntityEditorMultiText.prototype.save=function(){if(!this.isEditable()){return}this._model.setField(this.getName(),this._inputValue)};BX.UI.EntityEditorMultiText.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorMultiText.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?this._inputValue:"")};BX.UI.EntityEditorMultiText.prototype.getValue=function(){var a=BX.UI.EntityEditorBoolean.superclass.getValue.apply(this);if(!BX.type.isArray(a)&&a!==""){return[a]}return a};BX.UI.EntityEditorMultiText.create=function(c,b){var a=new BX.UI.EntityEditorMultiText();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorMultiDatetime==="undefined"){BX.UI.EntityEditorMultiDatetime=function(){BX.UI.EntityEditorMultiDatetime.superclass.constructor.apply(this);this._input=null;this._inputClickHandler=BX.delegate(this.onInputClick,this);this._innerWrapper=null};BX.extend(BX.UI.EntityEditorMultiDatetime,BX.UI.EntityEditorMultiText);BX.UI.EntityEditorMultiDatetime.prototype.isTimeEnabled=function(){return BX.prop.get(this._schemeElement.getData(),"enableTime",true)};BX.UI.EntityEditorMultiDatetime.prototype.onInputClick=function(a){this.showCalendar(a.target)};BX.UI.EntityEditorMultiDatetime.prototype.showCalendar=function(a){if(BX.type.isDomNode(a)){BX.calendar({node:a,field:a,bTime:this.isTimeEnabled(),bSetFocus:false})}};BX.UI.EntityEditorMultiDatetime.prototype.getDateFormat=function(){var a="j F Y";if(this.isTimeEnabled()){a="j F Y H:i"}return BX.prop.getString(this._schemeElement.getData(),"dateViewFormat",a)};BX.UI.EntityEditorMultiDatetime.prototype.getSingleViewItem=function(a){return BX.create("p",{text:BX.date.format(this.getDateFormat(),BX.parseDate(a))})};BX.UI.EntityEditorMultiDatetime.prototype.createSingleInput=function(a){return BX.create("div",{attrs:{className:"ui-ctl ui-ctl-after-icon ui-ctl-datetime field-wrap"},children:[BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-calendar"}}),BX.create("input",{attrs:{name:this.getName()+"[]",className:"ui-ctl-element",type:"text",value:a||""},events:{input:this._changeHandler,change:this._changeHandler,click:this._inputClickHandler,}})]})};BX.UI.EntityEditorMultiDatetime.create=function(c,b){var a=new BX.UI.EntityEditorMultiDatetime();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorMultiNumber==="undefined"){BX.UI.EntityEditorMultiNumber=function(){BX.UI.EntityEditorMultiNumber.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorMultiNumber,BX.UI.EntityEditorMultiText);BX.UI.EntityEditorMultiNumber.prototype.createSingleInput=function(a){return BX.create("div",{attrs:{className:"ui-ctl ui-ctl-number field-wrap"},children:[BX.create("input",{attrs:{name:this.getName()+"[]",className:"ui-ctl-element",type:"number",value:a||""},events:{input:this._changeHandler}})]})};BX.UI.EntityEditorMultiNumber.create=function(c,b){var a=new BX.UI.EntityEditorMultiNumber();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorTextarea==="undefined"){BX.UI.EntityEditorTextarea=function(){BX.UI.EntityEditorText.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorTextarea,BX.UI.EntityEditorField);BX.UI.EntityEditorTextarea.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorTextarea.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorTextarea.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.UI.EntityEditorTextarea.prototype.layout=function(b){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(b);this._hasLayout=true;return}var a=this.getName();var e=this.getTitle();var c=this.getValue();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(e));this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textarea ui-ctl-no-resize ui-ctl-w100"}});this._input=BX.create("textarea",{attrs:{name:a,className:"ui-ctl-element",id:this._id.toLowerCase()+"_text"},children:c});this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var d=this.getCreationPlaceholder();if(d!==""){this._input.setAttribute("placeholder",d)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(e));if(this.hasContentToDisplay()){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},html:BX.util.nl2br(BX.util.htmlspecialchars(c))})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(b);this._hasLayout=true};BX.UI.EntityEditorTextarea.prototype.doClearLayout=function(a){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorTextarea.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorTextarea.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else{if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=BX.util.htmlspecialchars(this.getValue())}}};BX.UI.EntityEditorTextarea.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):"")};BX.UI.EntityEditorTextarea.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorTextarea. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return b};BX.UI.EntityEditorTextarea.prototype.showError=function(b,a){BX.UI.EntityEditorTextarea.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorTextarea.prototype.clearError=function(){BX.UI.EntityEditorTextarea.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorTextarea.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.UI.EntityEditorTextarea.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorTextarea.prototype.getFocusInputID=function(){return this._id.toLowerCase()+"_text"};BX.UI.EntityEditorTextarea.create=function(c,b){var a=new BX.UI.EntityEditorTextarea();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorNumber==="undefined"){BX.UI.EntityEditorNumber=function(){BX.UI.EntityEditorNumber.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorNumber,BX.UI.EntityEditorField);BX.UI.EntityEditorNumber.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorNumber.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorNumber.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().selectAll(this._input)};BX.UI.EntityEditorNumber.prototype.layout=function(b){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-content-block-field-number"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(b);this._hasLayout=true;return}var a=this.getName();var e=this.getTitle();var c=this.getValue();if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._input=null;if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(e));this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox"}});this._input=BX.create("input",{attrs:{name:a,className:"ui-ctl-element",type:"number",value:c,id:this._id.toLowerCase()+"_text"}});this._inputContainer.appendChild(this._input);if(this.isNewEntity()){var d=this.getCreationPlaceholder();if(d!==""){this._input.setAttribute("placeholder",d)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(e));if(!this.hasContentToDisplay()){c=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-number"},text:c})]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(b);this._hasLayout=true};BX.UI.EntityEditorNumber.prototype.doClearLayout=function(a){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorNumber.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):"")};BX.UI.EntityEditorNumber.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorNumber. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return b};BX.UI.EntityEditorNumber.prototype.showError=function(b,a){BX.UI.EntityEditorNumber.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"ui-entity-editor-field-error")}};BX.UI.EntityEditorNumber.prototype.clearError=function(){BX.UI.EntityEditorNumber.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-entity-editor-field-error")}};BX.UI.EntityEditorNumber.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value)}};BX.UI.EntityEditorNumber.create=function(c,b){var a=new BX.UI.EntityEditorNumber();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorDatetime==="undefined"){BX.UI.EntityEditorDatetime=function(){BX.UI.EntityEditorDatetime.superclass.constructor.apply(this);this._input=null;this._inputClickHandler=BX.delegate(this.onInputClick,this);this._innerWrapper=null};BX.extend(BX.UI.EntityEditorDatetime,BX.UI.EntityEditorField);BX.UI.EntityEditorDatetime.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorDatetime.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorDatetime.prototype.focus=function(){if(this._input){BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().selectAll(this._input)}};BX.UI.EntityEditorDatetime.prototype.layout=function(b){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-date"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(b);this._hasLayout=true;return}var a=this.getName();var d=this.getTitle();var c=this.getValue();this._input=null;this._inputIcon=null;this._innerContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._input=BX.create("input",{attrs:{name:a,className:"ui-ctl-element",type:"text",value:c}});BX.bind(this._input,"click",this._inputClickHandler);BX.bind(this._input,"change",this._changeHandler);BX.bind(this._input,"input",this._changeHandler);this._inputIcon=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-calendar"}});this._wrapper.appendChild(this.createTitleNode(d));this._innerContainer=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-datetime ui-ctl-w50"},children:[this._inputIcon,this._input]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._innerContainer]})}else{c=BX.date.format(this.getDateFormat(),BX.parseDate(c));this._wrapper.appendChild(this.createTitleNode(d));if(!this.hasContentToDisplay()){c=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:c})]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(b);this._hasLayout=true};BX.UI.EntityEditorDatetime.prototype.doRegisterLayout=function(){};BX.UI.EntityEditorDatetime.prototype.doClearLayout=function(a){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorDatetime.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):"")};BX.UI.EntityEditorDatetime.prototype.isTimeEnabled=function(){return BX.prop.get(this._schemeElement.getData(),"enableTime",true)};BX.UI.EntityEditorDatetime.prototype.onInputClick=function(a){this.showCalendar()};BX.UI.EntityEditorDatetime.prototype.showCalendar=function(){BX.calendar({node:this._input,field:this._input,bTime:this.isTimeEnabled(),bSetFocus:false})};BX.UI.EntityEditorDatetime.prototype.getDateFormat=function(){var a="j F Y";if(this.isTimeEnabled()){a="j F Y H:i"}return BX.prop.getString(this._schemeElement.getData(),"dateViewFormat",a)};BX.UI.EntityEditorDatetime.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorDatetime. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return b};BX.UI.EntityEditorDatetime.prototype.showError=function(b,a){BX.UI.EntityEditorDatetime.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorDatetime.prototype.clearError=function(){BX.UI.EntityEditorDatetime.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorDatetime.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value)}};BX.UI.EntityEditorDatetime.create=function(c,b){var a=new BX.UI.EntityEditorDatetime();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorBoolean==="undefined"){BX.UI.EntityEditorBoolean=function(){BX.UI.EntityEditorBoolean.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null};BX.extend(BX.UI.EntityEditorBoolean,BX.UI.EntityEditorField);BX.UI.EntityEditorBoolean.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorBoolean.prototype.doInitialize=function(){BX.UI.EntityEditorBoolean.superclass.doInitialize.apply(this);this._selectedValue=this._model.getField(this._schemeElement.getName())};BX.UI.EntityEditorBoolean.prototype.areAttributesEnabled=function(){return false};BX.UI.EntityEditorBoolean.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorBoolean.prototype.hasValue=function(){return BX.util.trim(this.getValue())!==""};BX.UI.EntityEditorBoolean.prototype.getValue=function(a){if(!this._model){return""}if(a===undefined){a="N"}var b=this._model.getStringField(this.getName(),a);if(b!==this.getCheckedValue()&&b!=="N"){b="N"}return b};BX.UI.EntityEditorBoolean.prototype.getRuntimeValue=function(){if(this._mode!==BX.UI.EntityEditorMode.edit||!this._input){return""}var a=BX.util.trim(this._input.value);if(a!=="Y"&&a!=="N"){a="N"}return a};BX.UI.EntityEditorBoolean.prototype.getCheckedValue=function(){return this._schemeElement.getDataParam("value","Y")};BX.UI.EntityEditorBoolean.prototype.isChecked=function(){return(this.getValue()===this.getCheckedValue())};BX.UI.EntityEditorBoolean.prototype.layout=function(b){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-checkbox"]});this.adjustWrapper();var a=this.getName();var d=this.getTitle();var c=this.getValue();this._input=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(BX.create("input",{attrs:{name:a,type:"hidden",value:"N"}}));this._input=BX.create("input",{attrs:{className:"ui-ctl-element",name:a,type:"checkbox",value:this.getCheckedValue(),checked:this.isChecked(),}});BX.bind(this._input,"change",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("label",{props:{className:"ui-ctl ui-ctl-xs ui-ctl-w100 ui-ctl-checkbox"},children:[this._input,BX.create("div",{attrs:{className:"ui-ctl-label-text"},text:d})]})]})}else{this._wrapper.appendChild(this.createTitleNode(d));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},text:BX.message(this.isChecked()?"UI_ENTITY_EDITOR_YES":"UI_ENTITY_EDITOR_NO")})]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(b);this._hasLayout=true};BX.UI.EntityEditorBoolean.prototype.doClearLayout=function(a){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorBoolean.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorBoolean. Invalid validation context"}if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._input.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));BX.addClass(this._inputContainer,"ui-ctl-danger");this.showRequiredFieldError(this._input)}else{BX.removeClass(this._input,"ui-ctl-danger");this.clearError()}return b};BX.UI.EntityEditorBoolean.prototype.showError=function(b,a){BX.UI.EntityEditorBoolean.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._inputContainer,"ui-ctl-danger")}};BX.UI.EntityEditorBoolean.prototype.clearError=function(){BX.UI.EntityEditorBoolean.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-ctl-danger")}};BX.UI.EntityEditorBoolean.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.checked?"Y":"N",{originator:this})}};BX.UI.EntityEditorBoolean.create=function(c,b){var a=new BX.UI.EntityEditorBoolean();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorList==="undefined"){BX.UI.EntityEditorList=function(){BX.UI.EntityEditorList.superclass.constructor.apply(this);this._items=null;this._input=null;this._select=null;this._selectContainer=null;this._selectedValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._innerWrapper=null;this._isOpened=false};BX.extend(BX.UI.EntityEditorList,BX.UI.EntityEditorField);BX.UI.EntityEditorList.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorList.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorList.prototype.checkIfNotEmpty=function(a){return a!==""&&a!=="0"};BX.UI.EntityEditorList.prototype.layout=function(b){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-select"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(b);this._hasLayout=true;return}var a=this.getName();var h=this.getTitle();var f=this.getValue();var c=this.getItemByValue(f);var e=this.getDataBooleanParam("isHtml",false);var d={};if(!c){c=this.getFirstItem();if(c){f=c.VALUE}}this._selectedValue=f;this._select=null;this._selectIcon=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(h));this._input=BX.create("input",{attrs:{name:a,type:"hidden",value:f}});this._wrapper.appendChild(this._input);d={props:{className:"ui-ctl-element"}};if(e){d.html=(c?c.NAME:f)}else{d.text=(c?c.NAME:f)}this._select=BX.create("div",d);BX.bind(this._select,"click",this._selectorClickHandler);this._selectIcon=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-angle"}});this._selectContainer=BX.create("div",{props:{className:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100"},children:[this._select,this._selectIcon]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._selectContainer]})}else{this._wrapper.appendChild(this.createTitleNode(h));var g="";if(!this.hasContentToDisplay()){g=BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}else{if(c){g=c.NAME}else{g=f}}d={props:{className:"ui-entity-editor-content-block-text"}};if(e){d.html=g}else{d.text=g}this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",d)]})}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(b);this._hasLayout=true};BX.UI.EntityEditorList.prototype.doRegisterLayout=function(){};BX.UI.EntityEditorList.prototype.doClearLayout=function(a){this.closeMenu();this._input=null;this._select=null;this._innerWrapper=null};BX.UI.EntityEditorList.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorList.superclass.refreshLayout.apply(this,arguments);return}var b=this.getValue();var a=this.getItemByValue(b);var c=a?BX.prop.getString(a,"NAME",b):b;if(this._mode===BX.UI.EntityEditorMode.edit){this._selectedValue=b;if(this._input){this._input.value=b}if(this._select){this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?c:BX.util.htmlspecialchars(c)}}else{if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=this.getDataBooleanParam("isHtml",false)?c:BX.util.htmlspecialchars(c)}}};BX.UI.EntityEditorList.prototype.validate=function(a){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorList. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||(this._input&&BX.util.trim(this._input.value)!=="");if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return b};BX.UI.EntityEditorList.prototype.showError=function(b,a){BX.UI.EntityEditorList.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._selectContainer,"ui-ctl-danger")}};BX.UI.EntityEditorList.prototype.clearError=function(){BX.UI.EntityEditorList.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._selectContainer,"ui-ctl-danger")}};BX.UI.EntityEditorList.prototype.onSelectorClick=function(a){if(!this._isOpened){this.openMenu()}else{this.closeMenu()}};BX.UI.EntityEditorList.prototype.openMenu=function(){if(this._isOpened){return}var g=[];var a=this.getItems();for(var c=0,e=a.length;c<e;c++){var d=a[c];if(!BX.prop.getBoolean(d,"IS_EDITABLE",true)){continue}var f=BX.prop.getString(d,"VALUE",c);var b=BX.prop.getString(d,"NAME",f);g.push({text:this.getDataBooleanParam("isHtml",false)?b:BX.util.htmlspecialchars(b),value:f,onclick:BX.delegate(this.onItemSelect,this)})}BX.PopupMenu.show(this._id,this._select,g,{angle:false,width:this._select.offsetWidth+"px",events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(this._select)["width"])};BX.UI.EntityEditorList.prototype.closeMenu=function(){var a=BX.PopupMenu.getMenuById(this._id);if(a){a.popupWindow.close()}};BX.UI.EntityEditorList.prototype.onMenuShow=function(){BX.addClass(this._selectContainer,"ui-ctl-active");this._isOpened=true};BX.UI.EntityEditorList.prototype.onMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"ui-ctl-active");this._isOpened=false};BX.UI.EntityEditorList.prototype.onItemSelect=function(d,c){this.closeMenu();var a={field:this,item:c,cancel:false};BX.onCustomEvent(window,"BX.UI.EntityEditorList:onItemSelect",[this,a]);if(a.cancel){return}this._selectedValue=this._input.value=c.value;var b=BX.prop.getString(this.getItemByValue(this._selectedValue),"NAME",this._selectedValue);this._select.innerHTML=this.getDataBooleanParam("isHtml",false)?b:BX.util.htmlspecialchars(b);this.markAsChanged();BX.PopupMenu.destroy(this._id)};BX.UI.EntityEditorList.prototype.setItems=function(a){if(!BX.type.isArray(a)){a=BX.prop.getArray(this._schemeElement.getData(),"items",[])}if(!this.isRequired()&&BX.prop.get(this._schemeElement.getData(),"enableEmptyItem",false)){var b=a.filter(function(c){return(c.VALUE==="")});if(b.length===0){a.unshift({VALUE:"",NAME:BX.message("UI_ENTITY_EDITOR_NOT_SELECTED")})}}this._items=a};BX.UI.EntityEditorList.prototype.getItems=function(){if(!this._items){this.setItems()}return this._items};BX.UI.EntityEditorList.prototype.getItemByValue=function(e){var b=this.getItems();for(var c=0,a=b.length;c<a;c++){var d=b[c];if(e===BX.prop.getString(d,"VALUE","")){return d}}return null};BX.UI.EntityEditorList.prototype.getFirstItem=function(){var a=this.getItems();return a.length>0?a[0]:null};BX.UI.EntityEditorList.prototype.save=function(){if(!this.isEditable()){return}this._model.setField(this.getName(),this._selectedValue)};BX.UI.EntityEditorList.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorList.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?this._selectedValue:"")};BX.UI.EntityEditorList.create=function(c,b){var a=new BX.UI.EntityEditorList();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorMultiList==="undefined"){BX.UI.EntityEditorMultiList=function(){BX.UI.EntityEditorMultiList.superclass.constructor.apply(this);this._items=null;this._selector=null;this._selectedValues=[];this._hiddenNode="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._innerWrapper=null;this._isOpened=false};BX.extend(BX.UI.EntityEditorMultiList,BX.UI.EntityEditorField);BX.UI.EntityEditorMultiList.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorMultiList.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorMultiList.prototype.hasContentToDisplay=function(){var a=this.getValue();this.getItems();if(!BX.type.isArray(a)||a.length===0){return false}var b=this._items.filter(function(c){return BX.util.in_array(c.VALUE,a)});return(b.length>0)};BX.UI.EntityEditorMultiList.prototype.layout=function(k){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-multiselect"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(k);this._hasLayout=true;return}var a=this.getId();var g=this.getTitle();var h=this.getValue();this._selectedValues=this.getSelectedValues(h);if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(g));var d={isMulti:true,fieldName:a};if(!this._selector){this._selector=BX.decl({block:"main-ui-multi-select",name:a,items:this._items,value:this._selectedValues,params:d,valueDelete:true})}var c=BX.create("div",{props:{className:"fields enumeration field-item"},children:[this._selector]});BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this.onChange,this));BX.bind(c,"click",BX.defer(function(){this.onChange({params:d,node:c.firstChild})},this));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}});this._innerWrapper.appendChild(c);this.layoutHidden();this._innerWrapper.appendChild(this._hiddenNode)}else{this._wrapper.appendChild(this.createTitleNode(g));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}});if(!this.hasContentToDisplay()){this._innerWrapper.appendChild(BX.create("div",{text:this.getMessage("isEmpty")}))}else{var e=[];for(var f=0;f<this._selectedValues.length;f++){var j=this.getItemByValue(this._selectedValues[f].VALUE);var b=(BX.type.isNotEmptyString(j.NAME))?"NAME":"VALUE";e.push(j[b])}if(e.length>0){this._innerWrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:e.join(", ")}))}}}this._wrapper.appendChild(this._innerWrapper);if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(k);this._hasLayout=true};BX.UI.EntityEditorMultiList.prototype.doClearLayout=function(a){this._selector=null;this._innerWrapper=null};BX.UI.EntityEditorMultiList.prototype.layoutHidden=function(){if(!BX.type.isDomNode(this._hiddenNode)){this._hiddenNode=BX.create("div")}else{this._hiddenNode.innerHTML=""}var b=this._selectedValues.length;if(b>0){for(var a=0;a<b;a++){this._hiddenNode.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.getName()+"[]",value:this._selectedValues[a].VALUE}}))}}else{this._hiddenNode.appendChild(BX.create("input",{attrs:{type:"hidden",name:this.getName()+"[]"}}))}};BX.UI.EntityEditorMultiList.prototype.validate=function(a){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorMultiList. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!this.isRequired()||this._selectedValues.length>0;if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._selector)}return b};BX.UI.EntityEditorMultiList.prototype.showError=function(b,a){BX.UI.EntityEditorMultiList.superclass.showError.apply(this,arguments);if(this._selector){BX.addClass(this._selector,"ui-entity-editor-field-error")}};BX.UI.EntityEditorMultiList.prototype.clearError=function(){BX.UI.EntityEditorMultiList.superclass.clearError.apply(this);if(this._selector){BX.removeClass(this._selector,"ui-entity-editor-field-error")}};BX.UI.EntityEditorMultiList.prototype.onChange=function(a){if(a.params.fieldName===this.getName()&&this._selector){this._selectedValues=JSON.parse(this._selector.getAttribute("data-value"));this.layoutHidden();this.markAsChanged()}};BX.UI.EntityEditorMultiList.prototype.getItems=function(){if(!this._items){this._items=BX.prop.getArray(this._schemeElement.getData(),"items",[])}return this._items};BX.UI.EntityEditorMultiList.prototype.getItemByValue=function(e){var b=this.getItems();for(var c=0,a=b.length;c<a;c++){var d=b[c];if(e===BX.prop.getString(d,"VALUE","")){return d}}return null};BX.UI.EntityEditorMultiList.prototype.getSelectedValues=function(d){var a=[];var c=this.getItems();if(!BX.type.isArray(d)){return[]}for(var e=0;e<d.length;e++){value=""+d[e];for(var f=0,b=c.length;f<b;f++){var g=c[f];if(value===BX.prop.getString(g,"VALUE","")){a.push(g)}}}return a};BX.UI.EntityEditorMultiList.prototype.getFirstItem=function(){var a=this.getItems();return a.length>0?a[0]:null};BX.UI.EntityEditorMultiList.prototype.save=function(){if(!this.isEditable()){return}this._model.setField(this.getName(),this.getRuntimeValue())};BX.UI.EntityEditorMultiList.prototype.getRuntimeValue=function(){var b=[];if(this._mode===BX.UI.EntityEditorMode.edit&&this._selector){for(var a=0;a<this._selectedValues.length;a++){b.push(this._selectedValues[a].VALUE)}}return b};BX.UI.EntityEditorMultiList.prototype.setItems=function(a){if(!BX.type.isArray(a)){a=BX.prop.getArray(this._schemeElement.getData(),"items",[])}this._items=a};BX.UI.EntityEditorMultiList.create=function(c,b){var a=new BX.UI.EntityEditorMultiList();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorHtml==="undefined"){BX.UI.EntityEditorHtml=function(){BX.UI.EntityEditorHtml.superclass.constructor.apply(this);this._htmlEditorContainer=null;this._htmlEditor=null;this._isEditorInitialized=false;this._focusOnLoad=false;this._input=null;this._innerWrapper=null;this._editorInitializationHandler=BX.delegate(this.onEditorInitialized,this);this._viewClickHandler=BX.delegate(this.onViewClick,this)};BX.extend(BX.UI.EntityEditorHtml,BX.UI.EntityEditorField);BX.UI.EntityEditorHtml.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorHtml.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorHtml.prototype.checkIfNotEmpty=function(a){return BX.UI.EntityEditorHtml.isNotEmptyValue(a)};BX.UI.EntityEditorHtml.prototype.focus=function(){if(this._htmlEditor&&this._isEditorInitialized){this._htmlEditor.Focus(true)}else{this._focusOnLoad=true}};BX.UI.EntityEditorHtml.prototype.layout=function(b){if(this._hasLayout){return}this.release();this.ensureWrapperCreated({classNames:["ui-entity-editor-content-block-field-html"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(b);this._hasLayout=true;return}var a=this.getName();var e=this.getTitle();var c=this.getValue();this._input=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){if(!this._editor){throw"BX.UI.EntityEditorHtml: Editor instance is required for create layout."}var d=this._editor.getHtmlEditorConfig(a);if(!d){throw"BX.UI.EntityEditorHtml: Could not find HTML editor config."}this._htmlEditorContainer=BX(BX.prop.getString(d,"containerId"));if(!BX.type.isElementNode(this._htmlEditorContainer)){throw"BX.UI.EntityEditorHtml: Could not find HTML editor container."}this._htmlEditor=BXHtmlEditor.Get(BX.prop.getString(d,"id"));if(!this._htmlEditor){throw"BX.UI.EntityEditorHtml: Could not find HTML editor instance."}this._wrapper.appendChild(this.createTitleNode(e));this._input=BX.create("input",{attrs:{name:a,type:"hidden",value:c}});this._wrapper.appendChild(this._input);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-field-container"},children:[this._htmlEditorContainer]})]})}else{this._wrapper.appendChild(this.createTitleNode(e));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}});if(this.hasContentToDisplay()){this._innerWrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block-field-container"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-inner-html"},html:c})]}));if(c.length>200){BX.addClass(this._wrapper,"ui-entity-editor-content-block-field-html-collapsed");this._innerWrapper.appendChild(BX.create("DIV",{attrs:{className:"ui-entity-editor-content-block-field-html-expand-btn-container"},children:[BX.create("A",{attrs:{className:"ui-entity-editor-content-block-field-html-expand-btn",href:"#"},events:{click:BX.delegate(this.onExpandButtonClick,this)},text:BX.message("UI_ENTITY_EDITOR_EXPAND_HTML")})]}));this._isCollapsed=true}}else{this._innerWrapper.appendChild(document.createTextNode(BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")))}this._wrapper.appendChild(this._innerWrapper);BX.bindDelegate(this._wrapper,"mousedown",BX.delegate(this.filterViewNode,this),this._viewClickHandler)}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(b);if(this._mode===BX.UI.EntityEditorMode.edit){this._isEditorInitialized=!!this._htmlEditor.inited;if(this._isEditorInitialized){this.prepareEditor()}else{BX.addCustomEvent(this._htmlEditor,"OnCreateIframeAfter",this._editorInitializationHandler);this._htmlEditor.Init()}window.top.setTimeout(BX.delegate(this.bindChangeEvent,this),1000);this.initializeDragDropAbilities()}this._hasLayout=true};BX.UI.EntityEditorHtml.prototype.doClearLayout=function(a){this.release();this._input=null;this._innerWrapper=null};BX.UI.EntityEditorHtml.prototype.onExpandButtonClick=function(c){if(!this._wrapper){return BX.PreventDefault(c)}if(this._hasFiles&&BX.type.isDomNode(this._commentWrapper)&&!this._textLoaded){this._textLoaded=true;this.loadContent(this._commentWrapper,"GET_TEXT")}var a=this._wrapper.querySelector(".ui-entity-editor-content-block-inner-html");if(this._isCollapsed){BX.defer(function(){a.style.height=a.scrollHeight+20+"px";a.style.maxHeight=a.scrollHeight+130+"px"})();setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"ui-entity-editor-content-block-field-html-collapsed");BX.addClass(this._wrapper,"ui-entity-editor-content-block-field-html-expand");a.style.maxHeight=""},this),200)}else{BX.defer(function(){a.style.maxHeight=a.clientHeight+"px"})();BX.defer(function(){BX.removeClass(this._wrapper,"ui-entity-editor-content-block-field-html-expand");BX.addClass(this._wrapper,"ui-entity-editor-content-block-field-html-collapsed")},this)();setTimeout(function(){a.style.maxHeight=""},200)}this._isCollapsed=!this._isCollapsed;var b=this._wrapper.querySelector("a.ui-entity-editor-content-block-field-html-expand-btn");if(b){b.innerHTML=BX.message(this._isCollapsed?"UI_ENTITY_EDITOR_EXPAND_HTML":"UI_ENTITY_EDITOR_COLLAPSE_HTML")}return BX.PreventDefault(c)};BX.UI.EntityEditorHtml.prototype.filterViewNode=function(a){return true};BX.UI.EntityEditorHtml.prototype.onViewClick=function(c){var b=null;var a=BX.getEventTarget(c);if(a.tagName==="A"){b=a}else{b=BX.findParent(a,{tagName:"a"},this._wrapper)}if(b&&b.target!=="_blank"){b.target="_blank"}};BX.UI.EntityEditorHtml.prototype.onEditorInitialized=function(){this._isEditorInitialized=true;BX.removeCustomEvent(this._htmlEditor,"OnCreateIframeAfter",this._editorInitializationHandler);this.prepareEditor()};BX.UI.EntityEditorHtml.prototype.prepareEditor=function(){this._htmlEditorContainer.style.display="";setTimeout(function(){this._htmlEditor.CheckAndReInit();this._htmlEditor.ResizeSceleton("100%",200);this._htmlEditor.SetContent(this.getStringValue(""),true);if(this._focusOnLoad){this._htmlEditor.Focus(true);this._focusOnLoad=false}}.bind(this),0)};BX.UI.EntityEditorHtml.prototype.release=function(){if(this._htmlEditorContainer){var a=BX.create("DIV",{style:{height:this._htmlEditorContainer.offsetHeight+"px",border:"1px solid #bbc4cd",boxSizing:"border-box"}});this._htmlEditorContainer.parentNode.insertBefore(a,this._htmlEditorContainer);document.body.appendChild(this._htmlEditorContainer);this._htmlEditorContainer.style.display="none";this._htmlEditorContainer=null}if(this._htmlEditor){this.unbindChangeEvent();this._htmlEditor.SetContent("");this._htmlEditor=null;this._isEditorInitialized=false}this._focusOnLoad=false};BX.UI.EntityEditorHtml.prototype.bindChangeEvent=function(){if(this._htmlEditor){BX.addCustomEvent(this._htmlEditor,"OnContentChanged",this._changeHandler)}};BX.UI.EntityEditorHtml.prototype.unbindChangeEvent=function(){if(this._htmlEditor){BX.removeCustomEvent(this._htmlEditor,"OnContentChanged",this._changeHandler)}};BX.UI.EntityEditorHtml.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._htmlEditor)){throw"BX.UI.EntityEditorHtml. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||BX.UI.EntityEditorHtml.isNotEmptyValue(this._htmlEditor.GetContent());if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._htmlEditorContainer)}return b};BX.UI.EntityEditorHtml.prototype.showError=function(b,a){BX.UI.EntityEditorHtml.superclass.showError.apply(this,arguments);if(this._htmlEditorContainer){BX.addClass(this._htmlEditorContainer,"ui-entity-editor-content-error")}};BX.UI.EntityEditorHtml.prototype.clearError=function(){BX.UI.EntityEditorHtml.superclass.clearError.apply(this);if(this._htmlEditorContainer){BX.removeClass(this._htmlEditorContainer,"ui-entity-editor-content-error")}};BX.UI.EntityEditorHtml.prototype.save=function(){if(this._htmlEditor){var a=this._input.value=this._htmlEditor.GetContent();this._model.setField(this.getName(),a)}};BX.UI.EntityEditorHtml.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?this._htmlEditor.GetContent():"")};BX.UI.EntityEditorHtml.isNotEmptyValue=function(a){if(BX.type.isNotEmptyString(a)){return BX.util.trim(a.replace(/<br\/?>|&nbsp;/ig,""))!==""}return false};BX.UI.EntityEditorHtml.create=function(c,b){var a=new BX.UI.EntityEditorHtml();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorImage==="undefined"){BX.UI.EntityEditorImage=function(){BX.UI.EntityEditorImage.superclass.constructor.apply(this);this._innerWrapper=null;this._dialogShowHandler=BX.delegate(this.onDialogShow,this);this._dialogCloseHandler=BX.delegate(this.onDialogClose,this);this._fileChangeHandler=BX.delegate(this.onFileChange,this)};BX.extend(BX.UI.EntityEditorImage,BX.UI.EntityEditorField);BX.UI.EntityEditorImage.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorImage.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorImage.prototype.hasContentToDisplay=function(){return(this._mode===BX.UI.EntityEditorMode.edit||this._model.getSchemeField(this._schemeElement,"showUrl","")!=="")};BX.UI.EntityEditorImage.prototype.loadInput=function(){console.error("loadInput is not implemented")};BX.UI.EntityEditorImage.prototype.layout=function(a){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-widget-content-block-field-file"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(a);this._hasLayout=true;return}var b=this.getTitle();this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(b));this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});this.loadInput()}else{this._wrapper.appendChild(this.createTitleNode(b));this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});if(this.hasContentToDisplay()){this._innerWrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner-box"},children:[BX.create("img",{props:{className:"crm-entity-widget-content-block-photo",src:this._model.getSchemeField(this._schemeElement,"showUrl","")}})]}))}else{this._innerWrapper.appendChild(document.createTextNode(this.getMessage("isEmpty")))}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(a);this._hasLayout=true};BX.UI.EntityEditorImage.prototype.doClearLayout=function(a){if(this._innerWrapper){BX.removeCustomEvent(window,"onAfterPopupShow",this._dialogShowHandler);BX.removeCustomEvent(window,"onPopupClose",this._dialogCloseHandler);BX.cleanNode(this._innerWrapper);this._innerWrapper=null}this.unbindFileEvents()};BX.UI.EntityEditorImage.prototype.validate=function(b){var c=0;var a=BX.MFInput?BX.MFInput.get(this.getName().toLowerCase()+"_uploader"):null;if(a){c=a.agent.getItems().length}var d=!(this.isRequired()||this.isRequiredByAttribute())||c>0;if(!d){b.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return d};BX.UI.EntityEditorImage.prototype.bindFileEvents=function(){var a=BX.MFInput?BX.MFInput.get(this.getName().toLowerCase()+"_uploader"):null;if(a){BX.addCustomEvent(a,"onAddFile",this._fileChangeHandler);BX.addCustomEvent(a,"onDeleteFile",this._fileChangeHandler)}};BX.UI.EntityEditorImage.prototype.unbindFileEvents=function(){var a=BX.MFInput?BX.MFInput.get(this.getName().toLowerCase()+"_uploader"):null;if(a){BX.removeCustomEvent(a,"onAddFile",this._fileChangeHandler);BX.removeCustomEvent(a,"onDeleteFile",this._fileChangeHandler)}};BX.UI.EntityEditorImage.prototype.onDialogShow=function(a){if(a.uniquePopupId.indexOf("popupavatarEditor")!==0){return}BX.addCustomEvent(window,"onApply",this._fileChangeHandler);if(this._singleEditController){this._singleEditController.setActiveDelayed(false)}BX.bind(a.popupContainer,"click",function(b){BX.eventCancelBubble(b)})};BX.UI.EntityEditorImage.prototype.onDialogClose=function(a){if(BX.prop.getString(a,"uniquePopupId","").indexOf("popupavatarEditor")!==0){return}BX.removeCustomEvent(window,"onApply",this._fileChangeHandler);if(this._singleEditController){this._singleEditController.setActiveDelayed(true)}};BX.UI.EntityEditorImage.prototype.onFileChange=function(a){this.markAsChanged()};BX.UI.EntityEditorImage.create=function(c,b){var a=new BX.UI.EntityEditorImage();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorLink==="undefined"){BX.UI.EntityEditorLink=function(){BX.UI.EntityEditorLink.superclass.constructor.apply(this);this._input=null;this._innerWrapper=null;this._link_template="";this._link_target=""};BX.extend(BX.UI.EntityEditorLink,BX.UI.EntityEditorField);BX.UI.EntityEditorLink.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorLink.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorLink.prototype.focus=function(){if(!this._input){return}BX.focus(this._input);BX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input)};BX.UI.EntityEditorLink.prototype.getLineCount=function(){return this._schemeElement.getDataIntegerParam("lineCount",1)};BX.UI.EntityEditorLink.prototype.layout=function(e){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["ui-entity-editor-field-text"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(e);this._hasLayout=true;return}var d=this.getName();var h=this.getTitle();var f=this.getValue();var c=this.getLinkTemplate();var b=this.getLinkTarget();this._input=null;this._inputContainer=null;this._innerWrapper=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(h));var a=this.getLineCount();if(a>1){this._input=BX.create("textarea",{props:{className:"ui-entity-editor-field-textarea",name:d,rows:a,value:f}})}else{this._inputContainer=BX.create("div",{attrs:{className:"ui-ctl ui-ctl-textbox ui-ctl-w100"}});this._input=BX.create("input",{attrs:{name:d,className:"ui-ctl-element",type:"text",value:f,id:this._id.toLowerCase()+"_text"}});this._inputContainer.appendChild(this._input)}if(this.isNewEntity()){var g=this.getCreationPlaceholder();if(g!==""){this._input.setAttribute("placeholder",g)}}BX.bind(this._input,"input",this._changeHandler);this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputContainer]})}else{this._wrapper.appendChild(this.createTitleNode(h));if(this.hasContentToDisplay()){this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("a",{props:{className:"ui-entity-editor-content-block-text",href:c.replace("#LINK#",f),target:b},text:f})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(e);this._hasLayout=true};BX.UI.EntityEditorLink.prototype.doClearLayout=function(a){this._input=null;this._innerWrapper=null};BX.UI.EntityEditorLink.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorLink.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else{if(this._mode===BX.UI.EntityEditorMode.view&&this._innerWrapper){this._innerWrapper.innerHTML=BX.util.htmlspecialchars(this.getValue())}}};BX.UI.EntityEditorLink.prototype.getLinkTemplate=function(){if(!this._link_template){this._link_template=BX.prop.get(this._schemeElement.getData(),"link_template","#LINK#")}return this._link_template};BX.UI.EntityEditorLink.prototype.getLinkTarget=function(){if(!this._link_target){this._link_target=BX.prop.get(this._schemeElement.getData(),"target","")}return this._link_target};BX.UI.EntityEditorLink.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):"")};BX.UI.EntityEditorLink.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._input)){throw"BX.UI.EntityEditorLink. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return b};BX.UI.EntityEditorLink.prototype.showError=function(b,a){BX.UI.EntityEditorLink.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"ui-entity-editor-field-error")}};BX.UI.EntityEditorLink.prototype.clearError=function(){BX.UI.EntityEditorLink.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"ui-entity-editor-field-error")}};BX.UI.EntityEditorLink.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.UI.EntityEditorLink.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorLink.prototype.getFocusInputID=function(){return this._id.toLowerCase()+"_text"};BX.UI.EntityEditorLink.create=function(c,b){var a=new BX.UI.EntityEditorLink();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorCustom==="undefined"){BX.UI.EntityEditorCustom=function(){BX.UI.EntityEditorCustom.superclass.constructor.apply(this);this._innerWrapper=null;this._runtimeValue=null};BX.extend(BX.UI.EntityEditorCustom,BX.UI.EntityEditorField);BX.UI.EntityEditorCustom.prototype.hasContentToDisplay=function(){return this.getHtmlContent()!==""};BX.UI.EntityEditorCustom.prototype.doClearLayout=function(a){this.setRuntimeValue(this.getValue())};BX.UI.EntityEditorCustom.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorCustom.prototype.layout=function(a){if(this._hasLayout){return}var c=this._schemeElement.getDataArrayParam("classNames",[]);c.push("ui-entity-editor-field-text");this.ensureWrapperCreated({classNames:c});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(a);this._hasLayout=true;return}if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(this.getTitle()));this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"}});this._wrapper.appendChild(this._innerWrapper);if(this._mode===BX.UI.EntityEditorMode.edit){BX.addClass(this._innerWrapper,"ui-ctl-custom")}var b=this.getHtmlContent();if(BX.type.isNotEmptyString(b)){setTimeout(BX.delegate(function(){BX.html(this._innerWrapper,b);if(this._mode===BX.UI.EntityEditorMode.edit){BX.bindDelegate(this._innerWrapper,"bxchange",{tag:["input","select","textarea"]},this._changeHandler)}},this),0)}else{if(this._mode!==BX.UI.EntityEditorMode.edit){this._innerWrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:BX.message("UI_ENTITY_EDITOR_FIELD_EMPTY")}))}}if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(a);this._hasLayout=true};BX.UI.EntityEditorCustom.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorCustom.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorCustom.prototype.getHtmlContent=function(){return(this._model.getSchemeField(this._schemeElement,this.isInEditMode()?"edit":"view",""))};BX.UI.EntityEditorCustom.prototype.setRuntimeValue=function(a){this._runtimeValue=a};BX.UI.EntityEditorCustom.prototype.getRuntimeValue=function(){return(this._mode===BX.UI.EntityEditorMode.edit?this._runtimeValue:"")};BX.UI.EntityEditorCustom.prototype.validate=function(a){if(this._mode!==BX.UI.EntityEditorMode.edit){throw"BX.UI.EntityEditorCustom. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}return true};BX.UI.EntityEditorCustom.create=function(c,b){var a=new BX.UI.EntityEditorCustom();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorMoney==="undefined"){BX.UI.EntityEditorMoney=function(){BX.UI.EntityEditorMoney.superclass.constructor.apply(this);this._currencyEditor=null;this._amountInput=null;this._currencyInput=null;this._sumElement=null;this._selectContainer=null;this._inputWrapper=null;this._innerWrapper=null;this._selectedCurrencyValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._isCurrencyMenuOpened=false;this.wrapperClassName="ui-entity-editor-field-money"};BX.extend(BX.UI.EntityEditorMoney,BX.UI.EntityEditorField);BX.UI.EntityEditorMoney.prototype.getModeSwitchType=function(b){var a=BX.UI.EntityEditorModeSwitchType.common;if(b===BX.UI.EntityEditorMode.edit){a|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return a};BX.UI.EntityEditorMoney.prototype.getContentWrapper=function(){return this._innerWrapper};BX.UI.EntityEditorMoney.prototype.focus=function(){if(this._amountInput){BX.focus(this._amountInput);BX.UI.EditorTextHelper.getCurrent().selectAll(this._amountInput)}};BX.UI.EntityEditorMoney.prototype.getValue=function(a){if(!this._model){return""}return(this._model.getStringField(this.getAmountFieldName(),(a!==undefined?a:"")))};BX.UI.EntityEditorMoney.prototype.layout=function(j){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:[this.wrapperClassName]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(j);this._hasLayout=true;return}var f=this.getTitle();var c=this.getData();var e=BX.prop.getString(c,"amount");var d=BX.prop.getString(BX.prop.getObject(c,"currency"),"name");var g=this._model.getField(BX.prop.getString(BX.prop.getObject(c,"currency"),"name",""));if(!BX.type.isNotEmptyString(g)){g=BX.Currency.Editor.getBaseCurrencyId()}this._selectedCurrencyValue=g;var i=this._editor.findOption(g,BX.prop.getArray(BX.prop.getObject(c,"currency"),"items"));var k=this.getAmountFieldName();var h=this.getCurrencyFieldName();var a=this._model.getField(k,"");var b=this._model.getField(BX.prop.getString(c,"formatted"),"");this._amountValue=null;this._amountInput=null;this._currencyInput=null;this._selectContainer=null;this._innerWrapper=null;this._sumElement=null;if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(f));this._amountValue=BX.create("input",{attrs:{name:e,type:"hidden",value:a}});this._amountInput=BX.create("input",{attrs:{className:"ui-ctl-inline ui-ctl-element ui-ctl-w75",type:"text",value:b}});BX.bind(this._amountInput,"input",this._changeHandler);if(this._model.isFieldLocked(k)){this._amountInput.disabled=true}this._currencyInput=BX.create("input",{attrs:{name:d,type:"hidden",value:g}});containerProps={props:{className:"ui-ctl-element"},text:i,};this._select=BX.create("div",containerProps);this._selectIcon=BX.create("div",{attrs:{className:"ui-ctl-after ui-ctl-icon-angle"}});this._selectContainer=BX.create("div",{props:{className:"ui-ctl ui-ctl-inline ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w33"},children:[this._select,this._selectIcon]});if(this._model.isFieldLocked(h)){this._selectContainer.disabled=true}else{BX.bind(this._selectContainer,"click",this._selectorClickHandler)}this._inputWrapper=BX.create("div",{props:{className:"ui-ctl-inline ui-ctl-w100"},children:[this._amountValue,this._currencyInput,this._amountInput,this._selectContainer,]});this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[this._inputWrapper]});this._currencyEditor=new BX.Currency.Editor({input:this._amountInput,currency:g,callback:BX.delegate(this.onAmountValueChange,this)});this._currencyEditor.changeValue()}else{this._wrapper.appendChild(this.createTitleNode(f));if(this.hasContentToDisplay()){this._sumElement=BX.create("span",{props:{className:"ui-entity-editor-content-block-wallet"}});this._sumElement.innerHTML=this.renderMoney();this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},children:[BX.create("div",{props:{className:"ui-entity-editor-content-block-text"},children:[this._sumElement]})]})}else{this._innerWrapper=BX.create("div",{props:{className:"ui-entity-editor-content-block"},text:this.getMessage("isEmpty")})}}this._wrapper.appendChild(this._innerWrapper);if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(j);this._hasLayout=true};BX.UI.EntityEditorMoney.prototype.doClearLayout=function(a){BX.PopupMenu.destroy(this._id);if(this._currencyEditor){this._currencyEditor.clean();this._currencyEditor=null}this._amountValue=null;this._amountInput=null;this._currencyInput=null;this._sumElement=null;this._selectContainer=null;this._inputWrapper=null;this._innerWrapper=null};BX.UI.EntityEditorMoney.prototype.refreshLayout=function(c){if(!this._hasLayout){return}if(!this._isValidLayout){BX.UI.EntityEditorMoney.superclass.refreshLayout.apply(this,arguments);return}if(this._mode===BX.UI.EntityEditorMode.edit&&this._amountInput){var a=this._currencyEditor?this._currencyEditor.currency:this._model.getField(this.getCurrencyFieldName());if(!BX.type.isNotEmptyString(a)){a=BX.Currency.Editor.getBaseCurrencyId()}var b=this.getAmountFieldName();this._amountValue.value=this._model.getField(b);this._amountInput.value=BX.Currency.Editor.getFormattedValue(this._model.getField(b,""),a);this._amountInput.disabled=this._model.isFieldLocked(b)}else{if(this._mode===BX.UI.EntityEditorMode.view&&this._sumElement){this._sumElement.innerHTML=this.renderMoney()}}};BX.UI.EntityEditorMoney.prototype.onAmountValueChange=function(a){if(this._amountValue){this._amountValue.value=a}};BX.UI.EntityEditorMoney.prototype.getAmountFieldName=function(){return this._schemeElement.getDataStringParam("amount","")};BX.UI.EntityEditorMoney.prototype.getCurrencyFieldName=function(){return BX.prop.getString(this._schemeElement.getDataObjectParam("currency",{}),"name","")};BX.UI.EntityEditorMoney.prototype.onSelectorClick=function(a){this.openCurrencyMenu()};BX.UI.EntityEditorMoney.prototype.openCurrencyMenu=function(){if(this._isCurrencyMenuOpened){return}var c=this._schemeElement.getData();var a=BX.prop.getArray(BX.prop.getObject(c,"currency"),"items");var b=0;var d=[];while(b<a.length){d.push({text:a[b]["NAME"],value:a[b]["VALUE"],onclick:BX.delegate(this.onCurrencySelect,this)});b++}BX.PopupMenu.show(this._id,this._selectContainer,d,{angle:false,width:this._selectContainer.offsetWidth+"px",events:{onPopupShow:BX.delegate(this.onCurrencyMenuOpen,this),onPopupClose:BX.delegate(this.onCurrencyMenuClose,this)}})};BX.UI.EntityEditorMoney.prototype.closeCurrencyMenu=function(){if(!this._isCurrencyMenuOpened){return}var a=BX.PopupMenu.getMenuById(this._id);if(a){a.popupWindow.close()}};BX.UI.EntityEditorMoney.prototype.onCurrencyMenuOpen=function(){BX.addClass(this._selectContainer,"active");this._isCurrencyMenuOpened=true};BX.UI.EntityEditorMoney.prototype.onCurrencyMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"active");this._isCurrencyMenuOpened=false};BX.UI.EntityEditorMoney.prototype.onCurrencySelect=function(b,a){this.closeCurrencyMenu();this._selectedCurrencyValue=this._currencyInput.value=a.value;this._select.innerHTML=BX.util.htmlspecialchars(a.text);if(this._currencyEditor){this._currencyEditor.setCurrency(this._selectedCurrencyValue)}this.markAsChanged({fieldName:this.getCurrencyFieldName(),fieldValue:this._selectedCurrencyValue})};BX.UI.EntityEditorMoney.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getAmountFieldName()){return}this.refreshLayout()};BX.UI.EntityEditorMoney.prototype.processModelLock=function(b){var a=BX.prop.getString(b,"name","");if(this.getAmountFieldName()===a){this.refreshLayout()}};BX.UI.EntityEditorMoney.prototype.validate=function(a){if(!(this._mode===BX.UI.EntityEditorMode.edit&&this._amountInput&&this._amountValue)){throw"BX.UI.EntityEditorMoney. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(a)}var b=!(this.isRequired()||this.isRequiredByAttribute())||BX.util.trim(this._amountValue.value)!=="";if(!b){a.addError(BX.UI.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._inputWrapper)}return b};BX.UI.EntityEditorMoney.prototype.showError=function(b,a){BX.UI.EntityEditorMoney.superclass.showError.apply(this,arguments);if(this._amountInput){BX.addClass(this._amountInput,"ui-entity-editor-field-error")}};BX.UI.EntityEditorMoney.prototype.clearError=function(){BX.UI.EntityEditorMoney.superclass.clearError.apply(this);if(this._amountInput){BX.removeClass(this._amountInput,"ui-entity-editor-field-error")}};BX.UI.EntityEditorMoney.prototype.getRuntimeValue=function(){var a=[];if(this._mode===BX.UI.EntityEditorMode.edit){if(this._amountValue){a[BX.prop.getString(a,"amount")]=this._amountValue.value}a[BX.prop.getString(a,"currency")]=this._selectedCurrencyValue;return a}return""};BX.UI.EntityEditorMoney.prototype.save=function(){var a=this._schemeElement.getData();this._model.setField(BX.prop.getString(BX.prop.getObject(a,"currency"),"name"),this._selectedCurrencyValue,{originator:this});if(this._amountValue){this._model.setField(BX.prop.getString(a,"amount"),this._amountValue.value,{originator:this});this._model.setField(BX.prop.getString(a,"formatted"),"",{originator:this});this._editor.formatMoney(this._amountValue.value,this._selectedCurrencyValue,BX.delegate(this.onMoneyFormatRequestSuccess,this))}};BX.UI.EntityEditorMoney.prototype.onMoneyFormatRequestSuccess=function(d){var b=this._schemeElement.getData();var a=BX.type.isNotEmptyString(d.FORMATTED_SUM_WITH_CURRENCY)?d.FORMATTED_SUM_WITH_CURRENCY:"";this._model.setField(BX.prop.getString(b,"formattedWithCurrency"),a);var c=BX.type.isNotEmptyString(d.FORMATTED_SUM)?d.FORMATTED_SUM:"";this._model.setField(BX.prop.getString(b,"formatted"),c,{originator:this});if(this._sumElement){while(this._sumElement.firstChild){this._sumElement.removeChild(this._sumElement.firstChild)}this._sumElement.innerHTML=this.renderMoney()}};BX.UI.EntityEditorMoney.prototype.renderMoney=function(){var d=this._schemeElement.getData();var b=this._model.getField(BX.prop.getString(d,"formattedWithCurrency"),"");var c=this._model.getField(BX.prop.getString(d,"formatted"),"");var a=BX.Currency.Editor.trimTrailingZeros(c,this._selectedCurrencyValue);return b.replace(c,a)};BX.UI.EntityEditorMoney.create=function(c,b){var a=new BX.UI.EntityEditorMoney();a.initialize(c,b);return a}}if(typeof BX.UI.EntityEditorUser==="undefined"){BX.UI.EntityEditorUser=function(){BX.UI.EntityEditorUser.superclass.constructor.apply(this);this._input=null;this._editButton=null;this._photoElement=null;this._nameElement=null;this._positionElement=null;this._selectedData={};this._editButtonClickHandler=BX.delegate(this.onEditBtnClick,this)};BX.extend(BX.UI.EntityEditorUser,BX.UI.EntityEditorField);BX.UI.EntityEditorUser.prototype.isSingleEditEnabled=function(){return true};BX.UI.EntityEditorUser.prototype.getRelatedDataKeys=function(){return([this.getDataKey(),this._schemeElement.getDataStringParam("formated",""),this._schemeElement.getDataStringParam("position",""),this._schemeElement.getDataStringParam("showUrl",""),this._schemeElement.getDataStringParam("photoUrl","")])};BX.UI.EntityEditorUser.prototype.hasContentToDisplay=function(){return true};BX.UI.EntityEditorUser.prototype.layout=function(i){if(this._hasLayout){return}this.ensureWrapperCreated();this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(i);this._hasLayout=true;return}var a=this._schemeElement.getName();var f=this._schemeElement.getTitle();var g=this._model.getField(a);var b=this._model.getSchemeField(this._schemeElement,"formated","");var d=this._model.getSchemeField(this._schemeElement,"position","");var e=this._model.getSchemeField(this._schemeElement,"showUrl","","");var c=this._model.getSchemeField(this._schemeElement,"photoUrl","");this._photoElement=BX.create("a",{props:{className:"ui-entity-editor-user-avatar-container",target:"_blank"},style:{backgroundImage:BX.type.isNotEmptyString(c)?"url('"+c+"')":"",backgroundSize:BX.type.isNotEmptyString(c)?"30px":""}});this._nameElement=BX.create("a",{props:{className:"ui-entity-editor-user-name",target:"_blank"},text:b});if(e!==""){this._photoElement.href=e;this._nameElement.href=e}this._positionElement=BX.create("SPAN",{props:{className:"ui-entity-editor-user-position"},text:d});if(this.isDragEnabled()){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(f));var h=BX.create("div",{props:{className:"ui-entity-editor-user-container"}});this._editButton=null;this._input=null;if(this._mode===BX.UI.EntityEditorMode.edit||(this.isEditInViewEnabled()&&!this.isReadOnly())){this._input=BX.create("input",{attrs:{name:a,type:"hidden",value:g}});this._wrapper.appendChild(this._input);this._editButton=BX.create("span",{props:{className:"ui-entity-editor-user-change"},text:BX.message("UI_ENTITY_EDITOR_CHANGE")});BX.bind(this._editButton,"click",this._editButtonClickHandler);h.appendChild(this._editButton)}h.appendChild(this._photoElement);h.appendChild(BX.create("span",{props:{className:"ui-entity-editor-user-info"},children:[this._nameElement,this._positionElement]}));this._wrapper.appendChild(BX.create("div",{props:{className:"ui-entity-editor-user-content-block-inner"},children:[h]}));if(this.isContextMenuEnabled()){this._wrapper.appendChild(this.createContextMenuButton())}if(this.isDragEnabled()){this.initializeDragDropAbilities()}this.registerLayout(i);this._hasLayout=true};BX.UI.EntityEditorUser.prototype.doRegisterLayout=function(){if(this.isInEditMode()&&this.checkModeOption(BX.UI.EntityEditorModeOptions.individual)){window.setTimeout(BX.delegate(this.openSelector,this),0)}};BX.UI.EntityEditorUser.prototype.doClearLayout=function(a){this._input=null;this._editButton=null;this._photoElement=null;this._nameElement=null;this._positionElement=null};BX.UI.EntityEditorUser.prototype.onEditBtnClick=function(a){if(this._mode===BX.UI.EntityEditorMode.view&&this.isEditInViewEnabled()&&this.getEditor().isChanged()){this.switchToSingleEditMode()}else{this.openSelector()}};BX.UI.EntityEditorUser.prototype.openSelector=function(){BX.onCustomEvent(this._editor,"BX.UI.EntityEditorUser:openSelector",[this,{id:this._id,callback:BX.delegate(this.processItemSelect,this),anchor:this._editButton,}])};BX.UI.EntityEditorUser.prototype.processItemSelect=function(a,c){var b=this._mode===BX.UI.EntityEditorMode.view;var d=this.isEditInViewEnabled();if(b&&!d){return}this._selectedData={id:BX.prop.getInteger(c,"entityId",0),photoUrl:BX.prop.getString(c,"avatar",""),formattedNameHtml:BX.prop.getString(c,"name",""),positionHtml:BX.prop.getString(c,"desc","")};this._input.value=this._selectedData.id;this._photoElement.style.backgroundImage=this._selectedData.photoUrl!==""?"url('"+this._selectedData.photoUrl+"')":"";this._photoElement.style.backgroundSize=this._selectedData.photoUrl!==""?"30px":"";this._nameElement.innerHTML=this._selectedData.formattedNameHtml;this._positionElement.innerHTML=this._selectedData.positionHtml;BX.onCustomEvent(this._editor,"BX.UI.EntityEditorUser:closeSelector",[this,{id:this._id,}]);if(!b){this.markAsChanged()}else{this._editor.saveControl(this)}};BX.UI.EntityEditorUser.prototype.save=function(){var a=this._schemeElement.getData();if(this._selectedData.id>0){var b=this._selectedData.id;this._model.setField(BX.prop.getString(a,"formated"),BX.util.htmlspecialcharsback(this._selectedData.formattedNameHtml));this._model.setField(BX.prop.getString(a,"position"),this._selectedData.positionHtml!=="&nbsp;"?BX.util.htmlspecialcharsback(this._selectedData.positionHtml):"");this._model.setField(BX.prop.getString(a,"showUrl"),BX.prop.getString(a,"pathToProfile").replace(/#user_id#/ig,b));this._model.setField(BX.prop.getString(a,"photoUrl"),this._selectedData.photoUrl);this._model.setField(this.getName(),b)}};BX.UI.EntityEditorUser.prototype.processModelChange=function(a){if(BX.prop.get(a,"originator",null)===this){return}if(!BX.prop.getBoolean(a,"forAll",false)&&BX.prop.getString(a,"name","")!==this.getName()){return}this.refreshLayout()};BX.UI.EntityEditorUser.prototype.getRuntimeValue=function(){if(this._mode===BX.UI.EntityEditorMode.edit&&this._selectedData.id>0){return this._selectedData.id}return""};BX.UI.EntityEditorUser.prototype.getMessage=function(b){var a=BX.UI.EntityEditorUser.messages;return(a.hasOwnProperty(b)?a[b]:BX.UI.EntityEditorUser.superclass.getMessage.apply(this,arguments))};if(typeof(BX.UI.EntityEditorUser.messages)==="undefined"){BX.UI.EntityEditorUser.messages={}}BX.UI.EntityEditorUser.create=function(c,b){var a=new BX.UI.EntityEditorUser();a.initialize(c,b);return a}};