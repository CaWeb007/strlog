BX.namespace("BX.UI");if(typeof BX.UI.EntityScheme==="undefined"){BX.UI.EntityScheme=function(){this._id="";this._settings={};this._elements=null;this._availableElements=null};BX.UI.EntityScheme.prototype={initialize:function(f,c){this._id=BX.type.isNotEmptyString(f)?f:BX.util.getRandomString(4);this._settings=c?c:{};this._elements=[];this._availableElements=[];var a,e;var b=BX.prop.getArray(this._settings,"current",[]);for(a=0,e=b.length;a<e;a++){this._elements.push(BX.UI.EntitySchemeElement.create(b[a]))}var d=BX.prop.getArray(this._settings,"available",[]);for(a=0,e=d.length;a<e;a++){this._availableElements.push(BX.UI.EntitySchemeElement.create(d[a]))}},getId:function(){return this._id},getElements:function(){return([].concat(this._elements))},findElementByName:function(b,a){var f=BX.prop.getBoolean(a,"isRecursive",false);if(f){return this.findElementByNameRecursive(this._elements,b)}for(var d=0,e=this._elements.length;d<e;d++){var c=this._elements[d];if(c.getName()===b){return c}}return null},findElementByNameRecursive:function(f,b){if(Array.isArray(f)){for(var d=0,e=f.length;d<e;d++){var c=f[d];if(c.getName()===b){return c}var a=this.findElementByNameRecursive(c._elements,b);if(a){return a}}}return null},getAvailableElements:function(){return([].concat(this._availableElements))},setAvailableElements:function(a){this._availableElements=BX.type.isArray(a)?a:[]}};BX.UI.EntityScheme.create=function(c,b){var a=new BX.UI.EntityScheme();a.initialize(c,b);return a}}if(typeof BX.UI.EntitySchemeElement==="undefined"){BX.UI.EntitySchemeElement=function(){this._settings={};this._name="";this._type="";this._title="";this._originalTitle="";this._optionFlags=0;this._options={};this._isEditable=true;this._isShownAlways=false;this._isTransferable=true;this._isContextMenuEnabled=true;this._isRequired=false;this._isRequiredConditionally=false;this._isRequiredByAttribute=false;this._isPhaseDependent=true;this._isHeading=false;this._isMergeable=true;this._visibilityPolicy=BX.UI.EntityEditorVisibilityPolicy.always;this._data=null;this._elements=null;this._parent=null};BX.UI.EntitySchemeElement.prototype={initialize:function(e){this._settings=e?e:{};this._name=BX.prop.getString(this._settings,"name","");this._type=BX.prop.getString(this._settings,"type","");this._data=BX.prop.getObject(this._settings,"data",{});this.prepareAdditionalParameters();this._isEditable=BX.prop.getBoolean(this._settings,"editable",true);this._isMergeable=BX.prop.getBoolean(this._settings,"mergeable",true);this._isShownAlways=BX.prop.getBoolean(this._settings,"showAlways",false);this._isTransferable=BX.prop.getBoolean(this._settings,"transferable",true);this._isContextMenuEnabled=BX.prop.getBoolean(this._settings,"enabledMenu",true);this._isTitleEnabled=BX.prop.getBoolean(this._settings,"enableTitle",true)&&this.getDataBooleanParam("enableTitle",true);this._isDragEnabled=BX.prop.getBoolean(this._settings,"isDragEnabled",true);this._isPhaseDependent=this.getDataBooleanParam("isPhaseDependent",true);this._isRequired=BX.prop.getBoolean(this._settings,"required",false);this._isRequiredConditionally=BX.prop.getBoolean(this._settings,"requiredConditionally",false);this._isRequiredByAttribute=this.getRequiredByAttributeConfiguration();this._isHeading=BX.prop.getBoolean(this._settings,"isHeading",false);this._visibilityPolicy=BX.UI.EntityEditorVisibilityPolicy.parse(BX.prop.getString(this._settings,"visibilityPolicy",""));var f=BX.prop.getString(this._settings,"title","");var b=BX.prop.getString(this._settings,"originalTitle","");if(f!==""&&b===""){b=f}else{if(b!==""&&f===""){f=b}}this._title=f;this._originalTitle=b;this._optionFlags=BX.prop.getInteger(this._settings,"optionFlags",0);this._options=BX.prop.getObject(this._settings,"options",{});this._elements=[];var d=BX.prop.getArray(this._settings,"elements",[]);for(var c=0,a=d.length;c<a;c++){this._elements.push(BX.UI.EntitySchemeElement.create(d[c]))}},prepareAdditionalParameters:function(){var a=this._data.fieldInfo||null;if(a&&a.ADDITIONAL===undefined&&a.USER_TYPE_ID===BX.UI.EntityUserFieldType.file&&BX.UI.EntitySchemeElement.userFieldFileUrlTemplate!==undefined){var b=BX.UI.EntitySchemeElement.userFieldFileUrlTemplate;b=b.replace("#owner_id#",a.ENTITY_VALUE_ID).replace("#field_name#",a.FIELD);a.ADDITIONAL={};a.ADDITIONAL.URL_TEMPLATE=b}},mergeSettings:function(a){this.initialize(BX.mergeEx(this._settings,a))},getName:function(){return this._name},getType:function(){return this._type},getTitle:function(){return this._title},setTitle:function(a){this._title=this._settings.title=a},getOriginalTitle:function(){return this._originalTitle},hasCustomizedTitle:function(){return this._title!==""&&this._title!==this._originalTitle},resetOriginalTitle:function(){this._originalTitle=this._title},getOptionFlags:function(){return this._optionFlags},setOptionFlags:function(a){this._optionFlags=this._settings.optionFlags=a},areAttributesEnabled:function(){return BX.prop.getBoolean(this._settings,"enableAttributes",true)},isEditable:function(){return this._isEditable},isShownAlways:function(){return this._isShownAlways},isTransferable:function(){return this._isTransferable},isRequired:function(){return this._isRequired},isRequiredConditionally:function(){return this._isRequiredConditionally},isRequiredByAttribute:function(){return this._isRequiredByAttribute},isContextMenuEnabled:function(){return this._isContextMenuEnabled},isTitleEnabled:function(){return this._isTitleEnabled},isDragEnabled:function(){return this._isDragEnabled},isHeading:function(){return this._isHeading},isMergeable:function(){return this._isMergeable},needShowTitle:function(){return BX.prop.getBoolean(this._settings,"showTitle",true)},isVirtual:function(){return BX.prop.getBoolean(this._settings,"virtual",false)},getCreationPlaceholder:function(){return BX.prop.getString(BX.prop.getObject(this._settings,"placeholders",null),"creation","")},getChangePlaceholder:function(){return BX.prop.getString(BX.prop.getObject(this._settings,"placeholders",null),"change","")},getVisibilityPolicy:function(){return this._visibilityPolicy},getData:function(){return this._data},setData:function(a){this._data=a},getDataParam:function(b,a){return BX.prop.get(this._data,b,a)},setDataParam:function(a,b){this._data[a]=b},getDataStringParam:function(b,a){return BX.prop.getString(this._data,b,a)},getDataIntegerParam:function(b,a){return BX.prop.getInteger(this._data,b,a)},getDataBooleanParam:function(b,a){return BX.prop.getBoolean(this._data,b,a)},getDataObjectParam:function(b,a){return BX.prop.getObject(this._data,b,a)},getDataArrayParam:function(b,a){return BX.prop.getArray(this._data,b,a)},getElements:function(){return this._elements},setElements:function(a){this._elements=a},findElementByName:function(a){for(var c=0,d=this._elements.length;c<d;c++){var b=this._elements[c];if(b.getName()===a){return b}}return null},getAffectedFields:function(){var a=this.getDataArrayParam("affectedFields",[]);if(a.length===0){a.push(this._name)}return a},getParent:function(){return this._parent},setParent:function(a){this._parent=a instanceof BX.UI.EntitySchemeElement?a:null},hasAttributeConfiguration:function(a){return !!this.getAttributeConfiguration(a)},getAttributeConfiguration:function(a){var e=this.getData();var f=BX.prop.getArray(e,"attrConfigs",null);if(!f){return null}for(var c=0,d=f.length;c<d;c++){var b=f[c];if(BX.prop.getInteger(b,"typeId",BX.UI.EntityFieldAttributeType.undefined)===a){return BX.clone(b)}}return null},setAttributeConfiguration:function(b){var d=BX.prop.getInteger(b,"typeId",BX.UI.EntityFieldAttributeType.undefined);if(typeof(this._data.attrConfigs)==="undefined"){this._data.attrConfigs=[]}var a=-1;for(var c=0,e=this._data.attrConfigs.length;c<e;c++){if(BX.prop.getInteger(this._data.attrConfigs[c],"typeId",BX.UI.EntityFieldAttributeType.undefined)===d){a=c;break}}if(a>=0){this._data.attrConfigs.splice(a,1,b)}else{this._data.attrConfigs.push(b)}this._isRequiredByAttribute=this.getRequiredByAttributeConfiguration()},removeAttributeConfiguration:function(a){if(typeof(this._data.attrConfigs)!=="undefined"){for(var b=0,c=this._data.attrConfigs.length;b<c;b++){if(BX.prop.getInteger(this._data.attrConfigs[b],"typeId",BX.UI.EntityFieldAttributeType.undefined)===a){this._data.attrConfigs.splice(b,1);break}}}this._isRequiredByAttribute=this.getRequiredByAttributeConfiguration()},getRequiredByAttributeConfiguration:function(){var a=false;var b=false;if(typeof(this._data.attrConfigs)==="undefined"){b=true}if(!b){for(var e=0,f=this._data.attrConfigs.length;e<f;e++){if(BX.prop.getInteger(this._data.attrConfigs[e],"typeId",BX.UI.EntityFieldAttributeType.undefined)===BX.UI.EntityFieldAttributeType.required){if(this._isPhaseDependent){var d=this._data.attrConfigs[e];if(d.hasOwnProperty("groups")&&BX.Type.isArray(d.groups)){for(var c=0;c<=d.groups.length;c++){if(BX.Type.isPlainObject(d.groups[c])){var g=d.groups[c];if(g.hasOwnProperty("phaseGroupTypeId")){if(parseInt(g.phaseGroupTypeId)===BX.UI.EntityFieldAttributePhaseGroupType.general){a=true;b=true;break}}}}}}else{a=true;b=true}if(b){break}}}}return a},setVisibilityConfiguration:function(a){this._data.visibilityConfigs=a},removeVisibilityConfiguration:function(a){this._data.visibilityConfigs={}},createConfigItem:function(){var a={name:this._name};if(this._type==="column"){a.type="column";a.data=this._data;a.elements=[];for(var b=0,c=this._elements.length;b<c;b++){a.elements.push(this._elements[b].createConfigItem())}}else{if(this._type==="section"){a.type="section";a.data=this._data;if(this._title!==""){a.title=this._title}a.elements=[];for(var b=0,c=this._elements.length;b<c;b++){a.elements.push(this._elements[b].createConfigItem())}}else{if(this._type==="included_area"){a.type="included_area";a.data=this._data;if(this._title!==""){a.title=this._title}}else{if(this._title!==""&&this._title!==this._originalTitle){a.title=this._title}if(this._optionFlags>0){a.optionFlags=this._optionFlags}a.options=this._options}}}return a},clone:function(){return BX.UI.EntitySchemeElement.create(BX.clone(this._settings))}};BX.UI.EntitySchemeElement.create=function(b){var a=new BX.UI.EntitySchemeElement();a.initialize(b);return a}};