BX.namespace("BX.UI");if(typeof BX.UI.EntityEditorToolPanel==="undefined"){BX.UI.EntityEditorToolPanel=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._editor=null;this._isVisible=false;this._isLocked=false;this._hasLayout=false;this._keyPressHandler=BX.delegate(this.onKeyPress,this)};BX.UI.EntityEditorToolPanel.prototype={initialize:function(b,a){this._id=BX.type.isNotEmptyString(b)?b:BX.util.getRandomString(4);this._settings=a?a:{};this._container=BX.prop.getElementNode(this._settings,"container",null);this._editor=BX.prop.get(this._settings,"editor",null);this._isVisible=BX.prop.getBoolean(this._settings,"visible",false)},getId:function(){return this._id},getContainer:function(){return this._container},setContainer:function(a){this._container=a},isVisible:function(){return this._isVisible},setVisible:function(a){a=!!a;if(this._isVisible===a){return}this._isVisible=a;this.adjustLayout()},isLocked:function(){return this._isLocked},setLocked:function(a){a=!!a;if(this._isLocked===a){return}this._isLocked=a;if(this._editButton){if(a){BX.addClass(this._editButton,"ui-btn-clock")}else{BX.removeClass(this._editButton,"ui-btn-clock")}}},disableSaveButton:function(){if(!this._editButton){return}this._editButton.disabled=true;BX.addClass(this._editButton,"ui-btn-disabled")},enableSaveButton:function(){if(!this._editButton){return}this._editButton.disabled=false;BX.removeClass(this._editButton,"ui-btn-disabled")},isSaveButtonEnabled:function(){return this._editButton&&!this._editButton.disabled},layout:function(){this._editButton=BX.create("button",{props:{className:"ui-btn ui-btn-success",title:"[Ctrl+Enter]"},text:BX.message("UI_ENTITY_EDITOR_SAVE"),events:{click:BX.delegate(this.onSaveButtonClick,this)}});this._cancelButton=BX.create("a",{props:{className:"ui-btn ui-btn-link",title:"[Esc]"},text:BX.message("UI_ENTITY_EDITOR_CANCEL"),attrs:{href:"#"},events:{click:BX.delegate(this.onCancelButtonClick,this)}});this._errorContainer=BX.create("DIV",{props:{className:"ui-entity-section-control-error-block"}});this._errorContainer.style.maxHeight="0";this._wrapper=BX.create("DIV",{props:{className:"ui-entity-wrap"},children:[BX.create("DIV",{props:{className:"ui-entity-section ui-entity-section-control"},children:[this._editButton,this._cancelButton,this._errorContainer]})]});this._container.appendChild(this._wrapper);this._hasLayout=true;this.adjustLayout()},adjustLayout:function(){if(!this._hasLayout){return}if(!this._isVisible){BX.removeClass(this._wrapper,"crm-section-control-active");BX.unbind(document,"keydown",this._keyPressHandler)}else{BX.addClass(this._wrapper,"crm-section-control-active");BX.bind(document,"keydown",this._keyPressHandler)}},getPosition:function(){return this._hasLayout?BX.pos(this._wrapper):null}};BX.UI.EntityEditorToolPanel.prototype.onSaveButtonClick=function(a){if(!this._isLocked){this._editor.saveChanged()}};BX.UI.EntityEditorToolPanel.prototype.onCancelButtonClick=function(a){if(!this._isLocked){this._editor.cancel()}return BX.eventReturnFalse(a)};BX.UI.EntityEditorToolPanel.prototype.onKeyPress=function(a){if(!this._isVisible){return}if(BX.type.isFunction(BX.PopupWindowManager.isAnyPopupShown)&&BX.PopupWindowManager.isAnyPopupShown()){return}a=a||window.event;if(a.keyCode==27){this._editor.cancel();BX.eventCancelBubble(a)}else{if(a.keyCode==13&&a.ctrlKey){this._editor.saveChanged();BX.eventCancelBubble(a)}}};BX.UI.EntityEditorToolPanel.prototype.addError=function(a){this._errorContainer.appendChild(BX.create("DIV",{attrs:{className:"ui-entity-section-control-error-text"},html:a}));this._errorContainer.style.maxHeight=""};BX.UI.EntityEditorToolPanel.prototype.clearErrors=function(){this._errorContainer.innerHTML="";this._errorContainer.style.maxHeight="0"};BX.UI.EntityEditorToolPanel.prototype.getMessage=function(b){var a=BX.UI.EntityEditorToolPanel.messages;return a.hasOwnProperty(b)?a[b]:b};if(typeof(BX.UI.EntityEditorToolPanel.messages)==="undefined"){BX.UI.EntityEditorToolPanel.messages={}}BX.UI.EntityEditorToolPanel.create=function(c,b){var a=new BX.UI.EntityEditorToolPanel();a.initialize(c,b);return a}};