(function(){var a=window.BX;a.namespace("BX.UI");if(!!a.UI.SelectorManager){return}a.UI.SelectorManager={statuses:{searchStarted:false,allowSendEvent:true},extranetUser:false,instances:{},finderInitialized:false,loadAllInitialized:false,obClientDb:null,obClientDbData:{},obClientDbDataSearchIndex:{},getSelector:function(b){return(a.type.isNotEmptyObject(b)&&a.type.isNotEmptyString(b.id)&&a.type.isNotEmptyObject(this.instances[b.id])?this.instances[b.id]:false)},buildRelations:function(g,d,b){var c={},f,e;b=(b&&a.type.isNotEmptyObject(g[d+b])&&a.type.isNotEmptyString(g[d+b].parent)?g[d+b].parent:(d+0));for(e in g){if(g.hasOwnProperty(e)){f=g[e]["parent"];if(!c[f]){c[f]=[]}c[f].push(e)}}return this.makeTree(b,c)},makeTree:function(g,e){var d={},c,f;if(e[g]){for(var b in e[g]){if(e[g].hasOwnProperty(b)){c=e[g][b];f=[];if(e[c]&&e[c].length>0){f=this.makeTree(c,e)}d[c]={id:c,idFlat:"",type:"category",items:f}}}}return d},onAddData:function(b,f){var m=a.UI.SelectorManager.instances[b];if(!a.type.isNotEmptyObject(m)){return}var h=null,g=null;for(var e in f.ENTITIES){if(f.ENTITIES.hasOwnProperty(e)){h=f.ENTITIES[e];if(!a.type.isNotEmptyObject(m.entities[e])){m.entities[e]={items:{},itemsLast:[],itemsHidden:[],additionalData:{}}}if(!a.type.isNotEmptyObject(m.entities[e].items)){m.entities[e].items={}}for(key in h.ITEMS){if(h.ITEMS.hasOwnProperty(key)){m.entities[e].items[key]=h.ITEMS[key]}}if(a.type.isNotEmptyObject(h.ADDITIONAL_INFO)&&a.type.isNotEmptyObject(h.ADDITIONAL_INFO)){m.entities[e].additionalData=h.ADDITIONAL_INFO;if(a.type.isNotEmptyString(h.ADDITIONAL_INFO.TYPE)&&h.ADDITIONAL_INFO.TYPE=="tree"&&a.type.isNotEmptyString(h.ADDITIONAL_INFO.PREFIX)){m.entities[e+"_RELATION"]={items:a.UI.SelectorManager.buildRelations(m.entities[e].items,h.ADDITIONAL_INFO.PREFIX,(h.ADDITIONAL_INFO.RELATION_ROOT?h.ADDITIONAL_INFO.RELATION_ROOT:0))}}if(a.type.isNotEmptyObject(h.ADDITIONAL_INFO.GROUPS_LIST)){for(key in h.ADDITIONAL_INFO.GROUPS_LIST){if(h.ADDITIONAL_INFO.GROUPS_LIST.hasOwnProperty(key)){m.dialogGroups[key]=h.ADDITIONAL_INFO.GROUPS_LIST[key]}}}}if(a.type.isArray(h.ITEMS_LAST)&&h.ITEMS_LAST.length>0){if(!a.type.isArray(m.entities[e].itemsLast)){m.entities[e].itemsLast=[]}for(g=0;g<h.ITEMS_LAST.length;g++){m.entities[e].itemsLast.push(h.ITEMS_LAST[g])}}if(a.type.isArray(h.ITEMS_HIDDEN)&&h.ITEMS_HIDDEN.length>0){if(!a.type.isArray(m.entities[e].itemsHidden)){m.entities[e].itemsHidden=[]}for(g=0;g<h.ITEMS_HIDDEN.length;g++){m.entities[e].itemsHidden.push(h.ITEMS_HIDDEN[g])}}}}if(a.type.isNotEmptyObject(f.TABS)){m.tabs.list=f.TABS}if(a.type.isNotEmptyObject(f.SORT)){m.sortData=f.SORT}if(m.callback.select){var c=m.getItemsSelectedSorted(),j=null,l=null,d=0;for(g=0;g<c.length;g++){j=c[g].itemId;e=a.UI.SelectorManager.convertEntityType(c[g].entityType);l=a.UI.SelectorManager.getEntityTypeFullList(e);for(d=0;d<l.length;d++){if(a.type.isNotEmptyObject(m.entities[l[d]])&&a.type.isNotEmptyObject(m.entities[l[d]].items)&&a.type.isNotEmptyObject(m.entities[l[d]].items[j])){m.callback.select({item:m.entities[l[d]].items[j],entityType:l[d],selectorId:m.id,undeletable:(a.util.in_array(j,m.itemsUndeletable)),state:"init"});break}}}for(e in m.entities){if(m.entities.hasOwnProperty(e)&&a.type.isArray(m.entities[e].itemsHidden)&&m.entities[e].itemsHidden.length>0){for(g=0;g<m.entities[e].itemsHidden.length;g++){m.callback.select({item:{id:m.entities[e].itemsHidden[g],name:a.message("MAIN_UI_SELECTOR_HIDDEN_TITLE")},entityType:e,selectorId:m.id,undeletable:true,state:"init"})}}}}a.onCustomEvent("BX.Main.SelectorV2:onAfterAddData",[{selectorId:m.id}])},convertEntityType:function(b){b=b.toUpperCase();switch(b){case"DEPARTMENT":b="DEPARTMENTS";break;default:}return b},getEntityTypeFullList:function(c){c=c.toUpperCase();var b=[c];switch(c){case"USERS":b.push("EMAILUSERS");break;default:}var d=null;if(d=c.match(/^([A-Z]+)\_MULTI$/)){b.push(d[1])}b=a.util.array_unique(b);return b},checkEmail:function(c){c=c.trim();var d=/^([^<]+)\s<([^>]+)>$/igm;var f=d.exec(c);var e="";var b="";if(f!=null&&f.length==3){e=f[1];var g=e.split(/[\s]+/);b=g.pop();e=g.join(" ");c=f[2].trim()}d=/^[=_0-9a-z+~'!\$&*^`|\#%/?{}-]+(\.[=_0-9a-z+~'!\$&*^`|\#%/?{}-]+)*@(([-0-9a-z_]+\.)+)([a-z0-9-]{2,20})$/igm;if(c.length>=6&&d.test(c)){return{name:e,lastName:b,email:c.toLowerCase()}}else{return false}}};a.ready(function(){a.addCustomEvent("BX.Main.SelectorV2:onAddData",a.UI.SelectorManager.onAddData);a.addCustomEvent("BX.UI.SelectorManager:initClientDatabase",function(){if(!a.UI.SelectorManager.finderInitialized){a.Finder(false,"destination",[],{},a.UI.SelectorManager);a.onCustomEvent(a.UI.SelectorManager,"initFinderDb",[a.UI.SelectorManager,null,null,["users"],a.UI.SelectorManager]);a.UI.SelectorManager.finderInitialized=true}});a.addCustomEvent("loadAllFinderDb",function(b){if(!a.UI.SelectorManager.loadAllInitialized){a.onCustomEvent("BX.UI.SelectorManager:loadAll",[b])}a.UI.SelectorManager.loadAllInitialized=true});a.addCustomEvent("BX.Main.SelectorV2:onGetDataStart",function(c){var b=a.UI.SelectorManager.instances[c];if(!a.type.isNotEmptyObject(b)){return}b.postponeSearch=true});a.addCustomEvent("BX.Main.SelectorV2:onGetDataFinish",function(c){var b=a.UI.SelectorManager.instances[c];if(!a.type.isNotEmptyObject(b)){return}b.postponeSearch=false})})})();