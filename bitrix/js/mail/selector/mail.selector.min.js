(function(){var a=window.BX;if(!!a.MailUISelector){return}a.MailUISelector={prefix:"MC",onEmptySearchResult:function(d){if(!a.type.isNotEmptyObject(d)||!a.type.isNotEmptyString(d.selectorId)||!a.type.isNotEmptyString(d.searchString)||!a.type.isNotEmptyObject(a.UI.SelectorManager)){return}var b=a.UI.SelectorManager.instances[d.selectorId];if(!a.type.isNotEmptyObject(b)){return}if(b.getOption("allowAdd","MAILCONTACTS")=="Y"){var c=b.manager.checkEmail(d.searchString);if(a.type.isNotEmptyObject(c)&&!a.type.isNotEmptyObject(b.entities.MAILCONTACTS.items[c.email])){this.openAddDialog({selectorId:d.selectorId,contactData:c})}}},openAddDialog:function(c){if(!a.type.isNotEmptyObject(c)||!a.type.isNotEmptyString(c.selectorId)||!a.type.isNotEmptyObject(c.contactData)){return}var b=a.UI.SelectorManager.instances[c.selectorId];if(!a.type.isNotEmptyObject(b)){return}if(!b.popups.addMailContact){b.popups.addMailContact=new a.PopupWindow("add-mailcontact-popup",b.getPopupBind(),{offsetTop:1,content:this.getAddDialogContent(c),zIndex:1250,lightShadow:true,autoHide:true,closeByEsc:true,angle:{position:"bottom",offset:20},events:{onPopupClose:function(){if(b.popups.addMailContact!=null||!b.popups.addMailContact.isShown()){this.addMailContact({selectorId:c.selectorId,name:(b.addMailContactSubmitted?a("add_mailcontact_name_"+c.selectorId).value:""),lastName:(b.addMailContactSubmitted?a("add_mailcontact_lastname_"+c.selectorId).value:""),email:a("add_mailcontact_email_"+c.selectorId).value})}b.addMailContactSubmitted=false;if(b.manager.statuses.allowSendEvent&&b.callback.closeEmailAdd){b.callback.closeEmailAdd({selectorId:b.id})}}.bind(this),onPopupShow:function(){a.defer(a.focus)(a("add_mailcontact_name_"+c.selectorId));if(b.manager.statuses.allowSendEvent&&b.callback.openEmailAdd){b.callback.openEmailAdd({selectorId:b.id})}}}})}else{b.popups.addMailContact.setContent(this.getAddDialogContent(c));b.popups.addMailContact.setBindElement(b.getPopupBind())}if(!b.popups.addMailContact.isShown()){b.popups.addMailContact.show()}},getAddDialogContent:function(c){if(!a.type.isNotEmptyObject(c)||!a.type.isNotEmptyString(c.selectorId)||!a.type.isNotEmptyObject(c.contactData)){return}var b=a.UI.SelectorManager.instances[c.selectorId];if(!a.type.isNotEmptyObject(b)){return}return a.create("DIV",{props:{className:"bx-ui-selector bx-feed-email-popup"},children:[a.create("DIV",{props:{className:"bx-feed-email-title"},text:a.message("MAIL_EXT_SELECTOR_ADD_MAILCONTACT_TITLE")}),a.create("FORM",{style:{padding:0,margin:0},events:{submit:function(d){this.submitAddMailContactForm(c);d.stopPropagation();d.preventDefault()}.bind(this)},children:[a.create("DIV",{children:[a.create("INPUT",{attrs:{id:"add_mailcontact_email_"+c.selectorId,type:"hidden",value:c.contactData.email}}),a.create("INPUT",{attrs:{id:"add_mailcontact_name_"+c.selectorId,type:"text",placeholder:a.message("MAIL_EXT_SELECTOR_ADD_MAILCONTACT_PLACEHOLDER_NAME"),value:c.contactData.name},props:{className:"bx-feed-email-input"}}),a.create("INPUT",{attrs:{id:"add_mailcontact_lastname_"+c.selectorId,type:"text",placeholder:a.message("MAIL_EXT_SELECTOR_ADD_MAILCONTACT_PLACEHOLDER_LAST_NAME"),value:c.contactData.lastName},props:{className:"bx-feed-email-input"},events:{keyup:function(d){if(a("add_mailcontact_name_"+c.selectorId).value.length>0||a("add_mailcontact_lastname_"+c.selectorId).value.length>0){a.removeClass(a("add_mailcontact_button_"+c.selectorId),"ui-btn-disabled")}else{a.addClass(a("add_mailcontact_button_"+c.selectorId),"ui-btn-disabled")}d.stopPropagation();d.preventDefault()}}}),a.create("SPAN",{attrs:{id:"add_mailcontact_button_"+c.selectorId},props:{className:"ui-btn ui-btn-md ui-btn-primary ui-btn-disabled"},text:a.message("MAIL_EXT_SELECTOR_ADD_MAILCONTACT_BUTTON_OK"),style:{cursor:"pointer"},events:{click:function(){this.submitAddMailContactForm(c)}.bind(this)}}),a.create("INPUT",{style:{display:"none"},attrs:{type:"submit"}})]})]})]})},addMailContact:function(f){if(!a.type.isNotEmptyObject(f)||!a.type.isNotEmptyString(f.selectorId)){return}var c=a.UI.SelectorManager.instances[f.selectorId];if(!a.type.isNotEmptyObject(c)||!a.type.isNotEmptyObject(c.entities.MAILCONTACTS)){return}var b=false,d=f.email,e=a.util.htmlspecialchars(f.name)+(a.type.isNotEmptyString(f.name)?" ":"")+a.util.htmlspecialchars(f.lastName);if(!a.type.isNotEmptyString(e)){e=d}else{b=true}c.entities.MAILCONTACTS.items[d]={name:e,email:d,id:"MC"+d,showEmail:(b?"Y":"N"),params:f,isEmail:"Y",};if(c.callback.select){c.callback.select({item:c.entities.MAILCONTACTS.items[d],entityType:"MAILCONTACTS",selectorId:c.id,state:"select",prefix:this.prefix})}},submitAddMailContactForm:function(c){if(!a.type.isNotEmptyObject(c)||!a.type.isNotEmptyString(c.selectorId)){return}var b=a.UI.SelectorManager.instances[c.selectorId];if(!a.type.isNotEmptyObject(b)){return}b.addMailContactSubmitted=true;b.popups.addMailContact.close()},onGetEntityTypes:function(d){if(!a.type.isNotEmptyObject(d)||!a.type.isNotEmptyObject(d.selector)){return}var b=d.selector;if(b.getOption("enableMailContacts")=="Y"){var c={};b.entityTypes.MAILCONTACTS={options:{allowAdd:(b.getOption("allowAddMailContact")=="Y"?"Y":"N"),addTab:(b.getOption("addMailContactsTab")=="Y"?"Y":"N"),selectedItemsData:b.getOption("selectedItemsData")},}}}};a.addCustomEvent("BX.Main.SelectorV2:onGetEntityTypes",a.MailUISelector.onGetEntityTypes);a.ready(function(){a.addCustomEvent("BX.UI.Selector:onEmptySearchResult",a.MailUISelector.onEmptySearchResult.bind(a.MailUISelector))})})();